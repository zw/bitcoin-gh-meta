[
   {
      "author_association" : "OWNER",
      "body" : "Should this mention in the help message that this is specifically for profiling with `gprof`? E.g. Valgrind is also used quite frequently for profiling.\r\n\r\nAdded @theuni as reviewer because of build system change.",
      "created_at" : "2018-02-15T16:12:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-365976552",
      "id" : 365976552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-15T16:12:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365976552",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\nOn 2/15/2018 8:14 AM, Wladimir J. van der Laan wrote:\n> Should this mention in the help message that this is specifically for \n> profiling with |gprof|? E.g. Valgrind is also used quite frequently for \n> profiling.\n\nYes, it should. I will make the change.\n\nMurray\n\n",
      "created_at" : "2018-02-15T23:58:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-366102724",
      "id" : 366102724,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-15T23:58:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/366102724",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5404807?v=4",
         "events_url" : "https://api.github.com/users/murrayn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murrayn/followers",
         "following_url" : "https://api.github.com/users/murrayn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murrayn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murrayn",
         "id" : 5404807,
         "login" : "murrayn",
         "organizations_url" : "https://api.github.com/users/murrayn/orgs",
         "received_events_url" : "https://api.github.com/users/murrayn/received_events",
         "repos_url" : "https://api.github.com/users/murrayn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murrayn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murrayn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murrayn"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12373#discussion_r168918674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168918674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: alignment",
      "commit_id" : "20032d8400c5392d8b39ca2432fa46e751a593d1",
      "created_at" : "2018-02-17T10:43:11Z",
      "diff_hunk" : "@@ -1330,6 +1348,7 @@ echo \"  with bench    = $use_bench\"\n echo \"  with upnp     = $use_upnp\"\n echo \"  use asm       = $use_asm\"\n echo \"  debug enabled = $enable_debug\"\n+echo \"  profiling enabled = $enable_profiling\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#discussion_r168918674",
      "id" : 168918674,
      "original_commit_id" : "851b9e0cc7b1bc6f2fd6459fe46bedd3ad26a3a9",
      "original_position" : 36,
      "path" : "configure.ac",
      "position" : null,
      "pull_request_review_id" : 97371259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12373",
      "updated_at" : "2018-02-20T10:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168918674",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12373#discussion_r169339950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169339950"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please use AX_CHECK_LINK_FLAG here to make sure that it actually works. Also, let's stash -pg in PROFILE_LDFLAGS rather than LDFLAGS. Otherwise, the rest of the configure checks will be linked with -pg. So something like:\r\n\r\n Something like:\r\n```\r\nAX_CHECK_LINK_FLAG([[-pg]],[PROFILE_LDFLAGS=\"$PROFILE_LDFLAGS -pg\"],[AC_MSG_ERROR(\"profiling requested but not available\"])\r\n```\r\n\r\nThen the same for CXXFLAGS.",
      "commit_id" : "20032d8400c5392d8b39ca2432fa46e751a593d1",
      "created_at" : "2018-02-20T14:46:08Z",
      "diff_hunk" : "@@ -224,6 +231,17 @@ AC_ARG_ENABLE([werror],\n AC_LANG_PUSH([C++])\n AX_CHECK_COMPILE_FLAG([-Werror],[CXXFLAG_WERROR=\"-Werror\"],[CXXFLAG_WERROR=\"\"])\n \n+if test \"x$enable_gprof\" = xyes; then\n+    LDFLAGS=\"$LDFLAGS -pg\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#discussion_r169339950",
      "id" : 169339950,
      "original_commit_id" : "20032d8400c5392d8b39ca2432fa46e751a593d1",
      "original_position" : 19,
      "path" : "configure.ac",
      "position" : 19,
      "pull_request_review_id" : 97849683,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12373",
      "updated_at" : "2018-02-20T14:46:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169339950",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Unsure if this is working with clang; getting some warnings:\r\n\r\n```\r\n $ ./configure LDFLAGS=\"-L${BDB_PREFIX}/lib/\" CPPFLAGS=\"-I${BDB_PREFIX}/include/\" CXXFLAGS=\"${CXXFLAGS}\" --enable-wallet --enable-gprof --with-daemon\r\n[...]\r\nOptions used to compile and link:\r\n  with wallet   = yes\r\n  with gui / qt = yes\r\n    qt version  = 5\r\n    with qr     = auto\r\n  with zmq      = yes\r\n  with test     = yes\r\n  with bench    = yes\r\n  with upnp     = auto\r\n  use asm       = yes\r\n  debug enabled = no\r\n  gprof enabled = yes\r\n  werror        = no\r\n\r\n  target os     = linux\r\n  build os      =\r\n\r\n  CC            = /usr/bin/clang-4.0\r\n  CFLAGS        = -g -O2 -pg\r\n  CPPFLAGS      = -I/home/james/tmp/bitcoin/db4/include/ -DHAVE_BUILD_INFO -D__STDC_FORMAT_MACROS\r\n  CXX           = /usr/bin/clang++-4.0 -std=c++11\r\n  CXXFLAGS      = -std=c++11  -pg\r\n  LDFLAGS       = -L/home/james/tmp/bitcoin/db4/lib/ -pg\r\n  ARFLAGS       = cr\r\n\r\n$ make -j 3\r\n[...]\r\n  CXX      bench/bench_bench_bitcoin-base58.o\r\n  CXX      bench/bench_bench_bitcoin-coin_selection.o\r\n  CXX      qt/qt_bitcoin_qt-bitcoin.o\r\n  CXX      qt/qt_libbitcoinqt_a-bantablemodel.o\r\n  CXX      qt/qt_libbitcoinqt_a-bitcoinaddressvalidator.o\r\n  CXXLD    libbitcoinconsensus.la\r\nclang: warning: argument unused during compilation: '-pg' [-Wunused-command-line-argument]\r\nclang: warning: argument unused during compilation: '-pthread' [-Wunused-command-line-argument]\r\nclang: warning: argument unused during compilation: '-pg' [-Wunused-command-line-argument]\r\nclang: warning: argument unused during compilation: '-pthread' [-Wunused-command-line-argument]\r\n/usr/bin/ar: `u' modifier ignored since `D' is the default (see `U')\r\n[...]\r\n```\r\n\r\nEdit: my mistake, clang doesn't accept `-pg` and (apparently?) doesn't work with gprof. Worth adding an explicit warning about this for clang users?",
      "created_at" : "2018-02-20T17:32:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-367054851",
      "id" : 367054851,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-20T17:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367054851",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jamesob The suggestion above should take care of it.",
      "created_at" : "2018-02-20T18:04:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-367065175",
      "id" : 367065175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-20T18:04:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367065175",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni If this latest change (or any related assignment to LDFLAGS as was done with CXXFLAGS) occurs later in configure.ac, gprof profiling fails. Perhaps there is some order of arguments issue with ld.",
      "created_at" : "2018-02-22T11:38:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-367654697",
      "id" : 367654697,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-22T11:38:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367654697",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5404807?v=4",
         "events_url" : "https://api.github.com/users/murrayn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murrayn/followers",
         "following_url" : "https://api.github.com/users/murrayn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murrayn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murrayn",
         "id" : 5404807,
         "login" : "murrayn",
         "organizations_url" : "https://api.github.com/users/murrayn/orgs",
         "received_events_url" : "https://api.github.com/users/murrayn/received_events",
         "repos_url" : "https://api.github.com/users/murrayn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murrayn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murrayn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murrayn"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@murrayn Please try this on top of yours: https://github.com/theuni/bitcoin/commit/bb91da4122852c7ac3a054d383e9bbb7a1139d4a. Works for me.",
      "created_at" : "2018-02-22T21:41:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-367831729",
      "id" : 367831729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-22T21:41:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367831729",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni This doesn't work for me. It compiles, and the binaries run, but if you look at the gprof output, it is empty. My test case:\r\n\r\n$ make\r\n$ cd src/qt\r\n$ ./bitcoin-qt --help\r\n$ gprof bitcoin-qt\r\n",
      "created_at" : "2018-02-23T00:23:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-367868618",
      "id" : 367868618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-23T00:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367868618",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5404807?v=4",
         "events_url" : "https://api.github.com/users/murrayn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murrayn/followers",
         "following_url" : "https://api.github.com/users/murrayn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murrayn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murrayn",
         "id" : 5404807,
         "login" : "murrayn",
         "organizations_url" : "https://api.github.com/users/murrayn/orgs",
         "received_events_url" : "https://api.github.com/users/murrayn/received_events",
         "repos_url" : "https://api.github.com/users/murrayn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murrayn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murrayn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murrayn"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@murrayn turns out the problem is that -pg is incompatible with -pie. Could you please give https://github.com/theuni/bitcoin/commit/38450db901ce21a2e3c595026583033bb3bf6d78 a try on top of yours? I believe that now accounts for everything.",
      "created_at" : "2018-02-23T23:30:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-368169000",
      "id" : 368169000,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-23T23:30:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/368169000",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Works for me now.\r\n",
      "created_at" : "2018-02-24T03:29:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12373#issuecomment-368195690",
      "id" : 368195690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12373",
      "updated_at" : "2018-02-24T03:29:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/368195690",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5404807?v=4",
         "events_url" : "https://api.github.com/users/murrayn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murrayn/followers",
         "following_url" : "https://api.github.com/users/murrayn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murrayn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murrayn",
         "id" : 5404807,
         "login" : "murrayn",
         "organizations_url" : "https://api.github.com/users/murrayn/orgs",
         "received_events_url" : "https://api.github.com/users/murrayn/received_events",
         "repos_url" : "https://api.github.com/users/murrayn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murrayn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murrayn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murrayn"
      }
   }
]
