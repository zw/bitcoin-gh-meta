{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "**TL;DR: ```importwallet``` ignores the ```reserve=1``` field, thus the keypool of the imported wallet is lgnored. Whenever the user requests a new address in the UI it won't be part of their previous backups of the imported wallet.**\r\n\r\nThe ```dumpwallet``` RPC call produces a human-readable wallet dump which contains all private keys\r\nand for each key its birth date and a field ```change=1``` or ```reserve=1``` or ```label=what the user entered in the UI```.  \r\nI assume ```reserve=1``` means that a private key was part of the keypool, i.e. a pool of keys which are stored **before** the user even requests a new address in the UI to ensure backups are valid for quite some time in the future.\r\n\r\nNow I would expect the ```importwallet``` RPC call to be precisely the inverse operation of the ```dumpwallet``` RPC call just by looking at their names, \"dump\" and \"wallet\" sounds like it includes everything. And the fact that the file is human readable and its content includes information about what is part of the keypool makes it look even more like the keypool is preserved.\r\n\r\nHowever the current code of master, and also the actual behavior of v0.15.1 which I've tested, shows that in fact ```importwallet``` ignores the ```reserve=1``` field:\r\nhttps://github.com/bitcoin/bitcoin/blob/89005ddad1c4a9732ecae47c7de34b4de157f48f/src/wallet/rpcdump.cpp#L570-L581 \r\n\r\nThis means that the imported keys are **not** considered as part of the keypool, and **not** returned to the user when they request a new address. As the dump contains the birth date of the keys they might assume that importing a dump which is much older than the wallet they are importing to would result in the UI returning the dump's keypool addresses first. But they will get addresses of the keypool of the wallet to which they imported the dump, of which they might not have a backup as they consider the dump as their backup. Thus all backups they have created from their walletdump are invalid.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12399/comments",
   "created_at" : "2018-02-09T16:11:31Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12399/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/12399",
   "id" : 295923434,
   "labels" : [
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12399/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 12399,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Potential coin loss due to counterintuitive importwallet RPC behavior",
   "updated_at" : "2018-04-03T22:00:45Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12399",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/78502?v=4",
      "events_url" : "https://api.github.com/users/xor-freenet/events{/privacy}",
      "followers_url" : "https://api.github.com/users/xor-freenet/followers",
      "following_url" : "https://api.github.com/users/xor-freenet/following{/other_user}",
      "gists_url" : "https://api.github.com/users/xor-freenet/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/xor-freenet",
      "id" : 78502,
      "login" : "xor-freenet",
      "organizations_url" : "https://api.github.com/users/xor-freenet/orgs",
      "received_events_url" : "https://api.github.com/users/xor-freenet/received_events",
      "repos_url" : "https://api.github.com/users/xor-freenet/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/xor-freenet/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/xor-freenet/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/xor-freenet"
   }
}
