[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like qt and bitcoind have different init handling (still, ugh) - bitcoind always calls Shutdown() if AppInitMain is called, even when it fails, but qt does not. Several things make the Shutdown() assumption, so it seems like that assert was well-placed to catch a bug...sadly. I dont know our qt stuff well enough to suggest a fix, however.",
      "created_at" : "2018-02-02T21:30:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12337#issuecomment-362713279",
      "id" : 362713279,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12337",
      "updated_at" : "2018-02-02T21:30:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362713279",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt Agreed about aligning bitcoind and bitcoin-qt if possible, rather than throwing in more app-specific behavior.\r\n\r\nI have no experience with qt dev, but that won't stop me from speculating wildly!\r\nFrom IRC discussion:\r\n>\r\n> [13:15:15] \\<cfields\\> BlueMatt: i think i might see the issue\r\n> [13:16:58] \\<cfields\\> BlueMatt: BitcoinApplication connects requestedShutdown to shutdown(), but SplashScreen connects it to close()\r\n> [13:17:32] \\<cfields\\> so it looks like we should re-route that after AppInitMain has started\r\n",
      "created_at" : "2018-02-02T23:03:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12337#issuecomment-362734475",
      "id" : 362734475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12337",
      "updated_at" : "2018-02-02T23:03:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362734475",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I suspected the assertion might've been caused by exiting during a utxo db upgrade. Trying to reproduce in similar conditions, I managed to hit a different assertion on macOS :(\r\n\r\nRun bitcoin-qt -reindex-chainstate, click to exit as soon as possible\r\n\r\n```\r\nAssertion failed: (!hashBlock.IsNull()), function BatchWrite, file txdb.cpp, line 90.\r\n* thread #8: tid = 0x1daa31, 0x00007fff93155f06 libsystem_kernel.dylib`__pthread_kill + 10, name = 'bitcoin-shutoff', stop reason = signal SIGABRT\r\n  frame #0: 0x00007fff93155f06 libsystem_kernel.dylib`__pthread_kill + 10\r\n    frame #1: 0x00007fff972154ec libsystem_pthread.dylib`pthread_kill + 90\r\n    frame #2: 0x00007fff8c65c6df libsystem_c.dylib`abort + 129\r\n    frame #3: 0x00007fff8c623dd8 libsystem_c.dylib`__assert_rtn + 321\r\n    frame #4: 0x00000001002b5c57 bitcoin-qt`CCoinsViewDB::BatchWrite(this=<unavailable>, mapCoins=size=0, hashBlock=<unavailable>) + 4039 at txdb.cpp:90\r\n    frame #5: 0x0000000100437bf4 bitcoin-qt`CCoinsViewCache::Flush(this=0x000000011e150640) + 52 at coins.cpp:204\r\n    frame #6: 0x00000001002e2c4b bitcoin-qt`FlushStateToDisk(chainparams=<unavailable>, state=0x000070000029f280, mode=<unavailable>, nManualPruneHeight=<unavailable>) + 1403 at validation.cpp:2104\r\n    frame #7: 0x00000001002e2698 bitcoin-qt`FlushStateToDisk() + 56 at validation.cpp:2123\r\n    frame #8: 0x0000000100168857 bitcoin-qt`Shutdown() + 1143 at init.cpp:228\r\n    frame #9: 0x000000010000845d bitcoin-qt`BitcoinCore::shutdown(this=0x000000010ac55530) + 349 at bitcoin.cpp:315\r\n    frame #10: 0x000000010212c18c QtCore`QObject::event(QEvent*) + 156\r\n    frame #11: 0x00000001012ad97b QtWidgets`QApplicationPrivate::notify_helper(QObject*, QEvent*) + 251\r\n    frame #12: 0x00000001012b02de QtWidgets`QApplication::notify(QObject*, QEvent*) + 5630\r\n    frame #13: 0x0000000102104212 QtCore`QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) + 1058\r\n    frame #14: 0x00000001021537db QtCore`QEventDispatcherUNIX::processEvents(QFlags<QEventLoop::ProcessEventsFlag>) + 59\r\n    frame #15: 0x0000000102100c1c QtCore`QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>) + 412\r\n    frame #16: 0x0000000101f5607e QtCore`QThread::exec() + 110\r\n    frame #17: 0x0000000101f59c02 QtCore`QThreadPrivate::start(void*) + 338\r\n    frame #18: 0x00007fff9721299d libsystem_pthread.dylib`_pthread_body + 131\r\n    frame #19: 0x00007fff9721291a libsystem_pthread.dylib`_pthread_start + 168\r\n    frame #20: 0x00007fff97210351 libsystem_pthread.dylib`thread_start + 13\r\n```\r\n",
      "created_at" : "2018-02-04T22:12:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12337#issuecomment-362944474",
      "id" : 362944474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12337",
      "updated_at" : "2018-02-04T22:12:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362944474",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok, I think I see what's going on.\r\n\r\n- Closing the window kicks off the shutdown process.\r\n- CCoinsViewDB::Upgrade() returns false if ShutdownRequested(), which is now the case.\r\n- That causes AppInitMain() to return false\r\n- The shutdown process is still going\r\n\r\nFrom what I can tell, that means that there's a race between the quit() signaled by stopThread, and the one in the failure case of initializeResult. Maybe it's possible for requestedInitialize to be emitted before coreThread is even started?\r\n\r\nI'm really out of my depth with qt. @jonasschnelli halp plz :)",
      "created_at" : "2018-02-06T02:28:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12337#issuecomment-363289898",
      "id" : 363289898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12337",
      "updated_at" : "2018-02-06T02:28:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363289898",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@theuni Good catch, thanks for testing!\r\n\r\nThat said - I'm moving this to the 0.16.1 milestone as it is rare enough, and only an assertion error at shutdown. We could include the fix if we need an rc2, but this shouldn't be a blocker.",
      "created_at" : "2018-02-06T10:21:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12337#issuecomment-363377543",
      "id" : 363377543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12337",
      "updated_at" : "2018-02-06T10:21:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363377543",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree with @laanwj. I'll try to find a solution for this...",
      "created_at" : "2018-02-07T06:18:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12337#issuecomment-363669172",
      "id" : 363669172,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12337",
      "updated_at" : "2018-02-07T06:18:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363669172",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've just finished a depends build of 0.16.1 (224a41d) on a Windows 10 VM. Seeing the same error. I used WSL 18.04.\r\n<img width=\"648\" alt=\"screenshot 2018-05-28 at 10 13 59 pm\" src=\"https://user-images.githubusercontent.com/863730/40618658-ca66a55e-62c4-11e8-8354-f3471c1fa113.png\">\r\n",
      "created_at" : "2018-05-28T14:17:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12337#issuecomment-392539161",
      "id" : 392539161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12337",
      "updated_at" : "2018-05-28T14:17:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/392539161",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
