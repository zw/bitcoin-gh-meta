[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28950).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1864179391), [glozow](https://github.com/bitcoin/bitcoin/pull/28950#pullrequestreview-1790751210), [kashifs](https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1869114446) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28984](https://github.com/bitcoin/bitcoin/pull/28984) (Cluster size 2 package rbf by instagibbs)\n* [#28948](https://github.com/bitcoin/bitcoin/pull/28948) (v3 transaction policy for anti-pinning by glozow)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-11-27T20:24:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1828535839",
      "id" : 1828535839,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28950",
      "node_id" : "IC_kwDOABII585s_T4f",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828535839/reactions"
      },
      "updated_at" : "2024-01-26T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828535839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased on https://github.com/bitcoin/bitcoin/pull/28848 and ready for review",
      "created_at" : "2023-12-01T17:46:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1836530146",
      "id" : 1836530146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28950",
      "node_id" : "IC_kwDOABII585tdzni",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1836530146/reactions"
      },
      "updated_at" : "2023-12-01T17:46:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1836530146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2023-12-20T09:56:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1864179391",
      "id" : 1864179391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28950",
      "node_id" : "IC_kwDOABII585vHR6_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864179391/reactions"
      },
      "updated_at" : "2023-12-20T09:56:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864179391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nI compiled from source, read through each modified line of code, ran the automated tests, and modified `test_maxfeerate_maxburn_submitpackage` test to check `maxfeerate` and `maxburnamount` seperately ",
      "created_at" : "2023-12-25T20:52:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1869114446",
      "id" : 1869114446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28950",
      "node_id" : "IC_kwDOABII585vaGxO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1869114446/reactions"
      },
      "updated_at" : "2023-12-25T20:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1869114446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1489460?v=4",
         "events_url" : "https://api.github.com/users/kashifs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kashifs/followers",
         "following_url" : "https://api.github.com/users/kashifs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kashifs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kashifs",
         "id" : 1489460,
         "login" : "kashifs",
         "node_id" : "MDQ6VXNlcjE0ODk0NjA=",
         "organizations_url" : "https://api.github.com/users/kashifs/orgs",
         "received_events_url" : "https://api.github.com/users/kashifs/received_events",
         "repos_url" : "https://api.github.com/users/kashifs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kashifs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kashifs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kashifs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444397171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444397171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should we test `maxfeerate` and `maxburnamount` for `testmempoolaccept` with a package also?",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-08T10:16:11Z",
      "diff_hunk" : "@@ -183,7 +183,7 @@ static RPCHelpMan testmempoolaccept()\n             Chainstate& chainstate = chainman.ActiveChainstate();\n             const PackageMempoolAcceptResult package_result = [&] {\n                 LOCK(::cs_main);\n-                if (txns.size() > 1) return ProcessNewPackage(chainstate, mempool, txns, /*test_accept=*/true);\n+                if (txns.size() > 1) return ProcessNewPackage(chainstate, mempool, txns, /*test_accept=*/true, /*max_sane_feerate=*/{});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444397171",
      "id" : 1444397171,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585WF8Bz",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 14,
      "pull_request_review_id" : 1808632678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444397171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-09T12:29:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444397171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444454903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444454903"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My understanding of package submission is that a child with unconfirmed parents is bundled together as a package for incentive compatibility. Should this instead check the package fee rate against `maxfeerate`?\r\n\r\nIf I understand correctly, currently, we are checking the package transaction fee rate individually against `maxfeerate`. The child transactions might be greater than the `maxfeerate`, but as a package might not be. In this case, we might reject the child transactions and accept the subpackage, which might not be incentive compatible at the current fee estimates.\r\n\r\nFor example, suppose we want to fee bump tx A, with the arrangement below. `maxfeerate` is set to 50 s/vb.\r\n\r\n```md\r\n               All txs are 10vb\r\n               first value is absolute fee\r\n               second value is ancestor score\r\n               âââââââââââââ\r\n               â  A (10s)  â\r\n               â 1 s/vb    â\r\n               âââââââââââââ\r\n                     â\r\n                     â¼\r\n               âââââââââââââ\r\n               â  B (90s)  â\r\n               â 5 s/vb    â\r\n               âââââââââââââ\r\n                     â\r\n                     â¼\r\n               ââââââââââââââ\r\n               â  C (1000s) â\r\n               â 36.6 s/vb  â\r\n               ââââââââââââââ\r\n\r\n```\r\nIf `maxfeerate` is 50s/vb we will accept A-B and reject C because it's fee rate  is 100s/vb.\r\nBut if we are evaluating maxfeerate against package fee rate we will accept the whole package A-B-C\r\n",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-08T11:02:20Z",
      "diff_hunk" : "@@ -1295,6 +1312,15 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n             return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n+\n+        // Individual modified feerate exceeded caller-deemed \"sane\" max; abort",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444454903",
      "id" : 1444454903,
      "line" : 1316,
      "node_id" : "PRRC_kwDOABII585WGKH3",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 1316,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 89,
      "pull_request_review_id" : 1808632678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444454903/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-08T15:34:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444454903",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444456650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444456650"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should we just enable passing `maxfeerate` and `maxburnamount` as a config variables since it is used three RPC's now `sendrawtransaction`, `testmempoolaccept` and `submitpackage`, downstream might prefer this?",
      "commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "created_at" : "2024-01-08T11:04:08Z",
      "diff_hunk" : "@@ -127,6 +127,8 @@ static const CRPCConvertParam vRPCConvertParams[] =\n     { \"testmempoolaccept\", 0, \"rawtxs\" },\n     { \"testmempoolaccept\", 1, \"maxfeerate\" },\n     { \"submitpackage\", 0, \"package\" },\n+    { \"submitpackage\", 1, \"maxfeerate\" },\n+    { \"submitpackage\", 2, \"maxburnamount\" },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444456650",
      "id" : 1444456650,
      "line" : 131,
      "node_id" : "PRRC_kwDOABII585WGKjK",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 131,
      "original_position" : 5,
      "original_start_line" : 130,
      "path" : "src/rpc/client.cpp",
      "position" : 5,
      "pull_request_review_id" : 1808632678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444456650/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 130,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-08T11:15:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444456650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444461653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444461653"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We did not document this anywhere but the default behavior  if `maxburnamount` is not passed  we are rejecting the package if there is any transactions with unspendable output greater than 0.\r\nMaybe indicate it in the `RPCHelpMan` of `maxburnamount`?\r\n\r\n---\r\n\r\nIts also not indicated for `sendrawtransaction`.",
      "commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "created_at" : "2024-01-08T11:09:26Z",
      "diff_hunk" : "@@ -867,6 +875,19 @@ static RPCHelpMan submitpackage()\n                                    \"Array must contain between 1 and \" + ToString(MAX_PACKAGE_COUNT) + \" transactions.\");\n             }\n \n+            // Fee check needs to be run with chainstate and package context\n+            const CFeeRate max_raw_tx_fee_rate = request.params[1].isNull() ?\n+                                                     DEFAULT_MAX_RAW_TX_FEE_RATE :\n+                                                     CFeeRate(AmountFromValue(request.params[1]));\n+            std::optional<CFeeRate> max_sane_feerate{max_raw_tx_fee_rate};\n+            // 0-value is special; it's mapped to no sanity check\n+            if (max_raw_tx_fee_rate == CFeeRate(0)) {\n+                max_sane_feerate = std::nullopt;\n+            }\n+\n+            // Burn sanity check is run with no context\n+            const CAmount max_burn_amount = request.params[2].isNull() ? 0 : AmountFromValue(request.params[2]);\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444461653",
      "id" : 1444461653,
      "line" : 890,
      "node_id" : "PRRC_kwDOABII585WGLxV",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 890,
      "original_position" : 40,
      "original_start_line" : 889,
      "path" : "src/rpc/mempool.cpp",
      "position" : 40,
      "pull_request_review_id" : 1808632678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444461653/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 889,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-08T11:15:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444461653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444464488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444464488"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To turn off for maxfeerate you should pass 0 fee rate, you cant turn off the restriction of `maxburnamount`\r\nnit: maybe reword to relax?\r\n```suggestion\r\n# Relax the restrictions and send it; parent gets through as own subpackage\r\n```",
      "commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "created_at" : "2024-01-08T11:12:20Z",
      "diff_hunk" : "@@ -356,5 +357,33 @@ def test_submitpackage(self):\n         assert_equal(res[\"tx-results\"][sec_wtxid][\"error\"], \"version\")\n         peer.wait_for_broadcast([first_wtxid])\n \n+    def test_maxfeerate_maxburn_submitpackage(self):\n+        node = self.nodes[0]\n+        # clear mempool\n+        deterministic_address = node.get_deterministic_priv_key().address\n+        self.generatetoaddress(node, 1, deterministic_address)\n+\n+        self.log.info(\"Submitpackage maxfeerate arg testing\")\n+        chained_txns = self.wallet.create_self_transfer_chain(chain_length=2)\n+        chain_hex = [t[\"hex\"] for t in chained_txns]\n+        pkg_result = node.submitpackage(chain_hex, 0.00000001)\n+        assert_equal(pkg_result[\"tx-results\"][chained_txns[0][\"wtxid\"]][\"error\"], \"max sane feerate exceeded\")\n+        assert_equal(pkg_result[\"tx-results\"][chained_txns[1][\"wtxid\"]][\"error\"], \"bad-txns-inputs-missingorspent\")\n+        assert_equal(node.getrawmempool(), [])\n+\n+        self.log.info(\"Submitpackage maxburnamount arg testing\")\n+        tx = tx_from_hex(chain_hex[1])\n+        tx.vout[-1].scriptPubKey = b'a' * 10001 # scriptPubKey bigger than 10k IsUnspendable\n+        chain_hex = [chain_hex[0], tx.serialize().hex()]\n+        # burn test is run before any package evaluation; nothing makes it in and we get broader exception\n+        assert_raises_rpc_error(-25, \"Unspendable output exceeds maximum configured by user\", node.submitpackage, chain_hex, 0, 0.1)\n+        assert_equal(node.getrawmempool(), [])\n+\n+        # Turn off restrictions for both and send it; parent gets through as own subpackage",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444464488",
      "id" : 1444464488,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII585WGMdo",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 382,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "test/functional/rpc_packages.py",
      "position" : 34,
      "pull_request_review_id" : 1808632678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444464488/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-08T11:12:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444464488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444825855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444825855"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`testmempoolaccept` is basically shoving all transactions, whether or not they're a pacakge, into `AcceptMultipleTransactions`.\r\n\r\nI'm not sure it makes sense due to this.",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-08T15:25:27Z",
      "diff_hunk" : "@@ -183,7 +183,7 @@ static RPCHelpMan testmempoolaccept()\n             Chainstate& chainstate = chainman.ActiveChainstate();\n             const PackageMempoolAcceptResult package_result = [&] {\n                 LOCK(::cs_main);\n-                if (txns.size() > 1) return ProcessNewPackage(chainstate, mempool, txns, /*test_accept=*/true);\n+                if (txns.size() > 1) return ProcessNewPackage(chainstate, mempool, txns, /*test_accept=*/true, /*max_sane_feerate=*/{});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444825855",
      "id" : 1444825855,
      "in_reply_to_id" : 1444397171,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585WHkr_",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 14,
      "pull_request_review_id" : 1809352065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444825855/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-08T15:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444825855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444836670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444836670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ignoring topo restrictions in `AcceptPackage` since `C` should have `A` as a direct ancestor, \r\n\r\n> The child transactions might be greater than the maxfeerate, but as a package might not be. In this case, we might reject the child transactions and accept the subpackage, which might not be incentive compatible at the current fee estimates.\r\n\r\nThis is prior to any relay, of course restricting feerates is incentive compatible once published on the open network!\r\n\r\n> If maxfeerate is 50s/vb we will accept A-B and reject C because it's ancestor score is 100s/vb.\r\nBut if we are evaluating maxfeerate against package fee rate we will accept the whole package A-B-C\r\n\r\nAssuming you meant C's *feerate* is 100 sat/vbyte: If mempool minfee is 5 sat/vbyte, A+B would be accepted(as they'd be evaluated in their own subpackage already), then C evaluated on its own `AcceptSingleTransaction`, and rejected.\r\n\r\nIn a post-cluster mempool world, this would likely be reduced to evaluating chunks only, and so you'd look at A+B+C only, and reject the whole thing.",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-08T15:32:18Z",
      "diff_hunk" : "@@ -1295,6 +1312,15 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n             return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n+\n+        // Individual modified feerate exceeded caller-deemed \"sane\" max; abort",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444836670",
      "id" : 1444836670,
      "in_reply_to_id" : 1444454903,
      "line" : 1316,
      "node_id" : "PRRC_kwDOABII585WHnU-",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 1316,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 89,
      "pull_request_review_id" : 1809367140,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444836670/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-08T15:32:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444836670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444841601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444841601"
         }
      },
      "author_association" : "MEMBER",
      "body" : "startup config? Maybe? Could open an issue",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-08T15:35:16Z",
      "diff_hunk" : "@@ -127,6 +127,8 @@ static const CRPCConvertParam vRPCConvertParams[] =\n     { \"testmempoolaccept\", 0, \"rawtxs\" },\n     { \"testmempoolaccept\", 1, \"maxfeerate\" },\n     { \"submitpackage\", 0, \"package\" },\n+    { \"submitpackage\", 1, \"maxfeerate\" },\n+    { \"submitpackage\", 2, \"maxburnamount\" },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444841601",
      "id" : 1444841601,
      "in_reply_to_id" : 1444456650,
      "line" : 131,
      "node_id" : "PRRC_kwDOABII585WHoiB",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 131,
      "original_position" : 5,
      "original_start_line" : 130,
      "path" : "src/rpc/client.cpp",
      "position" : 5,
      "pull_request_review_id" : 1809374114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444841601/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 130,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-08T15:35:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444841601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444942956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444942956"
         }
      },
      "author_association" : "MEMBER",
      "body" : "added a mention of the default being 0",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-08T16:20:05Z",
      "diff_hunk" : "@@ -867,6 +875,19 @@ static RPCHelpMan submitpackage()\n                                    \"Array must contain between 1 and \" + ToString(MAX_PACKAGE_COUNT) + \" transactions.\");\n             }\n \n+            // Fee check needs to be run with chainstate and package context\n+            const CFeeRate max_raw_tx_fee_rate = request.params[1].isNull() ?\n+                                                     DEFAULT_MAX_RAW_TX_FEE_RATE :\n+                                                     CFeeRate(AmountFromValue(request.params[1]));\n+            std::optional<CFeeRate> max_sane_feerate{max_raw_tx_fee_rate};\n+            // 0-value is special; it's mapped to no sanity check\n+            if (max_raw_tx_fee_rate == CFeeRate(0)) {\n+                max_sane_feerate = std::nullopt;\n+            }\n+\n+            // Burn sanity check is run with no context\n+            const CAmount max_burn_amount = request.params[2].isNull() ? 0 : AmountFromValue(request.params[2]);\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444942956",
      "id" : 1444942956,
      "in_reply_to_id" : 1444461653,
      "line" : 890,
      "node_id" : "PRRC_kwDOABII585WIBRs",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 890,
      "original_position" : 40,
      "original_start_line" : 889,
      "path" : "src/rpc/mempool.cpp",
      "position" : 49,
      "pull_request_review_id" : 1809526473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444942956/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 889,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-08T16:20:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444942956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444943017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444943017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "taken",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-08T16:20:08Z",
      "diff_hunk" : "@@ -356,5 +357,33 @@ def test_submitpackage(self):\n         assert_equal(res[\"tx-results\"][sec_wtxid][\"error\"], \"version\")\n         peer.wait_for_broadcast([first_wtxid])\n \n+    def test_maxfeerate_maxburn_submitpackage(self):\n+        node = self.nodes[0]\n+        # clear mempool\n+        deterministic_address = node.get_deterministic_priv_key().address\n+        self.generatetoaddress(node, 1, deterministic_address)\n+\n+        self.log.info(\"Submitpackage maxfeerate arg testing\")\n+        chained_txns = self.wallet.create_self_transfer_chain(chain_length=2)\n+        chain_hex = [t[\"hex\"] for t in chained_txns]\n+        pkg_result = node.submitpackage(chain_hex, 0.00000001)\n+        assert_equal(pkg_result[\"tx-results\"][chained_txns[0][\"wtxid\"]][\"error\"], \"max sane feerate exceeded\")\n+        assert_equal(pkg_result[\"tx-results\"][chained_txns[1][\"wtxid\"]][\"error\"], \"bad-txns-inputs-missingorspent\")\n+        assert_equal(node.getrawmempool(), [])\n+\n+        self.log.info(\"Submitpackage maxburnamount arg testing\")\n+        tx = tx_from_hex(chain_hex[1])\n+        tx.vout[-1].scriptPubKey = b'a' * 10001 # scriptPubKey bigger than 10k IsUnspendable\n+        chain_hex = [chain_hex[0], tx.serialize().hex()]\n+        # burn test is run before any package evaluation; nothing makes it in and we get broader exception\n+        assert_raises_rpc_error(-25, \"Unspendable output exceeds maximum configured by user\", node.submitpackage, chain_hex, 0, 0.1)\n+        assert_equal(node.getrawmempool(), [])\n+\n+        # Turn off restrictions for both and send it; parent gets through as own subpackage",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1444943017",
      "id" : 1444943017,
      "in_reply_to_id" : 1444464488,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WIBSp",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 382,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "test/functional/rpc_packages.py",
      "position" : null,
      "pull_request_review_id" : 1809526549,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444943017/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-08T16:20:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1444943017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1447190456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447190456"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">Assuming you meant C's feerate is 100 sat/vbyte\r\n\r\nYes C fee rated is 100s/vb, edited thanks.\r\n\r\n>This is prior to any relay, of course restricting feerates is incentive compatible once published on the open network\r\n\r\nDo you mean incentive incompatible here? because in the given example if C is rejected (A,B) will be  added to the mempool with mining score of 5s/vb which is lower than whats intended.\r\n",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-10T10:38:41Z",
      "diff_hunk" : "@@ -1295,6 +1312,15 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n             return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n+\n+        // Individual modified feerate exceeded caller-deemed \"sane\" max; abort",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1447190456",
      "id" : 1447190456,
      "in_reply_to_id" : 1444454903,
      "line" : 1316,
      "node_id" : "PRRC_kwDOABII585WQl-4",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 1316,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 89,
      "pull_request_review_id" : 1812909517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447190456/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-10T10:39:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447190456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1447202424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447202424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in https://github.com/bitcoin/bitcoin/issues/29217",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-10T10:49:16Z",
      "diff_hunk" : "@@ -127,6 +127,8 @@ static const CRPCConvertParam vRPCConvertParams[] =\n     { \"testmempoolaccept\", 0, \"rawtxs\" },\n     { \"testmempoolaccept\", 1, \"maxfeerate\" },\n     { \"submitpackage\", 0, \"package\" },\n+    { \"submitpackage\", 1, \"maxfeerate\" },\n+    { \"submitpackage\", 2, \"maxburnamount\" },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1447202424",
      "id" : 1447202424,
      "in_reply_to_id" : 1444456650,
      "line" : 131,
      "node_id" : "PRRC_kwDOABII585WQo54",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 131,
      "original_position" : 5,
      "original_start_line" : 130,
      "path" : "src/rpc/client.cpp",
      "position" : 5,
      "pull_request_review_id" : 1812928142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447202424/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 130,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-10T10:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447202424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1447466859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447466859"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Do you mean incentive incompatible here? because in the given example if C is rejected (A,B) will be added to the mempool with mining score of 5s/vb which is lower than whats intended.\r\n\r\ncorrect, typo",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-01-10T14:32:26Z",
      "diff_hunk" : "@@ -1295,6 +1312,15 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n             return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n+\n+        // Individual modified feerate exceeded caller-deemed \"sane\" max; abort",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1447466859",
      "id" : 1447466859,
      "in_reply_to_id" : 1444454903,
      "line" : 1316,
      "node_id" : "PRRC_kwDOABII585WRpdr",
      "original_commit_id" : "e650eed78881e803a546d07f2476db4ba0ad7879",
      "original_line" : 1316,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 89,
      "pull_request_review_id" : 1813365641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447466859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-10T14:32:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447466859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't this check a little bit later than ideal? Wouldn't it make more sense to check both maxfeerate and maxburnamount as part of `signrawtransactionwith*` and `walletprocesspsbt` so that you never create a tx that can lose your money, rather than creating it and hoping that it won't find its way onto the network via some method other than rpc with default args?",
      "created_at" : "2024-01-30T10:11:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1916502753",
      "id" : 1916502753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28950",
      "node_id" : "IC_kwDOABII585yO4Lh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1916502753/reactions"
      },
      "updated_at" : "2024-01-30T10:11:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1916502753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Isn't this check a little bit later than ideal? Wouldn't it make more sense to check both maxfeerate and maxburnamount as part of `signrawtransactionwith*` and `walletprocesspsbt` so that you never create a tx that can lose your money\r\n\r\nI think it's indeed good to have that, but isn't it still possible that transactions submitted via `submitpackage` were created somewhere else?",
      "created_at" : "2024-01-30T10:42:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1916562018",
      "id" : 1916562018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28950",
      "node_id" : "IC_kwDOABII585yPGpi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1916562018/reactions"
      },
      "updated_at" : "2024-01-30T10:42:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1916562018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR is essentially focusing on the max fee check during submission to local mempool feature only. Wallet features to reduce accidental overpayment are also welcome, and may already exist in some forms?",
      "created_at" : "2024-01-30T13:21:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#issuecomment-1916837538",
      "id" : 1916837538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28950",
      "node_id" : "IC_kwDOABII585yQJ6i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1916837538/reactions"
      },
      "updated_at" : "2024-01-30T13:21:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1916837538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476265685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476265685"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I think calling this `m_client_maxfeerate` would make more sense. Don't think \"sane\" tells us very much, and it'd be good to specify that this comes from the client. Generally I don't think \"sanity check\" is the right term for these, just \"check,\" as the user can provide a strange or no value and we don't judge whether it makes sense or not.",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-02-02T16:18:29Z",
      "diff_hunk" : "@@ -464,6 +464,11 @@ class MemPoolAccept\n          * policies such as mempool min fee and min relay fee.\n          */\n         const bool m_package_feerates;\n+        /** Used for local submission of transactions to catch \"absurd\" fees\n+         * due to fee miscalulation by wallets. std:nullopt implies unset, allowing any feerates.\n+         * Any individual transaction failing this check causes immediate failure.\n+         */\n+        const std::optional<CFeeRate> m_max_sane_feerate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476265685",
      "id" : 1476265685,
      "line" : 471,
      "node_id" : "PRRC_kwDOABII585X_gbV",
      "original_commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "original_line" : 471,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 8,
      "pull_request_review_id" : 1859629056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476265685/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T16:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476265685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476268224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476268224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Probably good time to make a `DEFAULT_MAX_BURN_AMOUNT{0}`",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-02-02T16:20:19Z",
      "diff_hunk" : "@@ -828,6 +828,14 @@ static RPCHelpMan submitpackage()\n                     {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n                 },\n             },\n+            {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(DEFAULT_MAX_RAW_TX_FEE_RATE.GetFeePerK())},\n+             \"Reject transactions whose fee rate is higher than the specified value, expressed in \" + CURRENCY_UNIT +\n+                 \"/kvB.\\nSet to 0 to accept any fee rate.\"},\n+            {\"maxburnamount\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(0)},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476268224",
      "id" : 1476268224,
      "line" : 834,
      "node_id" : "PRRC_kwDOABII585X_hDA",
      "original_commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "original_line" : 834,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 25,
      "pull_request_review_id" : 1859629056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476268224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T16:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476268224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476276883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476276883"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I can see why we'd check individual feerate instead of chunk feerate, since we don't currently check whether there's a real CPFP happening and which transactions are in the chunk containing a CPFP. Could add a TODO item explaining this?",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-02-02T16:26:41Z",
      "diff_hunk" : "@@ -1295,6 +1312,15 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n             return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n+\n+        // Individual modified feerate exceeded caller-deemed \"sane\" max; abort\n+        if (args.m_max_sane_feerate && CFeeRate(ws.m_modified_fees, ws.m_vsize) > args.m_max_sane_feerate.value()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476276883",
      "id" : 1476276883,
      "line" : 1317,
      "node_id" : "PRRC_kwDOABII585X_jKT",
      "original_commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "original_line" : 1317,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 90,
      "pull_request_review_id" : 1859629056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476276883/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T16:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476276883",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476281814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476281814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe instead of magic number, calculate/specify the parent feerate and make `maxfeerate` a little bit less?",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-02-02T16:30:42Z",
      "diff_hunk" : "@@ -356,5 +357,33 @@ def test_submitpackage(self):\n         assert_equal(res[\"tx-results\"][sec_wtxid][\"error\"], \"version\")\n         peer.wait_for_broadcast([first_wtxid])\n \n+    def test_maxfeerate_maxburn_submitpackage(self):\n+        node = self.nodes[0]\n+        # clear mempool\n+        deterministic_address = node.get_deterministic_priv_key().address\n+        self.generatetoaddress(node, 1, deterministic_address)\n+\n+        self.log.info(\"Submitpackage maxfeerate arg testing\")\n+        chained_txns = self.wallet.create_self_transfer_chain(chain_length=2)\n+        chain_hex = [t[\"hex\"] for t in chained_txns]\n+        pkg_result = node.submitpackage(chain_hex, 0.00000001)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476281814",
      "id" : 1476281814,
      "line" : 369,
      "node_id" : "PRRC_kwDOABII585X_kXW",
      "original_commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "original_line" : 369,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/rpc_packages.py",
      "position" : 21,
      "pull_request_review_id" : 1859629056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476281814/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T16:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476281814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476284777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476284777"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Similarly, maybe specify `maxburnamount` as == the output amount? Imo a test should fail if I switch the check from `>` to `>=`.",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-02-02T16:32:51Z",
      "diff_hunk" : "@@ -356,5 +357,33 @@ def test_submitpackage(self):\n         assert_equal(res[\"tx-results\"][sec_wtxid][\"error\"], \"version\")\n         peer.wait_for_broadcast([first_wtxid])\n \n+    def test_maxfeerate_maxburn_submitpackage(self):\n+        node = self.nodes[0]\n+        # clear mempool\n+        deterministic_address = node.get_deterministic_priv_key().address\n+        self.generatetoaddress(node, 1, deterministic_address)\n+\n+        self.log.info(\"Submitpackage maxfeerate arg testing\")\n+        chained_txns = self.wallet.create_self_transfer_chain(chain_length=2)\n+        chain_hex = [t[\"hex\"] for t in chained_txns]\n+        pkg_result = node.submitpackage(chain_hex, 0.00000001)\n+        assert_equal(pkg_result[\"tx-results\"][chained_txns[0][\"wtxid\"]][\"error\"], \"max sane feerate exceeded\")\n+        assert_equal(pkg_result[\"tx-results\"][chained_txns[1][\"wtxid\"]][\"error\"], \"bad-txns-inputs-missingorspent\")\n+        assert_equal(node.getrawmempool(), [])\n+\n+        self.log.info(\"Submitpackage maxburnamount arg testing\")\n+        tx = tx_from_hex(chain_hex[1])\n+        tx.vout[-1].scriptPubKey = b'a' * 10001 # scriptPubKey bigger than 10k IsUnspendable\n+        chain_hex = [chain_hex[0], tx.serialize().hex()]\n+        # burn test is run before any package evaluation; nothing makes it in and we get broader exception\n+        assert_raises_rpc_error(-25, \"Unspendable output exceeds maximum configured by user\", node.submitpackage, chain_hex, 0, 0.1)\n+        assert_equal(node.getrawmempool(), [])\n+\n+        # Relax the restrictions for both and send it; parent gets through as own subpackage\n+        pkg_result = node.submitpackage(chain_hex, 50, 50)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476284777",
      "id" : 1476284777,
      "line" : 383,
      "node_id" : "PRRC_kwDOABII585X_lFp",
      "original_commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "original_line" : 383,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/rpc_packages.py",
      "position" : 35,
      "pull_request_review_id" : 1859629056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476284777/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T16:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476284777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476287480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476287480"
         }
      },
      "author_association" : "MEMBER",
      "body" : "random newline?",
      "commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "created_at" : "2024-02-02T16:35:22Z",
      "diff_hunk" : "@@ -875,16 +896,24 @@ static RPCHelpMan submitpackage()\n                     throw JSONRPCError(RPC_DESERIALIZATION_ERROR,\n                                        \"TX decode failed: \" + rawtx.get_str() + \" Make sure the tx has at least one input.\");\n                 }\n+\n+                for (const auto& out : mtx.vout) {\n+                    if((out.scriptPubKey.IsUnspendable() || !out.scriptPubKey.HasValidOps()) && out.nValue > max_burn_amount) {\n+                        throw JSONRPCTransactionError(TransactionError::MAX_BURN_EXCEEDED);\n+                    }\n+                }\n+\n                 txns.emplace_back(MakeTransactionRef(std::move(mtx)));\n             }\n             if (!IsChildWithParentsTree(txns)) {\n                 throw JSONRPCTransactionError(TransactionError::INVALID_PACKAGE, \"package topology disallowed. not child-with-parents or parents depend on each other.\");\n             }\n \n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28950#discussion_r1476287480",
      "id" : 1476287480,
      "line" : 912,
      "node_id" : "PRRC_kwDOABII585X_lv4",
      "original_commit_id" : "bf6fbea9794db5e8d0adce8ff6182574808cea54",
      "original_line" : 912,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 70,
      "pull_request_review_id" : 1859629056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28950",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476287480/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T16:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476287480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
