[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28984).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29001](https://github.com/bitcoin/bitcoin/pull/29001) (Ephemeral Anchors by instagibbs)\n* [#28960](https://github.com/bitcoin/bitcoin/pull/28960) (kernel: Remove dependency on CScheduler by TheCharlatan)\n* [#28950](https://github.com/bitcoin/bitcoin/pull/28950) (RPC: Add maxfeerate and maxburnamount args to submitpackage by instagibbs)\n* [#28948](https://github.com/bitcoin/bitcoin/pull/28948) (v3 transaction policy for anti-pinning by glozow)\n* [#28886](https://github.com/bitcoin/bitcoin/pull/28886) (refactor: Replace sets of txiter with CTxMemPoolEntryRefs by TheCharlatan)\n* [#28676](https://github.com/bitcoin/bitcoin/pull/28676) ([WIP] Cluster mempool implementation by sdaftuar)\n* [#27432](https://github.com/bitcoin/bitcoin/pull/27432) (contrib: add tool to convert compact-serialized UTXO set to SQLite database by theStack)\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-12-01T22:12:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#issuecomment-1836848803",
      "id" : 1836848803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28984",
      "node_id" : "IC_kwDOABII585tfBaj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1836848803/reactions"
      },
      "updated_at" : "2023-12-07T20:09:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1836848803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added this to the tracking issue",
      "created_at" : "2023-12-04T04:54:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#issuecomment-1837840851",
      "id" : 1837840851,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28984",
      "node_id" : "IC_kwDOABII585tiznT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1837840851/reactions"
      },
      "updated_at" : "2023-12-04T04:54:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1837840851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1414385368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414385368"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this can't be hit yet; post-v3 it can. I can remove this, or leave a note, or both. It makes some package rbfs more useful\r\n\r\n(edit: it's used in https://github.com/bitcoin/bitcoin/pull/29001 functional tests )",
      "commit_id" : "89beb714bb44e74ff785d3f0ae32684d737557de",
      "created_at" : "2023-12-04T19:26:16Z",
      "diff_hunk" : "@@ -181,3 +181,36 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        // Note that this assumes no in-mempool ancestors\n+        const CFeeRate replacement_miner_score(replacement_fees, replacement_vsize);\n+\n+        for (const auto& entry : direct_conflicts) {\n+            const bool conflict_is_v3{entry->GetSharedTx()->nVersion == 3};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1414385368",
      "id" : 1414385368,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585UTc7Y",
      "original_commit_id" : "a6730af0678255d229eebf2cc31fcba9b35e1fd5",
      "original_line" : 194,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : null,
      "pull_request_review_id" : 1763228824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414385368/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-08T15:28:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414385368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1415812593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415812593"
         }
      },
      "author_association" : "MEMBER",
      "body" : "commit message is old; will fix",
      "commit_id" : "be9d1634a9024e0b652cb77b89b856f25472fe68",
      "created_at" : "2023-12-05T15:28:27Z",
      "diff_hunk" : "@@ -228,6 +229,36 @@ BOOST_FIXTURE_TEST_CASE(rbf_helper_functions, TestChain100Setup)\n     const auto spends_conflicting_confirmed = make_tx({m_coinbase_txns[0], m_coinbase_txns[1]}, {45 * CENT});\n     BOOST_CHECK(HasNoNewUnconfirmed(*spends_conflicting_confirmed.get(), pool, {entry1_normal, entry3_low}) == std::nullopt);\n \n+    // Tests for CheckMinerScores\n+\n+    // These tests use modified fees (including prioritisation), not base fees.\n+    BOOST_CHECK(CheckMinerScores(entry5_low->GetFee() + entry6_low_prioritised->GetFee() + 1,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1415812593",
      "id" : 1415812593,
      "line" : 235,
      "node_id" : "PRRC_kwDOABII585UY5Xx",
      "original_commit_id" : "1996defeef0bb82cb51f6efe0ed0cb7092273f89",
      "original_line" : 235,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 129,
      "pull_request_review_id" : 1765400607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415812593/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-05T15:28:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415812593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So thinking conceptually about this, I'm most concerned by the new `CheckMinerScores()` criterion, where we only check the replacement package's feerate against the ancestor feerates of the indirect conflicts.\r\n\r\nI think there are two issues with this approach:\r\n1) If you look at `GetModFeesWithAncestors()/GetSizeWithAncestors()`, that can be greater than the transaction's individual feerate (ie if the parent of a transaction has a higher feerate than the child you're conflicting with). So this can cause the test to be too conservative and introduce some kind of weird pinning.  Granted, this is a new replacement functionality so maybe not the end of the world if it is sometimes too conservative, but it seems like a bug.\r\n\r\n2) Also if you look at the ancestor feerate of a transaction, that can underestimate its mining score, such as if some low feerate ancestor is being paid for by another transaction.  So that can allow for replacements that are not incentive compatible (similar to how this is possible today with our current single-transaction RBF rules).\r\n\r\nEven though the current RBF logic is broken already, I'd prefer to avoid adding on to that while rolling out the package RBF implementation, just so that users don't get used to some kinds of replacements working that really shouldn't be.\r\n\r\nSo I was wondering, can we deal with this by just restricting the topology of what we allow a package RBF to conflict with?  Let's say we allow a replacement if the conflict set consists of either (1) a single transaction with no ancestors (and of course no descendants, since any descendants would be in the conflict set as well), or (2) two transactions that are in a parent-child topology, and that have no other in-mempool ancestors (or descendants, of course).\r\n\r\nIn those situations, the maximum miner score you would have to consider is either the individual feerate of the parent tx or the ancestor feerate of the child, so the new logic should work perfectly.",
      "created_at" : "2023-12-08T16:12:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#issuecomment-1847460679",
      "id" : 1847460679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28984",
      "node_id" : "IC_kwDOABII585uHgNH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847460679/reactions"
      },
      "updated_at" : "2023-12-08T16:12:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847460679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "After offline discussion with @sdaftuar , I've worked on a set of prospective changes and pushed them to this branch as follow-on commits.\r\n\r\nKey change is that we will now only allow package RBF when the conflicted transactions are all in \"clusters\" of up to size 2. This allows us to calculate mining scores for each conflicted transaction, which means that post-cluster mempool, if we did this right, IIUC, the behavior should match with more general package RBF.",
      "created_at" : "2023-12-08T21:48:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#issuecomment-1847884788",
      "id" : 1847884788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28984",
      "node_id" : "IC_kwDOABII585uJHv0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847884788/reactions"
      },
      "updated_at" : "2023-12-08T21:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847884788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar should be ready for another look",
      "created_at" : "2023-12-11T20:06:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#issuecomment-1850801317",
      "id" : 1850801317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28984",
      "node_id" : "IC_kwDOABII585uUPyl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1850801317/reactions"
      },
      "updated_at" : "2023-12-11T20:06:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1850801317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1423084047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423084047"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this be \"> 2\"?  ",
      "commit_id" : "89beb714bb44e74ff785d3f0ae32684d737557de",
      "created_at" : "2023-12-11T20:23:38Z",
      "diff_hunk" : "@@ -181,3 +181,54 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckConflictTopology(const CTxMemPool::setEntries& direct_conflicts)\n+{\n+    for (const auto& direct_conflict : direct_conflicts) {\n+        const auto desc_count = direct_conflict->GetCountWithDescendants() - 1;\n+        if (desc_count == 0) {\n+            // It should be by itself, or be a child in a parent-child cluster\n+            if (direct_conflict->GetCountWithAncestors() > 2) {\n+                return strprintf(\"Child transaction has too many ancestors\");\n+            }\n+            if (direct_conflict->GetCountWithAncestors() == 2) {\n+                const auto& parent = direct_conflict->GetMemPoolParentsConst().begin();\n+                if (parent->get().GetCountWithDescendants() > 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1423084047",
      "id" : 1423084047,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585U0ooP",
      "original_commit_id" : "557da6c9027d676871fc03e55efcfbc0a7a42adb",
      "original_line" : 196,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : null,
      "pull_request_review_id" : 1776101239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423084047/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-11T20:24:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423084047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1423098019"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423098019"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I have a failing unit test for this :facepalm: \r\n\r\npushed fix",
      "commit_id" : "89beb714bb44e74ff785d3f0ae32684d737557de",
      "created_at" : "2023-12-11T20:36:54Z",
      "diff_hunk" : "@@ -181,3 +181,54 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckConflictTopology(const CTxMemPool::setEntries& direct_conflicts)\n+{\n+    for (const auto& direct_conflict : direct_conflicts) {\n+        const auto desc_count = direct_conflict->GetCountWithDescendants() - 1;\n+        if (desc_count == 0) {\n+            // It should be by itself, or be a child in a parent-child cluster\n+            if (direct_conflict->GetCountWithAncestors() > 2) {\n+                return strprintf(\"Child transaction has too many ancestors\");\n+            }\n+            if (direct_conflict->GetCountWithAncestors() == 2) {\n+                const auto& parent = direct_conflict->GetMemPoolParentsConst().begin();\n+                if (parent->get().GetCountWithDescendants() > 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1423098019",
      "id" : 1423098019,
      "in_reply_to_id" : 1423084047,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585U0sCj",
      "original_commit_id" : "557da6c9027d676871fc03e55efcfbc0a7a42adb",
      "original_line" : 196,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : null,
      "pull_request_review_id" : 1776123407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423098019/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-11T20:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423098019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424077858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424077858"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason to drop the `txns.size() > 1` test in this `if` clause?",
      "commit_id" : "39c09efadeb5e23a8eee754b86ce4fbea2b0e30c",
      "created_at" : "2023-12-12T14:31:23Z",
      "diff_hunk" : "@@ -1332,11 +1347,8 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             MempoolAcceptResult::FeeFailure(placeholder_state, CFeeRate(m_total_modified_fees, m_total_vsize), all_package_wtxids)}});\n     }\n \n-    // Apply package mempool ancestor/descendant limits. Skip if there is only one transaction,\n-    // because it's unnecessary. Also, CPFP carve out can increase the limit for individual\n-    // transactions, but this exemption is not extended to packages in CheckPackageLimits().\n-    std::string err_string;\n-    if (txns.size() > 1 && !PackageMempoolChecks(txns, m_total_vsize, package_state)) {\n+    // Apply package mempool ancestor/descendant limits.\n+    if (!PackageMempoolChecks(txns, m_total_vsize, package_state)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424077858",
      "id" : 1424077858,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585U4bQi",
      "original_commit_id" : "671de055c8b3ff48b16b93d8389b80fead6342ac",
      "original_line" : 1351,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1777611474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424077858/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T19:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424077858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424084885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424084885"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I found the \"not\" in this comment confusing.",
      "commit_id" : "39c09efadeb5e23a8eee754b86ce4fbea2b0e30c",
      "created_at" : "2023-12-12T14:36:16Z",
      "diff_hunk" : "@@ -55,14 +55,23 @@ def run_test(self):\n         assert_raises_rpc_error(-26, \"too-long-mempool-chain, too many descendants\", self.chain_tx, [chain[0], second_chain])\n         # ...especially if its > 40k weight\n         assert_raises_rpc_error(-26, \"too-long-mempool-chain, too many descendants\", self.chain_tx, [chain[0]], num_outputs=350)\n+        # ...not if it's submitted with other transactions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424084885",
      "id" : 1424084885,
      "line" : 58,
      "node_id" : "PRRC_kwDOABII585U4c-V",
      "original_commit_id" : "671de055c8b3ff48b16b93d8389b80fead6342ac",
      "original_line" : 58,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/mempool_package_onemore.py",
      "position" : 4,
      "pull_request_review_id" : 1777611474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424084885/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T19:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424084885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424358331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424358331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps a comment here would be helpful to explain why this change is needed.",
      "commit_id" : "39c09efadeb5e23a8eee754b86ce4fbea2b0e30c",
      "created_at" : "2023-12-12T17:38:57Z",
      "diff_hunk" : "@@ -972,7 +994,7 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_CONSENSUS, \"bad-txns-spends-conflicting-tx\", *err_string);\n     }\n \n-    m_rbf = !ws.m_conflicts.empty();\n+    m_rbf |= !ws.m_conflicts.empty();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424358331",
      "id" : 1424358331,
      "line" : 1002,
      "node_id" : "PRRC_kwDOABII585U5fu7",
      "original_commit_id" : "56e2fb281a0e62cb70e610370c2dce9e79bc05f0",
      "original_line" : 997,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 203,
      "pull_request_review_id" : 1777611474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424358331/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T19:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424358331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424392025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424392025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was trying to figure out exactly why this code is safe in a package RBF context. I think for a generalized package RBF, this would not be safe, because we do not verify that a child transaction in an incoming package (say) isn't spending a coin in the mempool that would be conflicted by some other transaction in the package.\r\n\r\nHowever, in this particular case, we are enforcing in `PackageMempoolChecks()` (further down) that the incoming package has **no** other in-mempool ancestors (ie the new package is a cluster of size 2), and so I think that condition is what precludes the scenario I'm concerned about above.  (Specifically: if, say, we allowed the incoming package to have 1 in-mempool ancestor A, then it's possible that a package could consist of transactions (P, C) such that P spent one of A's outputs, while transaction C conflicted with A, which I don't think would be caught anywhere right now.)\r\n\r\nIf my understanding here is correct, I think it'd be worth updating the comment to explain this a bit more (and perhaps we could add a test that covers the scenario I described).",
      "commit_id" : "39c09efadeb5e23a8eee754b86ce4fbea2b0e30c",
      "created_at" : "2023-12-12T18:01:10Z",
      "diff_hunk" : "@@ -1337,11 +1423,10 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n         // Make the coins created by this transaction available for subsequent transactions in the\n-        // package to spend. Since we already checked conflicts in the package and we don't allow\n-        // replacements, we don't need to track the coins spent. Note that this logic will need to be\n-        // updated if package replace-by-fee is allowed in the future.\n-        assert(!args.m_allow_replacement);\n-        assert(!m_rbf);\n+        // package to spend. Since we already checked conflicts, no transaction can spend a coin\n+        // needed by another transaction in the package. We also need to make sure that no package\n+        // tx replaces (or replaces the ancestor of) the parent of another package tx. As long as we\n+        // check these two things, we don't need to track the coins spent.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424392025",
      "id" : 1424392025,
      "line" : 1429,
      "node_id" : "PRRC_kwDOABII585U5n9Z",
      "original_commit_id" : "228a5ed16586ef93e7ec5c5da3ef4df0d5fc322f",
      "original_line" : 1429,
      "original_position" : 189,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 435,
      "pull_request_review_id" : 1777611474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424392025/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T19:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424392025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424495073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424495073"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's essentially an existing no-op. IIRC `AcceptMultipleTransactions` is only called in *unit tests* with size 1, otherwise it's always > 1. (maybe I should just kill those tests and `Assume()`?",
      "commit_id" : "39c09efadeb5e23a8eee754b86ce4fbea2b0e30c",
      "created_at" : "2023-12-12T19:40:46Z",
      "diff_hunk" : "@@ -1332,11 +1347,8 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             MempoolAcceptResult::FeeFailure(placeholder_state, CFeeRate(m_total_modified_fees, m_total_vsize), all_package_wtxids)}});\n     }\n \n-    // Apply package mempool ancestor/descendant limits. Skip if there is only one transaction,\n-    // because it's unnecessary. Also, CPFP carve out can increase the limit for individual\n-    // transactions, but this exemption is not extended to packages in CheckPackageLimits().\n-    std::string err_string;\n-    if (txns.size() > 1 && !PackageMempoolChecks(txns, m_total_vsize, package_state)) {\n+    // Apply package mempool ancestor/descendant limits.\n+    if (!PackageMempoolChecks(txns, m_total_vsize, package_state)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424495073",
      "id" : 1424495073,
      "in_reply_to_id" : 1424077858,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585U6BHh",
      "original_commit_id" : "671de055c8b3ff48b16b93d8389b80fead6342ac",
      "original_line" : 1351,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1778311406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424495073/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T19:41:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424495073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424551588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424551588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pushed a functional test covering this case specifically which is rejected due to existence of mempool ancestors.\r\n\r\nI'll try and rephrase soon.",
      "commit_id" : "39c09efadeb5e23a8eee754b86ce4fbea2b0e30c",
      "created_at" : "2023-12-12T20:41:09Z",
      "diff_hunk" : "@@ -1337,11 +1423,10 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n             return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n         // Make the coins created by this transaction available for subsequent transactions in the\n-        // package to spend. Since we already checked conflicts in the package and we don't allow\n-        // replacements, we don't need to track the coins spent. Note that this logic will need to be\n-        // updated if package replace-by-fee is allowed in the future.\n-        assert(!args.m_allow_replacement);\n-        assert(!m_rbf);\n+        // package to spend. Since we already checked conflicts, no transaction can spend a coin\n+        // needed by another transaction in the package. We also need to make sure that no package\n+        // tx replaces (or replaces the ancestor of) the parent of another package tx. As long as we\n+        // check these two things, we don't need to track the coins spent.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28984#discussion_r1424551588",
      "id" : 1424551588,
      "in_reply_to_id" : 1424392025,
      "line" : 1429,
      "node_id" : "PRRC_kwDOABII585U6O6k",
      "original_commit_id" : "228a5ed16586ef93e7ec5c5da3ef4df0d5fc322f",
      "original_line" : 1429,
      "original_position" : 189,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 435,
      "pull_request_review_id" : 1778401060,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28984",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424551588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T20:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424551588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   }
]
