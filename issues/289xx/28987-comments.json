[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28987).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1936426651), [josibake](https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1938735308) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29403](https://github.com/bitcoin/bitcoin/pull/29403) (wallet: batch erase procedures and improve 'EraseRecords' performance by furszy)\n* [#22693](https://github.com/bitcoin/bitcoin/pull/22693) (RPC/Wallet: Add \"use_txids\" to output of getaddressinfo by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-12-02T14:03:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1837156030",
      "id" : 1837156030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28987",
      "node_id" : "IC_kwDOABII585tgMa-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1837156030/reactions"
      },
      "updated_at" : "2024-02-12T14:00:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1837156030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443160561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443160561"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 559529480fedd4181dab76f4452b5998d0cdadc3 \"refactor: decouple wallet EraseTxns from ZapSelectTx\"\r\n\r\nThe commit message calls this `EraseTxns`.",
      "commit_id" : "ff214259de28216a5190c358b786306985f30227",
      "created_at" : "2024-01-05T17:34:28Z",
      "diff_hunk" : "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443160561",
      "id" : 1443160561,
      "line" : 2314,
      "node_id" : "PRRC_kwDOABII585WBOHx",
      "original_commit_id" : "559529480fedd4181dab76f4452b5998d0cdadc3",
      "original_line" : 2314,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 1806470102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443160561/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T17:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443160561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443161309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443161309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 559529480fedd4181dab76f4452b5998d0cdadc3 \"refactor: decouple wallet EraseTxns from ZapSelectTx\"\r\n\r\nUnnecessary whitespace change.",
      "commit_id" : "ff214259de28216a5190c358b786306985f30227",
      "created_at" : "2024-01-05T17:35:28Z",
      "diff_hunk" : "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n {\n-    AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    for (const uint256& hash : vHashIn) {\n+    for (const uint256& hash : tx_hashes) {\n         const auto& it = mapWallet.find(hash);\n         wtxOrdered.erase(it->second.m_it_wtxOrdered);\n-        for (const auto& txin : it->second.tx->vin)\n+        for (const auto& txin: it->second.tx->vin)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443161309",
      "id" : 1443161309,
      "line" : 2319,
      "node_id" : "PRRC_kwDOABII585WBOTd",
      "original_commit_id" : "559529480fedd4181dab76f4452b5998d0cdadc3",
      "original_line" : 2319,
      "original_position" : 14,
      "original_start_line" : 2321,
      "path" : "src/wallet/wallet.cpp",
      "position" : 14,
      "pull_request_review_id" : 1806470102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443161309/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2321,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-01-05T17:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443161309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443164969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443164969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ff214259de28216a5190c358b786306985f30227 \"wallet: migration, remove watch-only transactions atomically\"\r\n\r\nIt seems unnecessary to be making this change here as `ZapSelectTx` is now atomic.",
      "commit_id" : "ff214259de28216a5190c358b786306985f30227",
      "created_at" : "2024-01-05T17:38:16Z",
      "diff_hunk" : "@@ -3931,10 +3933,26 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n     watchonly_batch.reset(); // Flush\n     // Do the removes\n     if (txids_to_delete.size() > 0) {\n-        if (ZapSelectTx(txids_to_delete) != DBErrors::LOAD_OK) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443164969",
      "id" : 1443164969,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WBPMp",
      "original_commit_id" : "ff214259de28216a5190c358b786306985f30227",
      "original_line" : 3934,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 30,
      "pull_request_review_id" : 1806470102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443164969/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T17:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443164969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443784908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784908"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "created_at" : "2024-01-06T15:26:15Z",
      "diff_hunk" : "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443784908",
      "id" : 1443784908,
      "in_reply_to_id" : 1443160561,
      "line" : 2314,
      "node_id" : "PRRC_kwDOABII585WDmjM",
      "original_commit_id" : "559529480fedd4181dab76f4452b5998d0cdadc3",
      "original_line" : 2314,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 1807486280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784908/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-06T15:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443784954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784954"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "created_at" : "2024-01-06T15:26:22Z",
      "diff_hunk" : "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n {\n-    AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    for (const uint256& hash : vHashIn) {\n+    for (const uint256& hash : tx_hashes) {\n         const auto& it = mapWallet.find(hash);\n         wtxOrdered.erase(it->second.m_it_wtxOrdered);\n-        for (const auto& txin : it->second.tx->vin)\n+        for (const auto& txin: it->second.tx->vin)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443784954",
      "id" : 1443784954,
      "in_reply_to_id" : 1443161309,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WDmj6",
      "original_commit_id" : "559529480fedd4181dab76f4452b5998d0cdadc3",
      "original_line" : 2319,
      "original_position" : 14,
      "original_start_line" : 2321,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1807486280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784954/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-01-06T15:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784954",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443785461"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443785461"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> In [ff21425](https://github.com/bitcoin/bitcoin/commit/ff214259de28216a5190c358b786306985f30227) \"wallet: migration, remove watch-only transactions atomically\"\r\n> \r\n> It seems unnecessary to be making this change here as `ZapSelectTx` is now atomic.\r\n\r\nTrue. This PR does not requires it. Will re-introduced it within #28574.",
      "commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "created_at" : "2024-01-06T15:28:28Z",
      "diff_hunk" : "@@ -3931,10 +3933,26 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n     watchonly_batch.reset(); // Flush\n     // Do the removes\n     if (txids_to_delete.size() > 0) {\n-        if (ZapSelectTx(txids_to_delete) != DBErrors::LOAD_OK) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443785461",
      "id" : 1443785461,
      "in_reply_to_id" : 1443164969,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WDmr1",
      "original_commit_id" : "ff214259de28216a5190c358b786306985f30227",
      "original_line" : 3934,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1807486280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443785461/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-06T15:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443785461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1473125056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1473125056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Any reason to add `__func__` to this log, when it previously wasn't there? If someone is interested in the exact source location, they can enable the corresponding log option. If this is needed for context, it could make more sense to clarify the log message itself, so that it is unique and clear without requiring the source code as context.",
      "commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "created_at" : "2024-01-31T16:33:42Z",
      "diff_hunk" : "@@ -1230,88 +1230,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     return result;\n }\n \n-DBErrors WalletBatch::FindWalletTxHashes(std::vector<uint256>& tx_hashes)\n+DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& txs_to_remove)\n {\n-    DBErrors result = DBErrors::LOAD_OK;\n-\n-    try {\n-        int nMinVersion = 0;\n-        if (m_batch->Read(DBKeys::MINVERSION, nMinVersion)) {\n-            if (nMinVersion > FEATURE_LATEST)\n-                return DBErrors::TOO_NEW;\n-        }\n-\n-        // Get cursor\n-        std::unique_ptr<DatabaseCursor> cursor = m_batch->GetNewCursor();\n-        if (!cursor)\n-        {\n-            LogPrintf(\"Error getting wallet database cursor\\n\");\n-            return DBErrors::CORRUPT;\n-        }\n-\n-        while (true)\n-        {\n-            // Read next record\n-            DataStream ssKey{};\n-            DataStream ssValue{};\n-            DatabaseCursor::Status status = cursor->Next(ssKey, ssValue);\n-            if (status == DatabaseCursor::Status::DONE) {\n-                break;\n-            } else if (status == DatabaseCursor::Status::FAIL) {\n-                LogPrintf(\"Error reading next record from wallet database\\n\");\n-                return DBErrors::CORRUPT;\n-            }\n-\n-            std::string strType;\n-            ssKey >> strType;\n-            if (strType == DBKeys::TX) {\n-                uint256 hash;\n-                ssKey >> hash;\n-                tx_hashes.push_back(hash);\n-            }\n-        }\n-    } catch (...) {\n-        result = DBErrors::CORRUPT;\n-    }\n-\n-    return result;\n-}\n-\n-DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<uint256>& vTxHashOut)\n-{\n-    // build list of wallet TX hashes\n-    std::vector<uint256> vTxHash;\n-    DBErrors err = FindWalletTxHashes(vTxHash);\n-    if (err != DBErrors::LOAD_OK) {\n-        return err;\n-    }\n-\n-    std::sort(vTxHash.begin(), vTxHash.end());\n-    std::sort(vTxHashIn.begin(), vTxHashIn.end());\n-\n-    // erase each matching wallet TX\n-    bool delerror = false;\n-    std::vector<uint256>::iterator it = vTxHashIn.begin();\n-    for (const uint256& hash : vTxHash) {\n-        while (it < vTxHashIn.end() && (*it) < hash) {\n-            it++;\n-        }\n-        if (it == vTxHashIn.end()) {\n-            break;\n+    bool fail = false;\n+    for (const uint256& hash : txs_to_remove) {\n+        if (!m_batch->Exists(std::make_pair(DBKeys::TX, hash))) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Cannot remove transaction: %s, not found in db\\n\", __func__, hash.GetHex());\n+            fail = true;\n+            continue;\n         }\n-        else if ((*it) == hash) {\n-            if(!EraseTx(hash)) {\n-                LogPrint(BCLog::WALLETDB, \"Transaction was found for deletion but returned database error: %s\\n\", hash.GetHex());\n-                delerror = true;\n-            }\n-            vTxHashOut.push_back(hash);\n+        if (!EraseTx(hash)) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Failure removing transaction: %s\\n\", __func__, hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1473125056",
      "id" : 1473125056,
      "line" : 1243,
      "node_id" : "PRRC_kwDOABII585XzhrA",
      "original_commit_id" : "783e7de01c1f68b732ee8b1467a62fdfd558e46d",
      "original_line" : 1243,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 87,
      "pull_request_review_id" : 1854269874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1473125056/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-31T16:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1473125056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1482044079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482044079"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In d26a28508d5322fe7c29b3642dcf3a17b0ea31f1 \"wallet: batch ZapSelectTx db operations\"\r\n\r\nThis should explicitly call `TxnAbort` before returning as otherwise we will get extraenous logs about the tx being aborted before batch is destroyed.",
      "commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "created_at" : "2024-02-07T20:23:44Z",
      "diff_hunk" : "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1482044079",
      "id" : 1482044079,
      "line" : 2334,
      "node_id" : "PRRC_kwDOABII585YVjKv",
      "original_commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "original_line" : 2334,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 14,
      "pull_request_review_id" : 1868714524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482044079/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T20:24:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482044079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1482045052"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482045052"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In d26a28508d5322fe7c29b3642dcf3a17b0ea31f1 \"wallet: batch ZapSelectTx db operations\"\r\n\r\nI'm not sure if `NONCRITICAL_ERROR` is really the right return code. It seems like something has gone critically wrong if `TxnCommit` were to fail.",
      "commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "created_at" : "2024-02-07T20:24:26Z",
      "diff_hunk" : "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;\n \n+    // Apply db changes and remove transactions from the memory map\n+    if (!batch.TxnCommit()) return DBErrors::NONCRITICAL_ERROR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1482045052",
      "id" : 1482045052,
      "line" : 2337,
      "node_id" : "PRRC_kwDOABII585YVjZ8",
      "original_commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "original_line" : 2337,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 17,
      "pull_request_review_id" : 1868714524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482045052/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T20:24:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482045052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484606348"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606348"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Any reason to add __func__ to this log, when it previously wasn't there?\r\n\r\njust an old bad habit. Removed. Thanks.",
      "commit_id" : "9a3c5c8697659e34d0476103af942a4615818f4e",
      "created_at" : "2024-02-09T17:23:00Z",
      "diff_hunk" : "@@ -1230,88 +1230,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     return result;\n }\n \n-DBErrors WalletBatch::FindWalletTxHashes(std::vector<uint256>& tx_hashes)\n+DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& txs_to_remove)\n {\n-    DBErrors result = DBErrors::LOAD_OK;\n-\n-    try {\n-        int nMinVersion = 0;\n-        if (m_batch->Read(DBKeys::MINVERSION, nMinVersion)) {\n-            if (nMinVersion > FEATURE_LATEST)\n-                return DBErrors::TOO_NEW;\n-        }\n-\n-        // Get cursor\n-        std::unique_ptr<DatabaseCursor> cursor = m_batch->GetNewCursor();\n-        if (!cursor)\n-        {\n-            LogPrintf(\"Error getting wallet database cursor\\n\");\n-            return DBErrors::CORRUPT;\n-        }\n-\n-        while (true)\n-        {\n-            // Read next record\n-            DataStream ssKey{};\n-            DataStream ssValue{};\n-            DatabaseCursor::Status status = cursor->Next(ssKey, ssValue);\n-            if (status == DatabaseCursor::Status::DONE) {\n-                break;\n-            } else if (status == DatabaseCursor::Status::FAIL) {\n-                LogPrintf(\"Error reading next record from wallet database\\n\");\n-                return DBErrors::CORRUPT;\n-            }\n-\n-            std::string strType;\n-            ssKey >> strType;\n-            if (strType == DBKeys::TX) {\n-                uint256 hash;\n-                ssKey >> hash;\n-                tx_hashes.push_back(hash);\n-            }\n-        }\n-    } catch (...) {\n-        result = DBErrors::CORRUPT;\n-    }\n-\n-    return result;\n-}\n-\n-DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<uint256>& vTxHashOut)\n-{\n-    // build list of wallet TX hashes\n-    std::vector<uint256> vTxHash;\n-    DBErrors err = FindWalletTxHashes(vTxHash);\n-    if (err != DBErrors::LOAD_OK) {\n-        return err;\n-    }\n-\n-    std::sort(vTxHash.begin(), vTxHash.end());\n-    std::sort(vTxHashIn.begin(), vTxHashIn.end());\n-\n-    // erase each matching wallet TX\n-    bool delerror = false;\n-    std::vector<uint256>::iterator it = vTxHashIn.begin();\n-    for (const uint256& hash : vTxHash) {\n-        while (it < vTxHashIn.end() && (*it) < hash) {\n-            it++;\n-        }\n-        if (it == vTxHashIn.end()) {\n-            break;\n+    bool fail = false;\n+    for (const uint256& hash : txs_to_remove) {\n+        if (!m_batch->Exists(std::make_pair(DBKeys::TX, hash))) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Cannot remove transaction: %s, not found in db\\n\", __func__, hash.GetHex());\n+            fail = true;\n+            continue;\n         }\n-        else if ((*it) == hash) {\n-            if(!EraseTx(hash)) {\n-                LogPrint(BCLog::WALLETDB, \"Transaction was found for deletion but returned database error: %s\\n\", hash.GetHex());\n-                delerror = true;\n-            }\n-            vTxHashOut.push_back(hash);\n+        if (!EraseTx(hash)) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Failure removing transaction: %s\\n\", __func__, hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484606348",
      "id" : 1484606348,
      "in_reply_to_id" : 1473125056,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YfUuM",
      "original_commit_id" : "783e7de01c1f68b732ee8b1467a62fdfd558e46d",
      "original_line" : 1243,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1872874268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606348/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:38:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484606675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606675"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> This should explicitly call TxnAbort before returning as otherwise we will get extraenous logs about the tx being aborted before batch is destroyed.\r\n\r\nsure. Fixed.",
      "commit_id" : "9a3c5c8697659e34d0476103af942a4615818f4e",
      "created_at" : "2024-02-09T17:23:19Z",
      "diff_hunk" : "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484606675",
      "id" : 1484606675,
      "in_reply_to_id" : 1482044079,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YfUzT",
      "original_commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "original_line" : 2334,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1872874268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606675/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:38:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484621811"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484621811"
         }
      },
      "author_association" : "MEMBER",
      "body" : " > I'm not sure if `NONCRITICAL_ERROR` is really the right return code. It seems like something has gone critically wrong if `TxnCommit` were to fail.\r\n\r\nThe returned error code doesn't really matter. Anything different from `LOAD_OK` is an error for all the function's callers. And they behave exactly the same for all codes.\r\nActually, the `DBErrors` return doesn't make sense anymore after this PR changes. The function is no longer traversing the entire db nor checking for extra, unneeded, stuff like the version inside anymore.\r\n\r\nBased on this, I have reworked the PR cleaning up this aspect as well.\r\n",
      "commit_id" : "9a3c5c8697659e34d0476103af942a4615818f4e",
      "created_at" : "2024-02-09T17:37:47Z",
      "diff_hunk" : "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;\n \n+    // Apply db changes and remove transactions from the memory map\n+    if (!batch.TxnCommit()) return DBErrors::NONCRITICAL_ERROR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484621811",
      "id" : 1484621811,
      "in_reply_to_id" : 1482045052,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YfYfz",
      "original_commit_id" : "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "original_line" : 2337,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1872874268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484621811/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:38:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484621811",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 9a3c5c8697659e34d0476103af942a4615818f4e\r\n\r\nThe new code is much simpler.",
      "created_at" : "2024-02-09T18:40:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1936426651",
      "id" : 1936426651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28987",
      "node_id" : "IC_kwDOABII585za4ab",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936426651/reactions"
      },
      "updated_at" : "2024-02-09T18:40:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936426651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/28987/commits/9a3c5c8697659e34d0476103af942a4615818f4e\r\n\r\nlooks good, also `RemoveTxs` is a much better name. Might be worth updating the description to mention the rename since the description ends up in the commit log.",
      "created_at" : "2024-02-12T14:00:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1938735308",
      "id" : 1938735308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28987",
      "node_id" : "IC_kwDOABII585zjsDM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938735308/reactions"
      },
      "updated_at" : "2024-02-12T14:00:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938735308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   }
]
