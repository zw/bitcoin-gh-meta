[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixes concerns described in: https://github.com/bitcoin/bitcoin/pull/13743#pullrequestreview-166625569",
      "created_at" : "2018-12-04T04:39:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#issuecomment-443968769",
      "id" : 443968769,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14864",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0Mzk2ODc2OQ==",
      "updated_at" : "2018-12-04T04:39:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/443968769",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "How about making this a scripted-diff?",
      "created_at" : "2018-12-04T10:24:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#issuecomment-444049722",
      "id" : 444049722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14864",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDA0OTcyMg==",
      "updated_at" : "2018-12-04T10:24:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444049722",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nNice improvement to the scripted-diff integrity!\r\n\r\nWould be nice and meta to have this change done as a `scripted-diff` :-)",
      "created_at" : "2018-12-04T10:42:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#issuecomment-444055115",
      "id" : 444055115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14864",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDA1NTExNQ==",
      "updated_at" : "2018-12-04T10:42:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444055115",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14864#discussion_r238612666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14864"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238612666"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it make sense to use `(set -e; eval \"$SCRIPT\") || RET=1 && echo \"scripted-diff execution failed.\"`?\r\n\r\nThat would allow us to catch execution failures within the scripted-diff run. Currently such execution failure are silent (as long as the diff produces the expected result).\r\n\r\nIt probably shouldn't be done as part of this PR as that would change behaviour.",
      "commit_id" : "43f909990190b3ff7883f0b2c117daa876d8fd99",
      "created_at" : "2018-12-04T10:50:23Z",
      "diff_hunk" : "@@ -20,23 +20,23 @@ fi\n RET=0\n PREV_BRANCH=`git name-rev --name-only HEAD`\n PREV_HEAD=`git rev-parse HEAD`\n-for i in `git rev-list --reverse $1`; do\n-    if git rev-list -n 1 --pretty=\"%s\" $i | grep -q \"^scripted-diff:\"; then\n-        git checkout --quiet $i^ || exit\n-        SCRIPT=\"`git rev-list --format=%b -n1 $i | sed '/^-BEGIN VERIFY SCRIPT-$/,/^-END VERIFY SCRIPT-$/{//!b};d'`\"\n+for commit in `git rev-list --reverse $1`; do\n+    if git rev-list -n 1 --pretty=\"%s\" $commit | grep -q \"^scripted-diff:\"; then\n+        git checkout --quiet $commit^ || exit\n+        SCRIPT=\"`git rev-list --format=%b -n1 $commit | sed '/^-BEGIN VERIFY SCRIPT-$/,/^-END VERIFY SCRIPT-$/{//!b};d'`\"\n         if test \"x$SCRIPT\" = \"x\"; then\n-            echo \"Error: missing script for: $i\"\n+            echo \"Error: missing script for: $commit\"\n             echo \"Failed\"\n             RET=1\n         else\n-            echo \"Running script for: $i\"\n+            echo \"Running script for: $commit\"\n             echo \"$SCRIPT\"\n-            eval \"$SCRIPT\"\n-            git --no-pager diff --exit-code $i && echo \"OK\" || (echo \"Failed\"; false) || RET=1\n+            (eval \"$SCRIPT\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#discussion_r238612666",
      "id" : 238612666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODYxMjY2Ng==",
      "original_commit_id" : "53977cf12fa3c60c0c04bcc43f6c3a50381f03f9",
      "original_position" : 23,
      "path" : "test/lint/commit-script-check.sh",
      "position" : 23,
      "pull_request_review_id" : 181194234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14864",
      "updated_at" : "2018-12-04T16:00:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238612666",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Made it `M E T A`",
      "created_at" : "2018-12-04T16:03:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#issuecomment-444154038",
      "id" : 444154038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14864",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDE1NDAzOA==",
      "updated_at" : "2018-12-04T16:03:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444154038",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14864#discussion_r238728259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14864"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238728259"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure about `set -e`, as I've found that people are not used to its behaviour and there are legitimate uses of not failing immediately upon the failure of one command. I think that as long as the diff produces the expected result, we should be good.\r\n\r\nWhat I _would_ like to have is `set -x`, which doesn't change behaviour but allows us to see line by line execution fully expanded (in case it's a complex script they'd like to debug).",
      "commit_id" : "43f909990190b3ff7883f0b2c117daa876d8fd99",
      "created_at" : "2018-12-04T16:08:43Z",
      "diff_hunk" : "@@ -20,23 +20,23 @@ fi\n RET=0\n PREV_BRANCH=`git name-rev --name-only HEAD`\n PREV_HEAD=`git rev-parse HEAD`\n-for i in `git rev-list --reverse $1`; do\n-    if git rev-list -n 1 --pretty=\"%s\" $i | grep -q \"^scripted-diff:\"; then\n-        git checkout --quiet $i^ || exit\n-        SCRIPT=\"`git rev-list --format=%b -n1 $i | sed '/^-BEGIN VERIFY SCRIPT-$/,/^-END VERIFY SCRIPT-$/{//!b};d'`\"\n+for commit in `git rev-list --reverse $1`; do\n+    if git rev-list -n 1 --pretty=\"%s\" $commit | grep -q \"^scripted-diff:\"; then\n+        git checkout --quiet $commit^ || exit\n+        SCRIPT=\"`git rev-list --format=%b -n1 $commit | sed '/^-BEGIN VERIFY SCRIPT-$/,/^-END VERIFY SCRIPT-$/{//!b};d'`\"\n         if test \"x$SCRIPT\" = \"x\"; then\n-            echo \"Error: missing script for: $i\"\n+            echo \"Error: missing script for: $commit\"\n             echo \"Failed\"\n             RET=1\n         else\n-            echo \"Running script for: $i\"\n+            echo \"Running script for: $commit\"\n             echo \"$SCRIPT\"\n-            eval \"$SCRIPT\"\n-            git --no-pager diff --exit-code $i && echo \"OK\" || (echo \"Failed\"; false) || RET=1\n+            (eval \"$SCRIPT\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#discussion_r238728259",
      "id" : 238728259,
      "in_reply_to_id" : 238612666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODcyODI1OQ==",
      "original_commit_id" : "53977cf12fa3c60c0c04bcc43f6c3a50381f03f9",
      "original_position" : 23,
      "path" : "test/lint/commit-script-check.sh",
      "position" : 23,
      "pull_request_review_id" : 181340986,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14864",
      "updated_at" : "2018-12-04T16:08:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238728259",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14864#discussion_r238730475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14864"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238730475"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, you have a good point. `set -x` would be really nice :-)",
      "commit_id" : "43f909990190b3ff7883f0b2c117daa876d8fd99",
      "created_at" : "2018-12-04T16:13:49Z",
      "diff_hunk" : "@@ -20,23 +20,23 @@ fi\n RET=0\n PREV_BRANCH=`git name-rev --name-only HEAD`\n PREV_HEAD=`git rev-parse HEAD`\n-for i in `git rev-list --reverse $1`; do\n-    if git rev-list -n 1 --pretty=\"%s\" $i | grep -q \"^scripted-diff:\"; then\n-        git checkout --quiet $i^ || exit\n-        SCRIPT=\"`git rev-list --format=%b -n1 $i | sed '/^-BEGIN VERIFY SCRIPT-$/,/^-END VERIFY SCRIPT-$/{//!b};d'`\"\n+for commit in `git rev-list --reverse $1`; do\n+    if git rev-list -n 1 --pretty=\"%s\" $commit | grep -q \"^scripted-diff:\"; then\n+        git checkout --quiet $commit^ || exit\n+        SCRIPT=\"`git rev-list --format=%b -n1 $commit | sed '/^-BEGIN VERIFY SCRIPT-$/,/^-END VERIFY SCRIPT-$/{//!b};d'`\"\n         if test \"x$SCRIPT\" = \"x\"; then\n-            echo \"Error: missing script for: $i\"\n+            echo \"Error: missing script for: $commit\"\n             echo \"Failed\"\n             RET=1\n         else\n-            echo \"Running script for: $i\"\n+            echo \"Running script for: $commit\"\n             echo \"$SCRIPT\"\n-            eval \"$SCRIPT\"\n-            git --no-pager diff --exit-code $i && echo \"OK\" || (echo \"Failed\"; false) || RET=1\n+            (eval \"$SCRIPT\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#discussion_r238730475",
      "id" : 238730475,
      "in_reply_to_id" : 238612666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODczMDQ3NQ==",
      "original_commit_id" : "53977cf12fa3c60c0c04bcc43f6c3a50381f03f9",
      "original_position" : 23,
      "path" : "test/lint/commit-script-check.sh",
      "position" : 23,
      "pull_request_review_id" : 181343919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14864",
      "updated_at" : "2018-12-04T16:16:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238730475",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 43f909990190b3ff7883f0b2c117daa876d8fd99",
      "created_at" : "2018-12-04T16:27:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14864#issuecomment-444163021",
      "id" : 444163021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14864",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDE2MzAyMQ==",
      "updated_at" : "2018-12-04T16:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444163021",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
