[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #22567 by MarcoFalke\n* #22564 by dongcarl\n* #22528 by theStack\n* #22485 by jamesob\n* #22242 by MarcoFalke\n* #20362 by MarcoFalke\n* #15606 by jamesob\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-04-19T03:52:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-822147133",
      "id" : 822147133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjE0NzEzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-28T14:18:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822147133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r615556639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615556639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function doesn't use any member of BlockManager, so could be stand-alone? Also, I think you can avoid this check by having the caller pass a `const CBlockIndex& start_block`.",
      "commit_id" : "23fb6feec6c070943e4a6ee94055c9d47b6c8a90",
      "created_at" : "2021-04-19T05:49:00Z",
      "diff_hunk" : "@@ -1335,6 +1334,14 @@ int BlockManager::GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n+const CBlockIndex* BlockManager::GetLastPruneBlock(const CBlockIndex* start_block) {\n+    const CBlockIndex* block = start_block;\n+    CHECK_NONFATAL(block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r615556639",
      "id" : 615556639,
      "line" : 1339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTU1NjYzOQ==",
      "original_commit_id" : "23fb6feec6c070943e4a6ee94055c9d47b6c8a90",
      "original_line" : 1339,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 14,
      "pull_request_review_id" : 638479069,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-19T05:49:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615556639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r632032296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632032296"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! I made the changes as suggested.",
      "commit_id" : "7cb32c39c01c95ae7dce65881707db190fe74aa4",
      "created_at" : "2021-05-13T18:55:13Z",
      "diff_hunk" : "@@ -1335,6 +1334,14 @@ int BlockManager::GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n+const CBlockIndex* BlockManager::GetLastPruneBlock(const CBlockIndex* start_block) {\n+    const CBlockIndex* block = start_block;\n+    CHECK_NONFATAL(block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r632032296",
      "id" : 632032296,
      "in_reply_to_id" : 615556639,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjAzMjI5Ng==",
      "original_commit_id" : "23fb6feec6c070943e4a6ee94055c9d47b6c8a90",
      "original_line" : 1339,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 659205588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-13T18:55:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632032296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, I think this is an elegant approach.",
      "created_at" : "2021-05-17T18:27:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-842538559",
      "id" : 842538559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MjUzODU1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-17T18:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/842538559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638228451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638228451"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 5d23ddf5ff3bd1e5d4f6b85440d9ad0c59bb9994 \"Add prune blockers to BlockManager\"\r\n\r\nSince this has `EXCLUSIVE_LOCKS_REQUIRED`, I think it should also have `AssertLockHeld` in here too.",
      "commit_id" : "11f01efadf8e93f042ebd05d12f1f3bc5bce8178",
      "created_at" : "2021-05-24T19:42:35Z",
      "diff_hunk" : "@@ -3663,6 +3673,10 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638228451",
      "id" : 638228451,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODIyODQ1MQ==",
      "original_commit_id" : "5d23ddf5ff3bd1e5d4f6b85440d9ad0c59bb9994",
      "original_line" : 3676,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 32,
      "pull_request_review_id" : 667113687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T19:50:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638228451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638325082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638325082"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, fixed!",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T22:13:42Z",
      "diff_hunk" : "@@ -3663,6 +3673,10 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638325082",
      "id" : 638325082,
      "in_reply_to_id" : 638228451,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODMyNTA4Mg==",
      "original_commit_id" : "5d23ddf5ff3bd1e5d4f6b85440d9ad0c59bb9994",
      "original_line" : 3672,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 32,
      "pull_request_review_id" : 667236323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T22:13:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638325082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347138"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bfe9719e29d7947e2ffa9b510cd078e8a09b5d03\r\n\r\nnit, `GetLastPrunedBlock`?",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:11:22Z",
      "diff_hunk" : "@@ -51,6 +51,14 @@ bool IsBlockPruned(const CBlockIndex* pblockindex)\n     return (fHavePruned && !(pblockindex->nStatus & BLOCK_HAVE_DATA) && pblockindex->nTx > 0);\n }\n \n+const CBlockIndex* GetLastPruneBlock(const CBlockIndex& start_block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347138",
      "id" : 638347138,
      "line" : 54,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0NzEzOA==",
      "original_commit_id" : "bfe9719e29d7947e2ffa9b510cd078e8a09b5d03",
      "original_line" : 54,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : 4,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c\r\n\r\nnit, `const std::string&`.",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:13:19Z",
      "diff_hunk" : "@@ -450,6 +450,10 @@ class BlockManager\n      */\n     int GetSpendHeight(const CCoinsViewCache& inputs) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    std::unordered_map<std::string, const CBlockIndex*> m_prune_blockers;\n+\n+    void UpdatePruneBlocker(std::string name, const CBlockIndex* block) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347828",
      "id" : 638347828,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0NzgyOA==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 455,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 6,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c\r\n\r\nHow can it be `nullptr`?",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:15:37Z",
      "diff_hunk" : "@@ -2041,6 +2041,16 @@ bool CChainState::FlushStateToDisk(\n                last_prune = std::max(1, std::min(last_prune, index.GetSummary().best_block_height));\n             });\n \n+            for (auto const& blocker : m_blockman.m_prune_blockers) {\n+                if (blocker.second) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348578",
      "id" : 638348578,
      "line" : 2041,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0ODU3OA==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 2045,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 17,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348949"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c\r\n\r\nShould check/assert it only goes forward when updating?",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:16:45Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348949",
      "id" : 638348949,
      "line" : 3674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0ODk0OQ==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3678,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 34,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638349497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638349497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d18677006d3d48ca7654039ea6e267164a2690e0\r\n\r\nnit, use ternary? `block ? block : ::ChainActive().Genesis()`",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:18:33Z",
      "diff_hunk" : "@@ -364,3 +364,15 @@ IndexSummary BaseIndex::GetSummary() const\n     summary.best_block_height = m_best_block_index ? m_best_block_index.load()->nHeight : 0;\n     return summary;\n }\n+\n+void BaseIndex::SetBestBlockIndex(const CBlockIndex* block) {\n+    m_best_block_index = block;\n+    if (AllowPrune()) {\n+        LOCK(::cs_main);\n+        if (!block) {\n+            g_chainman.m_blockman.UpdatePruneBlocker(GetName(), ::ChainActive().Genesis());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638349497",
      "id" : 638349497,
      "line" : 373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0OTQ5Nw==",
      "original_commit_id" : "d18677006d3d48ca7654039ea6e267164a2690e0",
      "original_line" : 373,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 95,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638349497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am not sure. The way I use it right now it can also go down with reorgs. I am undecided what the right course is. Only going up avoids a potential footgun, with going down it could react to (highly unlikely) deep reorg. If I add this I think I would do it so that setting a lower number is simply a no op:\r\n\r\n```\r\nif (m_prune_blockers[name] < block) m_prune_blockers[name] = block;\r\n```",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:05Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188761",
      "id" : 640188761,
      "in_reply_to_id" : 638348949,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODc2MQ==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3672,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 669625747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188783"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:10Z",
      "diff_hunk" : "@@ -364,3 +364,15 @@ IndexSummary BaseIndex::GetSummary() const\n     summary.best_block_height = m_best_block_index ? m_best_block_index.load()->nHeight : 0;\n     return summary;\n }\n+\n+void BaseIndex::SetBestBlockIndex(const CBlockIndex* block) {\n+    m_best_block_index = block;\n+    if (AllowPrune()) {\n+        LOCK(::cs_main);\n+        if (!block) {\n+            g_chainman.m_blockman.UpdatePruneBlocker(GetName(), ::ChainActive().Genesis());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188783",
      "id" : 640188783,
      "in_reply_to_id" : 638349497,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODc4Mw==",
      "original_commit_id" : "d18677006d3d48ca7654039ea6e267164a2690e0",
      "original_line" : 373,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : null,
      "pull_request_review_id" : 669625774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188853"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess it should never be `nullptr`. Dropped that if statement.",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:20Z",
      "diff_hunk" : "@@ -2041,6 +2041,16 @@ bool CChainState::FlushStateToDisk(\n                last_prune = std::max(1, std::min(last_prune, index.GetSummary().best_block_height));\n             });\n \n+            for (auto const& blocker : m_blockman.m_prune_blockers) {\n+                if (blocker.second) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188853",
      "id" : 640188853,
      "in_reply_to_id" : 638348578,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODg1Mw==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 2045,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 669625858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188945"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:37Z",
      "diff_hunk" : "@@ -450,6 +450,10 @@ class BlockManager\n      */\n     int GetSpendHeight(const CCoinsViewCache& inputs) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    std::unordered_map<std::string, const CBlockIndex*> m_prune_blockers;\n+\n+    void UpdatePruneBlocker(std::string name, const CBlockIndex* block) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188945",
      "id" : 640188945,
      "in_reply_to_id" : 638347828,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODk0NQ==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 455,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 669625968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188998"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:45Z",
      "diff_hunk" : "@@ -51,6 +51,14 @@ bool IsBlockPruned(const CBlockIndex* pblockindex)\n     return (fHavePruned && !(pblockindex->nStatus & BLOCK_HAVE_DATA) && pblockindex->nTx > 0);\n }\n \n+const CBlockIndex* GetLastPruneBlock(const CBlockIndex& start_block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188998",
      "id" : 640188998,
      "in_reply_to_id" : 638347138,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODk5OA==",
      "original_commit_id" : "bfe9719e29d7947e2ffa9b510cd078e8a09b5d03",
      "original_line" : 54,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : null,
      "pull_request_review_id" : 669626026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed comments by @promag , thank you!\r\n\r\nI also fixed a comment I had overlooked and added a new commit at the end because I realized that we can skip the pruning stuff in `index/base` if the node is not actually pruning. With the new behavior especially this prevents locking `cs_main`. Happy to squash this but I am still checking that this is 100% safe and want to make sure it is looked at separately because it was not included in the existing concept acks.",
      "created_at" : "2021-05-26T23:41:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-849190916",
      "id" : 849190916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0OTE5MDkxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-26T23:41:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/849190916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640190703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640190703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "But what should happen if the block is already pruned?",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:41:48Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640190703",
      "id" : 640190703,
      "in_reply_to_id" : 638348949,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE5MDcwMw==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3672,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 669627925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640190703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-01T12:10:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-852072880",
      "id" : 852072880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MjA3Mjg4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-01T12:10:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/852072880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r643467366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643467366"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, that would mean the node would have to restart with `-reindex` anyway, right?",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-06-01T20:46:34Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r643467366",
      "id" : 643467366,
      "in_reply_to_id" : 638348949,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MzQ2NzM2Ng==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3672,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 673564476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-01T20:46:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643467366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> How about keeping some blocks before the deepest prune blocker?\r\n\r\nInteresting. That should help make it a bit more robust. I added this but set it pretty low for now (10), looking for feedback if it should be higher. I also encapsulated the logic for getting the deepest prune height into it's own function to not have more logic in `FlushStateToDisk`.\r\n\r\nAlso rebased.",
      "created_at" : "2021-06-01T23:17:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-852550603",
      "id" : 852550603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MjU1MDYwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-01T23:17:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/852550603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644094388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644094388"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Introduce GetLastPruneBlock helper function\" (292d508e956bfe5b05e6ee685415063c2a0f04af)\r\n\r\nNote: Here and in the other location below there's no more CHECK_NONFATAL so there would be segfault instead of an exception if the tip was null. Doesn't seem like a problem, but if were for some reason, GetLastPrunedBlock argument could be a pointer instead of a reference and the check could be added there.",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-02T15:46:54Z",
      "diff_hunk" : "@@ -1069,12 +1069,9 @@ static RPCHelpMan pruneblockchain()\n     }\n \n     PruneBlockFilesManual(active_chainstate, height);\n-    const CBlockIndex* block = active_chain.Tip();\n-    CHECK_NONFATAL(block);\n-    while (block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n-        block = block->pprev;\n-    }\n-    return uint64_t(block->nHeight);\n+    const CBlockIndex* last_block = GetLastPrunedBlock(*active_chain.Tip());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644094388",
      "id" : 644094388,
      "line" : 1072,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDA5NDM4OA==",
      "original_commit_id" : "292d508e956bfe5b05e6ee685415063c2a0f04af",
      "original_line" : 1072,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 10,
      "pull_request_review_id" : 674379812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T15:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644094388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644109721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644109721"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add prune blockers to BlockManager\" (9f8d6a9a8f7d113ae12306c72a773830b5725e37)\r\n\r\nWould be good to have a descriptive comment like:\r\n\r\n```c++\r\n//! Map from external index name to most recent block the index can tolerate being pruned.\r\n//!\r\n//! @note Internally, only blocks at height (block->nHeight + PRUNE_BLOCKER_BUFFER) and\r\n//! below will be pruned, but callers should avoid assuming any particular buffer size.\r\n```",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-02T16:04:50Z",
      "diff_hunk" : "@@ -494,6 +497,12 @@ class BlockManager\n      */\n     int GetSpendHeight(const CCoinsViewCache& inputs) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    std::unordered_map<std::string, const CBlockIndex*> m_prune_blockers;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644109721",
      "id" : 644109721,
      "line" : 500,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDEwOTcyMQ==",
      "original_commit_id" : "9f8d6a9a8f7d113ae12306c72a773830b5725e37",
      "original_line" : 500,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 14,
      "pull_request_review_id" : 674399868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T18:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644109721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644115299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644115299"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add prune blockers to BlockManager\" (9f8d6a9a8f7d113ae12306c72a773830b5725e37)\r\n\r\nJust a style suggestion, so feel free to ignore, but usage of this function seems awkward to understand with last_prune being an input and an output parameter. I think FlushStateToDisk would be easier to read with the code in this function just inlined there (which is the only place where it is called).",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-02T16:12:07Z",
      "diff_hunk" : "@@ -3792,6 +3794,21 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(const std::string& name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;\n+}\n+\n+void BlockManager::GetLastPruneBlockerHeight(int& last_prune) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644115299",
      "id" : 644115299,
      "line" : 3798,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDExNTI5OQ==",
      "original_commit_id" : "9f8d6a9a8f7d113ae12306c72a773830b5725e37",
      "original_line" : 3802,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 33,
      "pull_request_review_id" : 674399868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T18:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644115299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644173288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644173288"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add prune blockers to BlockManager\" (9f8d6a9a8f7d113ae12306c72a773830b5725e37):\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/21726#discussion_r643467366\r\n\r\n> Hm, that would mean the node would have to restart with `-reindex` anyway, right?\r\n\r\nIt would be nice to have a test for this case if there isn't one. does seem like like if there was reorg and a block needed by the index was pruned, the index should be responsible for handling the error when the rewind method is called. I guess the index could just disable itself or stop the node at that point.\r\n\r\nBut for this `UpdatePruneBlocker` method, it would seem too strict to never allow a blocker to move backwards, because moving an existing blocker backwards seems no worse of a problem than adding new blocker at a lower minimum height. Maybe it could be useful to have a sanity check here which asserts that whenever a new minimum height is set in the map, that no blocks in the (new_min_height, prev_min_height] range have been pruned. But this doesn't seem strictly necessary either if we are confident that indexes compatible with pruning are able to handle pruned block errors safely when they are syncing or handling reorgs",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-02T17:23:40Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644173288",
      "id" : 644173288,
      "in_reply_to_id" : 638348949,
      "line" : 3795,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDE3MzI4OA==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3795,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 30,
      "pull_request_review_id" : 674399868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T18:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644173288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644205509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644205509"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add prune blockers to BlockManager\" (9f8d6a9a8f7d113ae12306c72a773830b5725e37):\r\n\r\nWould it make sense to use a log category here `LogPrint(BCLog::PRUNE, ...)` instead of printing unconditionally? Also in the future it could be nice to unify this print with the prints in the FindFilesToPrune functions and print the full pruning status in a consistent way on just one line.",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-02T18:06:23Z",
      "diff_hunk" : "@@ -3792,6 +3794,21 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(const std::string& name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;\n+}\n+\n+void BlockManager::GetLastPruneBlockerHeight(int& last_prune) {\n+    for (auto const& blocker : m_prune_blockers) {\n+        const int blocker_height = blocker.second->nHeight + PRUNE_BLOCKER_BUFFER;\n+        last_prune = std::max(1, std::min(last_prune, blocker_height));\n+        if (last_prune == blocker_height) {\n+            LogPrintf(\"%s limited pruning to height %d\\n\", blocker.first, blocker_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r644205509",
      "id" : 644205509,
      "line" : 3803,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDIwNTUwOQ==",
      "original_commit_id" : "9f8d6a9a8f7d113ae12306c72a773830b5725e37",
      "original_line" : 3807,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 38,
      "pull_request_review_id" : 674399868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T18:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644205509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r654778191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654778191"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        const int blocker_height = blocker.second->nHeight - PRUNE_BLOCKER_BUFFER;\r\n```\r\nShouldn't we subtract here if we want to keep `PRUNE_BLOCKER_BUFFER` blocks **before** the deepest blocker?\r\n\r\nfrom the logs of a test run:\r\n```\r\nnode1 2021-06-19T12:10:06.022496Z [init] [validation.cpp:3803] [GetLastPruneBlockerHeight] coinstatsindex limited pruning to height 10\r\n...\r\nnode1 2021-06-19T12:10:06.044329Z [coinstatsindex] [index/base.cpp:159] [ThreadSync] Syncing coinstatsindex with block chain from height 0\r\n```\r\nnode1 limited pruning to height 10 before it started syncing from height 0.",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-19T10:15:05Z",
      "diff_hunk" : "@@ -3792,6 +3790,21 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(const std::string& name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;\n+}\n+\n+void BlockManager::GetLastPruneBlockerHeight(int& last_prune) {\n+    for (auto const& blocker : m_prune_blockers) {\n+        const int blocker_height = blocker.second->nHeight + PRUNE_BLOCKER_BUFFER;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r654778191",
      "id" : 654778191,
      "line" : 3800,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NDc3ODE5MQ==",
      "original_commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "original_line" : 3800,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 35,
      "pull_request_review_id" : 687813168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-19T12:31:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654778191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r654789987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654789987"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Wouldn't it make more sense to wait for the indexes to sync *after* pruning?\r\nOtherwise it is pretty much guaranteed that the index data at the tip (700) is available after pruning.\r\n\r\nIn general i think it would be good for the test to check for expected prune blocker heights somehow. (not sure if that is possible, i dont know that much about the functional tests)",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-19T12:22:15Z",
      "diff_hunk" : "@@ -0,0 +1,117 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test indices in conjunction with prune.\"\"\"\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+)\n+\n+\n+class FeatureIndexPruneTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-fastprune\", \"-prune=1\", \"-blockfilterindex=1\"],\n+            [\"-fastprune\", \"-prune=1\", \"-coinstatsindex=1\"],\n+            [\"-fastprune\", \"-prune=1\", \"-blockfilterindex=1\", \"-coinstatsindex=1\"]\n+        ]\n+\n+    def sync_index(self, height):\n+        expected_filter = {\n+            'basic block filter index': {'synced': True, 'best_block_height': height},\n+        }\n+        self.wait_until(lambda: self.nodes[0].getindexinfo() == expected_filter)\n+\n+        expected_stats = {\n+            'coinstatsindex': {'synced': True, 'best_block_height': height}\n+        }\n+        self.wait_until(lambda: self.nodes[1].getindexinfo() == expected_stats)\n+\n+        expected = {**expected_filter, **expected_stats}\n+        self.wait_until(lambda: self.nodes[2].getindexinfo() == expected)\n+\n+    def reconnect_nodes(self):\n+        self.connect_nodes(0,1)\n+        self.connect_nodes(0,2)\n+        self.connect_nodes(1,2)\n+        self.connect_nodes(2,1)\n+\n+    def mine_batches(self, n):\n+        for _ in range(n):\n+            self.nodes[0].generate(250)\n+            self.sync_blocks()\n+\n+    def run_test(self):\n+        filter_nodes = [self.nodes[0], self.nodes[2]]\n+        stats_nodes = [self.nodes[1], self.nodes[2]]\n+\n+        self.log.info(\"check if we can access blockfilters and coinstats when pruning is enabled but no blocks are actually pruned\")\n+        self.sync_index(height=200)\n+        tip = self.nodes[0].getbestblockhash()\n+        for node in filter_nodes:\n+            assert_greater_than(len(node.getblockfilter(tip)['filter']), 0)\n+        for node in stats_nodes:\n+            assert(node.gettxoutsetinfo(hash_type=\"muhash\", hash_or_height=tip)['muhash'])\n+\n+        # Mine two batches of blocks to avoid hitting NODE_NETWORK_LIMITED_MIN_BLOCKS disconnection\n+        self.mine_batches(2)\n+        self.sync_index(height=700)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r654789987",
      "id" : 654789987,
      "line" : 62,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NDc4OTk4Nw==",
      "original_commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "test/functional/feature_index_prune.py",
      "position" : 62,
      "pull_request_review_id" : 687813168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-19T12:31:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654789987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r659805048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659805048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Error building this branch at e365e87a72cc4 rebased to current master at 8cdf91735f2b, looks like it needs updating:\r\n```rake\r\nindex/base.cpp:373:9: error: use of undeclared identifier 'g_chainman'\r\n        g_chainman.m_blockman.UpdatePruneBlocker(GetName(), block ? block : ::ChainActive().Genesis());\r\n        ^\r\nindex/base.cpp:373:79: error: no member named 'ChainActive' in the global namespace\r\n        g_chainman.m_blockman.UpdatePruneBlocker(GetName(), block ? block : ::ChainActive().Genesis());\r\n                                                                            ~~^\r\n2 errors generated.\r\n```\r\n",
      "commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "created_at" : "2021-06-28T13:50:49Z",
      "diff_hunk" : "@@ -370,3 +366,11 @@ IndexSummary BaseIndex::GetSummary() const\n     summary.best_block_height = m_best_block_index ? m_best_block_index.load()->nHeight : 0;\n     return summary;\n }\n+\n+void BaseIndex::SetBestBlockIndex(const CBlockIndex* block) {\n+    m_best_block_index = block;\n+    if (AllowPrune() && (fPruneMode || fHavePruned) && !fReindex) {\n+        LOCK(::cs_main);\n+        g_chainman.m_blockman.UpdatePruneBlocker(GetName(), block ? block : ::ChainActive().Genesis());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r659805048",
      "id" : 659805048,
      "line" : 374,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTgwNTA0OA==",
      "original_commit_id" : "e365e87a72cc49e175b31256a11a6c5b1621d1f2",
      "original_line" : 374,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 84,
      "pull_request_review_id" : 693981880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-28T13:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659805048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nudge to update.",
      "created_at" : "2021-07-20T10:15:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-883275390",
      "id" : 883275390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "IC_kwDOABII5840pbZ-",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-20T10:15:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/883275390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed from high-prio for now due to inactivity, but can be added back",
      "created_at" : "2021-07-20T14:38:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-883447438",
      "id" : 883447438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "IC_kwDOABII5840qFaO",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-20T14:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/883447438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-07-28T17:10:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-888476972",
      "id" : 888476972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "IC_kwDOABII58409RUs",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-28T17:10:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/888476972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
