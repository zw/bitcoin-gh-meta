[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is it known to be true that every call to LogPrint has no expressions with\nside effects?\n\nOn Tue, Oct 22, 2019, 11:28 AM Jeffrey Czyz <notifications@github.com>\nwrote:\n\n> Calling LogPrint with a category that is not enabled results in\n> evaluating the remaining function arguments, which may be arbitrarily\n> complex (and possibly expensive) expressions. Defining LogPrint as a\n> macro prevents this unnecessary expression evaluation.\n>\n> This is a partial revert of #14209\n> <https://github.com/bitcoin/bitcoin/pull/14209>. The decision to revert\n> is discussed\n> in #16688 <https://github.com/bitcoin/bitcoin/pull/16688>, which adds\n> verbose logging for validation event notification.\n> ------------------------------\n> You can view, comment on, or merge this pull request online at:\n>\n>   https://github.com/bitcoin/bitcoin/pull/17218\n> Commit Summary\n>\n>    - Replace the LogPrint function with a macro\n>\n> File Changes\n>\n>    - *M* src/logging.h\n>    <https://github.com/bitcoin/bitcoin/pull/17218/files#diff-0> (12)\n>\n> Patch Links:\n>\n>    - https://github.com/bitcoin/bitcoin/pull/17218.patch\n>    - https://github.com/bitcoin/bitcoin/pull/17218.diff\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/17218?email_source=notifications&email_token=AAGYN67LZZ4C7NCSPBAFEVDQP5A4VA5CNFSM4JDTSZXKYY3PNVWWK3TUL52HS4DFUVEXG43VMWVGG33NNVSW45C7NFSM4HTSVB2A>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAGYN67C6XATDCTWFXGPE6TQP5A4VANCNFSM4JDTSZXA>\n> .\n>\n",
      "created_at" : "2019-10-22T18:55:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545104442",
      "id" : 545104442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTEwNDQ0Mg==",
      "updated_at" : "2019-10-22T18:55:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545104442",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337702226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337702226"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just a suggestion, but it might be good to leave existing LogPrint function alone, and instead just add a new `LOG_CATEGORY(category, format, ...)` macro. This would avoid issue the Jeremy raised about side effects in existing code, and also be nicer in my opinion because uppercase naming would be more consistent with other macros.",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-22T19:16:14Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337702226",
      "id" : 337702226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzcwMjIyNg==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 305446649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-22T20:45:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337702226",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337705213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337705213"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd prefer to see a developer comment to explain why this is a macro (not a function like `LogPrintf` just a few lines up).\r\n\r\noptional: You may install `clang-format` and run the https://github.com/bitcoin/bitcoin/tree/master/contrib/devtools#clang-format-diffpy script to align the newline continuation chars `\\`.",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-22T19:23:26Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337705213",
      "id" : 337705213,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzcwNTIxMw==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 305450473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-22T20:45:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337705213",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is this a pure optimisation PR, or can we think of reasons beyond that?\r\n\r\nDo we have any examples of slow `LogPrint(â¦)` calls where this would make a significant difference?\r\n\r\nCan we benchmark this in any way?\r\n",
      "created_at" : "2019-10-22T20:08:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545131818",
      "id" : 545131818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTEzMTgxOA==",
      "updated_at" : "2019-10-22T20:08:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545131818",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337741803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337741803"
         }
      },
      "author_association" : "NONE",
      "body" : "Done in 8734c85.",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-22T20:47:08Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337741803",
      "id" : 337741803,
      "in_reply_to_id" : 337705213,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzc0MTgwMw==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 305497516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-22T20:47:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337741803",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337746958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337746958"
         }
      },
      "author_association" : "NONE",
      "body" : "My feeling is that providing two ways to log where one is subtly different than the other adds unnecessary cognitive load to readers and reviewers. Will address Jeremey's comment in a follow-up.",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-22T20:58:23Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337746958",
      "id" : 337746958,
      "in_reply_to_id" : 337702226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzc0Njk1OA==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 305504169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-22T20:58:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337746958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've thought about it a bit and I think for the reason I gave above I'd\nwant to NACK this change.\n\nIf there are motivating examples for not evaluating the calls, they should\nbe fixed one by one.\n\nIt would also seem like perfect forwarding and inline can help with some of\nthese concerns too to nudge the compiler to defer constructing strings or\nwhatever.\n\nOn Tue, Oct 22, 2019, 1:47 PM Jeffrey Czyz <notifications@github.com> wrote:\n\n> *@jkczyz* commented on this pull request.\n> ------------------------------\n>\n> In src/logging.h\n> <https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337741803>:\n>\n> > @@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n>      }\n>  }\n>\n> -template <typename... Args>\n> -static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n> -{\n> -    if (LogAcceptCategory((category))) {\n> -        LogPrintf(args...);\n> -    }\n> -}\n> +#define LogPrint(category, ...) do { \\\n>\n> Done in 8734c85\n> <https://github.com/bitcoin/bitcoin/commit/8734c856f85cb506fa97596383dd7e7b9edd7e03>\n> .\n>\n> â\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/17218?email_source=notifications&email_token=AAGYN6ZCEVD7RSKFT4WLQPTQP5RGBA5CNFSM4JDTSZXKYY3PNVWWK3TUL52HS4DFWFIHK3DMKJSXC5LFON2FEZLWNFSXPKTDN5WW2ZLOORPWSZGOCI2YLLA#discussion_r337741803>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAGYN636IOUCRCYGJ2VKPFDQP5RGBANCNFSM4JDTSZXA>\n> .\n>\n",
      "created_at" : "2019-10-22T21:01:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545153543",
      "id" : 545153543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTE1MzU0Mw==",
      "updated_at" : "2019-10-22T21:01:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545153543",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Is it known to be true that every call to LogPrint has no expressions with side effects?\r\n\r\nI grepped over call sites to check if anything suspicious stood out, but I did not thoroughly check if each expression was free of side effects.\r\n\r\nNote that this PR simply reverts the unintended behavioral change of #14209. Any side effects would have been introduced by that PR or subsequent changes.\r\n\r\n> If there are motivating examples for not evaluating the calls, they should\r\nbe fixed one by one.\r\n\r\nThe motivating example is #16688. I think this change is relatively low risk and restores the previous behavior of `LogPrint`. The alternative of adding a separate logging function would move the codebase into a worse state, IMHO. That should be weighed against the perceived risk of removing any unintended side effects.\r\n\r\n> It would also seem like perfect forwarding and inline can help with some of\r\nthese concerns too to nudge the compiler to defer constructing strings or\r\nwhatever.\r\n\r\nI don't believe perfect forwarding will prevent an argument expression from being evaluated, which is the reason for the PR. The compiler is also free to ignore `inline`.",
      "created_at" : "2019-10-22T22:00:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545174764",
      "id" : 545174764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTE3NDc2NA==",
      "updated_at" : "2019-10-22T22:00:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545174764",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Is this a pure optimisation PR, or can we think of reasons beyond that?\r\n> \r\n> Do we have any examples of slow `LogPrint(â¦)` calls where this would make a significant difference?\r\n> \r\n> Can we benchmark this in any way?\r\n\r\nI see it more as restoring the previous behavior of only paying for the logging that you want. Thus, anyone is free to add very verbose logging to their module without others incurring a cost when logging for that category isn't enabled.",
      "created_at" : "2019-10-22T22:19:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545180347",
      "id" : 545180347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTE4MDM0Nw==",
      "updated_at" : "2019-10-22T22:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545180347",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337775930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337775930"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> My feeling is that providing two ways to log where one is subtly different than the other adds unnecessary cognitive load to readers and reviewers. Will address Jeremey's comment in a follow-up.\r\n\r\nIf the concern is cognitive load, I'd think the current:\r\n\r\n- `LogPrintf` - log unconditionally\r\n- `LogPrint` - log for category\r\n\r\nis more confusing than what I'm proposing:\r\n\r\n- `LogPrintf` - log unconditionally\r\n- `LOG_CATEGORY` - log for category with macro magic\r\n\r\nBut if it would take a long time to deprecate `LogPrint` (not sure why it would), then I agree inconsistency would not look nice in the interim.\r\n\r\nI don't feel strongly any way about this, so please ignore this suggestion if doesn't suit you.",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-22T22:19:05Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337775930",
      "id" : 337775930,
      "in_reply_to_id" : 337702226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzc3NTkzMA==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 305541239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-22T22:20:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337775930",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337779900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337779900"
         }
      },
      "author_association" : "NONE",
      "body" : "Ah, I thought you were suggesting `LogPrint`, `LogPrintf`, and `LOG_CATEGORY`.\r\n\r\nI'm not completely opposed to changing call sites to `LOG_CATEGORY` (and checking for side effects in the process). But I would like to be sure such a change would be welcome before putting in the work. :)",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-22T22:34:02Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337779900",
      "id" : 337779900,
      "in_reply_to_id" : 337702226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzc3OTkwMA==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 305546338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-22T22:34:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337779900",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah didn't catch that it's reverting behavior.\n\nI think that given that it's a revert it's more ok.\n\nIt's tricky to tell by glance if there are no side effects because of\natomics autoderef loading and stuff, which is why I felt it deserves\ncareful consideration.\n\nI don't care to bikeshed too much, but I think that making it IF_CAT(cat,\nexpr) would be semantic in terms of implying the arguments may not be\nevaluated, and then expr can be an unconditional Logprint. But that's a few\nextra characters... I wouldn't object if expr is passed to LogPrint in the\nmacro, but feel it's a bit harder to comprehend at a glance.\n\nOn Tue, Oct 22, 2019, 3:34 PM Jeffrey Czyz <notifications@github.com> wrote:\n\n> *@jkczyz* commented on this pull request.\n> ------------------------------\n>\n> In src/logging.h\n> <https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337779900>:\n>\n> > @@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n>      }\n>  }\n>\n> -template <typename... Args>\n> -static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n> -{\n> -    if (LogAcceptCategory((category))) {\n> -        LogPrintf(args...);\n> -    }\n> -}\n> +#define LogPrint(category, ...) do { \\\n>\n> Ah, I thought you were suggesting LogPrint, LogPrintf, and LOG_CATEGORY.\n>\n> I'm not completely opposed to changing call sites to LOG_CATEGORY (and\n> checking for side effects in the process). But I would like to be sure such\n> a change would be welcome before putting in the work. :)\n>\n> â\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/17218?email_source=notifications&email_token=AAGYN67PZ3X5Z2MVSRXTJFDQP55W5A5CNFSM4JDTSZXKYY3PNVWWK3TUL52HS4DFWFIHK3DMKJSXC5LFON2FEZLWNFSXPKTDN5WW2ZLOORPWSZGOCI3EIYQ#discussion_r337779900>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAGYN6Z3TFDBZLZOUXAEQITQP55W5ANCNFSM4JDTSZXA>\n> .\n>\n",
      "created_at" : "2019-10-22T22:48:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545188419",
      "id" : 545188419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTE4ODQxOQ==",
      "updated_at" : "2019-10-22T22:48:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545188419",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I see it more as restoring the previous behavior of only paying for the logging that you want. Thus, anyone is free to add very verbose logging to their module without others incurring a cost when logging for that category isn't enabled.\r\n\r\nIn other types of software that is universally a good idea, but it could be argued that in Bitcoin Core we want to make sure that execution of consensus critical code should be as identical as possible across clients. See sipas arguments in #4576 regarding always evaluating arguments to not have uncertainty what performance impact consistency checks.\r\n\r\nWhen it comes to consensus critical code it could be argued that consistency in taken code paths is often more important than raw execution speed.\r\n\r\nIf we want to put that principle aside we should have good reasons for doing so: that's why it is important to benchmark a change like this. Is the performance impact measurable in practice?",
      "created_at" : "2019-10-23T06:08:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545283628",
      "id" : 545283628,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTI4MzYyOA==",
      "updated_at" : "2019-10-23T06:09:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545283628",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~~Concept NACK, this used to be a macro in the past. We changed it to a function for argument hygiene as is common in modern C++.~~\r\n\r\n~~If you really need to log in performance-critical contexts, then you could do a special thing there, but I'm very much against changing the general log system for this.~~\r\n\r\nNever mind, I was confused here. It still uses an internal function for that. The whole point here was to be able to shortcut in case logging for the category was disabledâ¦\r\n\r\nI think the assumption in  #14209 was that an inline was just as good as a macro in this regard. Have you benchmarked this?",
      "created_at" : "2019-10-23T08:35:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545333791",
      "id" : 545333791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTMzMzc5MQ==",
      "updated_at" : "2019-10-23T09:17:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545333791",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337957363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337957363"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I would like to be sure such a change would be welcome before putting in the work. :)\r\n\r\nTo be clear, suggestion is _not_ to do more work. My suggestion is:\r\n\r\n1. Add your new macro with a name like `LOG_CATEGORY`, to be clear that it is a macro and not something that evaluated like a normal function.\r\n2. Leave `LogPrint` alone, mark it deprecated and add a note like \"LOG_CATEGORY is preferred over LogPrint in new code as a more performant alternative\"\r\n\r\nSeparately after that, I do not think it would take a lot of work to replace instances of `LogPrint` and remove it. We could start with a simple [scripted-diff](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#scripted-diffs) to replace simple variable references that obviously don't have side effects.\r\n\r\n```sh\r\ngit grep -l LogPrint | xargs sed -i 's/LogPrint\\((BCLog::[A-Z]\\+, \"[^\"]\\+\"\\(, [A-Za-z_]\\+\\)*)\\)/LOG_CATEGORY\\1/g'\r\n```\r\n\r\nAs for organizing these changes, I might consider closing this PR, and instead adding the new macro directly where you intend to use it in #16688.",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-23T10:01:33Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337957363",
      "id" : 337957363,
      "in_reply_to_id" : 337702226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzk1NzM2Mw==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 305771888,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-23T10:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337957363",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think the assumption in #14209 was that an inline was just as good as a macro in this regard. Have you benchmarked this?\r\n\r\nPracticalswift asked the same question yesterday and this hasn't been benchmarked yet. It might be the case that performance is roughly equivalent, but if by \"just as good\" you mean actually equivalent, it's probably not a good assumption that compilers are going to be able to deduce that calls like `pindex->GetBlockHash().GetHex()` have no side-effects and inline them out.",
      "created_at" : "2019-10-23T10:05:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545369956",
      "id" : 545369956,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTM2OTk1Ng==",
      "updated_at" : "2019-10-23T10:06:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545369956",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > I see it more as restoring the previous behavior of only paying for the logging that you want. Thus, anyone is free to add very verbose logging to their module without others incurring a cost when logging for that category isn't enabled.\r\n> \r\n> In other types of software that is universally a good idea, but it could be argued that in Bitcoin Core we want to make sure that execution of consensus critical code should be as identical as possible across clients. See sipas arguments in #4576 regarding always evaluating arguments to not have uncertainty what performance impact consistency checks.\r\n> \r\n> When it comes to consensus critical code it could be argued that consistency in taken code paths is often more important than raw execution speed.\r\n\r\nHmmm, in that case the current behavior is actually inconsistent. If the compiler decides to inline the code at a particular call site, then the arguments will not be evaluated whereas they will be evaluated at call sites that are not inlined.\r\n\r\n",
      "created_at" : "2019-10-23T17:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545540333",
      "id" : 545540333,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTU0MDMzMw==",
      "updated_at" : "2019-10-23T17:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545540333",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > I think the assumption in #14209 was that an inline was just as good as a macro in this regard. Have you benchmarked this?\r\n> \r\n> Practicalswift asked the same question yesterday and this hasn't been benchmarked yet. It might be the case that performance is roughly equivalent, but if by \"just as good\" you mean actually equivalent, it's probably not a good assumption that compilers are going to be able to deduce that calls like `pindex->GetBlockHash().GetHex()` have no side-effects and inline them out.\r\n\r\nCorrect, I have not benchmarked the code. I'm not even sure how to adequately devise such a benchmark given the compiler can decide which call sites will have the code inlined. At very least, use of a macro will result in consistent behavior with regards to argument evaluation.",
      "created_at" : "2019-10-23T17:06:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545542648",
      "id" : 545542648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTU0MjY0OA==",
      "updated_at" : "2019-10-23T17:06:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545542648",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r338171908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338171908"
         }
      },
      "author_association" : "NONE",
      "body" : "Understood. I would be fine with that assuming there is agreement that `LogPrint` should be deprecated in favor of the `LOG_CATEGORY` macro.",
      "commit_id" : "8734c856f85cb506fa97596383dd7e7b9edd7e03",
      "created_at" : "2019-10-23T17:10:17Z",
      "diff_hunk" : "@@ -155,12 +155,10 @@ static inline void LogPrintf(const char* fmt, const Args&... args)\n     }\n }\n \n-template <typename... Args>\n-static inline void LogPrint(const BCLog::LogFlags& category, const Args&... args)\n-{\n-    if (LogAcceptCategory((category))) {\n-        LogPrintf(args...);\n-    }\n-}\n+#define LogPrint(category, ...) do { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#discussion_r338171908",
      "id" : 338171908,
      "in_reply_to_id" : 337702226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODE3MTkwOA==",
      "original_commit_id" : "93e8f7a833a03a0add51612d1fcac557af51359c",
      "original_position" : 11,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 306051754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17218",
      "updated_at" : "2019-10-23T17:10:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338171908",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">t's probably not a good assumption that compilers are going to be able to deduce that calls like pindex->GetBlockHash().GetHex() have no side-effects and inline them out.\r\n\r\nMaybe we should look at the gnu::pure attribute (which have pretty wide support in gcc/clang/llvm and others, except MSVC) and noexcept, which would allow the compiler to better optimize such functions if this is an issue https://stackoverflow.com/questions/2798188/pure-const-function-attributes-in-different-compilers",
      "created_at" : "2019-10-23T17:45:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-545558546",
      "id" : 545558546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTU1ODU0Ng==",
      "updated_at" : "2019-10-23T17:45:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545558546",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "So, uh, no real direct input but at one point while reworking the logging for categories I changed the handling around and benchmarking as a function vs macro vs a few other things and found measurably slower validation (in particular early chain IBD which is already pretty fast), it was also easy to see it doing string parsing in the disassembly.\r\n\r\nThere is another option beyond making this a macro:  find the few performance critical logging spots and block them off with category tests (potentially just copying the current logging state into a local variable).  This should be even faster than the macro, since you could eliminate many logging lines with potentially just one access to the contended global state.\r\n",
      "created_at" : "2019-10-29T21:49:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-547645300",
      "id" : 547645300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NzY0NTMwMA==",
      "updated_at" : "2019-10-29T21:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547645300",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it's fine to do this. I strongly doubt there is any logging (especially categorized debug logging) with important side-effects. Not too long ago this was a macro. At least I've always treated it as one.\r\n\r\nIf @marcofalke's concerns in #14209 no longer hold, ACK.",
      "created_at" : "2019-10-30T16:07:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-547983806",
      "id" : 547983806,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0Nzk4MzgwNg==",
      "updated_at" : "2019-10-30T16:07:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547983806",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. I think it's safer if this lives as a macro for the reasons described in the original post, and this especially shouldn't be controversial since (as others have noted) this was up until fairly recently a macro.",
      "created_at" : "2019-10-30T16:49:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-548004387",
      "id" : 548004387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODAwNDM4Nw==",
      "updated_at" : "2019-10-30T16:49:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548004387",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "My motivation for #14209  was to get code coverage test run, which was impossible prior to my fix. I don't care whether it is a function or macro.\r\n\r\nSomeone should do a benchmark, though if the rationale for this change is \"speed up\".",
      "created_at" : "2019-10-30T17:22:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-548020087",
      "id" : 548020087,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODAyMDA4Nw==",
      "updated_at" : "2019-10-30T17:22:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548020087",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Someone should do a benchmark, though if the rationale for this change is \"speed up\".\r\n\r\nFrom what I understand  it's not a benchmark issue but a conceptual one. Macros don't have the guarantee to evaluate their arguments, but functions (even inline functions) do. Given arguments that are expensive to compute (e.g. string formatting, allocation, conversions), that's will always make a difference in the disabled case.\r\n",
      "created_at" : "2019-10-30T18:22:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-548048802",
      "id" : 548048802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODA0ODgwMg==",
      "updated_at" : "2019-10-31T08:46:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548048802",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Our bench runner has a full testing setup, so in theory `LogPrint*` could be microbenched",
      "created_at" : "2019-10-31T19:04:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-548523902",
      "id" : 548523902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODUyMzkwMg==",
      "updated_at" : "2019-10-31T19:04:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548523902",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 8734c856f85cb506fa97596383dd7e7b9edd7e03\r\n\r\n> My motivation for #14209 was to get code coverage test run, which was impossible prior to my fix. I don't care whether it is a function or macro.\r\n\r\nWhether it is a function or macro seems completely orthogonal to this. The simple fix in #14209 would have just been to remove the ifdef preprocessor directive added here: https://github.com/bitcoin/bitcoin/commit/c8914b9dbbf6106dac3c62769f7ce3bacd8fbf9b#diff-772f489c7d0a32de3badbfbcb5fd200dR133.\r\n\r\nThe renaming `LogPrintf` -> `LOG_CATEGORY` suggested here https://github.com/bitcoin/bitcoin/pull/17218#discussion_r337957363 seems like a good follow-up.\r\n\r\nHere are all the `LogPrintf` changes since #14209 was merged:\r\n\r\n```\r\ngit log fae3fbd61a89c7a35bc0eda91b1df61371dc0936..HEAD -SLogPrintf -p | grep \"^[+-]\" | grep LogPrintf\r\n-                pwallet->WalletLogPrintf(\"Skipping import of %s (key already present)\\n\", EncodeDestination(PKHash(keyid)));\r\n+                pwallet->WalletLogPrintf(\"Error importing key for %s\\n\", EncodeDestination(PKHash(keyid)));\r\n-                pwallet->WalletLogPrintf(\"Skipping import of %s (script already present)\\n\", HexStr(script));\r\n+        LogPrintf(\"Error reading from database: %s\\n\", e.what());\r\n-            LogPrintf(\"Error reading from database: %s\\n\", e.what());\r\n+            WalletLogPrintf(\"Already have script %s, skipping\\n\", HexStr(entry));\r\n+            WalletLogPrintf(\"Already have key with pubkey %s, skipping\\n\", HexStr(pubkey));\r\n+            WalletLogPrintf(\"Already have pubkey %s, skipping\\n\", HexStr(temp));\r\n-            LogPrintf(\"The wallet is probably corrupted: Some keys decrypt but not all.\\n\");\r\n+            LogPrintf(\"The wallet is probably corrupted: Some keys decrypt but not all.\\n\");\r\n-    // This can be called during exceptions by LogPrintf(), so we cache the\r\n-    // This can be called during exceptions by LogPrintf(), so we cache the\r\n-    LogPrintf(\"\\n\\n\\n\\n\\n\");\r\n-        LogPrintf(\"%s: Connecting genesis block...\\n\", __func__);\r\n-            LogPrintf(\"%s: failed to activate chain (%s)\\n\", __func__, FormatStateMessage(state));\r\n-    LogPrintf(\"Using wallet directory %s\\n\", GetWalletDir().string());\r\n+    LogPrintf(\"Using wallet directory %s\\n\", GetWalletDir().string());\r\n+        LogPrintf(\"* Using %.1f MiB for %s block filter index database\\n\",\r\n+            LogPrintf(\"%s: Failed to open filter file %d\\n\", __func__, pos.nFile);\r\n+            LogPrintf(\"%s: Failed to truncate filter file %d\\n\", __func__, pos.nFile);\r\n+            LogPrintf(\"%s: Failed to commit filter file %d\\n\", __func__, pos.nFile);\r\n+        LogPrintf(\"%s: out of disk space\\n\", __func__);\r\n+        LogPrintf(\"%s: Failed to open filter file %d\\n\", __func__, pos.nFile);\r\n+    if (ec) LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), path.string());\r\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\r\n+                LogPrintf(\"%s\\n\", e.what());\r\n+                LogPrintf(\"Pre-allocating up to position 0x%x in %s%05u.dat\\n\", new_size, m_prefix, pos.nFile);\r\n-                    LogPrintf(\"Pre-allocating up to position 0x%x in blk%05u.dat\\n\", nNewChunks * BLOCKFILE_CHUNK_SIZE, pos.nFile);\r\n-                LogPrintf(\"Pre-allocating up to position 0x%x in rev%05u.dat\\n\", nNewChunks * UNDOFILE_CHUNK_SIZE, pos.nFile);\r\n+        LogPrintf(\"Unable to open file %s\\n\", path.string());\r\n+            LogPrintf(\"Unable to seek to position %u of %s\\n\", pos.nPos, path.string());\r\n-        LogPrintf(\"Unable to open file %s\\n\", path.string());\r\n-            LogPrintf(\"Unable to seek to position %u of %s\\n\", pos.nPos, path.string());\r\n+        LogPrintf(\"Using RdSeed as additional entropy source\\n\");\r\n+            LogPrintf(\"%s: Unable to remove PID file: File does not exist\\n\", __func__);\r\n-        LogPrintf(\"%s: Unable to remove pidfile: %s\\n\", __func__, e.what());\r\n+        LogPrintf(\"%s: Unable to remove PID file: %s\\n\", __func__, e.what());\r\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\r\n-            LogPrintf(\"%s: Warning: RegQueryValueExA(HKEY_PERFORMANCE_DATA) failed with code %i\\n\", __func__, ret);\r\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\r\n-        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\r\n-            LogPrintf(\"HTTP event loop did not exit within allotted time, sending loopbreak\\n\");\r\n+                LogPrintf(\"WARNING: the RPC server is not safe to expose to untrusted networks such as the public internet\\n\");\r\n+            LogPrintf(\"WARNING: option -rpcallowip was specified without -rpcbind; this doesn't usually make sense\\n\");\r\n-        LogPrintf(\"Warning: Config setting for %s only applied on %s network when in [%s] section.\\n\", arg, m_network, m_network);\r\n+- #10265 `ff13f59` Make sure pindex is non-null before possibly referencing in LogPrintf call. (Karl-Johan Alm)\r\n+                LogPrintf(\"Setting version bits activation parameters for %s to start=%ld, timeout=%ld\\n\", vDeploymentParams[0], nStartTime, nTimeout);\r\n-                    LogPrintf(\"Setting version bits activation parameters for %s to start=%ld, timeout=%ld\\n\", vDeploymentParams[0], nStartTime, nTimeout);\r\n+                LogPrintf(\"[%d%%]...\", percentageDone); /* Continued */\r\n```\r\n\r\nNone of the new logs with printf args have side-effects:\r\n\r\n```\r\n+            WalletLogPrintf(\"Already have script %s, skipping\\n\", HexStr(entry));   // HexStr() has no side-effects\r\n+            WalletLogPrintf(\"Already have key with pubkey %s, skipping\\n\", HexStr(pubkey));   // HexStr() has no side-effects\r\n+            WalletLogPrintf(\"Already have pubkey %s, skipping\\n\", HexStr(temp));   // HexStr() has no side-effects\r\n+        LogPrintf(\"* Using %.1f MiB for %s block filter index database\\n\",    // BlockFilterTypeName() has no side-effects\r\n+            LogPrintf(\"%s: Failed to open filter file %d\\n\", __func__, pos.nFile);   // no side-effects\r\n+            LogPrintf(\"%s: Failed to truncate filter file %d\\n\", __func__, pos.nFile);   // no side-effects\r\n+            LogPrintf(\"%s: Failed to commit filter file %d\\n\", __func__, pos.nFile);   // no side-effects\r\n+        LogPrintf(\"%s: out of disk space\\n\", __func__);   // no side-effects\r\n+        LogPrintf(\"%s: Failed to open filter file %d\\n\", __func__, pos.nFile);   // no side-effects\r\n+    if (ec) LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), path.string());   // boost::system::error_code::message() and boost::filesystem::path::string() have no side-effects\r\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());   // boost::system::error_code::message() and boost::filesystem::path::string() have no side-effects\r\n+                LogPrintf(\"%s\\n\", e.what());   // std::exception::what() has no side-effects\r\n+                LogPrintf(\"Pre-allocating up to position 0x%x in %s%05u.dat\\n\", new_size, m_prefix, pos.nFile);   // no side-effects\r\n+                LogPrintf(\"[%d%%]...\", percentageDone); /* Continued */   // no side-effects\r\n```\r\n\r\nSo merging this is at least as safe as we were prior to #14209.",
      "created_at" : "2019-10-31T21:20:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-548573442",
      "id" : 548573442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODU3MzQ0Mg==",
      "updated_at" : "2019-10-31T21:20:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548573442",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Our bench runner has a full testing setup, so in theory `LogPrint*` could be microbenched\r\n\r\nI ran the following benchmark configured with --enable-debug:\r\n\r\n```c++\r\n#include <bench/bench.h>\r\n#include <logging.h>\r\n#include <validation.h>\r\n\r\nstatic void BenchmarkLogPrint(benchmark::State& state)\r\n{\r\n    LOCK(cs_main);\r\n    CBlockIndex* tip = ::ChainActive().Tip();\r\n    assert(tip != nullptr);\r\n\r\n    while (state.KeepRunning()) {\r\n        LogPrint(BCLog::NET, \"%s: new block hash=%s\", __func__, tip->GetBlockHash().ToString());\r\n    }\r\n}\r\n\r\nBENCHMARK(BenchmarkLogPrint, 10 * 1000 * 1000);\r\n```\r\n\r\n`LogPrint` as an inline function:\r\n\r\n```\r\n# Benchmark, evals, iterations, total, min, max, median\r\nBenchmarkLogPrint, 5, 10000000, 28.4183, 5.64534e-07, 5.76267e-07, 5.66845e-07\r\n```\r\n\r\n`LogPrint` as a macro:\r\n\r\n```\r\n# Benchmark, evals, iterations, total, min, max, median\r\nBenchmarkLogPrint, 5, 10000000, 0.356953, 6.8946e-09, 7.80663e-09, 6.92364e-09\r\n```\r\n\r\nLooks like it's a couple of orders of magnitude faster as a macro. Let me know if there is something more representative to run.",
      "created_at" : "2019-10-31T22:56:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17218#issuecomment-548601061",
      "id" : 548601061,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17218",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODYwMTA2MQ==",
      "updated_at" : "2019-10-31T22:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548601061",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   }
]
