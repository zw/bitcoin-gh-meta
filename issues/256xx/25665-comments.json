[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926651294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926651294"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This pull changes both the interface, as well as the internal representation. I wonder if changing the interface and renames can be done separate from the restructuring.\r\n\r\nHopefully those would be uncontroversial and could be reviewed easier/faster, so that less silent merge conflicts arise as the class gets used more and more. Also, less code will need to be changes if the interface changes are made earlier rather than later.",
      "commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "created_at" : "2022-07-21T13:05:47Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926651294",
      "id" : 926651294,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII5843O5Oe",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 5,
      "pull_request_review_id" : 1046496463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926651294/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T13:07:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926651294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926658150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926658150"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> This pull changes both the interface, as well as the internal representation. I wonder if changing the interface and renames can be done separate from the restructuring.\r\n\r\nOnly the third commit drops BResult usages, so the answer should be yes. IMO std::optional has a nice interface and it is a shame to reinvent it with stranger HasRes GetObj ReleaseObj methods.",
      "commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "created_at" : "2022-07-21T13:12:19Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926658150",
      "id" : 926658150,
      "in_reply_to_id" : 926651294,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII5843O65m",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 5,
      "pull_request_review_id" : 1046506217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926658150/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T13:12:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926658150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926660730"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926660730"
         }
      },
      "author_association" : "MEMBER",
      "body" : "With separate I meant separate pulls :sweat_smile: ",
      "commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "created_at" : "2022-07-21T13:14:54Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926660730",
      "id" : 926660730,
      "in_reply_to_id" : 926651294,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII5843O7h6",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 5,
      "pull_request_review_id" : 1046510212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926660730/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T13:14:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926660730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Draft PR since I want to add a commit taking advantages of ability to return chain results and return warnings.",
      "created_at" : "2022-07-21T13:18:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1191475306",
      "id" : 1191475306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585HBHhq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191475306/reactions"
      },
      "updated_at" : "2022-07-21T13:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191475306",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926667440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926667440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> With separate I meant separate pulls sweat_smile\r\n\r\nOh sorry, I thought you were asking literally if it is possible",
      "commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "created_at" : "2022-07-21T13:20:49Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r926667440",
      "id" : 926667440,
      "in_reply_to_id" : 926651294,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII5843O9Kw",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 5,
      "pull_request_review_id" : 1046519522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926667440/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T13:20:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926667440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/25665).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Approach ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1294756069) |\n| Stale ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1091053363), [stickies-v](https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1099419063), [hernanmarino](https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1423032563), [jonatack](https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1668402066), [achow101](https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1697964137), [maflcko](https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1602705708), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1842217136) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29231](https://github.com/bitcoin/bitcoin/pull/29231) (logging: Update to new logging API by ajtowns)\n* [#26022](https://github.com/bitcoin/bitcoin/pull/26022) (Add util::ResultPtr class by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-07-21T18:24:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1191801425",
      "id" : 1191801425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585HCXJR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191801425/reactions"
      },
      "updated_at" : "2024-02-21T19:16:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191801425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-22T07:54:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1192291131",
      "id" : 1192291131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585HEOs7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192291131/reactions"
      },
      "updated_at" : "2022-07-22T07:54:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192291131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927648344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927648344"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the stuff that can be split out:\r\n\r\n* Makes Result class provide same operators and methods as std::optional\r\n* Puts src/util/ code in the util:: namespace so naming reflects code organization and it is obvious where the class is coming from. Drops \"B\" from name because it is undocumented what it stands for (bilingual?)\r\n* Supports Result<bilingual_str> return values. Drops ambiguous and potentially misleading BResult constructor that treats any bilingual string as an error, and any other type as a non-error. Adds util::Error constructor so errors have to be explicitly constructed and not any bilingual_str will be turned into one.\r\n",
      "commit_id" : "358e0fe5f205048333a728df3a67041c1b2e5bd1",
      "created_at" : "2022-07-22T13:23:40Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927648344",
      "id" : 927648344,
      "in_reply_to_id" : 926651294,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII5843SspY",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 5,
      "pull_request_review_id" : 1047899737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927648344/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-22T13:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927648344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927703509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927703509"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think these things are already split out. The first two commits do not change the interface or naming or functionality of BResult in any way. If you want me to move the last commit to another, PR I can do that.",
      "commit_id" : "358e0fe5f205048333a728df3a67041c1b2e5bd1",
      "created_at" : "2022-07-22T14:22:33Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927703509",
      "id" : 927703509,
      "in_reply_to_id" : 926651294,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII5843S6HV",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 5,
      "pull_request_review_id" : 1047980709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927703509/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-22T14:22:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927703509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927707935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927707935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I think that makes sense, so that we can first figure out the interface, and then start using it more widely, not the other way round.",
      "commit_id" : "358e0fe5f205048333a728df3a67041c1b2e5bd1",
      "created_at" : "2022-07-22T14:27:20Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927707935",
      "id" : 927707935,
      "in_reply_to_id" : 926651294,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII5843S7Mf",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 5,
      "pull_request_review_id" : 1047987255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927707935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-22T14:27:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927707935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r930446676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930446676"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927707935\r\n\r\n> Yeah, I think that makes sense, so that we can first figure out the interface, and then start using it more widely, not the other way round.\r\n\r\nThanks, moved to #25721 now and rewrote PR description\r\n",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-07-26T21:58:03Z",
      "diff_hunk" : "@@ -46,10 +46,10 @@ static void BenchUnloadWallet(std::shared_ptr<CWallet>&& wallet)\n static void AddTx(CWallet& wallet)\n {\n     const auto& dest = wallet.GetNewDestination(OutputType::BECH32, \"\");\n-    assert(dest.HasRes());\n+    assert(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r930446676",
      "id" : 930446676,
      "in_reply_to_id" : 926651294,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843dX1U",
      "original_commit_id" : "6a06a7c3ad264c0ddf4904949839be1ade8011a5",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : null,
      "pull_request_review_id" : 1051660331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930446676/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-27T19:29:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930446676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Moved out of draft, since result interface is more complete now and there's more code using it",
      "created_at" : "2022-07-27T19:32:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1197277837",
      "id" : 1197277837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585HXQKN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197277837/reactions"
      },
      "updated_at" : "2022-07-27T19:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197277837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "As said on the previous pull, I'd prefer if the order of the changes was inversed: First, change the existing interface methods and names, then change the internal class implementation. Otherwise we'll end up with the odd state of two classes that do the same thing but have a different name and people will continue to add more used of the \"deprecated\" class. I'd also find it easier to review an incremental diff than having a full separate implementation. But no strong opinion, if you and the other reviewers prefer it as-is now.\r\n\r\nEdit: My comment was https://github.com/bitcoin/bitcoin/pull/25665#discussion_r927707935 and I just realized that it was ambiguous and could be interpreted the opposite of what I meant.",
      "created_at" : "2022-07-27T19:44:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1197289390",
      "id" : 1197289390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585HXS-u",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197289390/reactions"
      },
      "updated_at" : "2022-07-27T19:51:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197289390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, Marco! I will just tweak #25721 to be a standalone PR instead of depending on this PR",
      "created_at" : "2022-07-27T20:13:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1197317760",
      "id" : 1197317760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585HXZ6A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197317760/reactions"
      },
      "updated_at" : "2022-07-27T20:13:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197317760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Thanks, Marco! I will just tweak #25721 to be a standalone PR instead of depending on this PR\r\n\r\nThis is done now",
      "created_at" : "2022-07-27T21:39:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1197397362",
      "id" : 1197397362,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585HXtVy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197397362/reactions"
      },
      "updated_at" : "2022-07-27T21:39:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197397362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-05T13:55:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1206486304",
      "id" : 1206486304,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585H6YUg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206486304/reactions"
      },
      "updated_at" : "2022-08-05T13:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206486304",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-05T13:55:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1206486310",
      "id" : 1206486310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585H6YUm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206486310/reactions"
      },
      "updated_at" : "2022-08-05T13:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206486310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased c2dc8a8a747d639acfa4a26db2c61c25b6f82571 -> 590bc615a3120a8f11712220546f9654058b82f0 ([`pr/bresult2.10`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.10) -> [`pr/bresult2.11`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.11), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.10-rebase..pr/bresult2.11)) due to conflicts with #25721",
      "created_at" : "2022-08-05T18:48:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1206754307",
      "id" : 1206754307,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585H7ZwD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206754307/reactions"
      },
      "updated_at" : "2022-08-05T18:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206754307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943776125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943776125"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since we're expecting `T` to be a container type, would this benefit from living in `span.h` for reusability? The generic implementation/naming isn't really necessary in `result.h`, and people won't come looking here when they need something to move elements between containers.",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-11T18:05:54Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943776125",
      "id" : 943776125,
      "line" : 28,
      "node_id" : "PRRC_kwDOABII5844QOF9",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 28,
      "original_position" : 21,
      "original_start_line" : 23,
      "path" : "src/util/result.h",
      "position" : 21,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943776125/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 23,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943776125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943789301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943789301"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    bilingual_str result{ErrorString(errors)};\r\n```",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-11T18:12:09Z",
      "diff_hunk" : "@@ -0,0 +1,24 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/result.h>\n+#include <util/string.h>\n+\n+namespace util {\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors)\n+{\n+    return Join(errors, Untranslated(\" \"));\n+}\n+\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings)\n+{\n+    bilingual_str result = ErrorString(errors);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943789301",
      "id" : 943789301,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5844QRT1",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/util/result.cpp",
      "position" : 16,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943789301/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943789301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943807162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943807162"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure why iwyu [doesn't](https://cirrus-ci.com/task/6358959639494656) catch it, but shouldn't `forward`, `types` and `utility` also be included here?",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-11T18:33:11Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943807162",
      "id" : 943807162,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII5844QVq6",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 15,
      "original_position" : 8,
      "original_start_line" : 11,
      "path" : "src/util/result.h",
      "position" : 8,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943807162/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 11,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943807162",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r944367210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944367210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could probably make sense to split this up and use it there: https://github.com/bitcoin/bitcoin/pull/25616#discussion_r942704207",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-12T11:18:55Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r944367210",
      "id" : 944367210,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5844SeZq",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 83,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 76,
      "pull_request_review_id" : 1070947229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944367210/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-12T11:18:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944367210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945167440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945167440"
         }
      },
      "author_association" : "NONE",
      "body" : "What is the difference between when the `this->m_info` is `true` and when it is `false`? While as far as I understand in both cases the `this->m_info` is destroyed and replaced by `other.m_info`.  Am I correct? So why bother to check `other.m_info && !this->m_info` and  `other.m_info && this->m_info`?",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-13T16:42:21Z",
      "diff_hunk" : "@@ -31,54 +148,84 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([this](auto&&... x) { this->InitFailure(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n+    {\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        Construct([this](auto&&... x) { this->InitValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945167440",
      "id" : 945167440,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII5844VhxQ",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 219,
      "original_position" : 232,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 232,
      "pull_request_review_id" : 1071979503,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945167440/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-13T16:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945167440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/54557628?v=4",
         "events_url" : "https://api.github.com/users/Riahiamirreza/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Riahiamirreza/followers",
         "following_url" : "https://api.github.com/users/Riahiamirreza/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Riahiamirreza/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Riahiamirreza",
         "id" : 54557628,
         "login" : "Riahiamirreza",
         "node_id" : "MDQ6VXNlcjU0NTU3NjI4",
         "organizations_url" : "https://api.github.com/users/Riahiamirreza/orgs",
         "received_events_url" : "https://api.github.com/users/Riahiamirreza/received_events",
         "repos_url" : "https://api.github.com/users/Riahiamirreza/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Riahiamirreza/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Riahiamirreza/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Riahiamirreza"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945184751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945184751"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> What is the difference between when the `this->m_info` is `true` and when it is `false`?\r\n\r\nThe implementation is optimized for the \"happy path\" where a success value is set and there is no failure value and no error or warning message strings. In the happy path case, `m_info` is null and no allocation is needed. Otherwise, if there has been any kind of error or warning `m_info` will be non-null.\r\n\r\n> While as far as I understand in both cases the `this->m_info` is destroyed and replaced by `other.m_info`.  Am I correct?\r\n\r\nNo that's not really correct. As the comment \"Operator moving warning and error messages from one result to another\" says, only warning and error strings are moved from `other` to `*this`. The success and value statuses of `other` and `*this` objects are unchanged, and the success and failure values of both objects (if any) are also unchanged. Existing warning and error strings in `*this` are also not affected, the new errors and warnings just get appended and don't replace existing one.\r\n\r\n> So why bother to check `other.m_info && !this->m_info` and `other.m_info && this->m_info`?\r\n\r\nI'm not sure what other code you might expect to see here, but in both cases this is just moving `other.m_info->errors` strings to `this->m_info->errors` and moving `other.m_info->warnings` strings to `this->m_info->warnings` while not deleting any existing strings and not changing `other.m_info->failure` and `this->m_info->failure` values.",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-13T20:02:49Z",
      "diff_hunk" : "@@ -31,54 +148,84 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([this](auto&&... x) { this->InitFailure(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n+    {\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        Construct([this](auto&&... x) { this->InitValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945184751",
      "id" : 945184751,
      "in_reply_to_id" : 945167440,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII5844Vl_v",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 219,
      "original_position" : 232,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 232,
      "pull_request_review_id" : 1071993521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945184751/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-13T20:03:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945184751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945529940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945529940"
         }
      },
      "author_association" : "NONE",
      "body" : "I don't understand why the `m_value` is in a `union` while there is only one member in the `union`? Would you explain why?",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-15T08:39:35Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    union { T m_value; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945529940",
      "id" : 945529940,
      "line" : 91,
      "node_id" : "PRRC_kwDOABII5844W6RU",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 91,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 84,
      "pull_request_review_id" : 1072373197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945529940/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-15T08:51:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945529940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/54557628?v=4",
         "events_url" : "https://api.github.com/users/Riahiamirreza/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Riahiamirreza/followers",
         "following_url" : "https://api.github.com/users/Riahiamirreza/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Riahiamirreza/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Riahiamirreza",
         "id" : 54557628,
         "login" : "Riahiamirreza",
         "node_id" : "MDQ6VXNlcjU0NTU3NjI4",
         "organizations_url" : "https://api.github.com/users/Riahiamirreza/orgs",
         "received_events_url" : "https://api.github.com/users/Riahiamirreza/received_events",
         "repos_url" : "https://api.github.com/users/Riahiamirreza/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Riahiamirreza/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Riahiamirreza/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Riahiamirreza"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945536621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945536621"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks for your explanation. My wrong assumption was that by replacing the warnings and errors the `this` is completely like the `other`, so why checking whether `this->m_info` is null or not. \r\nBut as you mentioned the success and value statuses remained unchanged.",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-15T08:49:22Z",
      "diff_hunk" : "@@ -31,54 +148,84 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([this](auto&&... x) { this->InitFailure(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n+    {\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        Construct([this](auto&&... x) { this->InitValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945536621",
      "id" : 945536621,
      "in_reply_to_id" : 945167440,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII5844W75t",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 219,
      "original_position" : 232,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 232,
      "pull_request_review_id" : 1072373197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945536621/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-15T08:49:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945536621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/54557628?v=4",
         "events_url" : "https://api.github.com/users/Riahiamirreza/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Riahiamirreza/followers",
         "following_url" : "https://api.github.com/users/Riahiamirreza/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Riahiamirreza/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Riahiamirreza",
         "id" : 54557628,
         "login" : "Riahiamirreza",
         "node_id" : "MDQ6VXNlcjU0NTU3NjI4",
         "organizations_url" : "https://api.github.com/users/Riahiamirreza/orgs",
         "received_events_url" : "https://api.github.com/users/Riahiamirreza/received_events",
         "repos_url" : "https://api.github.com/users/Riahiamirreza/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Riahiamirreza/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Riahiamirreza/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Riahiamirreza"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945688134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945688134"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't understand why the `m_value` is in a `union` while there is only one member in the `union`? Would you explain why?\r\n\r\nI'll add a code comment, but using a union avoids `m_value` getting constructor and destructor being called automatically, so in the failure case `m_value` is never constructed.",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-15T12:47:28Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    union { T m_value; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945688134",
      "id" : 945688134,
      "in_reply_to_id" : 945529940,
      "line" : 91,
      "node_id" : "PRRC_kwDOABII5844Xg5G",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 91,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 84,
      "pull_request_review_id" : 1072625079,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945688134/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-15T12:48:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945688134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945877898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945877898"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r944367210\r\n\r\n> Could probably make sense to split this up and use it there: [#25616 (comment)](https://github.com/bitcoin/bitcoin/pull/25616#discussion_r942704207)\r\n\r\nIs the suggestion to add the GetErrors() method in this PR, but delay adding the GetWarnings() method until followup PR  #25722? I could do that, but I don't think it would simplify this PR very much (it would remove a few lines) and it would add more churn to result implementation/documentation/unit tests review\r\n\r\n",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-15T15:31:51Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945877898",
      "id" : 945877898,
      "in_reply_to_id" : 944367210,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5844YPOK",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 83,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 76,
      "pull_request_review_id" : 1072845525,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945877898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-15T15:31:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945877898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945880218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945880218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, I was wondering if `GetWarnings` could be added by itself in the other pull, maybe conflicting with this one, but otherwise unrelated from this one.",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-15T15:34:24Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945880218",
      "id" : 945880218,
      "in_reply_to_id" : 944367210,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5844YPya",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 83,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 76,
      "pull_request_review_id" : 1072848647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945880218/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-15T15:34:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945880218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945881360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945881360"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This would allow reviewers to just look at the `GetWarnings` implementation, API, and proposed usage, without having to think about `union/void/...` etc.",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-15T15:35:48Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945881360",
      "id" : 945881360,
      "in_reply_to_id" : 944367210,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5844YQEQ",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 83,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 76,
      "pull_request_review_id" : 1072850297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945881360/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-15T15:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945881360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945935114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945935114"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945881360\r\n\r\n> This would allow reviewers to just look at the `GetWarnings` implementation, API, and proposed usage, without having to think about `union/void/...` etc.\r\n\r\nOh. I guess there could be a third PR independent of this PR and #25722 that adds a `std::vector<bilingual_str> m_warnings;` field to `util::Result` and `AddWarning()/GetWarnings()` methods. I don't think it would be as useful as you might be thinking without template constructors that can move errors & warnings from one result object to another, though.\r\n\r\nMaybe if you are interested you could open a PR that does this? I'd be happy to review it. I'm just not sure exactly what you want to do here because the goal of #25722 is a lot broader. Not just dropping `std::vector<bilingual_str>& warnings` output arguments but also dropping `DatabaseStatus& status` output arguments and returning errors and warnings directly from nested calls.",
      "commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "created_at" : "2022-08-15T16:41:01Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r945935114",
      "id" : 945935114,
      "in_reply_to_id" : 944367210,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5844YdMK",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 83,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 76,
      "pull_request_review_id" : 1072924299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945935114/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-15T16:41:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/945935114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated 590bc615a3120a8f11712220546f9654058b82f0 -> 65481de0646f21349f24327410e4d7eb5189e5b3 ([`pr/bresult2.11`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.11) -> [`pr/bresult2.12`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.12), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.11..pr/bresult2.12)) just adding some comments to answer review questions",
      "created_at" : "2022-08-15T18:16:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1215557266",
      "id" : 1215557266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585Ic-6S",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1215557266/reactions"
      },
      "updated_at" : "2022-08-15T18:16:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1215557266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r947098272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947098272"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps could take the opportunity to make this something like:\r\n\r\n```suggestion\r\nenum class ChainstateLoadError { FAILURE_TRY_REINDEX, FAILURE_FATAL, INTERRUPTED };\r\n```\r\n\r\nSo that it's more inline with indicating \"what to do about the failure\".\r\n\r\nCould also move the \"4 types of outcomes\" comment up here where it's clearer.",
      "commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "created_at" : "2022-08-16T18:08:37Z",
      "diff_hunk" : "@@ -31,14 +32,11 @@ struct ChainstateLoadOptions {\n     std::function<void()> coins_error_cb;\n };\n \n-//! Chainstate load status. Simple applications can just check for the success\n-//! case, and treat other cases as errors. More complex applications may want to\n-//! try reindexing in the generic failure case, and pass an interrupt callback\n-//! and exit cleanly in the interrupted case.\n-enum class ChainstateLoadStatus { SUCCESS, FAILURE, FAILURE_INCOMPATIBLE_DB, INTERRUPTED };\n-\n-//! Chainstate load status code and optional error string.\n-using ChainstateLoadResult = std::tuple<ChainstateLoadStatus, bilingual_str>;\n+//! Chainstate load errors. Simple applications can just treat all errors as\n+//! failures. More complex applications may want to try reindexing in the\n+//! generic error case, and pass an interrupt callback and exit cleanly in the\n+//! interrupted case.\n+enum class ChainstateLoadError { FAILURE, FAILURE_INCOMPATIBLE_DB, INTERRUPTED };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r947098272",
      "id" : 947098272,
      "line" : 39,
      "node_id" : "PRRC_kwDOABII5844c5Kg",
      "original_commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "original_line" : 39,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/node/chainstate.h",
      "position" : 24,
      "pull_request_review_id" : 1074563820,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947098272/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-16T18:08:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947098272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948068576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948068576"
         }
      },
      "author_association" : "NONE",
      "body" : "This comment is no longer true.",
      "commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "created_at" : "2022-08-17T15:10:04Z",
      "diff_hunk" : "@@ -53,9 +51,9 @@ using ChainstateLoadResult = std::tuple<ChainstateLoadStatus, bilingual_str>;\n  *\n  *  LoadChainstate returns a (status code, error string) tuple.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948068576",
      "id" : 948068576,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII5844gmDg",
      "original_commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "original_line" : 52,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/node/chainstate.h",
      "position" : 30,
      "pull_request_review_id" : 1075933057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948068576/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T15:10:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948068576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8263430?v=4",
         "events_url" : "https://api.github.com/users/AryanJ-NYC/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AryanJ-NYC/followers",
         "following_url" : "https://api.github.com/users/AryanJ-NYC/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AryanJ-NYC/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AryanJ-NYC",
         "id" : 8263430,
         "login" : "AryanJ-NYC",
         "node_id" : "MDQ6VXNlcjgyNjM0MzA=",
         "organizations_url" : "https://api.github.com/users/AryanJ-NYC/orgs",
         "received_events_url" : "https://api.github.com/users/AryanJ-NYC/received_events",
         "repos_url" : "https://api.github.com/users/AryanJ-NYC/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AryanJ-NYC/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AryanJ-NYC/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AryanJ-NYC"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948230244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948230244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it be sufficient to use `explicit operator bool() const` instead here? That would avoid e.g. \"(result + 3)\" from compiling (and evaluating to 3 or 4).",
      "commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "created_at" : "2022-08-17T17:21:13Z",
      "diff_hunk" : "@@ -8,16 +8,135 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948230244",
      "id" : 948230244,
      "line" : 77,
      "node_id" : "PRRC_kwDOABII5844hNhk",
      "original_commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "original_line" : 77,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 70,
      "pull_request_review_id" : 1076136266,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948230244/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T17:21:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948230244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948262782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948262782"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948068576\r\n\r\n> This comment is no longer true.\r\n\r\nThanks, removed",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-17T17:59:50Z",
      "diff_hunk" : "@@ -53,9 +51,9 @@ using ChainstateLoadResult = std::tuple<ChainstateLoadStatus, bilingual_str>;\n  *\n  *  LoadChainstate returns a (status code, error string) tuple.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948262782",
      "id" : 948262782,
      "in_reply_to_id" : 948068576,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844hVd-",
      "original_commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "original_line" : 52,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/node/chainstate.h",
      "position" : null,
      "pull_request_review_id" : 1076183597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948262782/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T19:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948262782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948263551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948263551"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948230244\r\n\r\n> Would it be sufficient to use `explicit operator bool() const` instead here? That would avoid e.g. \"(result + 3)\" from compiling (and evaluating to 3 or 4).\r\n\r\nGood catch, added explicit. This was an unintended regression (operator bool was explicit before this PR)",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-17T18:00:42Z",
      "diff_hunk" : "@@ -8,16 +8,135 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948263551",
      "id" : 948263551,
      "in_reply_to_id" : 948230244,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844hVp_",
      "original_commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "original_line" : 77,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1076183597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948263551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T19:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948263551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948281038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948281038"
         }
      },
      "author_association" : "NONE",
      "body" : "+1 to @sipa 's comment.",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-17T18:22:16Z",
      "diff_hunk" : "@@ -8,16 +8,135 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948281038",
      "id" : 948281038,
      "in_reply_to_id" : 948230244,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844hZ7O",
      "original_commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "original_line" : 77,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1076209823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948281038/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T18:22:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948281038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/87907936?v=4",
         "events_url" : "https://api.github.com/users/hernanmarino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hernanmarino/followers",
         "following_url" : "https://api.github.com/users/hernanmarino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hernanmarino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hernanmarino",
         "id" : 87907936,
         "login" : "hernanmarino",
         "node_id" : "MDQ6VXNlcjg3OTA3OTM2",
         "organizations_url" : "https://api.github.com/users/hernanmarino/orgs",
         "received_events_url" : "https://api.github.com/users/hernanmarino/received_events",
         "repos_url" : "https://api.github.com/users/hernanmarino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hernanmarino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hernanmarino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hernanmarino"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948288448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948288448"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r947098272\r\n\r\n> So that it's more inline with indicating \"what to do about the failure\".\r\n\r\nI agree it's good to suggest how failures can be handled, so I tried to do that in the comment. But I think if failure has a clear cause it's best for the error name to describe the cause, especially since not every application will want to handle errors the same way, and `bitcoin-qt`, `bitcoind`, and `bitcoin-chainstate` all handle errors differently.\r\n\r\nI'm also don't think `FAILURE_TRY_REINDEX` is an appropriate synonym for `FAILURE`, since generic failures can happen on any exception, even if reindexing was already requested. Trying to reindex when reindexing fails does not make a lot of sense. I'd be happy to rename `FAILURE` to `FAILURE_GENERIC`. But would probably do it in a separate PR to not complicate this one.\r\n\r\n> Could also move the \"4 types of outcomes\" comment up here where it's clearer.\r\n\r\nThanks for pointing it out. I think that comment actually does not add much information anymore, and is a little confusing because it is mentioning shutdowns when the `check_interrupt` callback and `INTERRUPTED` error could indicate any custom interruption, not just a shutdown.\r\n\r\nI can add more documentation if you think anything is missing, but I think a simple message of \"It is fine to treat any error code as a failure and ignore the specific cause\" is the most helpful takeaway. Setting interrupt callbacks and trying to reindex are optional enhancements mostly helpful for interactive applications.",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-17T18:31:20Z",
      "diff_hunk" : "@@ -31,14 +32,11 @@ struct ChainstateLoadOptions {\n     std::function<void()> coins_error_cb;\n };\n \n-//! Chainstate load status. Simple applications can just check for the success\n-//! case, and treat other cases as errors. More complex applications may want to\n-//! try reindexing in the generic failure case, and pass an interrupt callback\n-//! and exit cleanly in the interrupted case.\n-enum class ChainstateLoadStatus { SUCCESS, FAILURE, FAILURE_INCOMPATIBLE_DB, INTERRUPTED };\n-\n-//! Chainstate load status code and optional error string.\n-using ChainstateLoadResult = std::tuple<ChainstateLoadStatus, bilingual_str>;\n+//! Chainstate load errors. Simple applications can just treat all errors as\n+//! failures. More complex applications may want to try reindexing in the\n+//! generic error case, and pass an interrupt callback and exit cleanly in the\n+//! interrupted case.\n+enum class ChainstateLoadError { FAILURE, FAILURE_INCOMPATIBLE_DB, INTERRUPTED };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r948288448",
      "id" : 948288448,
      "in_reply_to_id" : 947098272,
      "line" : 39,
      "node_id" : "PRRC_kwDOABII5844hbvA",
      "original_commit_id" : "65481de0646f21349f24327410e4d7eb5189e5b3",
      "original_line" : 39,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/node/chainstate.h",
      "position" : 41,
      "pull_request_review_id" : 1076183597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948288448/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T19:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948288448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Tested ACK and Code review ACK. I got a few warnings while compiling though (missing-field-initializers)\r\n\r\nThanks for testing! @hernanmarino could you post the warnings, and maybe post your compiler version? I don't think I'm seeing these and I don't think they are happening on CI because those builds treat warnings as errors. I'd like to fix this if possible.\r\n\r\n\r\n\r\n",
      "created_at" : "2022-08-18T14:18:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1219551815",
      "id" : 1219551815,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585IsOJH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1219551815/reactions"
      },
      "updated_at" : "2022-08-18T14:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1219551815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950214121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950214121"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do we want to expose these 2 helper methods in the header?",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T13:53:02Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }\n+        return std::move(other);\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Helper methods to format error strings.\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors);\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950214121",
      "id" : 950214121,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII5844ox3p",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 227,
      "original_position" : 250,
      "original_start_line" : 226,
      "path" : "src/util/result.h",
      "position" : 250,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950214121/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 226,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-19T17:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950214121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950215859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950215859"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What about renaming this function to `ErrorWarningString()` since at the moment it can contain both? I can see some scenario where people would want to access just the error but not the warning string (and of course it's just a convenience fn), so that would allow them to create the more narrow `ErrorString()` later on?\r\n\r\nPerhaps a brief docstring above this fn would be beneficial as well since that's the one people will mostly use.",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T13:54:55Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }\n+        return std::move(other);\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Helper methods to format error strings.\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors);\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+template <typename T, typename F>\n+bilingual_str ErrorString(const Result<T, F>& result) { return ErrorString(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950215859",
      "id" : 950215859,
      "line" : 229,
      "node_id" : "PRRC_kwDOABII5844oySz",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 229,
      "original_position" : 252,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 252,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950215859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:06:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950215859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950223870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950223870"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think this docstring is more relevant for `m_info`, perhaps move it to above its declaration in `ResultBase`?",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T14:02:58Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950223870",
      "id" : 950223870,
      "line" : 30,
      "node_id" : "PRRC_kwDOABII5844o0P-",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 30,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 23,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950223870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950223870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950228362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950228362"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: You could add a bit more info on T, F for quick understanding?\r\n```suggestion\r\n//! Result base class which is inherited by Result<T, F>.\r\n//! T is the type of the success return value, or void if there is none.\r\n//! F is the type of the failure return value, or void if there is none.\r\n```",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T14:07:37Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950228362",
      "id" : 950228362,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII5844o1WK",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 38,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 31,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950228362/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:06:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950228362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950253178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950253178"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is repeated a few times, what do you think about this:\r\n\r\n```diff\r\ndiff --git a/src/util/result.h b/src/util/result.h\r\nindex 60e0b3db6..c6aa65891 100644\r\n--- a/src/util/result.h\r\n+++ b/src/util/result.h\r\n@@ -56,17 +56,19 @@ public:\r\n     void AddError(bilingual_str error)\r\n     {\r\n         if (error.empty()) return;\r\n-        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\r\n+        CheckInitInfo();\r\n         m_info->errors.emplace_back(std::move(error));\r\n     }\r\n \r\n     void AddWarning(bilingual_str warning)\r\n     {\r\n         if (warning.empty()) return;\r\n-        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\r\n+        CheckInitInfo();\r\n         m_info->warnings.emplace_back(std::move(warning));\r\n     }\r\n \r\n+    void CheckInitInfo() { if (!m_info) m_info = std::make_unique<ErrorInfo<F>>(); }\r\n+\r\n     //! Success check.\r\n     explicit operator bool() const { return !m_info || !m_info->failure; }\r\n \r\n@@ -159,7 +161,7 @@ protected:\r\n     {\r\n         this->AddError(std::move(error.message));\r\n         Construct([&](auto&&... x) {\r\n-            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\r\n+            this->CheckInitInfo();\r\n             this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\r\n         }, std::forward<Args>(args)...);\r\n     }\r\n\r\n```",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T14:30:07Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950253178",
      "id" : 950253178,
      "line" : 59,
      "node_id" : "PRRC_kwDOABII5844o7Z6",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 59,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 52,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950253178/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950253178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Thanks for testing! @hernanmarino could you post the warnings, and maybe post your compiler version? I don't think I'm seeing these and I don't think they are happening on CI because those builds treat warnings as errors. I'd like to fix this if possible.\r\n\r\nYes, this is one of them (there are a few more , all similar)\r\n\r\n```\r\n In file included from ./interfaces/wallet.h:15,\r\n                 from wallet/interfaces.cpp:5:\r\n./util/result.h: In instantiation of âutil::Result<OT, OF>&& util::Result<T, F>::operator<<(util::Result<OT, OF>&&) [with OT = std::unique_ptr<interfaces::Wallet>; OF = void; T = std::unique_ptr<interfaces::Wallet>; F = void]â:\r\n\r\n./util/result.h:187:15:   required from âvoid util::Result<T, F>::MoveConstruct(util::Result<OT, OF>&) [with OT = std::unique_ptr<interfaces::Wallet>; OF = void; T = std::unique_ptr<interfaces::Wallet>; F = void]â\r\n\r\n./util/result.h:202:51:   required from âutil::Result<T, F>::Result(util::Result<OT, OF>&&) [with OT = std::unique_ptr<interfaces::Wallet>; OF = void; T = std::unique_ptr<interfaces::Wallet>; F = void]â\r\n\r\nwallet/interfaces.cpp:580:16:   required from here\r\n\r\n./util/result.h:218:32: warning: missing initializer for member âutil::detail::ErrorInfo<void>::failureâ [-Wmissing-field-initializers]\r\n  218 |             this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\r\n      |                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n  219 |                                                         .warnings = std::move(other.m_info->warnings)});\r\n      |                                                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n```\r\n\r\nI'm using  gcc  11.2.0 . If you need them all, just let me know\r\n\r\n\r\n\r\n\r\n",
      "created_at" : "2022-08-19T14:36:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1220755709",
      "id" : 1220755709,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585Iw0D9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220755709/reactions"
      },
      "updated_at" : "2022-08-19T14:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220755709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/87907936?v=4",
         "events_url" : "https://api.github.com/users/hernanmarino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hernanmarino/followers",
         "following_url" : "https://api.github.com/users/hernanmarino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hernanmarino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hernanmarino",
         "id" : 87907936,
         "login" : "hernanmarino",
         "node_id" : "MDQ6VXNlcjg3OTA3OTM2",
         "organizations_url" : "https://api.github.com/users/hernanmarino/orgs",
         "received_events_url" : "https://api.github.com/users/hernanmarino/received_events",
         "repos_url" : "https://api.github.com/users/hernanmarino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hernanmarino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hernanmarino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hernanmarino"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@ryanofsky, @hernanmarino I also get those warnings.\r\n\r\nMy version of g++ is 9.4.0; please let me know if you need any other details.",
      "created_at" : "2022-08-19T14:53:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1220773746",
      "id" : 1220773746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585Iw4dy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220773746/reactions"
      },
      "updated_at" : "2022-08-24T16:08:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220773746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950293020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950293020"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As part of the public interface, I think these could benefit from a very brief per-method docstring (that probably just mirrors the std::optional docstring)?",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T15:05:22Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    explicit operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    //! Result success value. Uses anonymous union so success value is never\n+    //! constructed in failure case.\n+    union { T m_value; };\n+\n+    template <typename... Args>\n+    void ConstructValue(Args&&... args) { new (&m_value) T{std::forward<Args>(args)...}; }\n+    template <typename O>\n+    void MoveValue(O& other) { new (&m_value) T{std::move(other.m_value)}; }\n+    void DestroyValue() { m_value.~T(); }\n+\n+    ResultBase() {}\n+    ~ResultBase() {}\n+\n+    template <typename FT, typename FF>\n+    friend class ResultBase;\n+\n+public:\n+    //! std::optional methods, so functions returning optional<T> can change to\n+    //! return Result<T> with minimal changes to existing code, and vice versa.\n+    bool has_value() const { return *this ? true : false; }\n+    const T& value() const LIFETIMEBOUND { assert(*this); return m_value; }\n+    T& value() LIFETIMEBOUND { assert(*this); return m_value; }\n+    template <class U>\n+    T value_or(U&& default_value) const&\n+    {\n+        return has_value() ? value() : std::forward<U>(default_value);\n+    }\n+    template <class U>\n+    T value_or(U&& default_value) &&\n+    {\n+        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950293020",
      "id" : 950293020,
      "line" : 116,
      "node_id" : "PRRC_kwDOABII5844pFIc",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 116,
      "original_position" : 109,
      "original_start_line" : 102,
      "path" : "src/util/result.h",
      "position" : 109,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950293020/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 102,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950293020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950310915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950310915"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: slightly more concise and clear on intent imo\r\n```suggestion\r\n    bool has_value() const { return bool(*this); }\r\n```",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T15:24:59Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    explicit operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    //! Result success value. Uses anonymous union so success value is never\n+    //! constructed in failure case.\n+    union { T m_value; };\n+\n+    template <typename... Args>\n+    void ConstructValue(Args&&... args) { new (&m_value) T{std::forward<Args>(args)...}; }\n+    template <typename O>\n+    void MoveValue(O& other) { new (&m_value) T{std::move(other.m_value)}; }\n+    void DestroyValue() { m_value.~T(); }\n+\n+    ResultBase() {}\n+    ~ResultBase() {}\n+\n+    template <typename FT, typename FF>\n+    friend class ResultBase;\n+\n+public:\n+    //! std::optional methods, so functions returning optional<T> can change to\n+    //! return Result<T> with minimal changes to existing code, and vice versa.\n+    bool has_value() const { return *this ? true : false; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950310915",
      "id" : 950310915,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII5844pJgD",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 104,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 97,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950310915/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950310915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950331132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950331132"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it would be helpful to also test success with a falsy non-void value and failure with a truthy non-void value",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T15:43:55Z",
      "diff_hunk" : "@@ -51,36 +80,106 @@ util::Result<NoCopy> NoCopyFn(int i, bool success)\n     return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n }\n \n-template <typename T>\n-void ExpectResult(const util::Result<T>& result, bool success, const bilingual_str& str)\n+util::Result<NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<NoCopyNoMove, FnError> EnumFailFn(FnError ret)\n+{\n+    return {util::Error{Untranslated(\"enum fail.\")}, ret};\n+}\n+\n+util::Result<void> WarnFn()\n+{\n+    return {util::Warning{Untranslated(\"warn.\")}};\n+}\n+\n+util::Result<int> MultiWarnFn(int ret)\n+{\n+    util::Result<void> result;\n+    for (int i = 0; i < ret; ++i) {\n+        result.AddWarning(strprintf(Untranslated(\"warn %i.\"), i));\n+    }\n+    return {std::move(result), ret};\n+}\n+\n+util::Result<void, int> ChainedFailFn(FnError arg, int ret)\n+{\n+    return {util::Error{Untranslated(\"chained fail.\")}, EnumFailFn(arg), WarnFn(), ret};\n+}\n+\n+util::Result<int, FnError> AccumulateFn(bool success)\n+{\n+    util::Result<int, FnError> result;\n+    util::Result<int> x = result << MultiWarnFn(1);\n+    BOOST_REQUIRE(x);\n+    util::Result<int> y = result << MultiWarnFn(2);\n+    BOOST_REQUIRE(y);\n+    result = IntFailFn(*x + *y, success);\n+    return result;\n+}\n+\n+template<typename T, typename F>\n+void ExpectResult(const util::Result<T, F>& result, bool success, const bilingual_str& str)\n {\n     BOOST_CHECK_EQUAL(bool(result), success);\n     BOOST_CHECK_EQUAL(util::ErrorString(result), str);\n }\n \n-template <typename T, typename... Args>\n-void ExpectSuccess(const util::Result<T>& result, const bilingual_str& str, Args&&... args)\n+template<typename T, typename F, typename... Args>\n+void ExpectSuccess(const util::Result<T, F>& result, const bilingual_str& str, Args&&... args)\n {\n     ExpectResult(result, true, str);\n     BOOST_CHECK_EQUAL(result.has_value(), true);\n     BOOST_CHECK_EQUAL(result.value(), T{std::forward<Args>(args)...});\n     BOOST_CHECK_EQUAL(&result.value(), &*result);\n }\n \n-template <typename T, typename... Args>\n-void ExpectFail(const util::Result<T>& result, const bilingual_str& str)\n+template<typename T, typename F, typename... Args>\n+void ExpectFail(const util::Result<T, F>& result, bilingual_str str, Args&&... args)\n {\n     ExpectResult(result, false, str);\n+    BOOST_CHECK_EQUAL(result.GetFailure(), F{std::forward<Args>(args)...});\n }\n \n BOOST_AUTO_TEST_CASE(check_returned)\n {\n+    ExpectResult(VoidSuccessFn(), true, {});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950331132",
      "id" : 950331132,
      "line" : 157,
      "node_id" : "PRRC_kwDOABII5844pOb8",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 157,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : 120,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950331132/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950331132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950338812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950338812"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this line is redundant since we already call `this->AddError()` right above?",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T15:50:56Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950338812",
      "id" : 950338812,
      "line" : 162,
      "node_id" : "PRRC_kwDOABII5844pQT8",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 162,
      "original_position" : 157,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 157,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950338812/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950338812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950342467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950342467"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think this should be on a new line",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T15:54:14Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950342467",
      "id" : 950342467,
      "line" : 185,
      "node_id" : "PRRC_kwDOABII5844pRND",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 185,
      "original_position" : 192,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 192,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950342467/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950342467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950365637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950365637"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: ternary looks more appropriate?\r\n```suggestion\r\n        *this ? this->DestroyValue() : this->m_info->failure.reset();\r\n```",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T16:18:57Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950365637",
      "id" : 950365637,
      "line" : 202,
      "node_id" : "PRRC_kwDOABII5844pW3F",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 202,
      "original_position" : 215,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 215,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950365637/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950365637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950369435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950369435"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    //! Operator moving warning and error messages from other Result to this.\r\n```",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T16:23:58Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950369435",
      "id" : 950369435,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII5844pXyb",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 208,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 221,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950369435/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T17:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950369435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950383459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950383459"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since `ErrorInfo` doesn't have a move constructor, do the move semantics make sense here? _(I'm still easily confused by move semantics, so I'm probably missing something - sorry)_",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T16:42:35Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950383459",
      "id" : 950383459,
      "line" : 216,
      "node_id" : "PRRC_kwDOABII5844pbNj",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 216,
      "original_position" : 229,
      "original_start_line" : 215,
      "path" : "src/util/result.h",
      "position" : 229,
      "pull_request_review_id" : 1069943757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950383459/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 215,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-19T17:05:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950383459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950398142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950398142"
         }
      },
      "author_association" : "NONE",
      "body" : "@ryanofsky the following change fixes the warnings for me, but i don't know if this is the best way to deal with this\r\n  \r\n```suggestion\r\n    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure = std::nullopt;\r\n```",
      "commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "created_at" : "2022-08-19T16:58:43Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950398142",
      "id" : 950398142,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII5844pey-",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 33,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 26,
      "pull_request_review_id" : 1079113915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950398142/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T16:59:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950398142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/87907936?v=4",
         "events_url" : "https://api.github.com/users/hernanmarino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hernanmarino/followers",
         "following_url" : "https://api.github.com/users/hernanmarino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hernanmarino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hernanmarino",
         "id" : 87907936,
         "login" : "hernanmarino",
         "node_id" : "MDQ6VXNlcjg3OTA3OTM2",
         "organizations_url" : "https://api.github.com/users/hernanmarino/orgs",
         "received_events_url" : "https://api.github.com/users/hernanmarino/received_events",
         "repos_url" : "https://api.github.com/users/hernanmarino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hernanmarino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hernanmarino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hernanmarino"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889008"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950331132\r\n\r\n> I think it would be helpful to also test success with a falsy non-void value and failure with a truthy non-void value\r\n\r\nMakes sense, added tests",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:37:18Z",
      "diff_hunk" : "@@ -51,36 +80,106 @@ util::Result<NoCopy> NoCopyFn(int i, bool success)\n     return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n }\n \n-template <typename T>\n-void ExpectResult(const util::Result<T>& result, bool success, const bilingual_str& str)\n+util::Result<NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<NoCopyNoMove, FnError> EnumFailFn(FnError ret)\n+{\n+    return {util::Error{Untranslated(\"enum fail.\")}, ret};\n+}\n+\n+util::Result<void> WarnFn()\n+{\n+    return {util::Warning{Untranslated(\"warn.\")}};\n+}\n+\n+util::Result<int> MultiWarnFn(int ret)\n+{\n+    util::Result<void> result;\n+    for (int i = 0; i < ret; ++i) {\n+        result.AddWarning(strprintf(Untranslated(\"warn %i.\"), i));\n+    }\n+    return {std::move(result), ret};\n+}\n+\n+util::Result<void, int> ChainedFailFn(FnError arg, int ret)\n+{\n+    return {util::Error{Untranslated(\"chained fail.\")}, EnumFailFn(arg), WarnFn(), ret};\n+}\n+\n+util::Result<int, FnError> AccumulateFn(bool success)\n+{\n+    util::Result<int, FnError> result;\n+    util::Result<int> x = result << MultiWarnFn(1);\n+    BOOST_REQUIRE(x);\n+    util::Result<int> y = result << MultiWarnFn(2);\n+    BOOST_REQUIRE(y);\n+    result = IntFailFn(*x + *y, success);\n+    return result;\n+}\n+\n+template<typename T, typename F>\n+void ExpectResult(const util::Result<T, F>& result, bool success, const bilingual_str& str)\n {\n     BOOST_CHECK_EQUAL(bool(result), success);\n     BOOST_CHECK_EQUAL(util::ErrorString(result), str);\n }\n \n-template <typename T, typename... Args>\n-void ExpectSuccess(const util::Result<T>& result, const bilingual_str& str, Args&&... args)\n+template<typename T, typename F, typename... Args>\n+void ExpectSuccess(const util::Result<T, F>& result, const bilingual_str& str, Args&&... args)\n {\n     ExpectResult(result, true, str);\n     BOOST_CHECK_EQUAL(result.has_value(), true);\n     BOOST_CHECK_EQUAL(result.value(), T{std::forward<Args>(args)...});\n     BOOST_CHECK_EQUAL(&result.value(), &*result);\n }\n \n-template <typename T, typename... Args>\n-void ExpectFail(const util::Result<T>& result, const bilingual_str& str)\n+template<typename T, typename F, typename... Args>\n+void ExpectFail(const util::Result<T, F>& result, bilingual_str str, Args&&... args)\n {\n     ExpectResult(result, false, str);\n+    BOOST_CHECK_EQUAL(result.GetFailure(), F{std::forward<Args>(args)...});\n }\n \n BOOST_AUTO_TEST_CASE(check_returned)\n {\n+    ExpectResult(VoidSuccessFn(), true, {});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889008",
      "id" : 951889008,
      "in_reply_to_id" : 950331132,
      "line" : 163,
      "node_id" : "PRRC_kwDOABII5844vKxw",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 163,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : 126,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889116"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943789301\r\n\r\n> nit:\r\n\r\nThanks, used suggestion.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:37:26Z",
      "diff_hunk" : "@@ -0,0 +1,24 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/result.h>\n+#include <util/string.h>\n+\n+namespace util {\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors)\n+{\n+    return Join(errors, Untranslated(\" \"));\n+}\n+\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings)\n+{\n+    bilingual_str result = ErrorString(errors);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889116",
      "id" : 951889116,
      "in_reply_to_id" : 943789301,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844vKzc",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/util/result.cpp",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889116/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889202"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943807162\r\n\r\n> I'm not sure why iwyu [doesn't](https://cirrus-ci.com/task/6358959639494656) catch it, but shouldn't `forward`, `types` and `utility` also be included here?\r\n\r\nThanks, added `utility`. (I think the others are nonstandard.) IWYU might not catch references to code in templates that aren't instantiated, so I'm not too surprised it didn't add this.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:37:34Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889202",
      "id" : 951889202,
      "in_reply_to_id" : 943807162,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844vK0y",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 16,
      "original_position" : 8,
      "original_start_line" : 11,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889202/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889285"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943776125\r\n\r\n> Since we're expecting `T` to be a container type, would this benefit from living in `span.h` for reusability? The generic implementation/naming isn't really necessary in `result.h`, and people won't come looking here when they need something to move elements between containers.\r\n\r\nIt would be ok to move this somewhere, especially if something else was calling it. But I don't think span.h would be the right place since this shouldn't work on a span due to spans having fixed size. It also seems ok to me to keep this as a private helper function in a detail namespace as long as it is only called one place.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:37:42Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889285",
      "id" : 951889285,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII5844vK2F",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 29,
      "original_position" : 21,
      "original_start_line" : 23,
      "path" : "src/util/result.h",
      "position" : 22,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889285/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 24,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950223870\r\n\r\n> nit: I think this docstring is more relevant for `m_info`, perhaps move it to above its declaration in `ResultBase`?\r\n\r\nI think it's relevant here because the struct is pretty big thing to have in a return type, so good to say it won't typically be needed.\r\n\r\nAlso, this may be a stylistic thing, but I tend to prefer class-level documentation that gets at _why/how_ questions, over member level documentation only answers more basic _what_ questions, and can also clutter the class definition.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:37:50Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889391",
      "id" : 951889391,
      "in_reply_to_id" : 950223870,
      "line" : 31,
      "node_id" : "PRRC_kwDOABII5844vK3v",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 31,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 24,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889391/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889535"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950228362\r\n\r\n> nit: You could add a bit more info on T, F for quick understanding?\r\n\r\nAdded. Nice suggestion!",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:38:00Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889535",
      "id" : 951889535,
      "in_reply_to_id" : 950228362,
      "line" : 39,
      "node_id" : "PRRC_kwDOABII5844vK5_",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 39,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 32,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950253178\r\n\r\n> This is repeated a few times, what do you think about this:\r\n\r\nNice catch! I implemented something similar to what you suggested to dedup",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:38:14Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889724",
      "id" : 951889724,
      "in_reply_to_id" : 950253178,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844vK88",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 59,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889985"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950310915\r\n\r\n> nit: slightly more concise and clear on intent imo\r\n\r\nOk! I would have defaulted to that but had seen some feedback `bool()` was not good https://github.com/bitcoin/bitcoin/pull/25616#discussion_r940933709, https://github.com/bitcoin/bitcoin/pull/25721#discussion_r938763403 so was trying to avoid it. Switched to `bool{}` for now.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:38:34Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    explicit operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    //! Result success value. Uses anonymous union so success value is never\n+    //! constructed in failure case.\n+    union { T m_value; };\n+\n+    template <typename... Args>\n+    void ConstructValue(Args&&... args) { new (&m_value) T{std::forward<Args>(args)...}; }\n+    template <typename O>\n+    void MoveValue(O& other) { new (&m_value) T{std::move(other.m_value)}; }\n+    void DestroyValue() { m_value.~T(); }\n+\n+    ResultBase() {}\n+    ~ResultBase() {}\n+\n+    template <typename FT, typename FF>\n+    friend class ResultBase;\n+\n+public:\n+    //! std::optional methods, so functions returning optional<T> can change to\n+    //! return Result<T> with minimal changes to existing code, and vice versa.\n+    bool has_value() const { return *this ? true : false; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951889985",
      "id" : 951889985,
      "in_reply_to_id" : 950310915,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844vLBB",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 104,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889985/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951889985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951890286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951890286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950293020\r\n\r\n> As part of the public interface, I think these could benefit from a very brief per-method docstring (that probably just mirrors the std::optional docstring)?\r\n\r\nI'm a little reluctant to change this code here because it is just moving (not new), but would encourage you to submit a separate PR to add more documentation to existing code if it would be helpful. I'm happy to rebase this as other PR are merged.\r\n\r\nI do personally tend not to like documenting individual class members if it's obvious what they do, and save comments for when there is something non-obvious or higher level to point out, but I wouldn't have any objection to more detailed documentation.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:38:55Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    explicit operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    //! Result success value. Uses anonymous union so success value is never\n+    //! constructed in failure case.\n+    union { T m_value; };\n+\n+    template <typename... Args>\n+    void ConstructValue(Args&&... args) { new (&m_value) T{std::forward<Args>(args)...}; }\n+    template <typename O>\n+    void MoveValue(O& other) { new (&m_value) T{std::move(other.m_value)}; }\n+    void DestroyValue() { m_value.~T(); }\n+\n+    ResultBase() {}\n+    ~ResultBase() {}\n+\n+    template <typename FT, typename FF>\n+    friend class ResultBase;\n+\n+public:\n+    //! std::optional methods, so functions returning optional<T> can change to\n+    //! return Result<T> with minimal changes to existing code, and vice versa.\n+    bool has_value() const { return *this ? true : false; }\n+    const T& value() const LIFETIMEBOUND { assert(*this); return m_value; }\n+    T& value() LIFETIMEBOUND { assert(*this); return m_value; }\n+    template <class U>\n+    T value_or(U&& default_value) const&\n+    {\n+        return has_value() ? value() : std::forward<U>(default_value);\n+    }\n+    template <class U>\n+    T value_or(U&& default_value) &&\n+    {\n+        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951890286",
      "id" : 951890286,
      "in_reply_to_id" : 950293020,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844vLFu",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 121,
      "original_position" : 109,
      "original_start_line" : 102,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951890286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951890286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951890463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951890463"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950338812\r\n\r\n> I think this line is redundant since we already call `this->AddError()` right above?\r\n\r\nI think it was needed to avoid a segfault if the error message was empty, but in any case this line is gone now from implementing your earlier suggestion to dedup this.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:39:12Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951890463",
      "id" : 951890463,
      "in_reply_to_id" : 950338812,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844vLIf",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 162,
      "original_position" : 157,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951890463/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951890463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951905203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951905203"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950398142\r\n\r\n> @ryanofsky the following change fixes the warnings for me, but i don't know if this is the best way to deal with this\r\n\r\nThanks! I think it might be sufficient to replace `= std::nullopt` with `{}`, so I will try that first.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-22T20:56:19Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r951905203",
      "id" : 951905203,
      "in_reply_to_id" : 950398142,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844vOuz",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 33,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951905203/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951905203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953058726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953058726"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r943807162\r\n\r\n> Do we want to expose these 2 helper methods in the header?\r\n\r\nNope, good point. Moved these to the details namespace.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-23T19:59:10Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }\n+        return std::move(other);\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Helper methods to format error strings.\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors);\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953058726",
      "id" : 953058726,
      "in_reply_to_id" : 950214121,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844zoWm",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 227,
      "original_position" : 250,
      "original_start_line" : 226,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953058726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953058726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953059049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953059049"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950215859\r\n\r\n> What about renaming this function to `ErrorWarningString()` since at the moment it can contain both? I can see some scenario where people would want to access just the error but not the warning string (and of course it's just a convenience fn), so that would allow them to create the more narrow `ErrorString()` later on?\r\n\r\nAdded some more documentation about how this should be used. I think a function that just puts errors not warnings in a result message could be a potential footgun, because warnings could be unintentionally dropped if errors and warnings are returned together. For example if code initially doesn't generate any warnings, then someone adds one not realizing it won't show up anywhere.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-23T19:59:34Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }\n+        return std::move(other);\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Helper methods to format error strings.\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors);\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+template <typename T, typename F>\n+bilingual_str ErrorString(const Result<T, F>& result) { return ErrorString(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953059049",
      "id" : 953059049,
      "in_reply_to_id" : 950215859,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844zobp",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 229,
      "original_position" : 252,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953059049/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953059049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953061469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953061469"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950342467\r\n\r\n> nit: I think this should be on a new line\r\n\r\nI dropped the `else if` here since it was redundant, but I think I do prefer the compact style with one line",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-23T20:02:34Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953061469",
      "id" : 953061469,
      "in_reply_to_id" : 950342467,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844zpBd",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 185,
      "original_position" : 192,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953061469/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953061469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953062290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062290"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950365637\r\n\r\n> nit: ternary looks more appropriate?\r\n\r\nI think I prefer `if` statement to ternary here, and I'm not used to seeing ternary statements rather than expressions in the codebase, but would be happy to change if there are other opinions.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-23T20:03:40Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953062290",
      "id" : 953062290,
      "in_reply_to_id" : 950365637,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII5844zpOS",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 208,
      "original_position" : 215,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 221,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062290/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953062553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062553"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950369435\r\n\r\n> nit:\r\n\r\nThanks, that's clearer",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-23T20:04:01Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953062553",
      "id" : 953062553,
      "in_reply_to_id" : 950369435,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844zpSZ",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 208,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062553/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T18:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953062706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062706"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r950383459\r\n\r\n> Since `ErrorInfo` doesn't have a move constructor, do the move semantics make sense here? _(I'm still easily confused by move semantics, so I'm probably missing something - sorry)_\r\n\r\n`ErrorInfo` should have an implicit `ErrorInfo(ErrorInfo&&)` move constructor, but it actually isn't relevant here, because the new ErrorInfo object that's being allocated isn't being constructed with that constructor. Instead the newly allocated ErrorInfo is [aggregate initialized](https://en.cppreference.com/w/cpp/language/aggregate_initialization), and the two `errors` and `warnings` variables are individually move-constructed, rather than the whole `ErrorInfo` object being move constructed.\r\n\r\nIf the question here is whether the `std::move` calls here have any effect, the answer is yes they do because `errors` and `warnings` variables are vectors, and vectors have move constructors.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-23T20:04:14Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r953062706",
      "id" : 953062706,
      "in_reply_to_id" : 950383459,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844zpUy",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 216,
      "original_position" : 229,
      "original_start_line" : 215,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1081114599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062706/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T18:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953062706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954186225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954186225"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the thoughtful response, that was very helpful. Your usage of move semantics here now makes sense to me.\r\n\r\nNow I'm just confused that the [designated initialization](https://en.cppreference.com/w/cpp/language/aggregate_initialization#Designated_initializers) compiles fine even though the spec says it's since C++20 and I haven't configured with `--enable-c++20` (as does the CI I think)?",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-24T18:58:34Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954186225",
      "id" : 954186225,
      "in_reply_to_id" : 950383459,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584437nx",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 216,
      "original_position" : 229,
      "original_start_line" : 215,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1084363199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954186225/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T18:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954186225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954191181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954191181"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Now I'm just confused that the [designated initialization](https://en.cppreference.com/w/cpp/language/aggregate_initialization#Designated_initializers) compiles fine even though the spec says it's since C++20 and I haven't configured with `--enable-c++20` (as does the CI I think)?\r\n\r\nOh, we are just outside of the c++17 spec there. The build enables designated initializers as an extension since #24531",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-24T19:03:05Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954191181",
      "id" : 954191181,
      "in_reply_to_id" : 950383459,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844381N",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 216,
      "original_position" : 229,
      "original_start_line" : 215,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1084368855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954191181/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T19:03:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954191181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954200376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954200376"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry for the ghost comment. I had realized after posting that this comment about moving it to span.h wasn't really applicable so I removed it, but apparently not timely enough. I agree with you.\r\n\r\nThe only further thought I had was that if there's no need to be generic (yet - and maybe never) it might be worth not doing that to simplify things a bit where possible? E.g. the below is easier to quickly understand imo (and maybe compiles a bit faster?):\r\n\r\n```suggestion\r\n//! Helper to move warnings and errors from one ErrorInfo to another.\r\nvoid MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest)\r\n{\r\n    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\r\n    src.clear();\r\n}\r\n```\r\n\r\nNo strong views either way though, so feel free to ignore. Just trying to minimize on what's already a lot of genericness.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-24T19:11:40Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954200376",
      "id" : 954200376,
      "in_reply_to_id" : 951889285,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII58443_E4",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 29,
      "original_position" : 21,
      "original_start_line" : 23,
      "path" : "src/util/result.h",
      "position" : 22,
      "pull_request_review_id" : 1084379302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954200376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 24,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T19:22:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954200376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954211552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954211552"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't think about the footgun, that's a good point why we probably indeed won't want to add the other fn later. I still think it's a bit awkward that the function name doesn't entirely capture what the function is doing, but I think it's within reason and may be worth the trade-off for brevity (vs `ErrorWarningString()`. Not sure what I prefer, so feel free to ignore.\r\n\r\nThe new docstring is great, thanks!",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-24T19:21:36Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }\n+        return std::move(other);\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Helper methods to format error strings.\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors);\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+template <typename T, typename F>\n+bilingual_str ErrorString(const Result<T, F>& result) { return ErrorString(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954211552",
      "id" : 954211552,
      "in_reply_to_id" : 950215859,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58444Bzg",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 229,
      "original_position" : 252,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1084391049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954211552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T19:21:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954211552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954223480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954223480"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like your solution, very elegant!",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-24T19:32:52Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954223480",
      "id" : 954223480,
      "in_reply_to_id" : 950253178,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58444Et4",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 59,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1084403711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954223480/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T19:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954223480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954244319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954244319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm you're right, we're not using ternaries as statements it seems. I couldn't find a single instance of a one-line `if ...; else` either though, and unfortunately the developer notes are rather ambiguous on the topic.\r\n\r\nIn that case I'd prefer `if` and `else` on separate lines (personal preference and to not be the first in the repo) but no strong view so won't comment on it further.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-24T19:53:58Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954244319",
      "id" : 954244319,
      "in_reply_to_id" : 950365637,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII58444Jzf",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 208,
      "original_position" : 215,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 221,
      "pull_request_review_id" : 1084431154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954244319/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T19:53:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954244319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r955075009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955075009"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954211552\r\n\r\n> I still think it's a bit awkward that the function name doesn't entirely capture what the function is doing, but I think it's within reason and may be worth the trade-off for brevity (vs `ErrorWarningString()`. Not sure what I prefer, so feel free to ignore.\r\n\r\nCould call it `util::MessageString(result)` instead of `util::ErrorString(result)`. I think the longer name would be ok too. I was pushing back more against changing the functionality than changing the name.\r\n\r\nI do think any renaming should happen in a separate PR, before or after this one. The function already exists and is called in current code. This PR is backwards compatible just extends the Result API without requiring changes to existing code.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-25T14:55:36Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }\n+        return std::move(other);\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Helper methods to format error strings.\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors);\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+template <typename T, typename F>\n+bilingual_str ErrorString(const Result<T, F>& result) { return ErrorString(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r955075009",
      "id" : 955075009,
      "in_reply_to_id" : 950215859,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58447UnB",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 229,
      "original_position" : 252,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1085606694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955075009/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T14:55:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955075009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r955097005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955097005"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r954200376\r\n\r\nInteresting! I do think the generic version is shorter and easier to understand. But I like moving more code from the `.h` file to the `.cpp` file, and I like the consistency between `JoinMessages` and `MoveMessages`, so I took this suggestion. Thanks!",
      "commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "created_at" : "2022-08-25T15:13:44Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r955097005",
      "id" : 955097005,
      "in_reply_to_id" : 951889285,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58447Z-t",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 29,
      "original_position" : 21,
      "original_start_line" : 23,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1085638384,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955097005/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-25T16:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955097005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r955114057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955114057"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> The function already exists and is called in current code.\r\n\r\nRight, I did not consider that. Don't think it's worth the extra PR without more demand for it so I'm happy to just leave it at `ErrorString` until then.",
      "commit_id" : "10e158a5b57ba3a26e5046a9b42fcc757652f35a",
      "created_at" : "2022-08-25T15:28:02Z",
      "diff_hunk" : "@@ -31,54 +144,89 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            if (!this->m_info) this->m_info = std::make_unique<detail::ErrorInfo<F>>();\n+            this->m_info->failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << std::move(other);\n+        if (other) this->MoveValue(other); else if (other.m_info) this->m_info->failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+    template <typename FT, typename FF>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    template <typename OT, typename OF>\n+    Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other)\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n+    }\n+    ~Result() { if (*this) this->DestroyValue(); }\n+\n+    //! Operator moving warning and error messages from one result to another.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template <typename OT, typename OF>\n+    Result<OT, OF>&& operator<<(Result<OT, OF>&& other)\n+    {\n+        if (other.m_info && !this->m_info) {\n+            this->m_info.reset(new detail::ErrorInfo<F>{.errors = std::move(other.m_info->errors),\n+                                                        .warnings = std::move(other.m_info->warnings)});\n+        } else if (other.m_info && this->m_info) {\n+            detail::MoveElements(other.m_info->errors, this->m_info->errors);\n+            detail::MoveElements(other.m_info->warnings, this->m_info->warnings);\n+        }\n+        return std::move(other);\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Helper methods to format error strings.\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors);\n+bilingual_str ErrorString(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+template <typename T, typename F>\n+bilingual_str ErrorString(const Result<T, F>& result) { return ErrorString(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r955114057",
      "id" : 955114057,
      "in_reply_to_id" : 950215859,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58447eJJ",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 229,
      "original_position" : 252,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1085668250,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955114057/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T15:28:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955114057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957494674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957494674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The thing is that you are basically adding a ton of dead code in this pull. `bitcoind` compiles fine without it, so I might be picky, but my preference would be to only add the code when it is needed. This also makes it easier for reviewers because they can think about actual use cases and don't have to imagine them from the unit tests.\r\n\r\n\r\n```diff\r\ndiff --git a/src/util/result.cpp b/src/util/result.cpp\r\nindex 9526b5b785..199a6579d7 100644\r\n--- a/src/util/result.cpp\r\n+++ b/src/util/result.cpp\r\n@@ -3,26 +3,8 @@\r\n // file COPYING or https://www.opensource.org/licenses/mit-license.php.\r\n \r\n #include <util/result.h>\r\n-#include <util/string.h>\r\n \r\n namespace util {\r\n namespace detail {\r\n-bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str> warnings)\r\n-{\r\n-    bilingual_str result;\r\n-    for (const auto& messages : {errors, warnings}) {\r\n-        for (const auto& message : messages) {\r\n-            if (!result.empty()) result += Untranslated(\" \");\r\n-            result += message;\r\n-        }\r\n-    }\r\n-    return result;\r\n-}\r\n-\r\n-void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest)\r\n-{\r\n-    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\r\n-    src.clear();\r\n-}\r\n } // namespace detail\r\n } // namespace util\r\ndiff --git a/src/util/result.h b/src/util/result.h\r\nindex 32fe40763f..8eb5b552d3 100644\r\n--- a/src/util/result.h\r\n+++ b/src/util/result.h\r\n@@ -17,21 +17,11 @@\r\n \r\n namespace util {\r\n namespace detail {\r\n-//! Empty string list\r\n-const std::vector<bilingual_str> EMPTY_LIST{};\r\n-\r\n-//! Helper function to join messages in space separated string.\r\n-bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str> warnings);\r\n-\r\n-//! Helper function to move messages from one vector to another.\r\n-void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest);\r\n-\r\n-//! Error information only allocated if there are errors or warnings.\r\n+//! Error information only allocated if there is an error.\r\n template <typename F>\r\n struct ErrorInfo {\r\n     std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure{};\r\n-    std::vector<bilingual_str> errors;\r\n-    std::vector<bilingual_str> warnings;\r\n+    bilingual_str error;\r\n };\r\n \r\n //! Result base class which is inherited by Result<T, F>.\r\n@@ -66,25 +56,7 @@ protected:\r\n public:\r\n     void AddError(bilingual_str error)\r\n     {\r\n-        if (!error.empty()) Info().errors.emplace_back(std::move(error));\r\n-    }\r\n-\r\n-    void AddWarning(bilingual_str warning)\r\n-    {\r\n-        if (!warning.empty()) Info().warnings.emplace_back(std::move(warning));\r\n-    }\r\n-\r\n-    //! Operator moving warning and error messages from other result to this.\r\n-    //! Only moves message strings, does not change success or failure values of\r\n-    //! either Result object.\r\n-    template<typename O>\r\n-    O&& operator<<(O&& other)\r\n-    {\r\n-        if (other.m_info) {\r\n-            if (!other.m_info->errors.empty()) MoveMessages(other.m_info->errors, Info().errors);\r\n-            if (!other.m_info->warnings.empty()) MoveMessages(other.m_info->warnings, Info().warnings);\r\n-        }\r\n-        return std::forward<O>(other);\r\n+        Info().error = std::move(error);\r\n     }\r\n \r\n     //! Success check.\r\n@@ -93,8 +65,7 @@ public:\r\n     //! Error retrieval.\r\n     template <typename _F = F>\r\n     std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\r\n-    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\r\n-    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }\r\n+    bilingual_str GetError() const { return m_info ? m_info->error : bilingual_str{}; }\r\n };\r\n \r\n //! Result base class for T value type. Holds value and provides accessor methods.\r\n@@ -145,9 +116,6 @@ public:\r\n struct Error {\r\n     bilingual_str message;\r\n };\r\n-struct Warning {\r\n-    bilingual_str message;\r\n-};\r\n \r\n //! The util::Result class provides a standard way for functions to return error\r\n //! and warning strings in addition to optional result values.\r\n@@ -190,23 +158,11 @@ protected:\r\n         }, std::forward<Args>(args)...);\r\n     }\r\n \r\n-    template <typename Fn, typename... Args>\r\n-    void Construct(const Fn& fn, Warning warning, Args&&... args)\r\n-    {\r\n-        this->AddWarning(std::move(warning.message));\r\n-        Construct(fn, std::forward<Args>(args)...);\r\n-    }\r\n-\r\n-    template <typename Fn, typename OT, typename OF, typename... Args>\r\n-    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\r\n-    {\r\n-        *this << other;\r\n-        Construct(fn, std::forward<Args>(args)...);\r\n-    }\r\n-\r\n     void MoveConstruct(Result& other)\r\n     {\r\n-        *this << other;\r\n+        if (other.m_info) {\r\n+            this->AddError(std::move(other.m_info->error));\r\n+        }\r\n         if (other) this->MoveValue(other); else this->Info().failure = std::move(other.m_info->failure);\r\n     }\r\n \r\n@@ -233,7 +189,7 @@ public:\r\n //! are present. More complicated applications should use GetErrors() and\r\n //! GetWarning() methods directly.\r\n template <typename T, typename F>\r\n-bilingual_str ErrorString(const Result<T, F>& result) { return detail::JoinMessages(result.GetErrors(), result.GetWarnings()); }\r\n+bilingual_str ErrorString(const Result<T, F>& result) { return result.GetError(); }\r\n } // namespace util\r\n \r\n #endif // BITCOIN_UTIL_RESULT_H\r\n",
      "commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "created_at" : "2022-08-29T15:35:26Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957494674",
      "id" : 957494674,
      "in_reply_to_id" : 944367210,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5845EjWS",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 97,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 90,
      "pull_request_review_id" : 1088925380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957494674/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T15:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957494674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957495310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957495310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In case you don't remove this, this is wrong anyway, as it is missing a `&` in the second argument",
      "commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "created_at" : "2022-08-29T15:36:04Z",
      "diff_hunk" : "@@ -8,16 +8,149 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str> warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957495310",
      "id" : 957495310,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII5845EjgO",
      "original_commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "original_line" : 24,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 17,
      "pull_request_review_id" : 1088926315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957495310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T15:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957495310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957498746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957498746"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Can use `is_same_v` instead of `...::value`? Also, missing LIFETIMEBOUND?\r\n\r\n(Same feedback on other lines where this is applicable)",
      "commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "created_at" : "2022-08-29T15:39:32Z",
      "diff_hunk" : "@@ -8,16 +8,149 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str> warnings);\n+\n+//! Helper function to move messages from one vector to another.\n+void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest);\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure{};\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    ErrorInfo<F>& Info()\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        return *m_info;\n+    }\n+\n+    //! Value accessors that do nothing this because class is specializing value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+    template <typename, typename>\n+    friend class ResultBase;\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (!error.empty()) Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from other result to this.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template<typename O>\n+    O&& operator<<(O&& other)\n+    {\n+        if (other.m_info) {\n+            if (!other.m_info->errors.empty()) MoveMessages(other.m_info->errors, Info().errors);\n+            if (!other.m_info->warnings.empty()) MoveMessages(other.m_info->warnings, Info().warnings);\n+        }\n+        return std::forward<O>(other);\n+    }\n+\n+    //! Success check.\n+    explicit operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957498746",
      "id" : 957498746,
      "line" : 95,
      "node_id" : "PRRC_kwDOABII5845EkV6",
      "original_commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "original_line" : 95,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 88,
      "pull_request_review_id" : 1088932989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957498746/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T15:39:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957498746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957539651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957539651"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957494674\r\n\r\n> The thing is that you are basically adding a ton of dead code in this pull\r\n\r\nInteresting and thanks for the diff! Now I understand what you are suggesting, and I think I'd be ok with making that change. I wasn't really looking at that code as dead because I'm immediately using it in the next pull #25722 and also using it in unit tests this PR. I also didn't consider it to be a ton of code, since the code in your diff is just getter/setter functions that provide access to errors/warnings variables. But no objection to splitting it off into another pull.",
      "commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "created_at" : "2022-08-29T16:15:49Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957539651",
      "id" : 957539651,
      "in_reply_to_id" : 944367210,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5845EuVD",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 97,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 90,
      "pull_request_review_id" : 1088988856,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957539651/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T16:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957539651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958050929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958050929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I don't feel too strong as well. Though, if you keep it, it would be good to fixup the typo: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957495310",
      "commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "created_at" : "2022-08-30T06:22:43Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958050929",
      "id" : 958050929,
      "in_reply_to_id" : 944367210,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5845GrJx",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 97,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 90,
      "pull_request_review_id" : 1089693226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958050929/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T06:22:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958050929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958679862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958679862"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957495310\r\n\r\n> In case you don't remove this, this is wrong anyway, as it is missing a `&` in the second argument\r\n\r\nThanks, removed from the main commit and added&",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-30T16:11:29Z",
      "diff_hunk" : "@@ -8,16 +8,149 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str> warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958679862",
      "id" : 958679862,
      "in_reply_to_id" : 957495310,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JEs2",
      "original_commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "original_line" : 24,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1090610240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958679862/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958679862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958680008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958680008"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957498746\r\n\r\n> nit: Can use `is_same_v` instead of `...::value`? Also, missing LIFETIMEBOUND?\r\n\r\nThanks, added these improvements",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-30T16:11:38Z",
      "diff_hunk" : "@@ -8,16 +8,149 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str> warnings);\n+\n+//! Helper function to move messages from one vector to another.\n+void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest);\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure{};\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    ErrorInfo<F>& Info()\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        return *m_info;\n+    }\n+\n+    //! Value accessors that do nothing this because class is specializing value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+    template <typename, typename>\n+    friend class ResultBase;\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (!error.empty()) Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from other result to this.\n+    //! Only moves message strings, does not change success or failure values of\n+    //! either Result object.\n+    template<typename O>\n+    O&& operator<<(O&& other)\n+    {\n+        if (other.m_info) {\n+            if (!other.m_info->errors.empty()) MoveMessages(other.m_info->errors, Info().errors);\n+            if (!other.m_info->warnings.empty()) MoveMessages(other.m_info->warnings, Info().warnings);\n+        }\n+        return std::forward<O>(other);\n+    }\n+\n+    //! Success check.\n+    explicit operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958680008",
      "id" : 958680008,
      "in_reply_to_id" : 957498746,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JEvI",
      "original_commit_id" : "5aff7baf375c432746dff6862e9d06064ea1fb18",
      "original_line" : 95,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1090610240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958680008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958680008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958800957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958800957"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958050929\r\n\r\n> Yeah, I don't feel too strong as well. Though, if you keep it, it would be good to fixup the typo: [#25665 (comment)](https://github.com/bitcoin/bitcoin/pull/25665#discussion_r957495310)\r\n\r\nOk, I'm hedging right now by moving multiple error & warning support into a separate commit but not a separate PR. I maybe have a slight preference for just squashing the commits again to reduce churn, but I'm also fine with keeping separate commits, or moving the commit to another PR if one of those alternatives seems better, so let me know!\r\n\r\nAlso fixed the typo",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-30T18:25:17Z",
      "diff_hunk" : "@@ -8,16 +8,133 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same<F, void>::value, std::monostate, F>> failure;\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    template <typename... Args>\n+    void InitFailure(Args&&... args)\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->failure.emplace(std::forward<Args>(args)...);\n+    }\n+    void InitValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    void AddError(bilingual_str error)\n+    {\n+        if (error.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (warning.empty()) return;\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        m_info->warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Success check.\n+    operator bool() const { return !m_info || !m_info->failure; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same<_F, void>::value, const _F&> GetFailure() const { assert(!*this); return *m_info->failure; }\n+    const std::vector<bilingual_str>& GetErrors() const { return m_info ? m_info->errors : EMPTY_LIST; }\n+    const std::vector<bilingual_str>& GetWarnings() const { return m_info ? m_info->warnings : EMPTY_LIST; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958800957",
      "id" : 958800957,
      "in_reply_to_id" : 944367210,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JiQ9",
      "original_commit_id" : "590bc615a3120a8f11712220546f9654058b82f0",
      "original_line" : 97,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1090610240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958800957/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958800957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958847991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958847991"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `EMPTY_LIST` ( and `#include <vector>` ) seems unnecessary in this commit, think it belongs in \"[refactor: Add util::Result multiple error and warning messages](https://github.com/bitcoin/bitcoin/pull/25665/commits/834857e56b8de0bfabee7315622c0211b4a48746)\"",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-30T19:21:03Z",
      "diff_hunk" : "@@ -8,16 +8,146 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958847991",
      "id" : 958847991,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII5845Jtv3",
      "original_commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "original_line" : 21,
      "original_position" : 14,
      "original_start_line" : 20,
      "path" : "src/util/result.h",
      "position" : 14,
      "pull_request_review_id" : 1090849342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958847991/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 20,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-31T11:33:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958847991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958993493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958993493"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's a little confusing.\r\nIf I understand correctly, `template <typename F> class ResultBase<void, F>` needs to know about `template <typename T, typename F> class ResultBase;` but the latter can only be declared after the former because it is a derived class. Therefore, a forward declaration is required.\r\n\r\nIf the `ResultBase` classes shouldn't be used anywhere outside of `result.h` and their only purpose is to be the base class of `Result`, I would suggest merging them all into a single class.\r\n\r\n",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-30T22:41:54Z",
      "diff_hunk" : "@@ -8,16 +8,146 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+\n+//! Helper function to move messages from one vector to another.\n+void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest);\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same_v<F, void>, std::monostate, F>> failure{};\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958993493",
      "id" : 958993493,
      "line" : 41,
      "node_id" : "PRRC_kwDOABII5845KRRV",
      "original_commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "original_line" : 41,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 34,
      "pull_request_review_id" : 1091053363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958993493/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T22:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958993493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959071851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959071851"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, I wonder if you can say more about what is confusing or misleading. This is just a forward declaration for a template class.\r\n\r\n It is true that the reason for the forward declaring `ResultBase<T, F>` is to allow it to inherit from `ResultBase<void, F>`. So `ResultBase<T, F>` must be defined after `ResultBase<void, F>`, but declared before it.\r\n\r\nBut this is a pretty standard thing for C and C++ code. Definition of one thing 1 depends on declaration of thing 2, so thing 2 needs to be forward declared. It can happen for normal classes and functions as well as templates.\r\n\r\n> If the ResultBase classes shouldn't be used anywhere outside of result.h and their only purpose is to be the base class of Result, I would suggest merging them all into a single class.\r\n\r\nThis isn't easily possible because `Result<void, F>` inherits directly from `detail::ResultBase<void, F>` and does **not** inherit from `detail::ResultBase<T, F>`. It does not have an `m_value` member or `value()` functions or a dereferencing operator. If the result type `T` is void the `Result` class doesn't hold a value and can't be dereferenced.",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-31T01:57:58Z",
      "diff_hunk" : "@@ -8,16 +8,146 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+\n+//! Helper function to move messages from one vector to another.\n+void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest);\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same_v<F, void>, std::monostate, F>> failure{};\n+    std::vector<bilingual_str> errors;\n+    std::vector<bilingual_str> warnings;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959071851",
      "id" : 959071851,
      "in_reply_to_id" : 958993493,
      "line" : 41,
      "node_id" : "PRRC_kwDOABII5845KkZr",
      "original_commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "original_line" : 41,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 34,
      "pull_request_review_id" : 1091208071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959071851/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-31T01:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959071851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959440278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959440278"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since the `friend` declaration is gone, I think this should be `inline`?\r\n```suggestion\r\ninline bilingual_str ErrorString(const Result<T, F>& result) { return detail::JoinMessages(result.GetErrors(), result.GetWarnings()); }\r\n```",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-31T10:50:34Z",
      "diff_hunk" : "@@ -31,54 +161,76 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+//!\n+//! Most code does not need different error-handling behavior for different\n+//! types of errors, and can suffice just using the type `T` success value on\n+//! success, and descriptive error strings when there's a failure. But\n+//! applications that do need more complicated error-handling behavior can\n+//! override the default `F = void` failure type and get failure values by\n+//! calling result.GetFailure().\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            this->Info().failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << other;\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    void MoveConstruct(Result& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << other;\n+        if (other) this->MoveValue(other); else this->Info().failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    Result(Result&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n+    ~Result() { if (*this) this->DestroyValue(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Join error and warning messages in a space separated string. This is\n+//! intended for simple applications where there's probably only one error or\n+//! warning message to report, but multiple messages should not be lost if they\n+//! are present. More complicated applications should use GetErrors() and\n+//! GetWarning() methods directly.\n+template <typename T, typename F>\n+bilingual_str ErrorString(const Result<T, F>& result) { return detail::JoinMessages(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959440278",
      "id" : 959440278,
      "line" : 233,
      "node_id" : "PRRC_kwDOABII5845L-WW",
      "original_commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "original_line" : 233,
      "original_position" : 256,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 256,
      "pull_request_review_id" : 1090849342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959440278/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-31T11:33:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959440278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959467658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959467658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe I'm confused, but I don't think I agree. Since the optional allocation of an `ErrorInfo` is a result of how `Info()` is implemented, not of how the `ErrorInfo` struct is defined - isn't that where it should be documented? Unless you're talking about the optional allocation of `failure` instead of `ErrorInfo`, in which case I would agree that this should be explained at this location (and you might want to add another one to info explaining the dynamic allocation of `m_info`)?",
      "commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "created_at" : "2022-08-31T11:23:55Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959467658",
      "id" : 959467658,
      "in_reply_to_id" : 950223870,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII5845MFCK",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 29,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 22,
      "pull_request_review_id" : 1090849342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959467658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-31T11:33:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959467658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r960699702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960699702"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r958847991\r\n\r\n> nit: `EMPTY_LIST` ( and `#include <vector>` ) seems unnecessary in this commit, think it belongs in \"[refactor: Add util::Result multiple error and warning messages](https://github.com/bitcoin/bitcoin/pull/25665/commits/834857e56b8de0bfabee7315622c0211b4a48746)\"\r\n\r\nGood catch! Removed",
      "commit_id" : "82c549aa538a5318fdb56d91117b4c9fc43737de",
      "created_at" : "2022-09-01T14:05:27Z",
      "diff_hunk" : "@@ -8,16 +8,146 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r960699702",
      "id" : 960699702,
      "in_reply_to_id" : 958847991,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII5845Qx02",
      "original_commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "original_line" : 21,
      "original_position" : 14,
      "original_start_line" : 20,
      "path" : "src/util/result.h",
      "position" : 14,
      "pull_request_review_id" : 1093461843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960699702/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 20,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-01T15:21:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960699702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r960701013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960701013"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959440278\r\n\r\n> Since the `friend` declaration is gone, I think this should be `inline`?\r\n\r\nYes, makes sense to be inline.\r\n\r\n",
      "commit_id" : "82c549aa538a5318fdb56d91117b4c9fc43737de",
      "created_at" : "2022-09-01T14:06:34Z",
      "diff_hunk" : "@@ -31,54 +161,76 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+//!\n+//! Most code does not need different error-handling behavior for different\n+//! types of errors, and can suffice just using the type `T` success value on\n+//! success, and descriptive error strings when there's a failure. But\n+//! applications that do need more complicated error-handling behavior can\n+//! override the default `F = void` failure type and get failure values by\n+//! calling result.GetFailure().\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+protected:\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Args&&... args)\n+    {\n+        fn(std::forward<Args>(args)...);\n+    }\n \n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Error error, Args&&... args)\n+    {\n+        this->AddError(std::move(error.message));\n+        Construct([&](auto&&... x) {\n+            this->Info().failure.emplace(std::forward<decltype(x)>(x)...);\n+        }, std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename Fn, typename... Args>\n+    void Construct(const Fn& fn, Warning warning, Args&&... args)\n+    {\n+        this->AddWarning(std::move(warning.message));\n+        Construct(fn, std::forward<Args>(args)...);\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template <typename Fn, typename OT, typename OF, typename... Args>\n+    void Construct(const Fn& fn, Result<OT, OF>&& other, Args&&... args)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << other;\n+        Construct(fn, std::forward<Args>(args)...);\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    void MoveConstruct(Result& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        *this << other;\n+        if (other) this->MoveValue(other); else this->Info().failure = std::move(other.m_info->failure);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) const&\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.\n+    template <typename... Args>\n+    Result(Args&&... args)\n     {\n-        return has_value() ? value() : std::forward<U>(default_value);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n-    template <class U>\n-    T value_or(U&& default_value) &&\n+    Result(Result&& other) { MoveConstruct(other); }\n+    Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        return has_value() ? std::move(value()) : std::forward<U>(default_value);\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n+        MoveConstruct(other);\n+        return *this;\n     }\n-    explicit operator bool() const noexcept { return has_value(); }\n-    const T* operator->() const LIFETIMEBOUND { return &value(); }\n-    const T& operator*() const LIFETIMEBOUND { return value(); }\n-    T* operator->() LIFETIMEBOUND { return &value(); }\n-    T& operator*() LIFETIMEBOUND { return value(); }\n+    ~Result() { if (*this) this->DestroyValue(); }\n };\n \n-template <typename T>\n-bilingual_str ErrorString(const Result<T>& result)\n-{\n-    return result ? bilingual_str{} : std::get<0>(result.m_variant);\n-}\n+//! Join error and warning messages in a space separated string. This is\n+//! intended for simple applications where there's probably only one error or\n+//! warning message to report, but multiple messages should not be lost if they\n+//! are present. More complicated applications should use GetErrors() and\n+//! GetWarning() methods directly.\n+template <typename T, typename F>\n+bilingual_str ErrorString(const Result<T, F>& result) { return detail::JoinMessages(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r960701013",
      "id" : 960701013,
      "in_reply_to_id" : 959440278,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845QyJV",
      "original_commit_id" : "834857e56b8de0bfabee7315622c0211b4a48746",
      "original_line" : 233,
      "original_position" : 256,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1093461843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960701013/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-01T15:21:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960701013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r960702129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960702129"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r959467658\r\n\r\n> Maybe I'm confused, but I don't think I agree. Since the optional allocation of an `ErrorInfo` is a result of how `Info()` is implemented, not of how the `ErrorInfo` struct is defined - isn't that where it should be documented?\r\n\r\nI'm only pushing back against removing this comment here. I'm happy to add more documentation anywhere would would like.\r\n\r\nI think the answer to your question is no, because this isn't a general purpose API. This is a custom, private struct that is never exposed externally and exists for one purpose. The comment is describing what the purpose is. If I were reading this code and saw this struct, I would be wondering why there is such a heavyweight struct being used in a lightweight result type, why error information is segregated from normal result information, and why a separate struct definition is needed at all instead using normal class members. This comment explains what the purpose of the struct is, why it exists and how it is used, and I think is appropriate documentation for an single-purpose piece of a larger implementation.",
      "commit_id" : "82c549aa538a5318fdb56d91117b4c9fc43737de",
      "created_at" : "2022-09-01T14:07:34Z",
      "diff_hunk" : "@@ -8,16 +8,129 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper to move elements from one container to another.\n+template <typename T>\n+void MoveElements(T& src, T& dest)\n+{\n+    dest.insert(dest.end(), std::make_move_iterator(src.begin()), std::make_move_iterator(src.end()));\n+    src.clear();\n+}\n+\n+//! Error information only allocated if there are errors or warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r960702129",
      "id" : 960702129,
      "in_reply_to_id" : 950223870,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII5845Qyax",
      "original_commit_id" : "9bd10728bada8b04d86f5621ee127713f628a9ad",
      "original_line" : 29,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 22,
      "pull_request_review_id" : 1093461843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960702129/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-01T15:21:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960702129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some changes made earlier in https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1085638384 broke derived-to-base type conversions used in followup PR #25722. Latest push fixes this and adds a test.\r\n\r\nUpdated 82c549aa538a5318fdb56d91117b4c9fc43737de -> c14e904f66505b3e89ca1138c8d2fa4e3d0916d0 ([`pr/bresult2.17`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.17) -> [`pr/bresult2.18`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.18), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.17..pr/bresult2.18)) adding fix and test for derived to base conversions\r\n",
      "created_at" : "2022-09-01T21:02:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1234778363",
      "id" : 1234778363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585JmTj7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1234778363/reactions"
      },
      "updated_at" : "2022-09-01T21:02:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1234778363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r965007804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965007804"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: typo\r\n```suggestion\r\n    //! Value accessors that do nothing because this class has value type T=void.\r\n```",
      "commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "created_at" : "2022-09-07T15:42:05Z",
      "diff_hunk" : "@@ -8,16 +8,149 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+\n+//! Helper function to move messages from one vector to another.\n+void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest);\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same_v<F, void>, std::monostate, F>> failure{};\n+    std::vector<bilingual_str> errors{};\n+    std::vector<bilingual_str> warnings{};\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    ErrorInfo<F>& Info() LIFETIMEBOUND\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        return *m_info;\n+    }\n+\n+    //! Value accessors that do nothing this because class has value type T=void.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r965007804",
      "id" : 965007804,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII5845hNm8",
      "original_commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "original_line" : 57,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 50,
      "pull_request_review_id" : 1099419063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965007804/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-07T16:40:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965007804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968378495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968378495"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in https://github.com/bitcoin/bitcoin/commit/3507da864a1dd7be1bc72ada26d830a4da0c37ae:\r\n\r\nI think in C++17 you can remove all of the template and enable_if_t stuff and just write `const auto& GetFailure() const` for the return type.",
      "commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "created_at" : "2022-09-12T12:51:18Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    //! Success check.\n+    explicit operator bool() const { return !m_info; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same_v<_F, void>, const _F&> GetFailure() const LIFETIMEBOUND { assert(!*this); return m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968378495",
      "id" : 968378495,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845uEh_",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 53,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 46,
      "pull_request_review_id" : 1103995676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968378495/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-12T15:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968378495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968432479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968432479"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in c14e904f66505b3e89ca1138c8d2fa4e3d0916d0:\r\n\r\nCan remove `inline`, as all `template` are `inline` by definition.",
      "commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "created_at" : "2022-09-12T13:38:07Z",
      "diff_hunk" : "@@ -154,26 +219,26 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n     ~Result() { if (*this) this->DestroyValue(); }\n-\n-    inline friend bilingual_str _ErrorString(const Result& result)\n-    {\n-        return result ? bilingual_str{} : result.m_info->error;\n-    }\n };\n \n-template<typename T, typename F>\n-inline bilingual_str ErrorString(const Result<T, F>& result) { return _ErrorString(result); }\n+//! Join error and warning messages in a space separated string. This is\n+//! intended for simple applications where there's probably only one error or\n+//! warning message to report, but multiple messages should not be lost if they\n+//! are present. More complicated applications should use GetErrors() and\n+//! GetWarning() methods directly.\n+template <typename T, typename F>\n+inline bilingual_str ErrorString(const Result<T, F>& result) { return detail::JoinMessages(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968432479",
      "id" : 968432479,
      "line" : 241,
      "node_id" : "PRRC_kwDOABII5845uRtf",
      "original_commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "original_line" : 241,
      "original_position" : 180,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 180,
      "pull_request_review_id" : 1103995676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968432479/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-12T15:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968432479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968475794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968475794"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 3507da864a1dd7be1bc72ada26d830a4da0c37ae:\r\n\r\nMaybe add a comment to explain those a bit more? While the `ResultBase()` constructor leaves the object uninitialized, the `Result` constructor guarantees that the object is either filled with a value or an error.",
      "commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "created_at" : "2022-09-12T14:14:31Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    //! Success check.\n+    explicit operator bool() const { return !m_info; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same_v<_F, void>, const _F&> GetFailure() const LIFETIMEBOUND { assert(!*this); return m_info->failure; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    //! Result success value. Uses anonymous union so success value is never\n+    //! constructed in failure case.\n+    union { T m_value; };\n+\n+    template <typename... Args>\n+    void ConstructValue(Args&&... args) { new (&m_value) T{std::forward<Args>(args)...}; }\n+    template <typename O>\n+    void MoveValue(O& other) { new (&m_value) T{std::move(other.m_value)}; }\n+    void DestroyValue() { m_value.~T(); }\n+\n+    ResultBase() {}\n+    ~ResultBase() {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968475794",
      "id" : 968475794,
      "line" : 116,
      "node_id" : "PRRC_kwDOABII5845ucSS",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 72,
      "original_position" : 65,
      "original_start_line" : 71,
      "path" : "src/util/result.h",
      "position" : 65,
      "pull_request_review_id" : 1103995676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968475794/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 115,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-12T15:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968475794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968480620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968480620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 3507da864a1dd7be1bc72ada26d830a4da0c37ae:\r\n\r\ndoxygen will attach the comment to the constructor. In any case, I think this can be removed since it is not adding any info that isn't already there.",
      "commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "created_at" : "2022-09-12T14:18:44Z",
      "diff_hunk" : "@@ -31,54 +117,63 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+//!\n+//! Most code does not need different error-handling behavior for different\n+//! types of errors, and can suffice just using the type `T` success value on\n+//! success, and descriptive error strings when there's a failure. But\n+//! applications that do need more complicated error-handling behavior can\n+//! override the default `F = void` failure type and get failure values by\n+//! calling result.GetFailure().\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n-\n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+protected:\n+    template <typename... Args>\n+    void Construct(Args&&... args)\n+    {\n+        this->ConstructValue(std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename... Args>\n+    void Construct(Error error, Args&&... args)\n+    {\n+        this->m_info.reset(new detail::ErrorInfo<F>{.failure{std::forward<Args>(args)...}, .error{std::move(error.message)}});\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template<typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        if (other) this->MoveValue(other); else this->m_info.reset(new detail::ErrorInfo<F>{std::move(*other.m_info)});\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename, typename>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968480620",
      "id" : 968480620,
      "line" : 218,
      "node_id" : "PRRC_kwDOABII5845udds",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 153,
      "original_position" : 159,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 159,
      "pull_request_review_id" : 1103995676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968480620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-12T15:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968480620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968486440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968486440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 3507da864a1dd7be1bc72ada26d830a4da0c37ae:\r\n\r\nAre those really \"accessors\", not \"setters\"?",
      "commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "created_at" : "2022-09-12T14:23:40Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968486440",
      "id" : 968486440,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII5845ue4o",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 41,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 34,
      "pull_request_review_id" : 1103995676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968486440/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-12T15:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968486440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968493416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968493416"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 3507da864a1dd7be1bc72ada26d830a4da0c37ae:\r\n\r\nSeems overkill to include variant, when it could be replaced by copy-pasting the one line:\r\n\r\n```\r\nstruct MonoState{}; // Similar to std::monostate",
      "commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "created_at" : "2022-09-12T14:29:21Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968493416",
      "id" : 968493416,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII5845uglo",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 15,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 8,
      "pull_request_review_id" : 1103995676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968493416/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-12T15:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968493416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968815960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968815960"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r965007804\r\n\r\n> nit: typo\r\n\r\nThanks, fixed",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-12T18:59:40Z",
      "diff_hunk" : "@@ -8,16 +8,149 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Empty string list\n+const std::vector<bilingual_str> EMPTY_LIST{};\n \n+//! Helper function to join messages in space separated string.\n+bilingual_str JoinMessages(const std::vector<bilingual_str>& errors, const std::vector<bilingual_str>& warnings);\n+\n+//! Helper function to move messages from one vector to another.\n+void MoveMessages(std::vector<bilingual_str>& src, std::vector<bilingual_str>& dest);\n+\n+//! Error information only allocated if there are errors or warnings.\n+template <typename F>\n+struct ErrorInfo {\n+    std::optional<std::conditional_t<std::is_same_v<F, void>, std::monostate, F>> failure{};\n+    std::vector<bilingual_str> errors{};\n+    std::vector<bilingual_str> warnings{};\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n+\n+    ErrorInfo<F>& Info() LIFETIMEBOUND\n+    {\n+        if (!m_info) m_info = std::make_unique<ErrorInfo<F>>();\n+        return *m_info;\n+    }\n+\n+    //! Value accessors that do nothing this because class has value type T=void.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968815960",
      "id" : 968815960,
      "in_reply_to_id" : 965007804,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845vvVY",
      "original_commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "original_line" : 57,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1104682926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968815960/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T15:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968815960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968819074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968819074"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968378495\r\n\r\n> I think in C++17 you can remove all of the template and enable_if_t stuff and just write `const auto& GetFailure() const` for the return type.\r\n\r\nThanks, that is better. Simplified now.",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-12T19:01:21Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    //! Success check.\n+    explicit operator bool() const { return !m_info; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same_v<_F, void>, const _F&> GetFailure() const LIFETIMEBOUND { assert(!*this); return m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968819074",
      "id" : 968819074,
      "in_reply_to_id" : 968378495,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845vwGC",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 53,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1104682926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968819074/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T15:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968819074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968821496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968821496"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968432479\r\n\r\n> Can remove `inline`, as all `template` are `inline` by definition.\r\n\r\nThanks, removed `inline`",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-12T19:02:44Z",
      "diff_hunk" : "@@ -154,26 +219,26 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n     ~Result() { if (*this) this->DestroyValue(); }\n-\n-    inline friend bilingual_str _ErrorString(const Result& result)\n-    {\n-        return result ? bilingual_str{} : result.m_info->error;\n-    }\n };\n \n-template<typename T, typename F>\n-inline bilingual_str ErrorString(const Result<T, F>& result) { return _ErrorString(result); }\n+//! Join error and warning messages in a space separated string. This is\n+//! intended for simple applications where there's probably only one error or\n+//! warning message to report, but multiple messages should not be lost if they\n+//! are present. More complicated applications should use GetErrors() and\n+//! GetWarning() methods directly.\n+template <typename T, typename F>\n+inline bilingual_str ErrorString(const Result<T, F>& result) { return detail::JoinMessages(result.GetErrors(), result.GetWarnings()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968821496",
      "id" : 968821496,
      "in_reply_to_id" : 968432479,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845vwr4",
      "original_commit_id" : "c14e904f66505b3e89ca1138c8d2fa4e3d0916d0",
      "original_line" : 241,
      "original_position" : 180,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1104682926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968821496/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T15:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968821496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968822785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968822785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968475794\r\n\r\n> Maybe add a comment to explain those a bit more? While the `ResultBase()` constructor leaves the object uninitialized, the `Result` constructor guarantees that the object is either filled with a value or an error.\r\n\r\nSure, I moved the DestroyValue call to this `~ResultBase` destructor instead of the other `Result` constructor to make this more self contained and clear. Also added a comment explaining why the empty constructor is required. Hopefully these are improvements. Also happy to make other changes to clarify.\r\n",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-12T19:03:27Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    //! Success check.\n+    explicit operator bool() const { return !m_info; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same_v<_F, void>, const _F&> GetFailure() const LIFETIMEBOUND { assert(!*this); return m_info->failure; }\n+};\n+\n+//! Result base class for T value type. Holds value and provides accessor methods.\n+template <typename T, typename F>\n+class ResultBase : public ResultBase<void, F>\n+{\n+protected:\n+    //! Result success value. Uses anonymous union so success value is never\n+    //! constructed in failure case.\n+    union { T m_value; };\n+\n+    template <typename... Args>\n+    void ConstructValue(Args&&... args) { new (&m_value) T{std::forward<Args>(args)...}; }\n+    template <typename O>\n+    void MoveValue(O& other) { new (&m_value) T{std::move(other.m_value)}; }\n+    void DestroyValue() { m_value.~T(); }\n+\n+    ResultBase() {}\n+    ~ResultBase() {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968822785",
      "id" : 968822785,
      "in_reply_to_id" : 968475794,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845vxAB",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 72,
      "original_position" : 65,
      "original_start_line" : 71,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1104682926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968822785/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T15:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968822785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968824406"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968824406"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968480620\r\n\r\n> nit in [3507da8](https://github.com/bitcoin/bitcoin/commit/3507da864a1dd7be1bc72ada26d830a4da0c37ae):\r\n> \r\n> doxygen will attach the comment to the constructor. In any case, I think this can be removed since it is not adding any info that isn't already there.\r\n\r\nThanks, dropped. This was used to group methods in an earlier version of PR that had more methods below.",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-12T19:04:32Z",
      "diff_hunk" : "@@ -31,54 +117,63 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+//!\n+//! Most code does not need different error-handling behavior for different\n+//! types of errors, and can suffice just using the type `T` success value on\n+//! success, and descriptive error strings when there's a failure. But\n+//! applications that do need more complicated error-handling behavior can\n+//! override the default `F = void` failure type and get failure values by\n+//! calling result.GetFailure().\n+template <typename T, typename F = void>\n+class Result : public detail::ResultBase<T, F>\n {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n-\n-    template <typename FT>\n-    friend bilingual_str ErrorString(const Result<FT>& result);\n+protected:\n+    template <typename... Args>\n+    void Construct(Args&&... args)\n+    {\n+        this->ConstructValue(std::forward<Args>(args)...);\n+    }\n \n-public:\n-    Result(T obj) : m_variant{std::in_place_index_t<1>{}, std::move(obj)} {}\n-    Result(Error error) : m_variant{std::in_place_index_t<0>{}, std::move(error.message)} {}\n+    template <typename... Args>\n+    void Construct(Error error, Args&&... args)\n+    {\n+        this->m_info.reset(new detail::ErrorInfo<F>{.failure{std::forward<Args>(args)...}, .error{std::move(error.message)}});\n+    }\n \n-    //! std::optional methods, so functions returning optional<T> can change to\n-    //! return Result<T> with minimal changes to existing code, and vice versa.\n-    bool has_value() const noexcept { return m_variant.index() == 1; }\n-    const T& value() const LIFETIMEBOUND\n+    template<typename OT, typename OF>\n+    void MoveConstruct(Result<OT, OF>& other)\n     {\n-        assert(has_value());\n-        return std::get<1>(m_variant);\n+        if (other) this->MoveValue(other); else this->m_info.reset(new detail::ErrorInfo<F>{std::move(*other.m_info)});\n     }\n-    T& value() LIFETIMEBOUND\n+\n+    template <typename, typename>\n+    friend class Result;\n+\n+public:\n+    //! Constructors, destructor, and assignment operator.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968824406",
      "id" : 968824406,
      "in_reply_to_id" : 968480620,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845vxZW",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 153,
      "original_position" : 159,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1104682926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968824406/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T15:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968824406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968825385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968825385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968486440\r\n\r\n> nit in [3507da8](https://github.com/bitcoin/bitcoin/commit/3507da864a1dd7be1bc72ada26d830a4da0c37ae):\r\n> \r\n> Are those really \"accessors\", not \"setters\"?\r\n\r\nChanged to setters (I thought accessors was a general term for getters and setters)",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-12T19:05:13Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968825385",
      "id" : 968825385,
      "in_reply_to_id" : 968486440,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845vxop",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 41,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1104682926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968825385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T15:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968825385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968826148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968826148"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968493416\r\n\r\n> Seems overkill to include variant, when it could be replaced by copy-pasting the one line:\r\n\r\nThanks, dropped the dependency on variant",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-12T19:05:49Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r968826148",
      "id" : 968826148,
      "in_reply_to_id" : 968493416,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845vx0k",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 15,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1104682926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968826148/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T15:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968826148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r969906681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969906681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, I meant `const auto&`, not `auto`, or is `auto` in this context magically the same as `const auto&`?",
      "commit_id" : "e04d8a754ff1b25cab483996319a583e6e3e680a",
      "created_at" : "2022-09-13T17:33:07Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    //! Success check.\n+    explicit operator bool() const { return !m_info; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same_v<_F, void>, const _F&> GetFailure() const LIFETIMEBOUND { assert(!*this); return m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r969906681",
      "id" : 969906681,
      "in_reply_to_id" : 968378495,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845z5n5",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 53,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1106198898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969906681/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T17:33:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969906681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Still need to review the last commit\r\n\r\n\r\nreview ACK 3af5f5adbb ð\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nreview ACK 3af5f5adbb ð\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUg+kgv/VMHBkcM/thQ5I6k4qE4vJdWFYuZQJFTe/KVPIpkC6nxuEr6Gi3staL6n\r\nmdRzkHsqS1Wpsm/kMUREBvEuTqUk+SPyv+spyWhnd86VSTa66clfJvrp0AD2kV6w\r\nuX5DlPzhb5fvgK59gJZ59Yq8bIcwqLe+hzvRBKdlqh5qxqnm1zSAB0O+KK4pwk9N\r\nz0mlPBWnM8qgmB3nnS9tWN58E4PUsue1Xb89GgNHh4DrnZTo/UrAPC9qsABeSU7+\r\nu1pU1Z9rpn57qmQI1LkQ9FDjZE8mL5NZ12OpISsNiXYVzQey6IiKsxzjfVtg3R4q\r\n5qtHzHtzx7XjDT40oAeb1Z1EWm+an5KME7Gk4/olR0PqDo2f2LILuwp9kCJJY7qt\r\nIdRWvHwAmU5J9EvgPOTWzWtU+LbsVwS3qoBwee2tlWrAxBjkdezuESFCDepq42wL\r\nTqzGBWAL40+MdjLBSeOYJm0ZuZHSHmqIDfykVyDmdM9SBaPstfkRmBngRIEKoCpM\r\n9PGi4h4Y\r\n=W7bY\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n\r\n</details>\r\n",
      "created_at" : "2022-09-13T17:36:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1245729262",
      "id" : 1245729262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585KQFHu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1245729262/reactions"
      },
      "updated_at" : "2022-09-13T17:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1245729262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r969983461"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969983461"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r969906681\r\n\r\n> Hmm, I meant `const auto&`, not `auto`, or is `auto` in this context magically the same as `const auto&`?\r\n\r\nNo, I just messed up and unintentionally did a copy. Fixed this and added tests to make sure GetFailure() does not copy.",
      "commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "created_at" : "2022-09-13T18:56:49Z",
      "diff_hunk" : "@@ -8,16 +8,102 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n #include <variant>\n+#include <vector>\n \n namespace util {\n+namespace detail {\n+//! Error information only allocated on failure.\n+template <typename F>\n+struct ErrorInfo {\n+    std::conditional_t<std::is_same_v<F, void>, std::monostate, F> failure;\n+    bilingual_str error;\n+};\n+\n+//! Result base class which is inherited by Result<T, F>.\n+//! T is the type of the success return value, or void if there is none.\n+//! F is the type of the failure return value, or void if there is none.\n+template <typename T, typename F>\n+class ResultBase;\n+\n+//! Result base specialization for empty (T=void) value type. Holds error\n+//! information and provides accessor methods.\n+template <typename F>\n+class ResultBase<void, F>\n+{\n+protected:\n+    std::unique_ptr<ErrorInfo<F>> m_info;\n \n+    //! Value accessors that do nothing this because class has value type T=void.\n+    void ConstructValue() {}\n+    template <typename O>\n+    void MoveValue(O& other) {}\n+    void DestroyValue() {}\n+\n+public:\n+    //! Success check.\n+    explicit operator bool() const { return !m_info; }\n+\n+    //! Error retrieval.\n+    template <typename _F = F>\n+    std::enable_if_t<!std::is_same_v<_F, void>, const _F&> GetFailure() const LIFETIMEBOUND { assert(!*this); return m_info->failure; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r969983461",
      "id" : 969983461,
      "in_reply_to_id" : 968378495,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58450MXl",
      "original_commit_id" : "3507da864a1dd7be1bc72ada26d830a4da0c37ae",
      "original_line" : 53,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1106306853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969983461/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T19:17:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969983461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r970561659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970561659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134: I don't like that this takes over error strings, but leaves the value and failure untouched. It seems fine to have a result and warnings, but having a result and also an error at the same time seems odd.\r\n\r\nSame with operator=. I think this is the first time I've seen that after calling `=`, state is preserved from before `=` was called.",
      "commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "created_at" : "2022-09-14T09:34:25Z",
      "diff_hunk" : "@@ -155,25 +194,48 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n \n-    inline friend bilingual_str _ErrorString(const Result& result)\n+    void AddError(bilingual_str error)\n     {\n-        return result ? bilingual_str{} : result.m_info->error;\n+        if (!error.empty()) this->Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) this->Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from this result object to\n+    //! another one. Only moves message strings, does not change success or\n+    //! failure values of either Result object.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r970561659",
      "id" : 970561659,
      "line" : 220,
      "node_id" : "PRRC_kwDOABII58452Zh7",
      "original_commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "original_line" : 220,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 154,
      "pull_request_review_id" : 1107131542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970561659/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-14T09:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970561659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971273150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971273150"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r970561659\r\n\r\n> [52a4e50](https://github.com/bitcoin/bitcoin/commit/52a4e50fb4b1171ee0f6814b0a50bc70cdd77134): I don't like that this takes over error strings, but leaves the value and failure untouched. It seems fine to have a result and warnings, but having a result and also an error at the same time seems odd.\r\n\r\nAgree having both a result value and an error message should be avoided. Also having neither a result value nor an error message should be avoided. But there are tradeoffs around where and how strictly you want to enforce these things. The main thing currently enforcing value/error consistency is having a constructor that sets error messages and failure values at the same time and does not allow setting a result value, and a constructor that only sets a success value and does not allow setting an error message.\r\n\r\nBut this leaves open the question of what helpers functions like `operator>>` should do when they combine multiple result values that have already been constructed.\r\n\r\nThe use-case for `operator>>` is when you have an outer function returning `Result<T, F>` calling inner functions returning `Result<T1, F1>`, and `Result<T2, F2>`, etc. Examples would be [`LoadWalletInternal`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/wallet.cpp#L229), [`CreateWallet`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/wallet.cpp#L298), and [`DoMigration`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/wallet.cpp#L3862) from #25722. The outer function can handle failures from inner functions it calls any way it wants: passing failure values up to its caller, translating failure values, ignoring failures, retrying after failures, falling back to an alternate approaches, etc. It sets success and failure values directly, and it can use `operator>>` to collect error and warning messages separately and pass them along. I don't think `operator>>` should be involved in success and failure value handling. I think it would be bad if `operator>>` discarded error messages, or it it threw runtime exceptions, instead of just passing messages on to ultimately get displayed or logged.\r\n\r\nIn C++ generally `operator>>` is used for things as varied as bit shifting and stream I/O and can be interpreted as \"move data from this place to another place\" so I think it reasonable that this `operator>>` just moves error and warning messages from one `Result` object to another, as long as behavior is clearly documented.\r\n\r\n> Same with operator=. I think this is the first time I've seen that after calling `=`, state is preserved from before `=` was called.\r\n\r\nYes it is true that assigning to an existing result does not erase warning and errors messages already accumulated in the result. It only sets the success or failure value and appends new warning and error messages to existing ones.\r\n\r\nI think this this behavior is safe and useful. Setting a value should not automatically erase warning and error messages that are meant to be displayed or logged. But if this behavior is too surprising for an `operator=` method, we don't actually need to make `Result` assignable, and could rename `operator=()` to `Set()` or `SetValue()`. It looks like even after #25722 there are only 3 `operator=` calls in the codebase outside of tests, so this would be an easy change.",
      "commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "created_at" : "2022-09-14T20:37:54Z",
      "diff_hunk" : "@@ -155,25 +194,48 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n \n-    inline friend bilingual_str _ErrorString(const Result& result)\n+    void AddError(bilingual_str error)\n     {\n-        return result ? bilingual_str{} : result.m_info->error;\n+        if (!error.empty()) this->Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) this->Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from this result object to\n+    //! another one. Only moves message strings, does not change success or\n+    //! failure values of either Result object.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971273150",
      "id" : 971273150,
      "in_reply_to_id" : 970561659,
      "line" : 220,
      "node_id" : "PRRC_kwDOABII58455HO-",
      "original_commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "original_line" : 220,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 154,
      "pull_request_review_id" : 1108175113,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971273150/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-14T20:47:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971273150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971650998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971650998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Also having neither a result value nor an error message should be avoided.\r\n\r\nWell, this is already impossible for the reasons you gave. (Edit: When calling only the constructors)\r\n\r\n> Agree having both a result value and an error message should be avoided.\r\n\r\nThen, why not make it impossible? If there is an outer function returning `Result<T, F>` that wants to combine `Result<T1, F1>` and `Result<T2, F2>`, then it seems better if it explicitly takes (moves) the result T1/F1 out and translates it into T/F. For example, if it passes up a failure value, it seems best to just create a fresh Result (of the outer type) with the failure and return that. (Same if it translates failure values). If it ignores failures, it would be good to translate them to warnings first and not blindly take them over as errors with the `>>` operator. (Same if it retries or falls back).\r\n\r\n> I think this this behavior is safe and useful.\r\n\r\nWhy couldn't the same be achieved by explicitly constructing a new Result with either an error or a value?",
      "commit_id" : "776d9b3fbb4cf83c81cc38c44cae10d3f3344b1b",
      "created_at" : "2022-09-15T07:53:38Z",
      "diff_hunk" : "@@ -155,25 +194,48 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n \n-    inline friend bilingual_str _ErrorString(const Result& result)\n+    void AddError(bilingual_str error)\n     {\n-        return result ? bilingual_str{} : result.m_info->error;\n+        if (!error.empty()) this->Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) this->Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from this result object to\n+    //! another one. Only moves message strings, does not change success or\n+    //! failure values of either Result object.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971650998",
      "id" : 971650998,
      "in_reply_to_id" : 970561659,
      "line" : 222,
      "node_id" : "PRRC_kwDOABII58456je2",
      "original_commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "original_line" : 222,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 234,
      "pull_request_review_id" : 1108707029,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971650998/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-15T15:37:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971650998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971748931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971748931"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ">> Also having neither a result value nor an error message should be avoided.\r\n\r\n> Well, this is already impossible for the reasons you gave.\r\n\r\n\"Should be avoided\" means that users should avoid it, and the implementation makes it easy to avoid by default. The reasons I gave were reasons why a function combining multiple result values needs to either (1) allow result values and error messages to exist at the same time or (2) discard error messages or result values or (3) throw exceptions. And I believe the best choice for `operator>>` is (1), just to be a plain message mover that moves message strings and leaves result values alone. I linked to use-cases showing how this works in practice.\r\n\r\n> > Agree having both a result value and an error message should be avoided.\r\n\r\n> Then, why not make it impossible? If there is an outer function returning `Result<T, F>` that wants to combine `Result<T1, F1>` and `Result<T2, F2>`, then it seems better if it explicitly takes (moves) the result T1/F1 out and translates it into T/F. For example, if it passes up a failure value, it seems best to just create a fresh Result (of the outer type) with the failure and return that.\r\n\r\nThis is actually what the implementation does. But if the outer function returns success value, and there are error messages, I don't think it is good default behavior to throw away the error messages or raise an exception. I think the best default behavior is to keep error messages so they can be displayed or logged.\r\n\r\n> (Same if it translates failure values). If it ignores failures, it would be good to translate them to warnings first and not blindly take them over as errors with the `>>` operator. (Same if it retries or falls back).\r\n\r\nSo change you are asking for there is basically:\r\n\r\n```diff\r\n--- a/src/util/result.h\r\n+++ b/src/util/result.h\r\n@@ -222,7 +222,7 @@ public:\r\n     Result&& operator>>(O&& other LIFETIMEBOUND) &&\r\n     {\r\n         if (this->m_info) {\r\n-            if (!this->m_info->errors.empty()) detail::MoveMessages(this->m_info->errors, other.Info().errors);\r\n+            if (!this->m_info->errors.empty()) detail::MoveMessages(this->m_info->errors, other ? other.Info().warnings : other.Info().errors);\r\n             if (!this->m_info->warnings.empty()) detail::MoveMessages(this->m_info->warnings, other.Info().warnings);\r\n         }\r\n         return std::move(*this);\r\n```\r\n\r\nI wouldn't object to it, but it just seems more invasive and doesn't offer practical benefits.\r\n\r\n> > I think this this behavior is safe and useful.\r\n\r\n> Why couldn't the same be achieved by explicitly constructing a new Result with either an error or a value?\r\n\r\nI think\r\n\r\n```c++\r\nWarnFn1() >> result;\r\nWarnFn2() >> result;\r\nresult = FailFn(...);\r\nreturn result;\r\n```\r\n\r\nor\r\n\r\n\r\n```c++\r\nWarnFn1() >> result;\r\nWarnFn2() >> result;\r\nresult.Set(FailFn(...));\r\nreturn result;\r\n``` \r\n\r\nis cleaner than\r\n\r\n```c++\r\nWarnFn1() >> result;\r\nWarnFn2() >> result;\r\nauto result2 = FailFn(...);\r\nstd::move(result) >> result2;\r\nreturn result2;\r\n```\r\n\r\nbecause it doesn't require introducing multiple result variables. If you are trying to get rid of both `operator=` and `operator>>`, I believe `operator=` or `Set` is also better than:\r\n\r\n```c++\r\nauto result2 = FailFn(...);\r\nreturn result2 ? Result<int, FnError>(std::move(result), result2.value()) : Result<int, FnError>(std::move(result), Error{}, resul2t.GetFailure());\r\n```\r\n\r\nI'm happy to rename `operator=` to `Set` if you think `operator=` is misleading. But if you look at the places where these functions are used, it is easier to see why they are useful. Conversely, if you think there is a footgun here, it would be helpful to see an example of the footgun.",
      "commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "created_at" : "2022-09-15T09:24:13Z",
      "diff_hunk" : "@@ -155,25 +194,48 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n \n-    inline friend bilingual_str _ErrorString(const Result& result)\n+    void AddError(bilingual_str error)\n     {\n-        return result ? bilingual_str{} : result.m_info->error;\n+        if (!error.empty()) this->Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) this->Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from this result object to\n+    //! another one. Only moves message strings, does not change success or\n+    //! failure values of either Result object.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971748931",
      "id" : 971748931,
      "in_reply_to_id" : 970561659,
      "line" : 220,
      "node_id" : "PRRC_kwDOABII584567ZD",
      "original_commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "original_line" : 220,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 154,
      "pull_request_review_id" : 1108846917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971748931/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-15T09:24:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971748931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971782272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971782272"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> But if you look at the places where these functions are used, it is easier to see why they are useful.\r\n\r\nI linked to some places where `operator>>` is used already: [`LoadWalletInternal`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/wallet.cpp#L229-L245), [`CreateWallet`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/wallet.cpp#L298-L346), and [`DoMigration`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/wallet.cpp#L3862-L3940) from #25722\r\n\r\nFor `operator=` (again happy to rename this to `Set`) examples are: [`AddressTableModel::addRow`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/qt/addresstablemodel.cpp#L381), [`SQLiteDatabase::Verify`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/sqlite.cpp#L172), [`AvailableCoinsTestingSetup`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/test/availablecoins_tests.cpp#L78-L99), [`FuzzedWallet::GetScriptPubKey`](https://github.com/ryanofsky/bitcoin/blob/4e533926fe5549aafb70caf94718447ea497c84c/src/wallet/test/fuzz/notifications.cpp#L72-L74)",
      "commit_id" : "776d9b3fbb4cf83c81cc38c44cae10d3f3344b1b",
      "created_at" : "2022-09-15T09:54:02Z",
      "diff_hunk" : "@@ -155,25 +194,48 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n \n-    inline friend bilingual_str _ErrorString(const Result& result)\n+    void AddError(bilingual_str error)\n     {\n-        return result ? bilingual_str{} : result.m_info->error;\n+        if (!error.empty()) this->Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) this->Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from this result object to\n+    //! another one. Only moves message strings, does not change success or\n+    //! failure values of either Result object.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r971782272",
      "id" : 971782272,
      "in_reply_to_id" : 970561659,
      "line" : 222,
      "node_id" : "PRRC_kwDOABII58457DiA",
      "original_commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "original_line" : 222,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 234,
      "pull_request_review_id" : 1108893852,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971782272/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-15T15:26:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971782272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r972138482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/972138482"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Went ahead and renamed `operator=` to `Set` for now. Seems like a good way to avoid some confusion.",
      "commit_id" : "776d9b3fbb4cf83c81cc38c44cae10d3f3344b1b",
      "created_at" : "2022-09-15T15:30:36Z",
      "diff_hunk" : "@@ -155,25 +194,48 @@ class Result : public detail::ResultBase<T, F>\n     template <typename... Args>\n     Result(Args&&... args)\n     {\n-        Construct(std::forward<Args>(args)...);\n+        Construct([this](auto&&... x) { this->ConstructValue(std::forward<decltype(x)>(x)...); }, std::forward<Args>(args)...);\n     }\n     template<typename OT, typename OF>\n     Result(Result<OT, OF>&& other) { MoveConstruct(other); }\n     Result& operator=(Result&& other) LIFETIMEBOUND\n     {\n-        if (*this) this->DestroyValue(); else this->m_info.reset();\n+        if (*this) this->DestroyValue(); else this->m_info->failure.reset();\n         MoveConstruct(other);\n         return *this;\n     }\n \n-    inline friend bilingual_str _ErrorString(const Result& result)\n+    void AddError(bilingual_str error)\n     {\n-        return result ? bilingual_str{} : result.m_info->error;\n+        if (!error.empty()) this->Info().errors.emplace_back(std::move(error));\n+    }\n+\n+    void AddWarning(bilingual_str warning)\n+    {\n+        if (!warning.empty()) this->Info().warnings.emplace_back(std::move(warning));\n+    }\n+\n+    //! Operator moving warning and error messages from this result object to\n+    //! another one. Only moves message strings, does not change success or\n+    //! failure values of either Result object.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r972138482",
      "id" : 972138482,
      "in_reply_to_id" : 970561659,
      "line" : 222,
      "node_id" : "PRRC_kwDOABII58458afy",
      "original_commit_id" : "52a4e50fb4b1171ee0f6814b0a50bc70cdd77134",
      "original_line" : 222,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 234,
      "pull_request_review_id" : 1109415289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/972138482/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-15T15:31:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/972138482",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-09-16T10:15:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1249188037",
      "id" : 1249188037,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585KdRjF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249188037/reactions"
      },
      "updated_at" : "2022-09-16T10:15:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249188037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-01-03T18:09:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1370076925",
      "id" : 1370076925,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585Rqbb9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1370076925/reactions"
      },
      "updated_at" : "2023-01-03T18:09:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1370076925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2023-02-12T14:54:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1427053301",
      "id" : 1427053301,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585VDxr1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1427053301/reactions"
      },
      "updated_at" : "2023-02-12T14:54:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1427053301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It seems the 7cdb7d1e9573ae60e7335af5d3de99191ad68b3f commit adds `src/wallet/test/availablecoins_tests.cpp` by accident, doesn't it?",
      "created_at" : "2023-02-12T15:27:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1427060487",
      "id" : 1427060487,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585VDzcH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1427060487/reactions"
      },
      "updated_at" : "2023-02-12T15:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1427060487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1104282294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104282294"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Allowing for a `void` failure type seems to make this incompatible to be switched out to `std::expected` https://en.cppreference.com/w/cpp/utility/expected ?\r\n\r\nWith multiple warning and error messages this may already be incompatible, though?",
      "commit_id" : "eb50fcd6859d1730663159995e8477f6d892e7f4",
      "created_at" : "2023-02-13T10:42:23Z",
      "diff_hunk" : "@@ -31,54 +140,110 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+//!\n+//! Most code does not need different error-handling behavior for different\n+//! types of errors, and can suffice just using the type `T` success value on\n+//! success, and descriptive error strings when there's a failure. But\n+//! applications that do need more complicated error-handling behavior can\n+//! override the default `F = void` failure type and get failure values by",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1104282294",
      "id" : 1104282294,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII585B0gK2",
      "original_commit_id" : "eb50fcd6859d1730663159995e8477f6d892e7f4",
      "original_line" : 148,
      "original_position" : 140,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 140,
      "pull_request_review_id" : 1295372964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104282294/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T10:42:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104282294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1104628124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104628124"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1104282294\r\n\r\n> Allowing for a `void` failure type seems to make this incompatible to be switched out to `std::expected` https://en.cppreference.com/w/cpp/utility/expected ?\r\n> \r\n> With multiple warning and error messages this may already be incompatible, though?\r\n\r\nYes, if you are thinking that `util::Result` could wrap `std::expected`, that would be probably be awkward and not worth it.\r\n\r\nBut I don't think there is a conflict because the two classes are mostly doing different things. The `util::Result` class is mostly providing error-reporting functionality (passing error and warning strings up to the user). The `std::expected` class is only providing error-handling functionality (passing failure and success values between functions). Here is how I would choose the between the two classes:\r\n\r\n- If your function never fails, it should just return success value directly.\r\n- If your function can fail, but doesn't provide any error strings or specific failure information, it should return `std::optional`.\r\n- If your function can fail, and provides failure information but not error strings, it should return `std::expected`.\r\n- If your function can fail, and generates error or warning strings it should return `util::Result`.\r\n\r\nWe have a lot of functions that generate error strings as you can see by all the code using `util::Error` and `util::Result` presently, and in more code that is converted to use `util::Result` in this PR and #25722. After `std::expected` is available, most of these functions still be better off using `util::Result` instead of `std::expected` so they are able to pass back error strings in a uniform way.\r\n\r\nBut when `std::expected` is available, we may want to tweak the `util::Result` class to make it easier to switch between `std::expected` and `util::Result` with minimal code changes. For example, the `util::Result` already has a `value_or` method to be compatible with `std::optional`. It could also have `and_then` and `or_else` methods to be compatible with `std::expected`.",
      "commit_id" : "28a954c7034077ac3a45083dd5e2b5cdb4d4cdde",
      "created_at" : "2023-02-13T15:27:49Z",
      "diff_hunk" : "@@ -31,54 +140,110 @@ struct Error {\n //! `std::optional<T>` can be updated to return `util::Result<T>` and return\n //! error strings usually just replacing `return std::nullopt;` with `return\n //! util::Error{error_string};`.\n-template <class T>\n-class Result\n+//!\n+//! Most code does not need different error-handling behavior for different\n+//! types of errors, and can suffice just using the type `T` success value on\n+//! success, and descriptive error strings when there's a failure. But\n+//! applications that do need more complicated error-handling behavior can\n+//! override the default `F = void` failure type and get failure values by",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1104628124",
      "id" : 1104628124,
      "in_reply_to_id" : 1104282294,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII585B10mc",
      "original_commit_id" : "eb50fcd6859d1730663159995e8477f6d892e7f4",
      "original_line" : 148,
      "original_position" : 140,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 140,
      "pull_request_review_id" : 1295884713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104628124/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-02-13T15:28:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104628124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#pullrequestreview-1294756069\r\n\r\nThanks for the review! I got rid of the unused test file and changed the `if` formatting as suggested\r\n\r\n---\r\n\r\nUpdated eb50fcd6859d1730663159995e8477f6d892e7f4 -> 501ef88b9412b0d924abf32cf2de7fbcbbb69b8d ([`pr/bresult2.28`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.28) -> [`pr/bresult2.29`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.29), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.28..pr/bresult2.29)) with suggested changes",
      "created_at" : "2023-02-16T18:54:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1433568160",
      "id" : 1433568160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585VcoOg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1433568160/reactions"
      },
      "updated_at" : "2023-02-16T18:54:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1433568160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review.\r\n\r\nNote: @martinus left several review comments on https://github.com/bitcoin/bitcoin/pull/25722#pullrequestreview-1386736519, which is based on this PR, which apply to this PR and can improve it a little. I'm planning to update this PR to incorporate the suggestions.",
      "created_at" : "2023-05-11T17:30:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1544405658",
      "id" : 1544405658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585cDcKa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1544405658/reactions"
      },
      "updated_at" : "2023-05-11T17:30:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1544405658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-26T13:32:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1564403355",
      "id" : 1564403355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585dPuab",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564403355/reactions"
      },
      "updated_at" : "2023-05-26T13:32:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564403355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`void` can be removed from OP?",
      "created_at" : "2023-05-26T13:35:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1564406303",
      "id" : 1564406303,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585dPvIf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564406303/reactions"
      },
      "updated_at" : "2023-05-26T13:35:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564406303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1234264247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1234264247"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you add an example for when the Result error type in a chain of function calls remains the same, but the value type changes? Is there a better way to do this conversion than manually constructing the result again (like below)?\r\n\r\n```suggestion\r\nutil::Result<std::string, FnError> CastFailFn() {\r\n    auto res = IntFailFn(1, false);\r\n    return {util::Error{ErrorString(res)}, res.GetFailure()};\r\n}\r\n```\r\n\r\n",
      "commit_id" : "28a954c7034077ac3a45083dd5e2b5cdb4d4cdde",
      "created_at" : "2023-06-19T16:28:24Z",
      "diff_hunk" : "@@ -45,42 +74,122 @@ util::Result<bilingual_str> StrFn(bilingual_str s, bool success)\n     return util::Error{strprintf(Untranslated(\"str %s error.\"), s.original)};\n }\n \n-util::Result<NoCopy> NoCopyFn(int i, bool success)\n+util::Result<NoCopy, NoCopy> NoCopyFn(int i, bool success)\n {\n     if (success) return {i};\n-    return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n+    return {util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))}, i};\n }\n \n-template <typename T>\n-void ExpectResult(const util::Result<T>& result, bool success, const bilingual_str& str)\n+util::Result<NoCopyNoMove, NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return {util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))}, i};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<NoCopyNoMove, FnError> EnumFailFn(FnError ret)\n+{\n+    return {util::Error{Untranslated(\"enum fail.\")}, ret};\n+}\n+\n+util::Result<void> WarnFn()\n+{\n+    return {util::Warning{Untranslated(\"warn.\")}};\n+}\n+\n+util::Result<int> MultiWarnFn(int ret)\n+{\n+    util::Result<void> result;\n+    for (int i = 0; i < ret; ++i) {\n+        result.AddWarning(strprintf(Untranslated(\"warn %i.\"), i));\n+    }\n+    return {std::move(result), ret};\n+}\n+\n+util::Result<void, int> ChainedFailFn(FnError arg, int ret)\n+{\n+    return {util::Error{Untranslated(\"chained fail.\")}, EnumFailFn(arg), WarnFn(), ret};\n+}\n+\n+util::Result<int, FnError> AccumulateFn(bool success)\n+{\n+    util::Result<int, FnError> result;\n+    util::Result<int> x = MultiWarnFn(1) >> result;\n+    BOOST_REQUIRE(x);\n+    util::Result<int> y = MultiWarnFn(2) >> result;\n+    BOOST_REQUIRE(y);\n+    result.Set(IntFailFn(*x + *y, success));\n+    return result;\n+}\n+\n+util::Result<int, int> TruthyFalsyFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"failure value %i.\", i))}, i};\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1234264247",
      "id" : 1234264247,
      "line" : 137,
      "node_id" : "PRRC_kwDOABII585JkWC3",
      "original_commit_id" : "28a954c7034077ac3a45083dd5e2b5cdb4d4cdde",
      "original_line" : 137,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : 111,
      "pull_request_review_id" : 1486552709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1234264247/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-19T16:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1234264247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1270866000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270866000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1234264247\r\n\r\n> Can you add an example for when the Result error type in a chain of function calls remains the same, but the value type changes? Is there a better way to do this conversion than manually constructing the result again (like below)?\r\n\r\nYes, there is definitely a better way to pass along errors and warnings from one result to another without calling `ErrorString` and flattening them. The `util::Result` constructor will move errors and warnings directly from an existing result object if you just pass the other result object as an argument with `std::move`. If you look at the `MultiWarnFn` there was an example of this feature in the success case. But I added a new `StrFailFn` function now based on your code that demonstrates it in both the success and failure cases.\r\n\r\nI am also thinking of adding a `util::Messages{Result&&}` helper similar to existing `util::Error{std::string}` and `util::Warning{std::string}` helpers to make it more obvious how you can construct a Result value with errors and warning from different sources.\r\n\r\nRevisiting this makes me realize I should probably add a tutorial-style document that describes how to use the Result class with standalone functions that return util::Result, chained functions that return util::Result values of the same type, and chained functions that return util::Result values of different types.",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-21T16:25:52Z",
      "diff_hunk" : "@@ -45,42 +74,122 @@ util::Result<bilingual_str> StrFn(bilingual_str s, bool success)\n     return util::Error{strprintf(Untranslated(\"str %s error.\"), s.original)};\n }\n \n-util::Result<NoCopy> NoCopyFn(int i, bool success)\n+util::Result<NoCopy, NoCopy> NoCopyFn(int i, bool success)\n {\n     if (success) return {i};\n-    return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n+    return {util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))}, i};\n }\n \n-template <typename T>\n-void ExpectResult(const util::Result<T>& result, bool success, const bilingual_str& str)\n+util::Result<NoCopyNoMove, NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return {util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))}, i};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<NoCopyNoMove, FnError> EnumFailFn(FnError ret)\n+{\n+    return {util::Error{Untranslated(\"enum fail.\")}, ret};\n+}\n+\n+util::Result<void> WarnFn()\n+{\n+    return {util::Warning{Untranslated(\"warn.\")}};\n+}\n+\n+util::Result<int> MultiWarnFn(int ret)\n+{\n+    util::Result<void> result;\n+    for (int i = 0; i < ret; ++i) {\n+        result.AddWarning(strprintf(Untranslated(\"warn %i.\"), i));\n+    }\n+    return {std::move(result), ret};\n+}\n+\n+util::Result<void, int> ChainedFailFn(FnError arg, int ret)\n+{\n+    return {util::Error{Untranslated(\"chained fail.\")}, EnumFailFn(arg), WarnFn(), ret};\n+}\n+\n+util::Result<int, FnError> AccumulateFn(bool success)\n+{\n+    util::Result<int, FnError> result;\n+    util::Result<int> x = MultiWarnFn(1) >> result;\n+    BOOST_REQUIRE(x);\n+    util::Result<int> y = MultiWarnFn(2) >> result;\n+    BOOST_REQUIRE(y);\n+    result.Set(IntFailFn(*x + *y, success));\n+    return result;\n+}\n+\n+util::Result<int, int> TruthyFalsyFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"failure value %i.\", i))}, i};\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1270866000",
      "id" : 1270866000,
      "in_reply_to_id" : 1234264247,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII585Lv-BQ",
      "original_commit_id" : "28a954c7034077ac3a45083dd5e2b5cdb4d4cdde",
      "original_line" : 144,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : 116,
      "pull_request_review_id" : 1541470201,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270866000/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T16:47:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270866000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1270993538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270993538"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "f1b46f4017a \r\n```\r\ninit.cpp:948:12: error: 'operator=' is a private member of 'util::Result<void>'\r\n    result = init::SetLoggingLevel(args);\r\n    ~~~~~~ ^ ~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n./util/result.h:47:13: note: declared private here\r\n    Result& operator=(Result&&) = default;\r\n            ^\r\n```\r\n",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-21T19:02:25Z",
      "diff_hunk" : "@@ -39,13 +39,23 @@ class Result\n \n     std::variant<bilingual_str, T> m_variant;\n \n+    //! Make operator= private and instead require explicit Set() calls to\n+    //! avoid confusion in the future when the Result class gains support for\n+    //! richer errors and callers want to set result values without erasing\n+    //! error strings.\n+    Result& operator=(const Result&) = default;\n+    Result& operator=(Result&&) = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1270993538",
      "id" : 1270993538,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LwdKC",
      "original_commit_id" : "f1b46f4017a52093a4ae41656b953ab3c1b7403d",
      "original_line" : 47,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1541681112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270993538/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T19:02:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270993538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271000370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271000370"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "40f09de73e6 `lint-locale-dependence.py`\r\n\r\n```\r\nThe locale dependent function std::to_string(...) appears to be used:\r\nsrc/test/result_tests.cpp:101:    return {std::move(result), std::to_string(*result)};\r\n```\r\n",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-21T19:10:47Z",
      "diff_hunk" : "@@ -45,42 +74,131 @@ util::Result<bilingual_str> StrFn(bilingual_str s, bool success)\n     return util::Error{strprintf(Untranslated(\"str %s error.\"), s.original)};\n }\n \n-util::Result<NoCopy> NoCopyFn(int i, bool success)\n+util::Result<NoCopy, NoCopy> NoCopyFn(int i, bool success)\n {\n     if (success) return {i};\n-    return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n+    return {util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))}, i};\n+}\n+\n+util::Result<NoCopyNoMove, NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return {util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))}, i};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return {util::Warning{Untranslated(strprintf(\"int %i warn.\", i))}, i};\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<std::string, FnError> StrFailFn(int i, bool success)\n+{\n+    auto result = IntFailFn(i, success);\n+    if (!success) return {std::move(result), util::Error{Untranslated(\"str error\")}, result.GetFailure()};\n+    return {std::move(result), std::to_string(*result)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271000370",
      "id" : 1271000370,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Lwe0y",
      "original_commit_id" : "40f09de73e61e7ae62d6639a49b7c7ac48d514d9",
      "original_line" : 101,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1541700045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271000370/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T19:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271000370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271033872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271033872"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271000370\r\n\r\nThanks, this should be fixed now",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-21T19:52:07Z",
      "diff_hunk" : "@@ -45,42 +74,131 @@ util::Result<bilingual_str> StrFn(bilingual_str s, bool success)\n     return util::Error{strprintf(Untranslated(\"str %s error.\"), s.original)};\n }\n \n-util::Result<NoCopy> NoCopyFn(int i, bool success)\n+util::Result<NoCopy, NoCopy> NoCopyFn(int i, bool success)\n {\n     if (success) return {i};\n-    return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n+    return {util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))}, i};\n+}\n+\n+util::Result<NoCopyNoMove, NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return {util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))}, i};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return {util::Warning{Untranslated(strprintf(\"int %i warn.\", i))}, i};\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<std::string, FnError> StrFailFn(int i, bool success)\n+{\n+    auto result = IntFailFn(i, success);\n+    if (!success) return {std::move(result), util::Error{Untranslated(\"str error\")}, result.GetFailure()};\n+    return {std::move(result), std::to_string(*result)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271033872",
      "id" : 1271033872,
      "in_reply_to_id" : 1271000370,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LwnAQ",
      "original_commit_id" : "40f09de73e61e7ae62d6639a49b7c7ac48d514d9",
      "original_line" : 101,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1541767699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271033872/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T20:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271033872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271034517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271034517"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1270993538\r\n\r\nThanks for testing the early commit, should be fixed now",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-21T19:52:42Z",
      "diff_hunk" : "@@ -39,13 +39,23 @@ class Result\n \n     std::variant<bilingual_str, T> m_variant;\n \n+    //! Make operator= private and instead require explicit Set() calls to\n+    //! avoid confusion in the future when the Result class gains support for\n+    //! richer errors and callers want to set result values without erasing\n+    //! error strings.\n+    Result& operator=(const Result&) = default;\n+    Result& operator=(Result&&) = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271034517",
      "id" : 1271034517,
      "in_reply_to_id" : 1270993538,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LwnKV",
      "original_commit_id" : "f1b46f4017a52093a4ae41656b953ab3c1b7403d",
      "original_line" : 47,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : null,
      "pull_request_review_id" : 1541767699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271034517/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T20:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271034517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271094067"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271094067"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "332e847c9ec tuple not needed per iwyu in tidy ci https://cirrus-ci.com/task/6540065057275904?logs=ci#L20325, while touching could add the others\r\n\r\n```diff\r\n+#include <assert.h>\r\n #include <memory>\r\n #include <optional>\r\n-#include <tuple>\r\n #include <utility>\r\n #include <vector>\r\n+#include <new>\r\n+#include <type_traits>\r\n```\r\n",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-21T20:43:20Z",
      "diff_hunk" : "@@ -8,16 +8,125 @@\n #include <attributes.h>\n #include <util/translation.h>\n \n-#include <variant>\n+#include <memory>\n+#include <optional>\n+#include <tuple>\n+#include <utility>\n+#include <vector>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271094067",
      "id" : 1271094067,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII585Lw1sz",
      "original_commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "original_line" : 15,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/util/result.h",
      "position" : 9,
      "pull_request_review_id" : 1541828147,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271094067/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T21:20:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271094067",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271096350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271096350"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/332e847c9ec0241efd9681eee3b03ff819aaddc3 per iwyu in https://cirrus-ci.com/task/6540065057275904?logs=ci#L20305\r\n\r\n```diff\r\n #include <util/result.h>\r\n-#include <util/string.h>\r\n+#include \"util/translation.h\"\r\n+\r\n+#include <algorithm>\r\n+#include <initializer_list>\r\n+#include <iterator>\r\n```\r\n",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-21T20:45:45Z",
      "diff_hunk" : "@@ -0,0 +1,28 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/result.h>\n+#include <util/string.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271096350",
      "id" : 1271096350,
      "line" : 6,
      "node_id" : "PRRC_kwDOABII585Lw2Qe",
      "original_commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/util/result.cpp",
      "position" : 6,
      "pull_request_review_id" : 1541828147,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271096350/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T21:20:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271096350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271547869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271547869"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I should probably add a tutorial-style document that describes how to use the Result class with standalone functions that return util::Result, chained functions that return util::Result values of the same type, and chained functions that return util::Result values of different types.\r\n\r\nI think this would be valuable, either in `util/result.h` directly or in `doc/developer-notes.md` or another file in `/doc`.",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-23T19:32:16Z",
      "diff_hunk" : "@@ -45,42 +74,122 @@ util::Result<bilingual_str> StrFn(bilingual_str s, bool success)\n     return util::Error{strprintf(Untranslated(\"str %s error.\"), s.original)};\n }\n \n-util::Result<NoCopy> NoCopyFn(int i, bool success)\n+util::Result<NoCopy, NoCopy> NoCopyFn(int i, bool success)\n {\n     if (success) return {i};\n-    return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n+    return {util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))}, i};\n }\n \n-template <typename T>\n-void ExpectResult(const util::Result<T>& result, bool success, const bilingual_str& str)\n+util::Result<NoCopyNoMove, NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return {util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))}, i};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<NoCopyNoMove, FnError> EnumFailFn(FnError ret)\n+{\n+    return {util::Error{Untranslated(\"enum fail.\")}, ret};\n+}\n+\n+util::Result<void> WarnFn()\n+{\n+    return {util::Warning{Untranslated(\"warn.\")}};\n+}\n+\n+util::Result<int> MultiWarnFn(int ret)\n+{\n+    util::Result<void> result;\n+    for (int i = 0; i < ret; ++i) {\n+        result.AddWarning(strprintf(Untranslated(\"warn %i.\"), i));\n+    }\n+    return {std::move(result), ret};\n+}\n+\n+util::Result<void, int> ChainedFailFn(FnError arg, int ret)\n+{\n+    return {util::Error{Untranslated(\"chained fail.\")}, EnumFailFn(arg), WarnFn(), ret};\n+}\n+\n+util::Result<int, FnError> AccumulateFn(bool success)\n+{\n+    util::Result<int, FnError> result;\n+    util::Result<int> x = MultiWarnFn(1) >> result;\n+    BOOST_REQUIRE(x);\n+    util::Result<int> y = MultiWarnFn(2) >> result;\n+    BOOST_REQUIRE(y);\n+    result.Set(IntFailFn(*x + *y, success));\n+    return result;\n+}\n+\n+util::Result<int, int> TruthyFalsyFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"failure value %i.\", i))}, i};\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1271547869",
      "id" : 1271547869,
      "in_reply_to_id" : 1234264247,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII585Lykfd",
      "original_commit_id" : "28a954c7034077ac3a45083dd5e2b5cdb4d4cdde",
      "original_line" : 144,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : 116,
      "pull_request_review_id" : 1542385864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271547869/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-23T19:33:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271547869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1276382028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276382028"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I am also thinking of adding a util::Messages{Result&&} helper.\r\n\r\nThat sounds like a worthwhile improvement of the ergonomics here. \r\n",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-27T14:33:47Z",
      "diff_hunk" : "@@ -45,42 +74,122 @@ util::Result<bilingual_str> StrFn(bilingual_str s, bool success)\n     return util::Error{strprintf(Untranslated(\"str %s error.\"), s.original)};\n }\n \n-util::Result<NoCopy> NoCopyFn(int i, bool success)\n+util::Result<NoCopy, NoCopy> NoCopyFn(int i, bool success)\n {\n     if (success) return {i};\n-    return util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))};\n+    return {util::Error{Untranslated(strprintf(\"nocopy %i error.\", i))}, i};\n }\n \n-template <typename T>\n-void ExpectResult(const util::Result<T>& result, bool success, const bilingual_str& str)\n+util::Result<NoCopyNoMove, NoCopyNoMove> NoCopyNoMoveFn(int i, bool success)\n+{\n+    if (success) return {i};\n+    return {util::Error{Untranslated(strprintf(\"nocopynomove %i error.\", i))}, i};\n+}\n+\n+enum FnError { ERR1, ERR2 };\n+\n+util::Result<int, FnError> IntFailFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n+}\n+\n+util::Result<NoCopyNoMove, FnError> EnumFailFn(FnError ret)\n+{\n+    return {util::Error{Untranslated(\"enum fail.\")}, ret};\n+}\n+\n+util::Result<void> WarnFn()\n+{\n+    return {util::Warning{Untranslated(\"warn.\")}};\n+}\n+\n+util::Result<int> MultiWarnFn(int ret)\n+{\n+    util::Result<void> result;\n+    for (int i = 0; i < ret; ++i) {\n+        result.AddWarning(strprintf(Untranslated(\"warn %i.\"), i));\n+    }\n+    return {std::move(result), ret};\n+}\n+\n+util::Result<void, int> ChainedFailFn(FnError arg, int ret)\n+{\n+    return {util::Error{Untranslated(\"chained fail.\")}, EnumFailFn(arg), WarnFn(), ret};\n+}\n+\n+util::Result<int, FnError> AccumulateFn(bool success)\n+{\n+    util::Result<int, FnError> result;\n+    util::Result<int> x = MultiWarnFn(1) >> result;\n+    BOOST_REQUIRE(x);\n+    util::Result<int> y = MultiWarnFn(2) >> result;\n+    BOOST_REQUIRE(y);\n+    result.Set(IntFailFn(*x + *y, success));\n+    return result;\n+}\n+\n+util::Result<int, int> TruthyFalsyFn(int i, bool success)\n+{\n+    if (success) return i;\n+    return {util::Error{Untranslated(strprintf(\"failure value %i.\", i))}, i};\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1276382028",
      "id" : 1276382028,
      "in_reply_to_id" : 1234264247,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII585MFAtM",
      "original_commit_id" : "28a954c7034077ac3a45083dd5e2b5cdb4d4cdde",
      "original_line" : 144,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : 116,
      "pull_request_review_id" : 1550016002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276382028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T14:57:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276382028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1276417417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276417417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It strikes me as unfortunate that the move constructor cannot not move the failure values across different result value types, meaning the failure needs to be passed in as a separate argument. At the same time the user would be allowed to return a `{std::move(result), util::Error{Untranslated(\"str error\")}`, potentially (and I am still not quite sure if that is what is actually happening here) without the user noticing that this will not move the failure value and instead initialize a `Monostate` failure. ",
      "commit_id" : "775b54e88107b0b976bf995e607926013fa9bc42",
      "created_at" : "2023-07-27T14:57:25Z",
      "diff_hunk" : "@@ -90,15 +90,52 @@ enum FnError { ERR1, ERR2 };\n \n util::Result<int, FnError> IntFailFn(int i, bool success)\n {\n-    if (success) return i;\n+    if (success) return {util::Warning{Untranslated(strprintf(\"int %i warn.\", i))}, i};\n     return {util::Error{Untranslated(strprintf(\"int %i error.\", i))}, i % 2 ? ERR1 : ERR2};\n }\n \n+util::Result<std::string, FnError> StrFailFn(int i, bool success)\n+{\n+    auto result = IntFailFn(i, success);\n+    if (!success) return {std::move(result), util::Error{Untranslated(\"str error\")}, result.GetFailure()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#discussion_r1276417417",
      "id" : 1276417417,
      "line" : 100,
      "node_id" : "PRRC_kwDOABII585MFJWJ",
      "original_commit_id" : "4d995d3fa66fbc3eb87c6627e5ba1b2a809402a4",
      "original_line" : 100,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/result_tests.cpp",
      "position" : 72,
      "pull_request_review_id" : 1550016002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276417417/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T14:57:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276417417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated 1de05ef9190202f04f8cbe7746a47cbd66ab540c -> 08f5febfc571220043436bbec96a326beebdee22 ([`pr/bresult2.36`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.36) -> [`pr/bresult2.37`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.37), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.36..pr/bresult2.37)) replacing `util::Messages` with `util::MoveMessages` to work around clang-tidy error `bugprone-use-after-move` (https://cirrus-ci.com/task/6657022251237376?logs=ci#L3119). This makes usage less verbose in most cases, too.\r\n\r\n",
      "created_at" : "2023-08-01T22:37:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1661192251",
      "id" : 1661192251,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585jA8g7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661192251/reactions"
      },
      "updated_at" : "2023-08-01T22:37:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661192251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated b0beb4c504da29c27358d4602a045aaab39305f6 -> 9e80d0b754a28733c79a52c8e0431616c31d071c ([`pr/bresult2.38`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.38) -> [`pr/bresult2.39`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.39), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.38..pr/bresult2.39)) to fix `operator>>` compile error that seemed to happen with newer versions of clang: https://cirrus-ci.com/task/4622529512341504?logs=ci#L2370",
      "created_at" : "2023-08-04T11:26:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1665456319",
      "id" : 1665456319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585jRNi_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1665456319/reactions"
      },
      "updated_at" : "2023-08-04T11:26:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1665456319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 7f883b33bb89205a9d00c2d20d363a36a0167c7c\r\n",
      "created_at" : "2023-08-07T18:39:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1668402066",
      "id" : 1668402066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585jccuS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1668402066/reactions"
      },
      "updated_at" : "2023-08-07T18:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1668402066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 7f883b33bb89205a9d00c2d20d363a36a0167c7c",
      "created_at" : "2023-08-29T18:51:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1697964137",
      "id" : 1697964137,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585lNOBp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1697964137/reactions"
      },
      "updated_at" : "2023-08-29T18:51:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1697964137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Silent merge conflict:\r\n\r\n```\r\nIn file included from ../../../src/wallet/coinselection.h:16,\r\n                 from ../../../src/wallet/test/fuzz/coinselection.cpp:12:\r\n../../../src/util/result.h: In instantiation of âvoid util::detail::ResultBase<T, F>::ConstructValue(Args&& ...) [with Args = {util::Result<wallet::SelectionResult, void>&}; T = wallet::SelectionResult; F = void]â:\r\n../../../src/util/result.h:141:34:   required from âstatic void util::detail::ResultBase<void, F>::ConstructResult(Result&, Args&& ...) [with bool Failure = false; Result = util::Result<wallet::SelectionResult>; Args = {util::Result<wallet::SelectionResult, void>&}; F = void]â\r\n../../../src/util/result.h:295:58:   required from âutil::Result<T, F>::Result(Args&& ...) [with Args = {util::Result<wallet::SelectionResult, void>&}; T = wallet::SelectionResult; F = void]â\r\n../../../src/wallet/test/fuzz/coinselection.cpp:152:95:   required from here\r\n../../../src/util/result.h:243:43: error: no matching function for call to âwallet::SelectionResult::SelectionResult(<brace-enclosed initializer list>)â\r\n  243 |     void ConstructValue(Args&&... args) { new (&m_value) T{std::forward<Args>(args)...}; }\r\n      |                                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n../../../src/wallet/coinselection.h:352:14: note: candidate: âwallet::SelectionResult::SelectionResult(CAmount, wallet::SelectionAlgorithm)â\r\n  352 |     explicit SelectionResult(const CAmount target, SelectionAlgorithm algo)\r\n      |              ^~~~~~~~~~~~~~~\r\n../../../src/wallet/coinselection.h:352:14: note:   candidate expects 2 arguments, 1 provided\r\n../../../src/wallet/coinselection.h:324:8: note: candidate: âwallet::SelectionResult::SelectionResult(const wallet::SelectionResult&)â\r\n  324 | struct SelectionResult\r\n      |        ^~~~~~~~~~~~~~~\r\n../../../src/wallet/coinselection.h:324:8: note:   no known conversion for argument 1 from âutil::Result<wallet::SelectionResult>â to âconst wallet::SelectionResult&â\r\n../../../src/wallet/coinselection.h:324:8: note: candidate: âwallet::SelectionResult::SelectionResult(wallet::SelectionResult&&)â\r\n../../../src/wallet/coinselection.h:324:8: note:   no known conversion for argument 1 from âutil::Result<wallet::SelectionResult>â to âwallet::SelectionResult&&â\r\nIn file included from /usr/include/c++/13.2.1/memory:69,\r\n                 from ../../../src/serialize.h:17,\r\n                 from ../../../src/policy/feerate.h:10,\r\n                 from ../../../src/wallet/test/fuzz/coinselection.cpp:5:\r\n/usr/include/c++/13.2.1/bits/stl_uninitialized.h: In instantiation of âconstexpr bool std::__check_constructible() [with _ValueType = util::Result<wallet::SelectionResult>; _Tp = const util::Result<wallet::SelectionResult>&]â:\r\n/usr/include/c++/13.2.1/bits/stl_uninitialized.h:182:4:   required from â_ForwardIterator std::uninitialized_copy(_InputIterator, _InputIterator, _ForwardIterator) [with _InputIterator = const util::Result<wallet::SelectionResult>*; _ForwardIterator = util::Result<wallet::SelectionResult>*]â\r\n/usr/include/c++/13.2.1/bits/stl_uninitialized.h:373:37:   required from â_ForwardIterator std::__uninitialized_copy_a(_InputIterator, _InputIterator, _ForwardIterator, allocator<_Tp>&) [with _InputIterator = const util::Result<wallet::SelectionResult>*; _ForwardIterator = util::Result<wallet::SelectionResult>*; _Tp = util::Result<wallet::SelectionResult>]â\r\n/usr/include/c++/13.2.1/bits/stl_vector.h:1692:33:   required from âvoid std::vector<_Tp, _Alloc>::_M_range_initialize(_ForwardIterator, _ForwardIterator, std::forward_iterator_tag) [with _ForwardIterator = const util::Result<wallet::SelectionResult>*; _Tp = util::Result<wallet::SelectionResult>; _Alloc = std::allocator<util::Result<wallet::SelectionResult> >]â\r\n/usr/include/c++/13.2.1/bits/stl_vector.h:679:21:   required from âstd::vector<_Tp, _Alloc>::vector(std::initializer_list<_Tp>, const allocator_type&) [with _Tp = util::Result<wallet::SelectionResult>; _Alloc = std::allocator<util::Result<wallet::SelectionResult> >; allocator_type = std::allocator<util::Result<wallet::SelectionResult> >]â\r\n../../../src/wallet/test/fuzz/coinselection.cpp:152:95:   required from here\r\n/usr/include/c++/13.2.1/bits/stl_uninitialized.h:90:56: error: static assertion failed: result type must be constructible from input type\r\n   90 |       static_assert(is_constructible<_ValueType, _Tp>::value,\r\n      |                                                        ^~~~~\r\n/usr/include/c++/13.2.1/bits/stl_uninitialized.h:90:56: note: âstd::integral_constant<bool, false>::valueâ evaluates to false\r\nmake[2]: *** [Makefile:16569: wallet/test/fuzz/test_fuzz_fuzz-coinselection.o] Error 1\r\n```",
      "created_at" : "2023-08-29T18:54:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1697967937",
      "id" : 1697967937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585lNO9B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1697967937/reactions"
      },
      "updated_at" : "2023-08-29T18:54:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1697967937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice, Re-ACK 956bec1ecadcfef13e16f1364ae3a7043ff50e48",
      "created_at" : "2023-09-06T19:19:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1708956145",
      "id" : 1708956145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585l3Jnx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1708956145/reactions"
      },
      "updated_at" : "2023-09-06T19:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1708956145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase if still relevant",
      "created_at" : "2023-10-14T16:20:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1763031649",
      "id" : 1763031649,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585pFbph",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1763031649/reactions"
      },
      "updated_at" : "2023-10-14T16:20:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1763031649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased 956bec1ecadcfef13e16f1364ae3a7043ff50e48 -> 29f6cfdabecbdecafc52ccc86425a1c7bb7f5c40 ([`pr/bresult2.41`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.41) -> [`pr/bresult2.42`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.42), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.41-rebase..pr/bresult2.42)) due to silent conflict with #27596\r\n",
      "created_at" : "2023-10-18T19:27:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1769184976",
      "id" : 1769184976,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585pc57Q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1769184976/reactions"
      },
      "updated_at" : "2023-10-18T19:27:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1769184976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Did you compile each commit locally and ran the tests? See CI:\r\n\r\n```\r\ntest/result_tests.cpp(112): error: in \"result_tests/check_set\": check util::ErrorString(result) == str has failed [bilingual_str('' , '') != bilingual_str('error' , 'error')]",
      "created_at" : "2023-10-25T09:11:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1778841023",
      "id" : 1778841023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585qBvW_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1778841023/reactions"
      },
      "updated_at" : "2023-10-25T09:11:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1778841023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1778841023\r\n> Did you compile each commit locally and ran the tests?\r\n\r\nThanks, I didn't realize the test was broken in earlier commits. I backported it further and got it working in all commits with no changes to the final diff.\r\n\r\nUpdated 29f6cfdabecbdecafc52ccc86425a1c7bb7f5c40 -> f158686962e1a229d0382c739b78cd9644aa7ada ([`pr/bresult2.42`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.42) -> [`pr/bresult2.43`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.43), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.42..pr/bresult2.43)) fixing test failure in intermediate commit 96667abecbd9c0e185fb4914897cc6ec07b39d9c (https://github.com/bitcoin/bitcoin/actions/runs/6565613863/job/17834513251?pr=25665)",
      "created_at" : "2023-10-26T00:54:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1780253199",
      "id" : 1780253199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585qHIIP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1780253199/reactions"
      },
      "updated_at" : "2023-10-26T00:54:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1780253199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-12-12T16:37:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1852402283",
      "id" : 1852402283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585uaWpr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1852402283/reactions"
      },
      "updated_at" : "2023-12-12T16:37:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1852402283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think there is a silent merge conflict on the first commit.",
      "created_at" : "2024-02-13T09:17:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1940866241",
      "id" : 1940866241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585zr0TB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1940866241/reactions"
      },
      "updated_at" : "2024-02-13T09:17:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1940866241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "At the risk of having asked this previously: Why not postpone the 1c7d8be commit to a later pull? This would also make review easier, because the code change comes with the changes to actually use it in real code, outside of just unit tests.",
      "created_at" : "2024-02-13T10:57:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1941201466",
      "id" : 1941201466,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585ztGI6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1941201466/reactions"
      },
      "updated_at" : "2024-02-13T10:57:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1941201466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/20825711501</sub>",
      "created_at" : "2024-02-13T18:23:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1942144276",
      "id" : 1942144276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII585zwsUU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1942144276/reactions"
      },
      "updated_at" : "2024-02-13T18:23:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1942144276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> At the risk of having asked this previously: Why not postpone the [1c7d8be](https://github.com/bitcoin/bitcoin/commit/1c7d8bea4f0b25f9adb89e402a130fa114220494) commit to a later pull? This would also make review easier, because the code change comes with the changes to actually use it in real code, outside of just unit tests.\r\n\r\nSure, I'm happy to split up this PR.\r\n\r\nI don't think this idea came up before (or I can't remember if it did). From my perspective commit 1c7d8bea4f0b25f9adb89e402a130fa114220494 is basically the point of this PR, and the other commits are less important. Usually when we have errors we want to return descriptive error strings and fail, not return error codes and branch. So I think the part of this PR that returns better error and warning messages is more interesting than the part that returns error codes.\r\n\r\nAs far as using the changes in real code, not just tests, I opened #25722 at the same time as this PR to start using it throughout wallet code, so there are actually a _lot_ of usages to look at outside of tests. The usage patterns in the test are also meant to be realistic, with test functions returning errors and warnings, accumulating them, and returning them as part of their own Results .\r\n\r\nI don't think it hurts anything to split this PR up, so I can try that, **but I'm also curious if other reviewers want me to split this or leave it alone.** According to draftbot this has 1 current ack and 6 stale acks, and it seems like this needs rebase due to a silent conflict. So maybe the problem is more that it hasn't gotten enough simultaneous acks at the same time, and that I've been lazy about rebasing, than that it should be split up.",
      "created_at" : "2024-02-21T18:06:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1957566802",
      "id" : 1957566802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII5850rhlS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1957566802/reactions"
      },
      "updated_at" : "2024-02-21T18:11:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1957566802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased f822ac9a24d684937f1258da89812e99c4b205ba -> 4ec6b060a80045049adc53b4db0b0837ba169cfc ([`pr/bresult2.44`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.44) -> [`pr/bresult2.45`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult2.45), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult2.44-rebase..pr/bresult2.45)) due to silent conflict with #27877",
      "created_at" : "2024-02-21T19:18:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25665#issuecomment-1957738284",
      "id" : 1957738284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
      "node_id" : "IC_kwDOABII5850sLcs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1957738284/reactions"
      },
      "updated_at" : "2024-02-21T19:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1957738284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
