[
   {
      "body" : "Contains overhauled parts from #9483",
      "created_at" : "2017-07-11T15:02:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314473310",
      "id" : 314473310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T15:02:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314473310",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "cheers",
      "created_at" : "2017-07-11T15:04:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314473958",
      "id" : 314473958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T15:04:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314473958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/15623546?v=3",
         "events_url" : "https://api.github.com/users/MIGUELWAXX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MIGUELWAXX/followers",
         "following_url" : "https://api.github.com/users/MIGUELWAXX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MIGUELWAXX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MIGUELWAXX",
         "id" : 15623546,
         "login" : "MIGUELWAXX",
         "organizations_url" : "https://api.github.com/users/MIGUELWAXX/orgs",
         "received_events_url" : "https://api.github.com/users/MIGUELWAXX/received_events",
         "repos_url" : "https://api.github.com/users/MIGUELWAXX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MIGUELWAXX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MIGUELWAXX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MIGUELWAXX"
      }
   },
   {
      "body" : "I'd like to help out here, and I've spent literally days reviewing previous iterations of this change (#9076 #9483 #9171), but I can't figure out if this is going anywhere and if providing more review now is a good use of time.\r\n\r\nAs I've mentioned previously, I don't think the auxiliary block download class design is great, because it duplicates functionality from the networking layer in a wholly different part of the code, and gives the wallet too much control & responsibility over low level p2p details in the case where it's used to let the wallet code prioritize which blocks to download. I've tried to describe what I think would be better alternatives in my previous review comments, like https://github.com/bitcoin/bitcoin/pull/9483#issuecomment-278799990.\r\n\r\n@jonasschnelli, assuming you don't want to take my previous suggestions, and do want to stick with the current design, I think it would be helpful if you could reach out to some other reviewers and get some concept acks for your current approach. It might help to put together some kind of design document, or at least a detailed comment to the top of `auxiliaryblockrequest.h` that lays out how the class works and what your future plans for it are in as much detail as possible, so someone can understand how it's intended to be used without having to wade through all the PRs.",
      "created_at" : "2017-07-11T17:03:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314508746",
      "id" : 314508746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T17:03:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314508746",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "cheers",
      "created_at" : "2017-07-11T17:31:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314516392",
      "id" : 314516392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T17:31:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314516392",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/15623546?v=3",
         "events_url" : "https://api.github.com/users/MIGUELWAXX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MIGUELWAXX/followers",
         "following_url" : "https://api.github.com/users/MIGUELWAXX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MIGUELWAXX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MIGUELWAXX",
         "id" : 15623546,
         "login" : "MIGUELWAXX",
         "organizations_url" : "https://api.github.com/users/MIGUELWAXX/orgs",
         "received_events_url" : "https://api.github.com/users/MIGUELWAXX/received_events",
         "repos_url" : "https://api.github.com/users/MIGUELWAXX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MIGUELWAXX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MIGUELWAXX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MIGUELWAXX"
      }
   },
   {
      "body" : "@ryanofsky:\r\nThank you very much for the reviews in #9483. I implemented almost all of your suggesting and some of them where really great.\r\nHowever, I think the current design of having a dedicated class (`CauxiliaryBlockRequest`) makes sense, because...\r\n\r\n* An out-of-band (auxiliary) block request in an object, you could have multiple in parallel (assume multiwallet, etc.), in future, we may want to serialise them to disk, etc. Therefore I think it should be capsulated in its own class.\r\n\r\n* I think the wallet needs control. For a light-client mode, the wallet is the one that tells the node what it needs. More or less, wallet tells node: \"I need block A to E, give them to me as fast as possible\", then node may call back \"I have block A already ready (on disk), rest will follow soon\", etc. Wallet then may say: \"Okay, thats enough, you can stop at B already\", etc.\r\n\r\n* Having the implementation in a designated file makes code overview simpler. It can result in having slightly more lines of code but it should worth it. Having another `main.cpp` for everything that is network related should be avoided now, early enough. I don't think we have a lot of duplicated code, or can you point out what would be more compact if we would implement it directly in `net_processing.cpp`?\r\n\r\n* Last but not least, it allows to have a patch-set the requires less rebasing. And this is an important one to me. Eventually, this will be something that \"runs along\" with the master branch until there has been reasonable amount of testing before it gets eventually merged.",
      "created_at" : "2017-07-11T18:36:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314534086",
      "id" : 314534086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T18:36:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314534086",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Followed yesterdays discussion we had in #bitcoin-core-dev. Removed the `CAuxiliaryBlockRequests` and added a `std::map blocksToDownloadFirst`.\r\nSuch manually added, priority block downloads will not trigger `ActivateBestChain`.\r\n\r\nThis PR now also adds a new signal `BlockProcessed()`.\r\n\r\nThe scope of this PR is not to make the block download interface flexible for multiple \"users\" (like the validation and eventually the light-client wallet).",
      "created_at" : "2017-07-12T15:47:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314811848",
      "id" : 314811848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-12T15:47:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314811848",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "fixed @ryanofsky points.\r\nThis does pass travis now. Thanks in advance for reviews...",
      "created_at" : "2017-07-20T18:11:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-316785986",
      "id" : 316785986,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-20T18:11:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316785986",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Thanks @ryanofsky. Agree about required conceptual ACKs from other devs.\r\nThe long term goal was sketched in #9483, basically a light client mode for Bitcoin-Core that would allow node/wallet separation.",
      "created_at" : "2017-07-20T19:58:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-316813092",
      "id" : 316813092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-20T19:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316813092",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129047410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129047410"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add priority block request queue\"\r\n\r\nShould update comment for new return value",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-07-24T14:16:00Z",
      "diff_hunk" : "@@ -311,7 +314,11 @@ void FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n // Requires cs_main.\n // Returns a bool indicating whether we requested this block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129047410",
      "id" : 129047410,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTA0NzQxMA==",
      "original_commit_id" : "b02b237a0000806dc1e459a4e8e2fce9bbbf4272",
      "original_position" : 19,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129047410",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129049059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129049059"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add priority block request queue\"\r\n\r\nCould be const auto",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-07-24T14:21:28Z",
      "diff_hunk" : "@@ -466,9 +478,18 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<con\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n+    if (!blocksToDownloadFirst.empty()) {\n+        for (auto& kv : blocksToDownloadFirst) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129049059",
      "id" : 129049059,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTA0OTA1OQ==",
      "original_commit_id" : "b02b237a0000806dc1e459a4e8e2fce9bbbf4272",
      "original_position" : 86,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129049059",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129052414"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129052414"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nMaybe drop part of comment in parentheses, seems to imply value will be true for priority block requests. ",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-07-24T14:32:37Z",
      "diff_hunk" : "@@ -640,6 +644,7 @@ UniValue getblockheader(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"hash\\\" : \\\"hash\\\",     (string) the block hash (same as provided)\\n\"\n             \"  \\\"confirmations\\\" : n,   (numeric) The number of confirmations, or -1 if the block is not on the main chain\\n\"\n+            \"  \\\"validated\\\" : n,       (boolean) True if the block has been validated (for priority block requests)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129052414",
      "id" : 129052414,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTA1MjQxNA==",
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 29,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129052414",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129053764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129053764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[RPC] Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nCopy is redundant, get_array just returns reference to *this.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-07-24T14:36:42Z",
      "diff_hunk" : "@@ -1532,6 +1537,69 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n     return ret;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: [\\\"<blockhash in queue>\\\", \\\"<blockhash in queue>\\\" ...]\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\")\n+    {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\")\n+    {\n+        UniValue ret(UniValue::VARR);\n+        std::map<uint256, const CBlockIndex*> prioBlocks = GetPriorityDownloads();\n+        for(auto& kv: prioBlocks) {\n+            ret.push_back(kv.first.ToString());\n+        }\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\")\n+    {\n+        if (request.params.size() < 2)\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        UniValue hash_Uarray = request.params[1].get_array();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129053764",
      "id" : 129053764,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTA1Mzc2NA==",
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 75,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129053764",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054094"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[RPC] Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nCan never happen, get_array call above would have thrown if the hash_Uarray / params[1] value was not an array",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-07-24T14:37:45Z",
      "diff_hunk" : "@@ -1532,6 +1537,69 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n     return ret;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: [\\\"<blockhash in queue>\\\", \\\"<blockhash in queue>\\\" ...]\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\")\n+    {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\")\n+    {\n+        UniValue ret(UniValue::VARR);\n+        std::map<uint256, const CBlockIndex*> prioBlocks = GetPriorityDownloads();\n+        for(auto& kv: prioBlocks) {\n+            ret.push_back(kv.first.ToString());\n+        }\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\")\n+    {\n+        if (request.params.size() < 2)\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        UniValue hash_Uarray = request.params[1].get_array();\n+        if (!hash_Uarray.isArray())\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Second parameter must be an array\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054094",
      "id" : 129054094,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTA1NDA5NA==",
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 77,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054094",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054305"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[RPC] Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nProbably should write mi->second",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-07-24T14:38:28Z",
      "diff_hunk" : "@@ -1532,6 +1537,69 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n     return ret;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: [\\\"<blockhash in queue>\\\", \\\"<blockhash in queue>\\\" ...]\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\")\n+    {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\")\n+    {\n+        UniValue ret(UniValue::VARR);\n+        std::map<uint256, const CBlockIndex*> prioBlocks = GetPriorityDownloads();\n+        for(auto& kv: prioBlocks) {\n+            ret.push_back(kv.first.ToString());\n+        }\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\")\n+    {\n+        if (request.params.size() < 2)\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        UniValue hash_Uarray = request.params[1].get_array();\n+        if (!hash_Uarray.isArray())\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Second parameter must be an array\");\n+\n+        std::vector<const CBlockIndex*> blocksToDownload;\n+        {\n+            LOCK(cs_main); //mapBlockIndex\n+            for (const UniValue& strHashU : hash_Uarray.getValues())\n+            {\n+                uint256 hash(uint256S(strHashU.get_str()));\n+                BlockMap::iterator mi = mapBlockIndex.find(hash);\n+                if (mi == mapBlockIndex.end())\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n+                blocksToDownload.push_back((*mi).second);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054305",
      "id" : 129054305,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTA1NDMwNQ==",
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 88,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054305",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Overhauled and fixed @ryanofsky points (mostly nits), also removed the new (unused) signal.",
      "created_at" : "2017-07-25T08:50:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-317672618",
      "id" : 317672618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-25T08:50:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317672618",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129334184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129334184"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[RPC] Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nDon't really need this check, because the get_array call below will trigger it's own error about the value not being an array. But if you prefer this error, you should change the check to request.params[1].isNull() to avoid making a distinction between a null and a missing value (#10281, #10783).\r\n",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-07-25T15:09:46Z",
      "diff_hunk" : "@@ -1532,6 +1537,63 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n     return ret;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: [\\\"<blockhash in queue>\\\", \\\"<blockhash in queue>\\\" ...]\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {\n+        UniValue ret(UniValue::VARR);\n+        std::map<uint256, const CBlockIndex*> prioBlocks = GetPriorityDownloads();\n+        for(auto& kv: prioBlocks) {\n+            ret.push_back(kv.first.ToString());\n+        }\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\") {\n+        if (request.params.size() < 2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129334184",
      "id" : 129334184,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTMzNDE4NA==",
      "original_commit_id" : "d3e64f60054a7d904848f53986d80857aacdc692",
      "original_position" : 70,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 52096264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129334184",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Overhauled first commit to make sure we request blocks in order:\r\nhttps://github.com/bitcoin/bitcoin/pull/10794/commits/5927f7f1d6c7eb1bc7fb7a39dfda277ad5e4474c#diff-eff7adeaec73a769788bb78858815c91R483\r\n",
      "created_at" : "2017-07-26T14:04:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-318063026",
      "id" : 318063026,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-26T14:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318063026",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "* Overhauled once again. Added the processing logic to ensure blocks are processed in order (makes it much simpler to process by \"the other side\").\r\n* Added a new main signal for the processing (reusing BlockChecked seems wrong).\r\n* Priority requests are now pushed through signal\r\n\r\nThis is now tested on my SPV branch and could be the first reviewable step towards light clients / wallet process separation.",
      "created_at" : "2017-07-27T08:33:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-318296344",
      "id" : 318296344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-27T08:33:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318296344",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase",
      "created_at" : "2017-08-31T21:24:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-326424712",
      "id" : 326424712,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-08-31T21:24:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326424712",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@ryanofsky Reflecting to your usefullness concern:  \r\nI wrote a full block downloading SPV wallet ([HiddenWallet](https://github.com/nopara73/HiddenWallet/)), the main reason is, because without such architecture [private transaction retrieval is hard](https://groups.google.com/forum/#!msg/bitcoinj/Ys13qkTwcNg/9qxnhwnkeoIJ), if not impossible.  \r\nWhen some form of light functionality gets into Core I would personally consider porting HiddenWallet to on top of Core, since I cannot compete with Core's speed and stability.",
      "created_at" : "2017-10-03T18:06:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-333929365",
      "id" : 333929365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-10-03T18:06:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333929365",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "That's really interesting. @nopara73, if I understand you correctly, you are saying that if the `requestblocks` JSON-RPC API from this PR is added to bitcoin core, then [HiddenWallet](https://github.com/nopara73/HiddenWallet/) would be able to call it to download blocks instead of depending on [NBitcoin](https://github.com/MetacoSA/NBitcoin)?",
      "created_at" : "2017-10-03T18:48:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-333941691",
      "id" : 333941691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-10-03T18:48:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333941691",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@ryanofsky \r\n\r\n> you are saying that if the requestblocks JSON-RPC API from this PR is added to bitcoin core, then HiddenWallet would be able to call it to download blocks instead of depending on NBitcoin?\r\n\r\nYes.  ",
      "created_at" : "2017-10-03T19:06:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-333946305",
      "id" : 333946305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-10-03T19:06:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333946305",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2017-11-22T22:23:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-346489035",
      "id" : 346489035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-11-22T22:23:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346489035",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152754098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152754098"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, should be\r\n```cpp\r\nstruct PriorityBlockRequest\r\n{\r\n```",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:37:27Z",
      "diff_hunk" : "@@ -136,6 +139,13 @@ namespace {\n     MapRelay mapRelay;\n     /** Expiration-time ordered list of (expire time, relay map entry) pairs, protected by cs_main). */\n     std::deque<std::pair<int64_t, MapRelay::iterator>> vRelayExpiration;\n+\n+    struct PriorityBlockRequest {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152754098",
      "id" : 152754098,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NDA5OA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 22,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152754098",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152754258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152754258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, remove `const` from return?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:38:10Z",
      "diff_hunk" : "@@ -308,9 +318,13 @@ void PushNodeVersion(CNode *pnode, CConnman* connman, int64_t nTime)\n }\n \n // Requires cs_main.\n-// Returns a bool indicating whether we requested this block.\n+// Returns a MarkBlockAsReceivedResult struct to indicating whether we requested this block and if it was via the priority request queue\n // Also used if a block was /not/ received and timed out or started with another peer\n-bool MarkBlockAsReceived(const uint256& hash) {\n+struct MarkBlockAsReceivedResult {\n+    bool fRequested;\n+    bool fPriorityRequest;\n+ };\n+const MarkBlockAsReceivedResult MarkBlockAsReceived(const uint256& hash) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152754258",
      "id" : 152754258,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NDI1OA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 43,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152754258",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152754462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152754462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, missing spaces after `(` and before `)`.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:39:06Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152754462",
      "id" : 152754462,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NDQ2Mg==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 41,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152754462",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152755122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152755122"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, remove else's?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:42:06Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152755122",
      "id" : 152755122,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NTEyMg==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 61,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 60,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152755122",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152755544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152755544"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, move up.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:43:49Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {\n+        UniValue ret(UniValue::VOBJ);\n+        ret.push_back(Pair(\"count\", (uint64_t)CountPriorityDownloads()));\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\") {\n+        if (request.params.size() < 2) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        }\n+        std::vector<const CBlockIndex*> blocksToDownload;\n+        {\n+            LOCK(cs_main); //mapBlockIndex\n+            for (const UniValue& strHashU : request.params[1].get_array().getValues())\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152755544",
      "id" : 152755544,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NTU0NA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 74,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152755544",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152756424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152756424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use `wait_until`?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:47:45Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:\n+            ctps = self.nodes[1].getchaintips()\n+            headerHeightReached = False\n+            for ct in ctps:\n+                if ct['status'] == \"headers-only\":\n+                    if ct['height'] == 50:\n+                        headerHeightReached = True\n+                if ct['status'] == \"active\":\n+                    assert(ct['height'] == 0)\n+            time.sleep(1)\n+            timeout-=1\n+            if headerHeightReached == True:\n+                break\n+        assert(timeout>0)\n+\n+        node0bbhash = self.nodes[0].getbestblockhash()\n+        # best block should not be validated, header must be available\n+        bh = self.nodes[1].getblockheader(node0bbhash, True)\n+\n+        assert(bh['validated'] == False)\n+        # block must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, node0bbhash)\n+\n+        # request best block (auxiliary)\n+        self.nodes[1].requestblocks(\"add\", [node0bbhash])\n+        timeout = 20\n+        while timeout > 0:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152756424",
      "id" : 152756424,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NjQyNA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 46,
      "path" : "test/functional/requestblocks.py",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152756424",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152756532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152756532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`assert_equal`?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:48:18Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:\n+            ctps = self.nodes[1].getchaintips()\n+            headerHeightReached = False\n+            for ct in ctps:\n+                if ct['status'] == \"headers-only\":\n+                    if ct['height'] == 50:\n+                        headerHeightReached = True\n+                if ct['status'] == \"active\":\n+                    assert(ct['height'] == 0)\n+            time.sleep(1)\n+            timeout-=1\n+            if headerHeightReached == True:\n+                break\n+        assert(timeout>0)\n+\n+        node0bbhash = self.nodes[0].getbestblockhash()\n+        # best block should not be validated, header must be available\n+        bh = self.nodes[1].getblockheader(node0bbhash, True)\n+\n+        assert(bh['validated'] == False)\n+        # block must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, node0bbhash)\n+\n+        # request best block (auxiliary)\n+        self.nodes[1].requestblocks(\"add\", [node0bbhash])\n+        timeout = 20\n+        while timeout > 0:\n+            if self.nodes[1].requestblocks(\"status\")['count'] == 0:\n+                break;\n+            time.sleep(1)\n+            timeout-=1\n+        assert(timeout>0)\n+\n+        # block must now be available\n+        block = self.nodes[1].getblock(node0bbhash, True)\n+        assert(block['hash'] == node0bbhash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152756532",
      "id" : 152756532,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NjUzMg==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 55,
      "path" : "test/functional/requestblocks.py",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152756532",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152756568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152756568"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`assert_equal`?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:48:28Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:\n+            ctps = self.nodes[1].getchaintips()\n+            headerHeightReached = False\n+            for ct in ctps:\n+                if ct['status'] == \"headers-only\":\n+                    if ct['height'] == 50:\n+                        headerHeightReached = True\n+                if ct['status'] == \"active\":\n+                    assert(ct['height'] == 0)\n+            time.sleep(1)\n+            timeout-=1\n+            if headerHeightReached == True:\n+                break\n+        assert(timeout>0)\n+\n+        node0bbhash = self.nodes[0].getbestblockhash()\n+        # best block should not be validated, header must be available\n+        bh = self.nodes[1].getblockheader(node0bbhash, True)\n+\n+        assert(bh['validated'] == False)\n+        # block must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, node0bbhash)\n+\n+        # request best block (auxiliary)\n+        self.nodes[1].requestblocks(\"add\", [node0bbhash])\n+        timeout = 20\n+        while timeout > 0:\n+            if self.nodes[1].requestblocks(\"status\")['count'] == 0:\n+                break;\n+            time.sleep(1)\n+            timeout-=1\n+        assert(timeout>0)\n+\n+        # block must now be available\n+        block = self.nodes[1].getblock(node0bbhash, True)\n+        assert(block['hash'] == node0bbhash)\n+        assert(block['validated'] == False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152756568",
      "id" : 152756568,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NjU2OA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 56,
      "path" : "test/functional/requestblocks.py",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152756568",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Another option would be to use `zmq` notification, another PR maybe?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:50:34Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:\n+            ctps = self.nodes[1].getchaintips()\n+            headerHeightReached = False\n+            for ct in ctps:\n+                if ct['status'] == \"headers-only\":\n+                    if ct['height'] == 50:\n+                        headerHeightReached = True\n+                if ct['status'] == \"active\":\n+                    assert(ct['height'] == 0)\n+            time.sleep(1)\n+            timeout-=1\n+            if headerHeightReached == True:\n+                break\n+        assert(timeout>0)\n+\n+        node0bbhash = self.nodes[0].getbestblockhash()\n+        # best block should not be validated, header must be available\n+        bh = self.nodes[1].getblockheader(node0bbhash, True)\n+\n+        assert(bh['validated'] == False)\n+        # block must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, node0bbhash)\n+\n+        # request best block (auxiliary)\n+        self.nodes[1].requestblocks(\"add\", [node0bbhash])\n+        timeout = 20\n+        while timeout > 0:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757059",
      "id" : 152757059,
      "in_reply_to_id" : 152756424,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NzA1OQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 46,
      "path" : "test/functional/requestblocks.py",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757059",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757129"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`assert_equal`?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:50:50Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:\n+            ctps = self.nodes[1].getchaintips()\n+            headerHeightReached = False\n+            for ct in ctps:\n+                if ct['status'] == \"headers-only\":\n+                    if ct['height'] == 50:\n+                        headerHeightReached = True\n+                if ct['status'] == \"active\":\n+                    assert(ct['height'] == 0)\n+            time.sleep(1)\n+            timeout-=1\n+            if headerHeightReached == True:\n+                break\n+        assert(timeout>0)\n+\n+        node0bbhash = self.nodes[0].getbestblockhash()\n+        # best block should not be validated, header must be available\n+        bh = self.nodes[1].getblockheader(node0bbhash, True)\n+\n+        assert(bh['validated'] == False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757129",
      "id" : 152757129,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NzEyOQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 39,
      "path" : "test/functional/requestblocks.py",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757129",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use `wait_until`?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:51:20Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757221",
      "id" : 152757221,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NzIyMQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 20,
      "path" : "test/functional/requestblocks.py",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757221",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757315"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, remove spaces?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:51:43Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:\n+            ctps = self.nodes[1].getchaintips()\n+            headerHeightReached = False\n+            for ct in ctps:\n+                if ct['status'] == \"headers-only\":\n+                    if ct['height'] == 50:\n+                        headerHeightReached = True\n+                if ct['status'] == \"active\":\n+                    assert(ct['height'] == 0)\n+            time.sleep(1)\n+            timeout-=1\n+            if headerHeightReached == True:\n+                break\n+        assert(timeout>0)\n+\n+        node0bbhash = self.nodes[0].getbestblockhash()\n+        # best block should not be validated, header must be available\n+        bh = self.nodes[1].getblockheader(node0bbhash, True)\n+\n+        assert(bh['validated'] == False)\n+        # block must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, node0bbhash)\n+\n+        # request best block (auxiliary)\n+        self.nodes[1].requestblocks(\"add\", [node0bbhash])\n+        timeout = 20\n+        while timeout > 0:\n+            if self.nodes[1].requestblocks(\"status\")['count'] == 0:\n+                break;\n+            time.sleep(1)\n+            timeout-=1\n+        assert(timeout>0)\n+\n+        # block must now be available\n+        block = self.nodes[1].getblock(node0bbhash, True)\n+        assert(block['hash'] == node0bbhash)\n+        assert(block['validated'] == False)\n+\n+        #prevblock must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, block['previousblockhash'])\n+\n+if __name__ == '__main__':\n+    RequestBlockRequestTest ().main ()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757315",
      "id" : 152757315,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NzMxNQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 62,
      "path" : "test/functional/requestblocks.py",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757315",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757582"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Missing test for `flush`.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:53:03Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152757582",
      "id" : 152757582,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1NzU4Mg==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 51,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 50,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152757582",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152758669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152758669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Missing test for this error.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:57:52Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {\n+        UniValue ret(UniValue::VOBJ);\n+        ret.push_back(Pair(\"count\", (uint64_t)CountPriorityDownloads()));\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\") {\n+        if (request.params.size() < 2) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152758669",
      "id" : 152758669,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1ODY2OQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 68,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152758669",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152758780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152758780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, add `{ }`",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:58:19Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {\n+        UniValue ret(UniValue::VOBJ);\n+        ret.push_back(Pair(\"count\", (uint64_t)CountPriorityDownloads()));\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\") {\n+        if (request.params.size() < 2) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        }\n+        std::vector<const CBlockIndex*> blocksToDownload;\n+        {\n+            LOCK(cs_main); //mapBlockIndex\n+            for (const UniValue& strHashU : request.params[1].get_array().getValues())\n+            {\n+                uint256 hash(uint256S(strHashU.get_str()));\n+                BlockMap::iterator mi = mapBlockIndex.find(hash);\n+                if (mi == mapBlockIndex.end())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152758780",
      "id" : 152758780,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1ODc4MA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 77,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152758780",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152758932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152758932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`BlockMap::const_iterator`?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T09:58:54Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {\n+        UniValue ret(UniValue::VOBJ);\n+        ret.push_back(Pair(\"count\", (uint64_t)CountPriorityDownloads()));\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\") {\n+        if (request.params.size() < 2) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        }\n+        std::vector<const CBlockIndex*> blocksToDownload;\n+        {\n+            LOCK(cs_main); //mapBlockIndex\n+            for (const UniValue& strHashU : request.params[1].get_array().getValues())\n+            {\n+                uint256 hash(uint256S(strHashU.get_str()));\n+                BlockMap::iterator mi = mapBlockIndex.find(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152758932",
      "id" : 152758932,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1ODkzMg==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 76,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152758932",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152759754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152759754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be `> 2`?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:02:36Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152759754",
      "id" : 152759754,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc1OTc1NA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 39,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152759754",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152760159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152760159"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should update `getblockheader` test?\r\nhttps://github.com/bitcoin/bitcoin/blob/84fa64598e8b7d6901c546e938fb0eeda625a8e8/test/functional/blockchain.py#L173-L198",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:04:34Z",
      "diff_hunk" : "@@ -645,6 +649,7 @@ UniValue getblockheader(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"hash\\\" : \\\"hash\\\",     (string) the block hash (same as provided)\\n\"\n             \"  \\\"confirmations\\\" : n,   (numeric) The number of confirmations, or -1 if the block is not on the main chain\\n\"\n+            \"  \\\"validated\\\" : n,       (boolean) True if the block has been validated\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152760159",
      "id" : 152760159,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MDE1OQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 29,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 28,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152760159",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152760604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152760604"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Arg reference should be const:\r\n```cpp\r\nconst std::vector<const CBlockIndex*>& blocks_to_download\r\n```",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:06:36Z",
      "diff_hunk" : "@@ -81,4 +83,18 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats);\n /** Increase a node's misbehavior score. */\n void Misbehaving(NodeId nodeid, int howmuch);\n \n+/**\n+ * Prioritize a block for downloading\n+ * Blocks requested with priority will be downloaded and processed first\n+ * Downloaded blocks will not trigger ActivateBestChain\n+ */\n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152760604",
      "id" : 152760604,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MDYwNA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 18,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152760604",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152760747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152760747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Copy of?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:07:16Z",
      "diff_hunk" : "@@ -3647,6 +3699,74 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload) {\n+    LOCK(cs_main);\n+    for (const CBlockIndex* pindex: blocksToDownload) {\n+        // we add blocks regardless of duplicates\n+        blocksToDownloadFirst.push_back({pindex, false});\n+    }\n+}\n+\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> blockRef) {\n+    LOCK(cs_main);\n+    if (blocksToDownloadFirst.empty()) {\n+        return;\n+    }\n+    auto it = std::begin(blocksToDownloadFirst);\n+    while (it != std::end(blocksToDownloadFirst)) {\n+        std::shared_ptr<const CBlock> currentBlock;\n+        const PriorityBlockRequest &r = *it;\n+        // make sure we process blocks in order\n+        if (!r.downloaded) {\n+            break;\n+        }\n+        if (r.pindex && blockRef && blockRef->GetHash() == r.pindex->GetBlockHash()) {\n+            // the passed in block, no need to load again from disk\n+            currentBlock = blockRef;\n+        }\n+        else if (r.pindex->nStatus & BLOCK_HAVE_DATA) {\n+            CBlock loadBlock;\n+            if (!ReadBlockFromDisk(loadBlock, r.pindex, Params().GetConsensus())) {\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+            }\n+            currentBlock = std::make_shared<const CBlock>(loadBlock);\n+        }\n+        else {\n+            break;\n+        }\n+\n+        // allow processing through signal\n+        GetMainSignals().ProcessPriorityRequest(currentBlock, r.pindex);\n+        LogPrint(BCLog::NET, \"process priority block request (%s) height=%d\\n\", r.pindex->GetBlockHash().ToString(), r.pindex->nHeight);\n+\n+        // remove processed block from queue\n+        it = blocksToDownloadFirst.erase(std::remove_if(blocksToDownloadFirst.begin(), blocksToDownloadFirst.end(), [&r](const PriorityBlockRequest &rB) {\n+                                        return rB.pindex == r.pindex;\n+                                    }), blocksToDownloadFirst.end());\n+    }\n+}\n+\n+bool FlushPriorityDownloads() {\n+    LOCK(cs_main);\n+    bool ret = blocksToDownloadFirst.empty();\n+    blocksToDownloadFirst.clear();\n+    return !ret;\n+}\n+\n+size_t CountPriorityDownloads() {\n+    // return a copy",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152760747",
      "id" : 152760747,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MDc0Nw==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 290,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152760747",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152761744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152761744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add comment explaining this case?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:11:47Z",
      "diff_hunk" : "@@ -3647,6 +3699,74 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload) {\n+    LOCK(cs_main);\n+    for (const CBlockIndex* pindex: blocksToDownload) {\n+        // we add blocks regardless of duplicates\n+        blocksToDownloadFirst.push_back({pindex, false});\n+    }\n+}\n+\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> blockRef) {\n+    LOCK(cs_main);\n+    if (blocksToDownloadFirst.empty()) {\n+        return;\n+    }\n+    auto it = std::begin(blocksToDownloadFirst);\n+    while (it != std::end(blocksToDownloadFirst)) {\n+        std::shared_ptr<const CBlock> currentBlock;\n+        const PriorityBlockRequest &r = *it;\n+        // make sure we process blocks in order\n+        if (!r.downloaded) {\n+            break;\n+        }\n+        if (r.pindex && blockRef && blockRef->GetHash() == r.pindex->GetBlockHash()) {\n+            // the passed in block, no need to load again from disk\n+            currentBlock = blockRef;\n+        }\n+        else if (r.pindex->nStatus & BLOCK_HAVE_DATA) {\n+            CBlock loadBlock;\n+            if (!ReadBlockFromDisk(loadBlock, r.pindex, Params().GetConsensus())) {\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+            }\n+            currentBlock = std::make_shared<const CBlock>(loadBlock);\n+        }\n+        else {\n+            break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152761744",
      "id" : 152761744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MTc0NA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 268,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152761744",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152761760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152761760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`cs_main` is locked throughout. It is enough to lock when dequeuing right? If dequeuing fails then return.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:11:50Z",
      "diff_hunk" : "@@ -3647,6 +3699,74 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload) {\n+    LOCK(cs_main);\n+    for (const CBlockIndex* pindex: blocksToDownload) {\n+        // we add blocks regardless of duplicates\n+        blocksToDownloadFirst.push_back({pindex, false});\n+    }\n+}\n+\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> blockRef) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152761760",
      "id" : 152761760,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MTc2MA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 244,
      "path" : "src/net_processing.cpp",
      "position" : 246,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152761760",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152761873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152761873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move log before signal?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:12:22Z",
      "diff_hunk" : "@@ -3647,6 +3699,74 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload) {\n+    LOCK(cs_main);\n+    for (const CBlockIndex* pindex: blocksToDownload) {\n+        // we add blocks regardless of duplicates\n+        blocksToDownloadFirst.push_back({pindex, false});\n+    }\n+}\n+\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> blockRef) {\n+    LOCK(cs_main);\n+    if (blocksToDownloadFirst.empty()) {\n+        return;\n+    }\n+    auto it = std::begin(blocksToDownloadFirst);\n+    while (it != std::end(blocksToDownloadFirst)) {\n+        std::shared_ptr<const CBlock> currentBlock;\n+        const PriorityBlockRequest &r = *it;\n+        // make sure we process blocks in order\n+        if (!r.downloaded) {\n+            break;\n+        }\n+        if (r.pindex && blockRef && blockRef->GetHash() == r.pindex->GetBlockHash()) {\n+            // the passed in block, no need to load again from disk\n+            currentBlock = blockRef;\n+        }\n+        else if (r.pindex->nStatus & BLOCK_HAVE_DATA) {\n+            CBlock loadBlock;\n+            if (!ReadBlockFromDisk(loadBlock, r.pindex, Params().GetConsensus())) {\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+            }\n+            currentBlock = std::make_shared<const CBlock>(loadBlock);\n+        }\n+        else {\n+            break;\n+        }\n+\n+        // allow processing through signal\n+        GetMainSignals().ProcessPriorityRequest(currentBlock, r.pindex);\n+        LogPrint(BCLog::NET, \"process priority block request (%s) height=%d\\n\", r.pindex->GetBlockHash().ToString(), r.pindex->nHeight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152761873",
      "id" : 152761873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MTg3Mw==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 273,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152761873",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152762352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152762352"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is removing duplicates here really necessary? Blocks with `BLOCK_HAVE_DATA` will be skipped.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:14:45Z",
      "diff_hunk" : "@@ -3647,6 +3699,74 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload) {\n+    LOCK(cs_main);\n+    for (const CBlockIndex* pindex: blocksToDownload) {\n+        // we add blocks regardless of duplicates\n+        blocksToDownloadFirst.push_back({pindex, false});\n+    }\n+}\n+\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> blockRef) {\n+    LOCK(cs_main);\n+    if (blocksToDownloadFirst.empty()) {\n+        return;\n+    }\n+    auto it = std::begin(blocksToDownloadFirst);\n+    while (it != std::end(blocksToDownloadFirst)) {\n+        std::shared_ptr<const CBlock> currentBlock;\n+        const PriorityBlockRequest &r = *it;\n+        // make sure we process blocks in order\n+        if (!r.downloaded) {\n+            break;\n+        }\n+        if (r.pindex && blockRef && blockRef->GetHash() == r.pindex->GetBlockHash()) {\n+            // the passed in block, no need to load again from disk\n+            currentBlock = blockRef;\n+        }\n+        else if (r.pindex->nStatus & BLOCK_HAVE_DATA) {\n+            CBlock loadBlock;\n+            if (!ReadBlockFromDisk(loadBlock, r.pindex, Params().GetConsensus())) {\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+            }\n+            currentBlock = std::make_shared<const CBlock>(loadBlock);\n+        }\n+        else {\n+            break;\n+        }\n+\n+        // allow processing through signal\n+        GetMainSignals().ProcessPriorityRequest(currentBlock, r.pindex);\n+        LogPrint(BCLog::NET, \"process priority block request (%s) height=%d\\n\", r.pindex->GetBlockHash().ToString(), r.pindex->nHeight);\n+\n+        // remove processed block from queue\n+        it = blocksToDownloadFirst.erase(std::remove_if(blocksToDownloadFirst.begin(), blocksToDownloadFirst.end(), [&r](const PriorityBlockRequest &rB) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152762352",
      "id" : 152762352,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MjM1Mg==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 276,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152762352",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152762499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152762499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is the purpose of the return value?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:15:28Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152762499",
      "id" : 152762499,
      "in_reply_to_id" : 152757582,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2MjQ5OQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 51,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 50,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152762499",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152762788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152762788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove, duplicate declaration.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:16:48Z",
      "diff_hunk" : "@@ -81,4 +83,18 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats);\n /** Increase a node's misbehavior score. */\n void Misbehaving(NodeId nodeid, int howmuch);\n \n+/**\n+ * Prioritize a block for downloading\n+ * Blocks requested with priority will be downloaded and processed first\n+ * Downloaded blocks will not trigger ActivateBestChain\n+ */\n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload);\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> block);\n+bool FlushPriorityDownloads();\n+size_t CountPriorityDownloads();\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152762788",
      "id" : 152762788,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2Mjc4OA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 22,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152762788",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152765041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152765041"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Split in multiple tests. Suggestion for loop body:\r\n```cpp\r\nif (!r.pindex) continue;\r\nif (state->pindexBestKnownBlock == nullptr) continue;\r\nif (state->pindexBestKnownBlock->nHeight < r.pindex->nHeight) continue;\r\nif (mapBlocksInFlight.count(r.pindex->GetBlockHash())) continue;\r\n\r\nvBlocks.push_back(r.pindex);\r\n\r\nif (vBlocks.size() == count) break;\r\n```\r\nIMHO more readable and more easier to add comments.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:26:56Z",
      "diff_hunk" : "@@ -473,9 +498,26 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<con\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n+    if (!blocksToDownloadFirst.empty()) {\n+        for (const PriorityBlockRequest &r: blocksToDownloadFirst) {\n+            if (r.downloaded) continue;\n+            if (r.pindex && state->pindexBestKnownBlock != NULL && state->pindexBestKnownBlock->nHeight >= r.pindex->nHeight && !mapBlocksInFlight.count(r.pindex->GetBlockHash())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152765041",
      "id" : 152765041,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2NTA0MQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 112,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152765041",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152765310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152765310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Otherwise, replace `NULL` with nullptr and use `break` instead of `return true`.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:28:10Z",
      "diff_hunk" : "@@ -473,9 +498,26 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<con\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n+    if (!blocksToDownloadFirst.empty()) {\n+        for (const PriorityBlockRequest &r: blocksToDownloadFirst) {\n+            if (r.downloaded) continue;\n+            if (r.pindex && state->pindexBestKnownBlock != NULL && state->pindexBestKnownBlock->nHeight >= r.pindex->nHeight && !mapBlocksInFlight.count(r.pindex->GetBlockHash())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152765310",
      "id" : 152765310,
      "in_reply_to_id" : 152765041,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2NTMxMA==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 112,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78661886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152765310",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152765681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152765681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same for other structs.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T10:30:00Z",
      "diff_hunk" : "@@ -136,6 +139,13 @@ namespace {\n     MapRelay mapRelay;\n     /** Expiration-time ordered list of (expire time, relay map entry) pairs, protected by cs_main). */\n     std::deque<std::pair<int64_t, MapRelay::iterator>> vRelayExpiration;\n+\n+    struct PriorityBlockRequest {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152765681",
      "id" : 152765681,
      "in_reply_to_id" : 152754098,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc2NTY4MQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 22,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78675190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152765681",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152776819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152776819"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Assert `request.params[1]` is null. Same for status.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T11:24:13Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152776819",
      "id" : 152776819,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjc3NjgxOQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 59,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 58,
      "pull_request_review_id" : 78688601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152776819",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "# Simple RPC App Example\r\n\r\nJust to be sure I understand correctly this PR and the application I am considering will work as I expect to work:\r\n\r\nHow would the wallet behave? Best effort or disabled?  \r\n\r\nSo let's say is it possible to write a software, that uses Bitcoin Core's wallet with autorequestblocks=0 in the following way:  \r\n\r\n1. Sync up the header.  \r\n2. Create a wallet, save the creation time (or block height).  \r\n3. Subscribe for new header notifications.  \r\n4. Every time a new header comes call `requestblock add blockhash`\r\n\r\nSo the wallet, from the information it has available executes the rpc commands properly based on best effort, right? And is not supposed to fail.  \r\n\r\nThis gives me the possibility to implement leapfrogging for example. (Enable the user to say: hey, I didn't do or wait for any transaction in the last 3 months and I have no intention to sync it up, it's ok if I get the blocks from now on.)  \r\n\r\n# Other Concerns\r\n\r\n1. Since this mode cannot have up to date utxo set, how do you broadcast transactions? How do you make sure it's valid?  \r\n2. How do you accept transactions to your mempool without making sure it spends an utxo? Are you also propagating them?  \r\n3. What would getblockcount return?\r\n",
      "created_at" : "2017-11-23T19:08:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-346684475",
      "id" : 346684475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-11-23T19:08:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346684475",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@nopara73 \r\n* This PR does not touch the wallet (that will come later, would be to large of a PR).\r\n* This PR does allow to disable the auto-download (sync)\r\n* This PR does allow to download random blocks (specified by block-hashes) and have them header-only-validated, ... so you can parse the blocks content\r\n\r\n> Since this mode cannot have up to date utxo set, how do you broadcast transactions? How do you make sure it's valid?\r\n\r\nThis is not done on the PR. But there is a commit available in #9483 https://github.com/bitcoin/bitcoin/pull/9483/commits/7ca1a8738a878078c0d1546f7743a05ee474dd1b that does allow broadcasting transactions without an utxo set.\r\n\r\n> How do you accept transactions to your mempool without making sure it spends an utxo? Are you also propagating them?\r\n\r\nThis is impossible in light client mode. Mempool transactions (zero confirmation txns) are pretty unsafe in light client mode.\r\n\r\n> What would getblockcount return?\r\n\r\nThe same (probably `0` in `autorequestblocks=0` mode).\r\nUse `getchaintips()` to check your headers (not super efficient).",
      "created_at" : "2017-11-23T20:05:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-346691009",
      "id" : 346691009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-11-23T20:05:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346691009",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152870033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152870033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's okay after, but should say \"processed\" instead of \"process\".",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T20:49:22Z",
      "diff_hunk" : "@@ -3647,6 +3699,74 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload) {\n+    LOCK(cs_main);\n+    for (const CBlockIndex* pindex: blocksToDownload) {\n+        // we add blocks regardless of duplicates\n+        blocksToDownloadFirst.push_back({pindex, false});\n+    }\n+}\n+\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> blockRef) {\n+    LOCK(cs_main);\n+    if (blocksToDownloadFirst.empty()) {\n+        return;\n+    }\n+    auto it = std::begin(blocksToDownloadFirst);\n+    while (it != std::end(blocksToDownloadFirst)) {\n+        std::shared_ptr<const CBlock> currentBlock;\n+        const PriorityBlockRequest &r = *it;\n+        // make sure we process blocks in order\n+        if (!r.downloaded) {\n+            break;\n+        }\n+        if (r.pindex && blockRef && blockRef->GetHash() == r.pindex->GetBlockHash()) {\n+            // the passed in block, no need to load again from disk\n+            currentBlock = blockRef;\n+        }\n+        else if (r.pindex->nStatus & BLOCK_HAVE_DATA) {\n+            CBlock loadBlock;\n+            if (!ReadBlockFromDisk(loadBlock, r.pindex, Params().GetConsensus())) {\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+            }\n+            currentBlock = std::make_shared<const CBlock>(loadBlock);\n+        }\n+        else {\n+            break;\n+        }\n+\n+        // allow processing through signal\n+        GetMainSignals().ProcessPriorityRequest(currentBlock, r.pindex);\n+        LogPrint(BCLog::NET, \"process priority block request (%s) height=%d\\n\", r.pindex->GetBlockHash().ToString(), r.pindex->nHeight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152870033",
      "id" : 152870033,
      "in_reply_to_id" : 152761873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjg3MDAzMw==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 273,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78798629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152870033",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152870189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152870189"
         }
      },
      "author_association" : "MEMBER",
      "body" : "With the current implementation, `blocksToDownloadFirst` can have multiple of the same block. I'd say it should remain here...",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T20:51:32Z",
      "diff_hunk" : "@@ -3647,6 +3699,74 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void AddPriorityDownload(std::vector<const CBlockIndex*>& blocksToDownload) {\n+    LOCK(cs_main);\n+    for (const CBlockIndex* pindex: blocksToDownload) {\n+        // we add blocks regardless of duplicates\n+        blocksToDownloadFirst.push_back({pindex, false});\n+    }\n+}\n+\n+void ProcessPriorityRequests(const std::shared_ptr<CBlock> blockRef) {\n+    LOCK(cs_main);\n+    if (blocksToDownloadFirst.empty()) {\n+        return;\n+    }\n+    auto it = std::begin(blocksToDownloadFirst);\n+    while (it != std::end(blocksToDownloadFirst)) {\n+        std::shared_ptr<const CBlock> currentBlock;\n+        const PriorityBlockRequest &r = *it;\n+        // make sure we process blocks in order\n+        if (!r.downloaded) {\n+            break;\n+        }\n+        if (r.pindex && blockRef && blockRef->GetHash() == r.pindex->GetBlockHash()) {\n+            // the passed in block, no need to load again from disk\n+            currentBlock = blockRef;\n+        }\n+        else if (r.pindex->nStatus & BLOCK_HAVE_DATA) {\n+            CBlock loadBlock;\n+            if (!ReadBlockFromDisk(loadBlock, r.pindex, Params().GetConsensus())) {\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+            }\n+            currentBlock = std::make_shared<const CBlock>(loadBlock);\n+        }\n+        else {\n+            break;\n+        }\n+\n+        // allow processing through signal\n+        GetMainSignals().ProcessPriorityRequest(currentBlock, r.pindex);\n+        LogPrint(BCLog::NET, \"process priority block request (%s) height=%d\\n\", r.pindex->GetBlockHash().ToString(), r.pindex->nHeight);\n+\n+        // remove processed block from queue\n+        it = blocksToDownloadFirst.erase(std::remove_if(blocksToDownloadFirst.begin(), blocksToDownloadFirst.end(), [&r](const PriorityBlockRequest &rB) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152870189",
      "id" : 152870189,
      "in_reply_to_id" : 152762352,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjg3MDE4OQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 276,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 78798808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152870189",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152871012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152871012"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can determine if you have flushed something or not.",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T21:01:54Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152871012",
      "id" : 152871012,
      "in_reply_to_id" : 152757582,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjg3MTAxMg==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 51,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 50,
      "pull_request_review_id" : 78799753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152871012",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152871309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152871309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T21:03:16Z",
      "diff_hunk" : "@@ -1587,6 +1592,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152871309",
      "id" : 152871309,
      "in_reply_to_id" : 152755122,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjg3MTMwOQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 61,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 60,
      "pull_request_review_id" : 78800048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152871309",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152872525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152872525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2017-11-23T21:15:41Z",
      "diff_hunk" : "@@ -645,6 +649,7 @@ UniValue getblockheader(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"hash\\\" : \\\"hash\\\",     (string) the block hash (same as provided)\\n\"\n             \"  \\\"confirmations\\\" : n,   (numeric) The number of confirmations, or -1 if the block is not on the main chain\\n\"\n+            \"  \\\"validated\\\" : n,       (boolean) True if the block has been validated\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r152872525",
      "id" : 152872525,
      "in_reply_to_id" : 152760159,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Mjg3MjUyNQ==",
      "original_commit_id" : "9ee22bf4a07eb3f1735063ad0265af129f5d8bed",
      "original_position" : 29,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 28,
      "pull_request_review_id" : 78801378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-04-18T08:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152872525",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@jonasschnelli I'd like to make the last couple of things clear before I compile and test it, just to know what to expect.  \r\n\r\n# 1\r\n\r\n> there is a commit available in #9483 7ca1a87 that does allow broadcasting transactions without an utxo set.\r\n\r\nMeaning, `sendrawtransaction` will always return null?\r\n\r\n# 2\r\n\r\n> This PR does not touch the wallet (that will come later, would be to large of a PR).  \r\n\r\nMeaning, (1) disables the wallet, (2) makes the wallet rpcs return sometimes incorrect results, (3) you don't know what the rpcs would return?  ",
      "created_at" : "2017-11-23T22:04:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-346702879",
      "id" : 346702879,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-11-23T22:04:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346702879",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Meaning, sendrawtransaction will always return null?\r\n\r\nNo. It will return the txid (as expected). But not in this PR (that would be with something like https://github.com/bitcoin/bitcoin/commit/7ca1a8738a878078c0d1546f7743a05ee474dd1b).\r\n\r\n> Meaning, (1) disables the wallet, (2) makes the wallet rpcs return sometimes incorrect results, (3) you don't know what the rpcs would return?\r\n\r\nThe wallet runs the same way as in master.\r\nAll wallet commands do work exactly the same way as the do in standard IBD mode.\r\nBlocks processed with the new `requestblocks` will be ignored by the wallet (otherwise this PR would be too large).\r\n\r\nThe scope of this PR is to add the necessary network processing infrastructure to later add an SPV mode to the wallet.",
      "created_at" : "2017-11-27T05:32:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-347082810",
      "id" : 347082810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-11-27T05:32:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347082810",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">> It would be useful to get concept ACKs from @gmaxwell and @sipa to make sure concerns from the earlier design discussion (https://botbot.me/freenode/bitcoin-core-dev/msg/88437543/) are addressed now.\r\n\r\n> Agree about required conceptual ACKs from other devs.\r\n\r\nLast I looked code was in good shape, but I don't think there was ever more design feedback on this. Maybe it should be brought up at an IRC meeting?",
      "created_at" : "2018-01-09T17:46:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-356360346",
      "id" : 356360346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2018-01-09T17:46:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356360346",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This will be especially useful when combined with BIP158 (Compact Block Filters for Light Clients.) \r\nhttps://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki\r\n\r\nI imagine, based on this PR someone will eventually make a Bitcoin Core light client after Core starts to serve filters. At least that'll be a low hanging fruit.",
      "created_at" : "2018-02-20T08:10:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-366897388",
      "id" : 366897388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2018-02-20T08:10:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/366897388",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Though I'm not sure what it would do on its own, perhaps the `PriorityBlockRequest` could be a separate PR?\r\n\r\nSame for `requestblocks` RPC; could that be useful in pruned nodes to retrieve a pruned block?",
      "created_at" : "2018-02-20T14:50:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-367001197",
      "id" : 367001197,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2018-02-20T14:50:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367001197",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This is dmarcus Eason and we need to talk about this because Daniel have it\nright and I need it fast\n\nOn Feb 20, 2018 08:51, \"Sjors Provoost\" <notifications@github.com> wrote:\n\n> Though I'm not sure what it would do on its own, perhaps the\n> PriorityBlockRequest could be a separate PR?\n>\n> Same for requestblocks RPC; could that be useful in pruned nodes to\n> retrieve a pruned block?\n>\n> \n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-367001197>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/Ai9_b5He-pOevv4ILEYCDQqRhqi_MHKSks5tWtwAgaJpZM4OUX1v>\n> .\n>\n",
      "created_at" : "2018-02-20T14:57:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-367003642",
      "id" : 367003642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2018-02-20T14:57:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367003642",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/36667247?v=4",
         "events_url" : "https://api.github.com/users/dmoney0546/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dmoney0546/followers",
         "following_url" : "https://api.github.com/users/dmoney0546/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dmoney0546/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dmoney0546",
         "id" : 36667247,
         "login" : "dmoney0546",
         "organizations_url" : "https://api.github.com/users/dmoney0546/orgs",
         "received_events_url" : "https://api.github.com/users/dmoney0546/received_events",
         "repos_url" : "https://api.github.com/users/dmoney0546/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dmoney0546/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dmoney0546/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dmoney0546"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-04-18T08:15:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-382303773",
      "id" : 382303773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2018-04-18T08:15:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382303773",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I rebased it here: https://github.com/Sjors/bitcoin/commits/2018/08/spv-rpc (I may have broken the functional test)\r\n\r\n@ryanofsky said:\r\n> I still can't figure out if new RPC is actually supposed to be useful for something other than debugging/testing\r\n\r\nThe bigger picture for me is #9483, the ability for users to get started while IBD happens in the background.\r\n\r\nHowever, a use case I have in mind for `requestblocks add` is https://github.com/ElementsProject/lightning/issues/1297, in particular the ability for a lightning client to re-download historic blocks from a pruned node. This actually works now. Do they get pruned again at some point?\r\n\r\n`-autorequestblocks` is useful when running on a phone (iOs: #11720, Android: [ABCore](https://github.com/greenaddress/abcore)). A native application could use the RPC and only allow fetching blocks when on wifi. Being able to toggle automatic download via RPC would be nice, but can wait.\r\n\r\nBeing able to fetch blocks by height range (or up to a certain height) instead of hashes would be nice, but that's something that can be built on top of this.\r\n\r\nI noticed there's no log entry when you `requestblocks add`.\r\n\r\nCan you explain when `priorityRequest` is `true`?\r\n\r\nDid some light testing and couldn't find problems, but more people should try :-)",
      "created_at" : "2018-08-02T18:55:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-410031973",
      "id" : 410031973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDAzMTk3Mw==",
      "updated_at" : "2018-08-02T19:04:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410031973",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r207338739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207338739"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe do a prune here and then refetch the old block?",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2018-08-02T19:01:28Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+\n+class RequestBlockRequestTest (BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [[], ['-autorequestblocks=0']]\n+\n+    def run_test(self):\n+        self.nodes[0].generate(50)\n+        timeout = 20\n+        ctps = self.nodes[1].getchaintips()\n+        while timeout > 0:\n+            ctps = self.nodes[1].getchaintips()\n+            headerHeightReached = False\n+            for ct in ctps:\n+                if ct['status'] == \"headers-only\":\n+                    if ct['height'] == 50:\n+                        headerHeightReached = True\n+                if ct['status'] == \"active\":\n+                    assert(ct['height'] == 0)\n+            time.sleep(1)\n+            timeout-=1\n+            if headerHeightReached == True:\n+                break\n+        assert(timeout>0)\n+\n+        node0bbhash = self.nodes[0].getbestblockhash()\n+        # best block should not be validated, header must be available\n+        bh = self.nodes[1].getblockheader(node0bbhash, True)\n+\n+        assert_equal(bh['validated'], False)\n+        # block must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, node0bbhash)\n+\n+        # request best block (auxiliary)\n+        self.nodes[1].requestblocks(\"add\", [node0bbhash])\n+        timeout = 20\n+        while timeout > 0:\n+            if self.nodes[1].requestblocks(\"status\")['count'] == 0:\n+                break\n+            time.sleep(1)\n+            timeout-=1\n+        assert(timeout>0)\n+\n+        # block must now be available\n+        block = self.nodes[1].getblock(node0bbhash, True)\n+        assert_equal(block['hash'], node0bbhash)\n+        assert_equal(block['validated'], False)\n+\n+        #prevblock must not be available\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[1].getblock, block['previousblockhash'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r207338739",
      "id" : 207338739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzMzODczOQ==",
      "original_commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "original_position" : 59,
      "path" : "test/functional/rpc_requestblocks.py",
      "position" : 59,
      "pull_request_review_id" : 142932591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-08-02T19:01:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207338739",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r214549039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549039"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Typo found by `codespell`: Unkown",
      "commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "created_at" : "2018-09-02T18:26:42Z",
      "diff_hunk" : "@@ -1626,6 +1630,60 @@ UniValue savemempool(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 2)\n+        throw std::runtime_error(\n+            \"requestblocks ( add | flush | status ) ( [\\\"hash_0\\\", \\\"hash_1\\\", ...] )\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: {\\\"count\\\": \\\"<amount of blocks in the queue>\\\"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\") {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\") {\n+        UniValue ret(UniValue::VOBJ);\n+        ret.push_back(Pair(\"count\", (uint64_t)CountPriorityDownloads()));\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\") {\n+        if (request.params[1].isNull()) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        }\n+        std::vector<const CBlockIndex*> blocksToDownload;\n+        {\n+            LOCK(cs_main); //mapBlockIndex\n+            for (const UniValue& strHashU : request.params[1].get_array().getValues()) {\n+                uint256 hash(uint256S(strHashU.get_str()));\n+                BlockMap::const_iterator mi = mapBlockIndex.find(hash);\n+                if (mi == mapBlockIndex.end()) {\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n+                }\n+                blocksToDownload.push_back(mi->second);\n+            }\n+        }\n+\n+        AddPriorityDownload(blocksToDownload);\n+        return NullUniValue;\n+    }\n+    else {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Unkown action\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r214549039",
      "id" : 214549039,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDU0OTAzOQ==",
      "original_commit_id" : "77561f7a4b500d0752d64ce931ce1dd613f7ab0d",
      "original_position" : 86,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 86,
      "pull_request_review_id" : 151629144,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2018-09-02T18:26:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549039",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
