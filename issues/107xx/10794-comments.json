[
   {
      "body" : "Contains overhauled parts from #9483",
      "created_at" : "2017-07-11T15:02:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314473310",
      "id" : 314473310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T15:02:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314473310",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "cheers",
      "created_at" : "2017-07-11T15:04:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314473958",
      "id" : 314473958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T15:04:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314473958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/15623546?v=3",
         "events_url" : "https://api.github.com/users/MIGUELWAXX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MIGUELWAXX/followers",
         "following_url" : "https://api.github.com/users/MIGUELWAXX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MIGUELWAXX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MIGUELWAXX",
         "id" : 15623546,
         "login" : "MIGUELWAXX",
         "organizations_url" : "https://api.github.com/users/MIGUELWAXX/orgs",
         "received_events_url" : "https://api.github.com/users/MIGUELWAXX/received_events",
         "repos_url" : "https://api.github.com/users/MIGUELWAXX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MIGUELWAXX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MIGUELWAXX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MIGUELWAXX"
      }
   },
   {
      "body" : "I'd like to help out here, and I've spent literally days reviewing previous iterations of this change (#9076 #9483 #9171), but I can't figure out if this is going anywhere and if providing more review now is a good use of time.\r\n\r\nAs I've mentioned previously, I don't think the auxiliary block download class design is great, because it duplicates functionality from the networking layer in a wholly different part of the code, and gives the wallet too much control & responsibility over low level p2p details in the case where it's used to let the wallet code prioritize which blocks to download. I've tried to describe what I think would be better alternatives in my previous review comments, like https://github.com/bitcoin/bitcoin/pull/9483#issuecomment-278799990.\r\n\r\n@jonasschnelli, assuming you don't want to take my previous suggestions, and do want to stick with the current design, I think it would be helpful if you could reach out to some other reviewers and get some concept acks for your current approach. It might help to put together some kind of design document, or at least a detailed comment to the top of `auxiliaryblockrequest.h` that lays out how the class works and what your future plans for it are in as much detail as possible, so someone can understand how it's intended to be used without having to wade through all the PRs.",
      "created_at" : "2017-07-11T17:03:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314508746",
      "id" : 314508746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T17:03:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314508746",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "cheers",
      "created_at" : "2017-07-11T17:31:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314516392",
      "id" : 314516392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T17:31:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314516392",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/15623546?v=3",
         "events_url" : "https://api.github.com/users/MIGUELWAXX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MIGUELWAXX/followers",
         "following_url" : "https://api.github.com/users/MIGUELWAXX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MIGUELWAXX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MIGUELWAXX",
         "id" : 15623546,
         "login" : "MIGUELWAXX",
         "organizations_url" : "https://api.github.com/users/MIGUELWAXX/orgs",
         "received_events_url" : "https://api.github.com/users/MIGUELWAXX/received_events",
         "repos_url" : "https://api.github.com/users/MIGUELWAXX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MIGUELWAXX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MIGUELWAXX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MIGUELWAXX"
      }
   },
   {
      "body" : "@ryanofsky:\r\nThank you very much for the reviews in #9483. I implemented almost all of your suggesting and some of them where really great.\r\nHowever, I think the current design of having a dedicated class (`CauxiliaryBlockRequest`) makes sense, because...\r\n\r\n* An out-of-band (auxiliary) block request in an object, you could have multiple in parallel (assume multiwallet, etc.), in future, we may want to serialise them to disk, etc. Therefore I think it should be capsulated in its own class.\r\n\r\n* I think the wallet needs control. For a light-client mode, the wallet is the one that tells the node what it needs. More or less, wallet tells node: \"I need block A to E, give them to me as fast as possible\", then node may call back \"I have block A already ready (on disk), rest will follow soon\", etc. Wallet then may say: \"Okay, thats enough, you can stop at B already\", etc.\r\n\r\n* Having the implementation in a designated file makes code overview simpler. It can result in having slightly more lines of code but it should worth it. Having another `main.cpp` for everything that is network related should be avoided now, early enough. I don't think we have a lot of duplicated code, or can you point out what would be more compact if we would implement it directly in `net_processing.cpp`?\r\n\r\n* Last but not least, it allows to have a patch-set the requires less rebasing. And this is an important one to me. Eventually, this will be something that \"runs along\" with the master branch until there has been reasonable amount of testing before it gets eventually merged.",
      "created_at" : "2017-07-11T18:36:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314534086",
      "id" : 314534086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-11T18:36:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314534086",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Followed yesterdays discussion we had in #bitcoin-core-dev. Removed the `CAuxiliaryBlockRequests` and added a `std::map blocksToDownloadFirst`.\r\nSuch manually added, priority block downloads will not trigger `ActivateBestChain`.\r\n\r\nThis PR now also adds a new signal `BlockProcessed()`.\r\n\r\nThe scope of this PR is not to make the block download interface flexible for multiple \"users\" (like the validation and eventually the light-client wallet).",
      "created_at" : "2017-07-12T15:47:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-314811848",
      "id" : 314811848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-12T15:47:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314811848",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "fixed @ryanofsky points.\r\nThis does pass travis now. Thanks in advance for reviews...",
      "created_at" : "2017-07-20T18:11:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-316785986",
      "id" : 316785986,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-20T18:11:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316785986",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Thanks @ryanofsky. Agree about required conceptual ACKs from other devs.\r\nThe long term goal was sketched in #9483, basically a light client mode for Bitcoin-Core that would allow node/wallet separation.",
      "created_at" : "2017-07-20T19:58:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-316813092",
      "id" : 316813092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-20T19:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316813092",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129047410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129047410"
         }
      },
      "body" : "In commit \"Add priority block request queue\"\r\n\r\nShould update comment for new return value",
      "commit_id" : "1794a11037150b0d2c6ba2eb9f06e310f51f7c1c",
      "created_at" : "2017-07-24T14:16:00Z",
      "diff_hunk" : "@@ -311,7 +314,11 @@ void FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n // Requires cs_main.\n // Returns a bool indicating whether we requested this block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129047410",
      "id" : 129047410,
      "original_commit_id" : "b02b237a0000806dc1e459a4e8e2fce9bbbf4272",
      "original_position" : 19,
      "path" : "src/net_processing.cpp",
      "position" : 28,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2017-07-24T15:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129047410",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129049059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129049059"
         }
      },
      "body" : "In commit \"Add priority block request queue\"\r\n\r\nCould be const auto",
      "commit_id" : "1794a11037150b0d2c6ba2eb9f06e310f51f7c1c",
      "created_at" : "2017-07-24T14:21:28Z",
      "diff_hunk" : "@@ -466,9 +478,18 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<con\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n+    if (!blocksToDownloadFirst.empty()) {\n+        for (auto& kv : blocksToDownloadFirst) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129049059",
      "id" : 129049059,
      "original_commit_id" : "b02b237a0000806dc1e459a4e8e2fce9bbbf4272",
      "original_position" : 86,
      "path" : "src/net_processing.cpp",
      "position" : 95,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2017-07-24T15:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129049059",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129052414"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129052414"
         }
      },
      "body" : "In commit \"Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nMaybe drop part of comment in parentheses, seems to imply value will be true for priority block requests. ",
      "commit_id" : "1794a11037150b0d2c6ba2eb9f06e310f51f7c1c",
      "created_at" : "2017-07-24T14:32:37Z",
      "diff_hunk" : "@@ -640,6 +644,7 @@ UniValue getblockheader(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"hash\\\" : \\\"hash\\\",     (string) the block hash (same as provided)\\n\"\n             \"  \\\"confirmations\\\" : n,   (numeric) The number of confirmations, or -1 if the block is not on the main chain\\n\"\n+            \"  \\\"validated\\\" : n,       (boolean) True if the block has been validated (for priority block requests)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129052414",
      "id" : 129052414,
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 29,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 29,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2017-07-24T15:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129052414",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129053764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129053764"
         }
      },
      "body" : "In commit \"[RPC] Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nCopy is redundant, get_array just returns reference to *this.",
      "commit_id" : "1794a11037150b0d2c6ba2eb9f06e310f51f7c1c",
      "created_at" : "2017-07-24T14:36:42Z",
      "diff_hunk" : "@@ -1532,6 +1537,69 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n     return ret;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: [\\\"<blockhash in queue>\\\", \\\"<blockhash in queue>\\\" ...]\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\")\n+    {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\")\n+    {\n+        UniValue ret(UniValue::VARR);\n+        std::map<uint256, const CBlockIndex*> prioBlocks = GetPriorityDownloads();\n+        for(auto& kv: prioBlocks) {\n+            ret.push_back(kv.first.ToString());\n+        }\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\")\n+    {\n+        if (request.params.size() < 2)\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        UniValue hash_Uarray = request.params[1].get_array();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129053764",
      "id" : 129053764,
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 75,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 75,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2017-07-24T15:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129053764",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054094"
         }
      },
      "body" : "In commit \"[RPC] Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nCan never happen, get_array call above would have thrown if the hash_Uarray / params[1] value was not an array",
      "commit_id" : "1794a11037150b0d2c6ba2eb9f06e310f51f7c1c",
      "created_at" : "2017-07-24T14:37:45Z",
      "diff_hunk" : "@@ -1532,6 +1537,69 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n     return ret;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: [\\\"<blockhash in queue>\\\", \\\"<blockhash in queue>\\\" ...]\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\")\n+    {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\")\n+    {\n+        UniValue ret(UniValue::VARR);\n+        std::map<uint256, const CBlockIndex*> prioBlocks = GetPriorityDownloads();\n+        for(auto& kv: prioBlocks) {\n+            ret.push_back(kv.first.ToString());\n+        }\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\")\n+    {\n+        if (request.params.size() < 2)\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        UniValue hash_Uarray = request.params[1].get_array();\n+        if (!hash_Uarray.isArray())\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Second parameter must be an array\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054094",
      "id" : 129054094,
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 77,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 77,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2017-07-24T15:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054094",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054305"
         }
      },
      "body" : "In commit \"[RPC] Add requestblocks - a simple way to priorize block downloads\"\r\n\r\nProbably should write mi->second",
      "commit_id" : "1794a11037150b0d2c6ba2eb9f06e310f51f7c1c",
      "created_at" : "2017-07-24T14:38:28Z",
      "diff_hunk" : "@@ -1532,6 +1537,69 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n     return ret;\n }\n \n+UniValue requestblocks(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n+        throw std::runtime_error(\n+            \"requestblocks (add|flush|status) ([\\\"hash_0\\\", \\\"hash_1\\\", ...])\\n\"\n+            \"\\nPriorize blocks downloads.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. action            (string, required) the action to execute\\n\"\n+            \"                                        add  = add new blocks to the priority download\\n\"\n+            \"                                        flush = flush the queue (blocks in-flight will still be downloaded)\\n\"\n+            \"                                        status = get info about the queue\\n\"\n+            \"2. blockhashes       (array, optional) the hashes of the blocks to download\\n\"\n+            \"\\nResult:\\n\"\n+            \"   add: <null>\\n\"\n+            \"   flush: <true|false> (if the the queue wasn't empty)\\n\"\n+            \"   status: [\\\"<blockhash in queue>\\\", \\\"<blockhash in queue>\\\" ...]\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            + HelpExampleRpc(\"requestblocks\", \"add, \\\"'[\\\"<blockhash>\\\"]'\\\"\")\n+            );\n+\n+    if (request.params[0].get_str() == \"flush\")\n+    {\n+        return UniValue(FlushPriorityDownloads());\n+    }\n+    else if (request.params[0].get_str() == \"status\")\n+    {\n+        UniValue ret(UniValue::VARR);\n+        std::map<uint256, const CBlockIndex*> prioBlocks = GetPriorityDownloads();\n+        for(auto& kv: prioBlocks) {\n+            ret.push_back(kv.first.ToString());\n+        }\n+        return ret;\n+    }\n+    else if (request.params[0].get_str() == \"add\")\n+    {\n+        if (request.params.size() < 2)\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Missing blocks array\");\n+        UniValue hash_Uarray = request.params[1].get_array();\n+        if (!hash_Uarray.isArray())\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Second parameter must be an array\");\n+\n+        std::vector<const CBlockIndex*> blocksToDownload;\n+        {\n+            LOCK(cs_main); //mapBlockIndex\n+            for (const UniValue& strHashU : hash_Uarray.getValues())\n+            {\n+                uint256 hash(uint256S(strHashU.get_str()));\n+                BlockMap::iterator mi = mapBlockIndex.find(hash);\n+                if (mi == mapBlockIndex.end())\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n+                blocksToDownload.push_back((*mi).second);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#discussion_r129054305",
      "id" : 129054305,
      "original_commit_id" : "701014215f6ab579723ff274dde73c115dc67e20",
      "original_position" : 88,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 88,
      "pull_request_review_id" : 51781600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10794",
      "updated_at" : "2017-07-24T15:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/129054305",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Overhauled and fixed @ryanofsky points (mostly nits), also removed the new (unused) signal.",
      "created_at" : "2017-07-25T08:50:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10794#issuecomment-317672618",
      "id" : 317672618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10794",
      "updated_at" : "2017-07-25T08:50:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317672618",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
