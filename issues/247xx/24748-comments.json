[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/24748).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1091152739), [brunoerg](https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1092829016), [mzumsande](https://github.com/bitcoin/bitcoin/pull/24748#pullrequestreview-1663408774) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28632](https://github.com/bitcoin/bitcoin/pull/28632) (test: make python p2p not send getaddr on incoming connections by mzumsande)\n* [#28538](https://github.com/bitcoin/bitcoin/pull/28538) (p2p: attempt to fill full outbound connection slots with peers that support tx relay by mzumsande)\n* [#28463](https://github.com/bitcoin/bitcoin/pull/28463) (p2p: Increase inbound capacity for block-relay only connections by mzumsande)\n* [#26728](https://github.com/bitcoin/bitcoin/pull/26728) (wallet: Have the wallet store the key for automatically generated descriptors by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#22341](https://github.com/bitcoin/bitcoin/pull/22341) (rpc: add getxpub by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-04-05T01:31:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1088181500",
      "id" : 1088181500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585A3FT8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088181500/reactions"
      },
      "updated_at" : "2023-10-29T17:10:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088181500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-04-07T07:03:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1091152739",
      "id" : 1091152739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585BCatj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091152739/reactions"
      },
      "updated_at" : "2022-04-07T07:03:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091152739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-04-08T12:54:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1092829016",
      "id" : 1092829016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585BIz9Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1092829016/reactions"
      },
      "updated_at" : "2022-04-08T12:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1092829016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-08T14:33:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1092927324",
      "id" : 1092927324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585BJL9c",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1092927324/reactions"
      },
      "updated_at" : "2022-04-08T14:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1092927324",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "converting this PR into a draft. I'll push the updated version which includes the new spec changes in BIP 324 soon.",
      "created_at" : "2022-10-03T17:24:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1265788740",
      "id" : 1265788740,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585LcmdE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265788740/reactions"
      },
      "updated_at" : "2022-10-03T17:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265788740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've updated the PR to reflect the new spec changes in the BIP. It's built on top of #24545's 78c3ccc. Only the last 19 commits belong to this PR.\r\n\r\nUPDATE:\r\n- rebased on  #24545's f97a1a8\r\n- rebased on #24545's  a7fdbf6",
      "created_at" : "2022-12-16T16:09:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1355151959",
      "id" : 1355151959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585QxfpX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1355151959/reactions"
      },
      "updated_at" : "2023-02-21T21:06:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1355151959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-12-19T09:35:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1357360284",
      "id" : 1357360284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585Q56yc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1357360284/reactions"
      },
      "updated_at" : "2022-12-19T09:35:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1357360284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-15T15:50:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1431585008",
      "id" : 1431585008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585VVEDw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431585008/reactions"
      },
      "updated_at" : "2023-02-15T15:50:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431585008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Moved to draft given it's based on multiple other PRs.",
      "created_at" : "2023-02-16T15:22:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1433257883",
      "id" : 1433257883,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585Vbceb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1433257883/reactions"
      },
      "updated_at" : "2023-02-16T15:22:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1433257883",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-22T18:47:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1440611717",
      "id" : 1440611717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585V3f2F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1440611717/reactions"
      },
      "updated_at" : "2023-02-22T18:47:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1440611717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2023-07-02T01:11:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1616250559",
      "id" : 1616250559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585gVga_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1616250559/reactions"
      },
      "updated_at" : "2023-07-02T01:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1616250559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@stratospher Rebasing on #28331 would let you revive this.",
      "created_at" : "2023-08-01T18:07:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1660838322",
      "id" : 1660838322,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585i_mGy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660838322/reactions"
      },
      "updated_at" : "2023-08-29T21:12:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660838322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on #28331. 2 things which affected the tests when rebasing were:\r\n1. `TestNode` can send garbage now\r\n2. since v1 reconnections are now attempted in a queue instead of immediately, there was a latency issue introduced in the tests in `add_outbound_p2p_connection()`",
      "created_at" : "2023-09-10T06:04:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1712724420",
      "id" : 1712724420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585mFhnE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1712724420/reactions"
      },
      "updated_at" : "2023-09-10T06:04:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1712724420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1320700971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320700971"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "e18b22d: in an outbound connection, `TestNode` -----> `P2PConnection` where `P2PConnection` doesn't actually support v2 P2P but is advertised to support v2 P2P (false advertisement), we need to wait for the `TestNode` to reconnect using v1 P2P.\r\n\r\nThis `wait_for_reconnect()` function won't work always since race conditions are possible. Anyone has a better idea on how this can be done? ",
      "commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "created_at" : "2023-09-10T06:13:21Z",
      "diff_hunk" : "@@ -598,6 +598,11 @@ def wait_for_disconnect(self, timeout=60):\n         test_function = lambda: not self.is_connected\n         self.wait_until(test_function, timeout=timeout, check_connected=False)\n \n+    def wait_for_reconnect(self, timeout=60):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1320700971",
      "id" : 1320700971,
      "line" : 601,
      "node_id" : "PRRC_kwDOABII585OuEwr",
      "original_commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "original_line" : 601,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 4,
      "pull_request_review_id" : 1618745079,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320700971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-10T06:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320700971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1320788959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320788959"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is the race condition? I expect you should always still observe a v2 connection, a v2 disconnect, and a v1 connect.\r\n\r\nFWIW, the reason why the reconnect is done asynchronously is to avoid making a P2P connection (which can take seconds, or up to a minute) inside the normal network thread (as that'd prevent us from receiving anything from any other peer at the same time).",
      "commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "created_at" : "2023-09-10T15:26:39Z",
      "diff_hunk" : "@@ -598,6 +598,11 @@ def wait_for_disconnect(self, timeout=60):\n         test_function = lambda: not self.is_connected\n         self.wait_until(test_function, timeout=timeout, check_connected=False)\n \n+    def wait_for_reconnect(self, timeout=60):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1320788959",
      "id" : 1320788959,
      "in_reply_to_id" : 1320700971,
      "line" : 601,
      "node_id" : "PRRC_kwDOABII585OuaPf",
      "original_commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "original_line" : 601,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 4,
      "pull_request_review_id" : 1618844751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320788959/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-10T15:26:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320788959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1320795432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320795432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ideally, first `wait_for_connect` waits on v2 connection and the `wait_for_connect` a few lines below waits for v1 connection.\r\n\r\nit's possible that the v2 reconnection happens quickly and the first `wait_for_connect` detects a v2 connection directly. Then we'd be stuck waiting for disconnect and connect (in the lines below) to happen (even though it has already happened).",
      "commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "created_at" : "2023-09-10T16:13:14Z",
      "diff_hunk" : "@@ -598,6 +598,11 @@ def wait_for_disconnect(self, timeout=60):\n         test_function = lambda: not self.is_connected\n         self.wait_until(test_function, timeout=timeout, check_connected=False)\n \n+    def wait_for_reconnect(self, timeout=60):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1320795432",
      "id" : 1320795432,
      "in_reply_to_id" : 1320700971,
      "line" : 601,
      "node_id" : "PRRC_kwDOABII585Oub0o",
      "original_commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "original_line" : 601,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 4,
      "pull_request_review_id" : 1618850256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320795432/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-10T16:13:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320795432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-11T09:31:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1713517605",
      "id" : 1713517605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585mIjQl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1713517605/reactions"
      },
      "updated_at" : "2023-09-11T09:31:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1713517605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-21T10:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1729335625",
      "id" : 1729335625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585nE5FJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729335625/reactions"
      },
      "updated_at" : "2023-09-21T10:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729335625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1349750146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349750146"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updating the address is no longer necessary with the latest `net` code, just passing the bool should be enough.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-08T17:29:06Z",
      "diff_hunk" : "@@ -1913,7 +1913,11 @@ bool CConnman::AddConnection(const std::string& address, ConnectionType conn_typ\n     CSemaphoreGrant grant(*semOutbound, true);\n     if (!grant) return false;\n \n-    OpenNetworkConnection(CAddress(), false, std::move(grant), address.c_str(), conn_type, /*use_v2transport=*/false);\n+    CAddress addr(CService(), NODE_NONE);\n+    if (use_v2transport) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1349750146",
      "id" : 1349750146,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Qc42C",
      "original_commit_id" : "4084fe0c4c95aa4385e91512291ea756cec73c71",
      "original_line" : 1917,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1663408774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349750146/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-09T04:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349750146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1349828896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349828896"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Here, and in `respond_v2_handshake`: This should probably be something like\r\n\r\n```\r\ndef initiate_v2_handshake(self, garbage_len=None):\r\n    if garbage_len is None:\r\n        garbage_len = random.randrange(4096)\r\n```\r\nBecause default args are determined when the function is defined (and not when it's called), otherwise \r\n1) the provided `--randomseed` isn't used, making runs non-deterministic.\r\n2) multiple calls to `initiate_v2_handshake` within one program run will all use the same `garbage_len`.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-09T02:50:41Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1349828896",
      "id" : 1349828896,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QdMEg",
      "original_commit_id" : "a7478eab51c156519885673aff9efeaa95504bd3",
      "original_line" : 101,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : null,
      "pull_request_review_id" : 1663408774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349828896/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-09T04:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349828896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1349847429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349847429"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe it would work just not checking for the racy intermediate states, but instead waiting until we have received the \"version\" message via v1? Something like\r\n\r\n ```\r\ndef test_function():\r\n     if not (self.is_connected and self.last_message.get('version') and self.v2_state is None):\r\n         return False\r\n     return True\r\nself.wait_until(test_function, timeout=timeout, check_connected=False  )\r\n```",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-09T04:05:43Z",
      "diff_hunk" : "@@ -598,6 +598,11 @@ def wait_for_disconnect(self, timeout=60):\n         test_function = lambda: not self.is_connected\n         self.wait_until(test_function, timeout=timeout, check_connected=False)\n \n+    def wait_for_reconnect(self, timeout=60):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1349847429",
      "id" : 1349847429,
      "in_reply_to_id" : 1320700971,
      "line" : 601,
      "node_id" : "PRRC_kwDOABII585QdQmF",
      "original_commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "original_line" : 601,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 302,
      "pull_request_review_id" : 1663408774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349847429/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-09T04:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349847429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350368094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350368094"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks! done.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-09T14:15:20Z",
      "diff_hunk" : "@@ -1913,7 +1913,11 @@ bool CConnman::AddConnection(const std::string& address, ConnectionType conn_typ\n     CSemaphoreGrant grant(*semOutbound, true);\n     if (!grant) return false;\n \n-    OpenNetworkConnection(CAddress(), false, std::move(grant), address.c_str(), conn_type, /*use_v2transport=*/false);\n+    CAddress addr(CService(), NODE_NONE);\n+    if (use_v2transport) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350368094",
      "id" : 1350368094,
      "in_reply_to_id" : 1349750146,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QfPte",
      "original_commit_id" : "4084fe0c4c95aa4385e91512291ea756cec73c71",
      "original_line" : 1917,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1664551055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350368094/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-09T14:15:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350368094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350368582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350368582"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "interesting, done. i've removed `garbage_len` from the function parameter list since the call sites wouldn't need to set `garbage_len` value.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-09T14:15:46Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350368582",
      "id" : 1350368582,
      "in_reply_to_id" : 1349828896,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QfP1G",
      "original_commit_id" : "a7478eab51c156519885673aff9efeaa95504bd3",
      "original_line" : 101,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : null,
      "pull_request_review_id" : 1664551886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350368582/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-09T14:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350368582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350370031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350370031"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good idea! that should work.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-09T14:17:00Z",
      "diff_hunk" : "@@ -598,6 +598,11 @@ def wait_for_disconnect(self, timeout=60):\n         test_function = lambda: not self.is_connected\n         self.wait_until(test_function, timeout=timeout, check_connected=False)\n \n+    def wait_for_reconnect(self, timeout=60):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350370031",
      "id" : 1350370031,
      "in_reply_to_id" : 1320700971,
      "line" : 601,
      "node_id" : "PRRC_kwDOABII585QfQLv",
      "original_commit_id" : "e18b22d34e5b2c56c2ca7717ce15158b3d519a41",
      "original_line" : 601,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 302,
      "pull_request_review_id" : 1664554329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350370031/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-09T14:17:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350370031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350924659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350924659"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that all the decoy packets should pass `ignore=True` as an arg to `v2_enc_packet`.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-09T22:40:31Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):\n+        \"\"\"Initiator begins the v2 handshake by sending its ellswift bytes and garbage\"\"\"\n+        self.privkey_ours, self.ellswift_ours = ellswift_create()\n+        self.sent_garbage = os.urandom(garbage_len)\n+        logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+        return self.ellswift_ours + self.sent_garbage\n+\n+    def respond_v2_handshake(self, response, garbage_len=random.randrange(4096)):\n+        \"\"\"Responder begins the v2 handshake by sending its ellswift bytes and garbage. However, the responder\n+        sends this after having received at least one byte that mismatches 16-byte V1_PREFIX.\"\"\"\n+        while len(self.received_prefix) < 16:\n+            byte = response.read(1)\n+            # return b\"\" if we need to receive more bytes\n+            if not byte:\n+                return b\"\"\n+            self.received_prefix += byte\n+            if self.received_prefix[-1] != V1_PREFIX[len(self.received_prefix) - 1]:\n+                self.privkey_ours, self.ellswift_ours = ellswift_create()\n+                self.sent_garbage = os.urandom(garbage_len)\n+                logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+                return self.ellswift_ours + self.sent_garbage\n+        # return -1 to decide v1 only after all 16 bytes processed\n+        return -1\n+\n+    def complete_handshake(self, response):\n+        \"\"\" Instantiates the encrypted transport and\n+        sends garbage terminator + optional decoy packets + transport version packet.\n+        Done by both initiator and responder.\"\"\"\n+        received_prefix = b'' if self.initiating else self.received_prefix\n+        ellswift_theirs = received_prefix + response.read(64 - len(received_prefix))\n+        ecdh_secret = self.v2_ecdh(self.privkey_ours, ellswift_theirs, self.ellswift_ours, self.initiating)\n+        self.initialize_v2_transport(ecdh_secret)\n+        # Send garbage terminator\n+        msg_to_send = self.peer['send_garbage_terminator']\n+        # Optionally send decoy packets after garbage terminator.\n+        aad = self.sent_garbage\n+        for decoy_content_len in [random.randint(1, 100) for _ in range(10)]:\n+            msg_to_send += self.v2_enc_packet(decoy_content_len * b'\\x00', aad=aad)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1350924659",
      "id" : 1350924659,
      "line" : 140,
      "node_id" : "PRRC_kwDOABII585QhXlz",
      "original_commit_id" : "5f851714cf5fa7a31bb423c20035f7b44deed25d",
      "original_line" : 138,
      "original_position" : 133,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : 140,
      "pull_request_review_id" : 1665480038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350924659/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T22:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350924659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353141062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353141062"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd prefer to explain what it actually does - (attempt to) connect using the v2 transport protocol.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-10T18:46:50Z",
      "diff_hunk" : "@@ -1209,13 +1209,14 @@ class CConnman\n      * @param[in]   address     Address of node to try connecting to\n      * @param[in]   conn_type   ConnectionType::OUTBOUND, ConnectionType::BLOCK_RELAY,\n      *                          ConnectionType::ADDR_FETCH or ConnectionType::FEELER\n+     * @param[in]   use_v2transport  Set to true if node supports BIP324 v2 transport protocol",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353141062",
      "id" : 1353141062,
      "line" : 1212,
      "node_id" : "PRRC_kwDOABII585Qp0tG",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 1212,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 4,
      "pull_request_review_id" : 1665480038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353141062/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T22:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353141062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353143252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353143252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "same here: connect with v2 transport protocol; we might choose to not pass `v2transport=True` with this rpc even if the node supports v2 transport.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-10T18:47:26Z",
      "diff_hunk" : "@@ -357,6 +357,7 @@ static RPCHelpMan addconnection()\n         {\n             {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The IP address and port to attempt connecting to.\"},\n             {\"connection_type\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Type of connection to open (\\\"outbound-full-relay\\\", \\\"block-relay-only\\\", \\\"addr-fetch\\\" or \\\"feeler\\\").\"},\n+            {\"v2transport\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Node supports BIP324 v2 transport protocol\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353143252",
      "id" : 1353143252,
      "line" : 360,
      "node_id" : "PRRC_kwDOABII585Qp1PU",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 360,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 1665480038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353143252/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T22:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353143252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353156113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353156113"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "could return an error if `-v2transport` for the node is not enabled but `use_v2transport` is chosen (similar to the way it's done in `addnode`).",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-10T18:50:31Z",
      "diff_hunk" : "@@ -388,11 +389,12 @@ static RPCHelpMan addconnection()\n     } else {\n         throw JSONRPCError(RPC_INVALID_PARAMETER, self.ToString());\n     }\n+    bool use_v2transport = !request.params[2].isNull() && request.params[2].get_bool();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353156113",
      "id" : 1353156113,
      "line" : 392,
      "node_id" : "PRRC_kwDOABII585Qp4YR",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 392,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 1665480038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353156113/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T22:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353156113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353183494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353183494"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "9810e96c74380a3087b2b576508581380019872f:\r\nCommit message needs an update (remove the service bit flags part)",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-10T18:59:49Z",
      "diff_hunk" : "@@ -1880,7 +1880,7 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\n     RandAddEvent((uint32_t)id);\n }\n \n-bool CConnman::AddConnection(const std::string& address, ConnectionType conn_type)\n+bool CConnman::AddConnection(const std::string& address, ConnectionType conn_type, bool use_v2transport = false)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353183494",
      "id" : 1353183494,
      "line" : 1883,
      "node_id" : "PRRC_kwDOABII585Qp_EG",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 1883,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1665480038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353183494/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T22:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353183494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353263820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353263820"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! The fix made it into the wrong commit (should be in \"Construct class to handle v2 P2P protocol functions\", it's one commit later).",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-10T20:03:42Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353263820",
      "id" : 1353263820,
      "in_reply_to_id" : 1349828896,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QqSrM",
      "original_commit_id" : "a7478eab51c156519885673aff9efeaa95504bd3",
      "original_line" : 101,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : null,
      "pull_request_review_id" : 1665480038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353263820/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T22:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353263820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353384798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353384798"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: this function doesn't return anything, it sets the `peer` class member.",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-10T20:56:28Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):\n+        \"\"\"Initiator begins the v2 handshake by sending its ellswift bytes and garbage\"\"\"\n+        self.privkey_ours, self.ellswift_ours = ellswift_create()\n+        self.sent_garbage = os.urandom(garbage_len)\n+        logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+        return self.ellswift_ours + self.sent_garbage\n+\n+    def respond_v2_handshake(self, response, garbage_len=random.randrange(4096)):\n+        \"\"\"Responder begins the v2 handshake by sending its ellswift bytes and garbage. However, the responder\n+        sends this after having received at least one byte that mismatches 16-byte V1_PREFIX.\"\"\"\n+        while len(self.received_prefix) < 16:\n+            byte = response.read(1)\n+            # return b\"\" if we need to receive more bytes\n+            if not byte:\n+                return b\"\"\n+            self.received_prefix += byte\n+            if self.received_prefix[-1] != V1_PREFIX[len(self.received_prefix) - 1]:\n+                self.privkey_ours, self.ellswift_ours = ellswift_create()\n+                self.sent_garbage = os.urandom(garbage_len)\n+                logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+                return self.ellswift_ours + self.sent_garbage\n+        # return -1 to decide v1 only after all 16 bytes processed\n+        return -1\n+\n+    def complete_handshake(self, response):\n+        \"\"\" Instantiates the encrypted transport and\n+        sends garbage terminator + optional decoy packets + transport version packet.\n+        Done by both initiator and responder.\"\"\"\n+        received_prefix = b'' if self.initiating else self.received_prefix\n+        ellswift_theirs = received_prefix + response.read(64 - len(received_prefix))\n+        ecdh_secret = self.v2_ecdh(self.privkey_ours, ellswift_theirs, self.ellswift_ours, self.initiating)\n+        self.initialize_v2_transport(ecdh_secret)\n+        # Send garbage terminator\n+        msg_to_send = self.peer['send_garbage_terminator']\n+        # Optionally send decoy packets after garbage terminator.\n+        aad = self.sent_garbage\n+        for decoy_content_len in [random.randint(1, 100) for _ in range(10)]:\n+            msg_to_send += self.v2_enc_packet(decoy_content_len * b'\\x00', aad=aad)\n+            aad = b''\n+        # Send version packet.\n+        msg_to_send += self.v2_enc_packet(TRANSPORT_VERSION, aad=aad)\n+        return msg_to_send\n+\n+    def authenticate_handshake(self, response):\n+        \"\"\" Ensures that the received optional decoy packets and transport version packet are authenticated.\n+        Marks the v2 handshake as complete. Done by both initiator and responder.\n+        Returns:\n+            1. length of bytes that were processed so that recvbuf can be updated\n+            2. True if the authentication was successful/more bytes need to be received and False otherwise\n+        \"\"\"\n+        received_garbage = response[:16]\n+        response = response[16:]\n+        processed_length = len(received_garbage)\n+        for i in range(4096):\n+            if received_garbage[-16:] == self.peer['recv_garbage_terminator']:\n+                # Receive, decode, and ignore version packet.\n+                # This includes skipping decoys and authenticating the received garbage.\n+                aad = received_garbage[:-16]\n+                while not self.tried_v2_handshake:\n+                    length, contents = self.v2_receive_packet(response, aad=aad)\n+                    processed_length += length\n+                    aad = b\"\"\n+                    if length == -1:\n+                        return processed_length, False\n+                    elif length == 0:\n+                        return 0, True\n+                    # currently version packet has empty content while decoy packets don't\n+                    if length == LENGTH_FIELD_LEN + HEADER_LEN + CHACHA20POLY1305_EXPANSION:\n+                        self.tried_v2_handshake = True\n+                        return processed_length, True\n+                    response = response[length:]\n+            else:\n+                # don't update recvbuf since more bytes need to be received\n+                if len(response) == 0:\n+                    return 0, True\n+                received_garbage += response[:1]\n+                processed_length += 1\n+                response = response[1:]\n+        # disconnect since garbage terminator was not seen after 4 KiB of garbage.\n+        return processed_length, False\n+\n+    def initialize_v2_transport(self, ecdh_secret):\n+        \"\"\"Return a peer object with various BIP324 derived keys and ciphers.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1353384798",
      "id" : 1353384798,
      "line" : 185,
      "node_id" : "PRRC_kwDOABII585QqwNe",
      "original_commit_id" : "5f851714cf5fa7a31bb423c20035f7b44deed25d",
      "original_line" : 183,
      "original_position" : 178,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : 185,
      "pull_request_review_id" : 1665480038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353384798/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T22:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353384798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1355307964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355307964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have little knowledge of cryptography, but I think that something is wrong here.\r\nDoesn't `crypt` change the internal state of the stream cipher, so if we abort below because we haven't received the message in full, but then call `crypt` again on the same first 3 bytes of the now larger response, we will get an incorrect result?",
      "commit_id" : "e996ea537af9b651a7470e352dcd4f6037ba5c9f",
      "created_at" : "2023-10-11T16:03:53Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):\n+        \"\"\"Initiator begins the v2 handshake by sending its ellswift bytes and garbage\"\"\"\n+        self.privkey_ours, self.ellswift_ours = ellswift_create()\n+        self.sent_garbage = os.urandom(garbage_len)\n+        logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+        return self.ellswift_ours + self.sent_garbage\n+\n+    def respond_v2_handshake(self, response, garbage_len=random.randrange(4096)):\n+        \"\"\"Responder begins the v2 handshake by sending its ellswift bytes and garbage. However, the responder\n+        sends this after having received at least one byte that mismatches 16-byte V1_PREFIX.\"\"\"\n+        while len(self.received_prefix) < 16:\n+            byte = response.read(1)\n+            # return b\"\" if we need to receive more bytes\n+            if not byte:\n+                return b\"\"\n+            self.received_prefix += byte\n+            if self.received_prefix[-1] != V1_PREFIX[len(self.received_prefix) - 1]:\n+                self.privkey_ours, self.ellswift_ours = ellswift_create()\n+                self.sent_garbage = os.urandom(garbage_len)\n+                logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+                return self.ellswift_ours + self.sent_garbage\n+        # return -1 to decide v1 only after all 16 bytes processed\n+        return -1\n+\n+    def complete_handshake(self, response):\n+        \"\"\" Instantiates the encrypted transport and\n+        sends garbage terminator + optional decoy packets + transport version packet.\n+        Done by both initiator and responder.\"\"\"\n+        received_prefix = b'' if self.initiating else self.received_prefix\n+        ellswift_theirs = received_prefix + response.read(64 - len(received_prefix))\n+        ecdh_secret = self.v2_ecdh(self.privkey_ours, ellswift_theirs, self.ellswift_ours, self.initiating)\n+        self.initialize_v2_transport(ecdh_secret)\n+        # Send garbage terminator\n+        msg_to_send = self.peer['send_garbage_terminator']\n+        # Optionally send decoy packets after garbage terminator.\n+        aad = self.sent_garbage\n+        for decoy_content_len in [random.randint(1, 100) for _ in range(10)]:\n+            msg_to_send += self.v2_enc_packet(decoy_content_len * b'\\x00', aad=aad)\n+            aad = b''\n+        # Send version packet.\n+        msg_to_send += self.v2_enc_packet(TRANSPORT_VERSION, aad=aad)\n+        return msg_to_send\n+\n+    def authenticate_handshake(self, response):\n+        \"\"\" Ensures that the received optional decoy packets and transport version packet are authenticated.\n+        Marks the v2 handshake as complete. Done by both initiator and responder.\n+        Returns:\n+            1. length of bytes that were processed so that recvbuf can be updated\n+            2. True if the authentication was successful/more bytes need to be received and False otherwise\n+        \"\"\"\n+        received_garbage = response[:16]\n+        response = response[16:]\n+        processed_length = len(received_garbage)\n+        for i in range(4096):\n+            if received_garbage[-16:] == self.peer['recv_garbage_terminator']:\n+                # Receive, decode, and ignore version packet.\n+                # This includes skipping decoys and authenticating the received garbage.\n+                aad = received_garbage[:-16]\n+                while not self.tried_v2_handshake:\n+                    length, contents = self.v2_receive_packet(response, aad=aad)\n+                    processed_length += length\n+                    aad = b\"\"\n+                    if length == -1:\n+                        return processed_length, False\n+                    elif length == 0:\n+                        return 0, True\n+                    # currently version packet has empty content while decoy packets don't\n+                    if length == LENGTH_FIELD_LEN + HEADER_LEN + CHACHA20POLY1305_EXPANSION:\n+                        self.tried_v2_handshake = True\n+                        return processed_length, True\n+                    response = response[length:]\n+            else:\n+                # don't update recvbuf since more bytes need to be received\n+                if len(response) == 0:\n+                    return 0, True\n+                received_garbage += response[:1]\n+                processed_length += 1\n+                response = response[1:]\n+        # disconnect since garbage terminator was not seen after 4 KiB of garbage.\n+        return processed_length, False\n+\n+    def initialize_v2_transport(self, ecdh_secret):\n+        \"\"\"Return a peer object with various BIP324 derived keys and ciphers.\"\"\"\n+        peer = {}\n+        salt = b'bitcoin_v2_shared_secret' + MAGIC_BYTES[\"regtest\"]\n+        for name, length in (('initiator_L', 32), ('initiator_P', 32), ('responder_L', 32), ('responder_P', 32),\n+                             ('garbage_terminators', 32), ('session_id', 32)):\n+            peer[name] = hkdf_sha256(salt=salt, ikm=ecdh_secret, info=name.encode('utf-8'), length=length)\n+        peer['initiator_garbage_terminator'] = peer['garbage_terminators'][:16]\n+        peer['responder_garbage_terminator'] = peer['garbage_terminators'][16:]\n+        del peer['garbage_terminators']\n+        if self.initiating:\n+            self.peer['send_L'] = FSChaCha20(peer['initiator_L'])\n+            self.peer['send_P'] = FSChaCha20Poly1305(peer['initiator_P'])\n+            self.peer['send_garbage_terminator'] = peer['initiator_garbage_terminator']\n+            self.peer['recv_L'] = FSChaCha20(peer['responder_L'])\n+            self.peer['recv_P'] = FSChaCha20Poly1305(peer['responder_P'])\n+            self.peer['recv_garbage_terminator'] = peer['responder_garbage_terminator']\n+        else:\n+            self.peer['send_L'] = FSChaCha20(peer['responder_L'])\n+            self.peer['send_P'] = FSChaCha20Poly1305(peer['responder_P'])\n+            self.peer['send_garbage_terminator'] = peer['responder_garbage_terminator']\n+            self.peer['recv_L'] = FSChaCha20(peer['initiator_L'])\n+            self.peer['recv_P'] = FSChaCha20Poly1305(peer['initiator_P'])\n+            self.peer['recv_garbage_terminator'] = peer['initiator_garbage_terminator']\n+        self.peer['session_id'] = peer['session_id']\n+\n+    def v2_enc_packet(self, contents, aad=b'', ignore=False):\n+        \"\"\"Encrypt a BIP324 packet.\"\"\"\n+        assert len(contents) <= 2**24 - 1\n+        header = (ignore << IGNORE_BIT_POS).to_bytes(HEADER_LEN, 'little')\n+        plaintext = header + contents\n+        aead_ciphertext = self.peer['send_P'].encrypt(aad, plaintext)\n+        enc_plaintext_len = self.peer['send_L'].crypt(len(contents).to_bytes(LENGTH_FIELD_LEN, 'little'))\n+        return enc_plaintext_len + aead_ciphertext\n+\n+    def v2_receive_packet(self, response, aad=b''):\n+        \"\"\"Decrypt a BIP324 packet\n+        Returns:\n+            1. length - length of packet processed in order to update recvbuf.\n+                      - return 0 if only part of packet is received. (recvbuf not updated since decryption not done yet)\n+                      - return -1 if there's a MAC tag mismatch and disconnect.\n+            2. decrypted packet contents\n+                     - return b\"\" if only part of packet is received/MAC tag mismatch.\n+        \"\"\"\n+        if len(response) < LENGTH_FIELD_LEN:\n+            return 0, b\"\"\n+        enc_contents_len = response[:LENGTH_FIELD_LEN]\n+        response = response[LENGTH_FIELD_LEN:]\n+        contents_len = int.from_bytes(self.peer['recv_L'].crypt(enc_contents_len), 'little')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1355307964",
      "id" : 1355307964,
      "line" : 232,
      "node_id" : "PRRC_kwDOABII585QyFu8",
      "original_commit_id" : "5f851714cf5fa7a31bb423c20035f7b44deed25d",
      "original_line" : 230,
      "original_position" : 225,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : 232,
      "pull_request_review_id" : 1671747731,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355307964/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-11T16:03:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355307964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549582"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done. true! logs had lines like these: `[net] non-version message before version handshake. Message \"\" from peer=0`.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:27:27Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):\n+        \"\"\"Initiator begins the v2 handshake by sending its ellswift bytes and garbage\"\"\"\n+        self.privkey_ours, self.ellswift_ours = ellswift_create()\n+        self.sent_garbage = os.urandom(garbage_len)\n+        logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+        return self.ellswift_ours + self.sent_garbage\n+\n+    def respond_v2_handshake(self, response, garbage_len=random.randrange(4096)):\n+        \"\"\"Responder begins the v2 handshake by sending its ellswift bytes and garbage. However, the responder\n+        sends this after having received at least one byte that mismatches 16-byte V1_PREFIX.\"\"\"\n+        while len(self.received_prefix) < 16:\n+            byte = response.read(1)\n+            # return b\"\" if we need to receive more bytes\n+            if not byte:\n+                return b\"\"\n+            self.received_prefix += byte\n+            if self.received_prefix[-1] != V1_PREFIX[len(self.received_prefix) - 1]:\n+                self.privkey_ours, self.ellswift_ours = ellswift_create()\n+                self.sent_garbage = os.urandom(garbage_len)\n+                logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+                return self.ellswift_ours + self.sent_garbage\n+        # return -1 to decide v1 only after all 16 bytes processed\n+        return -1\n+\n+    def complete_handshake(self, response):\n+        \"\"\" Instantiates the encrypted transport and\n+        sends garbage terminator + optional decoy packets + transport version packet.\n+        Done by both initiator and responder.\"\"\"\n+        received_prefix = b'' if self.initiating else self.received_prefix\n+        ellswift_theirs = received_prefix + response.read(64 - len(received_prefix))\n+        ecdh_secret = self.v2_ecdh(self.privkey_ours, ellswift_theirs, self.ellswift_ours, self.initiating)\n+        self.initialize_v2_transport(ecdh_secret)\n+        # Send garbage terminator\n+        msg_to_send = self.peer['send_garbage_terminator']\n+        # Optionally send decoy packets after garbage terminator.\n+        aad = self.sent_garbage\n+        for decoy_content_len in [random.randint(1, 100) for _ in range(10)]:\n+            msg_to_send += self.v2_enc_packet(decoy_content_len * b'\\x00', aad=aad)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549582",
      "id" : 1356549582,
      "in_reply_to_id" : 1350924659,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q203O",
      "original_commit_id" : "5f851714cf5fa7a31bb423c20035f7b44deed25d",
      "original_line" : 138,
      "original_position" : 133,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : null,
      "pull_request_review_id" : 1673715969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549582/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549683"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:27:31Z",
      "diff_hunk" : "@@ -1209,13 +1209,14 @@ class CConnman\n      * @param[in]   address     Address of node to try connecting to\n      * @param[in]   conn_type   ConnectionType::OUTBOUND, ConnectionType::BLOCK_RELAY,\n      *                          ConnectionType::ADDR_FETCH or ConnectionType::FEELER\n+     * @param[in]   use_v2transport  Set to true if node supports BIP324 v2 transport protocol",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549683",
      "id" : 1356549683,
      "in_reply_to_id" : 1353141062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q204z",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 1212,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1673716109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549798"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:27:36Z",
      "diff_hunk" : "@@ -357,6 +357,7 @@ static RPCHelpMan addconnection()\n         {\n             {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The IP address and port to attempt connecting to.\"},\n             {\"connection_type\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Type of connection to open (\\\"outbound-full-relay\\\", \\\"block-relay-only\\\", \\\"addr-fetch\\\" or \\\"feeler\\\").\"},\n+            {\"v2transport\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Node supports BIP324 v2 transport protocol\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549798",
      "id" : 1356549798,
      "in_reply_to_id" : 1353143252,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q206m",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 360,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1673716273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549798/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549916"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:27:41Z",
      "diff_hunk" : "@@ -388,11 +389,12 @@ static RPCHelpMan addconnection()\n     } else {\n         throw JSONRPCError(RPC_INVALID_PARAMETER, self.ToString());\n     }\n+    bool use_v2transport = !request.params[2].isNull() && request.params[2].get_bool();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356549916",
      "id" : 1356549916,
      "in_reply_to_id" : 1353156113,
      "line" : 392,
      "node_id" : "PRRC_kwDOABII585Q208c",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 392,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 1673716458,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549916/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:27:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356549916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356550097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550097"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:27:46Z",
      "diff_hunk" : "@@ -1880,7 +1880,7 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\n     RandAddEvent((uint32_t)id);\n }\n \n-bool CConnman::AddConnection(const std::string& address, ConnectionType conn_type)\n+bool CConnman::AddConnection(const std::string& address, ConnectionType conn_type, bool use_v2transport = false)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356550097",
      "id" : 1356550097,
      "in_reply_to_id" : 1353183494,
      "line" : 1883,
      "node_id" : "PRRC_kwDOABII585Q20_R",
      "original_commit_id" : "9810e96c74380a3087b2b576508581380019872f",
      "original_line" : 1883,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1673716731,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550097/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:27:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356550296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550296"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oops, fixed.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:27:52Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356550296",
      "id" : 1356550296,
      "in_reply_to_id" : 1349828896,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q21CY",
      "original_commit_id" : "a7478eab51c156519885673aff9efeaa95504bd3",
      "original_line" : 101,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : null,
      "pull_request_review_id" : 1673717025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550296/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:27:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356550774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550774"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:28:16Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):\n+        \"\"\"Initiator begins the v2 handshake by sending its ellswift bytes and garbage\"\"\"\n+        self.privkey_ours, self.ellswift_ours = ellswift_create()\n+        self.sent_garbage = os.urandom(garbage_len)\n+        logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+        return self.ellswift_ours + self.sent_garbage\n+\n+    def respond_v2_handshake(self, response, garbage_len=random.randrange(4096)):\n+        \"\"\"Responder begins the v2 handshake by sending its ellswift bytes and garbage. However, the responder\n+        sends this after having received at least one byte that mismatches 16-byte V1_PREFIX.\"\"\"\n+        while len(self.received_prefix) < 16:\n+            byte = response.read(1)\n+            # return b\"\" if we need to receive more bytes\n+            if not byte:\n+                return b\"\"\n+            self.received_prefix += byte\n+            if self.received_prefix[-1] != V1_PREFIX[len(self.received_prefix) - 1]:\n+                self.privkey_ours, self.ellswift_ours = ellswift_create()\n+                self.sent_garbage = os.urandom(garbage_len)\n+                logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+                return self.ellswift_ours + self.sent_garbage\n+        # return -1 to decide v1 only after all 16 bytes processed\n+        return -1\n+\n+    def complete_handshake(self, response):\n+        \"\"\" Instantiates the encrypted transport and\n+        sends garbage terminator + optional decoy packets + transport version packet.\n+        Done by both initiator and responder.\"\"\"\n+        received_prefix = b'' if self.initiating else self.received_prefix\n+        ellswift_theirs = received_prefix + response.read(64 - len(received_prefix))\n+        ecdh_secret = self.v2_ecdh(self.privkey_ours, ellswift_theirs, self.ellswift_ours, self.initiating)\n+        self.initialize_v2_transport(ecdh_secret)\n+        # Send garbage terminator\n+        msg_to_send = self.peer['send_garbage_terminator']\n+        # Optionally send decoy packets after garbage terminator.\n+        aad = self.sent_garbage\n+        for decoy_content_len in [random.randint(1, 100) for _ in range(10)]:\n+            msg_to_send += self.v2_enc_packet(decoy_content_len * b'\\x00', aad=aad)\n+            aad = b''\n+        # Send version packet.\n+        msg_to_send += self.v2_enc_packet(TRANSPORT_VERSION, aad=aad)\n+        return msg_to_send\n+\n+    def authenticate_handshake(self, response):\n+        \"\"\" Ensures that the received optional decoy packets and transport version packet are authenticated.\n+        Marks the v2 handshake as complete. Done by both initiator and responder.\n+        Returns:\n+            1. length of bytes that were processed so that recvbuf can be updated\n+            2. True if the authentication was successful/more bytes need to be received and False otherwise\n+        \"\"\"\n+        received_garbage = response[:16]\n+        response = response[16:]\n+        processed_length = len(received_garbage)\n+        for i in range(4096):\n+            if received_garbage[-16:] == self.peer['recv_garbage_terminator']:\n+                # Receive, decode, and ignore version packet.\n+                # This includes skipping decoys and authenticating the received garbage.\n+                aad = received_garbage[:-16]\n+                while not self.tried_v2_handshake:\n+                    length, contents = self.v2_receive_packet(response, aad=aad)\n+                    processed_length += length\n+                    aad = b\"\"\n+                    if length == -1:\n+                        return processed_length, False\n+                    elif length == 0:\n+                        return 0, True\n+                    # currently version packet has empty content while decoy packets don't\n+                    if length == LENGTH_FIELD_LEN + HEADER_LEN + CHACHA20POLY1305_EXPANSION:\n+                        self.tried_v2_handshake = True\n+                        return processed_length, True\n+                    response = response[length:]\n+            else:\n+                # don't update recvbuf since more bytes need to be received\n+                if len(response) == 0:\n+                    return 0, True\n+                received_garbage += response[:1]\n+                processed_length += 1\n+                response = response[1:]\n+        # disconnect since garbage terminator was not seen after 4 KiB of garbage.\n+        return processed_length, False\n+\n+    def initialize_v2_transport(self, ecdh_secret):\n+        \"\"\"Return a peer object with various BIP324 derived keys and ciphers.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356550774",
      "id" : 1356550774,
      "in_reply_to_id" : 1353384798,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q21J2",
      "original_commit_id" : "5f851714cf5fa7a31bb423c20035f7b44deed25d",
      "original_line" : 183,
      "original_position" : 178,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : null,
      "pull_request_review_id" : 1673717719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550774/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:28:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356550774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356583257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356583257"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nice catch. you're right!\r\n\r\ni've stored `contents_len` in a class variable so as to not perform the decryption of 3 bytes length again. initially, `contents_len` is -1, after the 3 bytes length gets processed - `contents_len` is updated, when the whole packet is processed `contents_len` is reset to -1 again.\r\n\r\ni'm open to other solutions.\r\n\r\ni wish there was a cleaner way for writing this function with reads like [this](https://github.com/bitcoin/bips/blob/master/bip-0324.mediawiki?plain=1#L500-L513) but we're working with `P2PConnection`(subclass of `asyncio.Protocol`) where no read is possible(no \"waiting\" for data to be ready) and we just have a [`data_received()`](https://docs.python.org/3/library/asyncio-protocol.html#asyncio.Protocol.data_received) callback when data is received.",
      "commit_id" : "32836c6fec4cbb2624176daf7fd769856025c426",
      "created_at" : "2023-10-12T09:56:00Z",
      "diff_hunk" : "@@ -18,3 +97,143 @@ def v2_ecdh(priv, ellswift_theirs, ellswift_ours, initiating):\n         else:\n             # Responding, place their public key encoding first.\n             return TaggedHash(\"bip324_ellswift_xonly_ecdh\", ellswift_theirs + ellswift_ours + ecdh_point_x32)\n+\n+    def initiate_v2_handshake(self, garbage_len=random.randrange(4096)):\n+        \"\"\"Initiator begins the v2 handshake by sending its ellswift bytes and garbage\"\"\"\n+        self.privkey_ours, self.ellswift_ours = ellswift_create()\n+        self.sent_garbage = os.urandom(garbage_len)\n+        logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+        return self.ellswift_ours + self.sent_garbage\n+\n+    def respond_v2_handshake(self, response, garbage_len=random.randrange(4096)):\n+        \"\"\"Responder begins the v2 handshake by sending its ellswift bytes and garbage. However, the responder\n+        sends this after having received at least one byte that mismatches 16-byte V1_PREFIX.\"\"\"\n+        while len(self.received_prefix) < 16:\n+            byte = response.read(1)\n+            # return b\"\" if we need to receive more bytes\n+            if not byte:\n+                return b\"\"\n+            self.received_prefix += byte\n+            if self.received_prefix[-1] != V1_PREFIX[len(self.received_prefix) - 1]:\n+                self.privkey_ours, self.ellswift_ours = ellswift_create()\n+                self.sent_garbage = os.urandom(garbage_len)\n+                logger.debug(\"sending %d bytes of garbage data\" % garbage_len)\n+                return self.ellswift_ours + self.sent_garbage\n+        # return -1 to decide v1 only after all 16 bytes processed\n+        return -1\n+\n+    def complete_handshake(self, response):\n+        \"\"\" Instantiates the encrypted transport and\n+        sends garbage terminator + optional decoy packets + transport version packet.\n+        Done by both initiator and responder.\"\"\"\n+        received_prefix = b'' if self.initiating else self.received_prefix\n+        ellswift_theirs = received_prefix + response.read(64 - len(received_prefix))\n+        ecdh_secret = self.v2_ecdh(self.privkey_ours, ellswift_theirs, self.ellswift_ours, self.initiating)\n+        self.initialize_v2_transport(ecdh_secret)\n+        # Send garbage terminator\n+        msg_to_send = self.peer['send_garbage_terminator']\n+        # Optionally send decoy packets after garbage terminator.\n+        aad = self.sent_garbage\n+        for decoy_content_len in [random.randint(1, 100) for _ in range(10)]:\n+            msg_to_send += self.v2_enc_packet(decoy_content_len * b'\\x00', aad=aad)\n+            aad = b''\n+        # Send version packet.\n+        msg_to_send += self.v2_enc_packet(TRANSPORT_VERSION, aad=aad)\n+        return msg_to_send\n+\n+    def authenticate_handshake(self, response):\n+        \"\"\" Ensures that the received optional decoy packets and transport version packet are authenticated.\n+        Marks the v2 handshake as complete. Done by both initiator and responder.\n+        Returns:\n+            1. length of bytes that were processed so that recvbuf can be updated\n+            2. True if the authentication was successful/more bytes need to be received and False otherwise\n+        \"\"\"\n+        received_garbage = response[:16]\n+        response = response[16:]\n+        processed_length = len(received_garbage)\n+        for i in range(4096):\n+            if received_garbage[-16:] == self.peer['recv_garbage_terminator']:\n+                # Receive, decode, and ignore version packet.\n+                # This includes skipping decoys and authenticating the received garbage.\n+                aad = received_garbage[:-16]\n+                while not self.tried_v2_handshake:\n+                    length, contents = self.v2_receive_packet(response, aad=aad)\n+                    processed_length += length\n+                    aad = b\"\"\n+                    if length == -1:\n+                        return processed_length, False\n+                    elif length == 0:\n+                        return 0, True\n+                    # currently version packet has empty content while decoy packets don't\n+                    if length == LENGTH_FIELD_LEN + HEADER_LEN + CHACHA20POLY1305_EXPANSION:\n+                        self.tried_v2_handshake = True\n+                        return processed_length, True\n+                    response = response[length:]\n+            else:\n+                # don't update recvbuf since more bytes need to be received\n+                if len(response) == 0:\n+                    return 0, True\n+                received_garbage += response[:1]\n+                processed_length += 1\n+                response = response[1:]\n+        # disconnect since garbage terminator was not seen after 4 KiB of garbage.\n+        return processed_length, False\n+\n+    def initialize_v2_transport(self, ecdh_secret):\n+        \"\"\"Return a peer object with various BIP324 derived keys and ciphers.\"\"\"\n+        peer = {}\n+        salt = b'bitcoin_v2_shared_secret' + MAGIC_BYTES[\"regtest\"]\n+        for name, length in (('initiator_L', 32), ('initiator_P', 32), ('responder_L', 32), ('responder_P', 32),\n+                             ('garbage_terminators', 32), ('session_id', 32)):\n+            peer[name] = hkdf_sha256(salt=salt, ikm=ecdh_secret, info=name.encode('utf-8'), length=length)\n+        peer['initiator_garbage_terminator'] = peer['garbage_terminators'][:16]\n+        peer['responder_garbage_terminator'] = peer['garbage_terminators'][16:]\n+        del peer['garbage_terminators']\n+        if self.initiating:\n+            self.peer['send_L'] = FSChaCha20(peer['initiator_L'])\n+            self.peer['send_P'] = FSChaCha20Poly1305(peer['initiator_P'])\n+            self.peer['send_garbage_terminator'] = peer['initiator_garbage_terminator']\n+            self.peer['recv_L'] = FSChaCha20(peer['responder_L'])\n+            self.peer['recv_P'] = FSChaCha20Poly1305(peer['responder_P'])\n+            self.peer['recv_garbage_terminator'] = peer['responder_garbage_terminator']\n+        else:\n+            self.peer['send_L'] = FSChaCha20(peer['responder_L'])\n+            self.peer['send_P'] = FSChaCha20Poly1305(peer['responder_P'])\n+            self.peer['send_garbage_terminator'] = peer['responder_garbage_terminator']\n+            self.peer['recv_L'] = FSChaCha20(peer['initiator_L'])\n+            self.peer['recv_P'] = FSChaCha20Poly1305(peer['initiator_P'])\n+            self.peer['recv_garbage_terminator'] = peer['initiator_garbage_terminator']\n+        self.peer['session_id'] = peer['session_id']\n+\n+    def v2_enc_packet(self, contents, aad=b'', ignore=False):\n+        \"\"\"Encrypt a BIP324 packet.\"\"\"\n+        assert len(contents) <= 2**24 - 1\n+        header = (ignore << IGNORE_BIT_POS).to_bytes(HEADER_LEN, 'little')\n+        plaintext = header + contents\n+        aead_ciphertext = self.peer['send_P'].encrypt(aad, plaintext)\n+        enc_plaintext_len = self.peer['send_L'].crypt(len(contents).to_bytes(LENGTH_FIELD_LEN, 'little'))\n+        return enc_plaintext_len + aead_ciphertext\n+\n+    def v2_receive_packet(self, response, aad=b''):\n+        \"\"\"Decrypt a BIP324 packet\n+        Returns:\n+            1. length - length of packet processed in order to update recvbuf.\n+                      - return 0 if only part of packet is received. (recvbuf not updated since decryption not done yet)\n+                      - return -1 if there's a MAC tag mismatch and disconnect.\n+            2. decrypted packet contents\n+                     - return b\"\" if only part of packet is received/MAC tag mismatch.\n+        \"\"\"\n+        if len(response) < LENGTH_FIELD_LEN:\n+            return 0, b\"\"\n+        enc_contents_len = response[:LENGTH_FIELD_LEN]\n+        response = response[LENGTH_FIELD_LEN:]\n+        contents_len = int.from_bytes(self.peer['recv_L'].crypt(enc_contents_len), 'little')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#discussion_r1356583257",
      "id" : 1356583257,
      "in_reply_to_id" : 1355307964,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q29FZ",
      "original_commit_id" : "5f851714cf5fa7a31bb423c20035f7b44deed25d",
      "original_line" : 230,
      "original_position" : 225,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/v2_p2p.py",
      "position" : null,
      "pull_request_review_id" : 1673768690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356583257/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T09:56:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356583257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-11-01T11:56:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24748#issuecomment-1788832394",
      "id" : 1788832394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24748",
      "node_id" : "IC_kwDOABII585qn2qK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788832394/reactions"
      },
      "updated_at" : "2023-11-01T11:56:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788832394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
