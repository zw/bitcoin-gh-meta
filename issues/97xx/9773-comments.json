[
   {
      "body" : "Concept ACK\r\nThis looks like a reasonable approach to me.  \r\n\r\nDon't forget that you may want to include the grace period in detecting whether it scanned enough.\r\nAlso you might want to skip the rest of the loop if ReadBlockFromDisk is false.\r\n\r\n",
      "created_at" : "2017-02-15T22:48:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280166003",
      "id" : 280166003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-15T22:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280166003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Concept ACK.\r\n\r\n> The code has not been tested at all, and I'm actually not sure how I'm going to go about writing a unit test because there doesn't seem to be an easy way to target individual blocks for pruning inside RPC tests.\r\n\r\nThere's `pruneblockchain` but yes pruning works on a per-file, not a per-block basis, so it would need some extra effort on regtest to generate full blocks instead of empty ones otherwise at block 30000 you're still in the first file, and that RPC will do nothing.",
      "created_at" : "2017-02-16T12:09:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280314289",
      "id" : 280314289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T12:09:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280314289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Concept ACK. Will test/review further.",
      "created_at" : "2017-02-16T12:16:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280315455",
      "id" : 280315455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T12:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280315455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Please rebase on #9761 so we can verify the grace period works properly",
      "created_at" : "2017-02-16T15:42:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280366522",
      "id" : 280366522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T15:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280366522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Rebased",
      "created_at" : "2017-02-16T15:53:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280370118",
      "id" : 280370118,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T15:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280370118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101597690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101597690"
         }
      },
      "body" : "I think this loop should also be skipped if ReadBlockFromDisk fails",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-16T18:53:18Z",
      "diff_hunk" : "@@ -1570,12 +1574,15 @@ int CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate)\n                 ShowProgress(_(\"Rescanning...\"), std::max(1, std::min(99, (int)((GuessVerificationProgress(chainParams.TxData(), pindex) - dProgressStart) / (dProgressTip - dProgressStart) * 100))));\n \n             CBlock block;\n-            ReadBlockFromDisk(block, pindex, Params().GetConsensus());\n+            if (!ReadBlockFromDisk(block, pindex, Params().GetConsensus())) {\n+                ret = nullptr;\n+            } else if (!ret) {\n+                ret = pindex;\n+            }\n             int posInBlock;\n             for (posInBlock = 0; posInBlock < (int)block.vtx.size(); posInBlock++)\n             {\n-                if (AddToWalletIfInvolvingMe(*block.vtx[posInBlock], pindex, posInBlock, fUpdate))\n-                    ret++;\n+                AddToWalletIfInvolvingMe(*block.vtx[posInBlock], pindex, posInBlock, fUpdate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101597690",
      "id" : 101597690,
      "original_commit_id" : "34e4209275529aa2b786f30a784d89ee94c3e76f",
      "original_position" : 32,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 22332305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101597690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101599153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101599153"
         }
      },
      "body" : "Skipped in d6f6a23c7092aa21110cc77ebeb018492bacae28",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-16T18:59:52Z",
      "diff_hunk" : "@@ -1570,12 +1574,15 @@ int CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate)\n                 ShowProgress(_(\"Rescanning...\"), std::max(1, std::min(99, (int)((GuessVerificationProgress(chainParams.TxData(), pindex) - dProgressStart) / (dProgressTip - dProgressStart) * 100))));\n \n             CBlock block;\n-            ReadBlockFromDisk(block, pindex, Params().GetConsensus());\n+            if (!ReadBlockFromDisk(block, pindex, Params().GetConsensus())) {\n+                ret = nullptr;\n+            } else if (!ret) {\n+                ret = pindex;\n+            }\n             int posInBlock;\n             for (posInBlock = 0; posInBlock < (int)block.vtx.size(); posInBlock++)\n             {\n-                if (AddToWalletIfInvolvingMe(*block.vtx[posInBlock], pindex, posInBlock, fUpdate))\n-                    ret++;\n+                AddToWalletIfInvolvingMe(*block.vtx[posInBlock], pindex, posInBlock, fUpdate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101599153",
      "id" : 101599153,
      "original_commit_id" : "34e4209275529aa2b786f30a784d89ee94c3e76f",
      "original_position" : 32,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 22333927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101599153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101604508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101604508"
         }
      },
      "body" : "just curious: Is there an advantage using `PRId64` over `%ul` (rest of the code uses this)?",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-16T19:23:06Z",
      "diff_hunk" : "@@ -1072,12 +1073,32 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n     }\n \n     if (fRescan && fRunScan && requests.size() && nLowestTimestamp <= chainActive.Tip()->GetBlockTimeMax()) {\n-        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(nLowestTimestamp) : chainActive.Genesis();\n-\n+        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(std::max<int64_t>(nLowestTimestamp - 7200, 0)) : chainActive.Genesis();\n+        CBlockIndex* scannedRange = nullptr;\n         if (pindex) {\n-            pwalletMain->ScanForWalletTransactions(pindex, true);\n+            scannedRange = pwalletMain->ScanForWalletTransactions(pindex, true);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n+\n+        if (!scannedRange || scannedRange->nHeight > pindex->nHeight) {\n+            std::vector<UniValue> results = response.getValues();\n+            response.clear();\n+            size_t i = 0;\n+            for (const UniValue& request : requests.getValues()) {\n+                // If key creation date is within the successfully scanned\n+                // range, or if the import result already has an error set, let\n+                // the result stand unmodified. Otherwise replace the result\n+                // with an error message.\n+                if (GetImportTimestamp(request, now) - 7200 >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                    response.push_back(results.at(i));\n+                } else {\n+                    UniValue result = UniValue(UniValue::VOBJ);\n+                    result.pushKV(\"success\", UniValue(false));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %\" PRId64 \", transactions may be missing.\", (long long)scannedRange->GetBlockTimeMax())));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101604508",
      "id" : 101604508,
      "original_commit_id" : "34e4209275529aa2b786f30a784d89ee94c3e76f",
      "original_position" : 38,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 22339442,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101604508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101606956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101606956"
         }
      },
      "body" : "Actually I need to change this to either remove PRId64 or the (long long) cast.\r\n\r\nYou're supposed to use PRId64 whenever you pass an int64_t type to printf. %ld or %lld aren't always correct because longs and long longs just have minimum widths in standard c++, not fixed widths that are the same on all systems.\r\n",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-16T19:33:57Z",
      "diff_hunk" : "@@ -1072,12 +1073,32 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n     }\n \n     if (fRescan && fRunScan && requests.size() && nLowestTimestamp <= chainActive.Tip()->GetBlockTimeMax()) {\n-        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(nLowestTimestamp) : chainActive.Genesis();\n-\n+        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(std::max<int64_t>(nLowestTimestamp - 7200, 0)) : chainActive.Genesis();\n+        CBlockIndex* scannedRange = nullptr;\n         if (pindex) {\n-            pwalletMain->ScanForWalletTransactions(pindex, true);\n+            scannedRange = pwalletMain->ScanForWalletTransactions(pindex, true);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n+\n+        if (!scannedRange || scannedRange->nHeight > pindex->nHeight) {\n+            std::vector<UniValue> results = response.getValues();\n+            response.clear();\n+            size_t i = 0;\n+            for (const UniValue& request : requests.getValues()) {\n+                // If key creation date is within the successfully scanned\n+                // range, or if the import result already has an error set, let\n+                // the result stand unmodified. Otherwise replace the result\n+                // with an error message.\n+                if (GetImportTimestamp(request, now) - 7200 >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                    response.push_back(results.at(i));\n+                } else {\n+                    UniValue result = UniValue(UniValue::VOBJ);\n+                    result.pushKV(\"success\", UniValue(false));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %\" PRId64 \", transactions may be missing.\", (long long)scannedRange->GetBlockTimeMax())));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101606956",
      "id" : 101606956,
      "original_commit_id" : "34e4209275529aa2b786f30a784d89ee94c3e76f",
      "original_position" : 38,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 22342013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101606956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Previously squashed e3d4f257ce0202811464d3b6860db87ba147aa24 -> 455b8f7cb2a1889053a006055e9dcad923c77029 ([multicheck.2](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.2) -> [multicheck.3](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.3))",
      "created_at" : "2017-02-16T20:13:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280445536",
      "id" : 280445536,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T20:13:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280445536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101616525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101616525"
         }
      },
      "body" : "Removed cast in e49f0394f07a95e6cc5cdabe32f2c6b8f53c40fb.",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-16T20:16:52Z",
      "diff_hunk" : "@@ -1072,12 +1073,32 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n     }\n \n     if (fRescan && fRunScan && requests.size() && nLowestTimestamp <= chainActive.Tip()->GetBlockTimeMax()) {\n-        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(nLowestTimestamp) : chainActive.Genesis();\n-\n+        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(std::max<int64_t>(nLowestTimestamp - 7200, 0)) : chainActive.Genesis();\n+        CBlockIndex* scannedRange = nullptr;\n         if (pindex) {\n-            pwalletMain->ScanForWalletTransactions(pindex, true);\n+            scannedRange = pwalletMain->ScanForWalletTransactions(pindex, true);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n+\n+        if (!scannedRange || scannedRange->nHeight > pindex->nHeight) {\n+            std::vector<UniValue> results = response.getValues();\n+            response.clear();\n+            size_t i = 0;\n+            for (const UniValue& request : requests.getValues()) {\n+                // If key creation date is within the successfully scanned\n+                // range, or if the import result already has an error set, let\n+                // the result stand unmodified. Otherwise replace the result\n+                // with an error message.\n+                if (GetImportTimestamp(request, now) - 7200 >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                    response.push_back(results.at(i));\n+                } else {\n+                    UniValue result = UniValue(UniValue::VOBJ);\n+                    result.pushKV(\"success\", UniValue(false));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %\" PRId64 \", transactions may be missing.\", (long long)scannedRange->GetBlockTimeMax())));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101616525",
      "id" : 101616525,
      "original_commit_id" : "34e4209275529aa2b786f30a784d89ee94c3e76f",
      "original_position" : 38,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 22351826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101616525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Added C++ test for new importmulti RPC code in e64cdfba4a7e8a670e76c7bf770c248dc6b78c3d\r\n\r\nSquashed e64cdfba4a7e8a670e76c7bf770c248dc6b78c3d -> b73252de549984a06aae294252d0d055aca43a4a ([multicheck.4](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.4) -> [multicheck.5](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.5))\r\n",
      "created_at" : "2017-02-16T20:19:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280447203",
      "id" : 280447203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T20:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280447203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Note that our strprintf is a wrapper around tfm::format, and doesn't need type specs at all.",
      "created_at" : "2017-02-16T20:29:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280450005",
      "id" : 280450005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T20:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280450005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "lightly tested ACK b73252d\r\nOnly reviewed/tested code, not the tests.",
      "created_at" : "2017-02-16T20:30:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280450259",
      "id" : 280450259,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-16T20:30:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280450259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101742389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101742389"
         }
      },
      "body" : "Please remove the PRI64d here. It gives problems with some platforms, and as @sipa says don't need it.",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-17T11:56:39Z",
      "diff_hunk" : "@@ -1072,12 +1073,33 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n     }\n \n     if (fRescan && fRunScan && requests.size() && nLowestTimestamp <= chainActive.Tip()->GetBlockTimeMax()) {\n-        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(nLowestTimestamp) : chainActive.Genesis();\n-\n+        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(std::max<int64_t>(nLowestTimestamp - 7200, 0)) : chainActive.Genesis();\n+        CBlockIndex* scannedRange = nullptr;\n         if (pindex) {\n-            pwalletMain->ScanForWalletTransactions(pindex, true);\n+            scannedRange = pwalletMain->ScanForWalletTransactions(pindex, true);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n+\n+        if (!scannedRange || scannedRange->nHeight > pindex->nHeight) {\n+            std::vector<UniValue> results = response.getValues();\n+            response.clear();\n+            response.setArray();\n+            size_t i = 0;\n+            for (const UniValue& request : requests.getValues()) {\n+                // If key creation date is within the successfully scanned\n+                // range, or if the import result already has an error set, let\n+                // the result stand unmodified. Otherwise replace the result\n+                // with an error message.\n+                if (GetImportTimestamp(request, now) - 7200 >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                    response.push_back(results.at(i));\n+                } else {\n+                    UniValue result = UniValue(UniValue::VOBJ);\n+                    result.pushKV(\"success\", UniValue(false));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %\" PRId64 \", transactions may be missing.\", scannedRange->GetBlockTimeMax())));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101742389",
      "id" : 101742389,
      "original_commit_id" : "b73252de549984a06aae294252d0d055aca43a4a",
      "original_position" : 39,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 22480620,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101742389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101744091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101744091"
         }
      },
      "body" : "Ok will change, but what are the problems with some platforms?",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-17T12:08:52Z",
      "diff_hunk" : "@@ -1072,12 +1073,33 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n     }\n \n     if (fRescan && fRunScan && requests.size() && nLowestTimestamp <= chainActive.Tip()->GetBlockTimeMax()) {\n-        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(nLowestTimestamp) : chainActive.Genesis();\n-\n+        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(std::max<int64_t>(nLowestTimestamp - 7200, 0)) : chainActive.Genesis();\n+        CBlockIndex* scannedRange = nullptr;\n         if (pindex) {\n-            pwalletMain->ScanForWalletTransactions(pindex, true);\n+            scannedRange = pwalletMain->ScanForWalletTransactions(pindex, true);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n+\n+        if (!scannedRange || scannedRange->nHeight > pindex->nHeight) {\n+            std::vector<UniValue> results = response.getValues();\n+            response.clear();\n+            response.setArray();\n+            size_t i = 0;\n+            for (const UniValue& request : requests.getValues()) {\n+                // If key creation date is within the successfully scanned\n+                // range, or if the import result already has an error set, let\n+                // the result stand unmodified. Otherwise replace the result\n+                // with an error message.\n+                if (GetImportTimestamp(request, now) - 7200 >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                    response.push_back(results.at(i));\n+                } else {\n+                    UniValue result = UniValue(UniValue::VOBJ);\n+                    result.pushKV(\"success\", UniValue(false));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %\" PRId64 \", transactions may be missing.\", scannedRange->GetBlockTimeMax())));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101744091",
      "id" : 101744091,
      "original_commit_id" : "b73252de549984a06aae294252d0d055aca43a4a",
      "original_position" : 39,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 22482391,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101744091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Rebased b73252de549984a06aae294252d0d055aca43a4a -> 90671ee7e77c17c18f5ea82ea041962ef5d53f8a ([multicheck.5](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.5) -> [multicheck.6](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.6))\r\n",
      "created_at" : "2017-02-17T12:12:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280633863",
      "id" : 280633863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-17T12:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280633863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101746093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101746093"
         }
      },
      "body" : "Removed in aaaf65a90b87c18889d177ff3f0ab8a868f849f3.\r\n\r\nReason I am asking about the problem you're seeing is that not using PRI64d for int64_t would prevent us from using compile time format string checking (as suggested in https://github.com/bitcoin/bitcoin/issues/9423#issuecomment-269480805) which would be much better than the runtime checking we currently use.",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-17T12:24:37Z",
      "diff_hunk" : "@@ -1072,12 +1073,33 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n     }\n \n     if (fRescan && fRunScan && requests.size() && nLowestTimestamp <= chainActive.Tip()->GetBlockTimeMax()) {\n-        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(nLowestTimestamp) : chainActive.Genesis();\n-\n+        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(std::max<int64_t>(nLowestTimestamp - 7200, 0)) : chainActive.Genesis();\n+        CBlockIndex* scannedRange = nullptr;\n         if (pindex) {\n-            pwalletMain->ScanForWalletTransactions(pindex, true);\n+            scannedRange = pwalletMain->ScanForWalletTransactions(pindex, true);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n+\n+        if (!scannedRange || scannedRange->nHeight > pindex->nHeight) {\n+            std::vector<UniValue> results = response.getValues();\n+            response.clear();\n+            response.setArray();\n+            size_t i = 0;\n+            for (const UniValue& request : requests.getValues()) {\n+                // If key creation date is within the successfully scanned\n+                // range, or if the import result already has an error set, let\n+                // the result stand unmodified. Otherwise replace the result\n+                // with an error message.\n+                if (GetImportTimestamp(request, now) - 7200 >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                    response.push_back(results.at(i));\n+                } else {\n+                    UniValue result = UniValue(UniValue::VOBJ);\n+                    result.pushKV(\"success\", UniValue(false));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %\" PRId64 \", transactions may be missing.\", scannedRange->GetBlockTimeMax())));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r101746093",
      "id" : 101746093,
      "original_commit_id" : "b73252de549984a06aae294252d0d055aca43a4a",
      "original_position" : 39,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 22484485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-17T19:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101746093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Squashed aaaf65a90b87c18889d177ff3f0ab8a868f849f3 -> 1425c727863b335bf98bb4b17b575e59552d38e9 ([multicheck.7](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.7) -> [multicheck.8](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.8))\r\n",
      "created_at" : "2017-02-17T12:24:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280636020",
      "id" : 280636020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-17T12:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280636020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Somehow travis didn't like your commit.\n\nOn Fri, Feb 17, 2017 at 1:25 PM, Russell Yanofsky <notifications@github.com>\nwrote:\n\n> Squashed aaaf65a\n> <https://github.com/bitcoin/bitcoin/commit/aaaf65a90b87c18889d177ff3f0ab8a868f849f3>\n> -> 1425c72\n> <https://github.com/bitcoin/bitcoin/commit/1425c727863b335bf98bb4b17b575e59552d38e9>\n> (multicheck.7\n> <https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.7> ->\n> multicheck.8\n> <https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.8>)\n>\n> \n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280636020>, or mute\n> the thread\n> <https://github.com/notifications/unsubscribe-auth/AGGmvze2Mxoj5bq4mVJGQPY4YpClnvOlks5rdZGogaJpZM4MCUp0>\n> .\n>\n",
      "created_at" : "2017-02-17T14:36:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280666300",
      "id" : 280666300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-17T14:36:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280666300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> Somehow travis didn't like your commit.\r\n\r\nAppears to be a spurious error. The travis run for b72521dd7f570b0c557439d534f7523a5be52999 which is aaaf65a90b87c18889d177ff3f0ab8a868f849f3 merged into 9828f9a9962c1bee5c343847030b9cfd87a40a5e succeeded: https://travis-ci.org/bitcoin/bitcoin/builds/202600321\r\n\r\nOnly the travis run for 64072b74ebbf7b5585b39f6c117c6ffa9dc820f0 which is 1425c727863b335bf98bb4b17b575e59552d38e9 merged into 9828f9a9962c1bee5c343847030b9cfd87a40a5e failed: https://travis-ci.org/bitcoin/bitcoin/builds/202600549\r\n\r\nThere are no differences between the two commits:\r\n\r\n```\r\n$ git rev-parse aaaf65a90b87c18889d177ff3f0ab8a868f849f3^{tree} 1425c727863b335bf98bb4b17b575e59552d38e9^{tree}\r\n9e695fd32f65b1596f3ff613b96ec756bb2f1d2b\r\n9e695fd32f65b1596f3ff613b96ec756bb2f1d2b\r\n```",
      "created_at" : "2017-02-17T15:43:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280684263",
      "id" : 280684263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-17T15:43:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280684263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Touched CommitDate to rerun travis 1425c727863b335bf98bb4b17b575e59552d38e9 -> e2e2f4c856363bbb0e3b5ba4df225f3754c3db39 ([multicheck.8](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.8) -> [multicheck.12](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.12))",
      "created_at" : "2017-02-17T15:48:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280685819",
      "id" : 280685819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-17T19:55:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280685819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Travis run for 91b1ec2f4f27a817aee15f573afc26b7d17c8d7b which is 154025927dd5929f69f79e32818932d387c004bf merged into 9828f9a9962c1bee5c343847030b9cfd87a40a5e succeeded: https://travis-ci.org/bitcoin/bitcoin/builds/202655068\r\n\r\nTravis run for 527205931a636f26d620af25db61dbe9c716fb38 which is 68da3ee4284a07f695e992afd6cdd545604aac90 merged into 9828f9a9962c1bee5c343847030b9cfd87a40a5e failed: https://travis-ci.org/bitcoin/bitcoin/builds/202665925\r\n\r\nTouched CommitDate to rerun travis 68da3ee4284a07f695e992afd6cdd545604aac90 -> 99d032e5b6a5140cdb07d0d209ff7f6a74bc1244 ([multicheck.9](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.9) -> [multicheck.10](https://github.com/ryanofsky/bitcoin/commits/pr/multicheck.10))",
      "created_at" : "2017-02-17T16:34:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280698964",
      "id" : 280698964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-17T16:34:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280698964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Concept ACK",
      "created_at" : "2017-02-18T23:21:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#issuecomment-280882746",
      "id" : 280882746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9773",
      "updated_at" : "2017-02-18T23:21:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280882746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r102442438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/102442438"
         }
      },
      "body" : "> Ok will change, but what are the problems with some platforms?\r\n\r\nThe conceptual problem is that PRI64d can evaluate to anything depending on the platform, e.g. \"%ponyfood\". `tinyformat.h` cannot know about all these platform-dependent escape sequences, so might produce garbled output or even raise an exception. We had a lot of problems with this back in the day with windows and mingw. It is wrong to pass platform-specific stuff to a platform-independent library. Also PRI64d is C99, so not all C++ compilers are guaranteed to have it at all.\r\n\r\nOffline checking could still work, the script would just need to be smart enough to cope with a) translations b) tinyformat's specifiers and type-safety. (b) is actually a subset, not a superset of what platform printfs support (none of the insecure ones like %n) so if anything that should make it easier.",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-22T11:37:40Z",
      "diff_hunk" : "@@ -1072,12 +1073,33 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n     }\n \n     if (fRescan && fRunScan && requests.size() && nLowestTimestamp <= chainActive.Tip()->GetBlockTimeMax()) {\n-        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(nLowestTimestamp) : chainActive.Genesis();\n-\n+        CBlockIndex* pindex = nLowestTimestamp > minimumTimestamp ? chainActive.FindEarliestAtLeast(std::max<int64_t>(nLowestTimestamp - 7200, 0)) : chainActive.Genesis();\n+        CBlockIndex* scannedRange = nullptr;\n         if (pindex) {\n-            pwalletMain->ScanForWalletTransactions(pindex, true);\n+            scannedRange = pwalletMain->ScanForWalletTransactions(pindex, true);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n+\n+        if (!scannedRange || scannedRange->nHeight > pindex->nHeight) {\n+            std::vector<UniValue> results = response.getValues();\n+            response.clear();\n+            response.setArray();\n+            size_t i = 0;\n+            for (const UniValue& request : requests.getValues()) {\n+                // If key creation date is within the successfully scanned\n+                // range, or if the import result already has an error set, let\n+                // the result stand unmodified. Otherwise replace the result\n+                // with an error message.\n+                if (GetImportTimestamp(request, now) - 7200 >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                    response.push_back(results.at(i));\n+                } else {\n+                    UniValue result = UniValue(UniValue::VOBJ);\n+                    result.pushKV(\"success\", UniValue(false));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %\" PRId64 \", transactions may be missing.\", scannedRange->GetBlockTimeMax())));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r102442438",
      "id" : 102442438,
      "original_commit_id" : "b73252de549984a06aae294252d0d055aca43a4a",
      "original_position" : 39,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 23196371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-22T11:40:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/102442438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r102517029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/102517029"
         }
      },
      "body" : "This brings a few Wshadow warnings:\r\n\r\n```\r\nWshadow statistics: \r\n   1 wallet/test/wallet_tests.cpp:377:17: warning: declaration shadows a variable in namespace 'wallet_tests' [-Wshadow]\r\n   1 wallet/test/wallet_tests.cpp:391:17: warning: declaration shadows a variable in namespace 'wallet_tests' [-Wshadow]\r\n   1 wallet/test/wallet_tests.cpp:399:17: warning: declaration shadows a variable in namespace 'wallet_tests' [-Wshadow]\r\n\r\n```\r\n",
      "commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "created_at" : "2017-02-22T17:07:05Z",
      "diff_hunk" : "@@ -355,4 +361,58 @@ BOOST_AUTO_TEST_CASE(ApproximateBestSubset)\n     empty_wallet();\n }\n \n+BOOST_FIXTURE_TEST_CASE(rescan, TestChain100Setup)\n+{\n+    LOCK(cs_main);\n+\n+    // Cap last block file size, and mine new block in a new block file.\n+    CBlockIndex* oldTip = chainActive.Tip();\n+    GetBlockFileInfo(oldTip->GetBlockPos().nFile)->nSize = MAX_BLOCKFILE_SIZE;\n+    CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    CBlockIndex* newTip = chainActive.Tip();\n+\n+    // Verify ScanForWalletTransactions picks up transactions in both the old\n+    // and new block files.\n+    {\n+        CWallet wallet;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9773#discussion_r102517029",
      "id" : 102517029,
      "original_commit_id" : "e2e2f4c856363bbb0e3b5ba4df225f3754c3db39",
      "original_position" : 34,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 34,
      "pull_request_review_id" : 23275021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9773",
      "updated_at" : "2017-02-22T17:07:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/102517029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   }
]
