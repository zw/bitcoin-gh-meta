[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r172624948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172624948"
         }
      },
      "author_association" : "OWNER",
      "body" : "pid_t is not available on windows, I think it would be better to remove the parameter as it's always passed as 0.",
      "commit_id" : "a2ed276b52aec97d37257b7aad73f7f332a926d3",
      "created_at" : "2018-03-06T19:03:19Z",
      "diff_hunk" : "@@ -955,3 +955,10 @@ fs::path AbsPathForConfigVal(const fs::path& path, bool net_specific)\n {\n     return fs::absolute(path, GetDataDir(net_specific));\n }\n+\n+void ScheduleBatchPriority(pid_t tid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r172624948",
      "id" : 172624948,
      "original_commit_id" : "cb89fcaa835b11133143557c264fdc86c111f3b1",
      "original_position" : 5,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 101674328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618",
      "updated_at" : "2018-03-19T06:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172624948",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Is loadblk thread the only thread this is relevant for? what about the script verification threads?",
      "created_at" : "2018-03-06T19:03:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370891217",
      "id" : 370891217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T19:03:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370891217",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r172626755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172626755"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you're right.",
      "commit_id" : "a2ed276b52aec97d37257b7aad73f7f332a926d3",
      "created_at" : "2018-03-06T19:09:39Z",
      "diff_hunk" : "@@ -955,3 +955,10 @@ fs::path AbsPathForConfigVal(const fs::path& path, bool net_specific)\n {\n     return fs::absolute(path, GetDataDir(net_specific));\n }\n+\n+void ScheduleBatchPriority(pid_t tid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r172626755",
      "id" : 172626755,
      "in_reply_to_id" : 172624948,
      "original_commit_id" : "cb89fcaa835b11133143557c264fdc86c111f3b1",
      "original_position" : 5,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 101676484,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618",
      "updated_at" : "2018-03-19T06:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172626755",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this the windows equivalent?\r\n```cpp\r\nSetThreadPriority(GetCurrentThread(), THREAD_MODE_BACKGROUND_BEGIN)\r\n```",
      "created_at" : "2018-03-06T19:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370905121",
      "id" : 370905121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T19:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370905121",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "On Linux `SCHED_BATCH` just prevents batch tasks from pre-empting normal tasks (i.e. normal tasks will run until their timeslice expires, or another normal tasks pre-empts them). When picking the next task to run the scheduler considers `SCHED_OTHER` (i.e. normal) and `SCHED_BATCH` tasks equally. This is why setting `SCHED_BATCH` tasks are only \"mildly disfavored\", because they'll still be considered to run using the normal metrics whenever the scheduler ticks (usually 100Hz or 1000Hz).\r\n\r\nIt sounds like Windows `THREAD_MODE_BACKGROUND_BEGIN` is [much more extreme](https://stackoverflow.com/questions/43051261/why-does-thread-mode-background-begin-cause-my-code-to-run-20x-slower-than-threa). It looks like maybe the Windows equivalent is `THREAD_PRIORITY_BELOW_NORMAL` but I do not know a lot about Windows.\r\n\r\nI don't know as much about the script verification threads. If we are going to set `SCHED_BATCH` for loadblk then it makes sense to me to set the script verification threads to `SCHED_BATCH` as well, at least until the loadblk thread completes. You can freely switch back from `SCHED_BATCH` to `SCHED_OTHER` so it would be possible to only run them in the batch mode while reindexing is happening, or we could just always have them set at batch priority.",
      "created_at" : "2018-03-06T20:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370918802",
      "id" : 370918802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T20:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370918802",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK for this: \r\n\r\none note: you would want something realtime for scriptcheck threads while they are validating a block incoming from network -- we want these to take priority over other threads aggressively.\r\n",
      "created_at" : "2018-03-06T23:00:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370960158",
      "id" : 370960158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T23:00:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370960158",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Re: Jeremy's comment, there are a few ways to increase the priority of the script verification thread to ensure low-latency block relay. On Linux there exists `SCHED_FIFO` and `SCHED_RR` threads which give threads semi-realtime scheduling guarantees, and can ensure that such threads are always prioritized above other threads. Linux also supports per-thread nice values (this is a Linux extension, POSIX specifies that nice values are per-process).\r\n\r\nUsing the other scheduling modes is better for realtime behavior, but somewhat dangerous because such threads can pre-empt all other non-realtime processes, meaning that this could be used as a DOS vector. Changing the nice value is a bit safer. I will probably look into this as part of another PR because I'd like to benchmark that change.",
      "created_at" : "2018-03-09T18:42:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-371908136",
      "id" : 371908136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-09T18:42:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371908136",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the commits can be squashed?",
      "created_at" : "2018-03-18T23:14:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-374064663",
      "id" : 374064663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-18T23:14:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374064663",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @MarcoFalke , squashed to one commit. I'm interested into looking at the RT change Jeremy suggested as well, but that's more impactful so I'd rather do that separately unless people want to see that change done here.",
      "created_at" : "2018-03-19T06:58:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-374117709",
      "id" : 374117709,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-19T06:58:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374117709",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r176436766"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/176436766"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would be nice to log the error message if sched_batch returns -1. EINVAL / EPERM cases would be good to know about.",
      "commit_id" : "a2ed276b52aec97d37257b7aad73f7f332a926d3",
      "created_at" : "2018-03-22T14:20:45Z",
      "diff_hunk" : "@@ -627,6 +627,7 @@ void ThreadImport(std::vector<fs::path> vImportFiles)\n {\n     const CChainParams& chainparams = Params();\n     RenameThread(\"bitcoin-loadblk\");\n+    ScheduleBatchPriority();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r176436766",
      "id" : 176436766,
      "original_commit_id" : "a2ed276b52aec97d37257b7aad73f7f332a926d3",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 106137689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618",
      "updated_at" : "2018-03-22T14:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/176436766",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r176439149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/176439149"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would calling `pthread_setschedparam` instead of `sched_setscheduler` be a little more portable? It seems like you might not need the configure check using this.",
      "commit_id" : "a2ed276b52aec97d37257b7aad73f7f332a926d3",
      "created_at" : "2018-03-22T14:26:41Z",
      "diff_hunk" : "@@ -953,3 +957,12 @@ fs::path AbsPathForConfigVal(const fs::path& path, bool net_specific)\n {\n     return fs::absolute(path, GetDataDir(net_specific));\n }\n+\n+int ScheduleBatchPriority(void) {\n+#if HAVE_SCHED_H && defined(SCHED_BATCH)\n+    sched_param param{.sched_priority = 0};\n+    return sched_setscheduler(0, SCHED_BATCH, &param);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#discussion_r176439149",
      "id" : 176439149,
      "original_commit_id" : "a2ed276b52aec97d37257b7aad73f7f332a926d3",
      "original_position" : 19,
      "path" : "src/util.cpp",
      "position" : 19,
      "pull_request_review_id" : 106137689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12618",
      "updated_at" : "2018-03-22T14:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/176439149",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
