[
   {
      "body" : "It looks to me like the best way to solve this is to add support for the Tor socks extension that adds a resolve command. The tor-resolve tool uses this functionality to do DNS lookups for users: https://gitweb.torproject.org/tor.git/blob/c3e63483b2f16eb1717035eac4c14315b95671f5:/src/tools/tor-resolve.c\r\n\r\nDownside are that it only appears to return a single IP per query and that many exit nodes screw up DNS making it kind of a crapshoot at times.\r\n\r\nAlternatively, we could include a tiny TCP dns resolver and a list of public dns servers that allow TCP querying. This is the approach of TTDNSD: http://www.mulliner.org/collin/ttdnsd.php    The advantage with this is that its potentially useful for both tor users and non-tor users that happen to be behind a broken resolver.  It would be more code to support though.\r\n\r\n",
      "created_at" : "2012-01-03T16:15:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/739#issuecomment-3341895",
      "id" : 3341895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/739",
      "updated_at" : "2012-01-03T16:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3341895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Fixed in a pull today (please help test if you can).\r\n\r\nRelevant code is all in init.cpp:\r\n\r\n    bool fTor = (fUseProxy && addrProxy.port == htons(9050));\r\n    if (fTor)\r\n    {\r\n        // Use SoftSetArg here so user can override any of these if they wish.\r\n        // Note: the GetBoolArg() calls for all of these must happen later.\r\n        SoftSetArg(\"-nolisten\", true);\r\n        SoftSetArg(\"-noirc\", true);\r\n        SoftSetArg(\"-nodnsseed\", true);\r\n        SoftSetArg(\"-noupnp\", true);\r\n        SoftSetArg(\"-upnp\", false);\r\n        SoftSetArg(\"-dns\", false);\r\n    }\r\n",
      "created_at" : "2012-01-03T17:01:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/739#issuecomment-3342682",
      "id" : 3342682,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/739",
      "updated_at" : "2012-01-03T17:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3342682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "GreatÃ¢ÂÂ  though it brings up another issue: Our assumption of tor==proxy on 9050 is broken. \r\n\r\nGood tor practice now is to run multiple socks ports because a single socks port will share tor circuts.  E.g. you visit a website and login as GavinMcSecret  then using the same socks port start bitcoin and send some txn.  Tor will very likely reuse the circuits and exit them from the same place potentially creating a surprising identity binding if the exit operator is watching.\r\n\r\nSo I guess the addrProxy.port == htons(9050) tests should become some kind of GetBoolArg||addrProxy.port == htons(9050).\r\n\r\n",
      "created_at" : "2012-01-03T17:32:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/739#issuecomment-3343118",
      "id" : 3343118,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/739",
      "updated_at" : "2012-01-03T17:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3343118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell: yes, I don't think there is a way to detect tor, hence the awkward heuristic of checking for port 9050. So probably we should add a \"tor\" checkbox in the UI and a `-tor` commandline option?",
      "created_at" : "2012-02-07T13:51:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/739#issuecomment-3848092",
      "id" : 3848092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/739",
      "updated_at" : "2012-02-07T13:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3848092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@gmaxwell For IPv6, I've already implemented SOCKS5 client support, which is also provided by Tor. SOCKS5 supports IPv4, IPv6 and hostname destinations.\r\n\r\nIs there any reason to stick to SOCKS4?",
      "created_at" : "2012-04-05T02:13:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/739#issuecomment-4967295",
      "id" : 4967295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/739",
      "updated_at" : "2012-04-05T02:13:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/4967295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Some legacy and/or custom proxy software supports only SOCKS4. \r\n\r\nI really don't know how much of a problem this is for bitcoin, but dropping support for v4 based on implementing v5 is not very common. Most software has a 'proxy type' setting which can be set to either 4 or 5 (sometimes also 4a which is 4 + hostnames and HTTP proxy CONNECT)\r\n\r\n",
      "created_at" : "2012-04-05T05:28:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/739#issuecomment-4968772",
      "id" : 4968772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/739",
      "updated_at" : "2012-04-05T05:28:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/4968772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I think this can be considered fixed since -proxydns?",
      "created_at" : "2012-05-12T23:40:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/739#issuecomment-5672774",
      "id" : 5672774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/739",
      "updated_at" : "2012-05-12T23:40:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5672774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
