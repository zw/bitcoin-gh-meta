[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is an alternative to #21603. That PR's motivation also applies to this PR:\r\n\r\n> A disk fill attack is an attack where an untrusted party (such as a peer) is able to cheaply make your node log to disk excessively. The excessive logging may fill your disk and thus make your node crash either cleanly (best case: if disk fill rate is relatively slow) or uncleanly (worst case: if disk fill rate is relatively fast).\r\n\r\nAn advantage I see with this approach is that it addresses the [concern](https://github.com/bitcoin/bitcoin/pull/21603#issuecomment-813901411) with log messages being dropped. With this approach, log messages are never dropped; they just don't go back an infinite amount of time :).\r\n\r\nAnother advantage that could prove very useful is that debug log categories can be enabled for an indefinite amount of time (#21603 sensibly does not limit debug logging). It's quite possible that a bug occurs rarely and at an unpredictable time. By the time the bug occurs, it's too late to enable the relevant debug log category. Also, it might be nice to not have to worry so much about adding more logging in general (without even having to condition it on a category). There may be useful stuff to log that we don't currently, because of this disk space concern.\r\n\r\nSome background information: Currently, `debug.log` grows unbounded until `bitcoind` restarts. During startup, if `debug.log` is greater than 11 MB, it's truncated to 10 MB (keeping only the most recent log messages). This PR will make this unnecessary.\r\n\r\nThe rotated log files are kept in a separate directory, to avoid cluttering up the data directory (see discussion below). This directory has the fixed name `debug-rotated` and is located in the same directory as the debug log file. That is, if you move the debug log file to a different location (using `-debuglogfile=path`), then `debug-rotated` also moves to the same directory as the debug log file. (This way they will be on the same file system, allowing renames.)\r\n\r\nAn easy way to manually test this without having to add artificial logging is to enable log rotation by adding these lines to `bitcoin.conf` (or specify on the command line):\r\n```\r\ndebuglogrotatekeep=10\r\ndebugloglimit=1\r\n```\r\nThen start `bitcoind -debug` (enable all debug categories), and observe the `debug.log` file and the rotated files:\r\n```\r\n$ cd .bitcoin\r\n$ ls -l debug.log\r\n-rw------- 1 larry larry     87513 Jun 27 09:11 debug.log\r\n$ ls -l debug-rotated\r\n-rw------- 1 larry larry   1000076 Jun 27 09:03 2021-06-27T15:03:56Z\r\n-rw------- 1 larry larry   1000190 Jun 27 09:05 2021-06-27T15:05:28Z\r\n-rw------- 1 larry larry   1000002 Jun 27 09:07 2021-06-27T15:07:09Z\r\n-rw------- 1 larry larry   1000042 Jun 27 09:07 2021-06-27T15:07:56Z\r\n-rw------- 1 larry larry   1000045 Jun 27 09:10 2021-06-27T15:10:55Z\r\n```\r\nThere's no harm in manually removing these rotated log files, even if `bitcoind` is running. So you could set up some kind of external agent that compresses the rotated files, or ships them off somewhere else, or whatever. (To prevent `bitcoind` from ever deleting rotated log files, set `debuglogrotatekeep=9999999` or something like that.)\r\n\r\nPlease comment or review: @jnewbery @practicalswift @dergoegge ",
      "created_at" : "2021-06-27T15:19:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-869180173",
      "id" : 869180173,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2OTE4MDE3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T17:43:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/869180173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659337909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659337909"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We're ignoring any error from `rename`, not sure that's right.",
      "commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "created_at" : "2021-06-27T15:26:58Z",
      "diff_hunk" : "@@ -273,17 +318,45 @@ void BCLog::Logger::LogPrintStr(const std::string& str, const std::string& loggi\n     if (m_print_to_file) {\n         assert(m_fileout != nullptr);\n \n-        // reopen the log file, if requested\n-        if (m_reopen_file) {\n-            m_reopen_file = false;\n+        auto reopen_file = [&]() {\n             FILE* new_fileout = fsbridge::fopen(m_file_path, \"a\");\n             if (new_fileout) {\n                 setbuf(new_fileout, nullptr); // unbuffered\n                 fclose(m_fileout);\n                 m_fileout = new_fileout;\n+                m_file_size = 0;\n             }\n+        };\n+\n+        // reopen the log file, if requested\n+        if (m_reopen_file) {\n+            m_reopen_file = false;\n+            reopen_file();\n         }\n         FileWriteStr(str_prefixed, m_fileout);\n+        m_file_size += str_prefixed.size();\n+\n+        // If debug.log is large, rotate it (rename and recreate).\n+        if (m_rotate_keep > 0 && m_file_size > m_file_limit * 1e6) {\n+            // Rename debug.log to a name like debug-2021-06-25T22:57:54.log\n+            int64_t seconds = GetTimeMicros()/1e6;\n+            // Don't rotate within the same second to avoid name conflict.\n+            if (m_last_rotate_time < seconds) {\n+                m_last_rotate_time = seconds;\n+                std::string now = FormatISO8601DateTime(seconds);\n+                fs::path rotate{m_file_path};\n+                rotate.remove_filename();\n+                rotate /= \"debug-\" +  now + \".log\";\n+                try {\n+                    fs::rename(m_file_path, rotate);\n+                } catch (const fs::filesystem_error&) {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659337909",
      "id" : 659337909,
      "line" : 352,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTMzNzkwOQ==",
      "original_commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "original_line" : 352,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 104,
      "pull_request_review_id" : 693428595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-27T15:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659337909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659337930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659337930"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This static_cast isn't needed, I'll remove it on the next commit.",
      "commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "created_at" : "2021-06-27T15:27:07Z",
      "diff_hunk" : "@@ -40,6 +41,38 @@ static int FileWriteStr(const std::string &str, FILE *fp)\n     return fwrite(str.data(), 1, str.size(), fp);\n }\n \n+// Remove the oldest rotated files if there are too many.\n+void BCLog::Logger::RemoveRotate()\n+{\n+    while (static_cast<int>(m_rotated_files.size()) > m_rotate_keep) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659337930",
      "id" : 659337930,
      "line" : 47,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTMzNzkzMA==",
      "original_commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "original_line" : 47,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 15,
      "pull_request_review_id" : 693428595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-27T15:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659337930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659338435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659338435"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure this should be a lambda. The advantage is that it's pretty small and it's declared close to its two call sites, but this is a slightly unusual practice; probably better as just a normal method in `BCLog::Logger`. Unless there are objections, I'll make that change in the next commit.",
      "commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "created_at" : "2021-06-27T15:30:37Z",
      "diff_hunk" : "@@ -273,17 +318,45 @@ void BCLog::Logger::LogPrintStr(const std::string& str, const std::string& loggi\n     if (m_print_to_file) {\n         assert(m_fileout != nullptr);\n \n-        // reopen the log file, if requested\n-        if (m_reopen_file) {\n-            m_reopen_file = false;\n+        auto reopen_file = [&]() {\n             FILE* new_fileout = fsbridge::fopen(m_file_path, \"a\");\n             if (new_fileout) {\n                 setbuf(new_fileout, nullptr); // unbuffered\n                 fclose(m_fileout);\n                 m_fileout = new_fileout;\n+                m_file_size = 0;\n             }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659338435",
      "id" : 659338435,
      "line" : 328,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTMzODQzNQ==",
      "original_commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "original_line" : 328,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 80,
      "pull_request_review_id" : 693428595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-27T15:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659338435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659339194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659339194"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If `logrotate` is being used, sending a `SIGHUP` will continue to cause `debug.log` to be reopened (this PR doesn't change that behavior), but if the user wants to continue using that mechanism (`logrotate(8)`), they should disable this PR's log rotation (by setting `-debuglogrotatekeep=0` in the configuration). But if they forget (definitely need release notes on this), I _think_ it will be okay, because either this PR's log rotation will always happen (since it waits only until `debug.log` reaches 1 MB by default), or the `logrotate(8)` will happen (if the file size threshold is less than 1 MB). It would be confusing if both were happening! Maybe more thought is needed here.\r\n\r\nAn alternative might be to just remove this behavior (`SIGHUP` causing `debug.log` to be reopened), but then `logrotate(8)` will no longer work, and there may be existing users that are all set up to use `logrotate(8)`.",
      "commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "created_at" : "2021-06-27T15:36:20Z",
      "diff_hunk" : "@@ -273,17 +318,45 @@ void BCLog::Logger::LogPrintStr(const std::string& str, const std::string& loggi\n     if (m_print_to_file) {\n         assert(m_fileout != nullptr);\n \n-        // reopen the log file, if requested\n-        if (m_reopen_file) {\n-            m_reopen_file = false;\n+        auto reopen_file = [&]() {\n             FILE* new_fileout = fsbridge::fopen(m_file_path, \"a\");\n             if (new_fileout) {\n                 setbuf(new_fileout, nullptr); // unbuffered\n                 fclose(m_fileout);\n                 m_fileout = new_fileout;\n+                m_file_size = 0;\n             }\n+        };\n+\n+        // reopen the log file, if requested\n+        if (m_reopen_file) {\n+            m_reopen_file = false;\n+            reopen_file();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r659339194",
      "id" : 659339194,
      "line" : 334,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTMzOTE5NA==",
      "original_commit_id" : "91d796a21a8c0fbb57d13fb1ca48505bb8d52845",
      "original_line" : 334,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 86,
      "pull_request_review_id" : 693428595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-27T15:45:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659339194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23203](https://github.com/bitcoin/bitcoin/pull/23203) ([POC] build: static musl libc based bitcoind (with LTO) by fanquake)\n* [#22937](https://github.com/bitcoin/bitcoin/pull/22937) (refactor: Forbid calling unsafe fs::path(std::string) constructor and fs::path::string() method by ryanofsky)\n* [#21603](https://github.com/bitcoin/bitcoin/pull/21603) (log: Mitigate disk filling attacks by rate limiting LogPrintf by dergoegge)\n* [#20744](https://github.com/bitcoin/bitcoin/pull/20744) (Use std::filesystem. Remove Boost Filesystem & System by fanquake)\n* [#15719](https://github.com/bitcoin/bitcoin/pull/15719) (Wallet passive startup by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-06-27T16:40:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-869191643",
      "id" : 869191643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2OTE5MTY0Mw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/869191643/reactions"
      },
      "updated_at" : "2021-10-15T06:01:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/869191643",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is an interesting approach and i like the concept of log rotation but this is a bigger behavior change than [#21603](https://github.com/bitcoin/bitcoin/pull/21603) and i am not sure if always dropping (old) logs should be the default behavior. \r\n \r\n > An advantage I see with this approach is that it addresses the [concern](https://github.com/bitcoin/bitcoin/pull/21603#issuecomment-813901411) with log messages being dropped. With this approach, log messages are never dropped; they just don't go back an infinite amount of time :).\r\n \r\nContinuously dropping logs seems like an aggressive change to me because why drop the logs when there is no attack? I haven't had problems with logfile sizes in normal node operation. (maybe thats just me) \r\n\r\n> Some background information: Currently, `debug.log` grows unbounded until `bitcoind` restarts. During startup, if `debug.log` is greater than 11 MB, it's truncated to 10 MB (keeping only the most recent log messages). This PR will make this unnecessary.\r\n\r\nI think that the current behavior is actually quite useful because in case of an issue (e.g.: a crash) we have the entire log of the nodes lifespan.\r\n\r\nThis also seems to opens a similar attack vector as the global rate limiting did, an attacker (that knows of two bugs one of which is a disk filling bug) can execute an attack and then use the disk filling bug to rotate the logs out that had info about the attack.\r\n",
      "created_at" : "2021-06-28T10:11:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-869557601",
      "id" : 869557601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2OTU1NzYwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-28T10:11:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/869557601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r660853801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/660853801"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should probably error if the user has configured rotation explicitly.",
      "commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "created_at" : "2021-06-29T18:11:25Z",
      "diff_hunk" : "@@ -53,6 +86,17 @@ bool BCLog::Logger::StartLogging()\n         if (!m_fileout) {\n             return false;\n         }\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            m_rotate_keep = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r660853801",
      "id" : 660853801,
      "line" : 94,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MDg1MzgwMQ==",
      "original_commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "original_line" : 94,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 56,
      "pull_request_review_id" : 695354386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-29T18:14:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/660853801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r660854364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/660854364"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What if I want to rotate, but never delete?",
      "commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "created_at" : "2021-06-29T18:12:15Z",
      "diff_hunk" : "@@ -276,14 +320,43 @@ void BCLog::Logger::LogPrintStr(const std::string& str, const std::string& loggi\n         // reopen the log file, if requested\n         if (m_reopen_file) {\n             m_reopen_file = false;\n-            FILE* new_fileout = fsbridge::fopen(m_file_path, \"a\");\n-            if (new_fileout) {\n-                setbuf(new_fileout, nullptr); // unbuffered\n-                fclose(m_fileout);\n-                m_fileout = new_fileout;\n-            }\n+            ReopenFile();\n         }\n         FileWriteStr(str_prefixed, m_fileout);\n+        m_file_size += str_prefixed.size();\n+\n+        // If debug.log is large, rotate it (rename and recreate).\n+        if (m_rotate_keep > 0 && m_file_size > m_file_limit * 1e6) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r660854364",
      "id" : 660854364,
      "line" : 329,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MDg1NDM2NA==",
      "original_commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "original_line" : 329,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 81,
      "pull_request_review_id" : 695354386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-29T18:14:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/660854364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r660854968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/660854968"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, error if the user has configured both",
      "commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "created_at" : "2021-06-29T18:13:13Z",
      "diff_hunk" : "@@ -294,6 +367,9 @@ void BCLog::Logger::ShrinkDebugFile()\n \n     assert(!m_file_path.empty());\n \n+    // File rotation makes this unnecessary.\n+    if (m_rotate_keep > 0) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r660854968",
      "id" : 660854968,
      "line" : 371,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MDg1NDk2OA==",
      "original_commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "original_line" : 371,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 120,
      "pull_request_review_id" : 695354386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-29T18:14:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/660854968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r664184552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664184552"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> What if I want to rotate, but never delete?\r\n\r\n`-debuglogrotatekeep=9999999` or is that ugly? Should there be a separate `-debuglogenable` boolean (default true; if set to false, behave as today), and then `-debuglogrotatekeep=0` could mean \"never delete\". Would that be preferable? Or something else? Thanks for the comments!",
      "commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "created_at" : "2021-07-06T01:50:30Z",
      "diff_hunk" : "@@ -276,14 +320,43 @@ void BCLog::Logger::LogPrintStr(const std::string& str, const std::string& loggi\n         // reopen the log file, if requested\n         if (m_reopen_file) {\n             m_reopen_file = false;\n-            FILE* new_fileout = fsbridge::fopen(m_file_path, \"a\");\n-            if (new_fileout) {\n-                setbuf(new_fileout, nullptr); // unbuffered\n-                fclose(m_fileout);\n-                m_fileout = new_fileout;\n-            }\n+            ReopenFile();\n         }\n         FileWriteStr(str_prefixed, m_fileout);\n+        m_file_size += str_prefixed.size();\n+\n+        // If debug.log is large, rotate it (rename and recreate).\n+        if (m_rotate_keep > 0 && m_file_size > m_file_limit * 1e6) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r664184552",
      "id" : 664184552,
      "in_reply_to_id" : 660854364,
      "line" : 329,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDE4NDU1Mg==",
      "original_commit_id" : "b526922724eba3221db84d7ba6624b14c480a74e",
      "original_line" : 329,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 81,
      "pull_request_review_id" : 699476453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-06T01:50:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664184552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Continuously dropping logs seems like an aggressive change to me because why drop the logs when there is no attack? I haven't had problems with logfile sizes in normal node operation. (maybe thats just me)\r\n\r\nI come from a storage system background, and dropping the oldest logs was standard practice. (This is why there's a `logrotate` facility on Unix and similar systems.) A general principle is that any demon process that can run for an arbitrary amount of time should not use resources in proportion to how long it's been running. Yes, resource usage can increase quickly early, and after reaching \"steady-state\" can go up and down over time. But the system shouldn't, for example, gradually use more memory or gradually require more CPU (requiring a restart to fix). The current logging design violates this principle as regards disk usage. So even without an active attack, we should be pruning the log file.\r\n\r\n> I think that the current behavior is actually quite useful because in case of an issue (e.g.: a crash) we have the entire log of the nodes lifespan.\r\n\r\nThat's true, but for reasons I already stated, that's not practical. The most useful information is likely to be in the most recent logs. The user can always increase the amount of logging (in effect, to infinity if needed). Or disable this feature (work as today). Consider another option the user has: Run some kind of small agent (even just a small shell script) that watches for new rotated debug log files, and copies them off to some other place with tons of storage. Or compresses them. Or filters out interesting stuff from them and deletes them.\r\n\r\n> This also seems to opens a similar attack vector as the global rate limiting did, an attacker (that knows of two bugs one of which is a disk filling bug) can execute an attack and then use the disk filling bug to rotate the logs out that had info about the attack.\r\n\r\nWell, this is unlikely-squared. This isn't something I'm worried about, but maybe I'm wrong.\r\n\r\nThanks for your comments!",
      "created_at" : "2021-07-06T02:15:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-874410976",
      "id" : 874410976,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDQxMDk3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T02:15:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874410976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added commit d885f0b3fad93b10cf400c596d57063687d05efb to address @luke-jr's review comments (aside from \"[What if I want to rotate, but never delete](https://github.com/bitcoin/bitcoin/pull/22350#discussion_r660854364)\" because I'm not sure which is the best approach). There are no tests or release notes, because still looking for approach or concept ACK.",
      "created_at" : "2021-07-06T18:12:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-874977115",
      "id" : 874977115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDk3NzExNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T18:12:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874977115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force-pushed to fix CI failure (missing #include directive)",
      "created_at" : "2021-07-06T19:31:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-875026591",
      "id" : 875026591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NTAyNjU5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T19:31:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875026591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force-pushed to fix CI failures, also added a functional test.",
      "created_at" : "2021-07-09T02:34:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-876868239",
      "id" : 876868239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3Njg2ODIzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-09T02:34:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876868239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r669807029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669807029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~To match current behavior, wouldn't you want `DEFAULT_DEBUGLOGMB` to be 10 and `DEFAULT_LOGROTATEKEEP` to be 1?~\r\n\r\nNevermind, that isn't current behavior either. Just curious about the constants.",
      "commit_id" : "ea728a30665aa1d72e88bb5ad44cc14903a49a7d",
      "created_at" : "2021-07-14T17:18:03Z",
      "diff_hunk" : "@@ -24,6 +25,8 @@ static const bool DEFAULT_LOGTIMESTAMPS = true;\n static const bool DEFAULT_LOGTHREADNAMES = false;\n static const bool DEFAULT_LOGSOURCELOCATIONS = false;\n extern const char * const DEFAULT_DEBUGLOGFILE;\n+static const int DEFAULT_DEBUGLOGROTATEKEEP = 10;\n+static const int DEFAULT_DEBUGLOGMB = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r669807029",
      "id" : 669807029,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTgwNzAyOQ==",
      "original_commit_id" : "c82eece30c84605d6815b3014f57cc281cff7cbe",
      "original_line" : 29,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : 13,
      "pull_request_review_id" : 706529649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-14T17:19:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669807029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r669907219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669907219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, @narula, that's still a good question. The idea of those defaults is that between 10 MB and 11 MB of log messages would be retained (just after a log rotation, 10 MB because there'd be 10 rotated files at 1 MB each plus an empty `debug.log`; just before log rotation, 10 MB for the same reason plus a 1 MB `debug.log`. This matches the current disk usage if `bitcoind` is restarted often (if not, then the `debug.log` size can increase without limit).\r\n\r\nIf the defaults were `DEFAULT_DEBUGLOGMB=10` and `DEFAULT_LOGROTATEKEEP=1` then the logging storage would vary from 10 MB (just after rotation) to 20 MB (just before rotation).\r\n\r\nOne could argue that the defaults could be quite a bit larger because the current default (10 MB minimum) was chosen when disks were smaller than they are typically today. But there could be that _one_ user whose disk is almost full, and upgrading to a release with this PR would soon run their disk out to space if the defaults were larger. (You might say that a node's disk space requirement  grows indefinitely anyway as more blocks are added to the blockchain, but that's not necessarily so because nodes can be configured with block pruning enabled.)",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-07-14T19:51:10Z",
      "diff_hunk" : "@@ -24,6 +25,8 @@ static const bool DEFAULT_LOGTIMESTAMPS = true;\n static const bool DEFAULT_LOGTHREADNAMES = false;\n static const bool DEFAULT_LOGSOURCELOCATIONS = false;\n extern const char * const DEFAULT_DEBUGLOGFILE;\n+static const int DEFAULT_DEBUGLOGROTATEKEEP = 10;\n+static const int DEFAULT_DEBUGLOGMB = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r669907219",
      "id" : 669907219,
      "in_reply_to_id" : 669807029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTkwNzIxOQ==",
      "original_commit_id" : "c82eece30c84605d6815b3014f57cc281cff7cbe",
      "original_line" : 29,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 706659062,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-14T19:51:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669907219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "There doesn't seem to be much support for this PR, and at least part of the problem may be that it changes default behavior, and that could surprise some users. So I force-pushed a small change so that by default, there is no functional change (preserve existing behavior). If you want to enable log rotation, add lines like these to your `bitcoin.conf` file:\r\n```\r\ndebuglogrotatekeep=10\r\ndebugloglimit=1\r\n```\r\n(This will retain 10 rotated files, each around 1 MB.) Starting with `-debug` will generate a lot more logging.\r\n\r\nI think this version is much safer; if log rotation proves to be popular, we can consider making it default behavior later.",
      "created_at" : "2021-08-08T21:56:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-894860956",
      "id" : 894860956,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841Vn6c",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-08T22:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894860956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nI strongly agree with the principle above:\r\n\r\n> A general principle is that any demon process that can run for an arbitrary amount of time should not use resources in proportion to how long it's been running. Yes, resource usage can increase quickly early, and after reaching \"steady-state\" can go up and down over time. But the system shouldn't, for example, gradually use more memory or gradually require more CPU (requiring a restart to fix). The current logging design violates this principle as regards disk usage. So even without an active attack, we should be pruning the log file.\r\n\r\nI also agree with the decision to make this optional for users (i.e it will not change default behavior). Having this as a config option would make me feel more comfortable running a node with `-debug`.\r\n\r\nAlso, not really important, but a personal preference: I like having logs split into timestamped files as it makes it much easier for me to search logs during the period where I believe the issue occurred as opposed to opening and searching a very large file",
      "created_at" : "2021-08-11T15:18:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-896917204",
      "id" : 896917204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841dd7U",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T15:18:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896917204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687051595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687051595"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "previously when using `-debuglogfile=path`, i could specify any name for the file. now, if anything but `debug.log` is specified for the name, `bitcoind` fails to start without error (confirmed this while testing). \r\n\r\nimo, rotation should work regardless of the filename, but at the very least there should be an error if i don't specify `debug.log` with log rotation enabled",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-11T17:53:42Z",
      "diff_hunk" : "@@ -0,0 +1,18 @@\n+New settings\n+------------\n+\n+- The `debug.log` file grows without bound until the node\n+  is restarted, at which time it is trimmed to 10 MB. Beginning with this\n+  release, you can enable log file rotation. When the `debug.log` file\n+  reaches 1 MB, it's renamed to a name that includes the current date and\n+  time, such as `debug-2021-06-27T21:19:42Z.log` and `debug.log` is\n+  recreated as an empty file. Running `cat` or `grep` with an argument\n+  `debug*.log` accesses all debug log files, including the current one\n+  (`debug.log`) in time-order. The `-debuglogrotatekeep=n` configuration\n+  option specifies the number of rotated debug log files that are retained\n+  (default 0, log rotation disabled). The `-debugloglimit=n`\n+  configuration option specifies how large the `debug.log` file must\n+  become (in MB) before it is rotated (default is 10). If you enable\n+  log file rotation and specify an\n+  alternate debug log file name using `-debuglogfile=path`, the last\n+  component of the path must be `debug.log`. (#22350)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687051595",
      "id" : 687051595,
      "line" : 18,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzA1MTU5NQ==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "doc/release-notes-22350.md",
      "position" : 18,
      "pull_request_review_id" : 727778945,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T18:15:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687051595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687059559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687059559"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this output isn't showing (not sure why). i ran:\r\n\r\n```\r\n./src/bitcoind -daemon -debuglogrotatekeep=3 -debugloglimit=1 -debuglogfile=/home/josibake/bitcoin/j.log\r\n```\r\nand got \"Bitcoin Core Starting,\" but it fails to start without any errors.",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-11T18:05:01Z",
      "diff_hunk" : "@@ -51,8 +84,43 @@ bool BCLog::Logger::StartLogging()\n         assert(!m_file_path.empty());\n         m_fileout = fsbridge::fopen(m_file_path, \"a\");\n         if (!m_fileout) {\n-            return false;\n+            return strprintf(\"Could not open debug log file %s\", m_file_path.string());\n+        }\n+\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s does not appear to be a regular file; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a regular file \"\n+                    \"as the debug log file using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        // It gets complicated to add a timestamp to an arbitrary file name,\n+        // so require \"debug.log\".\n+        if (m_file_path.filename() != \"debug.log\") {\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s is not named \\\"debug.log\\\"; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a debug log file \"\n+                    \"path that ends in \\\"/debug.log\\\" using -debuglogfile.\",\n+                    m_file_path.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687059559",
      "id" : 687059559,
      "line" : 114,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzA1OTU1OQ==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 114,
      "original_position" : 81,
      "original_start_line" : 109,
      "path" : "src/logging.cpp",
      "position" : 81,
      "pull_request_review_id" : 727778945,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : 109,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-11T18:15:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687059559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687060618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687060618"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "i also got a silent failure trying to specify a logsize value < 1. i ran with `-debugloglimit=0.5`, got no errors, but the node failed to start. i also ran with `-debugloglimit=1.5` without issue so i dont think its the decimal",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-11T18:06:48Z",
      "diff_hunk" : "@@ -51,8 +84,43 @@ bool BCLog::Logger::StartLogging()\n         assert(!m_file_path.empty());\n         m_fileout = fsbridge::fopen(m_file_path, \"a\");\n         if (!m_fileout) {\n-            return false;\n+            return strprintf(\"Could not open debug log file %s\", m_file_path.string());\n+        }\n+\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s does not appear to be a regular file; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a regular file \"\n+                    \"as the debug log file using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        // It gets complicated to add a timestamp to an arbitrary file name,\n+        // so require \"debug.log\".\n+        if (m_file_path.filename() != \"debug.log\") {\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s is not named \\\"debug.log\\\"; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a debug log file \"\n+                    \"path that ends in \\\"/debug.log\\\" using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        if (m_file_limit == 0) {\n+            return strprintf(\n+                \"The debug log file %s size limit in MB must be greater than zero.\",\n+                m_file_path.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687060618",
      "id" : 687060618,
      "line" : 121,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzA2MDYxOA==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 121,
      "original_position" : 88,
      "original_start_line" : 120,
      "path" : "src/logging.cpp",
      "position" : 88,
      "pull_request_review_id" : 727778945,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : 120,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-11T18:15:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687060618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687405694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687405694"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks so much for your comments; these are very useful.\r\n\r\n> ... rotation should work regardless of the filename ...\r\n\r\nI like your idea. After giving this more thought, perhaps the best approach is to let `-debuglogfile=path` to work as usual, but create a directory with a fixed name like `rotated-logs` (or `rotated-debug-logs`) and put all the _rotated_ log files within that directory. (The active debug log file, `debug.log` or as specified by `-debuglogfile`, would be as it is today, no change.) Because the rotated log files are in a directory with a specific purpose, they can have simple names like `2021-06-27T15:10:55Z.log`. They wouldn't have to be named according to the `-debuglogfile` argument.\r\n\r\nThis would have an added benefit: As I've been running this code to test it, my data directory now looks \"messy\" or polluted, with all these rotated log files that usually aren't very important -- why should they be so visible and prominent?\r\n```\r\n$ ls ~/.bitcoin\r\nbanlist.dat   debug-2021-06-27T21:19:42Z.log  fee_estimates.dat  signet\r\nbanlist.json  debug-2021-07-09T00:38:43Z.log  indexes            testnet3\r\nbitcoin.conf  debug-2021-07-14T16:32:30Z.log  mempool.dat        wallets\r\nbitcoind.pid  debug-2021-07-17T14:01:27Z.log  peers.dat          wallets-empty\r\nblocks        debug-2021-08-10T20:03:04Z.log  regtest\r\nchainstate    debug.log                       settings.json\r\n$\r\n```\r\n(And I've got only 5 rotated log files; there could be many more.) A small disadvantage is that it would be slightly more difficult to concatenate (or grep) all of the log files in time-order:\r\n```\r\n$ cat rotated-logs/* debug.log\r\n```\r\n(instead of just `cat debug*.log`) but that's not bad.\r\n\r\nSo unless there are objections, I'll make this change within the next few days.",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-12T05:47:27Z",
      "diff_hunk" : "@@ -0,0 +1,18 @@\n+New settings\n+------------\n+\n+- The `debug.log` file grows without bound until the node\n+  is restarted, at which time it is trimmed to 10 MB. Beginning with this\n+  release, you can enable log file rotation. When the `debug.log` file\n+  reaches 1 MB, it's renamed to a name that includes the current date and\n+  time, such as `debug-2021-06-27T21:19:42Z.log` and `debug.log` is\n+  recreated as an empty file. Running `cat` or `grep` with an argument\n+  `debug*.log` accesses all debug log files, including the current one\n+  (`debug.log`) in time-order. The `-debuglogrotatekeep=n` configuration\n+  option specifies the number of rotated debug log files that are retained\n+  (default 0, log rotation disabled). The `-debugloglimit=n`\n+  configuration option specifies how large the `debug.log` file must\n+  become (in MB) before it is rotated (default is 10). If you enable\n+  log file rotation and specify an\n+  alternate debug log file name using `-debuglogfile=path`, the last\n+  component of the path must be `debug.log`. (#22350)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687405694",
      "id" : 687405694,
      "in_reply_to_id" : 687051595,
      "line" : 18,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzQwNTY5NA==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "doc/release-notes-22350.md",
      "position" : 18,
      "pull_request_review_id" : 728200485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T05:47:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687405694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687405743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687405743"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that's because you've started it with `-daemon`. It hasn't initialized the logging yet, so it has nowhere to write the error message. If you start without `-daemon` you should see the error.",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-12T05:47:35Z",
      "diff_hunk" : "@@ -51,8 +84,43 @@ bool BCLog::Logger::StartLogging()\n         assert(!m_file_path.empty());\n         m_fileout = fsbridge::fopen(m_file_path, \"a\");\n         if (!m_fileout) {\n-            return false;\n+            return strprintf(\"Could not open debug log file %s\", m_file_path.string());\n+        }\n+\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s does not appear to be a regular file; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a regular file \"\n+                    \"as the debug log file using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        // It gets complicated to add a timestamp to an arbitrary file name,\n+        // so require \"debug.log\".\n+        if (m_file_path.filename() != \"debug.log\") {\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s is not named \\\"debug.log\\\"; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a debug log file \"\n+                    \"path that ends in \\\"/debug.log\\\" using -debuglogfile.\",\n+                    m_file_path.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687405743",
      "id" : 687405743,
      "in_reply_to_id" : 687059559,
      "line" : 114,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzQwNTc0Mw==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 114,
      "original_position" : 81,
      "original_start_line" : 109,
      "path" : "src/logging.cpp",
      "position" : 81,
      "pull_request_review_id" : 728200534,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : 109,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-12T05:47:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687405743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687405780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687405780"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's because it's parsing the argument as an integer, and when it gets to the decimal point, it stops parsing, interpreting the argument as zero. Specifying fractions of a megabyte is probably unnecessary, but maybe it should print a good error message. I'll see what I can do.",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-12T05:47:40Z",
      "diff_hunk" : "@@ -51,8 +84,43 @@ bool BCLog::Logger::StartLogging()\n         assert(!m_file_path.empty());\n         m_fileout = fsbridge::fopen(m_file_path, \"a\");\n         if (!m_fileout) {\n-            return false;\n+            return strprintf(\"Could not open debug log file %s\", m_file_path.string());\n+        }\n+\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s does not appear to be a regular file; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a regular file \"\n+                    \"as the debug log file using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        // It gets complicated to add a timestamp to an arbitrary file name,\n+        // so require \"debug.log\".\n+        if (m_file_path.filename() != \"debug.log\") {\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s is not named \\\"debug.log\\\"; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a debug log file \"\n+                    \"path that ends in \\\"/debug.log\\\" using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        if (m_file_limit == 0) {\n+            return strprintf(\n+                \"The debug log file %s size limit in MB must be greater than zero.\",\n+                m_file_path.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687405780",
      "id" : 687405780,
      "in_reply_to_id" : 687060618,
      "line" : 121,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzQwNTc4MA==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 121,
      "original_position" : 88,
      "original_start_line" : 120,
      "path" : "src/logging.cpp",
      "position" : 88,
      "pull_request_review_id" : 728200563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : 120,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-12T05:47:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687405780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687524387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687524387"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "regarding many log files creating clutter in the root directory, i agree having a logs folder definitely makes sense. personally, i would prefer a `logs/` folder containing all the logs as this makes it clear to the user there is nothing special about the `debug.log` file vs what's in the logs directory. it also keeps things simple for concatenating and grepping. \r\n\r\nsince the debuglogfile custom name is known, wouldn't it be possible to attempt to split the filename into a name and extension (`<name>-<timestamp>.<ext>`), and then handle the special case where the user doesn't supply an extension (i.e `logs`, which would become `logs`, `logs-<timestamp>`)?\r\n\r\nalso, feel free to wait for more feedback from others before making changes :)",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-12T08:59:57Z",
      "diff_hunk" : "@@ -0,0 +1,18 @@\n+New settings\n+------------\n+\n+- The `debug.log` file grows without bound until the node\n+  is restarted, at which time it is trimmed to 10 MB. Beginning with this\n+  release, you can enable log file rotation. When the `debug.log` file\n+  reaches 1 MB, it's renamed to a name that includes the current date and\n+  time, such as `debug-2021-06-27T21:19:42Z.log` and `debug.log` is\n+  recreated as an empty file. Running `cat` or `grep` with an argument\n+  `debug*.log` accesses all debug log files, including the current one\n+  (`debug.log`) in time-order. The `-debuglogrotatekeep=n` configuration\n+  option specifies the number of rotated debug log files that are retained\n+  (default 0, log rotation disabled). The `-debugloglimit=n`\n+  configuration option specifies how large the `debug.log` file must\n+  become (in MB) before it is rotated (default is 10). If you enable\n+  log file rotation and specify an\n+  alternate debug log file name using `-debuglogfile=path`, the last\n+  component of the path must be `debug.log`. (#22350)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687524387",
      "id" : 687524387,
      "in_reply_to_id" : 687051595,
      "line" : 18,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzUyNDM4Nw==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "doc/release-notes-22350.md",
      "position" : 18,
      "pull_request_review_id" : 728352526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T08:59:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687524387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687529537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687529537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "makes sense. i do think its important to throw an error when `-daemon` is used, else the user is likely to assume there node has started fine after seeing \"Bitcoin Core Starting.\" for example, if i try to start my node with:\r\n\r\n```bash\r\n./src/bitcoind -datadir=foo -daemon\r\n```\r\ni will get:\r\n```\r\nError: Specified data directory \"foo\" does not exist.\r\n```",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-12T09:06:54Z",
      "diff_hunk" : "@@ -51,8 +84,43 @@ bool BCLog::Logger::StartLogging()\n         assert(!m_file_path.empty());\n         m_fileout = fsbridge::fopen(m_file_path, \"a\");\n         if (!m_fileout) {\n-            return false;\n+            return strprintf(\"Could not open debug log file %s\", m_file_path.string());\n+        }\n+\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s does not appear to be a regular file; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a regular file \"\n+                    \"as the debug log file using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        // It gets complicated to add a timestamp to an arbitrary file name,\n+        // so require \"debug.log\".\n+        if (m_file_path.filename() != \"debug.log\") {\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s is not named \\\"debug.log\\\"; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a debug log file \"\n+                    \"path that ends in \\\"/debug.log\\\" using -debuglogfile.\",\n+                    m_file_path.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687529537",
      "id" : 687529537,
      "in_reply_to_id" : 687059559,
      "line" : 114,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzUyOTUzNw==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 114,
      "original_position" : 81,
      "original_start_line" : 109,
      "path" : "src/logging.cpp",
      "position" : 81,
      "pull_request_review_id" : 728359563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : 109,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-12T09:06:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687529537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687533598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687533598"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "i went back and confirmed, even with 1.5 it is still rotating in 1mb chunks. might be worth adding something to the option help that debugloglimit is in MB and must be specified as an integer ",
      "commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "created_at" : "2021-08-12T09:12:04Z",
      "diff_hunk" : "@@ -51,8 +84,43 @@ bool BCLog::Logger::StartLogging()\n         assert(!m_file_path.empty());\n         m_fileout = fsbridge::fopen(m_file_path, \"a\");\n         if (!m_fileout) {\n-            return false;\n+            return strprintf(\"Could not open debug log file %s\", m_file_path.string());\n+        }\n+\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s does not appear to be a regular file; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a regular file \"\n+                    \"as the debug log file using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        // It gets complicated to add a timestamp to an arbitrary file name,\n+        // so require \"debug.log\".\n+        if (m_file_path.filename() != \"debug.log\") {\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s is not named \\\"debug.log\\\"; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a debug log file \"\n+                    \"path that ends in \\\"/debug.log\\\" using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        if (m_file_limit == 0) {\n+            return strprintf(\n+                \"The debug log file %s size limit in MB must be greater than zero.\",\n+                m_file_path.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687533598",
      "id" : 687533598,
      "in_reply_to_id" : 687060618,
      "line" : 121,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzUzMzU5OA==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 121,
      "original_position" : 88,
      "original_start_line" : 120,
      "path" : "src/logging.cpp",
      "position" : 88,
      "pull_request_review_id" : 728364606,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : 120,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-12T09:12:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687533598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Strong Concept ACK\r\n\r\nI think one of the main reasons why restricting unlimited growth of the log file was never seen as particularly problematic in Bitcoin Core is the fact that running bitcoind with default parameters (that is, w/o pruning) already consumes (potentially) infinite disk space over time. Having a growth rate of > 1 GB per week of the block chain on mainnet, one would hardly be worried about the additional space consumption of relatively small log messages.\r\n\r\nThat said, I still fully agree that we should support log-rotating for the following reasons:\r\n* log file growth is less deterministic than block chain growth; there _could_ be a scenario that we are not aware of yet that leads to massive log ouputs, that an attacker could exploit\r\n* running pruned nodes will be more and more common in the future, and for those it makes even more sense to also limit the log-file size (I could imagine that users with very limited disk-space, running with `-prune=550` ran already into problems due to unexpected unlimited log file growth)\r\n* fulfilling the principle you mentioned: \r\n> [...] any demon process that can run for an arbitrary amount of time should not use resources in proportion to how long it's been running.\r\n\r\nI also think it's better to keep the default behaviour by now as it is. Maybe it's worth it mentioning in the docs that using this new feature is recommended for pruned node users?\r\n\r\nFeel free to tag me if this PR is out of draft, will be happy to review.",
      "created_at" : "2021-08-13T10:12:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-898350416",
      "id" : 898350416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841i71Q",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-13T10:12:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898350416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r688822931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688822931"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@josibake \r\n> i do think its important to throw an error when -daemon is used ...\r\n\r\nI looked into this more, and it's not trivial to fix. The problem is that bitcoind has already \"daemonized\" itself by the time it gets around to initializing the logging, which is later than when it tries to open the data directory. This problem happens without the current PR:\r\n```\r\n$ src/bitcoind -daemon -debuglogfile=some/non-existent/path\r\nBitcoin Core starting\r\n$ \r\n```\r\nand there's no indication that anything went wrong (the exit status is even 0, success). So I think this can be fixed in a separate PR.",
      "commit_id" : "f5de5b022aa4c5350bcf1a62d09b9b1f7bccfed6",
      "created_at" : "2021-08-13T23:17:37Z",
      "diff_hunk" : "@@ -51,8 +84,43 @@ bool BCLog::Logger::StartLogging()\n         assert(!m_file_path.empty());\n         m_fileout = fsbridge::fopen(m_file_path, \"a\");\n         if (!m_fileout) {\n-            return false;\n+            return strprintf(\"Could not open debug log file %s\", m_file_path.string());\n+        }\n+\n+        // Special files (e.g. device nodes) may not have a size.\n+        try {\n+            m_file_size = fs::file_size(m_file_path);\n+        } catch (const fs::filesystem_error&) {\n+            // We can't do log rotation if it's not a regular file.\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s does not appear to be a regular file; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a regular file \"\n+                    \"as the debug log file using -debuglogfile.\",\n+                    m_file_path.string());\n+            }\n+            m_rotate_keep = 0;\n+        }\n+        // It gets complicated to add a timestamp to an arbitrary file name,\n+        // so require \"debug.log\".\n+        if (m_file_path.filename() != \"debug.log\") {\n+            if (m_rotate_requested) {\n+                return strprintf(\n+                    \"The debug log file %s is not named \\\"debug.log\\\"; \"\n+                    \"this prevents log rotation. Please disable log rotation by \"\n+                    \"specifying -debuglogrotatekeep=0 or specify a debug log file \"\n+                    \"path that ends in \\\"/debug.log\\\" using -debuglogfile.\",\n+                    m_file_path.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#discussion_r688822931",
      "id" : 688822931,
      "in_reply_to_id" : 687059559,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4ODgyMjkzMQ==",
      "original_commit_id" : "7db585f34c3e8ddf9ff11aedd49cad0170989c8e",
      "original_line" : 77,
      "original_position" : 81,
      "original_start_line" : 109,
      "path" : "src/logging.cpp",
      "position" : null,
      "pull_request_review_id" : 730021971,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22350",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-13T23:17:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688822931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the concept review, @theStack, I just force-pushed a new version that's a lot better, I think, and implements the suggestions here: https://github.com/bitcoin/bitcoin/pull/22350#discussion_r687405694",
      "created_at" : "2021-08-13T23:32:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-898768311",
      "id" : 898768311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841kh23",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-13T23:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898768311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force-pushed a small change to ensure that rotated debug log files don't have partial lines. Each line is guaranteed to be a full line beginning with a timestamp. \r\n\r\nThis is an improvement over master, because with master (or with this PR without log rotation enabled), if the debug log file is larger than 11 MB when `bitcoind` starts, it will be truncated to exactly 10 MB, and this almost always results in the file beginning with a partial line. This can mess up attempts to parse the debug log file.",
      "created_at" : "2021-08-16T05:23:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-899223185",
      "id" : 899223185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841mQ6R",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T05:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899223185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ~0 on this. We always used to be against integrating log rotation because it can be handled by external tools (sure, on some operating systems this is more difficult, but I'm sure there are solutions for WIndows too). We should avoid the case where `bitcoind` becomes a systemd-like project that absorbs any possible functionality of a system. It's a maintainance nightmare.",
      "created_at" : "2021-08-16T14:06:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-899539876",
      "id" : 899539876,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841neOk",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T14:07:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899539876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems to me bitcoind should manage _its own_ log file appropriately. In contrast, `systemd` supports _other_ components, outside itself. I also want to point out that the OS-specific calls added by this PR:\r\n\r\n- `fs::create_directories`\r\n- `fs::remove`\r\n- `fs::rename`\r\n\r\nare already being used elsewhere; we're not introducing any new dependencies on filesystem calls. So I don't know that maintenance would be more difficult.",
      "created_at" : "2021-08-16T16:59:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-899666761",
      "id" : 899666761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841n9NJ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T16:59:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899666761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It seems to me bitcoind should manage _its own_ log file appropriately\r\n\r\ni think it's also worth mentioning this isn't _only_ about log management and is (more importantly, imo) a solution to mitigate a disk fill attack\r\n\r\n> A disk fill attack is an attack where an untrusted party (such as a peer) is able to cheaply make your node log to disk excessively. The excessive logging may fill your disk and thus make your node crash either cleanly (best case: if disk fill rate is relatively slow) or uncleanly (worst case: if disk fill rate is relatively fast)\r\n\r\nas mentioned in the comments, a log rotation solution (as opposed to the rate limiting solution proposed in #21603 ) doesn't result in partial logs, which i think is important.\r\n\r\n@LarryRuane perhaps it would help to update the description of the PR to be more clear about how this is a mitigation for disk fill attacks (without the reviewer needing context from #21603 )",
      "created_at" : "2021-08-16T17:20:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-899681244",
      "id" : 899681244,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841oAvc",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T17:20:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899681244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> are already being used elsewhere; we're not introducing any new dependencies on filesystem calls. So I don't know that maintenance would be more difficult.\r\n\r\nThe point is less about what filesystem calls might be used, but the higher level observation that `bitcoind` (and this repository in general) should not be a catch-all for code and functionality that actually has nothing to-do with bitcoin. \r\n\r\nAdding and having to maintain large amounts, of sometimes complex code, to do non-bitcoin related things, i.e log management, settings parsing, cli's, ELF binary parsing, etc, adds a lot of (development) noise, maintenance, and back-compat overhead.\r\n\r\nIdeally this repository is moving in the opposite direction, where instead of adding more and more code, to do more and more things, we're actually removing more and more code, to the point where we end up with just the code that _is_ bitcoin, and more (useful) libconsensus type things. That effort is somewhat underway, i.e with the separation of the GUI development, de-globalization of the chainstate etc.",
      "created_at" : "2021-08-17T03:07:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-899958509",
      "id" : 899958509,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5841pEbt",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-17T07:15:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899958509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, @fanquake and @laanwj! Very good points.\r\n\r\n> ... separation of the GUI ...\r\n\r\nYou've given me an idea, tell me what you think of this (also @jnewbery and @theStack) as an alternative to this PR:\r\n\r\nI just did a proof-of-concept experiment on Linux (I don't know if this would work on Windows):\r\n```\r\n$ mknod /tmp/bitcoind-log p # p means named pipe, super-user (root) permissions are not needed\r\n$ cat /tmp/bitcoind-log     # this will just wait\r\n```\r\n_In another window_\r\n```\r\n$ bitcoind -shrinkdebugfile=0 -debuglogfile=/tmp/bitcoind-log\r\n```\r\nYou'll see the `debug.log` messages emanating from the `cat` command. Named pipes are cool. (When the writer, i.e. `bitcoind`, exits, `cat` gets an end-of-file and cleanly exits too.)\r\n\r\nProposal: What do you think about adding a Python script to `contrib` that's just a wrapper around `bitcoind` -- it would create the named pipe, start `bitcoind` (with passed-in arguments plus the `-shrinkdebugfile=0 -debuglogfile=/tmp/bitcoind-log` arguments), and then reads from the named pipe and writes to `debug.log`. It would be an alternate, entirely optional way to run the client.\r\n\r\nThis would reproduce the current functionality (except for shrinking `debug.log` at startup, but it could do that too).\r\n\r\nBut this python script could be enhanced to do log rotation -- and in the future, maybe other stuff like compression, filtering, sending some kind of alert or notification if certain log messages appear, who knows -- all without any changes to `bitcoind`.",
      "created_at" : "2021-09-28T20:33:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-929604155",
      "id" : 929604155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5843aKI7",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-28T20:33:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929604155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-15T09:39:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-944151542",
      "id" : 944151542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII5844Rpv2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/944151542/reactions"
      },
      "updated_at" : "2021-10-15T09:39:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/944151542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Closing due to insufficient support; I still think it would be valuable to implement what I described above https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-929604155 and that would be much less intrusive (only adds to `contrib/`).",
      "created_at" : "2022-01-26T15:26:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22350#issuecomment-1022307783",
      "id" : 1022307783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22350",
      "node_id" : "IC_kwDOABII58487y3H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1022307783/reactions"
      },
      "updated_at" : "2022-01-26T15:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1022307783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   }
]
