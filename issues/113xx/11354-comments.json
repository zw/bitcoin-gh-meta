[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "IMO commit message and PR title are too long.",
      "created_at" : "2017-09-17T08:28:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330029241",
      "id" : 330029241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-09-17T08:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330029241",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "I believe this is exactly right.\r\n\r\nIt only applies in the case where both a grandparent and a parent cache don't have an entry, and a new entry is created in the child cache. When flushing to the parent, it can be marked as fresh.",
      "created_at" : "2017-09-17T18:40:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330069638",
      "id" : 330069638,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-09-17T18:40:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330069638",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Why is more important than how in commit messages.    When would a fresh entry in a child be flushed into the parent?",
      "created_at" : "2017-09-18T08:40:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330159215",
      "id" : 330159215,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-09-18T08:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330159215",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell Do you mean to ask where are all the possible flows in the code in which this change would actually effect something? If so, I don't know. It's a general fix to an over-restriction in the coins DB itself - I don't know how small/large its actual optimization impact would be.\r\n\r\nOr, perhaps I misunderstood your question.",
      "created_at" : "2017-09-18T21:56:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330367954",
      "id" : 330367954,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-09-18T21:56:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330367954",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/84245?v=4",
         "events_url" : "https://api.github.com/users/danra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/danra/followers",
         "following_url" : "https://api.github.com/users/danra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/danra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/danra",
         "id" : 84245,
         "login" : "danra",
         "organizations_url" : "https://api.github.com/users/danra/orgs",
         "received_events_url" : "https://api.github.com/users/danra/received_events",
         "repos_url" : "https://api.github.com/users/danra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/danra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/danra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/danra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Right, I understand what this is doing (with a bit of sipa's help at least); but I can't come up with any case in the code where it would actually happen.  I think it's the right thing to do, but I'm at a loss as to how to test it or prioritize it in my review.",
      "created_at" : "2017-09-19T07:16:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330451580",
      "id" : 330451580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-09-19T07:16:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330451580",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I can wildly guess this may happen in case of a reorg, in case a previously\nspent output which was already flushed becomes unspent. I might be wrong as\nI haven't looked at reorg handling yet.  That said, even if this currently\ndoesn't happen in a reorg, future changes to its implementation could\ntrigger this case, since logically this is definitely something that may\nhappen as a result of a reorg.\n\nThat's all the extra input I can offer for now, I am sure @sipa and others\nwould be more qualified to answer :)\n\nOn Tue, Sep 19, 2017 at 10:16 AM, Gregory Maxwell <notifications@github.com>\nwrote:\n\n> Right, I understand what this is doing (with a bit of sipa's help at\n> least); but I can't come up with any case in the code where it would\n> actually happen. I think it's the right thing to do, but I'm at a loss as\n> to how to test it or prioritize it in my review.\n>\n> Ã¢ÂÂ\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330451580>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAFJFaHZZypmBMUZZDaavmlpyaRjHhyFks5sj2plgaJpZM4PZ5zD>\n> .\n>\n",
      "created_at" : "2017-09-19T09:13:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330479525",
      "id" : 330479525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-09-19T09:13:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330479525",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/84245?v=4",
         "events_url" : "https://api.github.com/users/danra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/danra/followers",
         "following_url" : "https://api.github.com/users/danra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/danra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/danra",
         "id" : 84245,
         "login" : "danra",
         "organizations_url" : "https://api.github.com/users/danra/orgs",
         "received_events_url" : "https://api.github.com/users/danra/received_events",
         "repos_url" : "https://api.github.com/users/danra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/danra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/danra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/danra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think it's currently possible to trigger this logic, because pruned/spent coins aren't loaded from parent caches (GetCoins() can only return true if an unspent coin is found), and we currently erase things from the cache when we flush to a parent (so when a coin is spent and DIRTY, it loses DIRTY-ness at the same time it is erased). \r\n\r\n@danra I agree that it's possible in the future this could be an optimization (eg in a future where we might write to the parent without clearing the cache), but given that this logic is consensus critical and already super complicated, I think we should just put a comment in that explains this a bit more, and not make any actual code changes -- optimizing consensus code in a way that we don't believe can trigger seems like way too much risk for zero reward.",
      "created_at" : "2017-09-20T19:19:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-330953733",
      "id" : 330953733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-09-20T19:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330953733",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Closing this, as the consensus is that the risk is too high considering the potential benefit.",
      "created_at" : "2017-12-12T10:59:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-351017757",
      "id" : 351017757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-12-12T10:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351017757",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW, #9384 makes the same optimization and goes a little further, and preferring to erase, rather than keep around unnecessary cache entries that are fresh and pruned.",
      "created_at" : "2017-12-12T15:26:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11354#issuecomment-351084831",
      "id" : 351084831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11354",
      "updated_at" : "2017-12-12T15:26:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351084831",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
