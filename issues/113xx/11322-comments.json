[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Okay, narrowing this down a bit more, running with -debug=http;\r\n\r\nGET requests with a valid endpoint (e.g. /rest/chaininfo.json) do not appear to cause issues. I've tried 20,000 requests as quickly as python can throw them out from two request threads.\r\n\r\nGET requests on / end up in a number of\r\n`Received a GET request for / from [::1]:port`\r\nfollowed by the libevent illegal connection state. Sometimes it's as few as 5.\r\n\r\nOccasionally a segfault is caused, other times the 'terminate called without an active exception' error.\r\n\r\n0.14.2 has the same issue.\r\n\r\nFurther testing: Hitting any endpoint that is registered with a handler causes the problem. \"/\", \"/rest/tx/\" if enabled, \"/wallet/\", etc, but not \"/wallet\" or \"/arbitrarystring\".\r\n\r\nThe response \"JSONRPC server handles only POST requests\" is getting through to the client until the crash.",
      "created_at" : "2017-09-13T20:35:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11322#issuecomment-329289033",
      "id" : 329289033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11322",
      "updated_at" : "2017-09-13T21:09:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329289033",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7999704?v=4",
         "events_url" : "https://api.github.com/users/esotericnonsense/events{/privacy}",
         "followers_url" : "https://api.github.com/users/esotericnonsense/followers",
         "following_url" : "https://api.github.com/users/esotericnonsense/following{/other_user}",
         "gists_url" : "https://api.github.com/users/esotericnonsense/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/esotericnonsense",
         "id" : 7999704,
         "login" : "esotericnonsense",
         "organizations_url" : "https://api.github.com/users/esotericnonsense/orgs",
         "received_events_url" : "https://api.github.com/users/esotericnonsense/received_events",
         "repos_url" : "https://api.github.com/users/esotericnonsense/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/esotericnonsense/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/esotericnonsense/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/esotericnonsense"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've dug around a bit and been unable to find the problem.\r\nThe work queue is not filling up; adding new items is fine; possibly a libevent issue?",
      "created_at" : "2017-09-13T22:38:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11322#issuecomment-329316914",
      "id" : 329316914,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11322",
      "updated_at" : "2017-09-13T22:38:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329316914",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7999704?v=4",
         "events_url" : "https://api.github.com/users/esotericnonsense/events{/privacy}",
         "followers_url" : "https://api.github.com/users/esotericnonsense/followers",
         "following_url" : "https://api.github.com/users/esotericnonsense/following{/other_user}",
         "gists_url" : "https://api.github.com/users/esotericnonsense/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/esotericnonsense",
         "id" : 7999704,
         "login" : "esotericnonsense",
         "organizations_url" : "https://api.github.com/users/esotericnonsense/orgs",
         "received_events_url" : "https://api.github.com/users/esotericnonsense/received_events",
         "repos_url" : "https://api.github.com/users/esotericnonsense/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/esotericnonsense/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/esotericnonsense/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/esotericnonsense"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> possibly a libevent issue\r\n\r\nDon't know but I doubt. I'll try to reproduce.",
      "created_at" : "2017-09-13T22:59:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11322#issuecomment-329320833",
      "id" : 329320833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11322",
      "updated_at" : "2017-09-13T22:59:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329320833",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Bit more digging:\r\n\r\n```\r\n$ nc -l -p 18334\r\nGET / HTTP/1.1                           \r\nHost: localhost:18334                    \r\nUser-Agent: python-requests/2.18.4       \r\nAccept-Encoding: gzip, deflate           \r\nAccept: */*                              \r\nConnection: keep-alive                   \r\nContent-Length: 2                        \r\n\r\n{}\r\n```\r\n\r\nTweaking cURL to give the same output:\r\n```\r\nfor x in {1..2000}; do curl -s -X GET -H \"User-Agent: python-requests/2.18.4\" -H \"Accept-Encoding: gzip, deflate\" -H \"Accept: */*\" -H \"Connection: keep-alive\" -H \"Content-Type:\" --data \"{}\" http://localhost:18332/ > /dev/null; done\r\n```\r\n(the output of nc is identical given this modification, checked with diff).\r\n\r\nCan't reproduce using cURL. It does hit the server much more slowly, though.",
      "created_at" : "2017-09-14T00:04:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11322#issuecomment-329331057",
      "id" : 329331057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11322",
      "updated_at" : "2017-09-14T00:04:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329331057",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7999704?v=4",
         "events_url" : "https://api.github.com/users/esotericnonsense/events{/privacy}",
         "followers_url" : "https://api.github.com/users/esotericnonsense/followers",
         "following_url" : "https://api.github.com/users/esotericnonsense/following{/other_user}",
         "gists_url" : "https://api.github.com/users/esotericnonsense/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/esotericnonsense",
         "id" : 7999704,
         "login" : "esotericnonsense",
         "organizations_url" : "https://api.github.com/users/esotericnonsense/orgs",
         "received_events_url" : "https://api.github.com/users/esotericnonsense/received_events",
         "repos_url" : "https://api.github.com/users/esotericnonsense/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/esotericnonsense/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/esotericnonsense/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/esotericnonsense"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've been up to my eyeballs in libevent lately, so I'll take this one.\r\n\r\nEdit: Not to say anyone should stop investigating, of course!",
      "created_at" : "2017-09-14T00:14:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11322#issuecomment-329332462",
      "id" : 329332462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11322",
      "updated_at" : "2017-09-14T00:19:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329332462",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've tracked down the root cause of this and am working on a proper fix.",
      "created_at" : "2017-09-18T13:41:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11322#issuecomment-330224876",
      "id" : 330224876,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11322",
      "updated_at" : "2017-09-18T13:41:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330224876",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Cannot reproduce with fa8a0639f7b0ce04030b72b4d5be4f0aa36fc5cb (v0.15.0.1)\r\n\r\npython 3\r\n``` python\r\nimport requests\r\nimport json\r\n\r\nwhile True:\r\n        print(\"get\")\r\n        r = requests.get(\"http://127.0.0.1:9332\", data=json.dumps({}))\r\n```",
      "created_at" : "2017-09-19T05:11:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11322#issuecomment-330431338",
      "id" : 330431338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11322",
      "updated_at" : "2017-09-19T05:13:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330431338",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   }
]
