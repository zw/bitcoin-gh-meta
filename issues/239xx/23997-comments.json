[
   {
      "author_association" : "MEMBER",
      "body" : "Why would this make sense? If any blocks are assumed valid, not only them, but also every block afterward is also dubious.\r\n\r\nThe correct behaviour would seem to be to work normally, and refuse to show anything as confirmed until all blocks it depends on have been verified valid.",
      "created_at" : "2022-01-07T07:00:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1007184219",
      "id" : 1007184219,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848CGlb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007184219/reactions"
      },
      "updated_at" : "2022-01-07T07:00:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007184219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr IIUC this PR deals with a situation where a rescan is physically impossible, whereas you're referring to whether it's safe.\r\n\r\nWe could add a warning when a user tries to load _any_ wallet before the background sync is finished. We also need some way to warn the user for this when they create a new wallet. Showing everything as unconfirmed would be one approach, but maybe it's better to show the transactions as confirmed, but still have a general warning about the background sync. Unconfirmed transactions might give users the wrong idea about e.g. the ability to fee bump or abandon them.\r\n\r\n@jamesob CI is not happy",
      "created_at" : "2022-01-07T10:22:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1007295448",
      "id" : 1007295448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848ChvY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007295448/reactions"
      },
      "updated_at" : "2022-01-07T10:24:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007295448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why would this make sense?\r\n\r\nAs @Sjors notes, the rescan is physically impossible if a block index entry is marked `BLOCK_ASSUMED_VALID` because it lacks the block data on disk, similar to pruning.",
      "created_at" : "2022-01-07T15:33:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1007500410",
      "id" : 1007500410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848DTx6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007500410/reactions"
      },
      "updated_at" : "2022-01-07T15:33:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007500410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Since this check is basically the same check that pruning does, why don't we just make the pruning check always happen and adjust the error message to be more generic? It would really just be removing the `if (chain.havePruned())` condition, and there would be no need to add `getLowestBlockDataHeight`.",
      "created_at" : "2022-01-10T21:59:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1009383503",
      "id" : 1009383503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848KfhP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009383503/reactions"
      },
      "updated_at" : "2022-01-10T21:59:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009383503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24230](https://github.com/bitcoin/bitcoin/pull/24230) (indexes: Stop using node internal types and locking cs_main, improve sync logic by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-01-14T19:07:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1013383438",
      "id" : 1013383438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848ZwEO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1013383438/reactions"
      },
      "updated_at" : "2022-06-03T00:27:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1013383438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Since this check is basically the same check that pruning does, why don't we just make the pruning check always happen and adjust the error message to be more generic? It would really just be removing the `if (chain.havePruned())` condition, and there would be no need to add `getLowestBlockDataHeight`.\r\n\r\nGood suggestion. I've made this change (though still distinguish the two cases in the error message) and have improved the test.",
      "created_at" : "2022-01-15T02:58:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1013594670",
      "id" : 1013594670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848ajou",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1013594670/reactions"
      },
      "updated_at" : "2022-01-15T02:58:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1013594670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "2ab917a26266ed2ce0265f3e81c7e9184eabfac4 deserves it's own PR. It's also what's causing the tests to fail, and nodes to crash when you shut them down after creating a new wallet(?).",
      "created_at" : "2022-01-16T11:18:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1013856817",
      "id" : 1013856817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848bjox",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1013856817/reactions"
      },
      "updated_at" : "2022-01-16T11:18:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1013856817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> [2ab917a](https://github.com/bitcoin/bitcoin/commit/2ab917a26266ed2ce0265f3e81c7e9184eabfac4) deserves it's own PR. It's also what's causing the tests to fail, and nodes to crash when you shut them down after creating a new wallet(?).\r\n\r\nYep... I'm going to avoid attempting that fix here and instead scale the tests back.",
      "created_at" : "2022-01-18T14:00:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1015438979",
      "id" : 1015438979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5848hl6D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1015438979/reactions"
      },
      "updated_at" : "2022-01-18T14:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1015438979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've removed the test from this change since, as far as I can tell, it's impossible to unittest this behavior without leaking the wallet database. This happens because `CWallet::Create` [eats the database unique_ptr into a shared_ptr](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/wallet.cpp#L2668-L2677) and then doesn't return the shared_ptr upon failure.",
      "created_at" : "2022-02-11T18:43:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1036509698",
      "id" : 1036509698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII5849x-IC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1036509698/reactions"
      },
      "updated_at" : "2022-02-11T18:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1036509698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r807363109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/807363109"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 9bf1245764579302fef8d86fbbe1003fc2bb7de4 \"wallet: avoid rescans if under the snapshot\"\r\n\r\nI think we should retain this check and just expand it to also check `hasAssumedValidChain`. Otherwise we will run the while loop below every time a wallet is loaded, and that can have a significant effect on loading times.\r\n\r\nWith a testnet wallet where the `rescan_height` is set to 0, the wallet took 500 ms to load on master, while it took 5 secs with this PR.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-02-15T22:16:26Z",
      "diff_hunk" : "@@ -2903,22 +2903,28 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r807363109",
      "id" : 807363109,
      "line" : 2906,
      "node_id" : "PRRC_kwDOABII584wH2Il",
      "original_commit_id" : "9bf1245764579302fef8d86fbbe1003fc2bb7de4",
      "original_line" : 2906,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 883715039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/807363109/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-15T22:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/807363109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r807367026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/807367026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch, thanks.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-02-15T22:22:44Z",
      "diff_hunk" : "@@ -2903,22 +2903,28 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r807367026",
      "id" : 807367026,
      "in_reply_to_id" : 807363109,
      "line" : 2906,
      "node_id" : "PRRC_kwDOABII584wH3Fy",
      "original_commit_id" : "9bf1245764579302fef8d86fbbe1003fc2bb7de4",
      "original_line" : 2906,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 883720248,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/807367026/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-15T22:22:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/807367026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-03-23T18:01:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1076651267",
      "id" : 1076651267,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII585ALGUD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1076651267/reactions"
      },
      "updated_at" : "2022-03-23T18:01:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1076651267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-28T19:22:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1112573203",
      "id" : 1112573203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII585CUIUT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112573203/reactions"
      },
      "updated_at" : "2022-04-28T19:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112573203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ready for merge?",
      "created_at" : "2022-06-06T13:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#issuecomment-1147478446",
      "id" : 1147478446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23997",
      "node_id" : "IC_kwDOABII585EZSGu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147478446/reactions"
      },
      "updated_at" : "2022-06-06T13:59:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147478446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890196701"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890196701"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Any reason to not use the existing `chainman().IsSnapshotActive()`?",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-06T14:17:25Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890196701",
      "id" : 890196701,
      "line" : 728,
      "node_id" : "PRRC_kwDOABII5841D1Ld",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 728,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 6,
      "pull_request_review_id" : 996684544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890196701/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-06T14:26:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890196701",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890207186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890207186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't seem actionable for the user? The user would have to disable the wallet, then restart without wallet, then wait for the background chainstate to catch up, then start again? And with pruning enabled they'd just trade this error with the other one, no?\r\n\r\nI guess the only way this could happen is if the users loads a wallet from another datadir/backup? In that case it doesn't seem too bad to just do a full rescan along with the background download?",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-06T14:26:27Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890207186",
      "id" : 890207186,
      "line" : 2929,
      "node_id" : "PRRC_kwDOABII5841D3vS",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2929,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 30,
      "pull_request_review_id" : 996684544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890207186/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-06T14:26:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890207186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890231271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890231271"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This can be `private` rather than `public`.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-06T14:48:21Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890231271",
      "id" : 890231271,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII5841D9nn",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 729,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 7,
      "pull_request_review_id" : 996732994,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890231271/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-06T14:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890231271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890236594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890236594"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit while touching this line\r\n```suggestion\r\n                     _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node.)\");\r\n```",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-06T14:53:29Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :\n+                     _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890236594",
      "id" : 890236594,
      "line" : 2930,
      "node_id" : "PRRC_kwDOABII5841D-6y",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2930,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 31,
      "pull_request_review_id" : 996732994,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890236594/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-06T14:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890236594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890245921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890245921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will also invalidate the translation",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-06T15:02:48Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :\n+                     _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890245921",
      "id" : 890245921,
      "in_reply_to_id" : 890236594,
      "line" : 2930,
      "node_id" : "PRRC_kwDOABII5841EBMh",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2930,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 31,
      "pull_request_review_id" : 996755130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890245921/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-06T15:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890245921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890253005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890253005"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, good point",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-06T15:09:58Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :\n+                     _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r890253005",
      "id" : 890253005,
      "in_reply_to_id" : 890236594,
      "line" : 2930,
      "node_id" : "PRRC_kwDOABII5841EC7N",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2930,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 31,
      "pull_request_review_id" : 996765214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890253005/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-06T15:09:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/890253005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891374363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891374363"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure I follow here - isn't wallet code supposed to be insulated from `chainman` references by way of this `Chain` interface here? Also I think we had a preference to avoid referring to \"snapshots\" outside of ChainstateManager to the extent possible. cc @ryanofsky ",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:23:02Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891374363",
      "id" : 891374363,
      "in_reply_to_id" : 890196701,
      "line" : 728,
      "node_id" : "PRRC_kwDOABII5841IUsb",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 728,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 6,
      "pull_request_review_id" : 998364397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891374363/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:23:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891374363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891374998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891374998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why would that be? This is part of the public Chain interface and is called by wallet code.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:23:28Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891374998",
      "id" : 891374998,
      "in_reply_to_id" : 890231271,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII5841IU2W",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 729,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 7,
      "pull_request_review_id" : 998364397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891374998/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:23:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891374998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891386790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891386790"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This error won't stop the node though, right? Won't the background validation process just continue after the loadwallet call has failed via this error? Maybe @achow101 @ryanofsky can clarify.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:33:16Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891386790",
      "id" : 891386790,
      "in_reply_to_id" : 890207186,
      "line" : 2929,
      "node_id" : "PRRC_kwDOABII5841IXum",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2929,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 30,
      "pull_request_review_id" : 998382065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891386790/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891386790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891388319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891388319"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, I just meant to replace the `Assert(...)` with `chainman()`, if you retouch.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:34:40Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891388319",
      "id" : 891388319,
      "in_reply_to_id" : 890196701,
      "line" : 728,
      "node_id" : "PRRC_kwDOABII5841IYGf",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 728,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 6,
      "pull_request_review_id" : 998384206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891388319/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:34:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891388319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891391476"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891391476"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I haven't tested this, but this seems like a fatal error. Or rather, if it wasn't a fatal error, it should be one, based on the wording:\r\n\r\n```\r\nerror = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\r\n```\r\n\r\n(I guess it would be nice if someone added a test for the prune case).",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:37:33Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891391476",
      "id" : 891391476,
      "in_reply_to_id" : 890207186,
      "line" : 2929,
      "node_id" : "PRRC_kwDOABII5841IY30",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2929,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 30,
      "pull_request_review_id" : 998388675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891391476/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:37:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891391476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891397779"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891397779"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At least in these cases, the error is not fatal AFAICT:\r\n- when called from `WalletLoader::createWallet()` (in wallet/interfaces.cpp): https://github.com/jamesob/bitcoin/blob/801aaac2b39564aa14009785146ba26d2506fb53/src/wallet/wallet.cpp#L227-L233\r\n- when called from `loadwallet` RPC: https://github.com/jamesob/bitcoin/blob/801aaac2b39564aa14009785146ba26d2506fb53/src/wallet/rpc/wallet.cpp#L224-L226",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:42:50Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891397779",
      "id" : 891397779,
      "in_reply_to_id" : 890207186,
      "line" : 2929,
      "node_id" : "PRRC_kwDOABII5841IaaT",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2929,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 30,
      "pull_request_review_id" : 998397102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891397779/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:42:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891397779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891412739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891412739"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't the prune error overwrite the au error?\r\n\r\nIf prune is enabled, downloading au data won't help, as it will be pruned.\r\n\r\n```suggestion\r\n                error = chain.havePruned() ? \"prune err\" : \"au err\";\r\n```",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:56:49Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891412739",
      "id" : 891412739,
      "line" : 2925,
      "node_id" : "PRRC_kwDOABII5841IeED",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2925,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 26,
      "pull_request_review_id" : 998418378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891412739/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:58:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891412739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891414726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891414726"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\r\n\r\nFair enough. (I'd still prefer if the wallet locator was automatically reset further back instead of asking the user to \"wait manually\".)\r\n",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T15:58:31Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?\n+                     _(\n+                        \"Assumed-valid: last wallet synchronisation goes beyond \"\n+                        \"available block data. You need to wait for the background \"\n+                        \"validation chain to download more blocks.\") :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891414726",
      "id" : 891414726,
      "in_reply_to_id" : 890207186,
      "line" : 2929,
      "node_id" : "PRRC_kwDOABII5841IejG",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2929,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 30,
      "pull_request_review_id" : 998421243,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891414726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T15:58:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891414726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891432916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891432916"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, this is a good point.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T16:14:32Z",
      "diff_hunk" : "@@ -2903,20 +2903,31 @@ bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interf\n \n     if (tip_height && *tip_height != rescan_height)\n     {\n-        if (chain.havePruned()) {\n+        // Technically we could execute the code below in any case, but performing the\n+        // `while` loop below can make startup very slow, so only check blocks on disk\n+        // if necessary.\n+        if (chain.havePruned() || chain.hasAssumedValidChain()) {\n             int block_height = *tip_height;\n             while (block_height > 0 && chain.haveBlockOnDisk(block_height - 1) && rescan_height != block_height) {\n                 --block_height;\n             }\n \n             if (rescan_height != block_height) {\n-                // We can't rescan beyond non-pruned blocks, stop and throw an error.\n+                // We can't rescan beyond blocks we don't have data for, stop and throw an error.\n                 // This might happen if a user uses an old wallet within a pruned node\n                 // or if they ran -disablewallet for a longer time, then decided to re-enable\n                 // Exit early and print an error.\n+                // It also may happen if an assumed-valid chain is in use and therefore not\n+                // all block data is available.\n                 // If a block is pruned after this check, we will load the wallet,\n                 // but fail the rescan with a generic error.\n-                error = _(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\");\n+\n+                error = chain.hasAssumedValidChain() ?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891432916",
      "id" : 891432916,
      "in_reply_to_id" : 891412739,
      "line" : 2925,
      "node_id" : "PRRC_kwDOABII5841Ii_U",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 2925,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 26,
      "pull_request_review_id" : 998447298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891432916/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T16:14:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891432916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891452747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891452747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See its `private` neighbor, `ChainstateManager& chainman() { return *Assert(m_node.chainman); }`. It looks like `hasAssumedValidChain()` may not only be private but also simplified, if wanted, to use `chainman()`. Clang 15 doesn't mind.\r\n```diff\r\n@@ -502,6 +502,10 @@ class ChainImpl : public Chain\r\n {\r\n private:\r\n     ChainstateManager& chainman() { return *Assert(m_node.chainman); }\r\n+    bool hasAssumedValidChain() override\r\n+    {\r\n+        return chainman().IsSnapshotActive();\r\n+    }\r\n public:\r\n     explicit ChainImpl(NodeContext& node) : m_node(node) {}\r\n@@ -767,10 +771,6 @@ public:\r\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\r\n         }\r\n     }\r\n-    bool hasAssumedValidChain() override\r\n-    {\r\n-        return Assert(m_node.chainman)->IsSnapshotActive();\r\n-    }\r\n```\r\n",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T16:25:39Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891452747",
      "id" : 891452747,
      "in_reply_to_id" : 890231271,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII5841In1L",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 729,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 7,
      "pull_request_review_id" : 998474011,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891452747/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T16:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891452747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891492798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891492798"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree with jamesob. Just because a diff compiles, doesn't mean it makes sense.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T16:59:01Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891492798",
      "id" : 891492798,
      "in_reply_to_id" : 890231271,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII5841Ixm-",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 729,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 7,
      "pull_request_review_id" : 998530101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891492798/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T16:59:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891492798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891508785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891508785"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`hasAssumedValidChain` is called by `CWallet::AttachChain()`, which is itself private",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T17:15:41Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891508785",
      "id" : 891508785,
      "in_reply_to_id" : 890231271,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII5841I1gx",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 729,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 7,
      "pull_request_review_id" : 998555399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891508785/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T17:15:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891508785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891513491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891513491"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">  hasAssumedValidChain is called by CWallet::AttachChain(), which is itself private\r\n\r\n\r\n`private` is used to mark a symbol \"private\" to a class. For example, `AttachChain` can be private to `CWallet`, meaning only code in the scope of `CWallet` (aka member functions) can call `AttachChain`.\r\n\r\nIf a function is called from outside its class, it should not be marked `private`. Even if adding `private` happens to compile due to language design trade-offs.",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T17:19:58Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891513491",
      "id" : 891513491,
      "in_reply_to_id" : 890231271,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII5841I2qT",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 729,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 7,
      "pull_request_review_id" : 998563766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891513491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T17:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891513491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891532727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891532727"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, but CWallet isn't outside, as it inherits from public Chain::Notifications, an \"is a\" relationship?",
      "commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "created_at" : "2022-06-07T17:36:08Z",
      "diff_hunk" : "@@ -723,6 +723,11 @@ class ChainImpl : public Chain\n             notifications.transactionAddedToMempool(entry.GetSharedTx(), 0 /* mempool_sequence */);\n         }\n     }\n+    bool hasAssumedValidChain() override\n+    {\n+        return Assert(m_node.chainman)->IsSnapshotActive();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23997#discussion_r891532727",
      "id" : 891532727,
      "in_reply_to_id" : 890231271,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII5841I7W3",
      "original_commit_id" : "817326a828d6148dc63d9ef08f641b9c0c522411",
      "original_line" : 729,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 7,
      "pull_request_review_id" : 998590644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23997",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891532727/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T17:36:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891532727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
