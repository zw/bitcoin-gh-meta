[
   {
      "body" : "I wonder what would happen if you start with -reindex but don't actually already have a blockchain locally. Or what if the genesis block entry on disk is broken.\r\n\r\nMaybe it makes sense to wait for *either* the genesis block present, or the importing process to be finished.",
      "created_at" : "2014-11-08T12:17:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#issuecomment-62255787",
      "id" : 62255787,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5243",
      "updated_at" : "2014-11-08T12:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62255787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "If the import process finishes without genesis, then we have skipped the genesis-build and we should actually wipe chainstate or so.",
      "created_at" : "2014-11-08T18:40:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#issuecomment-62270299",
      "id" : 62270299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5243",
      "updated_at" : "2014-11-08T18:40:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62270299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Agreed on concept, but this looks fragile. Polling every 10 milliseconds is also suboptimal - if this really needs to happen in a thread I would prefer to use a condition variable.\r\n\r\nThough as said in #5078 I'd prefer to split off the part of the import that looks for the Genesis block into a LocateGenesisBlock function. This would look in the first block file, look at the first block, and if it is not the Genesis block it would terminate. Waiting for the whole import to finish to detect that the genesis block is corrupt/missing would be suboptimal.\r\n",
      "created_at" : "2014-11-12T16:35:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#issuecomment-62747950",
      "id" : 62747950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5243",
      "updated_at" : "2014-11-12T16:35:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62747950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@TheBlueMatt Agree, I don't think this makes things worse.",
      "created_at" : "2014-11-14T17:23:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#issuecomment-63098650",
      "id" : 63098650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5243",
      "updated_at" : "2014-11-14T17:23:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/63098650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@TheBlueMatt Actually, it does. `-reindex` without any datadir currently works as expected. I believe that the code here will end up in an infinite sleep loop.",
      "created_at" : "2014-11-18T13:52:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#issuecomment-63473348",
      "id" : 63473348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5243",
      "updated_at" : "2014-11-18T13:52:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/63473348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Tested ACK.\r\n\r\nI was wrong. Importing ends with a call to InitBlockIndex(), which fixes the no-genesis case in case nothing was imported.",
      "created_at" : "2014-11-18T16:21:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#issuecomment-63497535",
      "id" : 63497535,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5243",
      "updated_at" : "2014-11-18T16:21:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/63497535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5243#discussion_r21364604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5243"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21364604"
         }
      },
      "body" : "This should check for fRequestShutdown, otherwise the initialization is not interruptible while waiting here (which make take a long time if the genesis block is corrupted).\r\n",
      "commit_id" : "ff09e31a51dcee404c9c037c7c5f50c522e67ea8",
      "created_at" : "2014-12-05T10:17:23Z",
      "diff_hunk" : "@@ -1238,6 +1238,8 @@ bool AppInit2(boost::thread_group& threadGroup)\n             vImportFiles.push_back(strFile);\n     }\n     threadGroup.create_thread(boost::bind(&ThreadImport, vImportFiles));\n+    while (chainActive.Tip() == NULL) // Wait until ThreadImport has imported genesis",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#discussion_r21364604",
      "id" : 21364604,
      "original_commit_id" : "86b84442e8689297c30f33bc3f252f700bbfeb3a",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5243",
      "updated_at" : "2014-12-21T03:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21364604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj I agree, but overcomplicating this stuff for the incredibly rare/strange case of having a corrupt genesis block (especially if it works in that case, even if not well)...probably not worth it. Anyway, I added a log print and a check to fRequestShutdown.",
      "created_at" : "2014-12-21T03:13:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5243#issuecomment-67758626",
      "id" : 67758626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5243",
      "updated_at" : "2014-12-21T03:13:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/67758626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
