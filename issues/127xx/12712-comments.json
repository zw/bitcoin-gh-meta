[
   {
      "author_association" : "MEMBER",
      "body" : "utACK a6e5ddc0df2ad86ca0352076a656dadab5345abb",
      "created_at" : "2018-03-18T05:03:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-373973313",
      "id" : 373973313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-18T05:03:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373973313",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/12712/commits/a6e5ddc0df2ad86ca0352076a656dadab5345abb",
      "created_at" : "2018-03-18T10:10:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-373986303",
      "id" : 373986303,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-18T10:10:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373986303",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK https://github.com/bitcoin/bitcoin/commit/a6e5ddc0df2ad86ca0352076a656dadab5345abb",
      "created_at" : "2018-03-18T19:36:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374037961",
      "id" : 374037961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-18T19:36:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374037961",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "-0\r\n\r\nThis adds a new codebase specific function for which a perfectly adequate language-standard one exists. It's just one more thing for people new to the codebase to see and ask themselves \"but why not static_cast\"? Converting the invocations from `*static_cast<X*>(this)` to `static_cast<X&>(*this)` seems fine and marginally better though.",
      "created_at" : "2018-03-18T23:26:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374066113",
      "id" : 374066113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-18T23:26:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374066113",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@jimpo That doesn't work when the constness of the argument isn't known.\n\nI guess the context isn't entirely clear in this PR, but the goal is to have serialization functions that use single implementation that taken a const argument when serializing and non-const argument when deserializing. Simple static casts aren't enough, as they don't maintain constness, but I'd be happy to learn about another approach.\n\nEDIT: I've added a rationale to the PR description; you're very right to point out it wasn't sufficient.",
      "created_at" : "2018-03-18T23:32:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374066819",
      "id" : 374066819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-18T23:41:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374066819",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@ryanofsky I was trying to avoid as much macro magic as possible.\r\n\r\n> In other contexts, AsType could even be dangerous since it potentially returns references to temporaries.\r\n\r\nCan you give an example?",
      "created_at" : "2018-03-19T17:14:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374292754",
      "id" : 374292754,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-19T17:14:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374292754",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky I was trying to avoid as much macro magic as possible.\r\n\r\nTo be clear, I'm not suggesting replacing `AsType` with a macro, I'm just suggesting using it internally in `READWRITEAS` and not exposing it to callers.\r\n\r\nI don't think macro magic calls like `READWRITEAS(child, Parent)` are great, but they seem preferable to a macro magic calls combined with template magic like `READWRITE(AsType<Parent>(child))`.\r\n\r\n> Can you give an example?\r\n\r\n```c++\r\nconst Base& i = CastAs<Base>(Derived());\r\n```\r\n\r\nIt just seems like the `CastAs` construct is unusual and unsafe and something that doesn't really make sense outside of the context of our `READWRITE` macro.\r\n",
      "created_at" : "2018-03-19T17:55:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374306808",
      "id" : 374306808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-19T17:55:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374306808",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> `const Base& i = CastAs<Base>(Derived());`\r\n\r\nSure, but that has nothing to do with the `AsType` construction, I think? This works just as well:\r\n\r\n`const Derived& i = Derived();`\r\n\r\nOr even:\r\n\r\n`const Base& i = Derived();`\r\n\r\n> It just seems like the CastAs construct is unusual and unsafe and something that doesn't really make sense outside of the context of our READWRITE macro.\r\n\r\n~~~Yes, but `READWRITEAS` can't be combined with a READWRITE with multiple arguments at once. It's also harder to compose with other things (which I admittedly don't really have any good use cases for).~~~\r\n\r\n~~~My point is that `AsType` never makes unsafe constructions that were illegal legal, and is thus much less risky to use than `static_cast`.~~~\r\n\r\nEDIT: I see your point. `const Base& i = Derived()` extends the lifetime of the temporary, while `const Base& i = AsType<Base>(Derived());` does not, making it unsafe to use.\r\n",
      "created_at" : "2018-03-19T18:10:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374311777",
      "id" : 374311777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-19T18:25:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374311777",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Yes, but it can't participate in a READWRITE with multiple arguments at once.\r\n\r\nThat's a good point. I can see how it is a benefit of the current approach. I'm not sure it actually justifies exposing the cast construct, but makes sense.\r\n\r\n> const Derived& i = Derived();\r\n\r\nThis is safe due to reference lifetime extension (https://abseil.io/tips/107). My example wasn't safe because lifetime extension can't work in that case. To be sure, I don't actually think this is a big deal. It's just a general reason to be wary of functions like `AsType` which return references that might not have clear lifetimes.",
      "created_at" : "2018-03-19T18:58:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374328028",
      "id" : 374328028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-19T18:58:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374328028",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> I'm not sure it actually justifies exposing the cast construct, but makes sense.\r\n\r\nRight, I guess that's the question.\r\n\r\nAfter the discussion above with @jimpo and @ryanofsky I'm fine with either the `READWRITEAS(type, obj)` or the `READWRITE(AsType<type>(obj))` approach (this PR). If we choose the former, I'll close this PR and structure things differently.",
      "created_at" : "2018-03-19T19:37:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12712#issuecomment-374342139",
      "id" : 374342139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12712",
      "updated_at" : "2018-03-19T19:37:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374342139",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
