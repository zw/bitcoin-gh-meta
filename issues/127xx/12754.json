{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "The client only subscribe `hashblock` topic, if there's no block found over than about 30 minutes on the network, the pub/sub will timeout and the client can't detect anything unusual, the client will keep waiting forever.\r\n\r\nI fix this by reconnecting, example code:\r\n\r\n```cpp\r\n#define BITCOIND_ZMQ_HASHBLOCK      \"hashblock\"\r\n\r\nconst time_t KReconnectInterval = 600;  // seconds\r\n\r\n//\r\n// check if need to reconnect ZMQ\r\n//\r\nif (subscriber == nullptr || lastRecvTime + KReconnectInterval < time(nullptr)) {\r\n  // disconnect\r\n  if (subscriber != nullptr) {\r\n    delete subscriber;\r\n    subscriber = nullptr;\r\n  }\r\n\r\n  // connect\r\n  subscriber = new zmq::socket_t(zmqContext_, ZMQ_SUB);\r\n  subscriber->connect(zmqBitcoindAddr_);\r\n\r\n  // subscribe topic\r\n  subscriber->setsockopt(ZMQ_SUBSCRIBE,\r\n                         BITCOIND_ZMQ_HASHBLOCK, strlen(BITCOIND_ZMQ_HASHBLOCK));\r\n}\r\n\r\n//\r\n// recv ZMQ messages\r\n//\r\n\r\n// ...\r\n\r\n// set last recv time\r\nlastRecvTime = time(nullptr);\r\n\r\n// ...\r\n```\r\n\r\nI am not sure if add these options by `zmq_setsockopt()` could solve this issue.\r\n\r\n```\r\n// ZMQ_HEARTBEAT_xxxx available since zmq-4.2.0\r\nZMQ_HEARTBEAT_TTL\r\nZMQ_HEARTBEAT_TIMEOUT\r\nZMQ_HEARTBEAT_IVL\r\n```\r\n\r\nMaybe could add some heartbeat messages when there's no traffic for a while? I prefer this way.\r\n\r\nSome links: \r\n* https://stackoverflow.com/questions/26112992/zeromq-pub-sub-on-unreliable-connection\r\n* https://github.com/zeromq/jeromq/issues/364",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 9,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12754/comments",
   "created_at" : "2018-03-22T11:43:05Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12754/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/12754",
   "id" : 307608833,
   "labels" : [
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12754/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUzMDc2MDg4MzM=",
   "number" : 12754,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[zmq] pub/sub is not reliable at all",
   "updated_at" : "2018-11-08T10:49:12Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12754",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/514951?v=4",
      "events_url" : "https://api.github.com/users/bitkevin/events{/privacy}",
      "followers_url" : "https://api.github.com/users/bitkevin/followers",
      "following_url" : "https://api.github.com/users/bitkevin/following{/other_user}",
      "gists_url" : "https://api.github.com/users/bitkevin/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/bitkevin",
      "id" : 514951,
      "login" : "bitkevin",
      "node_id" : "MDQ6VXNlcjUxNDk1MQ==",
      "organizations_url" : "https://api.github.com/users/bitkevin/orgs",
      "received_events_url" : "https://api.github.com/users/bitkevin/received_events",
      "repos_url" : "https://api.github.com/users/bitkevin/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/bitkevin/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/bitkevin/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/bitkevin"
   }
}
