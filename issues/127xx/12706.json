{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "<!-- This issue tracker is only for technical issues related to Bitcoin Core.\r\n\r\nGeneral bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.\r\n\r\nFor reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.\r\n\r\nIf the node is \"stuck\" during sync or giving \"block checksum mismatch\" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! -->\r\n\r\n<!-- Describe the issue -->\r\n\r\nCurrently on testnet, estimatesmartfee 3 displays \r\nfeerate: 0.01502015. This is a ridiculous value because the blocks are not full and the reason is that some of the miners for some reasons currently do not mine segwit transactions at all. Since some of these segwit transactions carry a huge fee and are nevertheless not mined, the estimatesmartfee increases the estimate to take it into account.\r\n\r\n<!--- What behavior did you expect? -->\r\n\r\nThe estimate algorithm believes the reason the transactions are not mined are too low fees but there are apparently non-monetary reasons. I think the algorithm should also look at the transaction with the  5-10% lowest fees to check if there are lower-paying transactions that are confirmed and in this case, lower the estimate to these values since it means that such a fee is enough. Without such a check even a small cartel of the miners can significantly increase the estimates (by not confirming several percent of the high-paying transactions) and since the estimator is fairly widely used can book a profit. Even now, there are a few miners on the mainnet (e.g. bw.com) that do not mine segwit transactions at all and it's possible that there is some impact on the estimatesmartfee for 1 or 2 blocks\r\n\r\nOf course, if estimatesmartfee  looks at the bottom 5-10% of the transactions, the miners can game the estimate downwards (by confirming below market fee transactions) but at least in this case, the gaming cannot be profitable is is, in my opinion, preferable to the current system. \r\n\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\n\r\n<!--- How reliably can you reproduce the issue, what are the steps to do so? -->\r\n\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n<!--- This is normally the contents of a `debug.log` or `config.log` file. Raw text or a link to a pastebin type site are preferred. -->\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12706/comments",
   "created_at" : "2018-03-16T14:35:53Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12706/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/12706",
   "id" : 305951775,
   "labels" : [
      {
         "color" : "ebd775",
         "default" : false,
         "id" : 64584,
         "name" : "Brainstorming",
         "node_id" : "MDU6TGFiZWw2NDU4NA==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming"
      },
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      },
      {
         "color" : "5319e7",
         "default" : false,
         "id" : 82428251,
         "name" : "TX fees and policy",
         "node_id" : "MDU6TGFiZWw4MjQyODI1MQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/TX%20fees%20and%20policy"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12706/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUzMDU5NTE3NzU=",
   "number" : 12706,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Estimatesmartfee is easily gameable by miners",
   "updated_at" : "2018-03-18T14:40:18Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12706",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/630679?v=4",
      "events_url" : "https://api.github.com/users/Raulo/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Raulo/followers",
      "following_url" : "https://api.github.com/users/Raulo/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Raulo/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Raulo",
      "id" : 630679,
      "login" : "Raulo",
      "node_id" : "MDQ6VXNlcjYzMDY3OQ==",
      "organizations_url" : "https://api.github.com/users/Raulo/orgs",
      "received_events_url" : "https://api.github.com/users/Raulo/received_events",
      "repos_url" : "https://api.github.com/users/Raulo/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Raulo/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Raulo/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Raulo"
   }
}
