[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693960652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 238ce0b02b1f7ac78c8c0466cef33628c6d49359:\r\n\r\nIf it is turned on later, we could keep it a nullptr until then and only initialize if and when we receive a `filter*` message?",
      "commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "created_at" : "2021-08-23T13:15:15Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652",
      "id" : 693960652,
      "line" : 2648,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzk2MDY1Mg==",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2648,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 314,
      "pull_request_review_id" : 736105932,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T13:15:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693960652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24970](https://github.com/bitcoin/bitcoin/pull/24970) (net processing: Move cleanSubVer, fPreferredDownload and nLocalHostNonce to Peer by jnewbery)\n* [#24474](https://github.com/bitcoin/bitcoin/pull/24474) (Additional thread safety annotations for CNode/Peer by ajtowns)\n* [#24170](https://github.com/bitcoin/bitcoin/pull/24170) (p2p, rpc: Manual block-relay-only connections with addnode by mzumsande)\n* [#21527](https://github.com/bitcoin/bitcoin/pull/21527) (net_processing: lock clean up by ajtowns)\n* [#21515](https://github.com/bitcoin/bitcoin/pull/21515) (Erlay: bandwidth-efficient transaction relay protocol by naumenkogs)\n* [#20726](https://github.com/bitcoin/bitcoin/pull/20726) (p2p: Add DISABLETX message for negotiating block-relay-only connections by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-23T13:25:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-903765978",
      "id" : 903765978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII58413l_a",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903765978/reactions"
      },
      "updated_at" : "2022-05-14T17:01:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903765978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r694001534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694001534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps, but I think it's better to allocate resources for the worst-case scenario up front, rather than try to reduce resource usage and later find out that you need to allocate a new structure.",
      "commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "created_at" : "2021-08-23T14:02:54Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r694001534",
      "id" : 694001534,
      "in_reply_to_id" : 693960652,
      "line" : 2648,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDAwMTUzNA==",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2648,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 314,
      "pull_request_review_id" : 736162717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T14:02:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694001534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-23T17:16:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-903961930",
      "id" : 903961930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII58414V1K",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T17:16:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903961930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've pushed a new branch that simplifies the implementation a bit. I'd previously wanted to amalgamate the various mutexes and atomics in `Peer::TxRelay` as part of this PR, but it's easier to wait until #21527 to do that, otherwise there are all kinds of lock ordering/inversion issues to work around.",
      "created_at" : "2021-08-27T08:37:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-907031918",
      "id" : 907031918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842EDVu",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-27T08:37:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907031918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-08-27T10:00:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-907082695",
      "id" : 907082695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842EPvH",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-27T10:00:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907082695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-09-01T16:04:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-910429435",
      "id" : 910429435,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842RAz7",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T16:04:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910429435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-06T10:58:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-913554695",
      "id" : 913554695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842c70H",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T10:58:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913554695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on the latest #21160",
      "created_at" : "2021-09-24T11:13:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-926544378",
      "id" : 926544378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843OfH6",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T11:13:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926544378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some rough estimates on how much this will save:\r\n\r\n```\r\n(gdb) p sizeof(CNode::TxRelay)\r\n$1 = 152\r\n```\r\n\r\nAssuming 50 incoming connections and 20% of them being block-only, that makes 10 peers will benefit from this. 152 bytes each, so 1520 bytes will be saved.",
      "created_at" : "2021-09-30T07:49:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-930958812",
      "id" : 930958812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843fU3c",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-30T07:49:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930958812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Some rough estimates on how much this will save...\r\n\r\n@vasild This seems completely wrong. `TxRelay` contains a CRollingBloomFilter parametrized by `{50000, 0.000001}`. According to this code comment:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/419afa93419e6840f78cb94b4a39d826eb10e139/src/bloom.h#L94-L98\r\n\r\nthe storage requirement for just that rolling bloom filter is ~1.8 * 50,000 * 6 = 540kB",
      "created_at" : "2021-09-30T08:11:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-930996031",
      "id" : 930996031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843fd8_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930996031/reactions"
      },
      "updated_at" : "2021-09-30T08:11:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930996031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719247282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719247282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At first I was thinking we could leave a TODO here for switching to unordered_set, but when I'm looking how it's used, it seems we can just leave it like this, right?",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-09-30T09:53:26Z",
      "diff_hunk" : "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719247282",
      "id" : 719247282,
      "line" : 251,
      "node_id" : "PRRC_kwDOABII584q3tey",
      "original_commit_id" : "48c896ee7fa504690f15dea7c6c61797500c1add",
      "original_line" : 251,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 29,
      "pull_request_review_id" : 767644909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719247282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T09:53:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719247282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Well, I said \"rough\", but did not mean _that_ rough. Somehow I wrongly assumed that none of the constructors allocate extra memory from the heap :disappointed:. Now I checked that `CRollingBloomFilter{50000, 0.000001}` creates and fills a vector of 67'396 `uint64_t` elements, or 539'168 bytes. For 10 peers that would save ~5MB.\r\n\r\nI wonder if it would make sense to delay the creation of `CRollingBloomFilter::data` until it is actually needed (e.g. create it in the first insert, rather than in the constructor, would be changes isolated solely inside `CRollingBloomFilter`). `CRollingBloomFilter` is also used here:\r\n\r\n* `BanMan::m_discouraged`, would benefit from lazy creation because we may never ban anybody, but is just one filter per program instance.\r\n* `Peer::m_addr_known`, looks like if created then it will be certainly used, one per peer.\r\n* `PeerManagerImpl::m_recent_rejects` and `PeerManagerImpl::m_recent_confirmed_transactions`, likely to be used, one per program instance.\r\n* `CNodeState::m_recently_announced_invs`, would benefit like `CNode::TxRelay::filterInventoryKnown`, one per peer.\r\n\r\nMaybe only `CNodeState::m_recently_announced_invs` is worth considering?",
      "created_at" : "2021-09-30T09:56:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-931172782",
      "id" : 931172782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843gJGu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931172782/reactions"
      },
      "updated_at" : "2021-09-30T09:56:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931172782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719250125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719250125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This also could mention BIP133, or perhaps be flipped with the next variable referencing it :)",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-09-30T09:57:08Z",
      "diff_hunk" : "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719250125",
      "id" : 719250125,
      "line" : 262,
      "node_id" : "PRRC_kwDOABII584q3uLN",
      "original_commit_id" : "48c896ee7fa504690f15dea7c6c61797500c1add",
      "original_line" : 262,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 40,
      "pull_request_review_id" : 767648820,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719250125/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T09:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719250125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719251357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719251357"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this comment is not very useful currently w.r.t. why we would update feefilter at all, and why it has to be scheduled.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-09-30T09:58:41Z",
      "diff_hunk" : "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */\n         std::atomic<CAmount> m_fee_filter_received{0};\n+        /** Fee rate below which we requested our peer not send us transaction\n+         *  announcements. It is *not* a p2p protocol violation for the peer to\n+         *  send us transactions with a lower fee rate than this. See BIP133. */\n         CAmount m_fee_filter_sent{0};\n+        /** The next time after which we will send a `feefilter` message to this peer. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719251357",
      "id" : 719251357,
      "line" : 268,
      "node_id" : "PRRC_kwDOABII584q3ued",
      "original_commit_id" : "48c896ee7fa504690f15dea7c6c61797500c1add",
      "original_line" : 268,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 767650419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719251357/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T09:58:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719251357",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719259735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719259735"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">rather than try to reduce resource usage and later find out that you need to allocate a new structure\r\n\r\nWhat exactly is difficult about this?",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-09-30T10:09:56Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719259735",
      "id" : 719259735,
      "in_reply_to_id" : 693960652,
      "line" : 2663,
      "node_id" : "PRRC_kwDOABII584q3whX",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2663,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 332,
      "pull_request_review_id" : 767661806,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719259735/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T10:09:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719259735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719262565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719262565"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Inverted this could be:\r\n`const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() && (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))`.\r\n\r\nDon't you think it's better?\r\n\r\n",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-09-30T10:13:45Z",
      "diff_hunk" : "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719262565",
      "id" : 719262565,
      "line" : 2664,
      "node_id" : "PRRC_kwDOABII584q3xNl",
      "original_commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "original_line" : 2664,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 333,
      "pull_request_review_id" : 767665482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719262565/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T10:13:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719262565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @vasild  e.g. create it in the first insert, rather than in the constructor\r\n\r\nSee discussion at https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652",
      "created_at" : "2021-10-01T10:24:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-932108560",
      "id" : 932108560,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843jtkQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/932108560/reactions"
      },
      "updated_at" : "2021-10-01T10:24:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/932108560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720133129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720133129"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> What exactly is difficult about this?\r\n\r\nI think I agree with John that there is little benefit (or even a risk) when giving remote peers the option to force you to allocate MBs of memory by sending a single msg, instead of allocating the memory on startup/creation of the connection.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-01T10:27:55Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720133129",
      "id" : 720133129,
      "in_reply_to_id" : 693960652,
      "line" : 2663,
      "node_id" : "PRRC_kwDOABII584q7FwJ",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2663,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 332,
      "pull_request_review_id" : 768805349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720133129/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T10:27:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720133129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720168415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720168415"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, allocating upfront is like giving a remote peer the option and he always exercises it immediately after connecting, no?\r\n\r\nIf there is a chance that the peer would not exercise the option (not send `filter*` message) and we never allocate the MBs, that is to be preferred?",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-01T11:29:34Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720168415",
      "id" : 720168415,
      "in_reply_to_id" : 693960652,
      "line" : 2663,
      "node_id" : "PRRC_kwDOABII584q7OXf",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2663,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 332,
      "pull_request_review_id" : 768852157,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720168415/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T11:33:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720168415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720171634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720171634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, and I think this is preferable because there are less (late) surprises. Neither on the live network, nor when developing. For example, `massif` will display the real usage from the start. Or, imagine someone under-estimating the resource usage and thus increasing the maxconnections count, then running into OOM later on.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-01T11:35:31Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720171634",
      "id" : 720171634,
      "in_reply_to_id" : 693960652,
      "line" : 2663,
      "node_id" : "PRRC_kwDOABII584q7PJy",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2663,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 332,
      "pull_request_review_id" : 768856490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720171634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T11:35:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720171634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720184968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720184968"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The counter scenario is somebody running into OOM because MBs of memory were allocated needlessly (allocated but never used because the peer(s) never sent `filter*`).",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-01T11:58:48Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720184968",
      "id" : 720184968,
      "in_reply_to_id" : 693960652,
      "line" : 2663,
      "node_id" : "PRRC_kwDOABII584q7SaI",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2663,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 332,
      "pull_request_review_id" : 768874295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720184968/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T11:58:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720184968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720200693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720200693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think if you want to reduce memory usage, you should disable bip37, not enable it with the hope that no one (or only a small fraction of your incoming peers) will use it.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-01T12:24:03Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720200693",
      "id" : 720200693,
      "in_reply_to_id" : 693960652,
      "line" : 2663,
      "node_id" : "PRRC_kwDOABII584q7WP1",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2663,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 332,
      "pull_request_review_id" : 768895812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720200693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T12:24:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720200693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724043654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724043654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If this can be executed concurrently by two threads, then the allocation may happen twice - thread1:lock,alloc,unlock, thread2:lock,alloc,unlock.\r\n\r\nIf this cannot be executed concurrently then the mutex is not needed. I think this is the case because message processing is single threaded and we would have quit earlier if we received a second VERSION message.\r\n\r\nIf, for some reason, the mutex is deemed necessary then the pattern should be:\r\n```cpp\r\nLOCK(peer->m_tx_relay_mutex);\r\nif (peer->m_tx_relay != nullptr) {\r\n    peer->m_tx_relay = std::make_unique<Peer::TxRelay>();\r\n}\r\n// unlock\r\n```",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-07T10:13:50Z",
      "diff_hunk" : "@@ -2590,9 +2657,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (pfrom.m_tx_relay != nullptr) {\n-            LOCK(pfrom.m_tx_relay->cs_filter);\n-            pfrom.m_tx_relay->fRelayTxes = fRelay; // set to true after we get the first filter* message\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||\n+                                      (!fRelay && !(pfrom.GetLocalServices() & NODE_BLOOM));\n+        if (!disable_tx_relay) {\n+            LOCK(peer->m_tx_relay_mutex);\n+            peer->m_tx_relay = std::make_unique<Peer::TxRelay>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724043654",
      "id" : 724043654,
      "line" : 2668,
      "node_id" : "PRRC_kwDOABII584rKAeG",
      "original_commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "original_line" : 2668,
      "original_position" : 337,
      "original_start_line" : 2667,
      "path" : "src/net_processing.cpp",
      "position" : 337,
      "pull_request_review_id" : 773710857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724043654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2667,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-07T10:13:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724043654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724189368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724189368"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that the size of this set is typically small enough that the complexity of insertion (lg(n) -vs- constant for an unordered_set) is not important.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-07T13:38:09Z",
      "diff_hunk" : "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724189368",
      "id" : 724189368,
      "in_reply_to_id" : 719247282,
      "line" : 251,
      "node_id" : "PRRC_kwDOABII584rKkC4",
      "original_commit_id" : "48c896ee7fa504690f15dea7c6c61797500c1add",
      "original_line" : 251,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 29,
      "pull_request_review_id" : 773920354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724189368/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-07T13:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724189368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724190716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724190716"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done!",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-07T13:39:38Z",
      "diff_hunk" : "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724190716",
      "id" : 724190716,
      "in_reply_to_id" : 719250125,
      "line" : 262,
      "node_id" : "PRRC_kwDOABII584rKkX8",
      "original_commit_id" : "48c896ee7fa504690f15dea7c6c61797500c1add",
      "original_line" : 262,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 40,
      "pull_request_review_id" : 773922307,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724190716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-07T13:39:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724190716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724191876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724191876"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that kind of comment would be more at home on or in the `MaybeSendFeefilter()` function.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-07T13:40:47Z",
      "diff_hunk" : "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */\n         std::atomic<CAmount> m_fee_filter_received{0};\n+        /** Fee rate below which we requested our peer not send us transaction\n+         *  announcements. It is *not* a p2p protocol violation for the peer to\n+         *  send us transactions with a lower fee rate than this. See BIP133. */\n         CAmount m_fee_filter_sent{0};\n+        /** The next time after which we will send a `feefilter` message to this peer. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724191876",
      "id" : 724191876,
      "in_reply_to_id" : 719251357,
      "line" : 268,
      "node_id" : "PRRC_kwDOABII584rKkqE",
      "original_commit_id" : "48c896ee7fa504690f15dea7c6c61797500c1add",
      "original_line" : 268,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 773923815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724191876/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-07T13:40:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724191876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724195101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724195101"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I actually think it's clearer this way, since it matches the english language comment above, and enabling tx relay is the default. I tried inverting the boolean, but it didn't seem any better to me.\r\n\r\nThat said, if other contributors also think it'd be clearer to invert the boolean logic here, I'm happy to switch it.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-07T13:44:25Z",
      "diff_hunk" : "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724195101",
      "id" : 724195101,
      "in_reply_to_id" : 719262565,
      "line" : 2664,
      "node_id" : "PRRC_kwDOABII584rKlcd",
      "original_commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "original_line" : 2664,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 333,
      "pull_request_review_id" : 773928668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724195101/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-07T13:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724195101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724208016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724208016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think `if (enabled)` is clearer than `if (!disabled)`. @naumenkogs's variant has less `!`. Can the English comment can be reworded: we only initialize this if not block-only and ...?",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-07T13:58:03Z",
      "diff_hunk" : "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724208016",
      "id" : 724208016,
      "in_reply_to_id" : 719262565,
      "line" : 2664,
      "node_id" : "PRRC_kwDOABII584rKomQ",
      "original_commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "original_line" : 2664,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 333,
      "pull_request_review_id" : 773947269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724208016/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-07T13:58:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724208016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724212963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724212963"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's impossible for the `if (msg_type == NetMsgType::VERSION) {` block of code to be executed  more than once, so it would be logically impossible for the `m_tx_relay` member to be allocated twice. However, I've updated the code to check for nullness first so it's immediately obvious from looking at this code that it can't be allocated twice.",
      "commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "created_at" : "2021-10-07T14:03:00Z",
      "diff_hunk" : "@@ -2590,9 +2657,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (pfrom.m_tx_relay != nullptr) {\n-            LOCK(pfrom.m_tx_relay->cs_filter);\n-            pfrom.m_tx_relay->fRelayTxes = fRelay; // set to true after we get the first filter* message\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||\n+                                      (!fRelay && !(pfrom.GetLocalServices() & NODE_BLOOM));\n+        if (!disable_tx_relay) {\n+            LOCK(peer->m_tx_relay_mutex);\n+            peer->m_tx_relay = std::make_unique<Peer::TxRelay>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724212963",
      "id" : 724212963,
      "in_reply_to_id" : 724043654,
      "line" : 2668,
      "node_id" : "PRRC_kwDOABII584rKpzj",
      "original_commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "original_line" : 2668,
      "original_position" : 337,
      "original_start_line" : 2667,
      "path" : "src/net_processing.cpp",
      "position" : 337,
      "pull_request_review_id" : 773954403,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724212963/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2667,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-07T14:03:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724212963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724339822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724339822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done!",
      "commit_id" : "7ef58ab5ca3e0652442eaf56c5c91ce192df324a",
      "created_at" : "2021-10-07T16:22:26Z",
      "diff_hunk" : "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724339822",
      "id" : 724339822,
      "in_reply_to_id" : 719262565,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rLIxu",
      "original_commit_id" : "bb89747af06ab39ce8ed7b595535f43129741541",
      "original_line" : 2664,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 774135472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724339822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-07T16:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724339822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724341411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724341411"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree with @MarcoFalke that if memory consumption is a concern, then you shouldn't enable BIP37 bloom filters for public peers.",
      "commit_id" : "7ef58ab5ca3e0652442eaf56c5c91ce192df324a",
      "created_at" : "2021-10-07T16:24:26Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724341411",
      "id" : 724341411,
      "in_reply_to_id" : 693960652,
      "line" : 2663,
      "node_id" : "PRRC_kwDOABII584rLJKj",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2663,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 332,
      "pull_request_review_id" : 774137749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724341411/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-07T16:24:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724341411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the reviews @naumenkogs and @vasild. I believe I've addressed all of your review comments.",
      "created_at" : "2021-10-07T16:25:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-937954634",
      "id" : 937954634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII58436A1K",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937954634/reactions"
      },
      "updated_at" : "2021-10-07T16:25:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937954634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 7ef58ab5ca3e0652442eaf56c5c91ce192df324a",
      "created_at" : "2021-10-08T08:30:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-938450206",
      "id" : 938450206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843750e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/938450206/reactions"
      },
      "updated_at" : "2021-10-08T08:30:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/938450206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-22T11:30:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949543940",
      "id" : 949543940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5844mOQE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949543940/reactions"
      },
      "updated_at" : "2021-10-22T11:30:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949543940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This PR includes #21160. The extra commits that this PR includes, on top of #21160, look good to me. I have some [reservations for #21160](https://github.com/bitcoin/bitcoin/pull/21160#pullrequestreview-733743042), so I skip ACKing this one too.",
      "created_at" : "2021-10-22T13:27:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949631654",
      "id" : 949631654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5844mjqm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949631654/reactions"
      },
      "updated_at" : "2021-10-22T13:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949631654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master",
      "created_at" : "2021-10-22T13:29:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949633314",
      "id" : 949633314,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5844mkEi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949633314/reactions"
      },
      "updated_at" : "2021-10-22T13:29:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949633314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-22T15:44:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949748310",
      "id" : 949748310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5844nAJW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949748310/reactions"
      },
      "updated_at" : "2021-10-22T15:44:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949748310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-10-22T16:51:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949802803",
      "id" : 949802803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5844nNcz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949802803/reactions"
      },
      "updated_at" : "2021-10-22T16:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949802803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-01T11:04:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-983528739",
      "id" : 983528739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5846n3Uj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983528739/reactions"
      },
      "updated_at" : "2021-12-01T11:04:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983528739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-12-01T13:50:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-983659479",
      "id" : 983659479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5846oXPX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983659479/reactions"
      },
      "updated_at" : "2021-12-01T13:50:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983659479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-10T09:54:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-990793047",
      "id" : 990793047,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5847Dk1X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990793047/reactions"
      },
      "updated_at" : "2021-12-10T09:54:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990793047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-12-22T10:24:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-999461111",
      "id" : 999461111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5847kpD3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999461111/reactions"
      },
      "updated_at" : "2021-12-22T10:24:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999461111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-06T14:13:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1006622848",
      "id" : 1006622848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5847_9iA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1006622848/reactions"
      },
      "updated_at" : "2022-01-06T14:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1006622848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r780726527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/780726527"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that means peers to which we'd connect in `-blocksonly` mode, also wouldn't initialize `m_tx_relay` anymore. \r\nBut `-blocksonly` mode until now allows to submit and relay transactions via RPC (`sendrawtransaction`), even if it that is obviously bad for privacy. \r\nWith this change, attempting to send a tx via RPC in `-blocksonly` mode might lead to all of our peers disconnecting us because they wouldn't have `m_tx_relay` enabled anymore.",
      "commit_id" : "61fea1335287bf6ee9fd4ce521d5d17138cb99fd",
      "created_at" : "2022-01-09T02:18:26Z",
      "diff_hunk" : "@@ -2710,8 +2709,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() &&\n+                                      (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r780726527",
      "id" : 780726527,
      "line" : 2717,
      "node_id" : "PRRC_kwDOABII584uiPD_",
      "original_commit_id" : "61fea1335287bf6ee9fd4ce521d5d17138cb99fd",
      "original_line" : 2717,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 40,
      "pull_request_review_id" : 847208700,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/780726527/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-09T02:22:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/780726527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-02-04T09:00:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1029776294",
      "id" : 1029776294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5849YSOm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1029776294/reactions"
      },
      "updated_at" : "2022-02-04T09:00:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1029776294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-07T08:24:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1060319566",
      "id" : 1060319566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII584_MzFO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1060319566/reactions"
      },
      "updated_at" : "2022-03-07T08:24:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1060319566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased now that #21160 has been merged. I haven't addressed @mzumsande's comment https://github.com/bitcoin/bitcoin/pull/22778#discussion_r780726527 yet, so leaving in draft.",
      "created_at" : "2022-03-25T17:48:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1079261796",
      "id" : 1079261796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585AVDpk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1079261796/reactions"
      },
      "updated_at" : "2022-03-25T17:48:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1079261796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-30T08:07:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1082759837",
      "id" : 1082759837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585AiZqd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082759837/reactions"
      },
      "updated_at" : "2022-03-30T08:07:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082759837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838313272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838313272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch. I've updated the `inv` and `tx` logic to explicitly test whether the peer is a block-relay-only connect instead of testing the existence of the Peer::TxRelay struct. That means that if we send a transaction to a peer while we're in blocksonly mode, then they will still process it.",
      "commit_id" : "df33991475d267289e6a71872d994b233ec7d3f5",
      "created_at" : "2022-03-30T09:14:47Z",
      "diff_hunk" : "@@ -2710,8 +2709,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() &&\n+                                      (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838313272",
      "id" : 838313272,
      "in_reply_to_id" : 780726527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x96U4",
      "original_commit_id" : "61fea1335287bf6ee9fd4ce521d5d17138cb99fd",
      "original_line" : 2751,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 925796498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838313272/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T09:14:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838313272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838317050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838317050"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">  With this change, attempting to send a tx via RPC in -blocksonly mode might lead to all of our peers disconnecting us because they wouldn't have m_tx_relay enabled anymore.\r\n\r\nIsn't there a test already that should check for this?",
      "commit_id" : "df33991475d267289e6a71872d994b233ec7d3f5",
      "created_at" : "2022-03-30T09:18:47Z",
      "diff_hunk" : "@@ -2710,8 +2709,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() &&\n+                                      (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838317050",
      "id" : 838317050,
      "in_reply_to_id" : 780726527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x97P6",
      "original_commit_id" : "61fea1335287bf6ee9fd4ce521d5d17138cb99fd",
      "original_line" : 2751,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 925801674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838317050/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T09:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838317050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @mzumsande. I've responded to your review comment. Let m know what you think.\r\n\r\nI've also marked this as ready for review.\r\n\r\nNote the behaviour change for `feefilter` messages. With the current branch, for a peer that indicates that they don't want us to relay messages with fRelay=false in the `version` message, we will no longer send `feefilter` messages. I think that's fine, but it can easily be changed by pulling the `m_fee_filter_sent` and `m_next_send_feefilter` members out of `Peer::TxRelay` and into `Peer`. That makes sense since all other members of `TxRelay` are concerned with relaying transactions _to_ the peer, and those two members are concerned with receiving transactions _from_ the peer, so they don't really belong int `TxRelay`.",
      "created_at" : "2022-03-30T09:20:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1082831424",
      "id" : 1082831424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585AirJA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082831424/reactions"
      },
      "updated_at" : "2022-03-30T09:20:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082831424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838321131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838321131"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">> With this change, attempting to send a tx via RPC in -blocksonly mode might lead to all of our peers disconnecting us because they wouldn't have m_tx_relay enabled anymore.\r\n\r\n> Isn't there a test already that should check for this?\r\n\r\nI would guess that:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/bdbabc50ba6c87ded97ea2bbacd3605c59cd12d0/test/functional/p2p_blocksonly.py#L43\r\n\r\nwould catch it. This branch was previously a draft since it was shared as a WIP, and I'm not sure if that test was failing.",
      "commit_id" : "986420028aa2c870c7acfead288a999e39cedf23",
      "created_at" : "2022-03-30T09:23:03Z",
      "diff_hunk" : "@@ -2710,8 +2709,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() &&\n+                                      (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838321131",
      "id" : 838321131,
      "in_reply_to_id" : 780726527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x98Pr",
      "original_commit_id" : "61fea1335287bf6ee9fd4ce521d5d17138cb99fd",
      "original_line" : 2751,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 925807315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838321131/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T10:26:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838321131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838339584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838339584"
         }
      },
      "author_association" : "MEMBER",
      "body" : "#21596 :smiling_face_with_tear: \r\n\r\n```\r\nnet_processing.cpp:2754:31: error: reading variable 'm_tx_relay' requires holding mutex 'peer->m_tx_relay_mutex' [-Werror,-Wthread-safety-analysis]\r\n                Assume(!peer->m_tx_relay);\r\n                              ^\r\n1 error generated.",
      "commit_id" : "df33991475d267289e6a71872d994b233ec7d3f5",
      "created_at" : "2022-03-30T09:40:35Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838339584",
      "id" : 838339584,
      "line" : 2755,
      "node_id" : "PRRC_kwDOABII584x-AwA",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 216,
      "pull_request_review_id" : 925833038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838339584/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T09:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838339584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838347009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838347009"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I'll remove the lambda.",
      "commit_id" : "df33991475d267289e6a71872d994b233ec7d3f5",
      "created_at" : "2022-03-30T09:48:19Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838347009",
      "id" : 838347009,
      "in_reply_to_id" : 838339584,
      "line" : 2755,
      "node_id" : "PRRC_kwDOABII584x-CkB",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 216,
      "pull_request_review_id" : 925843250,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838347009/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T09:48:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838347009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838351224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838351224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the issue isn't with the lambda, but with `Assume`/`Assert`.\r\n\r\n",
      "commit_id" : "df33991475d267289e6a71872d994b233ec7d3f5",
      "created_at" : "2022-03-30T09:52:50Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838351224",
      "id" : 838351224,
      "in_reply_to_id" : 838339584,
      "line" : 2755,
      "node_id" : "PRRC_kwDOABII584x-Dl4",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 216,
      "pull_request_review_id" : 925848954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838351224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T09:52:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838351224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838373832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838373832"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks. Removed.",
      "commit_id" : "986420028aa2c870c7acfead288a999e39cedf23",
      "created_at" : "2022-03-30T10:16:23Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838373832",
      "id" : 838373832,
      "in_reply_to_id" : 838339584,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x-JHI",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 925880474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838373832/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T10:16:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838373832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838378184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838378184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just for reference, an alternative to removing would be to temporarily asssign the value to a bool and then `Assume(name_of_bool)`.",
      "commit_id" : "986420028aa2c870c7acfead288a999e39cedf23",
      "created_at" : "2022-03-30T10:20:53Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838378184",
      "id" : 838378184,
      "in_reply_to_id" : 838339584,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x-KLI",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 925885737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838378184/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T10:20:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838378184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838382121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838382121"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I did check that when I wrote my earlier comment: That test didn't fail because the peer we sent the tx to was just a python `P2PInterface()`, which wouldn't disconnect us for sending a tx like a full node would have.",
      "commit_id" : "986420028aa2c870c7acfead288a999e39cedf23",
      "created_at" : "2022-03-30T10:25:34Z",
      "diff_hunk" : "@@ -2710,8 +2709,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() &&\n+                                      (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838382121",
      "id" : 838382121,
      "in_reply_to_id" : 780726527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x-LIp",
      "original_commit_id" : "61fea1335287bf6ee9fd4ce521d5d17138cb99fd",
      "original_line" : 2751,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 925891270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838382121/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T10:28:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838382121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838383706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838383706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I guess the test could be changed to subclass `P2PInterface` and fail if the node under test sends a tx message.",
      "commit_id" : "986420028aa2c870c7acfead288a999e39cedf23",
      "created_at" : "2022-03-30T10:27:20Z",
      "diff_hunk" : "@@ -2710,8 +2709,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() &&\n+                                      (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838383706",
      "id" : 838383706,
      "in_reply_to_id" : 780726527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x-Lha",
      "original_commit_id" : "61fea1335287bf6ee9fd4ce521d5d17138cb99fd",
      "original_line" : 2751,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 925893334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838383706/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T10:27:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838383706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838487007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838487007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Another reference: If #24714 is merged, you may be able to re-add the Assume as it was.",
      "commit_id" : "986420028aa2c870c7acfead288a999e39cedf23",
      "created_at" : "2022-03-30T12:32:59Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838487007",
      "id" : 838487007,
      "in_reply_to_id" : 838339584,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x-kvf",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 926039082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838487007/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T12:32:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838487007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838498477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838498477"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'll leave this for now, and add the `Assume()` back if 24714 is merged. I'm 100% sure that this code path can only get hit once for each peer, so the `Assume()` was only there to catch weird regressions.",
      "commit_id" : "986420028aa2c870c7acfead288a999e39cedf23",
      "created_at" : "2022-03-30T12:44:59Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r838498477",
      "id" : 838498477,
      "in_reply_to_id" : 838339584,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x-nit",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 926055265,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838498477/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T12:44:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838498477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased now that #24714 has been merged. I've also added a setter method for Peer.m_tx_relay and made the member variable private.",
      "created_at" : "2022-03-31T07:47:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1084218129",
      "id" : 1084218129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585An9sR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1084218129/reactions"
      },
      "updated_at" : "2022-03-31T07:47:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1084218129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r839284938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/839284938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I'll leave this for now, and add the Assume() back if 24714 is merged.\r\n\r\nNow done.",
      "commit_id" : "d5c191806f81af686eff80afa99d4a63053ee2fa",
      "created_at" : "2022-03-31T07:47:39Z",
      "diff_hunk" : "@@ -2714,10 +2743,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (peer->m_tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&\n+            (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))) {\n+            auto* tx_relay = [&peer]() {\n+                LOCK(peer->m_tx_relay_mutex);\n+                Assume(!peer->m_tx_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r839284938",
      "id" : 839284938,
      "in_reply_to_id" : 838339584,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yBnjK",
      "original_commit_id" : "a23d716a7b62bce9b1c83359e0d82890df1b0b26",
      "original_line" : 2755,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 927140879,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/839284938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-31T07:47:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/839284938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r854922999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/854922999"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe out of scope for this PR but we should also be able to skip the txrelay setup for feeler connections.",
      "commit_id" : "d5c191806f81af686eff80afa99d4a63053ee2fa",
      "created_at" : "2022-04-21T08:29:00Z",
      "diff_hunk" : "@@ -2744,7 +2753,13 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (auto tx_relay = peer->GetTxRelay(); tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r854922999",
      "id" : 854922999,
      "line" : 2760,
      "node_id" : "PRRC_kwDOABII584y9Rb3",
      "original_commit_id" : "d5c191806f81af686eff80afa99d4a63053ee2fa",
      "original_line" : 2760,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 71,
      "pull_request_review_id" : 948234553,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/854922999/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-21T09:31:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/854922999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r858578282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858578282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree that we could skip it, and also agree that it's out of scope for this PR (which shouldn't change behaviour).\r\n\r\nAlso note that we only have at most one feeler connection at a time, so this wouldn't result in much resource saving (whereas it's potentially very significant for inbound block-relay-only peers, since there could be many of them).",
      "commit_id" : "ee135a2a67b96024b66b094d28f9ab3ec6d634be",
      "created_at" : "2022-04-26T11:01:04Z",
      "diff_hunk" : "@@ -2744,7 +2753,13 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (auto tx_relay = peer->GetTxRelay(); tx_relay != nullptr) {\n+        // We only initialize the m_tx_relay data structure if:\n+        // - this isn't an outbound block-relay-only connection; and\n+        // - fRelay=true or we're offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        if (!pfrom.IsBlockOnlyConn() &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r858578282",
      "id" : 858578282,
      "in_reply_to_id" : 854922999,
      "line" : 2761,
      "node_id" : "PRRC_kwDOABII584zLN1q",
      "original_commit_id" : "d5c191806f81af686eff80afa99d4a63053ee2fa",
      "original_line" : 2761,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 226,
      "pull_request_review_id" : 953181647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858578282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-26T11:01:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858578282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think moving m_fee_filter_sent and m_next_send_feefilter out of TxRelay as you mentioned in https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1082831424 would be good and probably the right change. To me, a PR that only introduced the behavior change for feefilter messages would seem unnecessary, so i am leaning more twoards not introducing the change here. A peer that sends fRelay=false could still send us transactions, why should we not let them know what our min fee is?\r\n\r\nok, updated this PR to move those fields out of the TxRelay struct. This PR should not change the feefilter behaviour for inbound or outbound block-relay-only peers.",
      "created_at" : "2022-04-26T11:01:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1109656524",
      "id" : 1109656524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585CJAPM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1109656524/reactions"
      },
      "updated_at" : "2022-04-26T11:01:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1109656524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r858636237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858636237"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        /** Whether the peer wishes to receive transaction announcements.\r\n```",
      "commit_id" : "4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22",
      "created_at" : "2022-04-26T12:10:27Z",
      "diff_hunk" : "@@ -235,36 +235,64 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n+    CAmount m_fee_filter_sent{0};\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */\n+    std::chrono::microseconds m_next_send_feefilter{0};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r858636237",
      "id" : 858636237,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zLb_N",
      "original_commit_id" : "ee135a2a67b96024b66b094d28f9ab3ec6d634be",
      "original_line" : 249,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 953267723,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858636237/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-26T14:13:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858636237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r861546578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861546578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks. Fixed.",
      "commit_id" : "4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22",
      "created_at" : "2022-04-29T07:49:33Z",
      "diff_hunk" : "@@ -235,36 +235,64 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n+    CAmount m_fee_filter_sent{0};\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */\n+    std::chrono::microseconds m_next_send_feefilter{0};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r861546578",
      "id" : 861546578,
      "in_reply_to_id" : 858636237,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zWihS",
      "original_commit_id" : "ee135a2a67b96024b66b094d28f9ab3ec6d634be",
      "original_line" : 249,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 957371765,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861546578/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T07:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861546578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22\r\n\r\nOnly change since i last reviewed was fixing a typo.",
      "created_at" : "2022-04-29T10:48:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1113166779",
      "id" : 1113166779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585CWZO7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113166779/reactions"
      },
      "updated_at" : "2022-04-29T10:48:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113166779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r871092588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871092588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: it also determines (through `fSendTrickle`) sending mempool response\r\n```\r\n\r\n// Respond to BIP35 mempool requests\r\nif (fSendTrickle && peer->m_tx_relay->m_send_mempool) {\r\n```",
      "commit_id" : "4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22",
      "created_at" : "2022-05-12T08:25:53Z",
      "diff_hunk" : "@@ -235,32 +235,48 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n-    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer. */\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n     CAmount m_fee_filter_sent{0};\n-    /** Timestamp to send the next BIP133 `feefilter` message sent to the peer. */\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */\n     std::chrono::microseconds m_next_send_feefilter{0};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announcements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r871092588",
      "id" : 871092588,
      "line" : 275,
      "node_id" : "PRRC_kwDOABII584z69Fs",
      "original_commit_id" : "b3d761231475f3971dfe7f774ea3ab572b9ef26c",
      "original_line" : 275,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 51,
      "pull_request_review_id" : 970454110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871092588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-12T08:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871092588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r871096636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871096636"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Arguably, this field could be moved out of `TxRelay` then. Or perhaps we should use another timer for mempool.",
      "commit_id" : "4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22",
      "created_at" : "2022-05-12T08:29:44Z",
      "diff_hunk" : "@@ -235,32 +235,48 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n-    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer. */\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n     CAmount m_fee_filter_sent{0};\n-    /** Timestamp to send the next BIP133 `feefilter` message sent to the peer. */\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */\n     std::chrono::microseconds m_next_send_feefilter{0};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announcements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r871096636",
      "id" : 871096636,
      "in_reply_to_id" : 871092588,
      "line" : 275,
      "node_id" : "PRRC_kwDOABII584z6-E8",
      "original_commit_id" : "b3d761231475f3971dfe7f774ea3ab572b9ef26c",
      "original_line" : 275,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 51,
      "pull_request_review_id" : 970460138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871096636/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-12T08:29:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871096636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r871121660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871121660"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: add `OR` to the comment",
      "commit_id" : "4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22",
      "created_at" : "2022-05-12T08:54:10Z",
      "diff_hunk" : "@@ -3353,7 +3368,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // Stop processing the transaction early if\n         // 1) We are in blocks only mode and peer has no relay permission",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r871121660",
      "id" : 871121660,
      "line" : 3369,
      "node_id" : "PRRC_kwDOABII584z7EL8",
      "original_commit_id" : "4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22",
      "original_line" : 3369,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 88,
      "pull_request_review_id" : 970493484,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871121660/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-12T08:54:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/871121660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22\r\n\r\n------\r\nThere seem to be a mistake in the commit message of the latter commit. It should say \"fRelay=true OR we're offering\", as opposed to \"fRelay=true OR we're not offering\". The same comment in the codebase is correct.\r\n\r\n\r\n```\r\nWe only initialize the m_tx_relay\r\ndata structure if:\r\n\r\n- this isn't an outbound block-relay-only connection; AND\r\n- fRelay=true OR we're not offering NODE_BLOOM to this peer\r\n  (NODE_BLOOM means that the peer may turn on tx relay later)\r\n  ```",
      "created_at" : "2022-05-12T08:55:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1124711567",
      "id" : 1124711567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585DCbyP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124711567/reactions"
      },
      "updated_at" : "2022-05-12T08:55:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124711567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r873223316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873223316"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Nit: it also determines (through fSendTrickle) sending mempool response\r\n\r\nThe response to a mempool message is one or more inv announcement messages for transactions in the mempool. I think the comment is correct.\r\n\r\n> Arguably, this field could be moved out of TxRelay then. Or perhaps we should use another timer for mempool.\r\n\r\nI think it'd be better to simply remove support for the `mempool` message. I think it's unlikely that many people are using it, and it'd be better to provide this functionality (exposing the contents of the mempool) through rpc rather than a 'private' p2p extension.",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-15T20:39:24Z",
      "diff_hunk" : "@@ -235,32 +235,48 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n-    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer. */\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n     CAmount m_fee_filter_sent{0};\n-    /** Timestamp to send the next BIP133 `feefilter` message sent to the peer. */\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */\n     std::chrono::microseconds m_next_send_feefilter{0};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announcements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r873223316",
      "id" : 873223316,
      "in_reply_to_id" : 871092588,
      "line" : 277,
      "node_id" : "PRRC_kwDOABII5840DFSU",
      "original_commit_id" : "b3d761231475f3971dfe7f774ea3ab572b9ef26c",
      "original_line" : 277,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 49,
      "pull_request_review_id" : 973230838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873223316/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-15T20:39:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873223316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r873223921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873223921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-15T20:45:11Z",
      "diff_hunk" : "@@ -3353,7 +3368,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // Stop processing the transaction early if\n         // 1) We are in blocks only mode and peer has no relay permission",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r873223921",
      "id" : 873223921,
      "in_reply_to_id" : 871121660,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840DFbx",
      "original_commit_id" : "4bebd4c72c9328ec6dc7ef5d8d1dd7b53d73fa22",
      "original_line" : 3369,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 973231389,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873223921/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-15T20:45:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873223921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> There seem to be a mistake in the commit message of the latter commit. It should say \"fRelay=true OR we're offering\", as opposed to \"fRelay=true OR we're not offering\". \r\n\r\nGood catch. Thanks! I've fixed the commit.\r\n\r\nAlso rebased on latest master.",
      "created_at" : "2022-05-15T20:45:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1127025027",
      "id" : 1127025027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585DLQmD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127025027/reactions"
      },
      "updated_at" : "2022-05-15T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127025027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-16T04:54:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-1127219937",
      "id" : 1127219937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII585DMALh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127219937/reactions"
      },
      "updated_at" : "2022-05-16T04:54:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127219937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874732084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874732084"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 811783671d2a9cb2e811f539c889612662ce158c:\r\n\r\nInstead of repeating what the code does in the comment, maybe just leave it out (delete it) or explain *why* this is done. For example, it could say that the `feefilter` message to block-relay-only peers (or the absence of the message) shouldn't change their behaviour, so it is safe to skip:\r\n\r\n```cpp\r\n// Outbound block-relay-only peers should not send any txs to us, regardless of a feefilter message\r\n```\r\n\r\n\r\nAlso, the commit message could explain *why* this is a refactor. For example, it could mention that `IsBlockOnlyConn()` is exactly equal to `!peer.m_tx_relay` (as of this commit).",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-17T12:09:16Z",
      "diff_hunk" : "@@ -4565,10 +4567,11 @@ void PeerManagerImpl::MaybeSendAddr(CNode& node, Peer& peer, std::chrono::micros\n void PeerManagerImpl::MaybeSendFeefilter(CNode& pto, Peer& peer, std::chrono::microseconds current_time)\n {\n     if (m_ignore_incoming_txs) return;\n-    if (!peer.m_tx_relay) return;\n     if (pto.GetCommonVersion() < FEEFILTER_VERSION) return;\n     // peers with the forcerelay permission should not filter txs to us\n     if (pto.HasPermission(NetPermissionFlags::ForceRelay)) return;\n+    // Don't send feefilter messages to outbound block-relay-only peers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874732084",
      "id" : 874732084,
      "line" : 4613,
      "node_id" : "PRRC_kwDOABII5840I1o0",
      "original_commit_id" : "811783671d2a9cb2e811f539c889612662ce158c",
      "original_line" : 4573,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 28,
      "pull_request_review_id" : 975352984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874732084/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-17T15:47:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874732084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874959499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874959499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b771e14436d5008fbd4a2235ccc88730362a9179: Seems odd to add a comment in the previous commit and then rewrite it in the next commit. Why not add the final comment in a single attempt?",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-17T15:22:41Z",
      "diff_hunk" : "@@ -237,32 +237,48 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n-    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer. */\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874959499",
      "id" : 874959499,
      "line" : 242,
      "node_id" : "PRRC_kwDOABII5840JtKL",
      "original_commit_id" : "b771e14436d5008fbd4a2235ccc88730362a9179",
      "original_line" : 242,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 975352984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874959499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-17T15:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874959499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874959865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874959865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-17T15:22:56Z",
      "diff_hunk" : "@@ -237,32 +237,48 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n-    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer. */\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n     CAmount m_fee_filter_sent{0};\n-    /** Timestamp to send the next BIP133 `feefilter` message sent to the peer. */\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874959865",
      "id" : 874959865,
      "line" : 245,
      "node_id" : "PRRC_kwDOABII5840JtP5",
      "original_commit_id" : "b771e14436d5008fbd4a2235ccc88730362a9179",
      "original_line" : 245,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 975352984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874959865/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-17T15:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874959865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874963044"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874963044"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b771e14436d5008fbd4a2235ccc88730362a9179: Not sure how useful it is to repeat stuff that can be seen in the code in less than a second. Seems like a burden to maintain and keep updated for no good reason.",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-17T15:25:37Z",
      "diff_hunk" : "@@ -237,32 +237,48 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n-    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer. */\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n     CAmount m_fee_filter_sent{0};\n-    /** Timestamp to send the next BIP133 `feefilter` message sent to the peer. */\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */\n     std::chrono::microseconds m_next_send_feefilter{0};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874963044",
      "id" : 874963044,
      "line" : 249,
      "node_id" : "PRRC_kwDOABII5840JuBk",
      "original_commit_id" : "b771e14436d5008fbd4a2235ccc88730362a9179",
      "original_line" : 249,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 15,
      "pull_request_review_id" : 975352984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874963044/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-17T15:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874963044",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874963989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874963989"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-17T15:26:28Z",
      "diff_hunk" : "@@ -237,32 +237,48 @@ struct Peer {\n \n     /** Whether this peer relays txs via wtxid */\n     std::atomic<bool> m_wtxid_relay{false};\n-    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer. */\n+    /** The feerate in the most recent BIP133 `feefilter` message sent to the peer.\n+     *  It is *not* a p2p protocol violation for the peer to send us\n+     *  transactions with a lower fee rate than this. See BIP133. */\n     CAmount m_fee_filter_sent{0};\n-    /** Timestamp to send the next BIP133 `feefilter` message sent to the peer. */\n+    /** Timestamp after which we will send the next BIP133 `feefilter` message\n+      * to the peer. */\n     std::chrono::microseconds m_next_send_feefilter{0};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announcements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874963989",
      "id" : 874963989,
      "line" : 261,
      "node_id" : "PRRC_kwDOABII5840JuQV",
      "original_commit_id" : "b771e14436d5008fbd4a2235ccc88730362a9179",
      "original_line" : 261,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 31,
      "pull_request_review_id" : 975352984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874963989/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-17T15:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874963989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874977301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874977301"
         }
      },
      "author_association" : "MEMBER",
      "body" : "66807193bf92dcad6d27a5bf8e2e47b97d0bb6b7: Same\r\n\r\nIf this is something useful to maintain, it should be done by an automated linter to not tax review.",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-17T15:38:05Z",
      "diff_hunk" : "@@ -282,9 +282,18 @@ struct Peer {\n         std::atomic<CAmount> m_fee_filter_received{0};\n     };\n \n+    /** protects m_tx_relay */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r874977301",
      "id" : 874977301,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840JxgV",
      "original_commit_id" : "66807193bf92dcad6d27a5bf8e2e47b97d0bb6b7",
      "original_line" : 285,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 975352984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874977301/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-17T15:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874977301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r875032064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875032064"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            // Ignore GETDATA requests for transactions from block-relay-only peers and peers that asked us not to relay txs to them.\r\n```\r\n\r\nDoes this comment need an update in the last commit?",
      "commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "created_at" : "2022-05-17T16:29:57Z",
      "diff_hunk" : "@@ -2056,7 +2096,7 @@ void PeerManagerImpl::ProcessGetData(CNode& pfrom, Peer& peer, const std::atomic\n \n         const CInv &inv = *it++;\n \n-        if (peer.m_tx_relay == nullptr) {\n+        if (tx_relay == nullptr) {\n             // Ignore GETDATA requests for transactions from blocks-only peers.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r875032064",
      "id" : 875032064,
      "line" : 2100,
      "node_id" : "PRRC_kwDOABII5840J-4A",
      "original_commit_id" : "c4455b7d86b782b7c010857e04be5a73dd1dbb43",
      "original_line" : 2100,
      "original_position" : 205,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 205,
      "pull_request_review_id" : 975780447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875032064/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-17T16:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875032064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
