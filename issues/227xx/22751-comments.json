[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r692703814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692703814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`test/functional/wallet_analyzerawtx.py:60:9: F841 local variable 'analysis' is assigned to but never used`",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-20T06:40:00Z",
      "diff_hunk" : "@@ -0,0 +1,64 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test analyzerawtransaction.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+)\n+\n+class AnalyzeTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node0 = self.nodes[0]\n+        node1 = self.nodes[1]\n+        self.connect_nodes(0, 1)\n+\n+        node0.generate(1) # Leave IBD\n+\n+        node0.createwallet(wallet_name='w0')\n+        w0 = node0.get_wallet_rpc('w0')\n+        node1.createwallet(wallet_name='w1')\n+        w1 = node1.get_wallet_rpc('w1')\n+\n+        node0.generatetoaddress(101, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+\n+        tx = node1.createrawtransaction([], [{address1: 5.0}])\n+\n+        # node0 should be unaffected\n+        assert_equal(w0.analyzerawtransaction(tx), 0.0)\n+\n+        # node1 should see +5 balance\n+        assert_equal(w1.analyzerawtransaction(tx), 5.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx)\n+        tx = funding[\"hex\"]\n+        bitcoin_fee = float(funding[\"fee\"])\n+\n+        # node0 sees fee + 5 btc decrease\n+        assert_approx(w0.analyzerawtransaction(tx), -(5.0 + bitcoin_fee))\n+\n+        # node1 sees same as before\n+        analysis = w1.analyzerawtransaction(tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r692703814",
      "id" : 692703814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjcwMzgxNA==",
      "original_commit_id" : "70620ac3c45da9ed7daa14b52f7d3fbf3b6b7872",
      "original_line" : 60,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "test/functional/wallet_analyzerawtx.py",
      "position" : null,
      "pull_request_review_id" : 734716391,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-20T06:40:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692703814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r692716520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692716520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, fixed.",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-20T07:04:56Z",
      "diff_hunk" : "@@ -0,0 +1,64 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test analyzerawtransaction.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+)\n+\n+class AnalyzeTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node0 = self.nodes[0]\n+        node1 = self.nodes[1]\n+        self.connect_nodes(0, 1)\n+\n+        node0.generate(1) # Leave IBD\n+\n+        node0.createwallet(wallet_name='w0')\n+        w0 = node0.get_wallet_rpc('w0')\n+        node1.createwallet(wallet_name='w1')\n+        w1 = node1.get_wallet_rpc('w1')\n+\n+        node0.generatetoaddress(101, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+\n+        tx = node1.createrawtransaction([], [{address1: 5.0}])\n+\n+        # node0 should be unaffected\n+        assert_equal(w0.analyzerawtransaction(tx), 0.0)\n+\n+        # node1 should see +5 balance\n+        assert_equal(w1.analyzerawtransaction(tx), 5.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx)\n+        tx = funding[\"hex\"]\n+        bitcoin_fee = float(funding[\"fee\"])\n+\n+        # node0 sees fee + 5 btc decrease\n+        assert_approx(w0.analyzerawtransaction(tx), -(5.0 + bitcoin_fee))\n+\n+        # node1 sees same as before\n+        analysis = w1.analyzerawtransaction(tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r692716520",
      "id" : 692716520,
      "in_reply_to_id" : 692703814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjcxNjUyMA==",
      "original_commit_id" : "70620ac3c45da9ed7daa14b52f7d3fbf3b6b7872",
      "original_line" : 60,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "test/functional/wallet_analyzerawtx.py",
      "position" : null,
      "pull_request_review_id" : 734731551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-20T07:04:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692716520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, but I don't think the RPC name represents the functionality. Analyze implies some sort of in-depth breakdown of information. Perhaps `nettransactionbalance` or something to represent the balance-specific use?",
      "created_at" : "2021-08-21T00:00:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903013607",
      "id" : 903013607,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58410uTn",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-21T00:00:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903013607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> but I don't think the RPC name represents the functionality. Analyze implies some sort of in-depth breakdown of information. \r\n\r\nAgree. We already have RPC with similar name: `analyzepsbt` which returns lot of things that would be helpful for someone using PSBT. Although I am still confused between `decodepsbt` and `analyzepsbt`.\r\n\r\n> Perhaps nettransactionbalance or something to represent the balance-specific use?\r\n\r\nOr maybe add it in the results of any existing RPC",
      "created_at" : "2021-08-21T04:05:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903052080",
      "id" : 903052080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII584103sw",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-21T04:05:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903052080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I have no strong feelings about keeping `analyze` but I think `<verb>rawtransaction` is a good name (edit: because it is sticking to the convention), where `<verb>` somehow indicates looking at each input and output and determining whether they belong to the wallet, and if so to add/subtract the appropriate amount.\r\n\r\nEdit: adding to results of existing RPC sounds good to me too, but not sure which that would be.",
      "created_at" : "2021-08-21T07:45:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903076896",
      "id" : 903076896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII584109wg",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-21T07:48:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903076896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> adding to results of existing RPC sounds good to me too, but not sure which that would be.\r\n\r\nCan we add this to [`getbalance`](https://bitcoincore.org/en/doc/0.21.0/rpc/wallet/getbalance/)? Will need one argument `include_tx` so the command would look like this:\r\n\r\n```\r\n$ bitcoin-cli -named getbalance include_tx=hex\r\n\r\nResult:\r\n{                   \r\n  \"balance\" : n    (numeric) The total amount in BTC received for this wallet.\r\n\r\n  \"change\"  : n    (numeric) The wallet balance change including tx(negative means decrease).\r\n}\r\n```\r\n ",
      "created_at" : "2021-08-21T11:45:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903104233",
      "id" : 903104233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58411Ebp",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-21T12:23:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903104233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693372773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693372773"
         }
      },
      "author_association" : "MEMBER",
      "body" : "<details><summary>Some suggestions for the test</summary><p>\r\n\r\n```diff\r\n--- a/test/functional/wallet_analyzerawtx.py\r\n+++ b/test/functional/wallet_analyzerawtx.py\r\n@@ -5,12 +5,14 @@\r\n \"\"\"Test analyzerawtransaction.\r\n \"\"\"\r\n \r\n+from test_framework.blocktools import COINBASE_MATURITY\r\n from test_framework.test_framework import BitcoinTestFramework\r\n from test_framework.util import (\r\n     assert_approx,\r\n     assert_equal,\r\n )\r\n \r\n+\r\n class AnalyzeTxTest(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n         self.setup_clean_chain = True\r\n@@ -27,14 +29,14 @@ class AnalyzeTxTest(BitcoinTestFramework):\r\n         node1 = self.nodes[1]\r\n         self.connect_nodes(0, 1)\r\n \r\n-        node0.generate(1) # Leave IBD\r\n+        node0.generate(1)  # Leave IBD\r\n \r\n         node0.createwallet(wallet_name='w0')\r\n         w0 = node0.get_wallet_rpc('w0')\r\n         node1.createwallet(wallet_name='w1')\r\n         w1 = node1.get_wallet_rpc('w1')\r\n \r\n-        node0.generatetoaddress(101, w0.getnewaddress())\r\n+        node0.generatetoaddress(nblocks=COINBASE_MATURITY + 1, address=w0.getnewaddress())\r\n         assert_equal(w0.getbalance(), 50.0)\r\n         assert_equal(w1.getbalance(), 0.0)\r\n \r\n@@ -43,10 +45,10 @@ class AnalyzeTxTest(BitcoinTestFramework):\r\n         tx = node1.createrawtransaction([], [{address1: 5.0}])\r\n \r\n         # node0 should be unaffected\r\n-        assert_equal(w0.analyzerawtransaction(tx), 0.0)\r\n+        assert_equal(w0.analyzerawtransaction(tx), {\"balance_change\": 0.0})\r\n \r\n         # node1 should see +5 balance\r\n-        assert_equal(w1.analyzerawtransaction(tx), 5.0)\r\n+        assert_equal(w1.analyzerawtransaction(tx), {\"balance_change\": 5.0})\r\n \r\n         # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\r\n         funding = w0.fundrawtransaction(tx)\r\n@@ -54,10 +56,11 @@ class AnalyzeTxTest(BitcoinTestFramework):\r\n         bitcoin_fee = float(funding[\"fee\"])\r\n \r\n         # node0 sees fee + 5 btc decrease\r\n-        assert_approx(w0.analyzerawtransaction(tx), -(5.0 + bitcoin_fee))\r\n+        assert_approx(w0.analyzerawtransaction(tx)[\"balance_change\"], -(5.0 + bitcoin_fee))\r\n \r\n         # node1 sees same as before\r\n-        assert_equal(w1.analyzerawtransaction(tx), 5.0)\r\n+        assert_equal(w1.analyzerawtransaction(tx)[\"balance_change\"], 5.0)\r\n+\r\n \r\n if __name__ == '__main__':\r\n     AnalyzeTxTest().main()\r\n```\r\n</p></details>\r\n\r\n\r\n",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-21T16:14:58Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test analyzerawtransaction.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+)\n+\n+class AnalyzeTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node0 = self.nodes[0]\n+        node1 = self.nodes[1]\n+        self.connect_nodes(0, 1)\n+\n+        node0.generate(1) # Leave IBD\n+\n+        node0.createwallet(wallet_name='w0')\n+        w0 = node0.get_wallet_rpc('w0')\n+        node1.createwallet(wallet_name='w1')\n+        w1 = node1.get_wallet_rpc('w1')\n+\n+        node0.generatetoaddress(101, w0.getnewaddress())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693372773",
      "id" : 693372773,
      "line" : 37,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzM3Mjc3Mw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_analyzerawtx.py",
      "position" : 37,
      "pull_request_review_id" : 735506097,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-21T17:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693372773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693374190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693374190"
         }
      },
      "author_association" : "MEMBER",
      "body" : "<details><summary>Some suggestions for the rpc</summary><p>\r\n\r\n```diff\r\n--- a/src/wallet/rpcwallet.cpp\r\n+++ b/src/wallet/rpcwallet.cpp\r\n@@ -4647,13 +4647,16 @@ static RPCHelpMan upgradewallet()\r\n RPCHelpMan analyzerawtransaction()\r\n {\r\n     return RPCHelpMan{\"analyzerawtransaction\",\r\n-        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\r\n+        \"\\nCalculate the balance change that would result from the signing and broadcasting of the given transaction.\\n\" +\r\n         HELP_REQUIRING_PASSPHRASE,\r\n         {\r\n             {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\r\n         },\r\n         RPCResult{\r\n-            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\r\n+            RPCResult::Type::OBJ, \"\", \"\",\r\n+            {\r\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\r\n+            }\r\n         },\r\n         RPCExamples{\r\n             HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\r\n@@ -4673,26 +4676,31 @@ RPCHelpMan analyzerawtransaction()\r\n     // Decode the transaction\r\n     CMutableTransaction mtx;\r\n     if (!DecodeHexTx(mtx, request.params[0].get_str(), true, true)) {\r\n-        throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"TX decode failed. Make sure the tx has at least one input.\");\r\n+        throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failed. Make sure the transaction has at least one input.\");\r\n     }\r\n \r\n     // Calculate changes\r\n-    CAmount changes = 0;\r\n+    CAmount changes{0};\r\n \r\n-    // Fetch debit; we are *spending* these; if the transaction is signed and broadcast, we will lose everything in these\r\n+    // Fetch debit; we are *spending* these; if the transaction is signed and\r\n+    // broadcast, we will lose everything in these.\r\n     for (size_t i = 0; i < mtx.vin.size(); ++i) {\r\n         changes -= pwallet->GetDebit(mtx.vin.at(i), ISMINE_SPENDABLE);\r\n     }\r\n \r\n-    // Iterate over outputs; we are *receiving* these, if the wallet considers them \"mine\"; if the transaciton is signed\r\n-    // and broadcast, we will receive everything in these\r\n+    // Iterate over outputs; we are *receiving* these, if the wallet considers\r\n+    // them \"mine\"; if the transaction is signed and broadcast, we will receive\r\n+    // everything in these.\r\n     for (size_t i = 0; i < mtx.vout.size(); ++i) {\r\n         const CTxOut& txout = mtx.vout.at(i);\r\n         if (!pwallet->IsMine(txout)) continue;\r\n         changes += txout.nValue;\r\n     }\r\n \r\n-    return ValueFromAmount(changes);\r\n+    UniValue result(UniValue::VOBJ);\r\n+    result.pushKV(\"balance_change\", ValueFromAmount(changes));\r\n+\r\n+    return result;\r\n }\r\n     };\r\n }\r\n@@ -4762,6 +4770,7 @@ static const CRPCCommand commands[] =\r\n     { \"wallet\",             &abandontransaction,             },\r\n     { \"wallet\",             &abortrescan,                    },\r\n     { \"wallet\",             &addmultisigaddress,             },\r\n+    { \"wallet\",             &analyzerawtransaction,          },\r\n     { \"wallet\",             &backupwallet,                   },\r\n     { \"wallet\",             &bumpfee,                        },\r\n     { \"wallet\",             &psbtbumpfee,                    },\r\n@@ -4816,7 +4825,6 @@ static const CRPCCommand commands[] =\r\n     { \"wallet\",             &unloadwallet,                   },\r\n     { \"wallet\",             &upgradewallet,                  },\r\n     { \"wallet\",             &walletcreatefundedpsbt,         },\r\n-    { \"wallet\",             &analyzerawtransaction,          },\r\n```\r\n</p></details>\r\n\r\n- return an amount? (edit: seems to give the same result)\r\n- ISTM returning the result as a JSON object is preferred\r\n- `s/transaciton/transaction/` line 4610\r\n- sort here\r\n",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-21T16:28:25Z",
      "diff_hunk" : "@@ -4685,6 +4738,7 @@ static const CRPCCommand commands[] =\n     { \"wallet\",             &unloadwallet,                   },\n     { \"wallet\",             &upgradewallet,                  },\n     { \"wallet\",             &walletcreatefundedpsbt,         },\n+    { \"wallet\",             &analyzerawtransaction,          },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693374190",
      "id" : 693374190,
      "line" : 4741,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzM3NDE5MA==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4741,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 64,
      "pull_request_review_id" : 735506097,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-21T17:11:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693374190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 \r\n\r\n> Can we add this to [`getbalance`](https://bitcoincore.org/en/doc/0.21.0/rpc/wallet/getbalance/)?\r\n\r\nAdding to `getbalance` sounds reasonable to me.\r\n\r\n@jonatack \r\n\r\n> Concept ACK. Maybe add to decoderawtransaction? (Ignore me if that's dumb, and feel free to ignore the more detailed review comments below until the direction is set.)\r\n\r\nThis requires the wallet so `decoderawtransaction` is out, I'm afraid. :)",
      "created_at" : "2021-08-22T07:38:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903227551",
      "id" : 903227551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58411iif",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-22T07:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903227551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(getbalances is the replacement for getbalance).",
      "created_at" : "2021-08-22T07:45:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903228160",
      "id" : 903228160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58411isA",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-22T07:45:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903228160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it would be better to return JSON instead of numeric, that would allow adding possible other analysis in the future without breaking backwards compatibility.",
      "created_at" : "2021-08-22T12:23:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903260884",
      "id" : 903260884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58411qrU",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-22T12:23:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903260884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693516957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693516957"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Consider please:\r\n```suggestion\r\n    if (!DecodeHexTx(mtx, request.params[0].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\r\n```",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-22T15:18:03Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VSTR}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);\n+\n+    // Decode the transaction\n+    CMutableTransaction mtx;\n+    if (!DecodeHexTx(mtx, request.params[0].get_str(), true, true)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693516957",
      "id" : 693516957,
      "line" : 4598,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzUxNjk1Nw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4598,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 32,
      "pull_request_review_id" : 735586779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-22T15:44:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693516957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693517224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693517224"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: People typically place `const`s before types in this codebase, AFAIK. If I'm wrong, please correct me.",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-22T15:20:06Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693517224",
      "id" : 693517224,
      "line" : 4587,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzUxNzIyNA==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4587,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 21,
      "pull_request_review_id" : 735586779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-22T15:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693517224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693517767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693517767"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be more idiomatic to use `for (CTxIn& txin : mtx.vin) {`?",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-22T15:23:59Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VSTR}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);\n+\n+    // Decode the transaction\n+    CMutableTransaction mtx;\n+    if (!DecodeHexTx(mtx, request.params[0].get_str(), true, true)) {\n+        throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"TX decode failed. Make sure the tx has at least one input.\");\n+    }\n+\n+    // Calculate changes\n+    CAmount changes = 0;\n+\n+    // Fetch debit; we are *spending* these; if the transaction is signed and broadcast, we will lose everything in these\n+    for (size_t i = 0; i < mtx.vin.size(); ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693517767",
      "id" : 693517767,
      "line" : 4606,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzUxNzc2Nw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4606,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 40,
      "pull_request_review_id" : 735586779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-22T15:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693517767",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693518657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693518657"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    RPCTypeCheck(request.params, {UniValue::VSTR}, /* fAllowNull */ true);\r\n```",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-22T15:30:30Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VSTR}, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693518657",
      "id" : 693518657,
      "line" : 4591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzUxODY1Nw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4591,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 25,
      "pull_request_review_id" : 735586779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-22T15:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693518657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693518874"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693518874"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you allow `null`, then L4598 will lead to a crash, would it not?",
      "commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "created_at" : "2021-08-22T15:32:02Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VSTR}, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693518874",
      "id" : 693518874,
      "in_reply_to_id" : 693518657,
      "line" : 4591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzUxODg3NA==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4591,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 25,
      "pull_request_review_id" : 735586779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-22T15:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693518874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for all the feedback. I'm rewriting this as a separate pull request that adds the feature to `getbalances`. I'll potentially keep updating this PR as well, in case somebody prefers this variant.",
      "created_at" : "2021-08-23T03:58:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903422148",
      "id" : 903422148,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58412SDE",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T03:58:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903422148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693641733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693641733"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The RPCHelpMan framework will not execute the code, since the first param is non-optional.",
      "commit_id" : "ff70e4231045eb88b3ce98609b7d4fc4565675ff",
      "created_at" : "2021-08-23T04:19:45Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VSTR}, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693641733",
      "id" : 693641733,
      "in_reply_to_id" : 693518657,
      "line" : 4591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzY0MTczMw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4591,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 25,
      "pull_request_review_id" : 735697397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T04:19:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693641733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Opened alternative #22776 and updated this PR.",
      "created_at" : "2021-08-23T04:20:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903431067",
      "id" : 903431067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58412UOb",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T04:20:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903431067",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693643260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693643260"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "ff70e4231045eb88b3ce98609b7d4fc4565675ff",
      "created_at" : "2021-08-23T04:25:14Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VSTR}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);\n+\n+    // Decode the transaction\n+    CMutableTransaction mtx;\n+    if (!DecodeHexTx(mtx, request.params[0].get_str(), true, true)) {\n+        throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"TX decode failed. Make sure the tx has at least one input.\");\n+    }\n+\n+    // Calculate changes\n+    CAmount changes = 0;\n+\n+    // Fetch debit; we are *spending* these; if the transaction is signed and broadcast, we will lose everything in these\n+    for (size_t i = 0; i < mtx.vin.size(); ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693643260",
      "id" : 693643260,
      "in_reply_to_id" : 693517767,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzY0MzI2MA==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4606,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 735699067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T04:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693643260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693643427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693643427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looking around in the code, the way I wrote it seems to be the way it's written elsewhere, so keeping as is.",
      "commit_id" : "ff70e4231045eb88b3ce98609b7d4fc4565675ff",
      "created_at" : "2021-08-23T04:25:57Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693643427",
      "id" : 693643427,
      "in_reply_to_id" : 693517224,
      "line" : 4587,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzY0MzQyNw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4587,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 21,
      "pull_request_review_id" : 735699262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T04:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693643427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693643835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693643835"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, addressed all. See also alt PR.",
      "commit_id" : "ff70e4231045eb88b3ce98609b7d4fc4565675ff",
      "created_at" : "2021-08-23T04:27:26Z",
      "diff_hunk" : "@@ -4685,6 +4738,7 @@ static const CRPCCommand commands[] =\n     { \"wallet\",             &unloadwallet,                   },\n     { \"wallet\",             &upgradewallet,                  },\n     { \"wallet\",             &walletcreatefundedpsbt,         },\n+    { \"wallet\",             &analyzerawtransaction,          },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693643835",
      "id" : 693643835,
      "in_reply_to_id" : 693374190,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzY0MzgzNQ==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4741,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 735699733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T04:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693643835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693854537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693854537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Two lines above the `const` modifier is before type. Anyway, it's not important so I don't want to waste your time on this any further.",
      "commit_id" : "f19676bf02cb9cc279e2439c53b1f54ff53328fa",
      "created_at" : "2021-08-23T10:32:30Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693854537",
      "id" : 693854537,
      "in_reply_to_id" : 693517224,
      "line" : 4590,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzg1NDUzNw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4590,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 735966391,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T10:32:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693854537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693877296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693877296"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That would actually make the shared pointer a constant, which points to a non-constant CWallet instance.\r\n\r\nSee e.g. https://stackoverflow.com/questions/7526152/easy-rule-to-read-complicated-const-declarations",
      "commit_id" : "f19676bf02cb9cc279e2439c53b1f54ff53328fa",
      "created_at" : "2021-08-23T11:10:21Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693877296",
      "id" : 693877296,
      "in_reply_to_id" : 693517224,
      "line" : 4590,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzg3NzI5Ng==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4590,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 735996115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T11:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693877296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693878759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693878759"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also try modifying my PR to this, and try compiling:\r\n```C++\r\n    const std::shared_ptr<CWallet> wallet = GetWalletForJSONRPCRequest(request);\r\n    wallet->ResendWalletTransactions(); // <- this is not const\r\n```\r\n(it works, even though ResendWalletTransactions() is NOT const-declared)",
      "commit_id" : "f19676bf02cb9cc279e2439c53b1f54ff53328fa",
      "created_at" : "2021-08-23T11:12:47Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693878759",
      "id" : 693878759,
      "in_reply_to_id" : 693517224,
      "line" : 4590,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzg3ODc1OQ==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4590,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 735997982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T11:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693878759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693880377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693880377"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the clarification!",
      "commit_id" : "f19676bf02cb9cc279e2439c53b1f54ff53328fa",
      "created_at" : "2021-08-23T11:15:25Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693880377",
      "id" : 693880377,
      "in_reply_to_id" : 693517224,
      "line" : 4590,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzg4MDM3Nw==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4590,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 736000033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T11:15:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693880377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693891440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693891440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, I'm mistaken, and the two versions are identical. (ResendWalletTransactions() compiles for both cases.)\r\nI actually think this is a mistake, and could just as well be\r\n```C++\r\nstd::shared_ptr<CWallet> wallet = GetWalletForJSONRPCRequest(request);\r\n```\r\nbut I'm just going to keep the const where it is, as that's the case for other RPC calls. Sorry for the misinformation!\r\n\r\nTo clarify, I mis-remembered `const` as applying to the thing directly to the right of it, but it's the opposite; const as the starting keyword is simply a remnant from before the const rule was solidified, and is an exception that says \"usually we apply to the token to our left, but when const is preceded by nothing at all, it applies to the thing right after it\". (That stack overflow post explains it.)\r\n\r\nSo\r\n```C++\r\nconst std::shared_ptr<CWallet> wallet = GetWalletForJSONRPCRequest(request);\r\nstd::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\r\n```\r\nall lead to a wallet whose non-const methods can be called, and the const applies to the `std::shared_ptr` in both cases (it stops us from changing `wallet` to, say, some other `CWallet` somewhere).\r\n\r\nWhat we *really* want here is actually\r\n```C++\r\nstd::shared_ptr<CWallet const> const wallet = GetWalletForJSOMRPCRequest(request);\r\n```\r\n",
      "commit_id" : "f19676bf02cb9cc279e2439c53b1f54ff53328fa",
      "created_at" : "2021-08-23T11:33:56Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r693891440",
      "id" : 693891440,
      "in_reply_to_id" : 693517224,
      "line" : 4590,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzg5MTQ0MA==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4590,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 736014169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T12:31:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693891440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#19602](https://github.com/bitcoin/bitcoin/pull/19602) (wallet: Migrate legacy wallets to descriptor wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-23T14:13:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-903811963",
      "id" : 903811963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58413xN7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903811963/reactions"
      },
      "updated_at" : "2022-07-15T19:20:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903811963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r694482649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694482649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I opened a separate pull request on this subject. Thanks for the nudge. https://github.com/bitcoin/bitcoin/pull/22787",
      "commit_id" : "f19676bf02cb9cc279e2439c53b1f54ff53328fa",
      "created_at" : "2021-08-24T04:29:18Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r694482649",
      "id" : 694482649,
      "in_reply_to_id" : 693517224,
      "line" : 4590,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDQ4MjY0OQ==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4590,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 736769842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T04:29:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694482649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r694870990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694870990"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would `RPCTypeCheck(request.params, {UniValue::VSTR})` work too then?",
      "commit_id" : "c3628daf58bbe8d745cef08db8cee5fffd95167e",
      "created_at" : "2021-08-24T13:51:22Z",
      "diff_hunk" : "@@ -4567,6 +4567,59 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan analyzerawtransaction()\n+{\n+    return RPCHelpMan{\"analyzerawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction.\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"hexstring\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The transaction hex string\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::NUM, \"\", \"The wallet balance change (negative means decrease).\"\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+            + HelpExampleRpc(\"analyzerawtransaction\", \"\\\"myhex\\\"\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VSTR}, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r694870990",
      "id" : 694870990,
      "in_reply_to_id" : 693518657,
      "line" : 4594,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDg3MDk5MA==",
      "original_commit_id" : "f1cc9a1be3d04881935a02f796caca0b0ef320be",
      "original_line" : 4594,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 28,
      "pull_request_review_id" : 737254585,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T13:51:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694870990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r694871518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694871518"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be better to use `Decimal` here?",
      "commit_id" : "c3628daf58bbe8d745cef08db8cee5fffd95167e",
      "created_at" : "2021-08-24T13:51:58Z",
      "diff_hunk" : "@@ -0,0 +1,64 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test analyzerawtransaction.\n+\"\"\"\n+\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+)\n+\n+class AnalyzeTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node0 = self.nodes[0]\n+        node1 = self.nodes[1]\n+        self.connect_nodes(0, 1)\n+\n+        node0.generate(1) # Leave IBD\n+\n+        node0.createwallet(wallet_name='w0')\n+        w0 = node0.get_wallet_rpc('w0')\n+        node1.createwallet(wallet_name='w1')\n+        w1 = node1.get_wallet_rpc('w1')\n+\n+        node0.generatetoaddress(nblocks=COINBASE_MATURITY + 1, address=w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+\n+        tx = node1.createrawtransaction([], [{address1: 5.0}])\n+\n+        # node0 should be unaffected\n+        assert_equal(w0.analyzerawtransaction(tx)[\"balance_change\"], 0.0)\n+\n+        # node1 should see +5 balance\n+        assert_equal(w1.analyzerawtransaction(tx)[\"balance_change\"], 5.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx)\n+        tx = funding[\"hex\"]\n+        bitcoin_fee = float(funding[\"fee\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r694871518",
      "id" : 694871518,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDg3MTUxOA==",
      "original_commit_id" : "c3628daf58bbe8d745cef08db8cee5fffd95167e",
      "original_line" : 55,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/wallet_analyzerawtx.py",
      "position" : 55,
      "pull_request_review_id" : 737255285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T13:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694871518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@kallewoof do you mind adding mention of #22776 to the OP so people looking at this are clear of the alternative",
      "created_at" : "2021-08-25T04:32:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-905174885",
      "id" : 905174885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5841899l",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-25T04:32:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905174885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r695604933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695604933"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could, but would be another import just for this one place, and the code should be fine (i.e. no rounding errors) due to the `assert_approx`.",
      "commit_id" : "c3628daf58bbe8d745cef08db8cee5fffd95167e",
      "created_at" : "2021-08-25T10:11:20Z",
      "diff_hunk" : "@@ -0,0 +1,64 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test analyzerawtransaction.\n+\"\"\"\n+\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+)\n+\n+class AnalyzeTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node0 = self.nodes[0]\n+        node1 = self.nodes[1]\n+        self.connect_nodes(0, 1)\n+\n+        node0.generate(1) # Leave IBD\n+\n+        node0.createwallet(wallet_name='w0')\n+        w0 = node0.get_wallet_rpc('w0')\n+        node1.createwallet(wallet_name='w1')\n+        w1 = node1.get_wallet_rpc('w1')\n+\n+        node0.generatetoaddress(nblocks=COINBASE_MATURITY + 1, address=w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+\n+        tx = node1.createrawtransaction([], [{address1: 5.0}])\n+\n+        # node0 should be unaffected\n+        assert_equal(w0.analyzerawtransaction(tx)[\"balance_change\"], 0.0)\n+\n+        # node1 should see +5 balance\n+        assert_equal(w1.analyzerawtransaction(tx)[\"balance_change\"], 5.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx)\n+        tx = funding[\"hex\"]\n+        bitcoin_fee = float(funding[\"fee\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r695604933",
      "id" : 695604933,
      "in_reply_to_id" : 694871518,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTYwNDkzMw==",
      "original_commit_id" : "c3628daf58bbe8d745cef08db8cee5fffd95167e",
      "original_line" : 55,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/wallet_analyzerawtx.py",
      "position" : 55,
      "pull_request_review_id" : 738160469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T10:11:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695604933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @kallewoof do you mind adding mention of #22776 to the OP so people looking at this are clear of the alternative\r\n\r\nGood point, done.",
      "created_at" : "2021-08-25T10:12:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-905367425",
      "id" : 905367425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58419s-B",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-25T10:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905367425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~Apologies, I switched to a constant CWallet so had to re-push.~\r\n\r\nReverted change.",
      "created_at" : "2021-08-25T10:13:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-905367905",
      "id" : 905367905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58419tFh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-25T10:29:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905367905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This seems useful, but I would like to see its functionality be a bit broader, and the name changed.\r\n\r\nOn the topic of functionality, I do see how it would be useful to see what changes a transaction would make without actually broadcasting it. We currently have `testmempoolaccept` which simulates `sendrawtransaction`. What if we had this RPC be `testwalletaccept` where we can not only observe how the balances change, but also which transaction(s) it conflicts with/replaces in the wallet. It could also be useful to have such an RPC indicate whether it would even be tracked by the wallet, and what metadata the wallet would assign to each output (e.g. mine, change, etc.). However such changes would likely need more invasive changes to the wallet itself before the RPC could be implemented (e.g. refactors to allow checks without actually adding to the wallet).\r\n\r\nOn the topic of naming, I would prefer that we don't use `analyzerawtransaction` unless it is doing something equivalent to `analyzepsbt`. Currently the PSBT and raw transaction RPCs have similar names to indicate that they do equivalent things but with different data structures. This proposed `analyzerawtransaction` is not at all equivalent to the existing `analyzepsbt` - the equivalent thing would be to say what steps need to be done next to the raw transaction in order to sign it. I would rather this be something like `testwalletaccept` or perhaps `simulaterawtransaction`.",
      "created_at" : "2021-08-25T23:49:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-905950000",
      "id" : 905950000,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5841_7Mw",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-25T23:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905950000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101\r\n\r\nThanks for the feedback. Great suggestions!\r\n\r\nI think it's agreed that this should be renamed if we do not go with the alternative proposal to add this to `getbalances` (see #22776); I'll rename to `simulaterawtransaction` for now. It seems like your additional functionality may come as follow-up PR(s), too.",
      "created_at" : "2021-08-26T03:15:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-906059704",
      "id" : 906059704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5842AV-4",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-26T03:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/906059704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated to take array of transactions instead of just one.",
      "created_at" : "2021-08-26T08:05:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-906187435",
      "id" : 906187435,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5842A1Kr",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-26T08:05:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/906187435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, interesting feature",
      "created_at" : "2021-09-16T18:18:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-921136915",
      "id" : 921136915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5842528T",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-16T18:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/921136915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r710393087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710393087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 4d6c1a01532fa189c44714fae31916d758f3a574 \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nThe isminetype here needs to match the isminetype below as otherwise we could get incorrect balance calculations. This either needs to be changed to `ISMINE_ALL` or the calculation in the outputs needs to check `ISMINE_SPENDABLE` too.\r\n\r\nI think it would be better to use `ISMINE_ALL` so that the balance computation includes watchonly things as those are part of the wallet balance as well.\r\n\r\nOr there could be an `include_watchonly` option that would change the IsMine filter from `ISMINE_SPENDABLE` to `ISMINE_ALL`. This would be the most inline with the rest of the RPCs.",
      "commit_id" : "4d6c1a01532fa189c44714fae31916d758f3a574",
      "created_at" : "2021-09-16T18:56:33Z",
      "diff_hunk" : "@@ -4567,6 +4567,76 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    const auto& txs = request.params[0].get_array();\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            if (spent.count(txin.prevout)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            spent.insert(txin.prevout);\n+            changes -= pwallet->GetDebit(txin, ISMINE_SPENDABLE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r710393087",
      "id" : 710393087,
      "line" : 4620,
      "node_id" : "PRRC_kwDOABII584qV7z_",
      "original_commit_id" : "4d6c1a01532fa189c44714fae31916d758f3a574",
      "original_line" : 4620,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 54,
      "pull_request_review_id" : 756660588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-16T19:04:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710393087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r710397947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710397947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 4d6c1a01532fa189c44714fae31916d758f3a574 \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nI would prefer using one node with 2 wallets. Having multiple nodes, with one wallet on each, is how we used to do things before multiwallet. Given that the test already makes testing wallets (one on each node), it's unnecessary to have multiple nodes.",
      "commit_id" : "4d6c1a01532fa189c44714fae31916d758f3a574",
      "created_at" : "2021-09-16T19:02:00Z",
      "diff_hunk" : "@@ -0,0 +1,88 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r710397947",
      "id" : 710397947,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII584qV8_7",
      "original_commit_id" : "4d6c1a01532fa189c44714fae31916d758f3a574",
      "original_line" : 19,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 19,
      "pull_request_review_id" : 756660588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-16T19:04:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710397947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r712694853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712694853"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds good - adding an `include_watchonly` option.",
      "commit_id" : "4d6c1a01532fa189c44714fae31916d758f3a574",
      "created_at" : "2021-09-21T04:58:14Z",
      "diff_hunk" : "@@ -4567,6 +4567,76 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    const auto& txs = request.params[0].get_array();\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            if (spent.count(txin.prevout)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            spent.insert(txin.prevout);\n+            changes -= pwallet->GetDebit(txin, ISMINE_SPENDABLE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r712694853",
      "id" : 712694853,
      "in_reply_to_id" : 710393087,
      "line" : 4620,
      "node_id" : "PRRC_kwDOABII584qetxF",
      "original_commit_id" : "4d6c1a01532fa189c44714fae31916d758f3a574",
      "original_line" : 4620,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 54,
      "pull_request_review_id" : 759301570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-21T04:58:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712694853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r712767909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712767909"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That is obviously the right way to do it. Thanks, fixed.",
      "commit_id" : "b1ffbab49ab4c5686e4d69ef938e64249c7acf19",
      "created_at" : "2021-09-21T07:22:02Z",
      "diff_hunk" : "@@ -0,0 +1,88 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r712767909",
      "id" : 712767909,
      "in_reply_to_id" : 710397947,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qe_ml",
      "original_commit_id" : "4d6c1a01532fa189c44714fae31916d758f3a574",
      "original_line" : 19,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : null,
      "pull_request_review_id" : 759385992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-21T07:22:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712767909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "* added `include_watchonly` option\r\n* updated tests to use one node with two wallets\r\n* added `include_watchonly` tests",
      "created_at" : "2021-09-21T10:53:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-923865580",
      "id" : 923865580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5843ERHs",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-21T10:53:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923865580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Approach NACK\r\n\r\nI prefer https://github.com/bitcoin/bitcoin/pull/22776\r\n\r\nReasons: \r\n\r\n1. No need to create another RPC and remember another RPC.\r\n2. Other PR keeps things simple. This is basically returning balances but based on some conditions. It makes sense to add conditions (transactions in this case) as an argument in `getbalances`.\r\n3. Same approach can be followed in future for other RPCs if required. Example: What will be output for `getmempoolinfo` if a list of transactions are broadcasted: `getmempoolinfo \"[Tx1, Tx2.. Txn]\"`",
      "created_at" : "2021-09-21T14:57:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-924071463",
      "id" : 924071463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5843FDYn",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-21T14:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/924071463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "FWIW, @apoelstra suggests this is modified to take PSBT(s) instead of raw transactions, stating that the latter is more or less made obsolete by the former, and in multi-party transactions people will most likely be using PSBT.",
      "created_at" : "2021-09-22T04:29:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-924574194",
      "id" : 924574194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5843G-Hy",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-22T04:29:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/924574194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r715884509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/715884509"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 40944a573a21c225662ce0c8ba7f64a8427ca22d \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nThis is unnecessary since no key access is needed.",
      "commit_id" : "40944a573a21c225662ce0c8ba7f64a8427ca22d",
      "created_at" : "2021-09-24T20:25:04Z",
      "diff_hunk" : "@@ -4660,6 +4660,95 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r715884509",
      "id" : 715884509,
      "line" : 4699,
      "node_id" : "PRRC_kwDOABII584qq4fd",
      "original_commit_id" : "40944a573a21c225662ce0c8ba7f64a8427ca22d",
      "original_line" : 4699,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 40,
      "pull_request_review_id" : 763449354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-24T20:29:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/715884509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r715993468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/715993468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do the vin/vout checks not access keys to determine if the wallet owns them?",
      "commit_id" : "40944a573a21c225662ce0c8ba7f64a8427ca22d",
      "created_at" : "2021-09-25T05:18:49Z",
      "diff_hunk" : "@@ -4660,6 +4660,95 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r715993468",
      "id" : 715993468,
      "in_reply_to_id" : 715884509,
      "line" : 4699,
      "node_id" : "PRRC_kwDOABII584qrTF8",
      "original_commit_id" : "40944a573a21c225662ce0c8ba7f64a8427ca22d",
      "original_line" : 4699,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 40,
      "pull_request_review_id" : 763562965,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-25T05:18:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/715993468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r716003118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716003118"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It only uses pubkeys.",
      "commit_id" : "b269f1bb0d6d1c25000732edbcc1407517d3b20a",
      "created_at" : "2021-09-25T07:02:04Z",
      "diff_hunk" : "@@ -4660,6 +4660,95 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r716003118",
      "id" : 716003118,
      "in_reply_to_id" : 715884509,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qrVcu",
      "original_commit_id" : "40944a573a21c225662ce0c8ba7f64a8427ca22d",
      "original_line" : 4699,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 763568590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-25T07:02:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716003118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r716004123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716004123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "OK, you're talking about the `EnsureWalletIsUnlocked` line. I thought you were also talking about L4698. Fixed.",
      "commit_id" : "b269f1bb0d6d1c25000732edbcc1407517d3b20a",
      "created_at" : "2021-09-25T07:12:48Z",
      "diff_hunk" : "@@ -4660,6 +4660,95 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(*pwallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r716004123",
      "id" : 716004123,
      "in_reply_to_id" : 715884509,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qrVsb",
      "original_commit_id" : "40944a573a21c225662ce0c8ba7f64a8427ca22d",
      "original_line" : 4699,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 763569217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-25T07:12:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716004123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r745550564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745550564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Needs to use self.gener... after a rebase",
      "commit_id" : "b269f1bb0d6d1c25000732edbcc1407517d3b20a",
      "created_at" : "2021-11-09T12:01:43Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        node.generate(1) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+\n+        node.generatetoaddress(nblocks=COINBASE_MATURITY + 1, address=w0.getnewaddress())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r745550564",
      "id" : 745550564,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII584scDLk",
      "original_commit_id" : "b269f1bb0d6d1c25000732edbcc1407517d3b20a",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 37,
      "pull_request_review_id" : 801190333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745550564/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-09T12:01:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745550564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r748843165"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748843165"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, updated.",
      "commit_id" : "f2cee8ff75f26b2d1529190e26db0bf172807316",
      "created_at" : "2021-11-14T11:52:59Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        node.generate(1) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+\n+        node.generatetoaddress(nblocks=COINBASE_MATURITY + 1, address=w0.getnewaddress())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r748843165",
      "id" : 748843165,
      "in_reply_to_id" : 745550564,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sonCd",
      "original_commit_id" : "b269f1bb0d6d1c25000732edbcc1407517d3b20a",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : null,
      "pull_request_review_id" : 805462408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748843165/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-14T11:52:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748843165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-08T05:22:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-988509781",
      "id" : 988509781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII584663ZV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988509781/reactions"
      },
      "updated_at" : "2021-12-08T05:22:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988509781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. I don't even *see* an error in the two failing tests.",
      "created_at" : "2021-12-09T08:10:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-989609337",
      "id" : 989609337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5846_D15",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989609337/reactions"
      },
      "updated_at" : "2021-12-09T08:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989609337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "For what it's worth I prefer this as a separate RPC over #22776. Trying to squash this into `getbalances` seems a bit weird to me and I agree with the reasoning in https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-905950000 that this can do more, this way.\r\n\r\nCode + test review ACK 9cc3c4db5c4fdd200e64415fa3184d1b530581dc",
      "created_at" : "2021-12-17T15:04:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-996790730",
      "id" : 996790730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847adHK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996790730/reactions"
      },
      "updated_at" : "2021-12-17T15:30:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996790730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r771494286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771494286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be better to use `Decimal` instead of float for monetary amounts.",
      "commit_id" : "9cc3c4db5c4fdd200e64415fa3184d1b530581dc",
      "created_at" : "2021-12-17T15:41:42Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Make address1 watch-only in w0\n+        w0.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])\n+        all = {\"include_watchonly\": True}\n+\n+        tx1 = node.createrawtransaction([], [{address1: 5.0}])\n+        tx2 = node.createrawtransaction([], [{address2: 10.0}])\n+\n+        # w0 should be unaffected (include_watchonly=False) or see +5 (include_watchonly=True) for tx1\n+        assert_equal(w0.simulaterawtransaction([tx1])[\"balance_change\"], 0.0)\n+        assert_equal(w0.simulaterawtransaction([tx1], all)[\"balance_change\"], 5.0)\n+\n+        # w1 should see +5 balance for tx1\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w0 should be unaffected (include_watchonly=False) or see +5 (include_watchonly=True) for both transactions\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 0.0)\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2], all)[\"balance_change\"], 5.0)\n+\n+        # w1 should see +15 balance for both transactions\n+        assert_equal(w1.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 15.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx1)\n+        tx1 = funding[\"hex\"]\n+        bitcoin_fee = float(funding[\"fee\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r771494286",
      "id" : 771494286,
      "line" : 68,
      "node_id" : "PRRC_kwDOABII584t_BGO",
      "original_commit_id" : "9cc3c4db5c4fdd200e64415fa3184d1b530581dc",
      "original_line" : 68,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 68,
      "pull_request_review_id" : 835376284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771494286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T15:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771494286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Switched to using Decimal. Also added support for mixing floats and Decimals to `assert_approx` as a separate commit.",
      "created_at" : "2021-12-19T05:50:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-997334145",
      "id" : 997334145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847chyB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997334145/reactions"
      },
      "updated_at" : "2021-12-19T05:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997334145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So if I understand the CI error right, it's no longer supported to import pubkeys to wallets that have privkeys (but nodes can?) so I should revert back to two nodes with separate wallets I assume? Sounds like a regression, but if it's the way it is, I'm fine doing that.",
      "created_at" : "2021-12-19T09:10:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-997354758",
      "id" : 997354758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847cm0G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997354758/reactions"
      },
      "updated_at" : "2021-12-19T09:10:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997354758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772174126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772174126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`importpubkey` does not exist for descriptor wallets (sqlite).\r\n\r\n`                                   test_framework.authproxy.JSONRPCException: Cannot import descriptor without private keys to a wallet with private keys enabled (-4)`",
      "commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "created_at" : "2021-12-20T08:44:10Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-addresstype=legacy\"]]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Make address1 watch-only in w0\n+        w0.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772174126",
      "id" : 772174126,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII584uBnEu",
      "original_commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 47,
      "pull_request_review_id" : 836127494,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772174126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T08:44:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772174126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772278292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772278292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe I should rethink the usage of importpubkey completely. It seems to be not very well supported anymore.",
      "commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "created_at" : "2021-12-20T11:11:36Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-addresstype=legacy\"]]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Make address1 watch-only in w0\n+        w0.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772278292",
      "id" : 772278292,
      "in_reply_to_id" : 772174126,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII584uCAgU",
      "original_commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 47,
      "pull_request_review_id" : 836270018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772278292/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T11:11:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772278292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> So if I understand the CI error right, it's no longer supported to import pubkeys to wallets that have privkeys (but nodes can?) so I should revert back to two nodes with separate wallets I assume? Sounds like a regression, but if it's the way it is, I'm fine doing that.\r\n\r\nYes. Part of the descriptor wallet changes is to have a clear separation of what is watch-only and what is spendable. This is achieved by having watch-only wallets which do not have private keys, and disallowing descriptor wallets with private keys to include watch-only things. So you should avoid continuing to use the legacy wallet behavior of mixing spendable and watch-only things in one wallet.",
      "created_at" : "2021-12-20T20:10:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-998235303",
      "id" : 998235303,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847f9yn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998235303/reactions"
      },
      "updated_at" : "2021-12-20T20:10:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998235303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772640020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772640020"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ae8564c198a3f9c57cc896489afcb78d6b947b45 \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nThe wallet does not need to be unlocked, so this help text is not needed.",
      "commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "created_at" : "2021-12-20T20:10:56Z",
      "diff_hunk" : "@@ -582,6 +582,94 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772640020",
      "id" : 772640020,
      "line" : 589,
      "node_id" : "PRRC_kwDOABII584uDY0U",
      "original_commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "original_line" : 589,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 836775229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772640020/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T20:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772640020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772640831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772640831"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ae8564c198a3f9c57cc896489afcb78d6b947b45 \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nSince `tx1` is already sent, it will include inputs that are already spent. It seems like we should disallow transactions that spend already spent inputs, at least until we implement conflict checking in this RPC.",
      "commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "created_at" : "2021-12-20T20:12:25Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-addresstype=legacy\"]]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Make address1 watch-only in w0\n+        w0.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])\n+        all = {\"include_watchonly\": True}\n+\n+        tx1 = node.createrawtransaction([], [{address1: 5.0}])\n+        tx2 = node.createrawtransaction([], [{address2: 10.0}])\n+\n+        # w0 should be unaffected (include_watchonly=False) or see +5 (include_watchonly=True) for tx1\n+        assert_equal(w0.simulaterawtransaction([tx1])[\"balance_change\"], 0.0)\n+        assert_equal(w0.simulaterawtransaction([tx1], all)[\"balance_change\"], 5.0)\n+\n+        # w1 should see +5 balance for tx1\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w0 should be unaffected (include_watchonly=False) or see +5 (include_watchonly=True) for both transactions\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 0.0)\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2], all)[\"balance_change\"], 5.0)\n+\n+        # w1 should see +15 balance for both transactions\n+        assert_equal(w1.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 15.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx1)\n+        tx1 = funding[\"hex\"]\n+        bitcoin_fee = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fee + 5 btc decrease, or fee only for watchonly case\n+        assert_approx(w0.simulaterawtransaction([tx1])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee))\n+        assert_approx(w0.simulaterawtransaction([tx1], all)[\"balance_change\"], -(bitcoin_fee))\n+\n+        # w1 sees same as before\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # same inputs (tx) more than once should error\n+        assert_raises_rpc_error(-8, \"Transaction(s) are spending the same output more than once\", w0.simulaterawtransaction, [tx1,tx1])\n+\n+        # send tx1 to avoid reusing same UTXO below\n+        node.sendrawtransaction(w0.signrawtransactionwithwallet(tx1)[\"hex\"])\n+        self.sync_all()\n+\n+        # w0 funds transaction 2; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx2)\n+        tx2 = funding[\"hex\"]\n+        bitcoin_fee2 = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fees + 15 btc decrease, or fees + 10 btc decrease for watch only case\n+        assert_approx(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee + Decimal(\"10\") + bitcoin_fee2))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772640831",
      "id" : 772640831,
      "line" : 92,
      "node_id" : "PRRC_kwDOABII584uDZA_",
      "original_commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "original_line" : 92,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 92,
      "pull_request_review_id" : 836775229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772640831/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T20:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772640831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Approach wise, i think a better API might be `filterrawtxformine`, where it returns a list of inputs and outputs that are `IsMine`.\r\n\r\nAlthough: I think this can already be done with a batch of gettxout and getaddressinfo. Why the need for a new API?\r\n\r\nedit: pseudocode\r\n\r\n```rust\r\nfn simulate(t: Transaction, info: SomeAPI) {\r\n  let results = vec![];\r\n  for out in t.ins.iter().map(|i| info.gettxout(i.hash, i.index)) {\r\n    for address in out.scriptPubKey.addresses {\r\n       if info.getaddressinfo(adress).ismine {\r\n           resuts.push((address, out.value));\r\n           break;\r\n       }\r\n    }\r\n  }\r\n  let outs =  t.outs.iter().filter_map(|v| { let a = info.getaddressinfo(a); if v.ismine {Some((a.address, v.value))} else {None} });\r\n}\r\n```\r\n\r\nThis should be reordable into 2 batches: [all gettxouts + outs gettaddressinfo, inputs getaddressinfo].\r\n\r\nIt could be one if we added a is_mine filter to gettxout so the behavior doesn't change based on wallet presence.",
      "created_at" : "2021-12-20T20:33:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-998250358",
      "id" : 998250358,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847gBd2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998250358/reactions"
      },
      "updated_at" : "2021-12-20T20:44:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998250358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Although: I think this can already be done with a batch of gettxout and getaddressinfo. Why the need for a new API?\r\n\r\nFor users who don't know the various ismine things and how the wallet actually calculates balances, it is preferable to have a built in RPC that does all that for them instead of hoping that what they think the wallet does is actually what it will do.\r\n\r\nAdditionally, I would like to see this RPC be expanded to be more than just balance calculation (in a future PR). I would like to have it check for conflicts, and that would require much more work if implemented externally.",
      "created_at" : "2021-12-21T00:23:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-998367654",
      "id" : 998367654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847geGm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998367654/reactions"
      },
      "updated_at" : "2021-12-21T00:23:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998367654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "that seems like a recursive problem. A new wallet rpc will probably not do what we think a user should do?\r\n\r\nMaybe it's more a matter of cleaning up / augmenting the behavior of things like ismine so that the behavior is clearer for API consumers?",
      "created_at" : "2021-12-21T00:56:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-998381444",
      "id" : 998381444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847gheE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998381444/reactions"
      },
      "updated_at" : "2021-12-21T00:56:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998381444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "that said I don't think there's a terrible cost to a new RPC if it's useful, but I think we should have a concrete justification comparing it to the equivalent userland code. E.g., there have been cases where you can do it in userland but it is very very inefficient.",
      "created_at" : "2021-12-21T00:58:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-998382140",
      "id" : 998382140,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847gho8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998382140/reactions"
      },
      "updated_at" : "2021-12-21T00:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998382140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772836367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772836367"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point, removed.",
      "commit_id" : "b952b9faad0898119a584c6697e83d0f3a269cb8",
      "created_at" : "2021-12-21T05:23:17Z",
      "diff_hunk" : "@@ -582,6 +582,94 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\" +\n+        HELP_REQUIRING_PASSPHRASE,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772836367",
      "id" : 772836367,
      "in_reply_to_id" : 772640020,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uEIwP",
      "original_commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "original_line" : 589,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 837028284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772836367/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-21T05:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772836367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772870187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772870187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added fetch/check of coins for transactions and RPC asserts when coins are missing or spent.",
      "commit_id" : "b952b9faad0898119a584c6697e83d0f3a269cb8",
      "created_at" : "2021-12-21T06:50:22Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-addresstype=legacy\"]]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Make address1 watch-only in w0\n+        w0.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])\n+        all = {\"include_watchonly\": True}\n+\n+        tx1 = node.createrawtransaction([], [{address1: 5.0}])\n+        tx2 = node.createrawtransaction([], [{address2: 10.0}])\n+\n+        # w0 should be unaffected (include_watchonly=False) or see +5 (include_watchonly=True) for tx1\n+        assert_equal(w0.simulaterawtransaction([tx1])[\"balance_change\"], 0.0)\n+        assert_equal(w0.simulaterawtransaction([tx1], all)[\"balance_change\"], 5.0)\n+\n+        # w1 should see +5 balance for tx1\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w0 should be unaffected (include_watchonly=False) or see +5 (include_watchonly=True) for both transactions\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 0.0)\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2], all)[\"balance_change\"], 5.0)\n+\n+        # w1 should see +15 balance for both transactions\n+        assert_equal(w1.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 15.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx1)\n+        tx1 = funding[\"hex\"]\n+        bitcoin_fee = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fee + 5 btc decrease, or fee only for watchonly case\n+        assert_approx(w0.simulaterawtransaction([tx1])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee))\n+        assert_approx(w0.simulaterawtransaction([tx1], all)[\"balance_change\"], -(bitcoin_fee))\n+\n+        # w1 sees same as before\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # same inputs (tx) more than once should error\n+        assert_raises_rpc_error(-8, \"Transaction(s) are spending the same output more than once\", w0.simulaterawtransaction, [tx1,tx1])\n+\n+        # send tx1 to avoid reusing same UTXO below\n+        node.sendrawtransaction(w0.signrawtransactionwithwallet(tx1)[\"hex\"])\n+        self.sync_all()\n+\n+        # w0 funds transaction 2; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx2)\n+        tx2 = funding[\"hex\"]\n+        bitcoin_fee2 = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fees + 15 btc decrease, or fees + 10 btc decrease for watch only case\n+        assert_approx(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee + Decimal(\"10\") + bitcoin_fee2))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r772870187",
      "id" : 772870187,
      "in_reply_to_id" : 772640831,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uERAr",
      "original_commit_id" : "ae8564c198a3f9c57cc896489afcb78d6b947b45",
      "original_line" : 93,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : null,
      "pull_request_review_id" : 837072340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772870187/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-21T06:50:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772870187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Yes. Part of the descriptor wallet changes is to have a clear separation of what is watch-only and what is spendable. This is achieved by having watch-only wallets which do not have private keys, and disallowing descriptor wallets with private keys to include watch-only things. So you should avoid continuing to use the legacy wallet behavior of mixing spendable and watch-only things in one wallet.\r\n\r\nUnderstood! I've added a third watch-only wallet and moved the watch-only checks there.\r\n",
      "created_at" : "2021-12-21T06:56:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-998521412",
      "id" : 998521412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847hDpE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998521412/reactions"
      },
      "updated_at" : "2021-12-21T06:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998521412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773430392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773430392"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In aaa078857aa0bd4d881f781992dfc7c11aef0451 \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nI think this section isn't doing anything now.",
      "commit_id" : "aaa078857aa0bd4d881f781992dfc7c11aef0451",
      "created_at" : "2021-12-21T20:40:14Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        node.createwallet(wallet_name='w2', disable_private_keys=True)\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+        w2 = node.get_wallet_rpc('w2')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Add address1 as watch-only to w2\n+        w2.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])\n+\n+        tx1 = node.createrawtransaction([], [{address1: 5.0}])\n+        tx2 = node.createrawtransaction([], [{address2: 10.0}])\n+\n+        # w0 should be unaffected, w2 should see +5 for tx1\n+        assert_equal(w0.simulaterawtransaction([tx1])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +5 balance for tx1\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w0 should be unaffected, w2 should see +5 for both transactions\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +15 balance for both transactions\n+        assert_equal(w1.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 15.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx1)\n+        tx1 = funding[\"hex\"]\n+        bitcoin_fee = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fee + 5 btc decrease, w2 sees + 5 btc\n+        assert_approx(w0.simulaterawtransaction([tx1])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee))\n+        assert_approx(w2.simulaterawtransaction([tx1])[\"balance_change\"], Decimal(\"5\"))\n+\n+        # w1 sees same as before\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # same inputs (tx) more than once should error\n+        assert_raises_rpc_error(-8, \"Transaction(s) are spending the same output more than once\", w0.simulaterawtransaction, [tx1,tx1])\n+\n+        # send tx1 to avoid reusing same UTXO below\n+        node.sendrawtransaction(w0.signrawtransactionwithwallet(tx1)[\"hex\"])\n+        self.generate(node, 1, sync_fun=self.no_op) # Confirm tx to trigger error below\n+        self.sync_all()\n+\n+        # w0 funds transaction 2; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx2)\n+        tx2 = funding[\"hex\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773430392",
      "id" : 773430392,
      "line" : 89,
      "node_id" : "PRRC_kwDOABII584uGZx4",
      "original_commit_id" : "aaa078857aa0bd4d881f781992dfc7c11aef0451",
      "original_line" : 89,
      "original_position" : 89,
      "original_start_line" : 87,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 89,
      "pull_request_review_id" : 837853020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773430392/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 87,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-21T20:45:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773430392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773432776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773432776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In aaa078857aa0bd4d881f781992dfc7c11aef0451 \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nIf the UTXO points to one of the transactions in the array, then this would fail. I think it is possible someone would do this, especially with package relay on the horizon.\r\n\r\nWe could have `coins` outside of the `txs `loop, add the outputs of each tx to `coins`, and also remove coins as they are processed in this loop.",
      "commit_id" : "aaa078857aa0bd4d881f781992dfc7c11aef0451",
      "created_at" : "2021-12-21T20:45:10Z",
      "diff_hunk" : "@@ -582,6 +582,109 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            if (spent.count(txin.prevout)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            if (!coins.count(txin.prevout)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773432776",
      "id" : 773432776,
      "line" : 661,
      "node_id" : "PRRC_kwDOABII584uGaXI",
      "original_commit_id" : "aaa078857aa0bd4d881f781992dfc7c11aef0451",
      "original_line" : 661,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 80,
      "pull_request_review_id" : 837853020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773432776/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-21T20:45:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773432776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773588753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773588753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Re-added tests for tx2 only.",
      "commit_id" : "04c1d6f847352de9da5c49303b2e71cdd37cc459",
      "created_at" : "2021-12-22T04:17:33Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        node.createwallet(wallet_name='w2', disable_private_keys=True)\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+        w2 = node.get_wallet_rpc('w2')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Add address1 as watch-only to w2\n+        w2.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])\n+\n+        tx1 = node.createrawtransaction([], [{address1: 5.0}])\n+        tx2 = node.createrawtransaction([], [{address2: 10.0}])\n+\n+        # w0 should be unaffected, w2 should see +5 for tx1\n+        assert_equal(w0.simulaterawtransaction([tx1])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +5 balance for tx1\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w0 should be unaffected, w2 should see +5 for both transactions\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +15 balance for both transactions\n+        assert_equal(w1.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 15.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx1)\n+        tx1 = funding[\"hex\"]\n+        bitcoin_fee = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fee + 5 btc decrease, w2 sees + 5 btc\n+        assert_approx(w0.simulaterawtransaction([tx1])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee))\n+        assert_approx(w2.simulaterawtransaction([tx1])[\"balance_change\"], Decimal(\"5\"))\n+\n+        # w1 sees same as before\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # same inputs (tx) more than once should error\n+        assert_raises_rpc_error(-8, \"Transaction(s) are spending the same output more than once\", w0.simulaterawtransaction, [tx1,tx1])\n+\n+        # send tx1 to avoid reusing same UTXO below\n+        node.sendrawtransaction(w0.signrawtransactionwithwallet(tx1)[\"hex\"])\n+        self.generate(node, 1, sync_fun=self.no_op) # Confirm tx to trigger error below\n+        self.sync_all()\n+\n+        # w0 funds transaction 2; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx2)\n+        tx2 = funding[\"hex\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773588753",
      "id" : 773588753,
      "in_reply_to_id" : 773430392,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII584uHAcR",
      "original_commit_id" : "aaa078857aa0bd4d881f781992dfc7c11aef0451",
      "original_line" : 117,
      "original_position" : 89,
      "original_start_line" : 87,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 117,
      "pull_request_review_id" : 838055270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773588753/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 115,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-22T04:17:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773588753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773598867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773598867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To avoid things like tx1 spending tx2 and tx2 spending tx1, I think we may want to strictly require that transactions are in order. If we do, I think we can just iterate one at a time and just append new outputs as we go, without the extra round.\r\n\r\nI updated the code to reflect this suggestion.\r\n\r\nEditre-reading your suggestion, I think maybe you suggested the same thing I am saying..",
      "commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "created_at" : "2021-12-22T04:55:49Z",
      "diff_hunk" : "@@ -582,6 +582,109 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            if (spent.count(txin.prevout)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            if (!coins.count(txin.prevout)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r773598867",
      "id" : 773598867,
      "in_reply_to_id" : 773432776,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uHC6T",
      "original_commit_id" : "aaa078857aa0bd4d881f781992dfc7c11aef0451",
      "original_line" : 661,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 838068019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773598867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-22T05:40:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773598867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> A new wallet rpc will probably not do what we think a user should do?\r\n\r\n@JeremyRubin \r\n\r\nThere is an alternative solution in https://github.com/bitcoin/bitcoin/pull/22776 which does not add any new RPC command",
      "created_at" : "2021-12-22T08:04:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-999365671",
      "id" : 999365671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847kRwn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999365671/reactions"
      },
      "updated_at" : "2021-12-22T08:05:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999365671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@prayank23 my point was more that no code changes are required to use a constant number of RPC calls to answer this question. This technique might not have occurred to Kalle, so it was worth sharing.\r\n\r\nAndrew's response ~was that \"the already wallet does not do what you think it does\" and that future changes might extend this RPC further.\r\n\r\nI think adding an RPC makes more sense than changing and old one and both make less sense than not adding anything new unless there is a tangible issue with the mock algorithm i provided. A tangible issue could be \"It's slow\" or \"race conditions between batches\". I don't think we should have that issue here. Another compelling answer is \"well it should eventually check for conflicts too, which we can't do well via just RPCs\". In this case I would be curious to know if the check for conflict RPC should really be it's own RPC, and if we might benefit from thinking that through before pushing this.\r\n\r\nI'm also worried that if there are defects in existing RPCs that make them unreliable somehow that we might fix those too.\r\nI am curious -- for my benefit to learn -- why Andrew thinks the ismine field is not safe to use for this.\r\n\r\nAll that said, an RPC isn't giving anyone cancer so by all means, merge if it's useful. \r\n\r\n",
      "created_at" : "2021-12-22T09:03:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-999404890",
      "id" : 999404890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847kbVa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999404890/reactions"
      },
      "updated_at" : "2021-12-22T09:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999404890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@JeremyRubin Primarily, my reason for wanting this is because I want a clear-cut way to say that the wallet changes I expect are happening. Yes I could manually write code to use getaddressinfo to do parts of this, but I *might get it wrong*. (Note that the command also includes new UTXO balance changes, which your pseudo-code does not, I think?)",
      "created_at" : "2021-12-23T04:44:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1000039672",
      "id" : 1000039672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847m2T4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000039672/reactions"
      },
      "updated_at" : "2021-12-23T04:44:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000039672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah you should be able to add it onto the code i provided by just inspecting the inputs/outputs fetched with something like:\r\n\r\n```rust\r\nouts.iter().map(|v| v.1).sum()  - results.iter().map(|v| v.1).sum() \r\n```\r\n-------------\r\ni don't have a problem with this RPC existing, it does seem useful.\r\n\r\nBut I want to point out some other problematic behavior you might not have considered:\r\n\r\nsuppose I have a wallet that has an address X that ismine but has the script/descriptor: `and(older(2 years), key(mine))`\r\n\r\nSuppose my wallet has outputs J under address A and K under address X that has matured.\r\n\r\nthen i ask my node to analyze a transaction that looks like:\r\n\r\nInputs: (J, 2.0) (K, 1.0), ....\r\nOutputs: (A, 2.0), (X,  1.0), ....\r\n\r\nwhere I was expecting the J -> A as my coinjoin, but K -> X was unexpected. Now my funds got automatically locked for another 2 years and this was not caught by this logic because the balance seemed fine.\r\n\r\n------\r\n\r\nIDK if we can have CSV scripts in descriptors today, but it's something to note that APIs like this are incredibly tricks.\r\n\r\nI think the better version would be something like \"I expect to care about input J and output A\" and no other effect.",
      "created_at" : "2021-12-23T07:22:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1000098125",
      "id" : 1000098125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847nElN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000098125/reactions"
      },
      "updated_at" : "2021-12-23T07:22:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000098125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> But I want to point out some other problematic behavior you might not have considered:\r\n\r\nThose to me sound like good reasons to *have* a command like this, as it seems like a natural expansion to add feedback related to time locks in the response.",
      "created_at" : "2021-12-23T10:35:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1000204888",
      "id" : 1000204888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847nepY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000204888/reactions"
      },
      "updated_at" : "2021-12-23T10:35:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000204888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "i don't have a great answer for all this, it does seem to me that the best case is to make sure *the only* things matches are the ones you expect to be there, and that you *only* sign those.\r\n\r\nAnything else could be a vuln.",
      "created_at" : "2021-12-28T03:04:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1001844409",
      "id" : 1001844409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5847tu65",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1001844409/reactions"
      },
      "updated_at" : "2021-12-28T03:04:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1001844409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-03T08:40:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1003940600",
      "id" : 1003940600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII58471ur4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1003940600/reactions"
      },
      "updated_at" : "2022-01-03T08:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1003940600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782580085"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782580085"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 84a745eed211b597a89f3bbc3da73b0ac2cb457d \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nThis loop doesn't make sense here. It shouldn't be necessary to iterate `txs` at the same time we are already iterating `txs`.\r\n\r\nAt best, this could be moved outside of the first `txs` loop as a preprocessing step to extract all of the UTXOs created, but I don't think that would be a good idea. That would allow for transactions that have circular dependencies and those would be invalid. It is fine to have an order requirement as that is what package validation requires.",
      "commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "created_at" : "2022-01-11T22:42:00Z",
      "diff_hunk" : "@@ -582,6 +582,124 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            auto& op = txin.prevout;\n+            if (spent.count(op)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            if (new_utxos.count(op)) {\n+                changes -= new_utxos.at(op);\n+                new_utxos.erase(op);\n+            } else {\n+                if (!coins.count(op)) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs are missing\");\n+                }\n+                if (coins.at(txin.prevout).IsSpent()) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs have been spent already\");\n+                }\n+                changes -= pwallet->GetDebit(txin, filter);\n+            }\n+            spent.insert(txin.prevout);\n+        }\n+\n+        for (size_t i = 0; i < txs.size(); ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782580085",
      "id" : 782580085,
      "line" : 678,
      "node_id" : "PRRC_kwDOABII584upTl1",
      "original_commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "original_line" : 678,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 97,
      "pull_request_review_id" : 849804088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782580085/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-11T22:52:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782580085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782580433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782580433"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 84a745eed211b597a89f3bbc3da73b0ac2cb457d \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nThis can be moved into the loop below that iterates the outputs.",
      "commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "created_at" : "2022-01-11T22:42:44Z",
      "diff_hunk" : "@@ -582,6 +582,124 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            auto& op = txin.prevout;\n+            if (spent.count(op)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            if (new_utxos.count(op)) {\n+                changes -= new_utxos.at(op);\n+                new_utxos.erase(op);\n+            } else {\n+                if (!coins.count(op)) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs are missing\");\n+                }\n+                if (coins.at(txin.prevout).IsSpent()) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs have been spent already\");\n+                }\n+                changes -= pwallet->GetDebit(txin, filter);\n+            }\n+            spent.insert(txin.prevout);\n+        }\n+\n+        for (size_t i = 0; i < txs.size(); ++i) {\n+            // Populate new outputs\n+            const auto hash = mtx.GetHash();\n+            for (size_t i = 0; i < mtx.vout.size(); ++i) {\n+                new_utxos[COutPoint(hash, i)] = (pwallet->IsMine(mtx.vout[i]) & filter) ? mtx.vout[i].nValue : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782580433",
      "id" : 782580433,
      "line" : 682,
      "node_id" : "PRRC_kwDOABII584upTrR",
      "original_commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "original_line" : 682,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 101,
      "pull_request_review_id" : 849804088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782580433/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-11T22:52:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782580433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782581564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782581564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 84a745eed211b597a89f3bbc3da73b0ac2cb457d \"rpc/wallet: add simulaterawtransaction RPC\"\r\n\r\nWallet functional tests should appear in test_runner.py twice, once with `--legacy-wallet` and once with `--descriptors`.",
      "commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "created_at" : "2022-01-11T22:45:06Z",
      "diff_hunk" : "@@ -258,6 +258,7 @@\n     'wallet_implicitsegwit.py --legacy-wallet',\n     'rpc_named_arguments.py',\n     'feature_startupnotify.py',\n+    'wallet_simulaterawtx.py',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782581564",
      "id" : 782581564,
      "line" : 261,
      "node_id" : "PRRC_kwDOABII584upT88",
      "original_commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "original_line" : 261,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : 4,
      "pull_request_review_id" : 849804088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782581564/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-11T22:52:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782581564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782647274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782647274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, this was clearly a mistake. I removed the loop and kept the inner block only.",
      "commit_id" : "45a0a64613719bc1798910d01d4d9e600ccd206f",
      "created_at" : "2022-01-12T01:35:21Z",
      "diff_hunk" : "@@ -582,6 +582,124 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            auto& op = txin.prevout;\n+            if (spent.count(op)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            if (new_utxos.count(op)) {\n+                changes -= new_utxos.at(op);\n+                new_utxos.erase(op);\n+            } else {\n+                if (!coins.count(op)) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs are missing\");\n+                }\n+                if (coins.at(txin.prevout).IsSpent()) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs have been spent already\");\n+                }\n+                changes -= pwallet->GetDebit(txin, filter);\n+            }\n+            spent.insert(txin.prevout);\n+        }\n+\n+        for (size_t i = 0; i < txs.size(); ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782647274",
      "id" : 782647274,
      "in_reply_to_id" : 782580085,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584upj_q",
      "original_commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "original_line" : 678,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 849892498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782647274/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-12T01:35:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782647274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782647823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782647823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Moved.",
      "commit_id" : "45a0a64613719bc1798910d01d4d9e600ccd206f",
      "created_at" : "2022-01-12T01:37:06Z",
      "diff_hunk" : "@@ -582,6 +582,124 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    CAmount changes{0};\n+    std::set<COutPoint> spent;\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            auto& op = txin.prevout;\n+            if (spent.count(op)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            if (new_utxos.count(op)) {\n+                changes -= new_utxos.at(op);\n+                new_utxos.erase(op);\n+            } else {\n+                if (!coins.count(op)) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs are missing\");\n+                }\n+                if (coins.at(txin.prevout).IsSpent()) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs have been spent already\");\n+                }\n+                changes -= pwallet->GetDebit(txin, filter);\n+            }\n+            spent.insert(txin.prevout);\n+        }\n+\n+        for (size_t i = 0; i < txs.size(); ++i) {\n+            // Populate new outputs\n+            const auto hash = mtx.GetHash();\n+            for (size_t i = 0; i < mtx.vout.size(); ++i) {\n+                new_utxos[COutPoint(hash, i)] = (pwallet->IsMine(mtx.vout[i]) & filter) ? mtx.vout[i].nValue : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782647823",
      "id" : 782647823,
      "in_reply_to_id" : 782580433,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584upkIP",
      "original_commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "original_line" : 682,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 849893231,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782647823/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-12T01:37:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782647823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782648108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782648108"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Got it. Done.",
      "commit_id" : "45a0a64613719bc1798910d01d4d9e600ccd206f",
      "created_at" : "2022-01-12T01:38:00Z",
      "diff_hunk" : "@@ -258,6 +258,7 @@\n     'wallet_implicitsegwit.py --legacy-wallet',\n     'rpc_named_arguments.py',\n     'feature_startupnotify.py',\n+    'wallet_simulaterawtx.py',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782648108",
      "id" : 782648108,
      "in_reply_to_id" : 782581564,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584upkMs",
      "original_commit_id" : "84a745eed211b597a89f3bbc3da73b0ac2cb457d",
      "original_line" : 261,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : null,
      "pull_request_review_id" : 849893595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782648108/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-12T01:38:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782648108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782693596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782693596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I hope this line isn't overly confusing.",
      "commit_id" : "aff96844f7086458a414df9bb5cf9327a7266f2d",
      "created_at" : "2022-01-12T04:03:10Z",
      "diff_hunk" : "@@ -583,6 +583,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            auto& op = txin.prevout;\n+            if (spent.count(op)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\n+            }\n+            if (new_utxos.count(op)) {\n+                changes -= new_utxos.at(op);\n+                new_utxos.erase(op);\n+            } else {\n+                if (!coins.count(op)) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs are missing\");\n+                }\n+                if (coins.at(op).IsSpent()) {\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs have been spent already\");\n+                }\n+                changes -= pwallet->GetDebit(txin, filter);\n+            }\n+            spent.insert(op);\n+        }\n+\n+        // Iterate over outputs; we are *receiving* these, if the wallet considers\n+        // them \"mine\"; if the transaction is signed and broadcast, we will receive\n+        // everything in these\n+        // Also populate new_utxos in case these are spent in later transactions\n+\n+        const auto hash = mtx.GetHash();\n+        for (size_t i = 0; i < mtx.vout.size(); ++i) {\n+            const auto& txout = mtx.vout[i];\n+            bool is_mine = 0 < (pwallet->IsMine(txout) & filter);\n+            changes += new_utxos[COutPoint(hash, i)] = is_mine ? txout.nValue : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r782693596",
      "id" : 782693596,
      "line" : 688,
      "node_id" : "PRRC_kwDOABII584upvTc",
      "original_commit_id" : "aff96844f7086458a414df9bb5cf9327a7266f2d",
      "original_line" : 688,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 106,
      "pull_request_review_id" : 849951601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782693596/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-12T04:03:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/782693596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK aff96844f7086458a414df9bb5cf9327a7266f2d",
      "created_at" : "2022-01-12T19:53:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1011398002",
      "id" : 1011398002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII5848SLVy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1011398002/reactions"
      },
      "updated_at" : "2022-01-12T19:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1011398002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@meshcollider @jonatack @kristapsk @laanwj re-review this?",
      "created_at" : "2022-03-08T13:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1061767404",
      "id" : 1061767404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII584_SUjs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1061767404/reactions"
      },
      "updated_at" : "2022-03-08T13:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1061767404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-30T14:31:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1083215082",
      "id" : 1083215082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII585AkIzq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1083215082/reactions"
      },
      "updated_at" : "2022-03-30T14:31:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1083215082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK bd520345f7a5076e5e1eb3877f6330a9e5816267",
      "created_at" : "2022-04-25T15:00:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1108689122",
      "id" : 1108689122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII585CFUDi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108689122/reactions"
      },
      "updated_at" : "2022-04-25T15:00:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108689122",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r857992736"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857992736"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This results in `Decimal('0.000010000000000000000818030539140313095458623138256371021270751953125')`\r\n\r\nBetter to just insist `v` and `vexp` have compatible types, and default `vspan` sanely?",
      "commit_id" : "bd520345f7a5076e5e1eb3877f6330a9e5816267",
      "created_at" : "2022-04-25T20:15:15Z",
      "diff_hunk" : "@@ -28,6 +28,10 @@\n \n def assert_approx(v, vexp, vspan=0.00001):\n     \"\"\"Assert that `v` is within `vspan` of `vexp`\"\"\"\n+    if isinstance(v, Decimal) or isinstance(vexp, Decimal):\n+        v=Decimal(v)\n+        vexp=Decimal(vexp)\n+        vspan=Decimal(vspan)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r857992736",
      "id" : 857992736,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII584zI-4g",
      "original_commit_id" : "bd520345f7a5076e5e1eb3877f6330a9e5816267",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 7,
      "pull_request_review_id" : 952403512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857992736/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-25T20:15:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857992736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r858273189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858273189"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The idea is to let the caller not worry too much about converting stuff to/from Decimal instances. Is there an issue due to `vspan` having some noise somewhere?",
      "commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-04-26T05:11:38Z",
      "diff_hunk" : "@@ -28,6 +28,10 @@\n \n def assert_approx(v, vexp, vspan=0.00001):\n     \"\"\"Assert that `v` is within `vspan` of `vexp`\"\"\"\n+    if isinstance(v, Decimal) or isinstance(vexp, Decimal):\n+        v=Decimal(v)\n+        vexp=Decimal(vexp)\n+        vspan=Decimal(vspan)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r858273189",
      "id" : 858273189,
      "in_reply_to_id" : 857992736,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII584zKDWl",
      "original_commit_id" : "bd520345f7a5076e5e1eb3877f6330a9e5816267",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 7,
      "pull_request_review_id" : 952756168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858273189/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-26T06:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858273189",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ack. Tested manually. Works fine.\r\n\r\nI have also created a follow up [PR](https://github.com/bitcoin/bitcoin/pull/25621) which extends the functionality of this RPC.",
      "created_at" : "2022-07-25T10:41:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1193878890",
      "id" : 1193878890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII585HKSVq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193878890/reactions"
      },
      "updated_at" : "2022-07-25T10:41:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193878890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44436898?v=4",
         "events_url" : "https://api.github.com/users/anibilthare/events{/privacy}",
         "followers_url" : "https://api.github.com/users/anibilthare/followers",
         "following_url" : "https://api.github.com/users/anibilthare/following{/other_user}",
         "gists_url" : "https://api.github.com/users/anibilthare/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/anibilthare",
         "id" : 44436898,
         "login" : "anibilthare",
         "node_id" : "MDQ6VXNlcjQ0NDM2ODk4",
         "organizations_url" : "https://api.github.com/users/anibilthare/orgs",
         "received_events_url" : "https://api.github.com/users/anibilthare/received_events",
         "repos_url" : "https://api.github.com/users/anibilthare/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/anibilthare/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/anibilthare/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/anibilthare"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-07-26T18:03:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1195809523",
      "id" : 1195809523,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII585HRprz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1195809523/reactions"
      },
      "updated_at" : "2022-07-26T18:03:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1195809523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r930327560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930327560"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Based on the command description, why this is needed?\r\n\r\nShouldn't `simulaterawtransaction` only care about how the wallet behaves if a certain transaction gets relayed to the network?.\r\n\r\nIn other words, doesn't seems to be ok to fetch inputs that are not owned/watched by this wallet as them don't mean anything for the wallet.\r\n\r\nWe could replace the input spendability check that is below using `wallet.IsSpent(outpoint)`.",
      "commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-07-26T19:14:19Z",
      "diff_hunk" : "@@ -590,6 +590,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r930327560",
      "id" : 930327560,
      "line" : 662,
      "node_id" : "PRRC_kwDOABII5843c6wI",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 662,
      "original_position" : 73,
      "original_start_line" : 657,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 73,
      "pull_request_review_id" : 1051495723,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930327560/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 657,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-26T20:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930327560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r930621983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930621983"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure what you're proposing. Mind writing a patch that describes your suggestion?",
      "commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-07-27T05:01:26Z",
      "diff_hunk" : "@@ -590,6 +590,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r930621983",
      "id" : 930621983,
      "in_reply_to_id" : 930327560,
      "line" : 662,
      "node_id" : "PRRC_kwDOABII5843eCof",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 662,
      "original_position" : 73,
      "original_start_line" : 657,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 73,
      "pull_request_review_id" : 1051890889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930621983/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 657,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-27T05:01:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930621983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r931526163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931526163"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't these 4 cases raise the exception `One or more transaction inputs are missing` ?\r\n\r\nAnyway, this exception is not being tested.",
      "commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-07-27T19:52:11Z",
      "diff_hunk" : "@@ -0,0 +1,129 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        node.createwallet(wallet_name='w2', disable_private_keys=True)\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+        w2 = node.get_wallet_rpc('w2')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Add address1 as watch-only to w2\n+        w2.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])\n+\n+        tx1 = node.createrawtransaction([], [{address1: 5.0}])\n+        tx2 = node.createrawtransaction([], [{address2: 10.0}])\n+\n+        # w0 should be unaffected, w2 should see +5 for tx1\n+        assert_equal(w0.simulaterawtransaction([tx1])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +5 balance for tx1\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w0 should be unaffected, w2 should see +5 for both transactions\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +15 balance for both transactions\n+        assert_equal(w1.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 15.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx1)\n+        tx1 = funding[\"hex\"]\n+        tx1changepos = funding[\"changepos\"]\n+        bitcoin_fee = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fee + 5 btc decrease, w2 sees + 5 btc\n+        assert_approx(w0.simulaterawtransaction([tx1])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee))\n+        assert_approx(w2.simulaterawtransaction([tx1])[\"balance_change\"], Decimal(\"5\"))\n+\n+        # w1 sees same as before\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # same inputs (tx) more than once should error\n+        assert_raises_rpc_error(-8, \"Transaction(s) are spending the same output more than once\", w0.simulaterawtransaction, [tx1,tx1])\n+\n+        tx1ob = node.decoderawtransaction(tx1)\n+        tx1hex = tx1ob[\"txid\"]\n+        tx1vout = 1 - tx1changepos\n+        # tx3 spends new w1 UTXO paying to w0\n+        tx3 = node.createrawtransaction([{\"txid\": tx1hex, \"vout\": tx1vout}], {w0.getnewaddress(): 4.9999})\n+        # tx4 spends new w1 UTXO paying to w1\n+        tx4 = node.createrawtransaction([{\"txid\": tx1hex, \"vout\": tx1vout}], {w1.getnewaddress(): 4.9999})\n+\n+        # on their own, both should fail due to missing input(s)\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w0.simulaterawtransaction, [tx3])\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w1.simulaterawtransaction, [tx3])\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w0.simulaterawtransaction, [tx4])\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w1.simulaterawtransaction, [tx4])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r931526163",
      "id" : 931526163,
      "line" : 95,
      "node_id" : "PRRC_kwDOABII5843hfYT",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 95,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : 95,
      "pull_request_review_id" : 1053149102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931526163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-27T19:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931526163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r931527652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931527652"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: perhaps the `op` variable can be renamed to `outpoint` for the sake of clarity.",
      "commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-07-27T19:54:07Z",
      "diff_hunk" : "@@ -590,6 +590,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            auto& op = txin.prevout;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r931527652",
      "id" : 931527652,
      "line" : 667,
      "node_id" : "PRRC_kwDOABII5843hfvk",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 667,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 78,
      "pull_request_review_id" : 1053149102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931527652/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-27T19:56:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931527652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r934726882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934726882"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "sure, it's merely about removing the coins fetching from chain and using the wallet information to answer the spendability question.",
      "commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-08-01T16:46:42Z",
      "diff_hunk" : "@@ -590,6 +590,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r934726882",
      "id" : 934726882,
      "in_reply_to_id" : 930327560,
      "line" : 662,
      "node_id" : "PRRC_kwDOABII5843tszi",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 662,
      "original_position" : 73,
      "original_start_line" : 657,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 73,
      "pull_request_review_id" : 1057587446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934726882/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 657,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-01T16:46:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934726882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r934738215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934738215"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note: haven't tested it but check it out:\r\n```\r\ndiff --git a/src/wallet/rpc/wallet.cpp b/src/wallet/rpc/wallet.cpp\r\n--- a/src/wallet/rpc/wallet.cpp\t(revision b557f53eac39b92bfc4922729e94087556de749a)\r\n+++ b/src/wallet/rpc/wallet.cpp\t(date 1659372880572)\r\n@@ -654,13 +654,6 @@\r\n             throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\r\n         }\r\n \r\n-        // Fetch previous transactions (inputs)\r\n-        std::map<COutPoint, Coin> coins;\r\n-        for (const CTxIn& txin : mtx.vin) {\r\n-            coins[txin.prevout]; // Create empty map entry keyed by prevout.\r\n-        }\r\n-        pwallet->chain().findCoins(coins);\r\n-\r\n         // Fetch debit; we are *spending* these; if the transaction is signed and\r\n         // broadcast, we will lose everything in these\r\n         for (const auto& txin : mtx.vin) {\r\n@@ -668,19 +661,21 @@\r\n             if (spent.count(op)) {\r\n                 throw JSONRPCError(RPC_INVALID_PARAMETER, \"Transaction(s) are spending the same output more than once\");\r\n             }\r\n+            spent.insert(op); // mark it as spent\r\n             if (new_utxos.count(op)) {\r\n                 changes -= new_utxos.at(op);\r\n                 new_utxos.erase(op);\r\n             } else {\r\n-                if (!coins.count(op)) {\r\n-                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs are missing\");\r\n-                }\r\n-                if (coins.at(op).IsSpent()) {\r\n+                const auto* input_wtx = pwallet->GetWalletTx(txin.prevout.hash);\r\n+                if (!input_wtx) continue;\r\n+                if (input_wtx->tx->vout.size() >= txin.prevout.n) continue; // todo: this should throw an error\r\n+\r\n+                if (!(pwallet->IsMine(input_wtx->tx->vout[txin.prevout.n]) & filter)) continue;\r\n+                if (pwallet->IsSpent(txin.prevout)) {\r\n                     throw JSONRPCError(RPC_INVALID_PARAMETER, \"One or more transaction inputs have been spent already\");\r\n                 }\r\n                 changes -= pwallet->GetDebit(txin, filter);\r\n             }\r\n-            spent.insert(op);\r\n         }\r\n \r\n         // Iterate over outputs; we are *receiving* these, if the wallet considers\r\n```\r\n\r\nAs said in the comment, it's about only using the wallet information to check the transaction and not the chain information. Mainly because, in this command, we only care about the wallet state.",
      "commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "created_at" : "2022-08-01T17:00:40Z",
      "diff_hunk" : "@@ -590,6 +590,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r934738215",
      "id" : 934738215,
      "in_reply_to_id" : 930327560,
      "line" : 662,
      "node_id" : "PRRC_kwDOABII5843tvkn",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 662,
      "original_position" : 73,
      "original_start_line" : 657,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 73,
      "pull_request_review_id" : 1057603018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934738215/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 657,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-01T17:00:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934738215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r935024442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935024442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure that's an improvement. The current implementation seems to be a bit more straightforward, even if it ends up pulling in a few extra inputs. If the difference in performance is significant it might be worth it though, but I'm dubious. :)",
      "commit_id" : "ced8a3e77d0dde428360f2250576582b624c013c",
      "created_at" : "2022-08-02T00:59:10Z",
      "diff_hunk" : "@@ -590,6 +590,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r935024442",
      "id" : 935024442,
      "in_reply_to_id" : 930327560,
      "line" : 662,
      "node_id" : "PRRC_kwDOABII5843u1c6",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 662,
      "original_position" : 73,
      "original_start_line" : 657,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 73,
      "pull_request_review_id" : 1057999754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935024442/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 657,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-02T00:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935024442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r935027517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935027517"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're right. I don't think that exception will ever be triggered, because `coins` is always populated with all the outputs in `mtx.vin` in the earlier block. I think the best approach is to simply reword this exception to say \"spent or missing\" and drop the other one.",
      "commit_id" : "ced8a3e77d0dde428360f2250576582b624c013c",
      "created_at" : "2022-08-02T01:07:50Z",
      "diff_hunk" : "@@ -0,0 +1,129 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test simulaterawtransaction.\n+\"\"\"\n+\n+from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_approx,\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class SimulateTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self, split=False):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        node = self.nodes[0]\n+\n+        self.generate(node, 1, sync_fun=self.no_op) # Leave IBD\n+\n+        node.createwallet(wallet_name='w0')\n+        node.createwallet(wallet_name='w1')\n+        node.createwallet(wallet_name='w2', disable_private_keys=True)\n+        w0 = node.get_wallet_rpc('w0')\n+        w1 = node.get_wallet_rpc('w1')\n+        w2 = node.get_wallet_rpc('w2')\n+\n+        self.generatetoaddress(node, COINBASE_MATURITY + 1, w0.getnewaddress())\n+        assert_equal(w0.getbalance(), 50.0)\n+        assert_equal(w1.getbalance(), 0.0)\n+\n+        address1 = w1.getnewaddress()\n+        address2 = w1.getnewaddress()\n+\n+        # Add address1 as watch-only to w2\n+        w2.importpubkey(pubkey=w1.getaddressinfo(address1)[\"pubkey\"])\n+\n+        tx1 = node.createrawtransaction([], [{address1: 5.0}])\n+        tx2 = node.createrawtransaction([], [{address2: 10.0}])\n+\n+        # w0 should be unaffected, w2 should see +5 for tx1\n+        assert_equal(w0.simulaterawtransaction([tx1])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +5 balance for tx1\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # w0 should be unaffected, w2 should see +5 for both transactions\n+        assert_equal(w0.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 0.0)\n+        assert_equal(w2.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 5.0)\n+\n+        # w1 should see +15 balance for both transactions\n+        assert_equal(w1.simulaterawtransaction([tx1, tx2])[\"balance_change\"], 15.0)\n+\n+        # w0 funds transaction; it should now see a decrease in (tx fee and payment), and w1 should see the same as above\n+        funding = w0.fundrawtransaction(tx1)\n+        tx1 = funding[\"hex\"]\n+        tx1changepos = funding[\"changepos\"]\n+        bitcoin_fee = Decimal(funding[\"fee\"])\n+\n+        # w0 sees fee + 5 btc decrease, w2 sees + 5 btc\n+        assert_approx(w0.simulaterawtransaction([tx1])[\"balance_change\"], -(Decimal(\"5\") + bitcoin_fee))\n+        assert_approx(w2.simulaterawtransaction([tx1])[\"balance_change\"], Decimal(\"5\"))\n+\n+        # w1 sees same as before\n+        assert_equal(w1.simulaterawtransaction([tx1])[\"balance_change\"], 5.0)\n+\n+        # same inputs (tx) more than once should error\n+        assert_raises_rpc_error(-8, \"Transaction(s) are spending the same output more than once\", w0.simulaterawtransaction, [tx1,tx1])\n+\n+        tx1ob = node.decoderawtransaction(tx1)\n+        tx1hex = tx1ob[\"txid\"]\n+        tx1vout = 1 - tx1changepos\n+        # tx3 spends new w1 UTXO paying to w0\n+        tx3 = node.createrawtransaction([{\"txid\": tx1hex, \"vout\": tx1vout}], {w0.getnewaddress(): 4.9999})\n+        # tx4 spends new w1 UTXO paying to w1\n+        tx4 = node.createrawtransaction([{\"txid\": tx1hex, \"vout\": tx1vout}], {w1.getnewaddress(): 4.9999})\n+\n+        # on their own, both should fail due to missing input(s)\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w0.simulaterawtransaction, [tx3])\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w1.simulaterawtransaction, [tx3])\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w0.simulaterawtransaction, [tx4])\n+        assert_raises_rpc_error(-8, \"One or more transaction inputs have been spent already\", w1.simulaterawtransaction, [tx4])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r935027517",
      "id" : 935027517,
      "in_reply_to_id" : 931526163,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843u2M9",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 95,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "test/functional/wallet_simulaterawtx.py",
      "position" : null,
      "pull_request_review_id" : 1058003714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935027517/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-02T01:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935027517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r935028496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935028496"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure",
      "commit_id" : "ced8a3e77d0dde428360f2250576582b624c013c",
      "created_at" : "2022-08-02T01:10:36Z",
      "diff_hunk" : "@@ -590,6 +590,120 @@ static RPCHelpMan upgradewallet()\n     };\n }\n \n+RPCHelpMan simulaterawtransaction()\n+{\n+    return RPCHelpMan{\"simulaterawtransaction\",\n+        \"\\nCalculate the balance change resulting in the signing and broadcasting of the given transaction(s).\\n\",\n+        {\n+            {\"rawtxs\", RPCArg::Type::ARR, RPCArg::Optional::OMITTED_NAMED_ARG, \"An array of hex strings of raw transactions.\\n\",\n+                {\n+                    {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n+                },\n+            },\n+            {\"options\", RPCArg::Type::OBJ_USER_KEYS, RPCArg::Optional::OMITTED_NAMED_ARG, \"Options\",\n+                {\n+                    {\"include_watchonly\", RPCArg::Type::BOOL, RPCArg::DefaultHint{\"true for watch-only wallets, otherwise false\"}, \"Whether to include watch-only addresses (see 'importaddress')\"},\n+                },\n+            },\n+        },\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR_AMOUNT, \"balance_change\", \"The wallet balance change (negative means decrease).\"},\n+            }\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+            + HelpExampleRpc(\"simulaterawtransaction\", \"[\\\"myhex\\\"]\")\n+        },\n+    [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<const CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    const CWallet* pwallet = wallet.get();\n+\n+    RPCTypeCheck(request.params, {UniValue::VARR, UniValue::VOBJ}, true);\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    UniValue include_watchonly(UniValue::VNULL);\n+    if (request.params[1].isObject()) {\n+        UniValue options = request.params[1];\n+        RPCTypeCheckObj(options,\n+            {\n+                {\"include_watchonly\", UniValueType(UniValue::VBOOL)},\n+            },\n+            true, true);\n+\n+        include_watchonly = options[\"include_watchonly\"];\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (ParseIncludeWatchonly(include_watchonly, *pwallet)) {\n+        filter |= ISMINE_WATCH_ONLY;\n+    }\n+\n+    const auto& txs = request.params[0].get_array();\n+    CAmount changes{0};\n+    std::map<COutPoint, CAmount> new_utxos; // UTXO:s that were made available in transaction array\n+    std::set<COutPoint> spent;\n+\n+    for (size_t i = 0; i < txs.size(); ++i) {\n+        CMutableTransaction mtx;\n+        if (!DecodeHexTx(mtx, txs[i].get_str(), /* try_no_witness */ true, /* try_witness */ true)) {\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Transaction hex string decoding failure.\");\n+        }\n+\n+        // Fetch previous transactions (inputs)\n+        std::map<COutPoint, Coin> coins;\n+        for (const CTxIn& txin : mtx.vin) {\n+            coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+        }\n+        pwallet->chain().findCoins(coins);\n+\n+        // Fetch debit; we are *spending* these; if the transaction is signed and\n+        // broadcast, we will lose everything in these\n+        for (const auto& txin : mtx.vin) {\n+            auto& op = txin.prevout;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#discussion_r935028496",
      "id" : 935028496,
      "in_reply_to_id" : 931527652,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843u2cQ",
      "original_commit_id" : "b557f53eac39b92bfc4922729e94087556de749a",
      "original_line" : 667,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1058004935,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22751",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935028496/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-02T01:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/935028496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK ced8a3e77d0dde428360f2250576582b624c013c",
      "created_at" : "2022-08-04T17:49:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22751#issuecomment-1205580966",
      "id" : 1205580966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22751",
      "node_id" : "IC_kwDOABII585H27Sm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1205580966/reactions"
      },
      "updated_at" : "2022-08-04T17:49:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1205580966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
