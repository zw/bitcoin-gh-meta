[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29614).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2024-03-10T18:04:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29614#issuecomment-1987312495",
      "id" : 1987312495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29614",
      "node_id" : "IC_kwDOABII5852c_tv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987312495/reactions"
      },
      "updated_at" : "2024-03-10T18:04:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987312495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29614#discussion_r1519566433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519566433"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It is better to check the return value of `fclose()`, otherwise an IO error may remain unnoticed and unreported, leading to silent data corruption.\r\n\r\nThe problem with calling `fclose()` from the destructor is that there is no way to signal a failure to the caller - the destructor does not return a value, does not take arguments and is not supposed to `throw` either.\r\n\r\n`fclose()` from a destructor is a design issue, better avoid that. https://github.com/bitcoin/bitcoin/pull/29307 is related.",
      "commit_id" : "0397ee12889c4b8149efb3e96106c18ce7793a6a",
      "created_at" : "2024-03-11T11:28:10Z",
      "diff_hunk" : "@@ -520,6 +520,10 @@ class BufferedFile\n             throw std::ios_base::failure(\"Rewind limit must be less than buffer size\");\n     }\n \n+    ~BufferedFile() { fclose(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29614#discussion_r1519566433",
      "id" : 1519566433,
      "line" : 523,
      "node_id" : "PRRC_kwDOABII585akr5h",
      "original_commit_id" : "0397ee12889c4b8149efb3e96106c18ce7793a6a",
      "original_line" : 523,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : 4,
      "pull_request_review_id" : 1927581356,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29614",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519566433/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T11:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519566433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This is currently indirectly implied by src/bench/load_external.cpp:LoadExternalBlockFile\r\n> `The file will be closed by LoadExternalBlockFile().`\r\n\r\nThis comment is wrong, no? If not, it would be good to point to the exact line in the source code that closes the file in `LoadExternalBlockFile`.\r\n\r\nIf you are trying to say that real code should be changed to accommodate a comment in a test, I am not sure, unless there is also a real reason for the change.",
      "created_at" : "2024-03-11T12:16:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29614#issuecomment-1988307213",
      "id" : 1988307213,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29614",
      "node_id" : "IC_kwDOABII5852gykN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988307213/reactions"
      },
      "updated_at" : "2024-03-11T12:16:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988307213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that there is a subtle error in `FUZZ_TARGET(buffered_file)`:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/4a903741b0bc128745b1096586329456d1f1c447/src/test/fuzz/buffered_file.cpp#L22-L23\r\n\r\nbecause at the end of the function `fuzzed_file` will be destroyed and then `opt_buffered_file` will reference a deleted object. \"Luckily\" `opt_buffered_file` is destroyed immediately afterwards without any operations being performed on it.\r\n\r\nI do not get the comment about `bench/load_external.cpp`",
      "created_at" : "2024-03-11T12:39:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29614#issuecomment-1988348276",
      "id" : 1988348276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29614",
      "node_id" : "IC_kwDOABII5852g8l0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988348276/reactions"
      },
      "updated_at" : "2024-03-11T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988348276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In any case, you are *adding* the bug here, not fixing it. See the CI, which is failing\r\n\r\n```\r\n    [4256, 4272) 'fuzzed_data_provider' (line 20)\r\n    [4288, 4304) 'fuzzed_file_provider' (line 21)\r\n    [4320, 4392) 'opt_buffered_file' (line 22)\r\n    [4432, 4464) 'fuzzed_file' (line 23) <== Memory access at offset 4432 is inside this variable\r\n    [4496, 4520) 'agg.tmp'\r\n    [4560, 4576) 'ref.tmp' (line 23)\r\nHINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork\r\n      (longjmp and C++ exceptions *are* supported)\r\nSUMMARY: AddressSanitizer: stack-use-after-scope src/./streams.h:417:24 in AutoFile::release()\r\nShadow bytes around the buggy address:\r\n  0x7fc119340e80: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8\r\n  0x7fc119340f00: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8\r\n  0x7fc119340f80: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8\r\n  0x7fc119341000: f8 f8 f8 f8 f2 f2 f2 f2 f2 f2 f2 f2 f2 f2 f2 f2\r\n  0x7fc119341080: f2 f2 f2 f2 00 00 f2 f2 00 00 f2 f2 00 00 00 00\r\n=>0x7fc119341100: 00 00 00 00 00 f2 f2 f2 f2 f2[f8]f8 f8 f8 f2 f2\r\n  0x7fc119341180: f2 f2 00 00 00 f2 f2 f2 f2 f2 f8 f8 f3 f3 f3 f3\r\n  0x7fc119341200: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n  0x7fc119341280: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n  0x7fc119341300: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n  0x7fc119341380: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07 \r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n==18245==ABORTING\r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n0x5c,0x25,0x94,0xff,0x7e,\r\n\\\\%\\224\\377~",
      "created_at" : "2024-03-11T16:40:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29614#issuecomment-1988902202",
      "id" : 1988902202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29614",
      "node_id" : "IC_kwDOABII5852jD06",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988902202/reactions"
      },
      "updated_at" : "2024-03-11T16:40:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988902202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29614#discussion_r1523407895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523407895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "BufferedFile is only used for reading, so I don't think fclose can fail in a meaningful way? #29307 also ignores the result...",
      "commit_id" : "0397ee12889c4b8149efb3e96106c18ce7793a6a",
      "created_at" : "2024-03-13T14:51:58Z",
      "diff_hunk" : "@@ -520,6 +520,10 @@ class BufferedFile\n             throw std::ios_base::failure(\"Rewind limit must be less than buffer size\");\n     }\n \n+    ~BufferedFile() { fclose(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29614#discussion_r1523407895",
      "id" : 1523407895,
      "in_reply_to_id" : 1519566433,
      "line" : 523,
      "node_id" : "PRRC_kwDOABII585azVwX",
      "original_commit_id" : "0397ee12889c4b8149efb3e96106c18ce7793a6a",
      "original_line" : 523,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : 4,
      "pull_request_review_id" : 1934405666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29614",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523407895/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T14:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523407895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">If you are trying to say that real code should be changed to accommodate a comment in a test, I am not sure, unless there is also a real reason for the change.\r\n\r\nIt seems like logically correct behaviour to expect.\r\n\r\n>In any case, you are adding the bug here, not fixing it. See the CI, which is failing\r\n\r\nYes, since the destructor calls fclose unconditionally, the AutoFile is still gone even though we fclose'd manually already. Fixed by resetting the std::optional too.",
      "created_at" : "2024-03-13T15:06:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29614#issuecomment-1994617543",
      "id" : 1994617543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29614",
      "node_id" : "IC_kwDOABII585243LH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994617543/reactions"
      },
      "updated_at" : "2024-03-13T15:06:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994617543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
