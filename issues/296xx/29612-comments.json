[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29612).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1991022291), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/29612#pullrequestreview-1933303632) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint by maflcko)\n* [#29617](https://github.com/bitcoin/bitcoin/pull/29617) (test: Add test for invalid UTXO snapshot with coin height above base height by jrakibi)\n* [#29478](https://github.com/bitcoin/bitcoin/pull/29478) (test: Test new header sync behavior in loadtxoutset by fjahr)\n* [#29307](https://github.com/bitcoin/bitcoin/pull/29307) (util: check for errors after close and read in AutoFile by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-03-10T16:31:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1987287180",
      "id" : 1987287180,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29612",
      "node_id" : "IC_kwDOABII5852c5iM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987287180/reactions"
      },
      "updated_at" : "2024-03-13T08:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987287180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "è¿æ¯æ¥èªQQé®ç®±çåæèªå¨åå¤é®ä»¶ã\nÂ \næ¨å¥½ï¼ææè¿æ­£å¨ä¼åä¸­ï¼æ æ³äº²èªåå¤æ¨çé®ä»¶ãæå°å¨åæç»æåï¼å°½å¿«ç»æ¨åå¤ã",
      "created_at" : "2024-03-10T16:37:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1987288775",
      "id" : 1987288775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29612",
      "node_id" : "IC_kwDOABII5852c57H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987288775/reactions"
      },
      "updated_at" : "2024-03-10T16:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987288775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/88719774?v=4",
         "events_url" : "https://api.github.com/users/Ferrydh/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Ferrydh/followers",
         "following_url" : "https://api.github.com/users/Ferrydh/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Ferrydh/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Ferrydh",
         "id" : 88719774,
         "login" : "Ferrydh",
         "node_id" : "MDQ6VXNlcjg4NzE5Nzc0",
         "organizations_url" : "https://api.github.com/users/Ferrydh/orgs",
         "received_events_url" : "https://api.github.com/users/Ferrydh/received_events",
         "repos_url" : "https://api.github.com/users/Ferrydh/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Ferrydh/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Ferrydh/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Ferrydh"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/22485931752</sub>",
      "created_at" : "2024-03-10T17:25:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1987301899",
      "id" : 1987301899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29612",
      "node_id" : "IC_kwDOABII5852c9IL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987301899/reactions"
      },
      "updated_at" : "2024-03-10T17:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987301899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> ææè¿æ­£å¨ä¼åä¸­\r\n\r\nWell, I'm not on holiday :-)\r\n\r\ntACK b0cfbce17a84158973ebba16f9801bd57cb70fe6\r\n\r\nI do suggest adding a comment to `PopulateAndValidateSnapshot` in `validation.h`:\r\n\r\n> To reduce space, this function takes advantage of the guarantee by leveldb that keys are lexicographically sorted.\r\n\r\nI generated a snapshot and loaded it using the patch in #29551 (only waited for it to reach the tip, not a full background sync).\r\n\r\nFor those testing who don't want to wait out the long flush, see #28358.",
      "created_at" : "2024-03-11T11:21:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1988209242",
      "id" : 1988209242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29612",
      "node_id" : "IC_kwDOABII5852gapa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988209242/reactions"
      },
      "updated_at" : "2024-03-11T11:21:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988209242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review and testing!\r\n\r\n> I do suggest adding a comment to `PopulateAndValidateSnapshot` in `validation.h`:\r\n> \r\n> > To reduce space, this function takes advantage of the guarantee by leveldb that keys are lexicographically sorted.\r\n\r\nAs it is worded, wouldn't this be more appropriate to add in `CreateUTXOSnapshot`? That's where we are iterating with the pcursor, leveraging the sorting, and writing the coins to file, so I would say that's also where the space savings are realized. \r\n\r\nI have now amended the comment a bit and added a version of it to both `CreateUTXOSnapshot` and `PopulateAndValidateSnapshot`. Please let me know if you think this is alright: https://github.com/bitcoin/bitcoin/commit/923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-11T21:00:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1989436033",
      "id" : 1989436033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29612",
      "node_id" : "IC_kwDOABII5852lGKB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989436033/reactions"
      },
      "updated_at" : "2024-03-11T21:04:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989436033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 923ec9043af668f3a342422d32c1c28d29018ed0\r\n\r\nThat looks good.\r\n\r\nThe reason I suggested (also) writing something in the header is because it's more likely to be noticed by some future dev looking through existing leveldb uses, seeing if they can replace it.",
      "created_at" : "2024-03-12T08:24:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1991022291",
      "id" : 1991022291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29612",
      "node_id" : "IC_kwDOABII5852rJbT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991022291/reactions"
      },
      "updated_at" : "2024-03-12T08:24:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991022291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522639723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522639723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: s/dublication/duplication/ (same in validation.h)",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T07:08:06Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids\n+    // dublication of tx hashes. The code takes advantage of the guarantee by",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522639723",
      "id" : 1522639723,
      "line" : 2681,
      "node_id" : "PRRC_kwDOABII585awaNr",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2681,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 20,
      "pull_request_review_id" : 1933303632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522639723/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T07:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522639723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522640424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522640424"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: s/lamda/lambda/",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T07:08:42Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids\n+    // dublication of tx hashes. The code takes advantage of the guarantee by\n+    // leveldb that keys are lexicographically sorted.\n+    // In the coins vector we collect all coins that belong to a certain tx hash\n+    // (key.hash) and when we have them all (key.hash != last_hash) we write\n+    // them to file using the below lamda function.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522640424",
      "id" : 1522640424,
      "line" : 2685,
      "node_id" : "PRRC_kwDOABII585awaYo",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2685,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 24,
      "pull_request_review_id" : 1933303632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522640424/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T07:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522640424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522668381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522668381"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Might it be useful to add a small diagram of the format to the `dumptxoutset` help output?",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T07:31:54Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522668381",
      "id" : 1522668381,
      "line" : 2680,
      "node_id" : "PRRC_kwDOABII585awhNd",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2680,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 19,
      "pull_request_review_id" : 1933303632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522668381/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T07:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522668381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522686216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522686216"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: I'm a bit confused about this sentence. Is this supposed to be `resulting in an error`?",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T07:46:53Z",
      "diff_hunk" : "@@ -98,12 +98,16 @@ def expected_error(log_msg=\"\", rpc_details=\"\"):\n                 f.write(valid_snapshot_contents[32 + 8:])\n             expected_error(log_msg=f\"bad snapshot - coins left over after deserializing 298 coins\" if off == -1 else f\"bad snapshot format or truncated snapshot after deserializing 299 coins\")\n \n-        self.log.info(\"  - snapshot file with alternated UTXO data\")\n+\n+        self.log.info(\"  - snapshot file with alternated but parsable UTXO data results in different hash\")\n         cases = [\n             [b\"\\xff\" * 32, 0, \"7d52155c9a9fdc4525b637ef6170568e5dad6fabd0b1fdbb9432010b8453095b\"],  # wrong outpoint hash\n-            [(1).to_bytes(4, \"little\"), 32, \"9f4d897031ab8547665b4153317ae2fdbf0130c7840b66427ebc48b881cb80ad\"],  # wrong outpoint index\n-            [b\"\\x81\", 36, \"3da966ba9826fb6d2604260e01607b55ba44e1a5de298606b08704bc62570ea8\"],  # wrong coin code VARINT((coinbase ? 1 : 0) | (height << 1))\n-            [b\"\\x80\", 36, \"091e893b3ccb4334378709578025356c8bcb0a623f37c7c4e493133c988648e5\"],  # another wrong coin code\n+            # The coin size byte is skipped here and its manipulation is tested\n+            # below because this will always cause parsing to fail, resulting in\n+            # and error that is not a mismatch of the expected hash.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1522686216",
      "id" : 1522686216,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585awlkI",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 107,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/feature_assumeutxo.py",
      "position" : 14,
      "pull_request_review_id" : 1933303632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522686216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T07:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522686216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523212386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523212386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yepp, `in an error` would be right",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T12:57:07Z",
      "diff_hunk" : "@@ -98,12 +98,16 @@ def expected_error(log_msg=\"\", rpc_details=\"\"):\n                 f.write(valid_snapshot_contents[32 + 8:])\n             expected_error(log_msg=f\"bad snapshot - coins left over after deserializing 298 coins\" if off == -1 else f\"bad snapshot format or truncated snapshot after deserializing 299 coins\")\n \n-        self.log.info(\"  - snapshot file with alternated UTXO data\")\n+\n+        self.log.info(\"  - snapshot file with alternated but parsable UTXO data results in different hash\")\n         cases = [\n             [b\"\\xff\" * 32, 0, \"7d52155c9a9fdc4525b637ef6170568e5dad6fabd0b1fdbb9432010b8453095b\"],  # wrong outpoint hash\n-            [(1).to_bytes(4, \"little\"), 32, \"9f4d897031ab8547665b4153317ae2fdbf0130c7840b66427ebc48b881cb80ad\"],  # wrong outpoint index\n-            [b\"\\x81\", 36, \"3da966ba9826fb6d2604260e01607b55ba44e1a5de298606b08704bc62570ea8\"],  # wrong coin code VARINT((coinbase ? 1 : 0) | (height << 1))\n-            [b\"\\x80\", 36, \"091e893b3ccb4334378709578025356c8bcb0a623f37c7c4e493133c988648e5\"],  # another wrong coin code\n+            # The coin size byte is skipped here and its manipulation is tested\n+            # below because this will always cause parsing to fail, resulting in\n+            # and error that is not a mismatch of the expected hash.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523212386",
      "id" : 1523212386,
      "in_reply_to_id" : 1522686216,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585aymBi",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 107,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/feature_assumeutxo.py",
      "position" : 14,
      "pull_request_review_id" : 1934110716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523212386/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T12:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523212386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523213780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523213780"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do you think it is clear otherwise?",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T12:58:06Z",
      "diff_hunk" : "@@ -98,12 +98,16 @@ def expected_error(log_msg=\"\", rpc_details=\"\"):\n                 f.write(valid_snapshot_contents[32 + 8:])\n             expected_error(log_msg=f\"bad snapshot - coins left over after deserializing 298 coins\" if off == -1 else f\"bad snapshot format or truncated snapshot after deserializing 299 coins\")\n \n-        self.log.info(\"  - snapshot file with alternated UTXO data\")\n+\n+        self.log.info(\"  - snapshot file with alternated but parsable UTXO data results in different hash\")\n         cases = [\n             [b\"\\xff\" * 32, 0, \"7d52155c9a9fdc4525b637ef6170568e5dad6fabd0b1fdbb9432010b8453095b\"],  # wrong outpoint hash\n-            [(1).to_bytes(4, \"little\"), 32, \"9f4d897031ab8547665b4153317ae2fdbf0130c7840b66427ebc48b881cb80ad\"],  # wrong outpoint index\n-            [b\"\\x81\", 36, \"3da966ba9826fb6d2604260e01607b55ba44e1a5de298606b08704bc62570ea8\"],  # wrong coin code VARINT((coinbase ? 1 : 0) | (height << 1))\n-            [b\"\\x80\", 36, \"091e893b3ccb4334378709578025356c8bcb0a623f37c7c4e493133c988648e5\"],  # another wrong coin code\n+            # The coin size byte is skipped here and its manipulation is tested\n+            # below because this will always cause parsing to fail, resulting in\n+            # and error that is not a mismatch of the expected hash.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523213780",
      "id" : 1523213780,
      "in_reply_to_id" : 1522686216,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585aymXU",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 107,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/feature_assumeutxo.py",
      "position" : 14,
      "pull_request_review_id" : 1934112786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523213780/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T12:58:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523213780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523214777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523214777"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That is my favorite typo, can't get enough of it ;D",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T12:58:44Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids\n+    // dublication of tx hashes. The code takes advantage of the guarantee by",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523214777",
      "id" : 1523214777,
      "in_reply_to_id" : 1522639723,
      "line" : 2681,
      "node_id" : "PRRC_kwDOABII585aymm5",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2681,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 20,
      "pull_request_review_id" : 1934114212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523214777/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T12:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523214777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523218768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523218768"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sounds good, will think about what that could look like if I have to retouch or in the follow-up.",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T13:01:14Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523218768",
      "id" : 1523218768,
      "in_reply_to_id" : 1522668381,
      "line" : 2680,
      "node_id" : "PRRC_kwDOABII585aynlQ",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2680,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 19,
      "pull_request_review_id" : 1934120132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523218768/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T13:01:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523218768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523235029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523235029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could be a bit clearer I guess, but I don't have a suggestion :P.",
      "commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "created_at" : "2024-03-13T13:11:39Z",
      "diff_hunk" : "@@ -98,12 +98,16 @@ def expected_error(log_msg=\"\", rpc_details=\"\"):\n                 f.write(valid_snapshot_contents[32 + 8:])\n             expected_error(log_msg=f\"bad snapshot - coins left over after deserializing 298 coins\" if off == -1 else f\"bad snapshot format or truncated snapshot after deserializing 299 coins\")\n \n-        self.log.info(\"  - snapshot file with alternated UTXO data\")\n+\n+        self.log.info(\"  - snapshot file with alternated but parsable UTXO data results in different hash\")\n         cases = [\n             [b\"\\xff\" * 32, 0, \"7d52155c9a9fdc4525b637ef6170568e5dad6fabd0b1fdbb9432010b8453095b\"],  # wrong outpoint hash\n-            [(1).to_bytes(4, \"little\"), 32, \"9f4d897031ab8547665b4153317ae2fdbf0130c7840b66427ebc48b881cb80ad\"],  # wrong outpoint index\n-            [b\"\\x81\", 36, \"3da966ba9826fb6d2604260e01607b55ba44e1a5de298606b08704bc62570ea8\"],  # wrong coin code VARINT((coinbase ? 1 : 0) | (height << 1))\n-            [b\"\\x80\", 36, \"091e893b3ccb4334378709578025356c8bcb0a623f37c7c4e493133c988648e5\"],  # another wrong coin code\n+            # The coin size byte is skipped here and its manipulation is tested\n+            # below because this will always cause parsing to fail, resulting in\n+            # and error that is not a mismatch of the expected hash.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1523235029",
      "id" : 1523235029,
      "in_reply_to_id" : 1522686216,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585ayrjV",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 107,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/feature_assumeutxo.py",
      "position" : 14,
      "pull_request_review_id" : 1934144374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523235029/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T13:11:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523235029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-13T17:50:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#issuecomment-1995166263",
      "id" : 1995166263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29612",
      "node_id" : "IC_kwDOABII585269I3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1995166263/reactions"
      },
      "updated_at" : "2024-03-13T17:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1995166263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646529"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646529"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I spent some time thinking about a diagram that would work but I wasn't very happy what I could come up with. I instead copied the expression used in the issue. It shows the format in a concise way that I find understandable: `list(Txid, list((vout,Coin))`. Let me know what you think.",
      "commit_id" : "71d41d536bc2f47a014c898891d77d58502c9554",
      "created_at" : "2024-03-14T10:58:46Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646529",
      "id" : 1524646529,
      "in_reply_to_id" : 1522668381,
      "line" : 2704,
      "node_id" : "PRRC_kwDOABII585a4EKB",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2704,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 19,
      "pull_request_review_id" : 1936340686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646529/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-14T10:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646529",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646629"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "71d41d536bc2f47a014c898891d77d58502c9554",
      "created_at" : "2024-03-14T10:58:51Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids\n+    // dublication of tx hashes. The code takes advantage of the guarantee by\n+    // leveldb that keys are lexicographically sorted.\n+    // In the coins vector we collect all coins that belong to a certain tx hash\n+    // (key.hash) and when we have them all (key.hash != last_hash) we write\n+    // them to file using the below lamda function.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646629",
      "id" : 1524646629,
      "in_reply_to_id" : 1522640424,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585a4ELl",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2709,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1936340970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646629/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-14T10:58:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646720"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "71d41d536bc2f47a014c898891d77d58502c9554",
      "created_at" : "2024-03-14T10:58:55Z",
      "diff_hunk" : "@@ -2669,21 +2670,49 @@ UniValue CreateUTXOSnapshot(\n \n     afile << metadata;\n \n+    std::map<uint256, std::vector<std::pair<uint32_t, Coin>>> mapCoins;\n     COutPoint key;\n+    uint256 last_hash;\n     Coin coin;\n     unsigned int iter{0};\n+    std::vector<std::pair<uint32_t, Coin>> coins;\n+\n+    // To reduce space the serialization format of the snapshot avoids\n+    // dublication of tx hashes. The code takes advantage of the guarantee by",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646720",
      "id" : 1524646720,
      "in_reply_to_id" : 1522639723,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585a4ENA",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 2705,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1936341199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646720/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-14T10:58:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646866"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed and tried a different wording to make it more clear",
      "commit_id" : "71d41d536bc2f47a014c898891d77d58502c9554",
      "created_at" : "2024-03-14T10:59:03Z",
      "diff_hunk" : "@@ -98,12 +98,16 @@ def expected_error(log_msg=\"\", rpc_details=\"\"):\n                 f.write(valid_snapshot_contents[32 + 8:])\n             expected_error(log_msg=f\"bad snapshot - coins left over after deserializing 298 coins\" if off == -1 else f\"bad snapshot format or truncated snapshot after deserializing 299 coins\")\n \n-        self.log.info(\"  - snapshot file with alternated UTXO data\")\n+\n+        self.log.info(\"  - snapshot file with alternated but parsable UTXO data results in different hash\")\n         cases = [\n             [b\"\\xff\" * 32, 0, \"7d52155c9a9fdc4525b637ef6170568e5dad6fabd0b1fdbb9432010b8453095b\"],  # wrong outpoint hash\n-            [(1).to_bytes(4, \"little\"), 32, \"9f4d897031ab8547665b4153317ae2fdbf0130c7840b66427ebc48b881cb80ad\"],  # wrong outpoint index\n-            [b\"\\x81\", 36, \"3da966ba9826fb6d2604260e01607b55ba44e1a5de298606b08704bc62570ea8\"],  # wrong coin code VARINT((coinbase ? 1 : 0) | (height << 1))\n-            [b\"\\x80\", 36, \"091e893b3ccb4334378709578025356c8bcb0a623f37c7c4e493133c988648e5\"],  # another wrong coin code\n+            # The coin size byte is skipped here and its manipulation is tested\n+            # below because this will always cause parsing to fail, resulting in\n+            # and error that is not a mismatch of the expected hash.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29612#discussion_r1524646866",
      "id" : 1524646866,
      "in_reply_to_id" : 1522686216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585a4EPS",
      "original_commit_id" : "923ec9043af668f3a342422d32c1c28d29018ed0",
      "original_line" : 107,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/feature_assumeutxo.py",
      "position" : null,
      "pull_request_review_id" : 1936341500,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29612",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646866/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-14T10:59:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1524646866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   }
]
