[
   {
      "body" : "Maybe I should have just put #4393 into this one... \r\nEdit: or even inside the \"Decouple UpdateTime from pow\" commit.",
      "created_at" : "2014-06-25T10:10:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-47082933",
      "id" : 47082933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-06-25T10:17:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47082933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@drak As it changes how verifying POW works, this looks kind of risky and needs extensive testing and review. It's not an easy merge like the code move.\r\n",
      "created_at" : "2014-06-25T10:21:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-47083852",
      "id" : 47083852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-06-25T10:21:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47083852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I think both commits are straight-forward to merge, specially the first one.\r\nFor the second one you may need to grep UpdateTime and see that nBits are always set after it's called to believe it.\r\nOn the other hand #4393 seems more risky, so any advice for modifying or writing new tests you think are useful for this, I guess in miner_test.cpp.\r\n",
      "created_at" : "2014-06-25T10:36:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-47085053",
      "id" : 47085053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-06-25T10:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47085053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "I've closed #4393 with @jgarzik 's input and turned it into a simpler commit 24410f9 here.\r\nI'm having second thoughts about UpdateTime again so I won't include that commit for now.",
      "created_at" : "2014-06-26T15:26:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-47240232",
      "id" : 47240232,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-06-26T15:26:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47240232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "I'm including more commits. All commits are refactors that don't change functionality but if there's some of them that are more controversial I can separate them in different PRs.",
      "created_at" : "2014-07-07T08:26:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-48152254",
      "id" : 48152254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-07T08:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/48152254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Also, to understand the motivation of this PR you may want to take a look to this unfinished branch that completely encapsulates the Proof of Work, making it easier to experiment with other Proofs:\r\n\r\nhttps://github.com/jtimon/bitcoin/tree/proof\r\n\r\nProbably Params().AllowMinDifficultyBlocks() can be removed with an specialized Proof. Well, not probably, for sure, what remains to be seen if it that will simplify the code or not.",
      "created_at" : "2014-07-07T08:42:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-48153548",
      "id" : 48153548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-07T08:43:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/48153548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Agree on overall changes, haven't checked the code moves or tested yet.\r\n",
      "created_at" : "2014-07-07T08:48:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-48154039",
      "id" : 48154039,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-07T08:48:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/48154039",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Ping @sipa - This looks good to me, was wondering around this part of code and now happy to find this PR. It is not invasive and makes the whole POW more readable and maintainable.\r\n\r\nBut I advise against going forward into #4506 mainly because class polymorphism will affect runtime performance signicantly and can introduce problems using templates.\r\n\r\n#4508 looks like a very good move to follow up with this.",
      "created_at" : "2014-07-11T12:40:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-48725329",
      "id" : 48725329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-11T12:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/48725329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/148059?v=3",
         "events_url" : "https://api.github.com/users/jaromil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jaromil/followers",
         "following_url" : "https://api.github.com/users/jaromil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jaromil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jaromil",
         "id" : 148059,
         "login" : "jaromil",
         "organizations_url" : "https://api.github.com/users/jaromil/orgs",
         "received_events_url" : "https://api.github.com/users/jaromil/received_events",
         "repos_url" : "https://api.github.com/users/jaromil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jaromil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jaromil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jaromil"
      }
   },
   {
      "body" : "I simplified the last two commits and unified them into one after completing #4506 ",
      "created_at" : "2014-07-16T19:19:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-49213489",
      "id" : 49213489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-16T19:19:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49213489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4377#discussion_r15066629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/15066629"
         }
      },
      "body" : "That's a confusing name. How about GetProofIncrement()?",
      "commit_id" : "654871d43677947d124673c9e0dd2984f0d3ca61",
      "created_at" : "2014-07-17T16:05:43Z",
      "diff_hunk" : "@@ -13,11 +13,17 @@ class CBlockIndex;\n class CBlockHeader;\n class uint256;\n \n-unsigned int GetNextWorkRequired(const CBlockIndex* pindexLast, const CBlockHeader *pblock);\n-\n /** Check whether a block hash satisfies the proof-of-work requirement specified by nBits */\n bool CheckProofOfWork(uint256 hash, unsigned int nBits);\n-/** Calculate the minimum amount of work a received block needs, without knowing its direct parent */\n-unsigned int ComputeMinWork(unsigned int nBase, int64_t nTime);\n+/** Check the work is more than the minimum a received block needs, without knowing its direct parent */\n+bool CheckMinWork(unsigned int nBits, unsigned int nBase, int64_t deltaTime);\n+\n+bool CheckMinProof(const CBlockHeader* pblock, const CBlockIndex* pcheckpoint);\n+bool CheckProofRequired(const CBlockHeader* pblock, const CBlockIndex* pindexPrev);\n+bool GenerateProof(CBlockHeader* pblock, const CBlockIndex* pindexPrev);\n+void UpdateTime(CBlockHeader* pblock, const CBlockIndex* pindexPrev);\n+void ResetProof(CBlockHeader* pblock, const CBlockIndex* pindexPrev);\n+\n+uint256 GetLengthIncrement(unsigned int nBits);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#discussion_r15066629",
      "id" : 15066629,
      "original_commit_id" : "75ee124c99c114e3ba1d45e89ea85365fcf3dbd0",
      "original_position" : 19,
      "path" : "src/pow.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4377",
      "updated_at" : "2014-08-23T11:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/15066629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Changed GetLengthIncrement to GetProofIncrement as suggested by @sipa   ",
      "created_at" : "2014-07-17T19:56:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-49356342",
      "id" : 49356342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-17T19:56:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49356342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Tested ACK",
      "created_at" : "2014-07-20T05:52:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-49537995",
      "id" : 49537995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-20T05:52:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49537995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I'm not entirely happy that part of the internal miner is moved to pow.cpp (the ugly loop GenerateProof , as well as global variable dHashesPerSec and nHPSTimerStart). Most of this clearly belongs in miner.cpp. \r\n\r\nI understand why, but I would prefer if pow.cpp only contained the consensus-critical code that verifies proof of work.\r\n\r\nI'd suggest to keep the outer loop in miner.cpp but move an inner pow-dependent part (ScanHash) to pow.cpp.\r\n",
      "created_at" : "2014-07-28T10:29:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-50322774",
      "id" : 50322774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-28T10:29:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/50322774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I'm not entirely happy with the GenerateProof function either. My initial approach was to simply remove the optimizations, but #4423 was rejected. Maybe we could just remove the hashrate counter to simplify things...\r\nI'll explore your proposal in more detail. Perhaps I could leave the \"Encapsulate proof of work generation in pow\" commit (and the previous one) for #4506 so that this can be merged faster, given that it seems the most controversial change.",
      "created_at" : "2014-07-28T13:08:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-50335369",
      "id" : 50335369,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-28T13:08:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/50335369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Thank you for the feedback. I thought it was good to rebase on top of the latest head often, but yes, that kind of invalidates earlier testing.\r\nI'll update this PR with the most basic commits that have been here for longer and leave the rest for later PRs. And I won't rebase it until it is required.",
      "created_at" : "2014-07-28T14:01:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-50341753",
      "id" : 50341753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-28T14:01:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/50341753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Added the additional conversion to CheckMinWork as suggested by @laanwj \r\nJust kept the more tested and/or less controversial commits.",
      "created_at" : "2014-07-28T14:38:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-50346905",
      "id" : 50346905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-07-28T14:38:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/50346905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Ping.\r\nAs far as I know I solved all the issues raised on the 3 commits that remain in the PR, right?\r\nIf there's anything I missed, please, tell me.",
      "created_at" : "2014-08-11T02:28:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-51736750",
      "id" : 51736750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-11T02:28:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51736750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Tested ACK",
      "created_at" : "2014-08-11T07:08:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-51748066",
      "id" : 51748066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-11T07:08:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51748066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4377#discussion_r16630136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16630136"
         }
      },
      "body" : "Deleting this conversion won't hurt. GetCompact + SetCompact will only round the (absolute value of a) uint256 down, so the check becomes stricter. As it's only a heuristic, loosening it is never a problem. Given that all it does is divide by a power of 4, I expect it to be no-op apart from the last 2 bits anyway.\r\n\r\nIn short: the test is probably immeasurably stronger by having the conversion.",
      "commit_id" : "654871d43677947d124673c9e0dd2984f0d3ca61",
      "created_at" : "2014-08-23T11:02:32Z",
      "diff_hunk" : "@@ -93,27 +94,60 @@ bool CheckProofOfWork(uint256 hash, unsigned int nBits)\n }\n \n //\n-// minimum amount of work that could possibly be required nTime after\n-// minimum work required was nBase\n+// true if nBits is greater than the minimum amount of work that could\n+// possibly be required deltaTime after minimum work required was nBase\n //\n-unsigned int ComputeMinWork(unsigned int nBase, int64_t nTime)\n+bool CheckMinWork(unsigned int nBits, unsigned int nBase, int64_t deltaTime)\n {\n+    bool fOverflow = false;\n+    uint256 bnNewBlock;\n+    bnNewBlock.SetCompact(nBits, NULL, &fOverflow);\n+    if (fOverflow)\n+        return false;\n+\n     const uint256 &bnLimit = Params().ProofOfWorkLimit();\n     // Testnet has min-difficulty blocks\n     // after Params().TargetSpacing()*2 time between blocks:\n-    if (Params().AllowMinDifficultyBlocks() && nTime > Params().TargetSpacing()*2)\n-        return bnLimit.GetCompact();\n+    if (Params().AllowMinDifficultyBlocks() && deltaTime > Params().TargetSpacing()*2)\n+        return bnNewBlock <= bnLimit;\n \n     uint256 bnResult;\n     bnResult.SetCompact(nBase);\n-    while (nTime > 0 && bnResult < bnLimit)\n+    while (deltaTime > 0 && bnResult < bnLimit)\n     {\n         // Maximum 400% adjustment...\n         bnResult *= 4;\n         // ... in best-case exactly 4-times-normal target time\n-        nTime -= Params().TargetTimespan()*4;\n+        deltaTime -= Params().TargetTimespan()*4;\n     }\n     if (bnResult > bnLimit)\n         bnResult = bnLimit;\n-    return bnResult.GetCompact();\n+\n+    // TODO make sure this additional conversion is necessary before deleting it.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#discussion_r16630136",
      "id" : 16630136,
      "original_commit_id" : "9c00990b3c7eb49511a2ae135afeb5fb192ca214",
      "original_position" : 49,
      "path" : "src/pow.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4377",
      "updated_at" : "2014-08-23T11:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16630136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I don't like keeping TODO's like the one you mentioned in master code. A comment about why it's there (if you don't delete it) or where it used to be (if you do) is fine of course.\r\n\r\nI'd keep the conversion.",
      "created_at" : "2014-08-23T11:07:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-53149875",
      "id" : 53149875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-23T11:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53149875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Mildly-tested ACK.",
      "created_at" : "2014-08-23T11:09:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-53149923",
      "id" : 53149923,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-23T11:09:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53149923",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Additional conversion and TODO removed.",
      "created_at" : "2014-08-23T11:24:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-53150184",
      "id" : 53150184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-23T11:24:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53150184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4377_654871d43677947d124673c9e0dd2984f0d3ca61/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-08-23T11:38:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-53150450",
      "id" : 53150450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-23T11:38:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53150450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "Sorry, in the comment to the commit you said it would be safe to remove the redundant conversion but later you say you would keep the conversion. I missed that and I removed it again.\r\nSo I'm confused, should I remove the conversion or only the TODO?",
      "created_at" : "2014-08-24T11:46:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-53189581",
      "id" : 53189581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-24T11:46:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53189581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon It's fine.\r\n\r\nBoth are safe; the extra conversion makes the test up to 0.000036% stronger (3 / 2^23). Then again, it's easy to do too.",
      "created_at" : "2014-08-27T20:02:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-53631951",
      "id" : 53631951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-27T20:02:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53631951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "ACK\r\n",
      "created_at" : "2014-08-27T20:16:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4377#issuecomment-53633942",
      "id" : 53633942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4377",
      "updated_at" : "2014-08-27T20:16:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53633942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   }
]
