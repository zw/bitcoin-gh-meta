[
   {
      "body" : "So, in some cases it makes sense from an efficiency point of view to\nbroadcast transactions (or blocks!) directly without advertising them\nfirst, if you *know* the peer does not have them yet. If you just created\nthe transaction yourself or mined the block yourself, this is an obvious\ntruth.\n\nSo, alternative proposal: trigger DoS scoring when receiving an\nunadvertized tx/block that you do already have.\n\nPros:\n* Optimizes propagation latency slightly.\n* Is conpatible with all existing behavior in clients afaik.\n\nCons:\n* More complex network rule.\n* Assumes that every peer (or at least every NODE_NETWORK peer) will be\ninterested in the actual tx/block (which is currently likely the case, but\nwe don't know the future variety of network nodes).",
      "created_at" : "2014-06-18T14:19:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4338#issuecomment-46441379",
      "id" : 46441379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4338",
      "updated_at" : "2014-06-18T14:19:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46441379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "If we accept your premise that there are DoS attacks here...\r\n... then I don't see how forcing attackers to jump through one extra hoop (send an 'inv' first) fixes them.\r\n\r\nAttackers will just send 'inv' messages first.\r\n",
      "created_at" : "2014-06-18T14:20:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4338#issuecomment-46441441",
      "id" : 46441441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4338",
      "updated_at" : "2014-06-18T14:20:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46441441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Gavin: the idea is not to just require them to just send an inv first. The\nidea is to only allow an incoming tx message when it was getdata'd before.\nIf an attack sends an inv for something we already have, we never getdata.",
      "created_at" : "2014-06-18T14:25:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4338#issuecomment-46442102",
      "id" : 46442102,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4338",
      "updated_at" : "2014-06-18T14:25:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46442102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "There are several cases where the receiver of an inv message might not actual want the data.\r\nHere are two cases:\r\n\r\n* The data has already been requested from another peer and it's currently in-flight.  There is no need to process the same data again, so it's possible to ignore the inv message, or add it to a list of peers known to have the data so it can be requested from them should the in-flight request fail.\r\n* The data is already available in a local cache or in the local db.\r\n\r\nBy giving nodes the chance to choose whether or not to send a getdata through first sending it an inv, the decision is left up to the receiver whether or not it needs the data.",
      "created_at" : "2014-06-18T14:28:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4338#issuecomment-46442557",
      "id" : 46442557,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4338",
      "updated_at" : "2014-06-18T14:29:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46442557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2115102?v=3",
         "events_url" : "https://api.github.com/users/davecgh/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davecgh/followers",
         "following_url" : "https://api.github.com/users/davecgh/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davecgh/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davecgh",
         "id" : 2115102,
         "login" : "davecgh",
         "organizations_url" : "https://api.github.com/users/davecgh/orgs",
         "received_events_url" : "https://api.github.com/users/davecgh/received_events",
         "repos_url" : "https://api.github.com/users/davecgh/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davecgh/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davecgh/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davecgh"
      }
   },
   {
      "body" : "My point is that this will not fix any of the DoS attacks that hypothesized, because attackers will never send something you already have.\r\n\r\nIf the DoS attack is incoming bandwidth:  attacker can just send an endless stream of orphan-and-will-never-have-inputs-satisfied transactions.\r\n\r\nIf the DoS attack is disk or memory thrashing looking up transaction previous inputs: same.\r\n\r\nIf the proposal really isn't about DoS attacks but is about optimizing the networking p2p protocol, then okey dokey; I'll let networking protocol experts argue over what the Most Optimal Behavior is.",
      "created_at" : "2014-06-18T15:40:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4338#issuecomment-46452937",
      "id" : 46452937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4338",
      "updated_at" : "2014-06-18T15:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46452937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "On a somewhat related note, I'm seeing many peers sending  many block invs (not just the latest block) without any getblocks having been sent first. This was contributing to the very high orphan block count that some people were seeing. My pull request #4431 makes it so that blocks aren't requested from any node other than the syncnode (which is also changed after every 500 blocks, or sooner).",
      "created_at" : "2014-06-27T13:27:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4338#issuecomment-47342886",
      "id" : 47342886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4338",
      "updated_at" : "2014-06-27T13:27:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47342886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
