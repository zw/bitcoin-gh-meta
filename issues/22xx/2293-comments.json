[
   {
      "body" : "Did you copy the files while the application was running?",
      "created_at" : "2013-02-10T17:55:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-13357560",
      "id" : 13357560,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2013-02-10T17:55:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/13357560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "No, I shut it down and it was running with --detach-db=1 (if that matters)\r\nAlso: I tried this twice.",
      "created_at" : "2013-02-10T17:59:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-13357633",
      "id" : 13357633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2013-02-10T17:59:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/13357633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2395990?v=3",
         "events_url" : "https://api.github.com/users/Belkaar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Belkaar/followers",
         "following_url" : "https://api.github.com/users/Belkaar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Belkaar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Belkaar",
         "id" : 2395990,
         "login" : "Belkaar",
         "organizations_url" : "https://api.github.com/users/Belkaar/orgs",
         "received_events_url" : "https://api.github.com/users/Belkaar/received_events",
         "repos_url" : "https://api.github.com/users/Belkaar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Belkaar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Belkaar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Belkaar"
      }
   },
   {
      "body" : "Ok, interesting. Can you try:\r\n* If you're able to compile on/for the RPi, can you try running the unit tests on it? (cd src; make -f makefile.unix test_bitcoin && ./test_bitcoin). \r\n* Are you able to sync (even if it's very slow) on the RPi directly?\r\n* Can you copy the files from an RPi to a desktop system, and continue the sync?",
      "created_at" : "2013-02-10T18:06:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-13357750",
      "id" : 13357750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2013-02-10T18:06:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/13357750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "1) Will do\r\n2) It syncs and runs fine on the rpi and on the x86 machine. You just can't copy the db from one to the other (both ways will give errors)\r\n3) See 2",
      "created_at" : "2013-02-10T18:15:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-13357918",
      "id" : 13357918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2013-02-10T18:15:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/13357918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2395990?v=3",
         "events_url" : "https://api.github.com/users/Belkaar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Belkaar/followers",
         "following_url" : "https://api.github.com/users/Belkaar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Belkaar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Belkaar",
         "id" : 2395990,
         "login" : "Belkaar",
         "organizations_url" : "https://api.github.com/users/Belkaar/orgs",
         "received_events_url" : "https://api.github.com/users/Belkaar/received_events",
         "repos_url" : "https://api.github.com/users/Belkaar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Belkaar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Belkaar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Belkaar"
      }
   },
   {
      "body" : "The test build said \"Running 89 test cases, no errors\"",
      "created_at" : "2013-02-13T06:40:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-13476551",
      "id" : 13476551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2013-02-13T06:40:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/13476551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2395990?v=3",
         "events_url" : "https://api.github.com/users/Belkaar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Belkaar/followers",
         "following_url" : "https://api.github.com/users/Belkaar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Belkaar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Belkaar",
         "id" : 2395990,
         "login" : "Belkaar",
         "organizations_url" : "https://api.github.com/users/Belkaar/orgs",
         "received_events_url" : "https://api.github.com/users/Belkaar/received_events",
         "repos_url" : "https://api.github.com/users/Belkaar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Belkaar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Belkaar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Belkaar"
      }
   },
   {
      "body" : "AFAIK the database files on linux and MS windows are also incompatible with each other. Are there any plans to make it so that the files can be used for the client irrespective of platform/architecture?",
      "created_at" : "2013-03-20T03:36:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-15156780",
      "id" : 15156780,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2013-03-20T03:36:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/15156780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "This is low priority, given that the database may be regenerated from publicly available data at any time.",
      "created_at" : "2013-03-20T14:27:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-15178622",
      "id" : 15178622,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2013-03-20T14:27:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/15178622",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I just checked with master on my cubox-i (4 core, armv7l-linux-gnueabihf, debian jessie). Tried two scenarios:\r\n\r\n1) On ARM box \r\n- bootstrap the first ? blocks using blk00000.dat file from other install\r\n- shut down bitcoind\r\n- copy resulting bitcoin directory to AMD64 box\r\n- run bitcoind on AMD64 box\r\n\r\n2) On AMD64 box \r\n- bootstrap the first 142647 blocks using bootstrap.dat file\r\n- shut down bitcoind\r\n- copy resulting bitcoin directory to ARM box\r\n- run bitcoind on ARM box\r\n\r\nCuriously, (1) seemed to work, whereas (2) manages to get past the leveldb validation but then starts to behave very erratic. It accepts blocks but never does anything with them, ie\r\n\r\n    2014-03-08 07:51:31 ProcessBlock: ACCEPTED\r\n    2014-03-08 07:51:31 ProcessBlock: ACCEPTED\r\n    2014-03-08 07:51:31 ProcessBlock: ACCEPTED\r\n    2014-03-08 07:51:31 ProcessBlock: ACCEPTED\r\n    2014-03-08 07:51:31 ProcessBlock: ACCEPTED\r\n    2014-03-08 07:51:31 ProcessBlock: ACCEPTED\r\n    2014-03-08 07:51:31 ProcessBlock: ACCEPTED\r\n    ....\r\n\r\nStarting with -checkblocks=0 (which should check the entire database) gives\r\n\r\n    2014-03-08 07:47:38 Verifying last 142647 blocks at level 3\r\n    2014-03-08 07:51:22 No coin database inconsistencies in last 4083 blocks (216726 transactions)\r\n    2014-03-08 07:51:23  block index          233301ms\r\n\r\nAfter a -reindex it works fine.\r\n\r\nEdit: re-trying with the copied block index and `-checkblocks=0 -checklevel=3` gives the same kind of errors OP has:\r\n\r\n    2014-03-08 08:21:54 Verifying last 142647 blocks at level 3\r\n    2014-03-08 08:22:57 ERROR: DisconnectBlock() : undo data adding output to missing transaction\r\n    2014-03-08 08:22:57 ERROR: DisconnectBlock() : undo data adding output to missing transaction\r\n    2014-03-08 08:22:57 ERROR: DisconnectBlock() : undo data adding output to missing transaction\r\n    2014-03-08 08:22:57 ERROR: DisconnectBlock() : undo data adding output to missing transaction\r\n    2014-03-08 08:22:57 ERROR: DisconnectBlock() : undo data adding output to missing transaction\r\n    ....\r\n\r\nThe daemon hangs after this. ",
      "created_at" : "2014-03-08T08:07:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-37092111",
      "id" : 37092111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-03-08T08:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/37092111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "OK this is curious. It it non-deterministic. Sometimes the verify passes, as pindexState gets 'stuck'\r\n\r\n    2014-03-08 08:45:20 Verifying pindexState=138564 pIndex=1\r\n    2014-03-08 08:45:20 No coin database inconsistencies in last 4083 blocks (216726 transactions)\r\n    2014-03-08 08:45:21  block index          244825ms\r\n\r\n(this doesn't imply that the resulting index actually works, it doesn't)\r\n",
      "created_at" : "2014-03-08T08:48:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-37092780",
      "id" : 37092780,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-03-08T08:48:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/37092780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I too tried to initialize a block index and chainstate database on my x86 system and then copy the files over to a Raspberry Pi. Since both systems are Linux, 32-bit, little-endian, I figured there would be no differences in the on-disk format. However, this is apparently not so. When Bitcoind starts verifying blocks, it immediately starts complaining about missing transactions. However, using the exact same files on the x86 machine (i.e., everything inside blocks/ and chainstate/ identical to what it was when starting on the RPi), Bitcoind starts up and verifies the blocks just fine.\r\n\r\nVery disappointing that the on-disk format of these LevelDB databases differs between two architectures that are both 32-bit, little-endian.",
      "created_at" : "2014-03-24T12:20:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-38437350",
      "id" : 38437350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-03-24T12:20:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/38437350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/797782?v=3",
         "events_url" : "https://api.github.com/users/whitslack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/whitslack/followers",
         "following_url" : "https://api.github.com/users/whitslack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/whitslack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/whitslack",
         "id" : 797782,
         "login" : "whitslack",
         "organizations_url" : "https://api.github.com/users/whitslack/orgs",
         "received_events_url" : "https://api.github.com/users/whitslack/received_events",
         "repos_url" : "https://api.github.com/users/whitslack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/whitslack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/whitslack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/whitslack"
      }
   },
   {
      "body" : "I think this is unintentional, as the LevelDB on-disk format is very well described (up to the byte level). My guess is a LevelDB bug that only occurs on ARM.\r\n\r\nWe should probably report this upstream.",
      "created_at" : "2014-03-24T12:29:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-38438051",
      "id" : 38438051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-03-24T12:29:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/38438051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I guess we would need a minimal test case that produces different data files on ARM than on x86.",
      "created_at" : "2014-03-24T12:33:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-38438344",
      "id" : 38438344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-03-24T12:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/38438344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/797782?v=3",
         "events_url" : "https://api.github.com/users/whitslack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/whitslack/followers",
         "following_url" : "https://api.github.com/users/whitslack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/whitslack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/whitslack",
         "id" : 797782,
         "login" : "whitslack",
         "organizations_url" : "https://api.github.com/users/whitslack/orgs",
         "received_events_url" : "https://api.github.com/users/whitslack/received_events",
         "repos_url" : "https://api.github.com/users/whitslack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/whitslack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/whitslack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/whitslack"
      }
   },
   {
      "body" : "It may just be a bug in Bitcoin's LevelDB glue code or serialization code too...",
      "created_at" : "2014-03-24T12:36:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-38438611",
      "id" : 38438611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-03-24T12:36:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/38438611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "This is really strange. I've indexed the first four block files both on ARM and AMD64.\r\nTo compare the resulting leveldb files I've built a [py-leveldb](https://code.google.com/p/py-leveldb/) against bitcoin's leveldb and started poking at the database files, comparing them in various ways.\r\n\r\n```python\r\n# Compare two bitcoind's leveldbs\r\nimport leveldb\r\n\r\ndbdira = 'armtest'\r\ndbdirb = 'amd64test'\r\n\r\ndatabases = ['/chainstate', '/blocks/index']\r\n\r\ndef compare_databases(cs1, cs2):\r\n    ai = cs1.RangeIter()\r\n    bi = cs2.RangeIter()\r\n\r\n    n = 0\r\n    err = 0\r\n    aend = bend = False\r\n    while True:\r\n        try:\r\n            a = ai.next()\r\n        except StopIteration:\r\n            aend = True\r\n        try:\r\n            b = bi.next()\r\n        except StopIteration:\r\n            bend = True\r\n        if aend and bend:\r\n            break # both at end of iteration\r\n        if aend or bend or a != b:\r\n            err += 1\r\n        n += 1\r\n\r\n    print \"Compared %i records\" % n\r\n    print \"Found %i differences\" % err\r\n\r\ndef compare_databases2(cs1, cs2):\r\n    '''\r\n    Check that all keys of cs1 are in cs2\r\n    and that the values match.\r\n    '''\r\n    ai = cs1.RangeIter()\r\n\r\n    n = 0\r\n    err = 0\r\n    for (key,value) in ai:\r\n        try:\r\n            if cs2.Get(key) != value:\r\n                err += 1\r\n        except KeyError:\r\n            err += 1\r\n        n += 1\r\n\r\n    print \"Compared %i records\" % n\r\n    print \"Found %i differences\" % err\r\n\r\nfor db in databases:\r\n    print \"* Comparing %s\" % db\r\n    cs1 = leveldb.LevelDB(dbdira + db)\r\n    cs2 = leveldb.LevelDB(dbdirb + db)\r\n    print \"** Check 1\"\r\n    compare_databases(cs1, cs2)\r\n    print \"** Check 2\"\r\n    compare_databases2(cs1, cs2)\r\n    print \"** Check 3\"\r\n    compare_databases2(cs2, cs1)\r\n    print\r\n```\r\n\r\nOutput:\r\n```\r\n* Comparing /chainstate\r\n** Check 1\r\nCompared 390331 records\r\nFound 0 differences\r\n** Check 2\r\nCompared 390331 records\r\nFound 0 differences\r\n** Check 3\r\nCompared 390331 records\r\nFound 0 differences\r\n\r\n* Comparing /blocks/index\r\n** Check 1\r\nCompared 142654 records\r\nFound 0 differences\r\n** Check 2\r\nCompared 142654 records\r\nFound 0 differences\r\n** Check 3\r\nCompared 142654 records\r\nFound 0 differences\r\n```\r\nSeemingly, there are no differences at all in the data. I've also checked the blk* and rev*.dat files. They match to the byte. However, bitcoin on AMD64 refuses to work with the ARM files. I'm baffled.\r\n\r\nOf course, bitcoin may have some other access pattern that brings to light a bug/difference in a lower level, but this is turning out to be elusive.\r\n\r\n**Also:** Re-silvering the ARM-created databases by creating a new database and simply copying all keys/values, makes a database that can be used on AMD64.\r\n",
      "created_at" : "2014-05-07T19:03:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-42469061",
      "id" : 42469061,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-05-07T19:37:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42469061",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj Feel like trying again with #4161 and #4177 merged?",
      "created_at" : "2014-05-31T15:21:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-44750915",
      "id" : 44750915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-05-31T15:21:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44750915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "OK, going to try",
      "created_at" : "2014-06-05T07:08:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-45187438",
      "id" : 45187438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-06-05T07:08:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45187438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I tried using the leveldb files from ARM on AMD64 and vice-versa. Same problem as before - alas, the paranoid checks do not catch this.",
      "created_at" : "2014-06-05T11:54:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-45210326",
      "id" : 45210326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-06-05T11:54:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45210326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Thanks for testing!\r\n\r\nI wonder: do we get any kind of warning/error in chainstate/LOG ?",
      "created_at" : "2014-06-05T23:45:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-45288852",
      "id" : 45288852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-06-05T23:45:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45288852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I'll check next time.\r\n\r\nI'm working on recording a trace of bitcoind's access pattern, then replaying that against the two database instance and seeing where returned values start to diverge. ",
      "created_at" : "2014-06-06T14:54:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-45345543",
      "id" : 45345543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-06-06T14:54:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45345543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I found the bug! Well at least I've narrowed it down a lot. The problem is in the `filter_policy`, which is set to `leveldb::NewBloomFilterPolicy(10)`. Seemingly this filter policy data is not portable.\r\nCommenting out that line makes the same block index files work on ARM and AMD64.\r\n\r\nThis explains why the database works fine after resilvering in my above post (and in general in py_leveldb, which doesn't use a filter policy...).",
      "created_at" : "2014-06-06T16:42:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-45358143",
      "id" : 45358143,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-06-06T16:48:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45358143",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "The Hash function used for the bloom filter was returning different values based on character signedness in some edge cases. See https://github.com/bitcoin/leveldb/pull/5 for fix.\r\nUpstream issue: https://code.google.com/p/leveldb/issues/detail?id=237",
      "created_at" : "2014-06-07T11:36:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-45407906",
      "id" : 45407906,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-06-07T12:01:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45407906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "It doesn't seem that the upstream issue is being picked up. Platform compatibility of the databases is likely very low-priority for them.\r\n\r\nWe *could* work around this completely on the bitcoind side by providing our own FilterPolicy() implementation and passing it in with the options. That's just a small class that hashes keys and tests against them: https://github.com/bitcoin/bitcoin/blob/master/src/leveldb/util/bloom.cc#L17 .\r\n",
      "created_at" : "2014-07-01T05:20:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-47618028",
      "id" : 47618028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-07-01T05:21:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47618028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "See #5093",
      "created_at" : "2014-10-21T07:54:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2293#issuecomment-59891584",
      "id" : 59891584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2293",
      "updated_at" : "2014-10-21T07:54:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/59891584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
