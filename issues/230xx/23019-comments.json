[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23647](https://github.com/bitcoin/bitcoin/pull/23647) (Split rpcwallet into multiple smaller parts by meshcollider)\n* [#23545](https://github.com/bitcoin/bitcoin/pull/23545) (scripted-diff: Use clang-tidy syntax for C++ named arguments [WIP; TOO MANY CONFLICTS] by MarcoFalke)\n* [#23417](https://github.com/bitcoin/bitcoin/pull/23417) (wallet, spkm: Move key management from DescriptorScriptPubKeyMan to wallet level KeyManager by achow101)\n* [#22929](https://github.com/bitcoin/bitcoin/pull/22929) (wallet: Automatically add receiving destinations to the address book by S3RK)\n* [#22341](https://github.com/bitcoin/bitcoin/pull/22341) (rpc: add getxpub by Sjors)\n* [#19602](https://github.com/bitcoin/bitcoin/pull/19602) (wallet: Migrate legacy wallets to descriptor wallets by achow101)\n* [#15719](https://github.com/bitcoin/bitcoin/pull/15719) (Wallet passive startup by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-18T01:47:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-922158351",
      "id" : 922158351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII58429wUP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/922158351/reactions"
      },
      "updated_at" : "2021-12-02T15:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/922158351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r712367521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712367521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Addresses don't hold funds. They only receive, never send.\r\n\r\nInstead, it should just tally the total received ever.",
      "commit_id" : "fdc4031e857491750b3bbbe6fe7eb2eeb51c4a80",
      "created_at" : "2021-09-20T17:21:41Z",
      "diff_hunk" : "@@ -236,6 +236,128 @@ static void SetFeeEstimateMode(const CWallet& wallet, CCoinControl& cc, const Un\n     }\n }\n \n+static RPCHelpMan listaddresses()\n+{\n+    return RPCHelpMan{\"listaddresses\",\n+                \"\\nLists wallet addresses\\n\",\n+                {\n+                    {\"start_index\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Address list starting index.\"},\n+                    {\"end_index\", RPCArg::Type::NUM, RPCArg::Default{10}, \"Address list ending index.\"},\n+                },\n+                RPCResult{\n+                    RPCResult::Type::OBJ, \"\", \"\",{\n+                    {\n+                        RPCResult::Type::ARR, \"\", \"\",\n+                        {\n+                            {RPCResult::Type::OBJ, \"\", \"\", {\n+                                {RPCResult::Type::NUM, \"index\", \"The address position\"},\n+                                {RPCResult::Type::STR, \"address\", \"The bitcoin address\"},\n+                                {RPCResult::Type::STR, \"hdkeypath\", \"The BIP 32 HD path of the address\"},\n+                                {RPCResult::Type::STR, \"descriptor\", \"The address descriptor\"},\n+                                {RPCResult::Type::BOOL, \"internal\", \"The address is internal (change) or external (receive)\"},\n+                                {RPCResult::Type::NUM, \"amount\", \"Available amount at address\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r712367521",
      "id" : 712367521,
      "line" : 258,
      "node_id" : "PRRC_kwDOABII584qdd2h",
      "original_commit_id" : "fdc4031e857491750b3bbbe6fe7eb2eeb51c4a80",
      "original_line" : 258,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 758904743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-20T17:22:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712367521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r713488076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/713488076"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The code to count the total received is already available in the function. It can be done.\r\n\r\nBut address explorers in most software wallets, such as Electrum and Specter Desktop, only show the funds available to be spent at each address. I think the idea is to see how the UTXO values are distributed across the addresses (if there is any significant gap, for example).",
      "commit_id" : "fdc4031e857491750b3bbbe6fe7eb2eeb51c4a80",
      "created_at" : "2021-09-21T23:33:07Z",
      "diff_hunk" : "@@ -236,6 +236,128 @@ static void SetFeeEstimateMode(const CWallet& wallet, CCoinControl& cc, const Un\n     }\n }\n \n+static RPCHelpMan listaddresses()\n+{\n+    return RPCHelpMan{\"listaddresses\",\n+                \"\\nLists wallet addresses\\n\",\n+                {\n+                    {\"start_index\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Address list starting index.\"},\n+                    {\"end_index\", RPCArg::Type::NUM, RPCArg::Default{10}, \"Address list ending index.\"},\n+                },\n+                RPCResult{\n+                    RPCResult::Type::OBJ, \"\", \"\",{\n+                    {\n+                        RPCResult::Type::ARR, \"\", \"\",\n+                        {\n+                            {RPCResult::Type::OBJ, \"\", \"\", {\n+                                {RPCResult::Type::NUM, \"index\", \"The address position\"},\n+                                {RPCResult::Type::STR, \"address\", \"The bitcoin address\"},\n+                                {RPCResult::Type::STR, \"hdkeypath\", \"The BIP 32 HD path of the address\"},\n+                                {RPCResult::Type::STR, \"descriptor\", \"The address descriptor\"},\n+                                {RPCResult::Type::BOOL, \"internal\", \"The address is internal (change) or external (receive)\"},\n+                                {RPCResult::Type::NUM, \"amount\", \"Available amount at address\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r713488076",
      "id" : 713488076,
      "in_reply_to_id" : 712367521,
      "line" : 258,
      "node_id" : "PRRC_kwDOABII584qhvbM",
      "original_commit_id" : "fdc4031e857491750b3bbbe6fe7eb2eeb51c4a80",
      "original_line" : 258,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 760336795,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-21T23:33:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/713488076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Approach NACK\r\n\r\nI started reviewing, but I have some fundamental issues with the approach taken. I like the general idea, but this specific implementation has issues.\r\n\r\nFirst of all, why does this even need to take parameters? I don't see why a \"starting index\" or \"ending index\" need to be provided. We shouldn't need to derive addresses on the fly because they should already be in the wallet in some way. This really should use the address book, the keypool, and key metadata rather than re-deriving. Index just doesn't really make sense for what this RPC purports to do. This also ends up making assumptions about what addresses are receiving and change, depending on how they are derived. But that is not reliable, especially for wallets prior to the HD chain split. In fact, using this with such a wallet will result in an assertion failure, and that is just not acceptable. The correct thing is to use the wallet's built in change determining function(s) so that those that are listed as change actually correspond with the things that the wallet will see as change.\r\n\r\nLikewise, why is this limited to just the default address type? A wallet will typically have addresses of address types that are not the default. These should be output as well.\r\n\r\nFurthermore, this RPC appears to only work on HD wallets, which severely limits is usability. Many people do use non-HD wallets still, and I would expect something that just lists out the wallet's addresses is not limited to just HD wallets.",
      "created_at" : "2021-09-24T19:03:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-926856642",
      "id" : 926856642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII5843PrXC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T19:03:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926856642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@achow101 thanks for detailed review.\r\n\r\nMy original implementation used the keypool (for legacy wallets), m_wallet_descriptor (for descriptor wallets) and key metadata.\r\nOriginally, the `ScriptPubKeyMan::ListAddresses()` methods also didn't call `TopUp()`. \r\n\r\nBut the problem is the following case: if the user wants to know some address whose index is greater than the keypool total (such as 2395th), an error would be generated. Deriving addresses solved this issue. The listaddresses RPC would work regardless of keypool size.\r\n\r\nSince the problem was in the approach, not in concept, I changed the code of this PR to the original version, that uses the keypool, m_wallet_descriptor and key metadata.\r\nSo the way I've found to resolve the keypool limitation is the following code, but I'm not sure this is a good user experience.\r\n\r\n```c++\r\nif ((size_t) end_index >= setKeyPool->size()) {\r\n    auto s_end_index = strprintf(\"%u\", end_index);\r\n    auto s_set_keypool_size = strprintf(\"%u\", setKeyPool->size() - 1);\r\n    auto error_message = \"Error: end_index (\" + s_end_index + \") is greater than last keypool item (\" + s_set_keypool_size + \").\";\r\n    error = _(error_message.c_str());\r\n    return false;\r\n}\r\n```\r\n\r\nI didn't understand the reason to remove `start_index` and `end_index`. They work more like pagination. Without them, the command would return 2000 items (the default keypool size * 2). \r\nRemoving them, what would be the other way to have a good visualization of the result?\r\n\r\nI also added address type as parameter.",
      "created_at" : "2021-09-27T06:41:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-927576568",
      "id" : 927576568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII5843SbH4",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T06:45:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927576568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> But the problem is the following case: if the user wants to know some address whose index is greater than the keypool total (such as 2395th), an error would be generated. Deriving addresses solved this issue. The listaddresses RPC would work regardless of keypool size.\r\n\r\nI don't think that is a situation we should support. It would mean that users could get addresses that are not currently being watched by the wallet. I think that there would be the expectation that the wallet is watching such an address and so any funds sent to them would appear in the wallet. But that would not be the case.\r\n\r\n> I didn't understand the reason to remove `start_index` and `end_index`. They work more like pagination. Without them, the command would return 2000 items (the default keypool size * 2).\r\n\r\nI think that it is completely reasonable to return such a large result. There could be options for verbosity, e.g. a non-verbose output is just the addresses, then verbose is with all of the additional information that this PR currently includes.\r\n\r\nWe have many RPCs that will output a ton of data from the wallet, e.g. `listunspent` or `listtransactions`.",
      "created_at" : "2021-09-27T16:25:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-928047795",
      "id" : 928047795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII5843UOKz",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T16:26:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/928047795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I removed the indexes and changed the code to use address book, the keypool, and key metadata.\r\nThe results of this RPC are:\r\n\r\n. Legacy wallet:  The addresses from `address book` (those returned by `getnewaddress`) are not ordered, but the those from  keypool are in the correct BIP32 derivation order.  This is a limitation on legacy wallet result, since keypool erases the key in `getnewaddress`. I'm not sure there is a simple way to order them.\r\n\r\n. Descriptor wallet: All the addresses are in the correct BIP32 derivation order, as it is possible to iterate over the `m_wallet_descriptor.cache` using `m_wallet_descriptor.range_start` and `m_wallet_descriptor.range_end`. \r\n\r\nUpdated test information in PR description.",
      "created_at" : "2021-09-30T03:58:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-930759617",
      "id" : 930759617,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII5843ekPB",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-30T03:58:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930759617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r719666816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719666816"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In dd28fcb4d868763b47a62a41d2114462407481c2 \"Add listaddresses RPC\"\r\n\r\nIt seems like instead of doing this, you could just have `CWallet::ListAddresses` do internal too.",
      "commit_id" : "39d734e6452898ebcd37aaa754c7f3efcadbe900",
      "created_at" : "2021-09-30T18:40:21Z",
      "diff_hunk" : "@@ -236,6 +236,103 @@ static void SetFeeEstimateMode(const CWallet& wallet, CCoinControl& cc, const Un\n     }\n }\n \n+static RPCHelpMan listaddresses()\n+{\n+    return RPCHelpMan{\"listaddresses\",\n+                \"\\nLists wallet addresses\\n\",\n+                {\n+                    {\"address_type\", RPCArg::Type::STR, RPCArg::DefaultHint{\"set by -addresstype\"}, \"The address type to use. Options are \\\"legacy\\\", \\\"p2sh-segwit\\\", and \\\"bech32\\\".\"},\n+                },\n+                RPCResult{\n+                    RPCResult::Type::OBJ, \"\", \"\",{\n+                    {\n+                        RPCResult::Type::ARR, \"\", \"\",\n+                        {\n+                            {RPCResult::Type::OBJ, \"\", \"\", {\n+                                {RPCResult::Type::STR, \"address\", \"The bitcoin address\"},\n+                                {RPCResult::Type::STR, \"hdkeypath\", \"The BIP 32 HD path of the address\"},\n+                                {RPCResult::Type::STR, \"descriptor\", \"The address descriptor\"},\n+                                {RPCResult::Type::BOOL, \"internal\", \"The address is internal (change) or external (receive)\"},\n+                                {RPCResult::Type::STR, \"address_type\", \"The address type (legacy, p2sh-segwit, and bech32)\"},\n+                                {RPCResult::Type::NUM, \"amount\", \"Available amount at address\"},\n+                                {RPCResult::Type::BOOL, \"address_used\", \"This address has already received funds or not\"}\n+                            }},\n+                        },\n+                    }},\n+                },\n+                RPCExamples{\n+                    HelpExampleCli(\"listaddresses\", \"\")\n+                    + HelpExampleCli(\"listaddresses\", \"\\\"legacy\\\"\")\n+            + HelpExampleRpc(\"listaddresses\", \"\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!pwallet) return NullUniValue;\n+\n+    pwallet->BlockUntilSyncedToCurrentChain();\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    if (!pwallet->CanGetAddresses()) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: This wallet has no available keys\");\n+    }\n+\n+    OutputType output_type = pwallet->m_default_address_type;\n+    if (!request.params[0].isNull()) {\n+        std::optional<OutputType> parsed = ParseOutputType(request.params[0].get_str());\n+        if (!parsed) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, strprintf(\"Unknown address type '%s'\", request.params[1].get_str()));\n+        } else if (parsed.value() == OutputType::BECH32M && pwallet->GetLegacyScriptPubKeyMan()) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Legacy wallets cannot provide bech32m addresses\");\n+        }\n+        output_type = parsed.value();\n+    }\n+\n+    auto addressbalances = GetAddressBalances(*pwallet);\n+\n+    UniValue result(UniValue::VOBJ);\n+\n+    for (bool internal: { false, true }) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r719666816",
      "id" : 719666816,
      "line" : 296,
      "node_id" : "PRRC_kwDOABII584q5T6A",
      "original_commit_id" : "dd28fcb4d868763b47a62a41d2114462407481c2",
      "original_line" : 296,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 61,
      "pull_request_review_id" : 768213993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719666816/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T19:15:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719666816",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r719673814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719673814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In dd28fcb4d868763b47a62a41d2114462407481c2 \"Add listaddresses RPC\"\r\n\r\nThis section is somewhat duplicated with `getaddressinfo`. I think it would be better to refactor that so that these can share the same code. Additionally, this does not need to be in the wallet (and thus require the introduction of another struct). I would prefer if you just did it in the RPC code.",
      "commit_id" : "39d734e6452898ebcd37aaa754c7f3efcadbe900",
      "created_at" : "2021-09-30T18:51:04Z",
      "diff_hunk" : "@@ -2137,6 +2137,94 @@ bool CWallet::TopUpKeyPool(unsigned int kpSize)\n     return res;\n }\n \n+void CWallet::GetDestinationsFromAddressBook(std::vector<CTxDestination>& destinations, bool internal)\n+{\n+    LOCK(cs_wallet);\n+    auto start = m_address_book.begin();\n+    auto end = m_address_book.end();\n+\n+    for (auto item_it = start; item_it != end; ++item_it)\n+    {\n+        if (item_it->second.IsChange() != internal)\n+            continue;\n+\n+        destinations.emplace_back(item_it->first);\n+    }\n+}\n+\n+void CWallet::GetAddressInfoFromDestinations(const OutputType output_type, ScriptPubKeyMan* spk_man, std::vector<CTxDestination>& destinations, std::vector<AddressInfo>& address_info_list, bool internal)\n+{\n+    LOCK(cs_wallet);\n+    int min_depth = 1;\n+\n+    std::map<std::string, bool> used_addresses;\n+\n+    for (const std::pair<const uint256, CWalletTx>& wtx_pair : mapWallet) {\n+        const CWalletTx& wtx = wtx_pair.second;\n+        if (wtx.IsCoinBase() || !chain().checkFinalTx(*wtx.tx) || GetTxDepthInMainChain(wtx) < min_depth) {\n+            continue;\n+        }\n+\n+        for (const CTxOut& txout : wtx.tx->vout) {\n+            CTxDestination address;\n+            if (ExtractDestination(txout.scriptPubKey, address) && IsMine(address)) {\n+                used_addresses[EncodeDestination(address)] = true;\n+                break;\n+            }\n+        }\n+    }\n+\n+    for(auto destination : destinations) {\n+        auto meta = spk_man->GetMetadata(destination);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r719673814",
      "id" : 719673814,
      "line" : 2178,
      "node_id" : "PRRC_kwDOABII584q5VnW",
      "original_commit_id" : "dd28fcb4d868763b47a62a41d2114462407481c2",
      "original_line" : 2178,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 42,
      "pull_request_review_id" : 768213993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719673814/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T19:15:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719673814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r719676303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719676303"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In dd28fcb4d868763b47a62a41d2114462407481c2 \"Add listaddresses RPC\"\r\n\r\nIt would be more efficient to iterate `m_map_script_pub_keys` than to expand the descriptor again. This would also work for descriptors that have hardened derivation as the last step.",
      "commit_id" : "39d734e6452898ebcd37aaa754c7f3efcadbe900",
      "created_at" : "2021-09-30T18:54:58Z",
      "diff_hunk" : "@@ -1613,6 +1613,48 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n     return set_address;\n }\n \n+void LegacyScriptPubKeyMan::ListAddresses(const OutputType type, std::vector<CTxDestination>& addresses, bool internal)\n+{\n+    LOCK(cs_KeyStore);\n+\n+    WalletBatch batch(m_storage.GetDatabase());\n+    std::set<int64_t> *setKeyPool = internal ? &setInternalKeyPool : &setExternalKeyPool;\n+\n+    addresses.reserve(addresses.size() + setKeyPool->size());\n+\n+    auto it = setKeyPool->begin();\n+    while (it != std::end(*setKeyPool)) {\n+        CKeyPool keypool;\n+        if (batch.ReadPool(*(it), keypool)) {\n+            auto dest = GetDestinationForKey(keypool.vchPubKey, type);\n+            addresses.emplace_back(dest);\n+        }\n+        ++it;\n+    }\n+}\n+\n+void DescriptorScriptPubKeyMan::ListAddresses(const OutputType type, std::vector<CTxDestination>& addresses, bool internal)\n+{\n+    LOCK(cs_desc_man);\n+\n+    addresses.reserve(m_wallet_descriptor.range_end);\n+\n+    for (int32_t i = m_wallet_descriptor.range_start; i < m_wallet_descriptor.range_end; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r719676303",
      "id" : 719676303,
      "line" : 1642,
      "node_id" : "PRRC_kwDOABII584q5WOP",
      "original_commit_id" : "dd28fcb4d868763b47a62a41d2114462407481c2",
      "original_line" : 1642,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 30,
      "pull_request_review_id" : 768213993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719676303/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T19:15:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719676303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r720586976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720586976"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 4c2625a .",
      "commit_id" : "fcade9b64d08aa7dfe83e00a105348ce06884700",
      "created_at" : "2021-10-01T23:30:53Z",
      "diff_hunk" : "@@ -236,6 +236,103 @@ static void SetFeeEstimateMode(const CWallet& wallet, CCoinControl& cc, const Un\n     }\n }\n \n+static RPCHelpMan listaddresses()\n+{\n+    return RPCHelpMan{\"listaddresses\",\n+                \"\\nLists wallet addresses\\n\",\n+                {\n+                    {\"address_type\", RPCArg::Type::STR, RPCArg::DefaultHint{\"set by -addresstype\"}, \"The address type to use. Options are \\\"legacy\\\", \\\"p2sh-segwit\\\", and \\\"bech32\\\".\"},\n+                },\n+                RPCResult{\n+                    RPCResult::Type::OBJ, \"\", \"\",{\n+                    {\n+                        RPCResult::Type::ARR, \"\", \"\",\n+                        {\n+                            {RPCResult::Type::OBJ, \"\", \"\", {\n+                                {RPCResult::Type::STR, \"address\", \"The bitcoin address\"},\n+                                {RPCResult::Type::STR, \"hdkeypath\", \"The BIP 32 HD path of the address\"},\n+                                {RPCResult::Type::STR, \"descriptor\", \"The address descriptor\"},\n+                                {RPCResult::Type::BOOL, \"internal\", \"The address is internal (change) or external (receive)\"},\n+                                {RPCResult::Type::STR, \"address_type\", \"The address type (legacy, p2sh-segwit, and bech32)\"},\n+                                {RPCResult::Type::NUM, \"amount\", \"Available amount at address\"},\n+                                {RPCResult::Type::BOOL, \"address_used\", \"This address has already received funds or not\"}\n+                            }},\n+                        },\n+                    }},\n+                },\n+                RPCExamples{\n+                    HelpExampleCli(\"listaddresses\", \"\")\n+                    + HelpExampleCli(\"listaddresses\", \"\\\"legacy\\\"\")\n+            + HelpExampleRpc(\"listaddresses\", \"\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!pwallet) return NullUniValue;\n+\n+    pwallet->BlockUntilSyncedToCurrentChain();\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    if (!pwallet->CanGetAddresses()) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: This wallet has no available keys\");\n+    }\n+\n+    OutputType output_type = pwallet->m_default_address_type;\n+    if (!request.params[0].isNull()) {\n+        std::optional<OutputType> parsed = ParseOutputType(request.params[0].get_str());\n+        if (!parsed) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, strprintf(\"Unknown address type '%s'\", request.params[1].get_str()));\n+        } else if (parsed.value() == OutputType::BECH32M && pwallet->GetLegacyScriptPubKeyMan()) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Legacy wallets cannot provide bech32m addresses\");\n+        }\n+        output_type = parsed.value();\n+    }\n+\n+    auto addressbalances = GetAddressBalances(*pwallet);\n+\n+    UniValue result(UniValue::VOBJ);\n+\n+    for (bool internal: { false, true }) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r720586976",
      "id" : 720586976,
      "in_reply_to_id" : 719666816,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584q80jg",
      "original_commit_id" : "dd28fcb4d868763b47a62a41d2114462407481c2",
      "original_line" : 296,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 769431680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720586976/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T23:30:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720586976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r720587252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720587252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 4c2625a.\r\n\r\n`m_map_script_pub_keys` is sorted by descriptor range index before iteration.",
      "commit_id" : "fcade9b64d08aa7dfe83e00a105348ce06884700",
      "created_at" : "2021-10-01T23:32:18Z",
      "diff_hunk" : "@@ -1613,6 +1613,48 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n     return set_address;\n }\n \n+void LegacyScriptPubKeyMan::ListAddresses(const OutputType type, std::vector<CTxDestination>& addresses, bool internal)\n+{\n+    LOCK(cs_KeyStore);\n+\n+    WalletBatch batch(m_storage.GetDatabase());\n+    std::set<int64_t> *setKeyPool = internal ? &setInternalKeyPool : &setExternalKeyPool;\n+\n+    addresses.reserve(addresses.size() + setKeyPool->size());\n+\n+    auto it = setKeyPool->begin();\n+    while (it != std::end(*setKeyPool)) {\n+        CKeyPool keypool;\n+        if (batch.ReadPool(*(it), keypool)) {\n+            auto dest = GetDestinationForKey(keypool.vchPubKey, type);\n+            addresses.emplace_back(dest);\n+        }\n+        ++it;\n+    }\n+}\n+\n+void DescriptorScriptPubKeyMan::ListAddresses(const OutputType type, std::vector<CTxDestination>& addresses, bool internal)\n+{\n+    LOCK(cs_desc_man);\n+\n+    addresses.reserve(m_wallet_descriptor.range_end);\n+\n+    for (int32_t i = m_wallet_descriptor.range_start; i < m_wallet_descriptor.range_end; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r720587252",
      "id" : 720587252,
      "in_reply_to_id" : 719676303,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584q80n0",
      "original_commit_id" : "dd28fcb4d868763b47a62a41d2114462407481c2",
      "original_line" : 1642,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 769432021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720587252/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T23:32:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720587252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r720588249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720588249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in fcade9b.\r\n\r\nCreated a new function that both `getaddressinfo` and `listaddresses` call.\r\nThis new function keeps the order of `getaddressinfo` fields.",
      "commit_id" : "fcade9b64d08aa7dfe83e00a105348ce06884700",
      "created_at" : "2021-10-01T23:36:35Z",
      "diff_hunk" : "@@ -2137,6 +2137,94 @@ bool CWallet::TopUpKeyPool(unsigned int kpSize)\n     return res;\n }\n \n+void CWallet::GetDestinationsFromAddressBook(std::vector<CTxDestination>& destinations, bool internal)\n+{\n+    LOCK(cs_wallet);\n+    auto start = m_address_book.begin();\n+    auto end = m_address_book.end();\n+\n+    for (auto item_it = start; item_it != end; ++item_it)\n+    {\n+        if (item_it->second.IsChange() != internal)\n+            continue;\n+\n+        destinations.emplace_back(item_it->first);\n+    }\n+}\n+\n+void CWallet::GetAddressInfoFromDestinations(const OutputType output_type, ScriptPubKeyMan* spk_man, std::vector<CTxDestination>& destinations, std::vector<AddressInfo>& address_info_list, bool internal)\n+{\n+    LOCK(cs_wallet);\n+    int min_depth = 1;\n+\n+    std::map<std::string, bool> used_addresses;\n+\n+    for (const std::pair<const uint256, CWalletTx>& wtx_pair : mapWallet) {\n+        const CWalletTx& wtx = wtx_pair.second;\n+        if (wtx.IsCoinBase() || !chain().checkFinalTx(*wtx.tx) || GetTxDepthInMainChain(wtx) < min_depth) {\n+            continue;\n+        }\n+\n+        for (const CTxOut& txout : wtx.tx->vout) {\n+            CTxDestination address;\n+            if (ExtractDestination(txout.scriptPubKey, address) && IsMine(address)) {\n+                used_addresses[EncodeDestination(address)] = true;\n+                break;\n+            }\n+        }\n+    }\n+\n+    for(auto destination : destinations) {\n+        auto meta = spk_man->GetMetadata(destination);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#discussion_r720588249",
      "id" : 720588249,
      "in_reply_to_id" : 719673814,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584q803Z",
      "original_commit_id" : "dd28fcb4d868763b47a62a41d2114462407481c2",
      "original_line" : 2178,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 769432992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720588249/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-01T23:36:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720588249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-02T19:44:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-984946398",
      "id" : 984946398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII5846tRbe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984946398/reactions"
      },
      "updated_at" : "2021-12-02T19:44:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984946398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant?  Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant?  Please close.\n* Did the author lose interest or time to work on this?  Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2022-03-21T13:06:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-1073870986",
      "id" : 1073870986,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII585AAfiK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073870986/reactions"
      },
      "updated_at" : "2022-03-21T13:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073870986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant?  Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant?  Please close.\n* Did the author lose interest or time to work on this?  Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2022-07-25T07:03:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-1193660415",
      "id" : 1193660415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII585HJc__",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193660415/reactions"
      },
      "updated_at" : "2022-07-25T07:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193660415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing for now. Let us know when you are working on this again and if it should be reopened.",
      "created_at" : "2022-07-25T07:14:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23019#issuecomment-1193670758",
      "id" : 1193670758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23019",
      "node_id" : "IC_kwDOABII585HJfhm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193670758/reactions"
      },
      "updated_at" : "2022-07-25T07:14:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193670758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
