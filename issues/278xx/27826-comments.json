[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27826).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1661175302) |\n| Stale ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/27826#pullrequestreview-1488802032), [vasild](https://github.com/bitcoin/bitcoin/pull/27826#pullrequestreview-1759207756) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28318](https://github.com/bitcoin/bitcoin/pull/28318) (logging: Simplify API for level based logging by ajtowns)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-06-05T11:53:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1576645146",
      "id" : 1576645146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585d-bIa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576645146/reactions"
      },
      "updated_at" : "2023-12-22T22:22:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576645146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @jamesob, @instagibbs, @mzumsande ",
      "created_at" : "2023-06-05T11:59:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1576652503",
      "id" : 1576652503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585d-c7X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576652503/reactions"
      },
      "updated_at" : "2023-06-05T11:59:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576652503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There's various ways in which `AcceptBlockHeader` can return `true` or `false` early without setting `state`. This happens before the place where we used to log stuff. That in turn causes f25b8712c368ecfa250a6878af66f3fea3a4bcb0 to potentially log more stuff than it should (for headers that are not received via compact blocks).\r\n\r\nIt's probably why I saw so many log entries:\r\n\r\n```\r\n2023-06-05T11:50:30Z Saw new cmpctblock header hash=000000000000000000042a2c4e3910c5ccd48b4b2d624f08b4b5a413b98af4ea height=792960 peer=9\r\n2023-06-05T11:50:30Z Saw new header hash=000000000000000000042a2c4e3910c5ccd48b4b2d624f08b4b5a413b98af4ea height=792960 peer=6\r\n2023-06-05T11:50:31Z Saw new header hash=000000000000000000042a2c4e3910c5ccd48b4b2d624f08b4b5a413b98af4ea height=792960 peer=13\r\n2023-06-05T11:50:31Z Saw new header hash=000000000000000000042a2c4e3910c5ccd48b4b2d624f08b4b5a413b98af4ea height=792960 peer=16\r\n2023-06-05T11:50:31Z Saw new header hash=000000000000000000042a2c4e3910c5ccd48b4b2d624f08b4b5a413b98af4ea height=792960 peer=15\r\n2023-06-05T11:50:31Z UpdateTip: new best=000000000000000000042a2c4e3910c5ccd48b4b2d624f08b4b5a413b98af4ea height=792960 version=0x20000000 log2_work=94.223043 tx=848167913 date='2023-06-05T11:50:20Z' progress=1.000000 cache=1194.3MiB(9437428txo)\r\n2023-06-05T11:50:31Z Saw new header hash=000000000000000000042a2c4e3910c5ccd48b4b2d624f08b4b5a413b98af4ea height=792960 peer=3\r\n```\r\n\r\nMoving to draft while I give it more thought. ",
      "created_at" : "2023-06-05T12:15:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1576678050",
      "id" : 1576678050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585d-jKi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576678050/reactions"
      },
      "updated_at" : "2023-06-05T12:16:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576678050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a check to ensure the header was valid and newly seen before we log it. That matches the behaviour from before this PR.",
      "created_at" : "2023-06-05T12:34:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1576703050",
      "id" : 1576703050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585d-pRK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576703050/reactions"
      },
      "updated_at" : "2023-06-05T13:51:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576703050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1218113430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218113430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since it's possible for `ProcessNewBlockHeaders` to return false without us returning, I wonder if we should only log if it returned `true` (as we do above). ",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-06-05T13:56:28Z",
      "diff_hunk" : "@@ -4268,8 +4295,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (received_new_header) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1218113430",
      "id" : 1218113430,
      "line" : 4457,
      "node_id" : "PRRC_kwDOABII585Imu-W",
      "original_commit_id" : "b857d920444241f1598b6be509796d1d8e14dbbb",
      "original_line" : 4457,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 104,
      "pull_request_review_id" : 1462613579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218113430/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T13:56:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218113430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1235685769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235685769"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think this is possible though?\r\nThe call structure is `ProcessNewBlockHeaders()` -> `AcceptBlockHeader()` -> {`CheckBlockHeader()` / `ContextualCheckBlockHeader()`}, and the latter two functions return either `true` or `state.Invalid(...)`. As a result, `ProcessNewBlockHeaders()` would always return the invalid `state` of the first header that fails, and  `net_processing` would abort.\r\n",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-06-20T18:45:43Z",
      "diff_hunk" : "@@ -4268,8 +4295,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (received_new_header) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1235685769",
      "id" : 1235685769,
      "in_reply_to_id" : 1218113430,
      "line" : 4457,
      "node_id" : "PRRC_kwDOABII585JpxGJ",
      "original_commit_id" : "b857d920444241f1598b6be509796d1d8e14dbbb",
      "original_line" : 4457,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 104,
      "pull_request_review_id" : 1488802032,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235685769/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T18:55:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235685769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-24T00:22:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1605182433",
      "id" : 1605182433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585frSPh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605182433/reactions"
      },
      "updated_at" : "2023-06-24T00:22:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605182433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I still have to rebase this, will do soon(tm).",
      "created_at" : "2023-07-28T10:57:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1655491023",
      "id" : 1655491023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585irMnP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1655491023/reactions"
      },
      "updated_at" : "2023-07-28T10:57:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1655491023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased! (after #26969)",
      "created_at" : "2023-08-01T13:35:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1660344850",
      "id" : 1660344850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585i9toS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660344850/reactions"
      },
      "updated_at" : "2023-08-01T14:11:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660344850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-08-01T22:19:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1661175302",
      "id" : 1661175302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585jA4YG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661175302/reactions"
      },
      "updated_at" : "2023-08-01T22:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661175302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #28218 (no longer needs `ActiveChainstate()` to get `IsInitialBlockDownload()`).",
      "created_at" : "2023-08-21T10:41:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1686085339",
      "id" : 1686085339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585kf57b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1686085339/reactions"
      },
      "updated_at" : "2023-08-21T10:41:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1686085339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added support for `-logips`. This lets you retrieve the IP of a node you disconnected from, without the need for `-debug=net` (since it's too late to ask `getpeerinfo`). This becomes especially useful with #27277 which removes mempool \"noise\" from `-debug=validation`, so you can e.g. see what the rejection reason was for this header (without a gigabyte of logs per day).",
      "created_at" : "2023-08-31T08:40:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1700612380",
      "id" : 1700612380,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585lXUkc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700612380/reactions"
      },
      "updated_at" : "2023-08-31T08:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700612380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It turns out there's a third way that we can (and do) receive new headers: unsolicited `BLOCK` messages. I added two new commits that add logging for this, which also slightly refactors the first one.\r\n\r\nSince these new changes are a bit more involved, and also touch `CheckBlock()`, I'll hold off on squashing pending opinionsâ¦ But I do think logging these is very useful.",
      "created_at" : "2023-09-28T13:18:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1739148266",
      "id" : 1739148266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585nqUvq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739148266/reactions"
      },
      "updated_at" : "2023-09-28T13:18:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739148266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-05T14:28:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1749023445",
      "id" : 1749023445,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585oP_rV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749023445/reactions"
      },
      "updated_at" : "2023-10-05T14:28:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749023445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2023-10-05T14:45:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1749057471",
      "id" : 1749057471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585oQH-_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749057471/reactions"
      },
      "updated_at" : "2023-10-05T14:45:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749057471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348793415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348793415"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: There is no point in qualifying by value parameters with `const`.\r\n```suggestion\r\n    void LogBlockHeader(uint256 block_hash, std::optional<int> height, const CNode& peer, const bool via_compact_block = false, bool via_unsolicited_block = false);\r\n```",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-10-06T14:24:57Z",
      "diff_hunk" : "@@ -1058,6 +1064,8 @@ class PeerManagerImpl final : public PeerManager\n \n     void AddAddressKnown(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n     void PushAddress(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n+\n+    void LogBlockHeader(uint256 block_hash, std::optional<int> height, const CNode& peer, const bool via_compact_block = false, const bool via_unsolicited_block = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348793415",
      "id" : 1348793415,
      "line" : 1068,
      "node_id" : "PRRC_kwDOABII585QZPRH",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 1068,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 22,
      "pull_request_review_id" : 1661981480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348793415/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T15:24:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348793415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348800825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348800825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What is selfish mining? Miners are expected to be selfish and that is ok, no?",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-10-06T14:31:07Z",
      "diff_hunk" : "@@ -3345,6 +3359,33 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::LogBlockHeader(const uint256 hash, const std::optional<int> height, const CNode& peer, const bool via_compact_block, const bool via_unsolicited_block) {\n+    // To prevent log spam, this function should only be called after it was determined that a\n+    // header is both new and valid.\n+    //\n+    // These messages are valuable for detecting potential selfish mining behavior;\n+    // if multiple displacing headers are seen near simultaneously across many\n+    // nodes in the network, this might be an indication of selfish mining.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348800825",
      "id" : 1348800825,
      "line" : 3368,
      "node_id" : "PRRC_kwDOABII585QZRE5",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 3368,
      "original_position" : 74,
      "original_start_line" : 3366,
      "path" : "src/net_processing.cpp",
      "position" : 74,
      "pull_request_review_id" : 1661981480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348800825/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3366,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-06T15:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348800825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348804687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348804687"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To avoid double space between the hash and the height and between the peer id and address:\r\n\r\n```suggestion\r\n        \"Saw new %sheader%s hash=%s%s peer=%d%s\",\r\n        via_compact_block ? \"cmpctblock \" : \"\",\r\n        via_unsolicited_block ? \" via unsolicited block\" : \"\",\r\n        hash.ToString(),\r\n        height ? strprintf(\" height=%d\", height.value()) : \"\",\r\n        peer.GetId(),\r\n        fLogIPs ? strprintf(\" peeraddr=%s\", peer.addr.ToStringAddrPort()) : \"\"\r\n```",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-10-06T14:33:43Z",
      "diff_hunk" : "@@ -3345,6 +3359,33 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::LogBlockHeader(const uint256 hash, const std::optional<int> height, const CNode& peer, const bool via_compact_block, const bool via_unsolicited_block) {\n+    // To prevent log spam, this function should only be called after it was determined that a\n+    // header is both new and valid.\n+    //\n+    // These messages are valuable for detecting potential selfish mining behavior;\n+    // if multiple displacing headers are seen near simultaneously across many\n+    // nodes in the network, this might be an indication of selfish mining.\n+    // In addition it can be used to identify peers which send us a header, but\n+    // don't followup with a complete and valid (compact) block.\n+    // Having this log by default when not in IBD ensures broad availability of\n+    // this data in case investigation is merited.\n+    const auto msg = strprintf(\n+        \"Saw new %sheader%s hash=%s %s peer=%d %s\",\n+        via_compact_block ? \"cmpctblock \" : \"\",\n+        via_unsolicited_block ? \" via unsolicited block\" : \"\",\n+        hash.ToString(),\n+        height ? strprintf(\" height=%d\", height.value()) : \"\",\n+        peer.GetId(),\n+        fLogIPs ? strprintf(\" peeraddr=%s\", peer.addr.ToStringAddrPort()) : \"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348804687",
      "id" : 1348804687,
      "line" : 3380,
      "node_id" : "PRRC_kwDOABII585QZSBP",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 3380,
      "original_position" : 86,
      "original_start_line" : 3374,
      "path" : "src/net_processing.cpp",
      "position" : 86,
      "pull_request_review_id" : 1661981480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348804687/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3374,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-06T15:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348804687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348820606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348820606"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the `assert()` however is too strong. Relying on the chain described by @mzumsande above looks to fragile to me. To assert in such a way, IMO `ProcessNewBlockHeaders()` should clearly document that it will always set the pointer when it returns `true` and if it returns `false`, then the `state` is invalid. Then the code above should be changed from `if (!ProcessNewBlockHeaders...) { if (state.IsInvalid...` to maybe assert that the state is invalid or no checking the state at all.\r\n\r\nIt looks safer to me to remove `assert(pindex);` and change the condition to:\r\n\r\n```cpp\r\nif (received_new_header && pindex != nullptr) {\r\n```\r\n\r\nEdit: now I see that `assert(pindex);` existed before this PR and this PR just moves it upwards.",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-10-06T14:46:04Z",
      "diff_hunk" : "@@ -4268,8 +4295,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (received_new_header) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348820606",
      "id" : 1348820606,
      "in_reply_to_id" : 1218113430,
      "line" : 4457,
      "node_id" : "PRRC_kwDOABII585QZV5-",
      "original_commit_id" : "b857d920444241f1598b6be509796d1d8e14dbbb",
      "original_line" : 4457,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 104,
      "pull_request_review_id" : 1661981480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348820606/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T15:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348820606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348849544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348849544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In `master` this logs if `AcceptBlockHeader()` returns `true`. This PR removes the log from here and moves it to the callers.\r\n\r\nThe call chains are like this:\r\n`ProcessHeadersMessage()` -> `ProcessNewBlockHeaders()` -> `AcceptBlockHeader()` (has the log)\r\n`ProcessMessage()` -> `ProcessNewBlockHeaders()` -> `AcceptBlockHeader()` (has the log)\r\n`submitheader()` -> `ProcessNewBlockHeaders()` -> `AcceptBlockHeader()` (omits the log)\r\n`AcceptBlock()` -> `AcceptBlockHeader()` (omits the log)\r\n\r\nare the two log omissions intentional?",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-10-06T15:06:58Z",
      "diff_hunk" : "@@ -3974,23 +3974,6 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n     if (ppindex)\n         *ppindex = pindex;\n \n-    // Since this is the earliest point at which we have determined that a\n-    // header is both new and valid, log here.\n-    //\n-    // These messages are valuable for detecting potential selfish mining behavior;\n-    // if multiple displacing headers are seen near simultaneously across many\n-    // nodes in the network, this might be an indication of selfish mining. Having\n-    // this log by default when not in IBD ensures broad availability of this data\n-    // in case investigation is merited.\n-    const auto msg = strprintf(\n-        \"Saw new header hash=%s height=%d\", hash.ToString(), pindex->nHeight);\n-\n-    if (IsInitialBlockDownload()) {\n-        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Debug, \"%s\\n\", msg);\n-    } else {\n-        LogPrintf(\"%s\\n\", msg);\n-    }\n-\n     return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348849544",
      "id" : 1348849544,
      "line" : 3977,
      "node_id" : "PRRC_kwDOABII585QZc-I",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 3977,
      "original_position" : 21,
      "original_start_line" : 3988,
      "path" : "src/validation.cpp",
      "position" : 21,
      "pull_request_review_id" : 1661981480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348849544/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3988,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-10-06T15:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348849544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348858089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348858089"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In the commit message of a0edbded5f `validation: log new header from unsolicited block`: `s/only only/only/`",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-10-06T15:14:01Z",
      "diff_hunk" : "@@ -1058,6 +1064,8 @@ class PeerManagerImpl final : public PeerManager\n \n     void AddAddressKnown(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n     void PushAddress(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348858089",
      "id" : 1348858089,
      "line" : 1067,
      "node_id" : "PRRC_kwDOABII585QZfDp",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 1067,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 21,
      "pull_request_review_id" : 1661981480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348858089/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T15:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348858089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348859935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348859935"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would be nice to wrap the long lines in the commit message of 1a5b9d4a09 `validation: log which peer sent us a header` to something like 70-80 columns.",
      "commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "created_at" : "2023-10-06T15:15:12Z",
      "diff_hunk" : "@@ -944,8 +944,14 @@ class PeerManagerImpl final : public PeerManager\n         EXCLUSIVE_LOCKS_REQUIRED(!m_most_recent_block_mutex, peer.m_getdata_requests_mutex, NetEventsInterface::g_msgproc_mutex)\n         LOCKS_EXCLUDED(::cs_main);\n \n-    /** Process a new block. Perform any post-processing housekeeping */\n-    void ProcessBlock(CNode& node, const std::shared_ptr<const CBlock>& block, bool force_processing, bool min_pow_checked);\n+    /** Process a new block. Perform any post-processing housekeeping\n+     * @param[in]   node                The peer that we received the block from\n+     * @param[in]   block               The block\n+     * @param[in]   force_processing    Bypass some of our anti-DoS protections\n+     * @param[in]   min_pow_checked     The header is known to be part of a sufficiently high-work chain (anti-dos check)\n+     * @return                          True if this is a new block\n+     */\n+    bool ProcessBlock(CNode& node, const std::shared_ptr<const CBlock>& block, bool force_processing, bool min_pow_checked);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348859935",
      "id" : 1348859935,
      "line" : 954,
      "node_id" : "PRRC_kwDOABII585QZfgf",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 954,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1661981480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348859935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T15:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348859935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348940008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348940008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure if it's precisely defined anywhere, but the term is used to describe a situation where a miner intentionally doesn't broadcast their new block and instead waits for a competitor to mine at the same height, hoping that the network picks their side of the fork. When @jamesob first opened an earlier version of this PR, there were rumors of such an attack happening, but this may have been a misunderstanding based on our block connection logging.\r\nhttps://bitcoin.stackexchange.com/questions/tagged/selfish-mining",
      "commit_id" : "a460dea70a4fb1b6e82534de27b13a4a1f4f06f7",
      "created_at" : "2023-10-06T16:24:05Z",
      "diff_hunk" : "@@ -3345,6 +3359,33 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::LogBlockHeader(const uint256 hash, const std::optional<int> height, const CNode& peer, const bool via_compact_block, const bool via_unsolicited_block) {\n+    // To prevent log spam, this function should only be called after it was determined that a\n+    // header is both new and valid.\n+    //\n+    // These messages are valuable for detecting potential selfish mining behavior;\n+    // if multiple displacing headers are seen near simultaneously across many\n+    // nodes in the network, this might be an indication of selfish mining.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348940008",
      "id" : 1348940008,
      "in_reply_to_id" : 1348800825,
      "line" : 3369,
      "node_id" : "PRRC_kwDOABII585QZzDo",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 3369,
      "original_position" : 74,
      "original_start_line" : 3366,
      "path" : "src/net_processing.cpp",
      "position" : 75,
      "pull_request_review_id" : 1662246439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348940008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3367,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-06T16:24:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348940008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348961998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348961998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1a5b9d4a09478ad30a00c16ce22220a2df604308: I'd like to leave dealing with the assert to a (up for grabs) followup.",
      "commit_id" : "a460dea70a4fb1b6e82534de27b13a4a1f4f06f7",
      "created_at" : "2023-10-06T16:37:34Z",
      "diff_hunk" : "@@ -4268,8 +4295,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (received_new_header) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348961998",
      "id" : 1348961998,
      "in_reply_to_id" : 1218113430,
      "line" : 4458,
      "node_id" : "PRRC_kwDOABII585QZ4bO",
      "original_commit_id" : "b857d920444241f1598b6be509796d1d8e14dbbb",
      "original_line" : 4458,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 105,
      "pull_request_review_id" : 1662283192,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348961998/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T16:37:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348961998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348974233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348974233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "They're not intentional, but I believe it's fine:\r\n\r\n* `submitheader()` is only used for mining, for which this log isn't relevant, so it's fine to omit.\r\n* `AcceptBlock() -> AcceptBlockHeader()`: this is called in the following ways:\r\n  * in `LoadExternalBlockFile()`: not relevant for this log\r\n  * from `ProcessNewBlock()` called from:\r\n    * the kernel demo utility `bitcoin-chainstate.cpp`: not relevant\r\n    * `GenerateBlock()`: (mining / tests)\r\n    * `ProcessBlock()` in net_processing.cpp: \r\n      * when receiving `CMPCTBLOCK` and in `ProcessCompactBlockTxns()`: part of compact block processing, we've already logged the new header for that earlier\r\n* when receiving a `BLOCK` directly: handled in the third commit",
      "commit_id" : "a460dea70a4fb1b6e82534de27b13a4a1f4f06f7",
      "created_at" : "2023-10-06T16:50:21Z",
      "diff_hunk" : "@@ -3974,23 +3974,6 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n     if (ppindex)\n         *ppindex = pindex;\n \n-    // Since this is the earliest point at which we have determined that a\n-    // header is both new and valid, log here.\n-    //\n-    // These messages are valuable for detecting potential selfish mining behavior;\n-    // if multiple displacing headers are seen near simultaneously across many\n-    // nodes in the network, this might be an indication of selfish mining. Having\n-    // this log by default when not in IBD ensures broad availability of this data\n-    // in case investigation is merited.\n-    const auto msg = strprintf(\n-        \"Saw new header hash=%s height=%d\", hash.ToString(), pindex->nHeight);\n-\n-    if (IsInitialBlockDownload()) {\n-        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Debug, \"%s\\n\", msg);\n-    } else {\n-        LogPrintf(\"%s\\n\", msg);\n-    }\n-\n     return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348974233",
      "id" : 1348974233,
      "in_reply_to_id" : 1348849544,
      "line" : 3983,
      "node_id" : "PRRC_kwDOABII585QZ7aZ",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 3983,
      "original_position" : 21,
      "original_start_line" : 3988,
      "path" : "src/validation.cpp",
      "position" : 21,
      "pull_request_review_id" : 1662304088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348974233/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3994,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-10-06T16:50:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348974233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348979534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "a460dea70a4fb1b6e82534de27b13a4a1f4f06f7",
      "created_at" : "2023-10-06T16:55:23Z",
      "diff_hunk" : "@@ -1058,6 +1064,8 @@ class PeerManagerImpl final : public PeerManager\n \n     void AddAddressKnown(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n     void PushAddress(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n+\n+    void LogBlockHeader(uint256 block_hash, std::optional<int> height, const CNode& peer, const bool via_compact_block = false, const bool via_unsolicited_block = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348979534",
      "id" : 1348979534,
      "in_reply_to_id" : 1348793415,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QZ8tO",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 1068,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1662312023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979534/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T16:55:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348979623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979623"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "a460dea70a4fb1b6e82534de27b13a4a1f4f06f7",
      "created_at" : "2023-10-06T16:55:28Z",
      "diff_hunk" : "@@ -3345,6 +3359,33 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::LogBlockHeader(const uint256 hash, const std::optional<int> height, const CNode& peer, const bool via_compact_block, const bool via_unsolicited_block) {\n+    // To prevent log spam, this function should only be called after it was determined that a\n+    // header is both new and valid.\n+    //\n+    // These messages are valuable for detecting potential selfish mining behavior;\n+    // if multiple displacing headers are seen near simultaneously across many\n+    // nodes in the network, this might be an indication of selfish mining.\n+    // In addition it can be used to identify peers which send us a header, but\n+    // don't followup with a complete and valid (compact) block.\n+    // Having this log by default when not in IBD ensures broad availability of\n+    // this data in case investigation is merited.\n+    const auto msg = strprintf(\n+        \"Saw new %sheader%s hash=%s %s peer=%d %s\",\n+        via_compact_block ? \"cmpctblock \" : \"\",\n+        via_unsolicited_block ? \" via unsolicited block\" : \"\",\n+        hash.ToString(),\n+        height ? strprintf(\" height=%d\", height.value()) : \"\",\n+        peer.GetId(),\n+        fLogIPs ? strprintf(\" peeraddr=%s\", peer.addr.ToStringAddrPort()) : \"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1348979623",
      "id" : 1348979623,
      "in_reply_to_id" : 1348804687,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QZ8un",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 3381,
      "original_position" : 86,
      "original_start_line" : 3374,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1662312153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979623/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-06T16:55:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and addressed @vasild's feedback.",
      "created_at" : "2023-10-06T16:55:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1751108296",
      "id" : 1751108296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585oX8rI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1751108296/reactions"
      },
      "updated_at" : "2023-10-06T16:55:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1751108296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I get between 0 and 2 of these unsolicited blocks per day:\r\n\r\n```\r\n2023-11-07T02:19:56.507378Z Saw new header via unsolicited block hash=00000000000000000003310c8a9104bc38473171de3d2628ce608b7418384402 peer=0 peeraddr=x.x.x.x:8333\r\n```",
      "created_at" : "2023-11-07T02:25:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1797253502",
      "id" : 1797253502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585rH-l-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1797253502/reactions"
      },
      "updated_at" : "2023-11-07T02:25:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1797253502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-11-28T12:43:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1829768854",
      "id" : 1829768854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585tEA6W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829768854/reactions"
      },
      "updated_at" : "2023-11-28T12:43:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829768854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Trivial rebase after #28892's fa79a881ce0537e1d74da296a7513730438d2a02.",
      "created_at" : "2023-11-28T13:19:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1829826714",
      "id" : 1829826714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585tEPCa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829826714/reactions"
      },
      "updated_at" : "2023-11-28T13:19:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829826714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@mzumsande can you take another look?",
      "created_at" : "2023-11-28T13:20:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1829828347",
      "id" : 1829828347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585tEPb7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829828347/reactions"
      },
      "updated_at" : "2023-11-28T13:20:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829828347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1412484600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412484600"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like the first commit, but the second/third commit are not ideal, because there is a difference between a new block and a new header:\r\nI started up this branch on mainnet while being a few blocks behind (but not that far such that I'd be in IBD so that the log messages would go to `BCLog::VALIDATION`).\r\nThen, the log entries I'd get for each downloaded block (\"Saw new header via unsolicited block\") are wrong in two ways:\r\nThe header is not new (only the block), plus the block is not unsolicited (we asked for it with a `getdata` message).",
      "commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "created_at" : "2023-12-01T19:16:02Z",
      "diff_hunk" : "@@ -3369,10 +3369,11 @@ void PeerManagerImpl::LogBlockHeader(const CBlockIndex& index, const CNode& peer\n     // Having this log by default when not in IBD ensures broad availability of\n     // this data in case investigation is merited.\n     const auto msg = strprintf(\n-        \"Saw new %sheader hash=%s height=%d peer=%d%s\",\n+        \"Saw new %sheader%s hash=%s%s peer=%d%s\",\n         via_compact_block ? \"cmpctblock \" : \"\",\n-        index.GetBlockHash().ToString(),\n-        index.nHeight,\n+        via_unsolicited_block ? \" via unsolicited block\" : \"\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1412484600",
      "id" : 1412484600,
      "line" : 3374,
      "node_id" : "PRRC_kwDOABII585UMM34",
      "original_commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "original_line" : 3374,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 36,
      "pull_request_review_id" : 1760425030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412484600/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-01T19:19:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412484600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1412496288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412496288"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I looked at this independently (tracing the call chains before reading this thread), and I came to the same conclusion as Sjors, except for the case of a direct BLOCK, which has an issue that I mentioned below.",
      "commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "created_at" : "2023-12-01T19:30:00Z",
      "diff_hunk" : "@@ -3974,23 +3974,6 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n     if (ppindex)\n         *ppindex = pindex;\n \n-    // Since this is the earliest point at which we have determined that a\n-    // header is both new and valid, log here.\n-    //\n-    // These messages are valuable for detecting potential selfish mining behavior;\n-    // if multiple displacing headers are seen near simultaneously across many\n-    // nodes in the network, this might be an indication of selfish mining. Having\n-    // this log by default when not in IBD ensures broad availability of this data\n-    // in case investigation is merited.\n-    const auto msg = strprintf(\n-        \"Saw new header hash=%s height=%d\", hash.ToString(), pindex->nHeight);\n-\n-    if (IsInitialBlockDownload()) {\n-        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Debug, \"%s\\n\", msg);\n-    } else {\n-        LogPrintf(\"%s\\n\", msg);\n-    }\n-\n     return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1412496288",
      "id" : 1412496288,
      "in_reply_to_id" : 1348849544,
      "line" : 4009,
      "node_id" : "PRRC_kwDOABII585UMPug",
      "original_commit_id" : "a0edbded5f998c7efb005c8f9a8f9aba9c7bbda9",
      "original_line" : 4009,
      "original_position" : 21,
      "original_start_line" : 3988,
      "path" : "src/validation.cpp",
      "position" : 21,
      "pull_request_review_id" : 1760443730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412496288/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 4020,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-12-01T19:30:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412496288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1412504952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412504952"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That indeed sounds like two bugs, will try to  reproduce.",
      "commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "created_at" : "2023-12-01T19:41:23Z",
      "diff_hunk" : "@@ -3369,10 +3369,11 @@ void PeerManagerImpl::LogBlockHeader(const CBlockIndex& index, const CNode& peer\n     // Having this log by default when not in IBD ensures broad availability of\n     // this data in case investigation is merited.\n     const auto msg = strprintf(\n-        \"Saw new %sheader hash=%s height=%d peer=%d%s\",\n+        \"Saw new %sheader%s hash=%s%s peer=%d%s\",\n         via_compact_block ? \"cmpctblock \" : \"\",\n-        index.GetBlockHash().ToString(),\n-        index.nHeight,\n+        via_unsolicited_block ? \" via unsolicited block\" : \"\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1412504952",
      "id" : 1412504952,
      "in_reply_to_id" : 1412484600,
      "line" : 3374,
      "node_id" : "PRRC_kwDOABII585UMR14",
      "original_commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "original_line" : 3374,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 36,
      "pull_request_review_id" : 1760457462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412504952/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-01T19:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1412504952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1413831223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413831223"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I can reproduce the issue. When the nodes catches up, for a small fraction of blocks it says \"Saw new header via unsolicited block\". The header refers to a block that was already connected, sometimes more than 25 blocks ago.",
      "commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "created_at" : "2023-12-04T12:53:50Z",
      "diff_hunk" : "@@ -3369,10 +3369,11 @@ void PeerManagerImpl::LogBlockHeader(const CBlockIndex& index, const CNode& peer\n     // Having this log by default when not in IBD ensures broad availability of\n     // this data in case investigation is merited.\n     const auto msg = strprintf(\n-        \"Saw new %sheader hash=%s height=%d peer=%d%s\",\n+        \"Saw new %sheader%s hash=%s%s peer=%d%s\",\n         via_compact_block ? \"cmpctblock \" : \"\",\n-        index.GetBlockHash().ToString(),\n-        index.nHeight,\n+        via_unsolicited_block ? \" via unsolicited block\" : \"\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1413831223",
      "id" : 1413831223,
      "in_reply_to_id" : 1412484600,
      "line" : 3374,
      "node_id" : "PRRC_kwDOABII585URVo3",
      "original_commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "original_line" : 3374,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 36,
      "pull_request_review_id" : 1762333717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413831223/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T12:53:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413831223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1413916982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413916982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I solved the second issue by setting `/*via_unsolicited_block=*/!is_block_requested` (renamed `forceProcessing`). I'll push that in a bit.\r\n\r\nI'm still debugging the first issue. E.g an example log during IBD, with `-debug=net -debug=validation -loglevel=validation:debug`:\r\n\r\n```\r\n2023-12-04T13:47:10Z Synchronizing blockheaders, height: 819750 (~100.00%)\r\n2023-12-04T13:47:10Z [validation:debug] Saw new header hash=00000000000000000002d311ad8da2e7551130798984e20c87b8156c3d27d261 height=819750 peer=1\r\n2023-12-04T13:47:10Z [net] sending sendheaders (0 bytes) peer=1\r\n2023-12-04T13:47:10Z [net] Requesting block 00000000000000000000cb25399b73ca8d7233d889d6f593185d2d9d8c1c12a4 (819343) peer=1\r\n...\r\n2023-12-04T13:47:10Z [net] Requesting block 00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 (819346) peer=1\r\nâ¦\r\n2023-12-04T13:47:11Z [net] received: block (1659646 bytes) peer=1\r\n2023-12-04T13:47:11Z [net] received block 00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 peer=1\r\n2023-12-04T13:47:12Z [validation] Pre-allocating up to position 0x900000 in rev03971.dat\r\n2023-12-04T13:47:12Z [validation] BlockChecked: block hash=00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 state=Valid\r\n2023-12-04T13:47:12Z UpdateTip: new best=00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 height=819346 version=0x32000000 log2_work=94.574638 tx=928820934 date='2023-12-01T22:28:26Z' progress=0.998647 cache=153.7MiB(1297209txo)\r\n2023-12-04T13:47:12Z [validation] Enqueuing BlockConnected: block hash=00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 block height=819346\r\n2023-12-04T13:47:12Z [validation] Enqueuing UpdatedBlockTip: new block hash=00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 fork block hash=000000000000000000016a22934809aba22dda98fe8a0ee1582b43fe109aebe8 (in IBD=true)\r\n2023-12-04T13:47:12Z [validation:debug] Saw new header hash=00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 peer=1\r\nâ¦\r\n2023-12-04T13:47:12Z [validation] BlockConnected: block hash=00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 block height=819346\r\n2023-12-04T13:47:12Z [validation] UpdatedBlockTip: new block hash=00000000000000000000f2a44776f015e8d0fed852974feaa3a4fef29db93863 fork block hash=000000000000000000016a22934809aba22dda98fe8a0ee1582b43fe109aebe8 (in IBD=true)\r\n```\r\n\r\nSo we already this header from an earlier header sync, yet `ProcessBlock` returns `true` which it should only do if the header is new.\r\n\r\nWell, according to the documentation that I added myself in the second commit 386febd59bd894ad9c5216eacafe0308ed314980 anyway.",
      "commit_id" : "516b547b1bed45250763eb19119811277d474fa1",
      "created_at" : "2023-12-04T14:02:01Z",
      "diff_hunk" : "@@ -3369,10 +3369,11 @@ void PeerManagerImpl::LogBlockHeader(const CBlockIndex& index, const CNode& peer\n     // Having this log by default when not in IBD ensures broad availability of\n     // this data in case investigation is merited.\n     const auto msg = strprintf(\n-        \"Saw new %sheader hash=%s height=%d peer=%d%s\",\n+        \"Saw new %sheader%s hash=%s%s peer=%d%s\",\n         via_compact_block ? \"cmpctblock \" : \"\",\n-        index.GetBlockHash().ToString(),\n-        index.nHeight,\n+        via_unsolicited_block ? \" via unsolicited block\" : \"\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1413916982",
      "id" : 1413916982,
      "in_reply_to_id" : 1412484600,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585URqk2",
      "original_commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "original_line" : 3374,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1762473494,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413916982/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T14:04:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413916982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1413928471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413928471"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, but that documentation is ~wrong~ ambiguous. `ProcessBlock` only tells us if the _block_ is new, not if the header is new. The latter _is_ checked by `AcceptBlockHeader`, but not returned.",
      "commit_id" : "516b547b1bed45250763eb19119811277d474fa1",
      "created_at" : "2023-12-04T14:11:00Z",
      "diff_hunk" : "@@ -3369,10 +3369,11 @@ void PeerManagerImpl::LogBlockHeader(const CBlockIndex& index, const CNode& peer\n     // Having this log by default when not in IBD ensures broad availability of\n     // this data in case investigation is merited.\n     const auto msg = strprintf(\n-        \"Saw new %sheader hash=%s height=%d peer=%d%s\",\n+        \"Saw new %sheader%s hash=%s%s peer=%d%s\",\n         via_compact_block ? \"cmpctblock \" : \"\",\n-        index.GetBlockHash().ToString(),\n-        index.nHeight,\n+        via_unsolicited_block ? \" via unsolicited block\" : \"\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#discussion_r1413928471",
      "id" : 1413928471,
      "in_reply_to_id" : 1412484600,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585URtYX",
      "original_commit_id" : "708600f3b7df4cf166a2fcdfd3c0dc70b70812f0",
      "original_line" : 3374,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1762492742,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27826",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413928471/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T14:23:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413928471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Only keeping the first commit.\r\n\r\nI don't want to make this PR more complicated. If anyone wants to try detecting new headers that arrive via an unsolicited block, see the following dropped commits:  386febd59bd894ad9c5216eacafe0308ed314980 and 9d4e5afab754c34027daf6a533ae25408a5a5596.",
      "created_at" : "2023-12-04T14:24:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1838743265",
      "id" : 1838743265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585tmP7h",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1838743265/reactions"
      },
      "updated_at" : "2023-12-04T14:24:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1838743265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-10T21:11:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1885739068",
      "id" : 1885739068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585wZhg8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1885739068/reactions"
      },
      "updated_at" : "2024-01-10T21:11:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1885739068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased to use the new logging functions `LogInfo` and `LogDebug` from #28318 (see `developer-notes.md`).",
      "created_at" : "2024-01-18T09:51:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27826#issuecomment-1898145002",
      "id" : 1898145002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27826",
      "node_id" : "IC_kwDOABII585xI2Tq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1898145002/reactions"
      },
      "updated_at" : "2024-01-18T09:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1898145002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
