[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Approach ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/27827#pullrequestreview-1473530000) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#bitcoin-core/gui/700](https://github.com/bitcoin-core/gui/pull/700) (Dialog for allowing the user to choose the change output when bumping a tx by achow101)\n* [#bitcoin-core/gui/650](https://github.com/bitcoin-core/gui/pull/650) (Add Import to Wallet GUI by KolbyML)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27601](https://github.com/bitcoin/bitcoin/pull/27601) (wallet: don't duplicate change output if already exist by furszy)\n* [#27479](https://github.com/bitcoin/bitcoin/pull/27479) (BIP324: ElligatorSwift integrations by sipa)\n* [#27351](https://github.com/bitcoin/bitcoin/pull/27351) (wallet: add `seeds` argument to `importdescriptors` by apoelstra)\n* [#27307](https://github.com/bitcoin/bitcoin/pull/27307) (wallet: track mempool conflicts with wallet transactions by ishaanam)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#27101](https://github.com/bitcoin/bitcoin/pull/27101) (Support JSON-RPC 2.0 when requested by client by pinheadmz)\n* [#26840](https://github.com/bitcoin/bitcoin/pull/26840) (refactor: importpubkey, importprivkey, importaddress, importmulti, and importdescriptors rpc by KolbyML)\n* [#26728](https://github.com/bitcoin/bitcoin/pull/26728) (wallet: Have the wallet store the key for automatically generated descriptors by achow101)\n* [#26467](https://github.com/bitcoin/bitcoin/pull/26467) (bumpfee: Allow the user to choose which output is change by achow101)\n* [#26008](https://github.com/bitcoin/bitcoin/pull/26008) (wallet: cache IsMine scriptPubKeys to improve performance of descriptor wallets by achow101)\n* [#25979](https://github.com/bitcoin/bitcoin/pull/25979) ([WIP] wallet: standardize change output detection process by furszy)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#25273](https://github.com/bitcoin/bitcoin/pull/25273) (wallet: Pass through transaction locktime and preset input sequences and scripts to CreateTransaction by achow101)\n* [#24128](https://github.com/bitcoin/bitcoin/pull/24128) (wallet: BIP 326 sequence based anti-fee-snipe for taproot inputs by MarcoFalke)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n* [#22341](https://github.com/bitcoin/bitcoin/pull/22341) (rpc: add getxpub by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-06-05T12:12:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27827#issuecomment-1576673424",
      "id" : 1576673424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27827",
      "node_id" : "IC_kwDOABII585d-iCQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576673424/reactions"
      },
      "updated_at" : "2023-06-22T00:03:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576673424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27827#discussion_r1225654137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27827"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225654137"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These comments can be removed.\r\n```suggestion\r\n```",
      "commit_id" : "b1ce82495f66df63aa61c20e2f2757cf293ade69",
      "created_at" : "2023-06-11T00:30:45Z",
      "diff_hunk" : "@@ -0,0 +1,214 @@\n+#include <test/util/setup_common.h>\n+#include <silentpayment.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+namespace wallet {\n+BOOST_FIXTURE_TEST_SUITE(silentpayment_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(silent_addresses)\n+{\n+    auto txid1 = uint256S(\"0x00000000000002dc756eebf4f49723ed8d30cc28a5f108eb94b1ba88ac4f9c22\");\n+    uint32_t vout1 = 4;\n+\n+    auto txid2 = uint256S(\"0x000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\");\n+    uint32_t vout2 = 7;\n+\n+    std::vector<COutPoint> tx_outpoints;\n+    tx_outpoints.emplace_back(txid1, vout1);\n+    tx_outpoints.emplace_back(txid2, vout2);\n+\n+    std::vector<std::tuple<CKey, bool>> sender_secret_keys;\n+    std::vector<CPubKey> sender_pub_keys;\n+    std::vector<XOnlyPubKey> sender_x_only_pub_keys;\n+\n+    // non-taproot inputs\n+    for(size_t i =0; i < 34; i++) {\n+        CKey senderkey;\n+        senderkey.MakeNewKey(true);\n+        CPubKey senderPubkey = senderkey.GetPubKey();\n+\n+        sender_secret_keys.emplace_back(senderkey, false);\n+        sender_pub_keys.emplace_back(senderPubkey);\n+    }\n+\n+    // taproot inputs\n+    for(size_t i =0; i < 45; i++) {\n+        CKey senderkey;\n+        senderkey.MakeNewKey(true);\n+        CPubKey sender_pubkey = senderkey.GetPubKey();\n+        if (sender_pubkey.data()[0] == 3) {\n+            senderkey.Negate();\n+        }\n+        sender_secret_keys.emplace_back(senderkey, true);\n+        sender_pub_keys.emplace_back(senderkey.GetPubKey());\n+    }\n+\n+    CKey recipient_spend_seckey;\n+    recipient_spend_seckey.MakeNewKey(true);\n+\n+    auto silent_recipient = silentpayment::Recipient(recipient_spend_seckey);\n+\n+    CPubKey combined_tx_pubkeys{CPubKey::Combine(sender_pub_keys)};\n+\n+    silent_recipient.SetSenderPublicKey(combined_tx_pubkeys, tx_outpoints);\n+\n+    const auto&[recipient_scan_pubkey, recipient_spend_pubkey]{silent_recipient.GetAddress()};\n+\n+    silentpayment::Sender silent_sender{\n+        sender_secret_keys,\n+        tx_outpoints,\n+        recipient_scan_pubkey\n+    };\n+\n+    XOnlyPubKey sender_tweaked_pubkey = silent_sender.Tweak(recipient_spend_pubkey, 0);\n+    const auto [recipient_priv_key, recipient_pub_key] = silent_recipient.Tweak(0);\n+\n+    BOOST_CHECK(XOnlyPubKey{recipient_priv_key.GetPubKey()} == recipient_pub_key);\n+    BOOST_CHECK(sender_tweaked_pubkey == recipient_pub_key);\n+\n+}\n+\n+class TestRecipient: public silentpayment::Recipient {\n+    public:\n+        TestRecipient(const CKey& spend_seckey) : Recipient(spend_seckey) {}\n+        CKey GetNegatedScanSecKey() { return m_negated_scan_seckey; }\n+        XOnlyPubKey GetScanPubkey() { return m_scan_pubkey; }\n+        uint256 GetSharedSecret() {\n+            uint256 result;\n+            CSHA256().Write(m_ecdh_pubkey.begin(), 33).Finalize(result.begin());\n+            return result;\n+        }\n+};\n+\n+class TestSender: public silentpayment::Sender {\n+    public:\n+        TestSender(const std::vector<std::tuple<CKey, bool>>& sender_secret_keys, const std::vector<COutPoint>& tx_outpoints, const XOnlyPubKey& recipient_scan_xonly_pubkey) :\n+            Sender(sender_secret_keys, tx_outpoints, recipient_scan_xonly_pubkey) {}\n+        uint256 GetSharedSecret() {\n+            uint256 result;\n+            CSHA256().Write(m_ecdh_pubkey.begin(), 33).Finalize(result.begin());\n+            return result;\n+    }\n+};\n+\n+BOOST_AUTO_TEST_CASE(silent_addresses2)\n+{\n+    std::vector<std::tuple<CKey, bool>> sender_secret_keys;\n+    std::vector<CPubKey> sender_pub_keys;\n+\n+    const std::vector<std::pair<std::string, bool>> sender_keys = {\n+        {\"KxeDWuvKtXfBxLGmP6ZT4crvbamCnicJg2xgkgESSLURYyr6kVvu\", false},\n+        {\"L3nddfqwDWmAeskCjWwLnnF5ZFt1BZXFxNav92eA3sS7kKbh3nT3\", false},\n+        {\"KyAWmQjXmkNL8xFaFc3Kp4S4SJSqYmGfvdePvuGwpsb7YyWAW5wS\", true},\n+        {\"KzrGQWApg8wpX4pCQM1chMrJhgSfzmwS8fZLfUDujA73sJNgreeF\", true},\n+    };\n+\n+    for (const auto& [wif, is_taproot]: sender_keys) {\n+        CKey senderkey = DecodeSecret(wif);\n+\n+        if (is_taproot) {\n+            CPubKey pubkey = senderkey.GetPubKey();\n+            if (pubkey.data()[0] == 3) {\n+                senderkey.Negate();\n+            }\n+            sender_secret_keys.emplace_back(senderkey, is_taproot);\n+            sender_pub_keys.emplace_back(senderkey.GetPubKey());\n+        } else {\n+            sender_secret_keys.emplace_back(senderkey, is_taproot);\n+            sender_pub_keys.emplace_back(senderkey.GetPubKey());\n+        }\n+    }\n+\n+    CKey recipient_spend_seckey = DecodeSecret(\"L4mGgWaqFknPASp5cwrAbqhEcLuHqDMzm4UjJyAo1A7f85XPiGVU\");\n+\n+    auto silent_recipient = TestRecipient(recipient_spend_seckey);\n+\n+    BOOST_CHECK(EncodeSecret(silent_recipient.GetNegatedScanSecKey()) == \"L2HBwB2tkUdGeb2KWx2EaUWD1YjW8u4eZ7uXJfJA8u3ibkrPtvh5\");\n+    BOOST_CHECK(HexStr(silent_recipient.GetScanPubkey()) == \"bfa2fb9b2d094a039d4b5bf76a159d028f15a8350d5c957651d6dc00af4ccf41\");\n+\n+    // const std::vector<std::pair<std::string, std::string>> spend_keys = {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27827#discussion_r1225654137",
      "id" : 1225654137,
      "line" : 130,
      "node_id" : "PRRC_kwDOABII585JDf95",
      "original_commit_id" : "b1ce82495f66df63aa61c20e2f2757cf293ade69",
      "original_line" : 130,
      "original_position" : 130,
      "original_start_line" : null,
      "path" : "src/wallet/test/silentpayment_tests.cpp",
      "position" : 130,
      "pull_request_review_id" : 1473530000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27827",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225654137/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T00:35:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225654137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27827#discussion_r1225654181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27827"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225654181"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These comments can be removed.\r\n\r\n```suggestion\r\n```",
      "commit_id" : "b1ce82495f66df63aa61c20e2f2757cf293ade69",
      "created_at" : "2023-06-11T00:31:11Z",
      "diff_hunk" : "@@ -0,0 +1,214 @@\n+#include <test/util/setup_common.h>\n+#include <silentpayment.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+namespace wallet {\n+BOOST_FIXTURE_TEST_SUITE(silentpayment_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(silent_addresses)\n+{\n+    auto txid1 = uint256S(\"0x00000000000002dc756eebf4f49723ed8d30cc28a5f108eb94b1ba88ac4f9c22\");\n+    uint32_t vout1 = 4;\n+\n+    auto txid2 = uint256S(\"0x000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\");\n+    uint32_t vout2 = 7;\n+\n+    std::vector<COutPoint> tx_outpoints;\n+    tx_outpoints.emplace_back(txid1, vout1);\n+    tx_outpoints.emplace_back(txid2, vout2);\n+\n+    std::vector<std::tuple<CKey, bool>> sender_secret_keys;\n+    std::vector<CPubKey> sender_pub_keys;\n+    std::vector<XOnlyPubKey> sender_x_only_pub_keys;\n+\n+    // non-taproot inputs\n+    for(size_t i =0; i < 34; i++) {\n+        CKey senderkey;\n+        senderkey.MakeNewKey(true);\n+        CPubKey senderPubkey = senderkey.GetPubKey();\n+\n+        sender_secret_keys.emplace_back(senderkey, false);\n+        sender_pub_keys.emplace_back(senderPubkey);\n+    }\n+\n+    // taproot inputs\n+    for(size_t i =0; i < 45; i++) {\n+        CKey senderkey;\n+        senderkey.MakeNewKey(true);\n+        CPubKey sender_pubkey = senderkey.GetPubKey();\n+        if (sender_pubkey.data()[0] == 3) {\n+            senderkey.Negate();\n+        }\n+        sender_secret_keys.emplace_back(senderkey, true);\n+        sender_pub_keys.emplace_back(senderkey.GetPubKey());\n+    }\n+\n+    CKey recipient_spend_seckey;\n+    recipient_spend_seckey.MakeNewKey(true);\n+\n+    auto silent_recipient = silentpayment::Recipient(recipient_spend_seckey);\n+\n+    CPubKey combined_tx_pubkeys{CPubKey::Combine(sender_pub_keys)};\n+\n+    silent_recipient.SetSenderPublicKey(combined_tx_pubkeys, tx_outpoints);\n+\n+    const auto&[recipient_scan_pubkey, recipient_spend_pubkey]{silent_recipient.GetAddress()};\n+\n+    silentpayment::Sender silent_sender{\n+        sender_secret_keys,\n+        tx_outpoints,\n+        recipient_scan_pubkey\n+    };\n+\n+    XOnlyPubKey sender_tweaked_pubkey = silent_sender.Tweak(recipient_spend_pubkey, 0);\n+    const auto [recipient_priv_key, recipient_pub_key] = silent_recipient.Tweak(0);\n+\n+    BOOST_CHECK(XOnlyPubKey{recipient_priv_key.GetPubKey()} == recipient_pub_key);\n+    BOOST_CHECK(sender_tweaked_pubkey == recipient_pub_key);\n+\n+}\n+\n+class TestRecipient: public silentpayment::Recipient {\n+    public:\n+        TestRecipient(const CKey& spend_seckey) : Recipient(spend_seckey) {}\n+        CKey GetNegatedScanSecKey() { return m_negated_scan_seckey; }\n+        XOnlyPubKey GetScanPubkey() { return m_scan_pubkey; }\n+        uint256 GetSharedSecret() {\n+            uint256 result;\n+            CSHA256().Write(m_ecdh_pubkey.begin(), 33).Finalize(result.begin());\n+            return result;\n+        }\n+};\n+\n+class TestSender: public silentpayment::Sender {\n+    public:\n+        TestSender(const std::vector<std::tuple<CKey, bool>>& sender_secret_keys, const std::vector<COutPoint>& tx_outpoints, const XOnlyPubKey& recipient_scan_xonly_pubkey) :\n+            Sender(sender_secret_keys, tx_outpoints, recipient_scan_xonly_pubkey) {}\n+        uint256 GetSharedSecret() {\n+            uint256 result;\n+            CSHA256().Write(m_ecdh_pubkey.begin(), 33).Finalize(result.begin());\n+            return result;\n+    }\n+};\n+\n+BOOST_AUTO_TEST_CASE(silent_addresses2)\n+{\n+    std::vector<std::tuple<CKey, bool>> sender_secret_keys;\n+    std::vector<CPubKey> sender_pub_keys;\n+\n+    const std::vector<std::pair<std::string, bool>> sender_keys = {\n+        {\"KxeDWuvKtXfBxLGmP6ZT4crvbamCnicJg2xgkgESSLURYyr6kVvu\", false},\n+        {\"L3nddfqwDWmAeskCjWwLnnF5ZFt1BZXFxNav92eA3sS7kKbh3nT3\", false},\n+        {\"KyAWmQjXmkNL8xFaFc3Kp4S4SJSqYmGfvdePvuGwpsb7YyWAW5wS\", true},\n+        {\"KzrGQWApg8wpX4pCQM1chMrJhgSfzmwS8fZLfUDujA73sJNgreeF\", true},\n+    };\n+\n+    for (const auto& [wif, is_taproot]: sender_keys) {\n+        CKey senderkey = DecodeSecret(wif);\n+\n+        if (is_taproot) {\n+            CPubKey pubkey = senderkey.GetPubKey();\n+            if (pubkey.data()[0] == 3) {\n+                senderkey.Negate();\n+            }\n+            sender_secret_keys.emplace_back(senderkey, is_taproot);\n+            sender_pub_keys.emplace_back(senderkey.GetPubKey());\n+        } else {\n+            sender_secret_keys.emplace_back(senderkey, is_taproot);\n+            sender_pub_keys.emplace_back(senderkey.GetPubKey());\n+        }\n+    }\n+\n+    CKey recipient_spend_seckey = DecodeSecret(\"L4mGgWaqFknPASp5cwrAbqhEcLuHqDMzm4UjJyAo1A7f85XPiGVU\");\n+\n+    auto silent_recipient = TestRecipient(recipient_spend_seckey);\n+\n+    BOOST_CHECK(EncodeSecret(silent_recipient.GetNegatedScanSecKey()) == \"L2HBwB2tkUdGeb2KWx2EaUWD1YjW8u4eZ7uXJfJA8u3ibkrPtvh5\");\n+    BOOST_CHECK(HexStr(silent_recipient.GetScanPubkey()) == \"bfa2fb9b2d094a039d4b5bf76a159d028f15a8350d5c957651d6dc00af4ccf41\");\n+\n+    // const std::vector<std::pair<std::string, std::string>> spend_keys = {\n+    //     {\"KxFnFy2MjkfxGYbLWXbLztcbM5T5qQnaRaWcnCT9fySCB8XXVfRw\",\"aef5a67267768f18f8efc327ca7add15d2bb9fcd6b6f4911424565eb6db0ae63\"},\n+    //     {\"L4jKwLMPDuMhwJzVv3GYbtNdqRng7Zf9tGqfCj277ATejavame9C\",\"3246572723b9aa4c601f2b5a277e9af81b61ca53de8ad88eedfb563dec8c2fce\"},\n+    //     {\"KxKfkKVFoTXJipEVvLkazoFntugKGiCGB9nkzgkXTxkCx7nbQ9p4\",\"c2ece65cae45f7475f99a911754189ac2aa999eba8691eab3adb51d711f73cd2\"},\n+    //     {\"L4fSSytVACWMV3MLWE7JbyjSHbZSgGFU8hZWzEijKB9dxbeSUA6b\",\"8bc5214b98ad9491ba96b0c2dbb1b9ebf45849e599ac143e487246d783da56e9\"},\n+    //     {\"L4dVhof38M5gFuXkoKXgc2QqWgSpxcYdFuvSsza3RBVda73d52bA\",\"c1547a55f2f4fd3bd7dbc94ba751bc0b6108be7ff0b6b995826db2dd0aebddba\"},\n+    // };\n+\n+    // size_t idx = 0;\n+    // for(const auto& [spend_seckey, spend_pubkey]: silent_recipient.GetSpendKeys()) {\n+\n+    //     const auto& [seckey, pubkey] = spend_keys.at(idx++);\n+\n+    //     BOOST_CHECK(EncodeSecret(spend_seckey) == seckey);\n+    //     BOOST_CHECK(HexStr(spend_pubkey) == pubkey);\n+    // }\n+\n+    CPubKey combined_tx_pubkeys{CPubKey::Combine(sender_pub_keys)};\n+\n+    BOOST_CHECK(HexStr(combined_tx_pubkeys) == \"031ea6a65ac33fd26dd296299dbce0b40b8105af395c68655bc303a943f0f75025\");\n+\n+    auto txid1 = uint256S(\"0x00000000000002dc756eebf4f49723ed8d30cc28a5f108eb94b1ba88ac4f9c22\");\n+    uint32_t vout1 = 4;\n+\n+    auto txid2 = uint256S(\"0x000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\");\n+    uint32_t vout2 = 7;\n+\n+    std::vector<COutPoint> tx_outpoints;\n+    tx_outpoints.emplace_back(txid1, vout1);\n+    tx_outpoints.emplace_back(txid2, vout2);\n+\n+    const auto& outpoint_hash = silentpayment::HashOutpoints(tx_outpoints);\n+    BOOST_CHECK(HexStr(outpoint_hash) == \"cdbf4c1642577a5b2f93c5b1998a5cc0fc217f9d544aa1f0ce3d42335bca9cbd\");\n+\n+    silent_recipient.SetSenderPublicKey(combined_tx_pubkeys, tx_outpoints);\n+\n+    auto _recipient_shared_secret = silent_recipient.GetSharedSecret();\n+\n+    CKey recipient_shared_secret;\n+    recipient_shared_secret.Set(std::begin(_recipient_shared_secret), std::end(_recipient_shared_secret), true);\n+    BOOST_CHECK(EncodeSecret(recipient_shared_secret) == \"L1Y7W8yy6ZxHt4eaUM2ZVw2SZGEjCcQfHCmJ2WHEUsWtTKffvfyy\");\n+\n+    const auto&[recipient_scan_pubkey, recipient_spend_pubkey]{silent_recipient.GetAddress()};\n+\n+    TestSender silent_sender{\n+        sender_secret_keys,\n+        tx_outpoints,\n+        recipient_scan_pubkey\n+    };\n+\n+    auto _silent_shared_secret = silent_sender.GetSharedSecret();\n+\n+    CKey silent_shared_secret;\n+    silent_shared_secret.Set(std::begin(_silent_shared_secret), std::end(_silent_shared_secret), true);\n+\n+    BOOST_CHECK(recipient_shared_secret == silent_shared_secret);\n+\n+    // const std::vector<std::pair<std::string, std::string>> results = {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27827#discussion_r1225654181",
      "id" : 1225654181,
      "line" : 187,
      "node_id" : "PRRC_kwDOABII585JDf-l",
      "original_commit_id" : "b1ce82495f66df63aa61c20e2f2757cf293ade69",
      "original_line" : 187,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/wallet/test/silentpayment_tests.cpp",
      "position" : 187,
      "pull_request_review_id" : 1473530000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27827",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225654181/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T00:35:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225654181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Adds support to the Bitcoin Core wallet for receiving silent payments\r\n\r\nPrefer to leave this for a second PR",
      "created_at" : "2023-06-24T02:02:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27827#issuecomment-1605232308",
      "id" : 1605232308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27827",
      "node_id" : "IC_kwDOABII585frea0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605232308/reactions"
      },
      "updated_at" : "2023-06-24T02:02:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605232308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-26T23:00:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27827#issuecomment-1608431241",
      "id" : 1608431241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27827",
      "node_id" : "IC_kwDOABII585f3raJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608431241/reactions"
      },
      "updated_at" : "2023-06-26T23:00:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608431241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Adds support to the Bitcoin Core wallet for receiving silent payments\r\n> \r\n> Prefer to leave this for a second PR\r\n\r\nCan you explain your reasoning for wanting to split it up? I'd prefer to keep them together only because I see no reason to merge sending without receiving support in Bitcoin Core. In terms of work, if the goal is to merge both sending and receiving support, the amount of review doesn't change, and splitting into two PRs seems like unnecessary shuffling of commits",
      "created_at" : "2023-07-06T12:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27827#issuecomment-1623602185",
      "id" : 1623602185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27827",
      "node_id" : "IC_kwDOABII585gxjQJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623602185/reactions"
      },
      "updated_at" : "2023-07-06T12:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623602185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   }
]
