[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27845).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1729241104) |\n| Concept ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/27845#pullrequestreview-1676768777) |\n| Stale ACK | [jamesob](https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1613314386) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-06-09T16:49:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1584880508",
      "id" : 1584880508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585ed1t8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584880508/reactions"
      },
      "updated_at" : "2023-10-13T17:09:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584880508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for working on this! crACK",
      "created_at" : "2023-06-09T17:09:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1584900789",
      "id" : 1584900789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585ed6q1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584900789/reactions"
      },
      "updated_at" : "2023-06-09T17:09:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584900789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I see you've got some lint failures in CI; you can run linters (faithfully) locally using the container added here: https://github.com/bitcoin/bitcoin/pull/26906/files",
      "created_at" : "2023-06-09T17:11:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1584903028",
      "id" : 1584903028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585ed7N0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584903028/reactions"
      },
      "updated_at" : "2023-06-09T17:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584903028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/27845/commits/39aa958b2049bc50819d645052c0b90cf19f306e\r\n\r\nBut I think you can just squash these two commits down into one.",
      "created_at" : "2023-06-29T14:46:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1613314386",
      "id" : 1613314386,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585gKTlS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1613314386/reactions"
      },
      "updated_at" : "2023-06-29T14:46:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1613314386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Lightly tested ACK 10d9bef0045398641fc723bd73b55ab9c512dac1",
      "created_at" : "2023-09-21T09:53:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1729241104",
      "id" : 1729241104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585nEiAQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729241104/reactions"
      },
      "updated_at" : "2023-09-21T09:53:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729241104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27845#discussion_r1358430645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358430645"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This feature is valuable because it allows users to prevent resource-intensive tasks when they are unnecessary.",
      "commit_id" : "10d9bef0045398641fc723bd73b55ab9c512dac1",
      "created_at" : "2023-10-13T15:41:46Z",
      "diff_hunk" : "@@ -26,9 +26,24 @@ OUTPUT_PATH=\"${1}\"; shift;\n # Most of the calls we make take a while to run, so pad with a lengthy timeout.\n BITCOIN_CLI_CALL=\"${*} -rpcclienttimeout=9999999\"\n \n+# Early exit if file at OUTPUT_PATH already exists\n+if [[ -f \"$OUTPUT_PATH\" ]]; then\n+  (>&2 echo \"$OUTPUT_PATH already exists.\")\n+  exit\n+fi\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#discussion_r1358430645",
      "id" : 1358430645,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII585Q-AG1",
      "original_commit_id" : "10d9bef0045398641fc723bd73b55ab9c512dac1",
      "original_line" : 34,
      "original_position" : 9,
      "original_start_line" : 29,
      "path" : "contrib/devtools/utxo_snapshot.sh",
      "position" : 9,
      "pull_request_review_id" : 1676768777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358430645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 29,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-13T17:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358430645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27845#discussion_r1358503093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358503093"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since we have [`set -ueo pipefail`](https://explainshell.com/explain?cmd=set+-euo+pipefail) at the top, that line enables strict error handling, and the script will exit if any command returns a non-zero status (indicating an error). So I think that a better approach would be to `trap` the `EXIT` (and a `trap INT` for e user interruption - `Ctrl-C`) and call a `cleanup` function which will be triggered when the script exits for any reason, including both successful runs and errors. That way also we don't have to remove the `trap` at the end and even have the call to `reconsiderblock` there because will be in the `cleanup` function.\r\n<details>\r\n<summary>Please check an example here...</summary>\r\n\r\n```diff\r\ndiff --git a/contrib/devtools/utxo_snapshot.sh b/contrib/devtools/utxo_snapshot.sh\r\nindex dee25ff67..0ec555cc8 100755\r\n--- a/contrib/devtools/utxo_snapshot.sh\r\n+++ b/contrib/devtools/utxo_snapshot.sh\r\n@@ -26,6 +26,21 @@ OUTPUT_PATH=\"${1}\"; shift;\r\n # Most of the calls we make take a while to run, so pad with a lengthy timeout.\r\n BITCOIN_CLI_CALL=\"${*} -rpcclienttimeout=9999999\"\r\n \r\n+function cleanup {\r\n+  (>&2 echo \"Restoring chain to original height; this may take a while\")\r\n+  ${BITCOIN_CLI_CALL} reconsiderblock \"${PIVOT_BLOCKHASH}\"\r\n+}\r\n+\r\n+function early_exit {\r\n+  (>&2 echo \"Exiting due to Ctrl-C\")\r\n+  cleanup\r\n+  exit 1\r\n+}\r\n+\r\n+# Trap for normal exit and Ctrl-C\r\n+trap cleanup EXIT\r\n+trap early_exit INT\r\n+\r\n # Block we'll invalidate/reconsider to rewind/fast-forward the chain.\r\n PIVOT_BLOCKHASH=$($BITCOIN_CLI_CALL getblockhash $(( GENERATE_AT_HEIGHT + 1 )) )\r\n \r\n@@ -39,6 +54,3 @@ else\r\n   (>&2 echo \"Generating UTXO snapshot...\")\r\n   ${BITCOIN_CLI_CALL} dumptxoutset \"${OUTPUT_PATH}\"\r\n fi\r\n-\r\n-(>&2 echo \"Restoring chain to original height; this may take a while\")\r\n-${BITCOIN_CLI_CALL} reconsiderblock \"${PIVOT_BLOCKHASH}\"\r\n```\r\n</details>\r\n\r\n",
      "commit_id" : "10d9bef0045398641fc723bd73b55ab9c512dac1",
      "created_at" : "2023-10-13T16:45:06Z",
      "diff_hunk" : "@@ -26,9 +26,24 @@ OUTPUT_PATH=\"${1}\"; shift;\n # Most of the calls we make take a while to run, so pad with a lengthy timeout.\n BITCOIN_CLI_CALL=\"${*} -rpcclienttimeout=9999999\"\n \n+# Early exit if file at OUTPUT_PATH already exists\n+if [[ -f \"$OUTPUT_PATH\" ]]; then\n+  (>&2 echo \"$OUTPUT_PATH already exists.\")\n+  exit\n+fi\n+\n # Block we'll invalidate/reconsider to rewind/fast-forward the chain.\n PIVOT_BLOCKHASH=$($BITCOIN_CLI_CALL getblockhash $(( GENERATE_AT_HEIGHT + 1 )) )\n \n+# Trap any errors that occur\n+trap 'err_handler $?' ERR\n+\n+err_handler() {\n+  (>&2 echo \"Restoring chain to original height; this may take a while\")\n+  ${BITCOIN_CLI_CALL} reconsiderblock \"${PIVOT_BLOCKHASH}\"\n+  exit \"$1\"\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#discussion_r1358503093",
      "id" : 1358503093,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII585Q-Ry1",
      "original_commit_id" : "10d9bef0045398641fc723bd73b55ab9c512dac1",
      "original_line" : 46,
      "original_position" : 21,
      "original_start_line" : 38,
      "path" : "contrib/devtools/utxo_snapshot.sh",
      "position" : 21,
      "pull_request_review_id" : 1676768777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358503093/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 38,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-13T17:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358503093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27845#discussion_r1358514658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358514658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this can be done on a follow-up but since we are here perhaps we can include a suggestion from @Sjors made a couple of years ago ([here](https://github.com/bitcoin/bitcoin/pull/16899#discussion_r342735815) and [here](https://github.com/bitcoin/bitcoin/pull/16899#issuecomment-536520911)) about disabling network activity during the process. In the following example I made it optional for the users to decide whether or not they wish it.\r\n\r\n<details>\r\n<summary>Please check the example mentioned above here...</summary>\r\n\r\n```diff\r\ndiff --git a/contrib/devtools/utxo_snapshot.sh b/contrib/devtools/utxo_snapshot.sh\r\nindex 0ec555cc8..2bf2d9cd5 100755\r\n--- a/contrib/devtools/utxo_snapshot.sh\r\n+++ b/contrib/devtools/utxo_snapshot.sh\r\n@@ -8,6 +8,8 @@ export LC_ALL=C\r\n \r\n set -ueo pipefail\r\n \r\n+NETWORK_DISABLED=false\r\n+\r\n if (( $# < 3 )); then\r\n   echo 'Usage: utxo_snapshot.sh <generate-at-height> <snapshot-out-path> <bitcoin-cli-call ...>'\r\n   echo\r\n@@ -29,6 +31,11 @@ BITCOIN_CLI_CALL=\"${*} -rpcclienttimeout=9999999\"\r\n function cleanup {\r\n   (>&2 echo \"Restoring chain to original height; this may take a while\")\r\n   ${BITCOIN_CLI_CALL} reconsiderblock \"${PIVOT_BLOCKHASH}\"\r\n+\r\n+  if $DISABLE_NETWORK; then\r\n+    (>&2 echo \"Restoring network activity\")\r\n+    ${BITCOIN_CLI_CALL} setnetworkactive true\r\n+  fi\r\n }\r\n \r\n function early_exit {\r\n@@ -41,6 +48,17 @@ function early_exit {\r\n trap cleanup EXIT\r\n trap early_exit INT\r\n \r\n+# Prompt the user to disable network activity\r\n+read -p \"Do you want to disable network activity (setnetworkactive false) before running invalidateblock? (Y/n): \" -r\r\n+if [[ \"$REPLY\" =~ ^[Yy]*$ || -z \"$REPLY\" ]]; then\r\n+  # User input is \"Y\", \"y\", or Enter key, proceed with the action\r\n+  NETWORK_DISABLED=true\r\n+  (>&2 echo \"Disabling network activity\")\r\n+  ${BITCOIN_CLI_CALL} setnetworkactive false\r\n+else\r\n+  (>&2 echo \"Network activity remains enabled\")\r\n+fi\r\n+\r\n # Block we'll invalidate/reconsider to rewind/fast-forward the chain.\r\n PIVOT_BLOCKHASH=$($BITCOIN_CLI_CALL getblockhash $(( GENERATE_AT_HEIGHT + 1 )) )\r\n```\r\n</details>",
      "commit_id" : "10d9bef0045398641fc723bd73b55ab9c512dac1",
      "created_at" : "2023-10-13T16:58:45Z",
      "diff_hunk" : "@@ -26,9 +26,24 @@ OUTPUT_PATH=\"${1}\"; shift;\n # Most of the calls we make take a while to run, so pad with a lengthy timeout.\n BITCOIN_CLI_CALL=\"${*} -rpcclienttimeout=9999999\"\n \n+# Early exit if file at OUTPUT_PATH already exists\n+if [[ -f \"$OUTPUT_PATH\" ]]; then\n+  (>&2 echo \"$OUTPUT_PATH already exists.\")\n+  exit\n+fi\n+\n # Block we'll invalidate/reconsider to rewind/fast-forward the chain.\n PIVOT_BLOCKHASH=$($BITCOIN_CLI_CALL getblockhash $(( GENERATE_AT_HEIGHT + 1 )) )\n \n+# Trap any errors that occur\n+trap 'err_handler $?' ERR\n+\n+err_handler() {\n+  (>&2 echo \"Restoring chain to original height; this may take a while\")\n+  ${BITCOIN_CLI_CALL} reconsiderblock \"${PIVOT_BLOCKHASH}\"\n+  exit \"$1\"\n+}\n+\n (>&2 echo \"Rewinding chain back to height ${GENERATE_AT_HEIGHT} (by invalidating ${PIVOT_BLOCKHASH}); this may take a while\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#discussion_r1358514658",
      "id" : 1358514658,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII585Q-Uni",
      "original_commit_id" : "10d9bef0045398641fc723bd73b55ab9c512dac1",
      "original_line" : 47,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "contrib/devtools/utxo_snapshot.sh",
      "position" : 22,
      "pull_request_review_id" : 1676768777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358514658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-13T17:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358514658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@hazeycode, are you still interested in continuing to work on this PR? Please let me know, otherwise I'll pick it up.\r\n\r\nBtw, there's also another [suggestion](https://github.com/bitcoin/bitcoin/pull/28553#issuecomment-1804941396) from @Sjors to improve the script with another validation that might be needed.",
      "created_at" : "2023-11-10T13:11:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1805703495",
      "id" : 1805703495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585roNlH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805703495/reactions"
      },
      "updated_at" : "2023-11-10T13:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805703495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Sorry for the delayed response @pablomartin4btc. Thanks for looking at this. Unfortunately, I don't have a time to work on this further at the moment, so feel free to take baton.",
      "created_at" : "2023-11-10T14:06:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1805800276",
      "id" : 1805800276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585rolNU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805800276/reactions"
      },
      "updated_at" : "2023-11-10T14:06:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805800276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22148308?v=4",
         "events_url" : "https://api.github.com/users/hazeycode/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hazeycode/followers",
         "following_url" : "https://api.github.com/users/hazeycode/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hazeycode/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hazeycode",
         "id" : 22148308,
         "login" : "hazeycode",
         "node_id" : "MDQ6VXNlcjIyMTQ4MzA4",
         "organizations_url" : "https://api.github.com/users/hazeycode/orgs",
         "received_events_url" : "https://api.github.com/users/hazeycode/received_events",
         "repos_url" : "https://api.github.com/users/hazeycode/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hazeycode/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hazeycode/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hazeycode"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Sorry for the delayed response @pablomartin4btc. Thanks for looking at this. Unfortunately, I don't have a time to work on this further at the moment, so feel free to take baton.\r\n\r\nThanks @hazeycode, no worries, please close this PR, I'll create a new one and will add you as a co-author in the commit. Cheers!",
      "created_at" : "2023-11-10T14:20:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845#issuecomment-1805827248",
      "id" : 1805827248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
      "node_id" : "IC_kwDOABII585roryw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805827248/reactions"
      },
      "updated_at" : "2023-11-10T14:20:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805827248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   }
]
