{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "There are 2 parts to this patchset, both concern the operation of `./contrib/devtools/utxo_snapshot.sh`:\r\n1. Errors handling is added so that the chainstate is automatically recovered if an error occurs\r\n2. Check if a file at OUTPUT_PATH already exists and early exit\r\n\r\nThe easiest way to test this is to take only the 1st commit and follow these steps:\r\n1. Create a dummy file for the purpose of the test e.g. `echo \"some bytes so file is not empty\" > ./utxo-788440.dat`\r\n2. Run bitcoind and wait for it to sync\r\n3. Run utxosnapshot.sh with some blockheight and a filepath __that already exists__ e.g. `./contrib/devtools/utxo_snapshot.sh 788440 ./utxo-788440.dat ./src/bitcoin-cli`\r\n4. Wait for chain rewind to happen, snapshot to be generated and write to disk fail\r\n5. Observe that the pivot block is now reconsidered and the chain is restored to the original height\r\n\r\nNote that the 2nd commit precludes error handling in the case that the file already exists.\r\n\r\nFor more info see https://github.com/bitcoin/bitcoin/issues/27841\r\n\r\n__UPDATE__: Squashed into a single commit",
   "closed_at" : "2023-11-10T14:21:33Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 8,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845/comments",
   "created_at" : "2023-06-09T16:49:55Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845",
   "id" : 1750212584,
   "labels" : [
      {
         "color" : "009800",
         "default" : false,
         "description" : null,
         "id" : 192202000,
         "name" : "Consensus",
         "node_id" : "MDU6TGFiZWwxOTIyMDIwMDA=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Consensus"
      },
      {
         "color" : "cccccc",
         "default" : false,
         "description" : "",
         "id" : 5334691551,
         "name" : "CI failed",
         "node_id" : "LA_kwDOABII588AAAABPfju3w",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585SpAOo",
   "number" : 27845,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/27845.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27845",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/27845.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27845"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845/timeline",
   "title" : "script: utxo_snapshot.sh error handling",
   "updated_at" : "2023-11-10T14:21:33Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27845",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/22148308?v=4",
      "events_url" : "https://api.github.com/users/hazeycode/events{/privacy}",
      "followers_url" : "https://api.github.com/users/hazeycode/followers",
      "following_url" : "https://api.github.com/users/hazeycode/following{/other_user}",
      "gists_url" : "https://api.github.com/users/hazeycode/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/hazeycode",
      "id" : 22148308,
      "login" : "hazeycode",
      "node_id" : "MDQ6VXNlcjIyMTQ4MzA4",
      "organizations_url" : "https://api.github.com/users/hazeycode/orgs",
      "received_events_url" : "https://api.github.com/users/hazeycode/received_events",
      "repos_url" : "https://api.github.com/users/hazeycode/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/hazeycode/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/hazeycode/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/hazeycode"
   }
}
