{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "***Please refer to the [topic on Delving Bitcoin](https://delvingbitcoin.org/t/gutterguard-and-coingrinder-simulation-results/279) discussing Gutter Guard/Coingrinder simulation results.***\r\n\r\nAdds a coin selection algorithm that minimizes the weight of the input set while creating change.\r\n\r\nMotivations\r\n---\r\n\r\n- At high feerates, using unnecessary inputs can significantly increase the fees\r\n- Users are upset when fees are relatively large compared to the amount sent\r\n- Some users struggle to maintain a sufficient count of UTXOs in their wallet\r\n\r\nApproach\r\n---\r\n\r\nSo far, Bitcoin Core has used a balanced approach to coin selection, where it will generate multiple input set candidates using various coin selection algorithms and pick the least wasteful among their results, but not explicitly minimize the input set weight. Under some circumstances, we _do_ want to minimize the weight of the input set. Sometimes changeless solutions require many or heavy inputs, and there is not always a changeless solution for Branch and Bound to find in the first place. This can cause expensive transactions unnecessarily. Given a wallet with sufficient funds, `CoinGrinder` will pick the minimal-waste input set for a transaction with a change output. The current implementation only runs `CoinGrinder` at feerates over 3Ãlong-term-feerate-estimate (by default 30â¯á¹©/vB), which may be a decent compromise between our goal to reduce costs for the users, but still permit transactions at lower feerates to naturally reduce the walletâs UTXO pool to curb bloat.\r\n\r\nTrade-offs\r\n---\r\n\r\nSimulations for my thesis on coin selection ([see Section 6.3.2.1 [PDF]](https://murch.one/erhardt2016coinselection.pdf)) suggest that minimizing the input set for all transactions tends to grind a walletâs UTXO pool to dust (pun intended): an approach selecting inputs per coin-age-priority (in effect similar to âlargest first selectionâ) on average produced a UTXO pool with 15Ã the UTXO count as Bitcoin Coreâs Knapsack-based Coin Selection then (in 2016). Therefore, I do not recommend running `CoinGrinder` under all circumstances, but only at extreme feerates or when we have another good reason to minimize the input set for other reasons. In the long-term, we should introduce additional metrics to score different input set candidates, e.g. on basis of their privacy and wallet health impact, to pick from all our coin selection results, but until then, we may want to limit use of `CoinGrinder` in other ways.",
   "closed_at" : "2024-02-09T21:38:31Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 32,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27877/comments",
   "created_at" : "2023-06-13T22:32:16Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27877/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/27877",
   "id" : 1755741470,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27877/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585S7t_0",
   "number" : 27877,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/27877.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27877",
      "merged_at" : "2024-02-09T21:38:31Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/27877.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27877"
   },
   "reactions" : {
      "+1" : 1,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 8,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 9,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27877/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27877/timeline",
   "title" : "wallet: Add CoinGrinder coin selection algorithm",
   "updated_at" : "2024-02-09T21:38:31Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27877",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
      "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
      "followers_url" : "https://api.github.com/users/murchandamus/followers",
      "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
      "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/murchandamus",
      "id" : 4060799,
      "login" : "murchandamus",
      "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
      "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
      "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
      "repos_url" : "https://api.github.com/users/murchandamus/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/murchandamus"
   }
}
