[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204956602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204956602"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Copied this from https://github.com/bitcoin/bitcoin/blob/a13f3746dccd9c4ec16d6bfe9b33ebd26e3238e1/src/memusage.h#L50 because including that file would create a circular dependency. Is there a better way to do this?",
      "commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "created_at" : "2023-05-25T03:34:43Z",
      "diff_hunk" : "@@ -164,6 +164,26 @@ class PoolResource final\n         m_allocated_chunks.emplace_back(m_available_memory_it);\n     }\n \n+    /**\n+     * Return the number of actual allocation bytes, copied from memusage.h MallocUsage().\n+     */\n+    size_t m_system_alloc_bytes{0};\n+\n+    // copied from src/memusage.h\n+    size_t MallocUsage(size_t alloc)\n+    {\n+        // Measured on libc6 2.19 on Linux.\n+        if (alloc == 0) {\n+            return 0;\n+        } else if (sizeof(void*) == 8) {\n+            return ((alloc + 31) >> 4) << 4;\n+        } else if (sizeof(void*) == 4) {\n+            return ((alloc + 15) >> 3) << 3;\n+        } else {\n+            assert(0);\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204956602",
      "id" : 1204956602,
      "line" : 185,
      "node_id" : "PRRC_kwDOABII585H0i26",
      "original_commit_id" : "40a4a3adf9811f132f759617090ab9359c8aeed8",
      "original_line" : 185,
      "original_position" : 22,
      "original_start_line" : 172,
      "path" : "src/support/allocators/pool.h",
      "position" : 22,
      "pull_request_review_id" : 1443024518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204956602/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 172,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-25T03:38:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204956602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204957663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204957663"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This test may be somewhat fragile; it depends on `MallocUsage(8) == 32`. Maybe the test condition here should be `8 <= resource.SystemBytes()`, but I think that doesn't test enough.",
      "commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "created_at" : "2023-05-25T03:37:30Z",
      "diff_hunk" : "@@ -54,33 +54,40 @@ BOOST_AUTO_TEST_CASE(basic_allocating)\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\n     BOOST_TEST(1 == PoolResourceTester::FreeListSizes(resource)[1]);\n     BOOST_TEST(expected_bytes_available == PoolResourceTester::AvailableMemoryFromChunk(resource));\n+    // the system allocates 32 bytes for an 8-byte allocation\n+    BOOST_TEST(32 == resource.SystemBytes());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204957663",
      "id" : 1204957663,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585H0jHf",
      "original_commit_id" : "40a4a3adf9811f132f759617090ab9359c8aeed8",
      "original_line" : 58,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/pool_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1443024518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204957663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T03:38:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204957663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "How much of a difference does this make? I ran IBD on Ubuntu using the default `dbcache` (450) and `maxmempool` (300), which gives a total cache size (during IBD) of about 750 MB, and this (missing) system allocation amount was 97 MB (96941536 bytes).\r\n\r\nWith this amount of allocation omitted from the memory usage estimate (that is, current master), nodes will use 97 MB more memory than expected, or about 13% more than configured, a pretty significant error. This regression could cause surprises on low-memory systems.\r\n\r\nI also verified that the operating system (Ubuntu) reports the process using more memory on master than with this PR.\r\n```\r\n$ grep VmData /proc/$(pgrep bitcoind)/status\r\n```\r\nThat reports 1281764 kB on master and 1203800 on this PR branch. (This is after IBD had been running long enough to do at least one cache flush.) I'm not sure how reliable that is, or if that's the correct value to look at (`proc/status` show many memory-related values).\r\n\r\nThe `top` command reported the RES (resident) memory size as \"1.7g\" on master and \"1.3g\" on the PR branch, but that seems to be too much of a difference (about 400 MB), so take that with a grain of salt.\r\n\r\nIt would be helpful if others could try to reproduce these results.\r\n\r\ncc @martinus @theStack @sipa @jonatack ",
      "created_at" : "2023-05-25T04:17:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1562239541",
      "id" : 1562239541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dHeI1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562239541/reactions"
      },
      "updated_at" : "2023-05-25T04:17:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562239541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204976258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204976258"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "CI failed here (on 32-bit), so I force-pushed to make the test more precise.",
      "commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "created_at" : "2023-05-25T04:19:03Z",
      "diff_hunk" : "@@ -54,33 +54,40 @@ BOOST_AUTO_TEST_CASE(basic_allocating)\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\n     BOOST_TEST(1 == PoolResourceTester::FreeListSizes(resource)[1]);\n     BOOST_TEST(expected_bytes_available == PoolResourceTester::AvailableMemoryFromChunk(resource));\n+    // the system allocates 32 bytes for an 8-byte allocation\n+    BOOST_TEST(32 == resource.SystemBytes());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204976258",
      "id" : 1204976258,
      "in_reply_to_id" : 1204957663,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585H0nqC",
      "original_commit_id" : "40a4a3adf9811f132f759617090ab9359c8aeed8",
      "original_line" : 58,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/pool_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1443057692,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204976258/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T04:19:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204976258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204991822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204991822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think that calculation is now more correct, in fact this now counts the index array twice; once in `usage_system` and once in the estimated `usage_buckets`.\r\n\r\nThe most correct way is probably to just let the pool do all the malloc & free accounting, and don't do any other estimation. Then the `DynamicUsage` method boils down to something like `return m.get_allocator().resource().memory_usage();`. That would give more theoretically correct numbers, but in practice I doubt that this is much different from what we already have.\r\n\r\nI think the current inaccuray comes from either the mystery behind glibc & how the OS kernel does its thing, or some other data structures are not correctly accounted for.",
      "commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "created_at" : "2023-05-25T04:50:57Z",
      "diff_hunk" : "@@ -183,7 +183,9 @@ static inline size_t DynamicUsage(const std::unordered_map<Key,\n     size_t estimated_list_node_size = MallocUsage(sizeof(void*) * 3);\n     size_t usage_resource = estimated_list_node_size * pool_resource->NumAllocatedChunks();\n     size_t usage_chunks = MallocUsage(pool_resource->ChunkSizeBytes()) * pool_resource->NumAllocatedChunks();\n-    return usage_resource + usage_chunks + MallocUsage(sizeof(void*) * m.bucket_count());\n+    size_t usage_system = pool_resource->SystemBytes();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1204991822",
      "id" : 1204991822,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585H0rdO",
      "original_commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/memusage.h",
      "position" : 5,
      "pull_request_review_id" : 1443077760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204991822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T05:02:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204991822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1205009503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205009503"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I see, yes, it's counting the buckets twice, thanks. I agree that either way gives the same answer; the way I'm suggesting here would isolate this pool code a little more from the details of `std::unordered_map` (i.e., the existence of the `m.bucket_count()` method), which would be a little more general, but I think the way it is now is fine. I guess if we use this pool resource for a different kind of container (for example, an ordered map), then this PR's approach would be better since we wouldn't have to understand the internals of, say, `std::map`.\r\n\r\nI'll go ahead and close this now, we can keep it in mind for possible future use.",
      "commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "created_at" : "2023-05-25T05:24:57Z",
      "diff_hunk" : "@@ -183,7 +183,9 @@ static inline size_t DynamicUsage(const std::unordered_map<Key,\n     size_t estimated_list_node_size = MallocUsage(sizeof(void*) * 3);\n     size_t usage_resource = estimated_list_node_size * pool_resource->NumAllocatedChunks();\n     size_t usage_chunks = MallocUsage(pool_resource->ChunkSizeBytes()) * pool_resource->NumAllocatedChunks();\n-    return usage_resource + usage_chunks + MallocUsage(sizeof(void*) * m.bucket_count());\n+    size_t usage_system = pool_resource->SystemBytes();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1205009503",
      "id" : 1205009503,
      "in_reply_to_id" : 1204991822,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585H0vxf",
      "original_commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/memusage.h",
      "position" : 5,
      "pull_request_review_id" : 1443104352,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205009503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T05:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205009503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Closing at least for now, see the [comment](https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1205009503) above.",
      "created_at" : "2023-05-25T05:25:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1562291221",
      "id" : 1562291221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dHqwV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562291221/reactions"
      },
      "updated_at" : "2023-05-25T05:25:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562291221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Also related: #26614",
      "created_at" : "2023-05-25T05:38:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1562304483",
      "id" : 1562304483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dHt_j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562304483/reactions"
      },
      "updated_at" : "2023-05-25T05:38:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562304483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27748).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28939](https://github.com/bitcoin/bitcoin/pull/28939) (memusage: let PoolResource keep track of all allocated/deallocated memory by martinus)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-05-25T06:06:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1562327092",
      "id" : 1562327092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dHzg0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562327092/reactions"
      },
      "updated_at" : "2023-11-25T23:43:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562327092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1205035430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205035430"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree, also with current memory accounting code its not possible to use the same memory resource for multiple containers. So it would be nice to add full accounting to the pool, and then remove the special handling of std::unordered_map with pool and just count the ressource's total usage.",
      "commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "created_at" : "2023-05-25T06:07:40Z",
      "diff_hunk" : "@@ -183,7 +183,9 @@ static inline size_t DynamicUsage(const std::unordered_map<Key,\n     size_t estimated_list_node_size = MallocUsage(sizeof(void*) * 3);\n     size_t usage_resource = estimated_list_node_size * pool_resource->NumAllocatedChunks();\n     size_t usage_chunks = MallocUsage(pool_resource->ChunkSizeBytes()) * pool_resource->NumAllocatedChunks();\n-    return usage_resource + usage_chunks + MallocUsage(sizeof(void*) * m.bucket_count());\n+    size_t usage_system = pool_resource->SystemBytes();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1205035430",
      "id" : 1205035430,
      "in_reply_to_id" : 1204991822,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585H02Gm",
      "original_commit_id" : "576a270bbcbb21725770b07ba32af8e0c8965f44",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/memusage.h",
      "position" : 5,
      "pull_request_review_id" : 1443142439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205035430/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T06:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205035430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I decided to reopen this; I think it's a good generalization improvement to the pool allocator. See the description for details. Thanks, @martinus, for the suggested improvement!",
      "created_at" : "2023-05-26T22:43:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1565039269",
      "id" : 1565039269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dSJql",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565039269/reactions"
      },
      "updated_at" : "2023-05-26T22:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565039269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "GitHub isn't allowing me to reopen this; @achow101 could you re-open this for me, please? Or, if you'd prefer, I could make a new PR. Thanks!\r\n\r\nTL;DR on this PR's history: When I created this PR, I thought I was fixing a bug. But @martinus pointed out that there is no bug, so I closed this PR. I then decided this would be a worthwhile improvement after all (although of course not trying to fix a bug), so I'd like it to be reopened.",
      "created_at" : "2023-05-26T22:49:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1565042192",
      "id" : 1565042192,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dSKYQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565042192/reactions"
      },
      "updated_at" : "2023-05-26T22:49:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565042192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> GitHub isn't allowing me to reopen this\r\n\r\nIn order to reopen the PR, the branch needs to point at the same commit it was pointing to at the time the PR was closed.\r\n\r\nRight now the branch https://github.com/LarryRuane/bitcoin/commits/2023-05-resource-pool-system-alloc points to d25b54346fed931830cf3f538b96c5c346165487, but the PR points to 576a270bbcbb21725770b07ba32af8e0c8965f44. If you temporarily force push 576a270bbcbb21725770b07ba32af8e0c8965f44 to the branch, I think you should be able to reopen the PR.",
      "created_at" : "2023-05-28T23:20:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1566300943",
      "id" : 1566300943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dW9sP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1566300943/reactions"
      },
      "updated_at" : "2023-05-28T23:20:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1566300943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, Ryan!",
      "created_at" : "2023-05-29T03:23:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1566448078",
      "id" : 1566448078,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585dXhnO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1566448078/reactions"
      },
      "updated_at" : "2023-05-29T03:23:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1566448078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1209144572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209144572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure what value this comment adds. Also don't see a reason to mention a version of glibc that we don't support?",
      "commit_id" : "d25b54346fed931830cf3f538b96c5c346165487",
      "created_at" : "2023-05-29T09:54:10Z",
      "diff_hunk" : "@@ -164,6 +174,21 @@ class PoolResource final\n         m_allocated_chunks.emplace_back(m_available_memory_it);\n     }\n \n+    // copied from src/memusage.h\n+    size_t MallocUsage(size_t alloc) const\n+    {\n+        // Measured on libc6 2.19 on Linux.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1209144572",
      "id" : 1209144572,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII585IEhT8",
      "original_commit_id" : "d25b54346fed931830cf3f538b96c5c346165487",
      "original_line" : 180,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/support/allocators/pool.h",
      "position" : 24,
      "pull_request_review_id" : 1449232552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209144572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-29T09:54:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209144572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1209457660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209457660"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I copied this function from `memusage.h` ([here](https://github.com/bitcoin/bitcoin/blob/6cf47a8f44f96099a84e5c6e628e3499045e024d/src/memusage.h#L52)). I'm hoping not to duplicate this function, even though it's pretty small. `pool.h` can't include `memusage.h` because that creates a circular dependency. I'll try to figure out a way to improve this and also of course I welcome suggestions.\r\n\r\nAnyway, if we need to duplicate this function, I'll remove this comment, I agree it's not useful.",
      "commit_id" : "d25b54346fed931830cf3f538b96c5c346165487",
      "created_at" : "2023-05-29T16:41:02Z",
      "diff_hunk" : "@@ -164,6 +174,21 @@ class PoolResource final\n         m_allocated_chunks.emplace_back(m_available_memory_it);\n     }\n \n+    // copied from src/memusage.h\n+    size_t MallocUsage(size_t alloc) const\n+    {\n+        // Measured on libc6 2.19 on Linux.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1209457660",
      "id" : 1209457660,
      "in_reply_to_id" : 1209144572,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII585IFtv8",
      "original_commit_id" : "d25b54346fed931830cf3f538b96c5c346165487",
      "original_line" : 180,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/support/allocators/pool.h",
      "position" : 24,
      "pull_request_review_id" : 1449714136,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209457660/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-29T16:41:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209457660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1209810958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209810958"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "About that function, I do not think that it is accurate any more. I wrote a different version of that estimation that makes use of `malloc_usable_size`, and that way I get different values, see here: https://godbolt.org/z/fde6T7srb\r\nIt might be worth having a look if using that estimation is more accurate",
      "commit_id" : "d25b54346fed931830cf3f538b96c5c346165487",
      "created_at" : "2023-05-30T07:18:21Z",
      "diff_hunk" : "@@ -164,6 +174,21 @@ class PoolResource final\n         m_allocated_chunks.emplace_back(m_available_memory_it);\n     }\n \n+    // copied from src/memusage.h\n+    size_t MallocUsage(size_t alloc) const\n+    {\n+        // Measured on libc6 2.19 on Linux.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1209810958",
      "id" : 1209810958,
      "in_reply_to_id" : 1209144572,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII585IHEAO",
      "original_commit_id" : "d25b54346fed931830cf3f538b96c5c346165487",
      "original_line" : 180,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/support/allocators/pool.h",
      "position" : 24,
      "pull_request_review_id" : 1450257960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27748",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209810958/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-30T07:19:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209810958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--8ac04cdde196e94527acabf64b896448-->\r\nThere hasn't been much activity lately. What is the status here?\r\n\r\n[Finding reviewers](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#finding-reviewers) may take time. However, if the patch is no longer relevant, please close this pull request. If the author lost interest or time to work on this, please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\r\n",
      "created_at" : "2023-08-08T09:50:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1669293909",
      "id" : 1669293909,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585jf2dV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1669293909/reactions"
      },
      "updated_at" : "2023-08-08T09:50:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1669293909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase if still relevant.",
      "created_at" : "2023-09-20T16:45:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1728099340",
      "id" : 1728099340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585nALQM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728099340/reactions"
      },
      "updated_at" : "2023-09-20T16:45:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728099340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is still relevant, rebased, but changing to Draft because it should build on another PR I'm working on to implement https://github.com/bitcoin/bitcoin/pull/27748#discussion_r1209810958.",
      "created_at" : "2023-09-21T18:19:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1730082064",
      "id" : 1730082064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585nHvUQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1730082064/reactions"
      },
      "updated_at" : "2023-09-21T18:19:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1730082064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@LarryRuane are you still working on this? I think this shouldn't be blocked by #28531.",
      "created_at" : "2023-11-20T07:04:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1818347616",
      "id" : 1818347616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585sYchg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1818347616/reactions"
      },
      "updated_at" : "2023-11-20T07:04:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1818347616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Question @martinus @LarryRuane, is https://github.com/bitcoin/bitcoin/pull/28939 an alternative to this PR?",
      "created_at" : "2023-11-28T16:31:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1830252832",
      "id" : 1830252832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585tF3Eg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1830252832/reactions"
      },
      "updated_at" : "2023-11-28T16:31:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1830252832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The PRs are very similar and achieve the same thing, with a bit different styles. Some differences:\r\n* Here only system memory is continuously tracked and the rest is calculated on demand. In #28939 I track everything continuously. The result should be the same\r\n* In #28939 I moved `MallocUsage` into a separate function to avoid code duplication\r\n* I added another unit test in #28939 and fixed failing tests due to the new calculation (sometimes the old calculation understimated things)",
      "created_at" : "2023-11-28T17:37:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1830364848",
      "id" : 1830364848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585tGSaw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1830364848/reactions"
      },
      "updated_at" : "2023-11-28T17:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1830364848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Your PR #28939 is definitely better, I especially like tracking total allocation continuously. I'll go ahead and close this.",
      "created_at" : "2023-11-28T18:28:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27748#issuecomment-1830443863",
      "id" : 1830443863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27748",
      "node_id" : "IC_kwDOABII585tGltX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1830443863/reactions"
      },
      "updated_at" : "2023-11-28T18:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1830443863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   }
]
