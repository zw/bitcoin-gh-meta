[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I can take this if still available.",
      "created_at" : "2023-06-13T18:53:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1589856647",
      "id" : 1589856647,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585ew0mH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1589856647/reactions"
      },
      "updated_at" : "2023-06-13T18:53:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1589856647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/33068296?v=4",
         "events_url" : "https://api.github.com/users/dimitaracev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dimitaracev/followers",
         "following_url" : "https://api.github.com/users/dimitaracev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dimitaracev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dimitaracev",
         "id" : 33068296,
         "login" : "dimitaracev",
         "node_id" : "MDQ6VXNlcjMzMDY4Mjk2",
         "organizations_url" : "https://api.github.com/users/dimitaracev/orgs",
         "received_events_url" : "https://api.github.com/users/dimitaracev/received_events",
         "repos_url" : "https://api.github.com/users/dimitaracev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dimitaracev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dimitaracev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dimitaracev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I can take this if still available.\n\nFeel free to investigate, i am not working on this currently.",
      "created_at" : "2023-06-13T21:57:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1590076625",
      "id" : 1590076625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585exqTR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1590076625/reactions"
      },
      "updated_at" : "2023-06-13T21:57:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1590076625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Unfortunately I was not able to reproduce this after multiple tests. Do you maybe have a more specific scenario where the issue would occur?",
      "created_at" : "2023-06-14T14:09:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591287445",
      "id" : 1591287445,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e2R6V",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591287445/reactions"
      },
      "updated_at" : "2023-06-14T14:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591287445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/33068296?v=4",
         "events_url" : "https://api.github.com/users/dimitaracev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dimitaracev/followers",
         "following_url" : "https://api.github.com/users/dimitaracev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dimitaracev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dimitaracev",
         "id" : 33068296,
         "login" : "dimitaracev",
         "node_id" : "MDQ6VXNlcjMzMDY4Mjk2",
         "organizations_url" : "https://api.github.com/users/dimitaracev/orgs",
         "received_events_url" : "https://api.github.com/users/dimitaracev/received_events",
         "repos_url" : "https://api.github.com/users/dimitaracev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dimitaracev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dimitaracev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dimitaracev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Unfortunately I was not able to reproduce this after multiple tests. Do you maybe have a more specific scenario where the issue would occur?\r\n\r\nI don't really have any more specifics to give. This was the latest master at the time, compiled only with standard flags and no other wallets present etc. I reproduced the issue 4-5 times consistently with script given above. What OS are you on? If you are not on macOS maybe you have to lower the limit of allowed file descriptors.",
      "created_at" : "2023-06-14T14:48:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591378018",
      "id" : 1591378018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e2oBi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591378018/reactions"
      },
      "updated_at" : "2023-06-14T14:48:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591378018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm on an ArchLinux installation, and I see that the number of allowed file descriptors is pretty high which is probably why I can't reproduce it. Will lower them and try again, thanks.",
      "created_at" : "2023-06-14T14:53:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591386447",
      "id" : 1591386447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e2qFP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591386447/reactions"
      },
      "updated_at" : "2023-06-14T14:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591386447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/33068296?v=4",
         "events_url" : "https://api.github.com/users/dimitaracev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dimitaracev/followers",
         "following_url" : "https://api.github.com/users/dimitaracev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dimitaracev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dimitaracev",
         "id" : 33068296,
         "login" : "dimitaracev",
         "node_id" : "MDQ6VXNlcjMzMDY4Mjk2",
         "organizations_url" : "https://api.github.com/users/dimitaracev/orgs",
         "received_events_url" : "https://api.github.com/users/dimitaracev/received_events",
         "repos_url" : "https://api.github.com/users/dimitaracev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dimitaracev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dimitaracev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dimitaracev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Relevant log output ... 0bin\r\n\r\nIf you upload logs, it could help to either put them in the comment (maybe via `<details><summary></summary></details>`) or by uploading it to the same site that hosts the comment. Otherwise the external site is just another thing that can go down or is unreachable, which is the case here for me at least.",
      "created_at" : "2023-06-14T15:28:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591479403",
      "id" : 1591479403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e3Axr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591479403/reactions"
      },
      "updated_at" : "2023-06-14T15:28:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591479403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> If you upload logs, it could help to either put them in the comment (maybe via `<details><summary></summary></details>`) or by uploading it to the same site that hosts the comment. Otherwise the external site is just another thing that can go down or is unreachable, which is the case here for me at least.\r\n\r\nGitHub didn't allow me to paste the logs in a comment because they were too big...\r\n",
      "created_at" : "2023-06-14T15:33:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591488276",
      "id" : 1591488276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e3C8U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591488276/reactions"
      },
      "updated_at" : "2023-06-14T15:33:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591488276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Trying with attached file...\r\n[wallet_exhaust.txt](https://github.com/bitcoin/bitcoin/files/11747823/wallet_exhaust.txt)\r\n",
      "created_at" : "2023-06-14T15:34:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591491075",
      "id" : 1591491075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e3DoD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591491075/reactions"
      },
      "updated_at" : "2023-06-14T15:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591491075",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, seems to have worked. But when I created the issue it failed.",
      "created_at" : "2023-06-14T15:35:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591492629",
      "id" : 1591492629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e3EAV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591492629/reactions"
      },
      "updated_at" : "2023-06-14T15:35:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591492629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks, seems like the relevant short excerpt is:\r\n\r\n```\r\n2023-05-23T22:32:53Z SQLite Error. Code: 14. Message: os_unix.c:46922: (24) open(/Users/FJ/Library/Application Support/Bitcoin/testnet3/wallets/fd-wallet99/wallet.dat-journal) - Too many open files\r\n2023-05-23T22:32:53Z SQLite Error. Code: 14. Message: statement aborts at 1: [BEGIN EXCLUSIVE TRANSACTION] unable to open database file\r\n2023-05-23T22:32:53Z Using SQLite Version 3.39.5\r\n2023-05-23T22:32:53Z Using wallet /Users/FJ/Library/Application Support/Bitcoin/testnet3/wallets/fd-wallet100\r\n2023-05-23T22:32:53Z SQLite Error. Code: 14. Message: cannot open file at line 46922 of [554764a6e7]\r\n2023-05-23T22:32:53Z SQLite Error. Code: 14. Message: os_unix.c:46922: (24) open(/Users/FJ/Library/Application Support/Bitcoin/testnet3/wallets/fd-wallet100/wallet.dat-journal) - Too many open files\r\n2023-05-23T22:32:53Z SQLite Error. Code: 14. Message: statement aborts at 1: [BEGIN EXCLUSIVE TRANSACTION] unable to open database file\r\n2023-05-23T22:33:38Z UpdateTip: new best=00000000607ba1efbd078e5a305b832ae14a6c444b5aa9b557db4982cca74aed height=1148054 version=0x20000000 log2_work=69.251056 tx=14198802 date='2017-06-24T09:42:34Z' progress=0.216198 cache=45.4MiB(394627txo)\r\n2023-05-23T22:33:38Z UpdateTip: new best=00000000b7e5ec444dfcf9cff739783eb0550c692ff1c66cfe37af6374fbaad6 height=1148055 version=0x20000000 log2_work=69.251056 tx=14199082 date='2017-06-24T10:02:36Z' progress=0.216202 cache=50.5MiB(414075txo)\r\n2023-05-23T22:33:39Z UpdateTip: new best=0000000013869d488791f4961dcf1b1f93f050b0a787616359b6355a70701e86 height=1148056 version=0x20000000 log2_work=69.251056 tx=14199702 date='2017-06-24T10:29:53Z' progress=0.216212 cache=50.8MiB(414298txo)\r\n2023-05-23T22:33:39Z New outbound peer connected: version: 70015, blocks=2435012, peer=6 (outbound-full-relay)\r\n2023-05-23T22:33:39Z UpdateTip: new best=0000000086afcb0260af2c4f609535db645a0f765484d389834c0309030eabcb height=1148057 version=0x20000000 log2_work=69.251056 tx=14200140 date='2017-06-24T10:52:00Z' progress=0.216219 cache=50.8MiB(414672txo)\r\n2023-05-23T22:33:39Z UpdateTip: new best=000000009be200143cc507115d9a57504241f80536b0e9fa0a304fc9f13a7f14 height=1148058 version=0x00000004 log2_work=69.251056 tx=14200141 date='2017-06-24T11:15:47Z' progress=0.216219 cache=50.8MiB(414674txo)\r\n2023-05-23T22:33:39Z New outbound peer connected: version: 70016, blocks=2435012, peer=5 (outbound-full-relay)\r\n2023-05-23T22:33:39Z UpdateTip: new best=000000000e0e1b8cc908edb67e8a9329a256b162ab45a8bbfe83a9773fe32bbd height=1148059 version=0x20000000 log2_work=69.251056 tx=14200255 date='2017-06-24T11:39:07Z' progress=0.216220 cache=50.8MiB(414513txo)\r\n2023-05-23T22:34:26Z UpdateTip: new best=000000003aae175dee028b660af7116bf8fa66ad2934845e961b9839a18821d8 height=1148060 version=0x20000000 log2_work=69.251056 tx=14200492 date='2017-06-24T12:00:07Z' progress=0.216224 cache=50.8MiB(414378txo)\r\n2023-05-23T22:34:26Z UpdateTip: new best=00000000f7bd2dbd40619d3a20755603f010012af19f5aafbbab46ae374160db height=1148061 version=0x20000000 log2_work=69.251056 tx=14201162 date='2017-06-24T12:20:08Z' progress=0.216234 cache=50.8MiB(414715txo)\r\n2023-05-23T22:34:26Z UpdateTip: new best=0000000003110e54d36f4113fc94f46a4463e5da18eb356e4cc0d67bb2fa79c5 height=1148062 version=0x20000000 log2_work=69.251056 tx=14201706 date='2017-06-24T12:57:58Z' progress=0.216242 cache=50.8MiB(414666txo)\r\n2023-05-23T22:34:26Z UpdateTip: new best=000000003b71aa64a460b2f7ebe40a959ed3e9c2fe02af8df4a99fda44efe906 height=1148063 version=0x20000000 log2_work=69.251056 tx=14202041 date='2017-06-24T13:19:45Z' progress=0.216247 cache=50.8MiB(414737txo)\r\n2023-05-23T22:34:26Z New outbound peer connected: version: 70016, blocks=2435012, peer=7 (outbound-full-relay)\r\n2023-05-23T22:34:26Z New outbound peer connected: version: 70016, blocks=2435012, peer=8 (outbound-full-relay)\r\n2023-05-23T22:34:26Z Synchronizing blockheaders, height: 2435012 (~100.00%)\r\n2023-05-23T22:34:26Z UpdateTip: new best=00000000a41344a056a034e823dd4108d6186f9d61449354c29d617f5222bad3 height=1148064 version=0x20000000 log2_work=69.251056 tx=14202449 date='2017-06-24T13:56:46Z' progress=0.216254 cache=50.8MiB(414869txo)\r\n2023-05-23T22:34:26Z UpdateTip: new best=00000000823daf27e85da59baa4c6a6b90d98283d45f425c84351592dc7655df height=1148065 version=0x20000000 log2_work=69.251056 tx=14202845 date='2017-06-24T14:20:57Z' progress=0.216260 cache=52.3MiB(428380txo)\r\n2023-05-23T22:34:51Z Unable to open file /Users/FJ/Library/Application Support/Bitcoin/testnet3/blocks/rev00076.dat\r\n2023-05-23T22:34:51Z ERROR: UndoWriteToDisk: OpenUndoFile failed\r\n2023-05-23T22:34:51Z *** Failed to write undo data\r\n2023-05-23T22:34:51Z Error: A fatal internal error occurred, see debug.log for details\r\n2023-05-23T22:34:51Z tor: Thread interrupt\r\n2023-05-23T22:34:51Z addcon thread exit\r\n2023-05-23T22:34:51Z Shutdown: In progress...\r\n2023-05-23T22:34:51Z opencon thread exit\r\n2023-05-23T22:34:51Z torcontrol thread exit\r\n2023-05-23T22:34:51Z ERROR: ConnectTip: ConnectBlock 00000000c101ef80a98b3e6e11d925578c02512f37731838a911591e7e64b858 failed, Failed to write undo data\r\n2023-05-23T22:34:51Z ERROR: ProcessNewBlock: ActivateBestChain failed (Failed to write undo data)\r\n2023-05-23T22:34:51Z msghand thread exit\r\n2023-05-23T22:34:51Z net thread exit\r\n2023-05-23T22:34:51Z DumpAnchors: Flush 0 outbound block-relay-only peer addresses to anchors.dat started\r\n2023-05-23T22:34:51Z DumpAnchors: Flush 0 outbound block-relay-only peer addresses to anchors.dat completed (0.00s)\r\n2023-05-23T22:34:52Z scheduler thread exit\r\n2023-05-23T22:34:52Z Writing 0 unbroadcast transactions to disk.\r\n2023-05-23T22:34:52Z Dumped mempool: 4.75e-05s to copy, 0.00576754s to dump",
      "created_at" : "2023-06-14T15:37:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591494972",
      "id" : 1591494972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e3Ek8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591494972/reactions"
      },
      "updated_at" : "2023-06-14T15:37:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591494972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Unfortunately I was not able to reproduce this after multiple tests. Do you maybe have a more specific scenario where the issue would occur?\r\n> \r\n> I don't really have any more specifics to give. This was the latest master at the time, compiled only with standard flags and no other wallets present etc. I reproduced the issue 4-5 times consistently with script given above. What OS are you on? If you are not on macOS maybe you have to lower the limit of allowed file descriptors.\r\n\r\nOkay, I was able to reproduce it when lowering the file descriptors and will look further into it. Interesting enough, in my case it doesn't crash the node but the file descriptors seem to be locked, and can't load the already created wallets.\r\n```\r\n2023-06-14T19:22:21Z [fd-wallet1] Releasing wallet\r\n2023-06-14T19:22:22Z Using SQLite Version 3.40.1\r\n2023-06-14T19:22:22Z Using wallet /home/dimitaracev/.bitcoin/regtest/wallets/fd-wallet1\r\n2023-06-14T19:22:22Z init message: Loading walletâ¦\r\n2023-06-14T19:22:22Z [fd-wallet1] Wallet file version = 10500, last client version = 259900\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = 5e306353541637e7a8a5544e5b257ba8f1d3c488f2e9fd7cbf8b050742e3ec8d, type = legacy, internal = false\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = 46059f1ecfbe2666420840110eb03da53c829a2a1296bb63c64d5daf562d070b, type = p2sh-segwit, internal = false\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = e60db0e290b20b41cccd1c62b47120159af0e747b5829eb611118c6f053df157, type = bech32, internal = false\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = f706629e5c33dfe527c2f5ec6e2c0f0d36f3cc75f6e56b711554198e9120d2ca, type = bech32m, internal = false\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = 6c17557bdb8f060982bd9478d20c33989fec840f5fca6104f5c9b77ae2000425, type = legacy, internal = true\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = 6120ab62678492d7f653409175de0ac0bfbab67f7501b2387533477c8a14ee17, type = p2sh-segwit, internal = true\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = c9bb633eaf2982beb1711e977e8e679374160a898cf392a886f81ac41829c5e7, type = bech32, internal = true\r\n2023-06-14T19:22:22Z [fd-wallet1] Setting spkMan to active: id = 15400e0ed8a94b5e6b245b991e78dc2f467873cea42ee508d4a3563bdb6456f1, type = bech32m, internal = true\r\n2023-06-14T19:22:22Z [fd-wallet1] Keys: 8 plaintext, 0 encrypted, 0 w/ metadata, 8 total. Unknown wallet records: 0\r\n2023-06-14T19:22:22Z SQLite Error. Code: 14. Message: cannot open file at line 42907 of [df5c253c0b]\r\n2023-06-14T19:22:22Z SQLite Error. Code: 14. Message: os_unix.c:42907: (24) open(/home/dimitaracev/.bitcoin/regtest/wallets/fd-wallet1/wallet.dat-journal) - \r\n2023-06-14T19:22:22Z SQLite Error. Code: 14. Message: statement aborts at 14: [INSERT or REPLACE into main values(?, ?)] unable to open database file\r\n2023-06-14T19:22:22Z WriteKey: Unable to execute statement: unable to open database file\r\n2023-06-14T19:22:22Z [fd-wallet1] Releasing wallet\r\n2023-06-14T19:27:36Z CreateNewBlock(): block weight: 892 txs: 0 fees: 0 sigops 400\r\n2023-06-14T19:27:36Z Saw new header hash=1786ef9d4d7625c83d48e6e706c2d2cd53cb73f2023ad369aa9200a5269bf87f height=405\r\n2023-06-14T19:27:36Z UpdateTip: new best=1786ef9d4d7625c83d48e6e706c2d2cd53cb73f2023ad369aa9200a5269bf87f height=405 version=0x30000000 log2_work=9.665336 tx=406 date='2023-06-14T19:27:36Z' progress=1.000000 cache=0.3MiB(304txo)\r\n```",
      "created_at" : "2023-06-14T19:15:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591842859",
      "id" : 1591842859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e4Zgr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591842859/reactions"
      },
      "updated_at" : "2023-06-14T19:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591842859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/33068296?v=4",
         "events_url" : "https://api.github.com/users/dimitaracev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dimitaracev/followers",
         "following_url" : "https://api.github.com/users/dimitaracev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dimitaracev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dimitaracev",
         "id" : 33068296,
         "login" : "dimitaracev",
         "node_id" : "MDQ6VXNlcjMzMDY4Mjk2",
         "organizations_url" : "https://api.github.com/users/dimitaracev/orgs",
         "received_events_url" : "https://api.github.com/users/dimitaracev/received_events",
         "repos_url" : "https://api.github.com/users/dimitaracev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dimitaracev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dimitaracev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dimitaracev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "After a deeper look, I think the crashing may be related to how macOS handles file descriptors when you try to use more than the limit. Bitcoin Core loads the wallet immediately after you create it and it keeps that file descriptor open for easy access. You can try running `bitcoin-cli listwallets` and you should see all of the wallets created up until the point where you go over the file descriptor limit.",
      "created_at" : "2023-06-14T20:10:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1591905483",
      "id" : 1591905483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585e4ozL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591905483/reactions"
      },
      "updated_at" : "2023-06-14T20:10:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591905483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/33068296?v=4",
         "events_url" : "https://api.github.com/users/dimitaracev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dimitaracev/followers",
         "following_url" : "https://api.github.com/users/dimitaracev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dimitaracev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dimitaracev",
         "id" : 33068296,
         "login" : "dimitaracev",
         "node_id" : "MDQ6VXNlcjMzMDY4Mjk2",
         "organizations_url" : "https://api.github.com/users/dimitaracev/orgs",
         "received_events_url" : "https://api.github.com/users/dimitaracev/received_events",
         "repos_url" : "https://api.github.com/users/dimitaracev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dimitaracev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dimitaracev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dimitaracev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> After a deeper look, I think the crashing may be related to how macOS handles file descriptors when you try to use more than the limit.\r\n\r\nIt's not how macOS handles it, any OS will cause bitcoind to crash if you use more fd than the limit. It's just that among all the OS macOS has the lowest standard limit and so such issue are usually observed there first. \r\n\r\n> Bitcoin Core loads the wallet immediately after you create it and it keeps that file descriptor open for easy access. You can try running `bitcoin-cli listwallets` and you should see all of the wallets created up until the point where you go over the file descriptor limit.\r\n\r\nYes. But this doesn't change that bitcoind can crash and ideally it shouldn't, which is why I opened this issue.",
      "created_at" : "2023-06-18T11:41:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1596113541",
      "id" : 1596113541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585fIsKF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1596113541/reactions"
      },
      "updated_at" : "2023-06-18T11:41:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1596113541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > After a deeper look, I think the crashing may be related to how macOS handles file descriptors when you try to use more than the limit.\r\n> \r\n> It's not how macOS handles it, any OS will cause bitcoind to crash if you use more fd than the limit. It's just that among all the OS macOS has the lowest standard limit and so such issue are usually observed there first.\r\n> \r\n> > Bitcoin Core loads the wallet immediately after you create it and it keeps that file descriptor open for easy access. You can try running `bitcoin-cli listwallets` and you should see all of the wallets created up until the point where you go over the file descriptor limit.\r\n> \r\n> Yes. But this doesn't change that bitcoind can crash and ideally it shouldn't, which is why I opened this issue.\r\n\r\nI'm able to trigger this on macOS with a slightly bigger for loop (the default fd limit for macOS is 256, so anything around that ballpark should trigger). However, looks like this is not making `bitcoind` crash anymore, at least not for me.\r\n\r\n```\r\n[...]\r\n2023-06-22T14:38:41Z [rpc] ThreadRPCServer method=createwallet user=user\r\n2023-06-22T14:38:41Z Using SQLite Version 3.39.5\r\n2023-06-22T14:38:41Z Using wallet /Users/sergi/Library/Application Support/Bitcoin/regtest/wallets/fd-wallet132\r\n2023-06-22T14:38:41Z SQLite Error. Code: 14. Message: cannot open file at line 46922 of [554764a6e7]\r\n2023-06-22T14:38:41Z SQLite Error. Code: 14. Message: os_unix.c:46922: (24) open(/Users/sergi/.bitcoin/regtest/wallets/fd-wallet132/wallet.dat-journal) - Too many open files\r\n2023-06-22T14:38:41Z SQLite Error. Code: 14. Message: statement aborts at 1: [BEGIN EXCLUSIVE TRANSACTION] unable to open database file\r\n2023-06-22T14:38:41Z [http] Received a POST request for / from 127.0.0.1:49976\r\n2023-06-22T14:38:41Z [rpc] ThreadRPCServer method=createwallet user=user\r\n2023-06-22T14:38:41Z Using SQLite Version 3.39.5\r\n2023-06-22T14:38:41Z Using wallet /Users/sergi/Library/Application Support/Bitcoin/regtest/wallets/fd-wallet133\r\n2023-06-22T14:38:41Z SQLite Error. Code: 14. Message: cannot open file at line 46922 of [554764a6e7]\r\n2023-06-22T14:38:41Z SQLite Error. Code: 14. Message: os_unix.c:46922: (24) open(/Users/sergi/.bitcoin/regtest/wallets/fd-wallet133/wallet.dat-journal) - Too many open files\r\n2023-06-22T14:38:41Z SQLite Error. Code: 14. Message: statement aborts at 1: [BEGIN EXCLUSIVE TRANSACTION] unable to open database file\r\n2023-06-22T14:38:41Z [http] Received a POST request for / from 127.0.0.1:49977\r\n[...]\r\n```",
      "created_at" : "2023-06-22T14:43:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27732#issuecomment-1602767154",
      "id" : 1602767154,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27732",
      "node_id" : "IC_kwDOABII585fiEky",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602767154/reactions"
      },
      "updated_at" : "2023-06-22T14:43:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602767154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   }
]
