[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r730313233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730313233"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`if line and bail_line.lower() in line.lower()` and `(time.time() - start) > MAX_SECS_TO_WAIT` sigterm_node() will be called twice, is this the intention? ",
      "commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "created_at" : "2021-10-16T21:00:56Z",
      "diff_hunk" : "@@ -0,0 +1,161 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+                    sigterm_node()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r730313233",
      "id" : 730313233,
      "line" : 84,
      "node_id" : "PRRC_kwDOABII584rh7IR",
      "original_commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "original_line" : 84,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/stress_init.py",
      "position" : 84,
      "pull_request_review_id" : 781389546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730313233/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-16T21:00:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730313233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r730390464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730390464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this would be called `feature_init`, no?",
      "commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "created_at" : "2021-10-17T10:19:26Z",
      "diff_hunk" : "@@ -275,6 +275,7 @@\n     'wallet_taproot.py',\n     'p2p_fingerprint.py',\n     'feature_uacomment.py',\n+    'stress_init.py',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r730390464",
      "id" : 730390464,
      "line" : 278,
      "node_id" : "PRRC_kwDOABII584riN_A",
      "original_commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "original_line" : 278,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : 4,
      "pull_request_review_id" : 781432011,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730390464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-17T10:20:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730390464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Strong Concept ACK\r\n\r\nFunctional testing, unit testing, fuzz testing and now stress testing: great to see!\r\n\r\nFault injection testing and mutation testing next in line? :)",
      "created_at" : "2021-10-17T19:30:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-945181371",
      "id" : 945181371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844VlK7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/945181371/reactions"
      },
      "updated_at" : "2021-10-17T19:30:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/945181371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r730579472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730579472"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it won't happen, as there is a `break` after these conditions.",
      "commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "created_at" : "2021-10-18T05:27:49Z",
      "diff_hunk" : "@@ -0,0 +1,161 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+                    sigterm_node()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r730579472",
      "id" : 730579472,
      "in_reply_to_id" : 730313233,
      "line" : 84,
      "node_id" : "PRRC_kwDOABII584ri8IQ",
      "original_commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "original_line" : 84,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/stress_init.py",
      "position" : 84,
      "pull_request_review_id" : 781599853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730579472/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-18T05:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730579472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r731096739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/731096739"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yep sure, will change.",
      "commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "created_at" : "2021-10-18T16:11:30Z",
      "diff_hunk" : "@@ -275,6 +275,7 @@\n     'wallet_taproot.py',\n     'p2p_fingerprint.py',\n     'feature_uacomment.py',\n+    'stress_init.py',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r731096739",
      "id" : 731096739,
      "in_reply_to_id" : 730390464,
      "line" : 278,
      "node_id" : "PRRC_kwDOABII584rk6aj",
      "original_commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "original_line" : 278,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : 4,
      "pull_request_review_id" : 782291751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/731096739/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-18T16:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/731096739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r731168310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/731168310"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "True! Thanks! missed that break",
      "commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "created_at" : "2021-10-18T17:44:09Z",
      "diff_hunk" : "@@ -0,0 +1,161 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+                    sigterm_node()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r731168310",
      "id" : 731168310,
      "in_reply_to_id" : 730313233,
      "line" : 84,
      "node_id" : "PRRC_kwDOABII584rlL42",
      "original_commit_id" : "1888c8dc40d1dbbffe2f522749151ca8d0efee00",
      "original_line" : 84,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/stress_init.py",
      "position" : 84,
      "pull_request_review_id" : 782388382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/731168310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-18T17:44:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/731168310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code Review ACK 71ba24a724556af02901d2aa06a71d24e18f6f3c\r\n\r\nThis is great, and is very helpful for testing initialization! Thank you James!\r\n\r\n<details>\r\n <summary>Naive idea</summary>\r\n Since GDB has a Python API, perhaps someone can use that for more granular stress testing (shouldn't be in this PR since it seems like quite a large undertaking)\r\n</details>",
      "created_at" : "2021-10-19T16:30:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-946896373",
      "id" : 946896373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844cH31",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946896373/reactions"
      },
      "updated_at" : "2021-10-19T16:30:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946896373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, very cool idea.\r\n\r\nI also encountered the intermittent `Error: txindex best block of the index goes beyond pruned data` once while running the new test yesterday - what is the best way to proceed? Should that issue be analysed/fixed before merging this?",
      "created_at" : "2021-10-19T21:48:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-947131763",
      "id" : 947131763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844dBVz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947131763/reactions"
      },
      "updated_at" : "2021-10-19T21:48:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947131763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732561699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732561699"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2017 was 5 years ago",
      "commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "created_at" : "2021-10-20T09:01:41Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732561699",
      "id" : 732561699,
      "line" : 2,
      "node_id" : "PRRC_kwDOABII584rqgEj",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 2,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 2,
      "pull_request_review_id" : 784196148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732561699/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T09:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732561699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732570270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732570270"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not return a Path here when the function is called ..._path?",
      "commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "created_at" : "2021-10-20T09:12:09Z",
      "diff_hunk" : "@@ -368,21 +368,28 @@ def is_node_stopped(self):\n     def wait_until_stopped(self, timeout=BITCOIND_PROC_WAIT_TIMEOUT):\n         wait_until_helper(self.is_node_stopped, timeout=timeout, timeout_factor=self.timeout_factor)\n \n+    @property\n+    def chain_path(self) -> str:\n+        return os.path.join(self.datadir, self.chain)\n+\n+    @property\n+    def debug_log_path(self) -> str:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732570270",
      "id" : 732570270,
      "line" : 376,
      "node_id" : "PRRC_kwDOABII584rqiKe",
      "original_commit_id" : "de0a4e084e92d60acf4f8da383f6e0f5bfd535f4",
      "original_line" : 376,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 9,
      "pull_request_review_id" : 784196148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732570270/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T09:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732570270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732572743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732572743"
         }
      },
      "author_association" : "MEMBER",
      "body" : "is this needed? `wait_for_rpc_connection` should already do that by waiting for the mempool to be loaded.",
      "commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "created_at" : "2021-10-20T09:15:08Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732572743",
      "id" : 732572743,
      "line" : 55,
      "node_id" : "PRRC_kwDOABII584rqixH",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 55,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 55,
      "pull_request_review_id" : 784196148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732572743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T09:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732572743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732575759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732575759"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't this be an assertion error?",
      "commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "created_at" : "2021-10-20T09:18:45Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732575759",
      "id" : 732575759,
      "line" : 92,
      "node_id" : "PRRC_kwDOABII584rqjgP",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 92,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 92,
      "pull_request_review_id" : 784196148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732575759/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T09:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732575759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732580386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732580386"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Haven't tried this, but what happens when you use:\r\n\r\n```py\r\ntarget_file = node.chain_path.glob(file_patt)[0]",
      "commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "created_at" : "2021-10-20T09:24:30Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)\n+            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 10\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(\"node failed to start\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Test startup errors after removing certain essential files\")\n+\n+        files_to_disturb = {\n+            Path('blocks/index') / '*.ldb': 'Error opening block database.',\n+            Path('chainstate') / '*.ldb': 'Error opening block database.',\n+            Path('blocks') / 'blk*.dat': 'Error loading block database.',\n+        }\n+        chain_path = Path(node.chain_path)\n+\n+        for file_patt, err_fragment in files_to_disturb.items():\n+            target_file = Path(glob.glob(str(chain_path / file_patt))[0])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732580386",
      "id" : 732580386,
      "line" : 141,
      "node_id" : "PRRC_kwDOABII584rqkoi",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 141,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 141,
      "pull_request_review_id" : 784196148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732580386/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T09:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732580386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732750839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732750839"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So I actually made this change last night... but the problem is that this is actually hit pretty routinely (about every third run) on master (but oddly not on @dongcarl's #23280?). Each time I manually checked the debug.log and saw the `loadblk thread started` line, so I'm not sure how the Python code would be missing that as-written. I'll investigate a bit because I agree, an assertion here would be preferable.",
      "commit_id" : "1768b272871c3f461159d3eca8a588c8c7dd57ff",
      "created_at" : "2021-10-20T13:00:07Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732750839",
      "id" : 732750839,
      "in_reply_to_id" : 732575759,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rrOP3",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 92,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784450616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732750839/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T13:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732750839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732788935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732788935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, because I think it's important to explicitly verify that the number of blocks that the setup dictated (200) are present. This is to check for the case where, for example, the block index somehow gets screwed up and fewer blocks are loaded than the original count, despite having loaded the mempool successfully. But am I missing some reason this isn't necessary?",
      "commit_id" : "1768b272871c3f461159d3eca8a588c8c7dd57ff",
      "created_at" : "2021-10-20T13:40:24Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732788935",
      "id" : 732788935,
      "in_reply_to_id" : 732572743,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584rrXjH",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 53,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 53,
      "pull_request_review_id" : 784503652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732788935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T13:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732788935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732791744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732791744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wouldn't an assert_equal be a better choice then?",
      "commit_id" : "1768b272871c3f461159d3eca8a588c8c7dd57ff",
      "created_at" : "2021-10-20T13:43:11Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732791744",
      "id" : 732791744,
      "in_reply_to_id" : 732572743,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584rrYPA",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 53,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 53,
      "pull_request_review_id" : 784507576,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732791744/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T13:43:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732791744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732794397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732794397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Works, but had to add a `list(...)` and `str(file_patt)`. Still probably better than what I had.",
      "commit_id" : "1768b272871c3f461159d3eca8a588c8c7dd57ff",
      "created_at" : "2021-10-20T13:45:42Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)\n+            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 10\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(\"node failed to start\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Test startup errors after removing certain essential files\")\n+\n+        files_to_disturb = {\n+            Path('blocks/index') / '*.ldb': 'Error opening block database.',\n+            Path('chainstate') / '*.ldb': 'Error opening block database.',\n+            Path('blocks') / 'blk*.dat': 'Error loading block database.',\n+        }\n+        chain_path = Path(node.chain_path)\n+\n+        for file_patt, err_fragment in files_to_disturb.items():\n+            target_file = Path(glob.glob(str(chain_path / file_patt))[0])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732794397",
      "id" : 732794397,
      "in_reply_to_id" : 732580386,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rrY4d",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 141,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784511389,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732794397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T13:45:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732794397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732818942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732818942"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, what, to avoid a timeout? I guess that makes sense.",
      "commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "created_at" : "2021-10-20T14:09:47Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732818942",
      "id" : 732818942,
      "in_reply_to_id" : 732572743,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rre3-",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 53,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784545939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732818942/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T14:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732818942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732820513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732820513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is the point of `str(Path(str()))`? Just use str?",
      "commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "created_at" : "2021-10-20T14:11:07Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)\n+            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 10\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(\"node failed to start\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Test startup errors after removing certain essential files\")\n+\n+        files_to_disturb = {\n+            Path('blocks/index') / '*.ldb': 'Error opening block database.',\n+            Path('chainstate') / '*.ldb': 'Error opening block database.',\n+            Path('blocks') / 'blk*.dat': 'Error loading block database.',\n+        }\n+        chain_path = Path(node.chain_path)\n+\n+        for file_patt, err_fragment in files_to_disturb.items():\n+            target_file = Path(glob.glob(str(chain_path / file_patt))[0])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732820513",
      "id" : 732820513,
      "in_reply_to_id" : 732580386,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rrfQh",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 141,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784548121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732820513/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T14:11:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732820513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732832006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732832006"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Okay I don't understand what you're saying anymore so if you want me to change it, suggest a patch.",
      "commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "created_at" : "2021-10-20T14:22:23Z",
      "diff_hunk" : "@@ -0,0 +1,171 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import glob\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            log_path = Path(node.debug_log_path)\n+            log_path.unlink()\n+            log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.warning(f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)\n+            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 10\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(\"node failed to start\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Test startup errors after removing certain essential files\")\n+\n+        files_to_disturb = {\n+            Path('blocks/index') / '*.ldb': 'Error opening block database.',\n+            Path('chainstate') / '*.ldb': 'Error opening block database.',\n+            Path('blocks') / 'blk*.dat': 'Error loading block database.',\n+        }\n+        chain_path = Path(node.chain_path)\n+\n+        for file_patt, err_fragment in files_to_disturb.items():\n+            target_file = Path(glob.glob(str(chain_path / file_patt))[0])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732832006",
      "id" : 732832006,
      "in_reply_to_id" : 732580386,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rriEG",
      "original_commit_id" : "71ba24a724556af02901d2aa06a71d24e18f6f3c",
      "original_line" : 141,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784564247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732832006/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T14:22:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732832006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732833879"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732833879"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            'blocks/index/*.ldb': 'Error opening block database.',\r\n            'chainstate/*.ldb': 'Error opening block database.',\r\n            'blocks/blk*.dat': 'Error loading block database.',\r\n        }\r\n\r\n        for file_patt, err_fragment in files_to_disturb.items():\r\n            target_file = list(node.chain_path.glob(file_patt))[0]\r\n```",
      "commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "created_at" : "2021-10-20T14:24:09Z",
      "diff_hunk" : "@@ -0,0 +1,174 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                # XXX mysteriously, if we remove this log statement the test\n+                # will occasionally fail by missing the 'loadblk thread start'\n+                # line and hitting the 'missed line' AssertionError. I think\n+                # this may be some kind of overzealous-optimization bug in\n+                # CPython but I really don't know.\n+                self.log.debug(f'saw logline: {line}')\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    raise AssertionError(\n+                        f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)\n+            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 10\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(\"node failed to start\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Test startup errors after removing certain essential files\")\n+\n+        files_to_disturb = {\n+            Path('blocks/index') / '*.ldb': 'Error opening block database.',\n+            Path('chainstate') / '*.ldb': 'Error opening block database.',\n+            Path('blocks') / 'blk*.dat': 'Error loading block database.',\n+        }\n+\n+        for file_patt, err_fragment in files_to_disturb.items():\n+            target_file = list(node.chain_path.glob(str(file_patt)))[0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732833879",
      "id" : 732833879,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rrihX",
      "original_commit_id" : "c870ee0d95459e50f01e6eb24b1e0e29df5a260d",
      "original_line" : 144,
      "original_position" : 144,
      "original_start_line" : 138,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784566732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732833879/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-20T14:25:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732833879",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I also encountered the intermittent Error: txindex best block of the index goes beyond pruned data once while running the new test yesterday - what is the best way to proceed? Should that issue be analysed/fixed before merging this?\r\n\r\nOn the one hand, holding off on merging test coverage because there may be a bug in master seems wrong. On the other hand, spurious test failures in CI for a hard-to-track-down bug will be annoying.\r\n\r\nFor context and neither here nor there: this bug seems pretty minor - under very particular circumstances (SIGTERM during just the right init point) it may cause a user to have to reindex. But that said, we should certainly have a better understanding of why it's happening.",
      "created_at" : "2021-10-20T14:26:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-947721502",
      "id" : 947721502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844fRUe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947721502/reactions"
      },
      "updated_at" : "2021-10-20T14:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947721502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If txindex is causing issues here, maybe submit it in a follow-up pull request?",
      "created_at" : "2021-10-20T14:28:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-947723762",
      "id" : 947723762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844fR3y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947723762/reactions"
      },
      "updated_at" : "2021-10-20T14:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947723762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732839745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732839745"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, thanks.",
      "commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "created_at" : "2021-10-20T14:29:30Z",
      "diff_hunk" : "@@ -0,0 +1,174 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            node.waitforblockheight(200)\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                # XXX mysteriously, if we remove this log statement the test\n+                # will occasionally fail by missing the 'loadblk thread start'\n+                # line and hitting the 'missed line' AssertionError. I think\n+                # this may be some kind of overzealous-optimization bug in\n+                # CPython but I really don't know.\n+                self.log.debug(f'saw logline: {line}')\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    raise AssertionError(\n+                        f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)\n+            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 10\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(\"node failed to start\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Test startup errors after removing certain essential files\")\n+\n+        files_to_disturb = {\n+            Path('blocks/index') / '*.ldb': 'Error opening block database.',\n+            Path('chainstate') / '*.ldb': 'Error opening block database.',\n+            Path('blocks') / 'blk*.dat': 'Error loading block database.',\n+        }\n+\n+        for file_patt, err_fragment in files_to_disturb.items():\n+            target_file = list(node.chain_path.glob(str(file_patt)))[0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732839745",
      "id" : 732839745,
      "in_reply_to_id" : 732833879,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rrj9B",
      "original_commit_id" : "c870ee0d95459e50f01e6eb24b1e0e29df5a260d",
      "original_line" : 144,
      "original_position" : 144,
      "original_start_line" : 138,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784574837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732839745/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-20T14:29:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732839745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732893288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732893288"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you explain why `str()` is needed here? It should be possible to open a Path in python",
      "commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "created_at" : "2021-10-20T15:22:08Z",
      "diff_hunk" : "@@ -368,21 +369,28 @@ def is_node_stopped(self):\n     def wait_until_stopped(self, timeout=BITCOIND_PROC_WAIT_TIMEOUT):\n         wait_until_helper(self.is_node_stopped, timeout=timeout, timeout_factor=self.timeout_factor)\n \n+    @property\n+    def chain_path(self) -> Path:\n+        return Path(self.datadir) / self.chain\n+\n+    @property\n+    def debug_log_path(self) -> Path:\n+        return self.chain_path / 'debug.log'\n+\n     @contextlib.contextmanager\n     def assert_debug_log(self, expected_msgs, unexpected_msgs=None, timeout=2):\n         if unexpected_msgs is None:\n             unexpected_msgs = []\n         time_end = time.time() + timeout * self.timeout_factor\n-        debug_log = os.path.join(self.datadir, self.chain, 'debug.log')\n-        with open(debug_log, encoding='utf-8') as dl:\n+        with open(str(self.debug_log_path), encoding='utf-8') as dl:\n             dl.seek(0, 2)\n             prev_size = dl.tell()\n \n         yield\n \n         while True:\n             found = True\n-            with open(debug_log, encoding='utf-8') as dl:\n+            with open(str(self.debug_log_path), encoding='utf-8') as dl:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732893288",
      "id" : 732893288,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rrxBo",
      "original_commit_id" : "ff2fedef5d67f8a5e5581b23de61d695135c751d",
      "original_line" : 393,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 784649277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732893288/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T15:22:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732893288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732897381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732897381"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Weird, thought I'd started off by doing that and then had to add `str`. Fixed.",
      "commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "created_at" : "2021-10-20T15:26:29Z",
      "diff_hunk" : "@@ -368,21 +369,28 @@ def is_node_stopped(self):\n     def wait_until_stopped(self, timeout=BITCOIND_PROC_WAIT_TIMEOUT):\n         wait_until_helper(self.is_node_stopped, timeout=timeout, timeout_factor=self.timeout_factor)\n \n+    @property\n+    def chain_path(self) -> Path:\n+        return Path(self.datadir) / self.chain\n+\n+    @property\n+    def debug_log_path(self) -> Path:\n+        return self.chain_path / 'debug.log'\n+\n     @contextlib.contextmanager\n     def assert_debug_log(self, expected_msgs, unexpected_msgs=None, timeout=2):\n         if unexpected_msgs is None:\n             unexpected_msgs = []\n         time_end = time.time() + timeout * self.timeout_factor\n-        debug_log = os.path.join(self.datadir, self.chain, 'debug.log')\n-        with open(debug_log, encoding='utf-8') as dl:\n+        with open(str(self.debug_log_path), encoding='utf-8') as dl:\n             dl.seek(0, 2)\n             prev_size = dl.tell()\n \n         yield\n \n         while True:\n             found = True\n-            with open(debug_log, encoding='utf-8') as dl:\n+            with open(str(self.debug_log_path), encoding='utf-8') as dl:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732897381",
      "id" : 732897381,
      "in_reply_to_id" : 732893288,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rryBl",
      "original_commit_id" : "ff2fedef5d67f8a5e5581b23de61d695135c751d",
      "original_line" : 393,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 784655013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732897381/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T15:26:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732897381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732909184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732909184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, the file name could go out of date without being noticed\r\n```suggestion\r\n\"\"\"Stress tests related to node initialization.\"\"\"\r\n```",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-20T15:39:05Z",
      "diff_hunk" : "@@ -0,0 +1,175 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732909184",
      "id" : 732909184,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rr06A",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 5,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784671386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732909184/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T16:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732909184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732910239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732910239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sort\r\n```diff\r\n-import time\r\n-import random\r\n import os\r\n from pathlib import Path\r\n+import random\r\n+import time\r\n```\r\n",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-20T15:40:11Z",
      "diff_hunk" : "@@ -0,0 +1,175 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732910239",
      "id" : 732910239,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII584rr1Kf",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 9,
      "pull_request_review_id" : 784671386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732910239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T16:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732910239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732914870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732914870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This would be simpler, I think.\r\n```suggestion\r\n            assert_equal(200, node.getblockcount())\r\n```",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-20T15:45:16Z",
      "diff_hunk" : "@@ -0,0 +1,175 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockchaininfo()['blocks'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732914870",
      "id" : 732914870,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rr2S2",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 54,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784671386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732914870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T16:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732914870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732917765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732917765"
         }
      },
      "author_association" : "MEMBER",
      "body" : "maybe better to snakecase this localvar throughout, as the variable name is reused with a different value in a different scope below\r\n```suggestion\r\n            max_seconds_to_wait = 30\r\n```",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-20T15:48:18Z",
      "diff_hunk" : "@@ -0,0 +1,175 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockchaininfo()['blocks'])\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732917765",
      "id" : 732917765,
      "line" : 78,
      "node_id" : "PRRC_kwDOABII584rr3AF",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 78,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 78,
      "pull_request_review_id" : 784671386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732917765/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T16:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732917765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732925146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732925146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be nice to be able to omit this, as it renders the `debug` log level difficult to follow.\r\n\r\nSome other logging suggestions to clean up the output:\r\n```diff\r\n         for bail_line in lines_to_bail_after:\r\n-            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\r\n+            self.log.debug(f\"Starting node and will exit after line '{bail_line}'\")\r\n             node.start(extra_args=['-txindex=1'])\r\n             logfile = open(node.debug_log_path, 'r', encoding='utf8')\r\n \r\n@@ -90,7 +90,7 @@ class InitStressTest(BitcoinTestFramework):\r\n                 self.log.debug(f'saw logline: {line}')\r\n \r\n                 if line and bail_line.lower() in line.lower():\r\n-                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\r\n+                    self.log.debug(f\"Terminating node after {num_lines} log lines seen\")\r\n                     sigterm_node()\r\n                     break\r\n \r\n@@ -109,7 +109,7 @@ class InitStressTest(BitcoinTestFramework):\r\n         for _ in range(40):\r\n             # Startup usually creates ~70 log lines\r\n             terminate_after = random.randint(1, 80)\r\n-            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\r\n+            self.log.debug(f\"Starting node and will exit after {terminate_after} lines\")\r\n             node.start(extra_args=['-txindex=1'])\r\n             logfile = open(node.debug_log_path, 'r', encoding='utf8')\r\n \r\n@@ -123,7 +123,7 @@ class InitStressTest(BitcoinTestFramework):\r\n                     num_lines += 1\r\n \r\n                 if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\r\n-                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\r\n+                    self.log.debug(f\"Terminating node after {num_lines} log lines seen\")\r\n                     sigterm_node()\r\n                     break\r\n \r\n@@ -144,7 +144,7 @@ class InitStressTest(BitcoinTestFramework):\r\n         for file_patt, err_fragment in files_to_disturb.items():\r\n             target_file = list(node.chain_path.glob(file_patt))[0]\r\n \r\n-            self.log.info(f\"tweaking file to ensure failure {target_file}\")\r\n+            self.log.info(f\"Tweaking file to ensure failure {target_file}\")\r\n             bak_path = str(target_file) + \".bak\"\r\n             target_file.rename(bak_path)\r\n \r\n@@ -165,7 +165,7 @@ class InitStressTest(BitcoinTestFramework):\r\n                 match=ErrorMatch.PARTIAL_REGEX,\r\n             )\r\n \r\n-            self.log.info(f\"restoring file from {bak_path} and restarting\")\r\n+            self.log.info(f\"Restoring file from {bak_path} and restarting\")\r\n             Path(bak_path).rename(target_file)\r\n             check_clean_start()\r\n             self.stop_node(0)\r\n```\r\n",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-20T15:56:31Z",
      "diff_hunk" : "@@ -0,0 +1,175 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockchaininfo()['blocks'])\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Verifying wallet',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                # XXX mysteriously, if we remove this log statement the test\n+                # will occasionally fail by missing the 'loadblk thread start'\n+                # line and hitting the 'missed line' AssertionError. I think\n+                # this may be some kind of overzealous-optimization bug in\n+                # CPython but I really don't know.\n+                self.log.debug(f'saw logline: {line}')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732925146",
      "id" : 732925146,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rr4za",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 90,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 784671386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732925146/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T16:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732925146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732926715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732926715"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, sort\r\n```diff\r\n@@ -13,6 +13,7 @@ import json\r\n import decimal\r\n from enum import Enum\r\n import errno\r\n import http.client\r\n import json\r\n import logging\r\n import os\r\n+from pathlib import Path\r\n import re\r\n import subprocess\r\n import tempfile\r\n import time\r\n import urllib.parse\r\n import collections\r\n import shlex\r\n import sys\r\n-from pathlib import Path\r\n``\r\n",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-20T15:58:23Z",
      "diff_hunk" : "@@ -20,6 +20,7 @@\n import collections\n import shlex\n import sys\n+from pathlib import Path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r732926715",
      "id" : 732926715,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII584rr5L7",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 23,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 4,
      "pull_request_review_id" : 784671386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732926715/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T16:20:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732926715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> For context and neither here nor there: this bug seems pretty minor - under very particular circumstances (SIGTERM during just the right init point) it may cause a user to have to reindex. But that said, we should certainly have a better understanding of why it's happening.\r\n\r\nI see different things locally: For me, the failure happens in roughly 1-2% of the runs in the `will exit after line 'txindex thread start'` run, whereas `check_clean_start` of the previous run for `loadblk` still passes. \r\nAccordingly, if I remove all lines except `txindex thread start` from `lines_to_bail_after`, I'll still get occasional fails (without any SIGTERM involved), so the failure does seem to occur \"unprovoked\".",
      "created_at" : "2021-10-20T17:37:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-947890550",
      "id" : 947890550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844f6l2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947890550/reactions"
      },
      "updated_at" : "2021-10-20T17:37:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947890550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-10-21T01:53:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-948184596",
      "id" : 948184596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844hCYU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948184596/reactions"
      },
      "updated_at" : "2021-10-21T01:53:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948184596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733580834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733580834"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This comment was marked resolved, but the imports are still unsorted.",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-21T11:28:28Z",
      "diff_hunk" : "@@ -0,0 +1,175 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733580834",
      "id" : 733580834,
      "in_reply_to_id" : 732910239,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII584ruY4i",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 9,
      "pull_request_review_id" : 785561577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733580834/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T11:28:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733580834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733584445"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733584445"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"to bail\" is a bit colloquial and may not be understood by non-native english speakers. It might be better to use a more standard, technical term such as \"to terminate\".",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-21T11:33:52Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733584445",
      "id" : 733584445,
      "line" : 28,
      "node_id" : "PRRC_kwDOABII584ruZw9",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 28,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 28,
      "pull_request_review_id" : 785566556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733584445/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T12:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733584445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733597570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733597570"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Doing this will probably make it more difficult to debug failures, since the bitcoind log is erased. For example, the second time I ran this test, I hit the following failure:\r\n\r\n<details>\r\n<summary>Log</summary>\r\n\r\n```\r\n ./test/functional/feature_init.py --nocleanup\r\n2021-10-21T11:43:53.709000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_lh9p1xfw\r\n2021-10-21T11:43:54.157000Z TestFramework (INFO): Starting node and will exit after line 'scheduler thread start'\r\n2021-10-21T11:43:54.164000Z TestFramework (INFO): terminating node after 49 log lines seen\r\n2021-10-21T11:43:54.165000Z TestFramework (INFO): Starting node and will exit after line 'Loading P2P addresses'\r\n2021-10-21T11:43:54.308000Z TestFramework (INFO): terminating node after 66 log lines seen\r\n2021-10-21T11:43:54.317000Z TestFramework (INFO): Starting node and will exit after line 'Loading banlist'\r\n2021-10-21T11:43:54.461000Z TestFramework (INFO): terminating node after 69 log lines seen\r\n2021-10-21T11:43:54.469000Z TestFramework (INFO): Starting node and will exit after line 'Loading block index'\r\n2021-10-21T11:43:54.619000Z TestFramework (INFO): terminating node after 81 log lines seen\r\n2021-10-21T11:43:54.626000Z TestFramework (INFO): Starting node and will exit after line 'Switching active chainstate'\r\n2021-10-21T11:43:54.773000Z TestFramework (INFO): terminating node after 82 log lines seen\r\n2021-10-21T11:43:54.781000Z TestFramework (INFO): Starting node and will exit after line 'Loaded best chain:'\r\n2021-10-21T11:43:54.927000Z TestFramework (INFO): terminating node after 92 log lines seen\r\n2021-10-21T11:43:54.935000Z TestFramework (INFO): Starting node and will exit after line 'init message: Verifying blocks'\r\n2021-10-21T11:43:55.082000Z TestFramework (INFO): terminating node after 93 log lines seen\r\n2021-10-21T11:43:55.090000Z TestFramework (INFO): Starting node and will exit after line 'loadblk thread start'\r\n2021-10-21T11:43:55.240000Z TestFramework (INFO): terminating node after 115 log lines seen\r\n2021-10-21T11:43:55.359000Z TestFramework (INFO): Starting node and will exit after line 'txindex thread start'\r\n2021-10-21T11:43:55.517000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/home/vagrant/bitcoin/test/functional/test_framework/test_framework.py\", line 132, in main\r\n    self.run_test()\r\n  File \"./test/functional/feature_init.py\", line 103, in run_test\r\n    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\r\nAssertionError: node failed to start (line: 'txindex thread start')\r\n2021-10-21T11:43:55.569000Z TestFramework (INFO): Stopping nodes\r\nTraceback (most recent call last):\r\n  File \"./test/functional/feature_init.py\", line 176, in <module>\r\n    InitStressTest().main()\r\n  File \"/home/vagrant/bitcoin/test/functional/test_framework/test_framework.py\", line 155, in main\r\n    exit_code = self.shutdown()\r\n  File \"/home/vagrant/bitcoin/test/functional/test_framework/test_framework.py\", line 304, in shutdown\r\n    self.stop_nodes()\r\n  File \"/home/vagrant/bitcoin/test/functional/test_framework/test_framework.py\", line 555, in stop_nodes\r\n    node.stop_node(wait=wait, wait_until_stopped=False)\r\n  File \"/home/vagrant/bitcoin/test/functional/test_framework/test_node.py\", line 336, in stop_node\r\n    self.stop(wait=wait)\r\n  File \"/home/vagrant/bitcoin/test/functional/test_framework/test_node.py\", line 184, in __getattr__\r\n    assert self.rpc_connected and self.rpc is not None, self._node_msg(\"Error: no RPC connection\")\r\nAssertionError: [node 0] Error: no RPC connection\r\n[node 0] Cleaning up leftover process\r\n```\r\n</details>\r\n\r\nThe bitcoind debug log and combined logs would be more helpful if they were complete.",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-21T11:52:23Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733597570",
      "id" : 733597570,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII584ruc-C",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 47,
      "pull_request_review_id" : 785566556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733597570/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T12:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733597570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733598115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733598115"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This feels a little bit verbose for info logging. I'd suggest moving to debug. Same for the \"terminating node after\" log below.",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-21T11:53:10Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockcount())\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        if self.is_wallet_compiled():\n+            lines_to_bail_after.append('Verifying wallet')\n+\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733598115",
      "id" : 733598115,
      "line" : 74,
      "node_id" : "PRRC_kwDOABII584rudGj",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 74,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 74,
      "pull_request_review_id" : 785566556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733598115/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T12:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733598115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733609265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733609265"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This results in very verbose test logs",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-21T12:09:06Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockcount())\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        if self.is_wallet_compiled():\n+            lines_to_bail_after.append('Verifying wallet')\n+\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+                    # XXX mysteriously, if we remove this log statement the test\n+                    # will occasionally fail by missing the 'loadblk thread start'\n+                    # line and hitting the 'missed line' AssertionError. I think\n+                    # this may be some kind of overzealous-optimization bug in\n+                    # CPython but I really don't know.\n+                    self.log.debug(f'saw logline: {line}')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733609265",
      "id" : 733609265,
      "line" : 91,
      "node_id" : "PRRC_kwDOABII584ruf0x",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 91,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 91,
      "pull_request_review_id" : 785566556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733609265/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T12:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733609265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733610131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733610131"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's generally better to leave TODOs out of the source and track them as issues, so that they can be discussed/amended/removed.",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-21T12:10:14Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockcount())\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        if self.is_wallet_compiled():\n+            lines_to_bail_after.append('Verifying wallet')\n+\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+                    # XXX mysteriously, if we remove this log statement the test\n+                    # will occasionally fail by missing the 'loadblk thread start'\n+                    # line and hitting the 'missed line' AssertionError. I think\n+                    # this may be some kind of overzealous-optimization bug in\n+                    # CPython but I really don't know.\n+                    self.log.debug(f'saw logline: {line}')\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    raise AssertionError(\n+                        f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)\n+            self.log.info(f\"Starting node and will exit after {terminate_after} lines\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 10\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+\n+                if num_lines >= terminate_after or (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(\"node failed to start\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Test startup errors after removing certain essential files\")\n+\n+        files_to_disturb = {\n+            'blocks/index/*.ldb': 'Error opening block database.',\n+            'chainstate/*.ldb': 'Error opening block database.',\n+            'blocks/blk*.dat': 'Error loading block database.',\n+        }\n+\n+        for file_patt, err_fragment in files_to_disturb.items():\n+            target_file = list(node.chain_path.glob(file_patt))[0]\n+\n+            self.log.info(f\"tweaking file to ensure failure {target_file}\")\n+            bak_path = str(target_file) + \".bak\"\n+            target_file.rename(bak_path)\n+\n+            # TODO: at some point, we should test perturbing the files instead of removing\n+            # them, e.g.\n+            #\n+            # contents = target_file.read_bytes()\n+            # tweaked_contents = bytearray(contents)\n+            # tweaked_contents[50:250] = b'1' * 200\n+            # target_file.write_bytes(bytes(tweaked_contents))\n+            #\n+            # At the moment I can't get this to work (bitcoind loads successfully?) so\n+            # investigate doing this later.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733610131",
      "id" : 733610131,
      "line" : 161,
      "node_id" : "PRRC_kwDOABII584rugCT",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 161,
      "original_position" : 161,
      "original_start_line" : 152,
      "path" : "test/functional/feature_init.py",
      "position" : 161,
      "pull_request_review_id" : 785566556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733610131/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 152,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-21T12:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733610131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733616552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733616552"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a way to derive this value programatically from the subtests above? I imagine it could change over time as log lines are added/removed in bitcoind, and this value would become outdated.",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-21T12:18:56Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockcount())\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        if self.is_wallet_compiled():\n+            lines_to_bail_after.append('Verifying wallet')\n+\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+                    # XXX mysteriously, if we remove this log statement the test\n+                    # will occasionally fail by missing the 'loadblk thread start'\n+                    # line and hitting the 'missed line' AssertionError. I think\n+                    # this may be some kind of overzealous-optimization bug in\n+                    # CPython but I really don't know.\n+                    self.log.debug(f'saw logline: {line}')\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    raise AssertionError(\n+                        f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r733616552",
      "id" : 733616552,
      "line" : 112,
      "node_id" : "PRRC_kwDOABII584ruhmo",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 112,
      "original_position" : 112,
      "original_start_line" : 111,
      "path" : "test/functional/feature_init.py",
      "position" : 112,
      "pull_request_review_id" : 785566556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733616552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 111,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-21T12:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733616552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r735159180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/735159180"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I have found the cause for the intermittent failures, it's related to #15946, see `index/base.cpp`:\r\n\r\nIt happens when the node starts with `-txindex=1` but `ThreadSync` is interrupted after it sets `m_best_block_index` to Genesis, and before it gets do any further work (like indexing the next block).\r\n\r\nThen, with the next restart, `BaseIndex::Init()` tries to check whether we know the last synced block of the partially synced index (which we might not if we were pruning, but do in this case).\r\n\r\nThe problem is now that the loop\r\n `while (block_to_test && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA))`\r\nin `BaseIndex::Init() ` won't set `prune_violation` to false because `block_to_test` is Genesis, `block->pprev` evaluates to `false`, so the comparison `block_to_test == block` isn't reached.\r\n\r\nSince I knew next to nothing about the indexes before looking into this: Do reviewers think that the correct way to fix this would be to rewrite the while loop in `Init()` to  also check `block_to_test == block` in case of the Genesis block?",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-24T19:18:32Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r735159180",
      "id" : 735159180,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584r0aOM",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 52,
      "pull_request_review_id" : 787544697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/735159180/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-24T19:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/735159180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r735979548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/735979548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think you have identified the right cause. I obtained a datadir from jamesob that triggers the \"Error: txindex best block of the index goes beyond pruned data...\" error on master when run with the following invocation:\r\n\r\n```bash\r\n./src/bitcoind -txindex=1 -datadir=$PWD/james-datadir/home/james/tmp/bitcoin_func_test_cf43f1hi/node0/\r\n```\r\n\r\nNow, if I apply the following (very naive, should not be merged) patch, the above invocation no longer fails and `bitcoind` operates normally:\r\n\r\n```diff\r\ndiff --git a/src/index/base.cpp b/src/index/base.cpp\r\nindex fc6dd77a72..7549ae5d57 100644\r\n--- a/src/index/base.cpp\r\n+++ b/src/index/base.cpp\r\n@@ -98,6 +98,9 @@ bool BaseIndex::Init()\r\n                 }\r\n                 block = block->pprev;\r\n             }\r\n+            if (prune_violation) {\r\n+                prune_violation = block_to_test != active_chain.Genesis();\r\n+            }\r\n         }\r\n         if (prune_violation) {\r\n             return InitError(strprintf(Untranslated(\"%s best block of the index goes beyond pruned data. Please disable the index or reindex (which will download the whole blockchain again)\"), GetName()));\r\n```",
      "commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "created_at" : "2021-10-25T21:25:46Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r735979548",
      "id" : 735979548,
      "in_reply_to_id" : 735159180,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584r3igc",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 52,
      "pull_request_review_id" : 788635690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/735979548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-25T21:25:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/735979548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#10102](https://github.com/bitcoin/bitcoin/pull/10102) (Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-10-26T06:02:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-951589284",
      "id" : 951589284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844uBmk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951589284/reactions"
      },
      "updated_at" : "2021-11-30T23:13:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951589284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736701015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736701015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If txindex is causing issues, maybe remove it for now and add it in a later pull?",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-10-26T16:04:44Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736701015",
      "id" : 736701015,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584r6SpX",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 789617600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736701015/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-26T16:04:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736701015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736725588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736725588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorted imports are not in the Python style guide. I think keeping them sorted is an unnecessary burden to authors and reviewers.",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-10-26T16:33:41Z",
      "diff_hunk" : "@@ -0,0 +1,175 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization (init.cpp).\"\"\"\n+import time\n+import random\n+import os\n+from pathlib import Path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736725588",
      "id" : 736725588,
      "in_reply_to_id" : 732910239,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII584r6YpU",
      "original_commit_id" : "b32f5a5f9bf2d04c03dd553bfd53f781238e1e10",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 9,
      "pull_request_review_id" : 789650802,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736725588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-26T16:33:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736725588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736728442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736728442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, will do.",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-10-26T16:37:21Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736728442",
      "id" : 736728442,
      "in_reply_to_id" : 736701015,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584r6ZV6",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 789654569,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736728442/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-26T16:37:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736728442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736739979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736739979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-10-26T16:50:47Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736739979",
      "id" : 736739979,
      "in_reply_to_id" : 733584445,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584r6cKL",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 28,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 789670809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736739979/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-26T16:50:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736739979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736740209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736740209"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, done.",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-10-26T16:51:03Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])\n+            node.wait_for_rpc_connection()\n+            assert_equal(200, node.getblockcount())\n+\n+        lines_to_bail_after = [\n+            'scheduler thread start',\n+            'Loading P2P addresses',\n+            'Loading banlist',\n+            'Loading block index',\n+            'Switching active chainstate',\n+            'Loaded best chain:',\n+            'init message: Verifying blocks',\n+            'loadblk thread start',\n+            'txindex thread start',\n+            'net thread start',\n+            'addcon thread start',\n+            'msghand thread start',\n+        ]\n+        if self.is_wallet_compiled():\n+            lines_to_bail_after.append('Verifying wallet')\n+\n+        for bail_line in lines_to_bail_after:\n+            self.log.info(f\"Starting node and will exit after line '{bail_line}'\")\n+            node.start(extra_args=['-txindex=1'])\n+            logfile = open(node.debug_log_path, 'r', encoding='utf8')\n+\n+            MAX_SECS_TO_WAIT = 30\n+            start = time.time()\n+            num_lines = 0\n+\n+            while True:\n+                line = logfile.readline()\n+                if line:\n+                    num_lines += 1\n+                    # XXX mysteriously, if we remove this log statement the test\n+                    # will occasionally fail by missing the 'loadblk thread start'\n+                    # line and hitting the 'missed line' AssertionError. I think\n+                    # this may be some kind of overzealous-optimization bug in\n+                    # CPython but I really don't know.\n+                    self.log.debug(f'saw logline: {line}')\n+\n+                if line and bail_line.lower() in line.lower():\n+                    self.log.info(f\"terminating node after {num_lines} log lines seen\")\n+                    sigterm_node()\n+                    break\n+\n+                if (time.time() - start) > MAX_SECS_TO_WAIT:\n+                    raise AssertionError(\n+                        f\"missed line {bail_line}; bailing now after {num_lines} lines\")\n+\n+                if node.process.poll() is not None:\n+                    raise AssertionError(f\"node failed to start (line: '{bail_line}')\")\n+\n+        check_clean_start()\n+        self.stop_node(0)\n+\n+        self.log.info(\"Terminate at some random point in the init process\")\n+\n+        for _ in range(40):\n+            # Startup usually creates ~70 log lines\n+            terminate_after = random.randint(1, 80)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736740209",
      "id" : 736740209,
      "in_reply_to_id" : 733616552,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584r6cNx",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 112,
      "original_position" : 112,
      "original_start_line" : 111,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 789671091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736740209/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-26T16:51:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736740209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736740690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736740690"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice detective work, guys! I'm going to follow @MarcoFalke's advice and disable txindex here, but create an issue to follow this up.",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-10-26T16:51:40Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()\n+            node.debug_log_path.touch()\n+\n+        def check_clean_start():\n+            \"\"\"Ensure that node restarts successfully after various interrupts.\"\"\"\n+            node.start(extra_args=['-txindex=1'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r736740690",
      "id" : 736740690,
      "in_reply_to_id" : 735159180,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584r6cVS",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : null,
      "pull_request_review_id" : 789671759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736740690/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-26T16:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736740690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Okay, I've addressed a bunch of feedback and disabled txindex for the time being. I think this is a good first pass on this test provided all the non-deterministic failures have been removed. @mzumsande/@dongcarl if you'd like to PR the indexing change and fix you're welcome to, otherwise I can take care of it shortly.",
      "created_at" : "2021-10-26T19:06:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-952228571",
      "id" : 952228571,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844wdrb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952228571/reactions"
      },
      "updated_at" : "2021-10-26T19:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952228571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Okay, I've addressed a bunch of feedback and disabled txindex for the time being. I think this is a good first pass on this test provided all the non-deterministic failures have been removed. @mzumsande/@dongcarl if you'd like to PR the indexing change and fix you're welcome to, otherwise I can take care of it shortly.\r\n\r\nI opened #23365 to fix the intermittent issue.",
      "created_at" : "2021-10-26T22:07:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-952364073",
      "id" : 952364073,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5844w-wp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952364073/reactions"
      },
      "updated_at" : "2021-10-26T22:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952364073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-11-10T12:28:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-965084690",
      "id" : 965084690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5845hgYS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/965084690/reactions"
      },
      "updated_at" : "2021-11-10T12:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/965084690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Anything left here? I think as things stand this is a stable test that adds some good coverage. AFAIK there's no outstanding feedback aside from a few nits and marginal suggestions.",
      "created_at" : "2021-11-16T16:51:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-970465173",
      "id" : 970465173,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII58452B-V",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/970465173/reactions"
      },
      "updated_at" : "2021-11-16T16:51:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/970465173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-11-30T19:49:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-982965388",
      "id" : 982965388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5846ltyM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/982965388/reactions"
      },
      "updated_at" : "2021-11-30T19:49:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/982965388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r759958889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759958889"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this was not addressed?",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-12-01T08:35:11Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r759958889",
      "id" : 759958889,
      "in_reply_to_id" : 733597570,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII584tTA1p",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 47,
      "pull_request_review_id" : 819945706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759958889/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T08:35:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759958889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm surprised this was merged, given that there were no ACKs on the latest branch, and there were still unresolved approach/implementation issues and comments, eg:\r\n\r\n- https://github.com/bitcoin/bitcoin/pull/23289#discussion_r759958889\r\n- https://github.com/bitcoin/bitcoin/pull/23289#pullrequestreview-785566556",
      "created_at" : "2021-12-01T10:15:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-983491031",
      "id" : 983491031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5846nuHX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983491031/reactions"
      },
      "updated_at" : "2021-12-01T10:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983491031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r760173045"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760173045"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This suggestion is at odds with the nature of the test itself, since the logfile contents determine when to sigterm and so have to be cleared each iteration. \r\n\r\nIf someone would like to improve this test by consuming the node's stdout instead of the logfile, that's one possible improvement suitable for a follow-up.",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-12-01T13:16:12Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r760173045",
      "id" : 760173045,
      "in_reply_to_id" : 733597570,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII584tT1H1",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 47,
      "pull_request_review_id" : 820241696,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760173045/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T13:16:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760173045",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is also the cause of the recent sporadic failures in our CI. See #23646. ",
      "created_at" : "2021-12-02T01:18:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#issuecomment-984204779",
      "id" : 984204779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23289",
      "node_id" : "IC_kwDOABII5846qcXr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984204779/reactions"
      },
      "updated_at" : "2021-12-02T01:18:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984204779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r766615073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766615073"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems odd to delete a file to allow reading it. Why cant this use the same approach like assert_debug_log, that is remember the last read position?",
      "commit_id" : "d9803f7a0a33688f7429cf10384244f4770851ca",
      "created_at" : "2021-12-10T11:45:06Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Stress tests related to node initialization.\"\"\"\n+import random\n+import time\n+import os\n+from pathlib import Path\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.test_node import ErrorMatch\n+from test_framework.util import assert_equal\n+\n+\n+class InitStressTest(BitcoinTestFramework):\n+    \"\"\"\n+    Ensure that initialization can be interrupted at a number of points and not impair\n+    subsequent starts.\n+    \"\"\"\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = False\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"\n+        - test bailing initialization after seeing a certain log line.\n+        - test bailing init after seeing a random number of log lines.\n+        - test removing certain essential files to test startup error paths.\n+        \"\"\"\n+        # TODO: skip Windows for now since it isn't clear how to SIGTERM.\n+        #\n+        # Windows doesn't support `process.terminate()`.\n+        # and other approaches (like below) don't work:\n+        #\n+        #   os.kill(node.process.pid, signal.CTRL_C_EVENT)\n+        if os.name == 'nt':\n+            raise SkipTest(\"can't SIGTERM on Windows\")\n+\n+        self.stop_node(0)\n+        node = self.nodes[0]\n+\n+        def sigterm_node():\n+            node.process.terminate()\n+            node.process.wait()\n+            node.debug_log_path.unlink()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23289#discussion_r766615073",
      "id" : 766615073,
      "in_reply_to_id" : 733597570,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII584tsZ4h",
      "original_commit_id" : "d5f0dd1efd0d1fea7b57b53c6e01e61af895beb5",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/feature_init.py",
      "position" : 47,
      "pull_request_review_id" : 828802243,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766615073/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-10T11:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766615073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
