[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28766).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1807405302), [stickies-v](https://github.com/bitcoin/bitcoin/pull/28766#pullrequestreview-1727118277), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/28766#pullrequestreview-1745321741), [achow101](https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1829876209) |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/28766#pullrequestreview-1708237778) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-11-01T11:03:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1788772413",
      "id" : 1788772413,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qnoA9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788772413/reactions"
      },
      "updated_at" : "2023-11-28T13:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788772413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378700622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378700622"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I'd at least use a range based loop\r\n```suggestion\r\n    bool has_witness{false};\r\n    for (const auto input : vin) {\r\n        if (!input.scriptWitness.IsNull()) {\r\n            has_witness = true;\r\n            break;\r\n        }\r\n    }\r\n```\r\n\r\nbut probably okay to refactor to use `algorithm`?\r\n\r\n```suggestion\r\n    bool has_witness = std::any_of(vin.begin(), vin.end(), [](const auto& input) {\r\n        return !input.scriptWitness.IsNull();\r\n    });\r\n```",
      "commit_id" : "fed7b918553215b94990d55d7ab8ba9a5cd39b0f",
      "created_at" : "2023-11-01T11:51:19Z",
      "diff_hunk" : "@@ -78,7 +78,15 @@ Txid CTransaction::ComputeHash() const\n \n Wtxid CTransaction::ComputeWitnessHash() const\n {\n-    if (!HasWitness()) {\n+    bool has_witness{false};\n+    for (size_t i = 0; i < vin.size(); i++) {\n+        if (!vin[i].scriptWitness.IsNull()) {\n+            has_witness = true;\n+            break;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378700622",
      "id" : 1378700622,
      "line" : 87,
      "node_id" : "PRRC_kwDOABII585SLU1O",
      "original_commit_id" : "fed7b918553215b94990d55d7ab8ba9a5cd39b0f",
      "original_line" : 87,
      "original_position" : 11,
      "original_start_line" : 81,
      "path" : "src/primitives/transaction.cpp",
      "position" : 11,
      "pull_request_review_id" : 1708054652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378700622/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 81,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-01T12:07:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378700622",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can someone please re-run the \"CI / macOS 13 native\" job, failure seems unrelated.",
      "created_at" : "2023-11-01T11:56:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1788831718",
      "id" : 1788831718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qn2fm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788831718/reactions"
      },
      "updated_at" : "2023-11-01T11:56:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788831718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378705398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378705398"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could simplify return statement too so the whole fn just becomes:\r\n\r\n\r\n```cpp\r\nWtxid CTransaction::ComputeWitnessHash() const\r\n{\r\n    bool has_witness = std::any_of(vin.begin(), vin.end(), [](const auto& input) {\r\n        return !input.scriptWitness.IsNull();\r\n    });\r\n\r\n    return Wtxid::FromUint256(has_witness ? (CHashWriter{0} << *this).GetHash() : hash.ToUint256());\r\n}\r\n```",
      "commit_id" : "fed7b918553215b94990d55d7ab8ba9a5cd39b0f",
      "created_at" : "2023-11-01T11:56:39Z",
      "diff_hunk" : "@@ -78,7 +78,15 @@ Txid CTransaction::ComputeHash() const\n \n Wtxid CTransaction::ComputeWitnessHash() const\n {\n-    if (!HasWitness()) {\n+    bool has_witness{false};\n+    for (size_t i = 0; i < vin.size(); i++) {\n+        if (!vin[i].scriptWitness.IsNull()) {\n+            has_witness = true;\n+            break;\n+        }\n+    }\n+\n+    if (!has_witness) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378705398",
      "id" : 1378705398,
      "line" : 89,
      "node_id" : "PRRC_kwDOABII585SLV_2",
      "original_commit_id" : "fed7b918553215b94990d55d7ab8ba9a5cd39b0f",
      "original_line" : 89,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.cpp",
      "position" : 13,
      "pull_request_review_id" : 1708054652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378705398/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-01T12:07:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378705398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  failure seems unrelated.\r\n\r\nAre you sure?\r\n```bash\r\n Traceback (most recent call last):\r\n  File \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-apple-darwin/test/functional/test_framework/test_framework.py\", line 132, in main\r\n    self.run_test()\r\n  File \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-apple-darwin/test/functional/rpc_createmultisig.py\", line 65, in run_test\r\n    self.do_multisig()\r\n  File \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-apple-darwin/test/functional/rpc_createmultisig.py\", line 241, in do_multisig\r\n    tx = node0.sendrawtransaction(rawtx3[\"hex\"], 0)\r\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-apple-darwin/test/functional/test_framework/coverage.py\", line 50, in __call__\r\n    return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\r\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-apple-darwin/test/functional/test_framework/authproxy.py\", line 129, in __call__\r\n    raise JSONRPCException(response['error'], status)\r\ntest_framework.authproxy.JSONRPCException: mandatory-script-verify-flag-failed (Witness program was passed an empty witness) (-26)\r\n```",
      "created_at" : "2023-11-01T11:58:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1788834198",
      "id" : 1788834198,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qn3GW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788834198/reactions"
      },
      "updated_at" : "2023-11-01T11:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788834198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Are you sure?\r\n\r\nYes, it passes locally.",
      "created_at" : "2023-11-01T12:01:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1788837597",
      "id" : 1788837597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qn37d",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788837597/reactions"
      },
      "updated_at" : "2023-11-01T12:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788837597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Want to document it as an intermittent failure?",
      "created_at" : "2023-11-01T12:04:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1788841475",
      "id" : 1788841475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qn44D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 1,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788841475/reactions"
      },
      "updated_at" : "2023-11-01T12:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788841475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The `rpc_createmultisig.py` test is now failing in two other CI jobs and MSAN is unhappy:\r\n```bash\r\n==19201==WARNING: MemorySanitizer: use-of-uninitialized-value\r\n    #0 0x563f069e85d0 in bcmp /msan/llvm-project/compiler-rt/lib/msan/../sanitizer_common/sanitizer_common_interceptors.inc:856:10\r\n    #1 0x563f0956bff5 in base_blob<256u>::Compare(base_blob<256u> const&) const src/./uint256.h:54:66\r\n    #2 0x563f0956bff5 in operator!=(base_blob<256u> const&, base_blob<256u> const&) src/./uint256.h:57:89\r\n    #3 0x563f0956bff5 in CTransaction::HasWitness() const src/./primitives/transaction.h:370:33\r\n    #4 0x563f0956bff5 in void SerializeTransaction<CHashWriter, CTransaction>(CTransaction const&, CHashWriter&) src/./primitives/transaction.h:265:16\r\n    #5 0x563f09569863 in void CTransaction::Serialize<CHashWriter>(CHashWriter&) const src/./primitives/transaction.h:326:9\r\n    #6 0x563f09569863 in void Serialize<CHashWriter, CTransaction>(CHashWriter&, CTransaction const&) src/./serialize.h:776:7\r\n    #7 0x563f09569863 in CHashWriter& CHashWriter::operator<<<CTransaction>(CTransaction const&) src/./hash.h:161:9\r\n    #8 0x563f09569863 in CTransaction::ComputeWitnessHash() const src/primitives/transaction.cpp:93:47\r\n    #9 0x563f09569f47 in CTransaction::CTransaction(CMutableTransaction&&) src/primitives/transaction.cpp:97:190\r\n    #10 0x563f06eb3f68 in std::__1::__shared_ptr_emplace<CTransaction const, std::__1::allocator<CTransaction const>>::__shared_ptr_emplace[abi:v170002]<CMutableTransaction>(std::__1::allocator<CTransaction const>, CMutableTransaction&&) /msan/cxx_build/include/c++/v1/__memory/shared_ptr.h:302:37\r\n    #11 0x563f06eb3f68 in std::__1::shared_ptr<CTransaction const> std::__1::allocate_shared[abi:v170002]<CTransaction const, std::__1::allocator<CTransaction const>, CMutableTransaction, void>(std::__1::allocator<CTransaction const> const&, CMutableTransaction&&) /msan/cxx_build/include/c++/v1/__memory/shared_ptr.h:1022:55\r\n    #12 0x563f09071b26 in std::__1::shared_ptr<CTransaction const> std::__1::make_shared[abi:v170002]<CTransaction const, CMutableTransaction, void>(CMutableTransaction&&) /msan/cxx_build/include/c++/v1/__memory/shared_ptr.h:1031:12\r\n    #13 0x563f09071b26 in std::__1::shared_ptr<CTransaction const> MakeTransactionRef<CMutableTransaction>(CMutableTransaction&&) src/./primitives/transaction.h:418:93\r\n    #14 0x563f09071b26 in ChainstateManager::UpdateUncommittedBlockStructures(CBlock&, CBlockIndex const*) const src/validation.cpp:3706:24\r\n    #15 0x563f09073e46 in ChainstateManager::GenerateCoinbaseCommitment(CBlock&, CBlockIndex const*) const src/validation.cpp:3733:5\r\n    #16 0x563f08bb9dd6 in node::BlockAssembler::CreateNewBlock(CScript const&) src/node/miner.cpp:160:69\r\n    #17 0x563f0822b2a5 in TestChain100Setup::CreateBlock(std::__1::vector<CMutableTransaction, std::__1::allocator<CMutableTransaction>> const&, CScript const&, Chainstate&) src/test/util/setup_common.cpp:310:56\r\n```",
      "created_at" : "2023-11-01T13:20:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1788945972",
      "id" : 1788945972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qoSY0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 3,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 3,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788945972/reactions"
      },
      "updated_at" : "2023-11-01T13:20:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1788945972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378819836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378819836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "what about leaving this function as-is and making the two members `std::optional` instead, then add an early-return one-line happy-path for the case when both are not nullopt?",
      "commit_id" : "664312825f9ae8086ba67eee6ba26cd0dc3d33e3",
      "created_at" : "2023-11-01T13:42:29Z",
      "diff_hunk" : "@@ -367,12 +367,7 @@ class CTransaction\n \n     bool HasWitness() const\n     {\n-        for (size_t i = 0; i < vin.size(); i++) {\n-            if (!vin[i].scriptWitness.IsNull()) {\n-                return true;\n-            }\n-        }\n-        return false;\n+        return hash.ToUint256() != m_witness_hash.ToUint256();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378819836",
      "id" : 1378819836,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SLx78",
      "original_commit_id" : "fed7b918553215b94990d55d7ab8ba9a5cd39b0f",
      "original_line" : 370,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1708251499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378819836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-01T13:42:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378819836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378835011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378835011"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Making them optional would add 16 bytes to every `CTransaction` struct,  I think? This approach would also prevent them from being marked `const` in `CTransaction`. If having `m_witness_hash` be non-const was okay, you could default it to `uint256::ZERO` and set `m_witness_hash = ComputeWitnessHash()` in the constructor. I don't think that's ideal though. ",
      "commit_id" : "664312825f9ae8086ba67eee6ba26cd0dc3d33e3",
      "created_at" : "2023-11-01T13:55:24Z",
      "diff_hunk" : "@@ -367,12 +367,7 @@ class CTransaction\n \n     bool HasWitness() const\n     {\n-        for (size_t i = 0; i < vin.size(); i++) {\n-            if (!vin[i].scriptWitness.IsNull()) {\n-                return true;\n-            }\n-        }\n-        return false;\n+        return hash.ToUint256() != m_witness_hash.ToUint256();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378835011",
      "id" : 1378835011,
      "in_reply_to_id" : 1378819836,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SL1pD",
      "original_commit_id" : "fed7b918553215b94990d55d7ab8ba9a5cd39b0f",
      "original_line" : 370,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1708275962,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378835011/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-01T13:55:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378835011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> ```shell\r\n>  #3 0x563f0956bff5 in CTransaction::HasWitness() const src/./primitives/transaction.h:370:33\r\n>  #4 0x563f0956bff5 in void SerializeTransaction<CHashWriter, CTransaction>(CTransaction const&, CHashWriter&) src/./primitives/transaction.h:265:16\r\n> ```\r\n\r\nIf it's not obvious, the bug is that `m_witness_hash` is initialised by serializing the transaction with its witness, but in that case, `Serialize` calls `HasWitness()` to work out which format to use, which with this change relies on access to `m_witness_hash` which is not yet initialised.",
      "created_at" : "2023-11-01T13:57:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1789003630",
      "id" : 1789003630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qogdu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789003630/reactions"
      },
      "updated_at" : "2023-11-01T13:57:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789003630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a `std::optional<bool>` to `CTransaction` as a cache for `HasWitness`.",
      "created_at" : "2023-11-01T14:17:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1789036887",
      "id" : 1789036887,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qoolX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789036887/reactions"
      },
      "updated_at" : "2023-11-01T14:17:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789036887",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not a fan of the `std::optional<bool>` cache approach, it's an error-prone API imo (even if it's private and small). I think it makes more sense to just calculate the boolean at initialization and follow the same pattern as for `hash` and `m_witness_hash`? It has to be calculated for every instance anyway.\r\n\r\n~As e.g. in https://github.com/stickies-v/bitcoin/commit/2e69a6597c1a07b319e9cba4601474fbe0761f71~\r\n\r\nEdit: using default initializers makes everything a bit more concise: https://github.com/stickies-v/bitcoin/commit/eb316f9c4d13bd1482ac5d0e69fc74b33aef8189 ([diff](https://github.com/stickies-v/bitcoin/compare/af1d2ff88344e1545ac8d9ad09f8e37e264da712..eb316f9c4d13bd1482ac5d0e69fc74b33aef8189))",
      "created_at" : "2023-11-01T14:40:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1789076984",
      "id" : 1789076984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qoyX4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789076984/reactions"
      },
      "updated_at" : "2023-11-01T15:38:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789076984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @stickies-v went with your suggestion as my previous idea was buggy againð¥",
      "created_at" : "2023-11-01T15:11:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1789130504",
      "id" : 1789130504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585qo_cI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789130504/reactions"
      },
      "updated_at" : "2023-11-01T15:11:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789130504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378949369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378949369"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not really a fan of adding 8 bytes to every `CTransaction`, though I guess it's not horrible?\r\n\r\nAnother approach would be to separate out the raw data and compute-logic into one class, and the optimised version with the w/txid cached into a separate class. That looks like: https://github.com/ajtowns/bitcoin/commit/89e3c808927984309a002b2cab1c0a622f5c15f8",
      "commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "created_at" : "2023-11-01T15:25:10Z",
      "diff_hunk" : "@@ -310,12 +310,15 @@ class CTransaction\n \n private:\n     /** Memory only. */\n+    const bool m_has_witness;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1378949369",
      "id" : 1378949369,
      "line" : 313,
      "node_id" : "PRRC_kwDOABII585SMRj5",
      "original_commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "original_line" : 313,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : 4,
      "pull_request_review_id" : 1708460037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378949369/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-01T15:25:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378949369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1381796168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1381796168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Personally, I don't think the extra bytes matter that much, so I would lean towards leaving this as is.",
      "commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "created_at" : "2023-11-03T14:40:37Z",
      "diff_hunk" : "@@ -310,12 +310,15 @@ class CTransaction\n \n private:\n     /** Memory only. */\n+    const bool m_has_witness;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1381796168",
      "id" : 1381796168,
      "in_reply_to_id" : 1378949369,
      "line" : 313,
      "node_id" : "PRRC_kwDOABII585SXIlI",
      "original_commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "original_line" : 313,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : 4,
      "pull_request_review_id" : 1712866482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1381796168/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-03T14:40:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1381796168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-11-06T15:33:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1795136718",
      "id" : 1795136718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585q_5zO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795136718/reactions"
      },
      "updated_at" : "2023-11-06T15:33:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795136718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theStack The dynamic memory isn't the only thing that matters, but it's the only thing you don't already account for at another level.\r\n\r\nIf you have a single transaction, and want its memory usage, use `sizeof(transaction)` + `DynamicMemoryUsage(transaction)`. It'd be convenient to have the transaction sizeof added to that memory usage. However, things would go wrong if you use a collection then.\r\n\r\nSay you have a vector of transactions, and want its memory usage. You'd use `sizeof(vector)` + dynamic memory of the vector (which consists of the memory allocated by the vector, plus the memory allocated by all of the transactions in it). However, the transactions themselves are *in* the vector's allocated memory. If they'd be counted alongside their own allocated memory, they'd be counted twice here (and incorrectly, because the overhead of memory allocation only applies once to the entire array, not individually).",
      "created_at" : "2023-11-12T23:04:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1807273201",
      "id" : 1807273201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585ruMzx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807273201/reactions"
      },
      "updated_at" : "2023-11-12T23:07:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807273201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa: Thanks for clarifying, that makes sense and I see now why it would be a bad idea to add the static part directly in the `DynamicMemoryUsage` functions. For the specific case of mempool usage accounting, one could add `sizeof(CTransaction)` at the call-site though? E.g.\r\n```diff\r\ndiff --git a/src/kernel/mempool_entry.h b/src/kernel/mempool_entry.h\r\nindex 1f175a5ccf..95362fe2d9 100644\r\n--- a/src/kernel/mempool_entry.h\r\n+++ b/src/kernel/mempool_entry.h\r\n@@ -108,7 +108,7 @@ public:\r\n         : tx{tx},\r\n           nFee{fee},\r\n           nTxWeight{GetTransactionWeight(*tx)},\r\n-          nUsageSize{RecursiveDynamicUsage(tx)},\r\n+          nUsageSize{sizeof(*tx) + RecursiveDynamicUsage(tx)},\r\n           nTime{time},\r\n           entry_sequence{entry_sequence},\r\n           entryHeight{entry_height},\r\n```\r\n(Not saying it's really worth it to fiddle around in this area, and I personally wouldn't feel comfortable to open a PR. I was just very surprised that one could -- in theory -- bloat up `CTransaction` and it still goes unnoticed for the mempool usage accounting.)",
      "created_at" : "2023-11-12T23:47:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1807285127",
      "id" : 1807285127,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585ruPuH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807285127/reactions"
      },
      "updated_at" : "2023-11-12T23:49:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807285127",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theStack (deleted my previous comment, I had missed a lot).\r\n\r\n`RecursiveDynamicUsage` for `CTransactionRef` (which is a `std::shared_ptr<CTransaction>`) should already account for both the memory allocated in the shared pointer as well as the memory allocated by the transaction. See `src/core_memusage.h`:\r\n\r\n```c++\r\ntemplate<typename X>\r\nstatic inline size_t RecursiveDynamicUsage(const std::shared_ptr<X>& p) {\r\n    return p ? memusage::DynamicUsage(p) + RecursiveDynamicUsage(*p) : 0;\r\n}\r\n\r\n```\r\n\r\nwhere `memusage::DynamicUsage(p)` invokes this function from `src/memusage.h`:\r\n\r\n```c++\r\ntemplate<typename X>\r\nstatic inline size_t DynamicUsage(const std::shared_ptr<X>& p)\r\n{\r\n    // A shared_ptr can either use a single continuous memory block for both\r\n    // the counter and the storage (when using std::make_shared), or separate.\r\n    // We can't observe the difference, however, so assume the worst.\r\n    return p ? MallocUsage(sizeof(X)) + MallocUsage(sizeof(stl_shared_counter)) : 0;\r\n}\r\n```\r\n\r\nIs it possible that you just don't see the added field cause changes because either it's fitting in earlier padding space, or because the rounding up effect of `malloc()` hides the difference?",
      "created_at" : "2023-11-13T01:30:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1807345702",
      "id" : 1807345702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585ruegm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807345702/reactions"
      },
      "updated_at" : "2023-11-13T01:30:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807345702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa: Ah, very interesting, have to admit I completely overlooked `RecursiveDynamicUsage(const std::shared_ptr<X>& p)`.\r\n\r\n> Is it possible that you just don't see the added field cause changes because either it's fitting in earlier padding space, or because the rounding up effect of `malloc()` hides the difference?\r\n\r\nYes, it was the latter. The added field did lead to a size increase of `CTransaction` (from 120 to 128 bytes), but `MallocUsage` indeed yields the same value for both of these [sizes on a 64-bit machine](https://github.com/bitcoin/bitcoin/blob/8243762700bc6e7876ae5d4fc000500858b99f66/src/memusage.h#L57) (namely ((120+31)>>4)<<4 = ((128+31)>>4)<<4 = 144). So that's the reason why I did see the same mempool usage accounting results both on master and the PR on my machine (and wrongly concluded from that that the size of `CTransaction` is not accounted for). To be sure, I intentionally bloated `CTransaction` up much more with an `const uint8_t dummy[100] = {};` entry and verified that the mempool usage was higher indeed. So, the accounting seems to work as expected and my worries were unjustified.\r\n\r\nIf anyone wants to run these experiments: what I did was to start bitcoind with an existing mempool.dat in datadir both on master and the PR branch with `-nolisten -noconnect` (to avoid clogging the mempool with new txs), wait until the mempool loaded, ran `bitcoin-cli getmempoolinfo` and compared the `\"usage\"` result field value (other fields like `\"size\"`, `\"bytes\"` and `\"total_fee\"` should always be equal for the same mempool.dat).\r\n\r\nACK af1d2ff88344e1545ac8d9ad09f8e37e264da712\r\n\r\n(still based on a gut feeling, but garnished with some napkin math: the mempool on my node is close to it's maximum of 300MB and has about ~100k entries now; `MallocUsage` increases in 16-bytes steps on 64-bit machines, so that would in the worst case lead to ~1,6MB more usage, where now \"only\" ~99.5k entries would fit; I think that's fine).",
      "created_at" : "2023-11-13T03:02:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1807405302",
      "id" : 1807405302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585rutD2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807405302/reactions"
      },
      "updated_at" : "2023-11-13T03:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1807405302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1390988379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390988379"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Using default initializer makes more sense here I think:\r\n\r\n<details>\r\n<summary>git diff on af1d2ff883</summary>\r\n\r\n```diff\r\ndiff --git a/src/primitives/transaction.cpp b/src/primitives/transaction.cpp\r\nindex 77a363f7b6..a20cf25f53 100644\r\n--- a/src/primitives/transaction.cpp\r\n+++ b/src/primitives/transaction.cpp\r\n@@ -93,8 +93,10 @@ Wtxid CTransaction::ComputeWitnessHash() const\r\n     return Wtxid::FromUint256((CHashWriter{0} << *this).GetHash());\r\n }\r\n \r\n-CTransaction::CTransaction(const CMutableTransaction& tx) : vin(tx.vin), vout(tx.vout), nVersion(tx.nVersion), nLockTime(tx.nLockTime), m_has_witness{ComputeHasWitness()}, hash{ComputeHash()}, m_witness_hash{ComputeWitnessHash()} {}\r\n-CTransaction::CTransaction(CMutableTransaction&& tx) : vin(std::move(tx.vin)), vout(std::move(tx.vout)), nVersion(tx.nVersion), nLockTime(tx.nLockTime), m_has_witness{ComputeHasWitness()}, hash{ComputeHash()}, m_witness_hash{ComputeWitnessHash()} {}\r\n+CTransaction::CTransaction(const CMutableTransaction& tx)\r\n+    : vin(tx.vin), vout(tx.vout), nVersion(tx.nVersion), nLockTime(tx.nLockTime) {}\r\n+CTransaction::CTransaction(CMutableTransaction&& tx)\r\n+    : vin(std::move(tx.vin)), vout(std::move(tx.vout)), nVersion(tx.nVersion), nLockTime(tx.nLockTime) {}\r\n \r\n CAmount CTransaction::GetValueOut() const\r\n {\r\ndiff --git a/src/primitives/transaction.h b/src/primitives/transaction.h\r\nindex 594168bbcc..facbd8c769 100644\r\n--- a/src/primitives/transaction.h\r\n+++ b/src/primitives/transaction.h\r\n@@ -310,9 +310,9 @@ public:\r\n \r\n private:\r\n     /** Memory only. */\r\n-    const bool m_has_witness;\r\n-    const Txid hash;\r\n-    const Wtxid m_witness_hash;\r\n+    const bool m_has_witness{ComputeHasWitness()};\r\n+    const Txid hash{ComputeHash()};\r\n+    const Wtxid m_witness_hash{ComputeWitnessHash()};\r\n \r\n     Txid ComputeHash() const;\r\n     Wtxid ComputeWitnessHash() const;\r\n\r\n```\r\n</details>\r\n",
      "commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "created_at" : "2023-11-13T11:28:39Z",
      "diff_hunk" : "@@ -310,12 +310,15 @@ class CTransaction\n \n private:\n     /** Memory only. */\n+    const bool m_has_witness;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1390988379",
      "id" : 1390988379,
      "line" : 313,
      "node_id" : "PRRC_kwDOABII585S6Mxb",
      "original_commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "original_line" : 313,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : 4,
      "pull_request_review_id" : 1727118277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390988379/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-13T11:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390988379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1394031188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1394031188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Really, we're already wasting 16 bytes due to `vin` and `vout` supporting `capacity() != size()` despite both being `const` and never needing to be resized.",
      "commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "created_at" : "2023-11-15T10:54:30Z",
      "diff_hunk" : "@@ -310,12 +310,15 @@ class CTransaction\n \n private:\n     /** Memory only. */\n+    const bool m_has_witness;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1394031188",
      "id" : 1394031188,
      "in_reply_to_id" : 1378949369,
      "line" : 313,
      "node_id" : "PRRC_kwDOABII585TFzpU",
      "original_commit_id" : "af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "original_line" : 313,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : 4,
      "pull_request_review_id" : 1731771649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1394031188/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-15T10:54:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1394031188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think this is rfm. Could a maintainer take a look?",
      "created_at" : "2023-11-21T10:43:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1820666311",
      "id" : 1820666311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585shSnH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1820666311/reactions"
      },
      "updated_at" : "2023-11-21T10:43:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1820666311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Since it comes with a memory cost, I wonder if the the performance gain we get for it can be measured. Does this speed up any benchmarks / IBD?",
      "created_at" : "2023-11-22T20:40:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1823476778",
      "id" : 1823476778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585ssAwq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1823476778/reactions"
      },
      "updated_at" : "2023-11-22T20:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1823476778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Since it comes with a memory cost, I wonder if the the performance gain we get for it can be measured. Does this speed up any benchmarks / IBD?\r\n\r\nIt's less of a gain and more just trying to revert the performance regression I introduced in #28017. I guess you are asking if it is a noticeable regression. I would think both the performance regression and the new memory cost from here are negligible and I can certainly also live with what is in master now.",
      "created_at" : "2023-11-23T10:00:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1824104612",
      "id" : 1824104612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585suaCk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1824104612/reactions"
      },
      "updated_at" : "2023-11-23T10:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1824104612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> this kind of decisions should be made based on empirical data rather than guessing what the performance / memory impacts may be.\r\n\r\nThis makes it sound like this is all up in the air when the trade-off for this PR is well known. All this does is revert to the performance we had pre-#28107 while adding an extra 8 bytes to every CTransaction instance.\r\n\r\nThe runtime complexity of `HasWitness` is now `O(tx.vin.size())` while it used to be `O(1)`. That could be considered good enough reasoning for this PR even if a IBD/reindex benchmark doesn't show a noticeable difference. The 4 concept acks and 3 full acks seem to agree on that.\r\n\r\nIn any case the memory usage of CTransaction could be optimized in a follow-up, even beyond reverting the overhead from this PR (https://github.com/bitcoin/bitcoin/pull/28766#discussion_r1394031188).\r\n\r\nFeel free to do the benchmark, but I'm not sure if the result matters much at this point, since we have already spend sufficient review time on this PR.",
      "created_at" : "2023-11-24T17:45:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1825955425",
      "id" : 1825955425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585s1d5h",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1825955425/reactions"
      },
      "updated_at" : "2023-11-24T20:48:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1825955425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> All this does is revert to the performance we had pre-https://github.com/bitcoin/bitcoin/issues/28107 while adding an extra > 8 bytes to every CTransaction instance.\r\n>\r\n> The runtime complexity of HasWitness is now O(tx.vin.size()) while it used to be O(1).\r\n\r\nWhoops, this isn't really true. HasWitness was unchanged by #28107, the only change in this regard was https://github.com/bitcoin/bitcoin/pull/28107/commits/cdb14d79e809bf7d1612b21b554a9fcfb2ab1c91.\r\n\r\nThis PR improves the performance for all call sites of HasWitness not just the ones in https://github.com/bitcoin/bitcoin/pull/28107/commits/cdb14d79e809bf7d1612b21b554a9fcfb2ab1c91.",
      "created_at" : "2023-11-24T20:49:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1826076343",
      "id" : 1826076343,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585s17a3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1826076343/reactions"
      },
      "updated_at" : "2023-11-24T20:49:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1826076343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK af1d2ff88344e1545ac8d9ad09f8e37e264da712",
      "created_at" : "2023-11-28T13:44:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28766#issuecomment-1829876209",
      "id" : 1829876209,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28766",
      "node_id" : "IC_kwDOABII585tEbHx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829876209/reactions"
      },
      "updated_at" : "2023-11-28T13:44:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829876209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
