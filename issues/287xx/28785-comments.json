[
   {
      "documentation_url" : "https://docs.github.com/rest/issues/comments#list-issue-comments",
      "message" : "Not Found"
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28785).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1798385890), [achow101](https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1800200116), [murchandamus](https://github.com/bitcoin/bitcoin/pull/28785#pullrequestreview-1718852604) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28345](https://github.com/bitcoin/bitcoin/pull/28345) (Bugfix: Package relay / bytespersigop checks by luke-jr)\n* [#26451](https://github.com/bitcoin/bitcoin/pull/26451) (Enforce incentive compatibility for all RBF replacements by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-11-03T16:31:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1792766939",
      "id" : 1792766939,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28785",
      "node_id" : "IC_kwDOABII585q23Pb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1792766939/reactions"
      },
      "updated_at" : "2023-11-07T22:04:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1792766939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> so that we re-validate a transaction if and only if it is eligible for package CPFP.\r\n\r\nand in the future we'll use this for making sure we'd re-request this transaction as part of another package at p2p, correct?",
      "created_at" : "2023-11-03T16:33:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1792771581",
      "id" : 1792771581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28785",
      "node_id" : "IC_kwDOABII585q24X9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1792771581/reactions"
      },
      "updated_at" : "2023-11-03T16:33:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1792771581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> and in the future we'll use this for making sure we'd re-request this transaction as part of another package at p2p, correct?\r\n\r\nCorrect :+1: ",
      "created_at" : "2023-11-03T16:35:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1792774024",
      "id" : 1792774024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28785",
      "node_id" : "IC_kwDOABII585q24-I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1792774024/reactions"
      },
      "updated_at" : "2023-11-03T16:35:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1792774024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1382126634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382126634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might make sense to add a comment to the effect that we don't want to reject fetching this same tx in a future package",
      "commit_id" : "6b0dc669886c07a81fdfbf2d1a71a77ca3bac1c3",
      "created_at" : "2023-11-03T19:32:55Z",
      "diff_hunk" : "@@ -1139,7 +1147,7 @@ bool MemPoolAccept::Finalize(const ATMPArgs& args, Workspace& ws)\n     if (!args.m_package_submission && !bypass_limits) {\n         LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n         if (!m_pool.exists(GenTxid::Txid(hash)))\n-            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"mempool full\");\n+            return state.Invalid(TxValidationResult::TX_SINGLE_FAILURE, \"mempool full\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1382126634",
      "id" : 1382126634,
      "line" : 1150,
      "node_id" : "PRRC_kwDOABII585SYZQq",
      "original_commit_id" : "ba9e2ae9e0e42233bc6b8ce8aa89865e4260cbba",
      "original_line" : 1150,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 48,
      "pull_request_review_id" : 1713411958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382126634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-03T19:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382126634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1382138716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382138716"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            // Failed for fee reasons. Provide the effective feerate and which txn was included.\r\n```",
      "commit_id" : "6b0dc669886c07a81fdfbf2d1a71a77ca3bac1c3",
      "created_at" : "2023-11-03T19:49:00Z",
      "diff_hunk" : "@@ -1227,7 +1235,13 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n \n     Workspace ws(ptx);\n \n-    if (!PreChecks(args, ws)) return MempoolAcceptResult::Failure(ws.m_state);\n+    if (!PreChecks(args, ws)) {\n+        if (ws.m_state.GetResult() == TxValidationResult::TX_SINGLE_FAILURE) {\n+            // Failed for fee reasons. Provide the effective feerate and which txns were included.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1382138716",
      "id" : 1382138716,
      "line" : 1240,
      "node_id" : "PRRC_kwDOABII585SYcNc",
      "original_commit_id" : "6b0dc669886c07a81fdfbf2d1a71a77ca3bac1c3",
      "original_line" : 1240,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 59,
      "pull_request_review_id" : 1713411958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382138716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-03T19:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382138716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1382139875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382139875"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`Wtxid`? :point_right: :point_left: ",
      "commit_id" : "6b0dc669886c07a81fdfbf2d1a71a77ca3bac1c3",
      "created_at" : "2023-11-03T19:50:25Z",
      "diff_hunk" : "@@ -141,24 +160,28 @@ struct MempoolAcceptResult {\n      * using prioritisetransaction (i.e. modified fees). If this transaction was submitted as a\n      * package, this is the package feerate, which may also include its descendants and/or\n      * ancestors (see m_wtxids_fee_calculations below).\n-     * Only present when m_result_type = ResultType::VALID.\n      */\n     const std::optional<CFeeRate> m_effective_feerate;\n     /** Contains the wtxids of the transactions used for fee-related checks. Includes this\n      * transaction's wtxid and may include others if this transaction was validated as part of a\n      * package. This is not necessarily equivalent to the list of transactions passed to\n      * ProcessNewPackage().\n-     * Only present when m_result_type = ResultType::VALID. */\n+     */\n     const std::optional<std::vector<uint256>> m_wtxids_fee_calculations;\n \n-    // The following field is only present when m_result_type = ResultType::DIFFERENT_WITNESS\n     /** The wtxid of the transaction in the mempool which has the same txid but different witness. */\n     const std::optional<uint256> m_other_wtxid;\n \n     static MempoolAcceptResult Failure(TxValidationState state) {\n         return MempoolAcceptResult(state);\n     }\n \n+    static MempoolAcceptResult FeeFailure(TxValidationState state,\n+                                          CFeeRate effective_feerate,\n+                                          const std::vector<uint256>& wtxids_fee_calculations) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1382139875",
      "id" : 1382139875,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII585SYcfj",
      "original_commit_id" : "6b0dc669886c07a81fdfbf2d1a71a77ca3bac1c3",
      "original_line" : 181,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 62,
      "pull_request_review_id" : 1713411958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382139875/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-03T19:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382139875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383369213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369213"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added comment",
      "commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "created_at" : "2023-11-06T13:56:02Z",
      "diff_hunk" : "@@ -1139,7 +1147,7 @@ bool MemPoolAccept::Finalize(const ATMPArgs& args, Workspace& ws)\n     if (!args.m_package_submission && !bypass_limits) {\n         LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n         if (!m_pool.exists(GenTxid::Txid(hash)))\n-            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"mempool full\");\n+            return state.Invalid(TxValidationResult::TX_SINGLE_FAILURE, \"mempool full\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383369213",
      "id" : 1383369213,
      "in_reply_to_id" : 1382126634,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SdIn9",
      "original_commit_id" : "ba9e2ae9e0e42233bc6b8ce8aa89865e4260cbba",
      "original_line" : 1151,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1715236921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369213/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T13:56:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383369301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369301"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Taken",
      "commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "created_at" : "2023-11-06T13:56:06Z",
      "diff_hunk" : "@@ -1227,7 +1235,13 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n \n     Workspace ws(ptx);\n \n-    if (!PreChecks(args, ws)) return MempoolAcceptResult::Failure(ws.m_state);\n+    if (!PreChecks(args, ws)) {\n+        if (ws.m_state.GetResult() == TxValidationResult::TX_SINGLE_FAILURE) {\n+            // Failed for fee reasons. Provide the effective feerate and which txns were included.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383369301",
      "id" : 1383369301,
      "in_reply_to_id" : 1382138716,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SdIpV",
      "original_commit_id" : "6b0dc669886c07a81fdfbf2d1a71a77ca3bac1c3",
      "original_line" : 1240,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1715237068,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369301/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T13:56:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383369984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369984"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed :+1:",
      "commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "created_at" : "2023-11-06T13:56:37Z",
      "diff_hunk" : "@@ -141,24 +160,28 @@ struct MempoolAcceptResult {\n      * using prioritisetransaction (i.e. modified fees). If this transaction was submitted as a\n      * package, this is the package feerate, which may also include its descendants and/or\n      * ancestors (see m_wtxids_fee_calculations below).\n-     * Only present when m_result_type = ResultType::VALID.\n      */\n     const std::optional<CFeeRate> m_effective_feerate;\n     /** Contains the wtxids of the transactions used for fee-related checks. Includes this\n      * transaction's wtxid and may include others if this transaction was validated as part of a\n      * package. This is not necessarily equivalent to the list of transactions passed to\n      * ProcessNewPackage().\n-     * Only present when m_result_type = ResultType::VALID. */\n+     */\n     const std::optional<std::vector<uint256>> m_wtxids_fee_calculations;\n \n-    // The following field is only present when m_result_type = ResultType::DIFFERENT_WITNESS\n     /** The wtxid of the transaction in the mempool which has the same txid but different witness. */\n     const std::optional<uint256> m_other_wtxid;\n \n     static MempoolAcceptResult Failure(TxValidationState state) {\n         return MempoolAcceptResult(state);\n     }\n \n+    static MempoolAcceptResult FeeFailure(TxValidationState state,\n+                                          CFeeRate effective_feerate,\n+                                          const std::vector<uint256>& wtxids_fee_calculations) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383369984",
      "id" : 1383369984,
      "in_reply_to_id" : 1382139875,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SdI0A",
      "original_commit_id" : "6b0dc669886c07a81fdfbf2d1a71a77ca3bac1c3",
      "original_line" : 181,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1715238162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T13:56:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383369984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383433511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383433511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It was not obvious to me what the motivation for `SINGLE` in the constant name here is. After discussing with @glozow, maybe:\r\n\r\n```suggestion\r\n    TX_RECONSIDERABLE,        //!< mining score was insufficient to meet some policy, but transaction might be acceptable if submitted in a (different) package\r\n```",
      "commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "created_at" : "2023-11-06T14:32:35Z",
      "diff_hunk" : "@@ -54,6 +54,8 @@ enum class TxValidationResult {\n     TX_CONFLICT,\n     TX_MEMPOOL_POLICY,        //!< violated mempool's fee/size/descendant/RBF/etc limits\n     TX_NO_MEMPOOL,            //!< this node does not have a mempool so can't validate the transaction\n+    TX_SINGLE_FAILURE,        //!< fee was insufficient to meet some policy, but can change if submitted in a (different) package",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383433511",
      "id" : 1383433511,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SdYUn",
      "original_commit_id" : "8bad2718dae5490618bdd52cdcfc41132b9a4d93",
      "original_line" : 57,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/validation.h",
      "position" : null,
      "pull_request_review_id" : 1715352056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383433511/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T14:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383433511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383454127"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383454127"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah renamed, I think it'll help make the connection with `m_reconsiderable_rejects` filter later as well.",
      "commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "created_at" : "2023-11-06T14:47:17Z",
      "diff_hunk" : "@@ -54,6 +54,8 @@ enum class TxValidationResult {\n     TX_CONFLICT,\n     TX_MEMPOOL_POLICY,        //!< violated mempool's fee/size/descendant/RBF/etc limits\n     TX_NO_MEMPOOL,            //!< this node does not have a mempool so can't validate the transaction\n+    TX_SINGLE_FAILURE,        //!< fee was insufficient to meet some policy, but can change if submitted in a (different) package",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1383454127",
      "id" : 1383454127,
      "in_reply_to_id" : 1383433511,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SddWv",
      "original_commit_id" : "8bad2718dae5490618bdd52cdcfc41132b9a4d93",
      "original_line" : 57,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/validation.h",
      "position" : null,
      "pull_request_review_id" : 1715385802,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383454127/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T14:47:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383454127",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/28785/commits/0150e860863f95b18448e7b67f5db27017660670\r\n\r\nsuggested changes plus `TX_RECONSIDERABLE` renaming which makes sense",
      "created_at" : "2023-11-06T14:49:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1795002089",
      "id" : 1795002089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28785",
      "node_id" : "IC_kwDOABII585q_Y7p",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795002089/reactions"
      },
      "updated_at" : "2023-11-06T14:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795002089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384000302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384000302"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "After the name change, perhaps:\r\n\r\n```suggestion\r\n        const bool is_reconsiderable{res.m_state.GetResult() == TxValidationResult::TX_RECONSIDERABLE};\r\n```",
      "commit_id" : "1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "created_at" : "2023-11-06T21:16:01Z",
      "diff_hunk" : "@@ -154,12 +154,15 @@ void CheckATMPInvariants(const MempoolAcceptResult& res, bool txid_in_mempool, b\n         // It may be already in the mempool since in ATMP cases we don't set MEMPOOL_ENTRY or DIFFERENT_WITNESS\n         Assert(!res.m_state.IsValid());\n         Assert(res.m_state.IsInvalid());\n+\n+        const bool is_single_failure{res.m_state.GetResult() == TxValidationResult::TX_RECONSIDERABLE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384000302",
      "id" : 1384000302,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Sfisu",
      "original_commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "original_line" : 158,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 1716255880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384000302/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:35:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384000302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384005669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384005669"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps:\r\n```suggestion\r\n        const bool valid_or_reconsiderable{atmp_result.m_result_type == MempoolAcceptResult::ResultType::VALID ||\r\n```",
      "commit_id" : "1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "created_at" : "2023-11-06T21:20:17Z",
      "diff_hunk" : "@@ -89,11 +89,14 @@ std::optional<std::string> CheckPackageMempoolAcceptResult(const Package& txns,\n         }\n \n         // m_effective_feerate and m_wtxids_fee_calculations should exist iff the result was valid\n-        if (atmp_result.m_effective_feerate.has_value() != valid) {\n+        // or if the failure was TX_RECONSIDERABLE\n+        const bool valid_or_single_failure{atmp_result.m_result_type == MempoolAcceptResult::ResultType::VALID ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384005669",
      "id" : 1384005669,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SfkAl",
      "original_commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "original_line" : 93,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1716255880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384005669/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:35:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384005669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384025601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384025601"
         }
      },
      "author_association" : "MEMBER",
      "body" : " PR description also needs to be updated to `TX_RECONSIDERABLE` ",
      "commit_id" : "1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "created_at" : "2023-11-06T21:37:52Z",
      "diff_hunk" : "@@ -154,12 +154,15 @@ void CheckATMPInvariants(const MempoolAcceptResult& res, bool txid_in_mempool, b\n         // It may be already in the mempool since in ATMP cases we don't set MEMPOOL_ENTRY or DIFFERENT_WITNESS\n         Assert(!res.m_state.IsValid());\n         Assert(res.m_state.IsInvalid());\n+\n+        const bool is_single_failure{res.m_state.GetResult() == TxValidationResult::TX_RECONSIDERABLE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384025601",
      "id" : 1384025601,
      "in_reply_to_id" : 1384000302,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Sfo4B",
      "original_commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "original_line" : 158,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 1716230816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384025601/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:38:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384025601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384772837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384772837"
         }
      },
      "author_association" : "MEMBER",
      "body" : "taken",
      "commit_id" : "1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "created_at" : "2023-11-07T11:27:07Z",
      "diff_hunk" : "@@ -154,12 +154,15 @@ void CheckATMPInvariants(const MempoolAcceptResult& res, bool txid_in_mempool, b\n         // It may be already in the mempool since in ATMP cases we don't set MEMPOOL_ENTRY or DIFFERENT_WITNESS\n         Assert(!res.m_state.IsValid());\n         Assert(res.m_state.IsInvalid());\n+\n+        const bool is_single_failure{res.m_state.GetResult() == TxValidationResult::TX_RECONSIDERABLE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384772837",
      "id" : 1384772837,
      "in_reply_to_id" : 1384000302,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SifTl",
      "original_commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "original_line" : 158,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 1717459204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384772837/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-07T11:27:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384772837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384772909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384772909"
         }
      },
      "author_association" : "MEMBER",
      "body" : "taken",
      "commit_id" : "1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "created_at" : "2023-11-07T11:27:11Z",
      "diff_hunk" : "@@ -89,11 +89,14 @@ std::optional<std::string> CheckPackageMempoolAcceptResult(const Package& txns,\n         }\n \n         // m_effective_feerate and m_wtxids_fee_calculations should exist iff the result was valid\n-        if (atmp_result.m_effective_feerate.has_value() != valid) {\n+        // or if the failure was TX_RECONSIDERABLE\n+        const bool valid_or_single_failure{atmp_result.m_result_type == MempoolAcceptResult::ResultType::VALID ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1384772909",
      "id" : 1384772909,
      "in_reply_to_id" : 1384005669,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SifUt",
      "original_commit_id" : "0150e860863f95b18448e7b67f5db27017660670",
      "original_line" : 93,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1717459318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384772909/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-07T11:27:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384772909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed https://github.com/bitcoin/bitcoin/pull/28785#pullrequestreview-1716255880 and fixed the ci error",
      "created_at" : "2023-11-07T12:03:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1798369856",
      "id" : 1798369856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28785",
      "node_id" : "IC_kwDOABII585rMPJA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798369856/reactions"
      },
      "updated_at" : "2023-11-07T12:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798369856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK https://github.com/bitcoin/bitcoin/pull/28785/commits/1147e00e59e47f27024ec96629993c66a3ce4ef0\r\n\r\ntook reconsiderable variable renames, tests using CheckPackageMempoolAcceptResult more, unsure why ci was failing though :)",
      "created_at" : "2023-11-07T12:14:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1798385890",
      "id" : 1798385890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28785",
      "node_id" : "IC_kwDOABII585rMTDi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798385890/reactions"
      },
      "updated_at" : "2023-11-07T12:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798385890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "created_at" : "2023-11-07T21:36:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#issuecomment-1800200116",
      "id" : 1800200116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28785",
      "node_id" : "IC_kwDOABII585rTN-0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1800200116/reactions"
      },
      "updated_at" : "2023-11-07T21:36:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1800200116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1385633055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1385633055"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was very confused by the changes in this vein, until I realized that `CheckPackageMempoolAcceptResult(â¦)` returns an error in case of a CPMA failure, but returns nothing in the case of a success. Per the name of this function my initial expectation was that we would expect a truthy return value in case of successful acceptance.",
      "commit_id" : "1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "created_at" : "2023-11-07T21:56:05Z",
      "diff_hunk" : "@@ -132,36 +133,35 @@ BOOST_FIXTURE_TEST_CASE(package_validation_tests, TestChain100Setup)\n                                                    /*output_destination=*/child_locking_script,\n                                                    /*output_amount=*/CAmount(48 * COIN), /*submit=*/false);\n     CTransactionRef tx_child = MakeTransactionRef(mtx_child);\n-    const auto result_parent_child = ProcessNewPackage(m_node.chainman->ActiveChainstate(), *m_node.mempool, {tx_parent, tx_child}, /*test_accept=*/true);\n-    BOOST_CHECK_MESSAGE(result_parent_child.m_state.IsValid(),\n-                        \"Package validation unexpectedly failed: \" << result_parent_child.m_state.GetRejectReason());\n-    BOOST_CHECK(result_parent_child.m_tx_results.size() == 2);\n-    auto it_parent = result_parent_child.m_tx_results.find(tx_parent->GetWitnessHash());\n-    auto it_child = result_parent_child.m_tx_results.find(tx_child->GetWitnessHash());\n-    BOOST_CHECK(it_parent != result_parent_child.m_tx_results.end());\n-    BOOST_CHECK_MESSAGE(it_parent->second.m_state.IsValid(),\n-                        \"Package validation unexpectedly failed: \" << it_parent->second.m_state.GetRejectReason());\n-    BOOST_CHECK(it_parent->second.m_effective_feerate.value().GetFee(GetVirtualTransactionSize(*tx_parent)) == COIN);\n-    BOOST_CHECK_EQUAL(it_parent->second.m_wtxids_fee_calculations.value().size(), 1);\n-    BOOST_CHECK_EQUAL(it_parent->second.m_wtxids_fee_calculations.value().front(), tx_parent->GetWitnessHash());\n-    BOOST_CHECK(it_child != result_parent_child.m_tx_results.end());\n-    BOOST_CHECK_MESSAGE(it_child->second.m_state.IsValid(),\n-                        \"Package validation unexpectedly failed: \" << it_child->second.m_state.GetRejectReason());\n-    BOOST_CHECK(it_child->second.m_effective_feerate.value().GetFee(GetVirtualTransactionSize(*tx_child)) == COIN);\n-    BOOST_CHECK_EQUAL(it_child->second.m_wtxids_fee_calculations.value().size(), 1);\n-    BOOST_CHECK_EQUAL(it_child->second.m_wtxids_fee_calculations.value().front(), tx_child->GetWitnessHash());\n+    Package package_parent_child{tx_parent, tx_child};\n+    const auto result_parent_child = ProcessNewPackage(m_node.chainman->ActiveChainstate(), *m_node.mempool, package_parent_child, /*test_accept=*/true);\n+    if (auto err_parent_child{CheckPackageMempoolAcceptResult(package_parent_child, result_parent_child, /*expect_valid=*/true, nullptr)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28785#discussion_r1385633055",
      "id" : 1385633055,
      "line" : 138,
      "node_id" : "PRRC_kwDOABII585SlxUf",
      "original_commit_id" : "1147e00e59e47f27024ec96629993c66a3ce4ef0",
      "original_line" : 138,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 32,
      "pull_request_review_id" : 1718852604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28785",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1385633055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-07T22:04:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1385633055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   }
]
