[
   {
      "author_association" : "MEMBER",
      "body" : "Doesn't binding 127.0.0.1 fail if ::1 is already bound, on some systems? (Because ::1 includes 127.0.0.1 in practice.)",
      "created_at" : "2018-12-15T07:14:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447544254",
      "id" : 447544254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzU0NDI1NA==",
      "updated_at" : "2018-12-15T07:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447544254",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Doesn't binding 127.0.0.1 fail if ::1 is already bound, on some systems? (Because ::1 includes 127.0.0.1 in practice.)\r\n\r\nNo, that's definitely not true. No localhost address or subnet should include each other.\r\n\r\n```\r\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\r\n        inet 127.0.0.1  netmask 255.0.0.0\r\n        inet6 ::1  prefixlen 128  scopeid 0x10<host>\r\n```\r\nso:\r\n```\r\n127.0.0.1/8 (0:0:0:0:0:0:7f00:0001/96 if embedded in IPv6)\r\n0:0:0:0:0:0:0:1/128\r\n```\r\nNone of these overlaps.\r\n\r\nYou're mixing it up with `::0` / INADDR_ANY, which can be all-inclusive in some systems (sometimes depending on dual-stack settings).\r\n",
      "created_at" : "2018-12-15T07:20:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447544539",
      "id" : 447544539,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzU0NDUzOQ==",
      "updated_at" : "2018-12-15T07:42:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447544539",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nThe error message here also needs updating for the new behaviour:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/f128ecae3577bf9294efc8ff1dc9e0549ae91243/src/httpserver.cpp#L393-L396",
      "created_at" : "2018-12-15T19:42:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447593022",
      "id" : 447593022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzU5MzAyMg==",
      "updated_at" : "2018-12-15T19:42:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447593022",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MeshCollider thanks, updated",
      "created_at" : "2018-12-16T08:08:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447624852",
      "id" : 447624852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzYyNDg1Mg==",
      "updated_at" : "2018-12-16T08:08:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447624852",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK",
      "created_at" : "2018-12-16T08:10:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447624946",
      "id" : 447624946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzYyNDk0Ng==",
      "updated_at" : "2018-12-16T08:10:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447624946",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK  would also be nicer to get this in sooner rather than later, so we get more of a chance to find out that SpatulaBSD behaves like luke thought before this ends up in a release. :)",
      "created_at" : "2018-12-16T10:25:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447631820",
      "id" : 447631820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzYzMTgyMA==",
      "updated_at" : "2018-12-16T10:25:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447631820",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2018-12-16T10:30:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447632175",
      "id" : 447632175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzYzMjE3NQ==",
      "updated_at" : "2018-12-16T10:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447632175",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Travis fails when creating the cache. Could be because of the default value of `bind_to_localhost_only`? Not sure if `self.bind_to_localhost_only` even makes sense after the recent changes to how rpc binds.",
      "created_at" : "2018-12-16T17:31:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447661062",
      "id" : 447661062,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzY2MTA2Mg==",
      "updated_at" : "2018-12-16T17:31:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447661062",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`bind_to_localhost_only` has to do with P2P, not RPC. IIRC RPC was always already bound to localhost only for the tests, apart from the bind test.",
      "created_at" : "2018-12-17T08:53:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447767239",
      "id" : 447767239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0Nzc2NzIzOQ==",
      "updated_at" : "2018-12-17T08:53:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447767239",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I guess this has to do with Travis not supporting (even local!) IPv6 at all, so the IPv6 bind fails and it doesn't start.\r\n\r\nI suppose not being able to auto-bind on either IPv4 or IPv6 is valid if there is no such interface, at least if `-rpcbind` was not explicitly given.",
      "created_at" : "2018-12-17T09:09:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447771824",
      "id" : 447771824,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0Nzc3MTgyNA==",
      "updated_at" : "2018-12-17T09:55:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447771824",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "OK, per suggestion by @gmaxwell I've changed the logic. By default, if no explicit bind configuration is given, the `EADDRNOTAVAIL` error while binding is ignored (but not, say, `EADDRINUSE`). This is user-friendly as it means the default setting will auto-detect based on available IPv4/IPv6. In all other cases all errors are fatal.\r\n\r\nThis can be tested using linux network namespaces\r\n```bash\r\nip netns add dumb\r\nip netns exec dumb ip addr add 127.0.0.1/8 dev lo # adds both IPv4 and IPv6\r\nip netns exec dumb ip addr del ::1/128 dev lo # remove IPv6\r\nip netns exec dumb ip link set lo up\r\nip netns exec dumb src/bitcoind -regtest\r\n```\r\n",
      "created_at" : "2018-12-17T10:16:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447792690",
      "id" : 447792690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0Nzc5MjY5MA==",
      "updated_at" : "2018-12-17T10:58:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447792690",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sigh, that still didn't solve the Travis issue though. Locally running the tests with no IPv6 localhost worked fine for me now.",
      "created_at" : "2018-12-17T10:59:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-447805499",
      "id" : 447805499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzgwNTQ5OQ==",
      "updated_at" : "2018-12-17T11:15:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447805499",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14968#discussion_r242190994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14968"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242190994"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Needed this to prevent a leak and segfault in `StopHTTPServer` (because the owning `evhttp` is freed but the listeners are not).",
      "commit_id" : "7b5e4001f95ac8cb19f8f208634a5e07b9979562",
      "created_at" : "2018-12-17T15:26:37Z",
      "diff_hunk" : "@@ -329,10 +332,26 @@ static bool HTTPBindAddresses(struct evhttp* http)\n             }\n             boundSockets.push_back(bind_handle);\n         } else {\n-            LogPrintf(\"Binding RPC on address %s port %i failed.\\n\", i->first, i->second);\n+            if (!is_default || EVUTIL_SOCKET_ERROR() != EADDRNOTAVAIL) {\n+                LogPrintf(\"Binding RPC on address %s port %i failed.\\n\", i->first, i->second);\n+                num_fail += 1;\n+            } else {\n+                // Don't count failure if binding was not explicitly configured\n+                // (default settings) and the address is not available.\n+                // (for example: Travis without IPv6 localhost)\n+                LogPrintf(\"Binding RPC on address %s port %i failed, error ignored because interface was unavailable.\\n\", i->first, i->second);\n+            }\n+        }\n+    }\n+    if (num_fail != 0) {\n+        // In case of an error, clean up listening sockets that succeeded to",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#discussion_r242190994",
      "id" : 242190994,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjE5MDk5NA==",
      "original_commit_id" : "a846175b02208c4a23f5b36a45d60b40cc6d2feb",
      "original_position" : 39,
      "path" : "src/httpserver.cpp",
      "position" : 40,
      "pull_request_review_id" : 185644399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14968",
      "updated_at" : "2018-12-17T17:44:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242190994",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Unfortunately, evhttp_bind_socket_with_handle returns a 0/Success errno when listen fails. I've opened a report upstream to fix this, but obviously we can't rely on it now: https://github.com/libevent/libevent/pull/738",
      "created_at" : "2018-12-28T04:46:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450289229",
      "id" : 450289229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDI4OTIyOQ==",
      "updated_at" : "2018-12-28T04:46:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450289229",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "One possible solution is to clone the evhttp code. I got it down to 65 lines: https://github.com/bitcoin/bitcoin/compare/master...luke-jr:my_bind_socket_with_handle",
      "created_at" : "2018-12-28T06:29:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450299409",
      "id" : 450299409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDI5OTQwOQ==",
      "updated_at" : "2018-12-28T06:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450299409",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "At least on Travis, the failure isn't caused by `listen()`'s errno being lost.\r\n\r\nInstead, what's happening is that `getaddrinfo` is returning `EVUTIL_EAI_ADDRFAMILY`. These errors are borrowed from the system's `EAI_*` constants, which [can] overlap with `errno`'s constants, so it's not practical to just stuff them into `errno` from `evhttp_bind_socket_with_handle`... Opened a libevent issue for this: https://github.com/libevent/libevent/issues/740\r\n\r\nAdded a somewhat-ugly hack on top of my branch: https://github.com/bitcoin/bitcoin/commit/d2d51e7aedc85f50dcc3a94d220500cb3bfe10f9",
      "created_at" : "2018-12-28T07:40:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450309374",
      "id" : 450309374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDMwOTM3NA==",
      "updated_at" : "2018-12-28T07:40:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450309374",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just noticed Travis is passing on this PR... did we lose some test coverage between 0.17 (where I'm testing it) and master?",
      "created_at" : "2018-12-28T08:58:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450321053",
      "id" : 450321053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDMyMTA1Mw==",
      "updated_at" : "2018-12-28T08:58:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450321053",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Unfortunately, evhttp_bind_socket_with_handle returns a 0/Success errno when listen fails. \r\n\r\nStrange, this worked for me, and it seems to work on Travis. As stated I've tested this (at least on Linux) in various ways.\r\n\r\nAn alternative solution here (which I initially wanted to do, but this seemed like a workable suggestion at the time **if of course C code didn't mess up error handling everywhere**) is to test which local interfaces are available, and only\r\n-  *try* to bind to IPv4 if there's IPv4 localhost\r\n-  *try* to bind to IPv6 if there's IPv6 localhost\r\n\r\nThis avoids having to check error codes, and could be more robust. I might give this a try. Though I'm not sure there's a good platform-independent way of doing this.\r\n\r\nI do not think this is worth adding a forest of hacks cloning parts of code from libevent for. Better to leave it as-is then, it wasn't that bad.",
      "created_at" : "2018-12-28T09:17:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450324159",
      "id" : 450324159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDMyNDE1OQ==",
      "updated_at" : "2018-12-28T09:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450324159",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "WAIT: it's the `bind` in `evhttp_bind_socket_with_handle` failing that we're looking for here, not the `listen`. This seems to not touch the error code, so it can be retrieved succesfully:\r\n\r\n```c++\r\n\tif ((fd = bind_socket(address, port, 1 /*reuse*/)) == -1)\r\n\t\treturn (NULL);\r\n```\r\n\r\nI don't think we care about specific `errno` when `listen` fails, do we? This is always fatal.\r\n",
      "created_at" : "2018-12-28T09:35:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450327342",
      "id" : 450327342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDMyNzM0Mg==",
      "updated_at" : "2018-12-28T09:36:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450327342",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "With this backported to 0.17, Travis was indeed failing on `getaddrinfo`; no idea why it's passing on master. :/",
      "created_at" : "2018-12-28T11:24:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450344476",
      "id" : 450344476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDM0NDQ3Ng==",
      "updated_at" : "2018-12-28T11:24:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450344476",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, tried in #15050, really strange. I think specific error code checking is a dead end, just too fragile.\r\n\r\nLooking for a platform independent way now to check if there is a local IPv4 or local IPv6 interface without actually binding to it. `libevent` internally checks for a *nonlocal* interface in `evutil_found_ifaddr` but this is not what we want to know in this case.\r\nToo bad the logic in `evutil_check_ifaddrs` is not exposed externally.\r\n\r\nLooks like we have vaguely analogous logic in `void Discover()` in `net.cpp`, though for windows it falls back to 'look up localhost'.",
      "created_at" : "2018-12-28T11:37:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450346083",
      "id" : 450346083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDM0NjA4Mw==",
      "updated_at" : "2018-12-28T11:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450346083",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this for now.",
      "created_at" : "2018-12-28T11:43:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14968#issuecomment-450346742",
      "id" : 450346742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14968",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MDM0Njc0Mg==",
      "updated_at" : "2018-12-28T11:43:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/450346742",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
