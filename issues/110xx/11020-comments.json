[
   {
      "body" : "Not sure why `zapwallettxes.py` is failing. It's not touching anything I changed (and the test passes on my fork's travis & when running the test locally / via `make check` ...). @jnewbery thoughts?",
      "created_at" : "2017-08-10T09:06:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-321495466",
      "id" : 321495466,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-10T09:06:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321495466",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "The zapwallettxes' failure is intermittent. Respinned travis.",
      "created_at" : "2017-08-10T09:36:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-321502374",
      "id" : 321502374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-10T09:36:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321502374",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "I'd hoped that #10330 had fixed the zapwallettxes intermittency. @MarcoFalke do you have an example of it failing (the failure on this PR is no longer available since the task was restarted in Travis).\r\n\r\n(apologies for being off-topic)",
      "created_at" : "2017-08-10T15:39:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-321589503",
      "id" : 321589503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-10T15:39:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321589503",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@jnewbery Sorry I didn't keep track of the exact failure this time, I assume it was one of the known issues that popped up recently.",
      "created_at" : "2017-08-10T20:03:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-321658473",
      "id" : 321658473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-10T20:03:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321658473",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132804998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132804998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, snake case.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-12T00:37:55Z",
      "diff_hunk" : "@@ -940,7 +940,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman) override;\n     // ResendWalletTransactionsBefore may only be called if fBroadcastTransactions!\n     std::vector<uint256> ResendWalletTransactionsBefore(int64_t nTime, CConnman* connman);\n-    CAmount GetBalance() const;\n+    CAmount GetBalance(bool ignoreUnspendable = true) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132804998",
      "id" : 132804998,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 14,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 55930842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132804998",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805003"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, snake case.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-12T00:38:00Z",
      "diff_hunk" : "@@ -465,7 +465,7 @@ class CWalletTx : public CMerkleTx\n     bool IsEquivalentTo(const CWalletTx& tx) const;\n \n     bool InMempool() const;\n-    bool IsTrusted() const;\n+    bool IsTrusted(bool ignoreUnspendable = true) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805003",
      "id" : 132805003,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 55930842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805003",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805193"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Assert exact value?",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-12T00:42:55Z",
      "diff_hunk" : "@@ -392,6 +392,8 @@ def run_test(self):\n         extra_txid = self.nodes[0].sendtoaddress(sending_addr, Decimal('0.0001'))\n         assert(extra_txid not in self.nodes[0].getrawmempool())\n         assert(extra_txid in [tx[\"txid\"] for tx in self.nodes[0].listtransactions()])\n+        # The change output for extra_txid should be in the balance if we include unspendable\n+        assert(self.nodes[0].getbalance() < self.nodes[0].getbalance(include_unspendable=True))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805193",
      "id" : 132805193,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "test/functional/wallet.py",
      "position" : null,
      "pull_request_review_id" : 55930842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805193",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805271"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, snake case.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-12T00:44:34Z",
      "diff_hunk" : "@@ -1823,7 +1823,7 @@ bool CWalletTx::InMempool() const\n     return mempool.exists(GetHash());\n }\n \n-bool CWalletTx::IsTrusted() const\n+bool CWalletTx::IsTrusted(bool ignoreUnspendable) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805271",
      "id" : 132805271,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 55930842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805271",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805796"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Update comment.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-12T00:59:24Z",
      "diff_hunk" : "@@ -1837,7 +1837,7 @@ bool CWalletTx::IsTrusted() const\n         return false;\n \n     // Don't trust unconfirmed transactions from us unless they are in the mempool.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132805796",
      "id" : 132805796,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 55930842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132805796",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132976907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132976907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this argument name is a bit confusing. Perhaps `include_not_yet_spendable`. It's a bit of a mouthful, but 'unspendable' sounds too permanent to me.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-14T15:11:54Z",
      "diff_hunk" : "@@ -755,6 +755,8 @@ UniValue getbalance(const JSONRPCRequest& request)\n             \"                     avoid passing this argument.\\n\"\n             \"2. minconf           (numeric, optional, default=1) Only include transactions confirmed at least this many times.\\n\"\n             \"3. include_watchonly (bool, optional, default=false) Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+            \"4. include_unspendable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132976907",
      "id" : 132976907,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 16,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56108066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132976907",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132978397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132978397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is confusing for me. `include_unspendable` only has effect if:\r\n\r\n- `account` is not specified; and\r\n- `minconf` is not specified; and\r\n- `include_watchonly` is not specified\r\n\r\nAdditionally, if `account` is specified as `\"\"` (ie balance not associated with any account), the returned balance will use `GetBalance()` if `include_unspendable` is not set, but `GetLegacyBalance()` if it is set.\r\n\r\nCan you explain the reasoning here?",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-14T15:17:22Z",
      "diff_hunk" : "@@ -768,8 +770,10 @@ UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (request.params.size() == 0)\n-        return  ValueFromAmount(pwallet->GetBalance());\n+    bool ignoreUnspendable = request.params[3].isNull() || !request.params[3].get_bool();\n+    if ((request.params[0].isNull() || (request.params[0].get_str() == \"\" && !ignoreUnspendable)) && request.params[1].isNull() && request.params[2].isNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132978397",
      "id" : 132978397,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 28,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56108066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132978397",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132978623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132978623"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find it confusing that the API uses `include_unspendable`, but internally you use `ignoreUnspendable` which is the inverse. Any reason not to be consistent?",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-14T15:18:13Z",
      "diff_hunk" : "@@ -768,8 +770,10 @@ UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (request.params.size() == 0)\n-        return  ValueFromAmount(pwallet->GetBalance());\n+    bool ignoreUnspendable = request.params[3].isNull() || !request.params[3].get_bool();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132978623",
      "id" : 132978623,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 27,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56108066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132978623",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132979387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132979387"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Asserting on exact values can make the test more brittle. I think it's fine to test strict lesser than here.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-14T15:20:48Z",
      "diff_hunk" : "@@ -392,6 +392,8 @@ def run_test(self):\n         extra_txid = self.nodes[0].sendtoaddress(sending_addr, Decimal('0.0001'))\n         assert(extra_txid not in self.nodes[0].getrawmempool())\n         assert(extra_txid in [tx[\"txid\"] for tx in self.nodes[0].listtransactions()])\n+        # The change output for extra_txid should be in the balance if we include unspendable\n+        assert(self.nodes[0].getbalance() < self.nodes[0].getbalance(include_unspendable=True))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132979387",
      "id" : 132979387,
      "in_reply_to_id" : 132805193,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "test/functional/wallet.py",
      "position" : null,
      "pull_request_review_id" : 56108066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132979387",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132979704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132979704"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, I think the name `ignoreUnspendable` could be made clearer.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-14T15:21:54Z",
      "diff_hunk" : "@@ -1823,7 +1823,7 @@ bool CWalletTx::InMempool() const\n     return mempool.exists(GetHash());\n }\n \n-bool CWalletTx::IsTrusted() const\n+bool CWalletTx::IsTrusted(bool ignoreUnspendable) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r132979704",
      "id" : 132979704,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56108066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132979704",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133101706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133101706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure what you mean -- most other argument names are written in this style, e.g. redeemScript, mapKeyBirth, etc.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-15T01:37:10Z",
      "diff_hunk" : "@@ -465,7 +465,7 @@ class CWalletTx : public CMerkleTx\n     bool IsEquivalentTo(const CWalletTx& tx) const;\n \n     bool InMempool() const;\n-    bool IsTrusted() const;\n+    bool IsTrusted(bool ignoreUnspendable = true) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133101706",
      "id" : 133101706,
      "in_reply_to_id" : 132805003,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 56246240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133101706",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133102025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133102025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was hoping the description of the argument would alleviate that, but you may be right.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-15T01:40:28Z",
      "diff_hunk" : "@@ -755,6 +755,8 @@ UniValue getbalance(const JSONRPCRequest& request)\n             \"                     avoid passing this argument.\\n\"\n             \"2. minconf           (numeric, optional, default=1) Only include transactions confirmed at least this many times.\\n\"\n             \"3. include_watchonly (bool, optional, default=false) Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+            \"4. include_unspendable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133102025",
      "id" : 133102025,
      "in_reply_to_id" : 132976907,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 16,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56246580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133102025",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133102078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133102078"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It ended up that way. You're right, will fix.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-15T01:41:05Z",
      "diff_hunk" : "@@ -768,8 +770,10 @@ UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (request.params.size() == 0)\n-        return  ValueFromAmount(pwallet->GetBalance());\n+    bool ignoreUnspendable = request.params[3].isNull() || !request.params[3].get_bool();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133102078",
      "id" : 133102078,
      "in_reply_to_id" : 132978623,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 27,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56246634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133102078",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133102309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133102309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The argument is the last in the list, and there's no way to give a default value for `account` because it's not being JSON parsed (you can't pass \"null\" as it would become the string \"null\"). Using named arguments, you can do this, but otherwise I have to make the \"special case\" of you passing defaults in.\r\n\r\nThe legacy balance seems to not be very used and possibly even about to be deprecated, so I didn't feel the need to update it. That, and it already kind of does what the PR is doing when you do a 0 `minconf` and `account=\"*\"`.\r\n",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-15T01:43:40Z",
      "diff_hunk" : "@@ -768,8 +770,10 @@ UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (request.params.size() == 0)\n-        return  ValueFromAmount(pwallet->GetBalance());\n+    bool ignoreUnspendable = request.params[3].isNull() || !request.params[3].get_bool();\n+    if ((request.params[0].isNull() || (request.params[0].get_str() == \"\" && !ignoreUnspendable)) && request.params[1].isNull() && request.params[2].isNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133102309",
      "id" : 133102309,
      "in_reply_to_id" : 132978397,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 28,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56246861,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133102309",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133103187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133103187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Asserting on exact values can make the test more brittle.\r\n\r\nIs that a bad thing?",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-15T01:53:11Z",
      "diff_hunk" : "@@ -392,6 +392,8 @@ def run_test(self):\n         extra_txid = self.nodes[0].sendtoaddress(sending_addr, Decimal('0.0001'))\n         assert(extra_txid not in self.nodes[0].getrawmempool())\n         assert(extra_txid in [tx[\"txid\"] for tx in self.nodes[0].listtransactions()])\n+        # The change output for extra_txid should be in the balance if we include unspendable\n+        assert(self.nodes[0].getbalance() < self.nodes[0].getbalance(include_unspendable=True))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133103187",
      "id" : 133103187,
      "in_reply_to_id" : 132805193,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "test/functional/wallet.py",
      "position" : null,
      "pull_request_review_id" : 56247799,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133103187",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "@promag @jnewbery Thanks for the review!\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/11020/commits/28e8271424b8642e825889bfaa8e51ae6a2a60dd fixes comment\r\n* https://github.com/bitcoin/bitcoin/pull/11020/commits/df7228d5dec184c92f7190265afb2c380da0a9ae fixes the inconsistency in variable names, but currently retains the `include_unspendable` name. I'm not sure I agree with the longer version @jnewbery suggested, but I'm up for changing this to something more intuitive if people feel it's worthwhile.\r\n* https://github.com/bitcoin/bitcoin/pull/11020/commits/80acc02b0e77791605eb8f0cb20263986ea87399 adds the feature to `getunconfirmedbalance` (tested in https://github.com/bitcoin/bitcoin/pull/11020/commits/36423983a1b1a473151056bb5d4e3159975c9b18). I was not entirely sure about the logic on this one, but I went with `!IsTrusted() & depth=0 & (includeUnspendable || InMempool())`, changed from `!IsTrusted() & depth=0 & InMempool()`. This means some balance will overlap between `getbalance(include_unspendable=true)` and `getunconfirmedbalance(include_unspendable=true)` but I think that's ok.\r\n",
      "created_at" : "2017-08-15T02:27:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-322360378",
      "id" : 322360378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-15T02:27:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322360378",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133111389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133111389"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's bad if the test will intermittently fail for unrelated reasons (rounding errors, for example).",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-15T03:38:32Z",
      "diff_hunk" : "@@ -392,6 +392,8 @@ def run_test(self):\n         extra_txid = self.nodes[0].sendtoaddress(sending_addr, Decimal('0.0001'))\n         assert(extra_txid not in self.nodes[0].getrawmempool())\n         assert(extra_txid in [tx[\"txid\"] for tx in self.nodes[0].listtransactions()])\n+        # The change output for extra_txid should be in the balance if we include unspendable\n+        assert(self.nodes[0].getbalance() < self.nodes[0].getbalance(include_unspendable=True))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133111389",
      "id" : 133111389,
      "in_reply_to_id" : 132805193,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "test/functional/wallet.py",
      "position" : null,
      "pull_request_review_id" : 56256562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133111389",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133196962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133196962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find it surprising that `minconf` and `watchonly` only have effect if account is specified, and now `include_unspendable` only has effect if account is not specified. There doesn't appear to be any user documentation explaining that.\r\n\r\nI'm afraid I don't know the history or motivation for that. @ryanofsky made changes in this area recently. Perhaps he can shed light on this.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-15T14:02:31Z",
      "diff_hunk" : "@@ -768,8 +770,10 @@ UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (request.params.size() == 0)\n-        return  ValueFromAmount(pwallet->GetBalance());\n+    bool ignoreUnspendable = request.params[3].isNull() || !request.params[3].get_bool();\n+    if ((request.params[0].isNull() || (request.params[0].get_str() == \"\" && !ignoreUnspendable)) && request.params[1].isNull() && request.params[2].isNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133196962",
      "id" : 133196962,
      "in_reply_to_id" : 132978397,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 28,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56348991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133196962",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "zapwallettxes.py again, @jnewbery: https://pastebin.com/70bQ7CLq",
      "created_at" : "2017-08-16T05:21:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-322669077",
      "id" : 322669077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-16T05:21:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322669077",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133457898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133457898"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That should not happen. There are lots of exact asserts through out this file.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-16T14:01:30Z",
      "diff_hunk" : "@@ -392,6 +392,8 @@ def run_test(self):\n         extra_txid = self.nodes[0].sendtoaddress(sending_addr, Decimal('0.0001'))\n         assert(extra_txid not in self.nodes[0].getrawmempool())\n         assert(extra_txid in [tx[\"txid\"] for tx in self.nodes[0].listtransactions()])\n+        # The change output for extra_txid should be in the balance if we include unspendable\n+        assert(self.nodes[0].getbalance() < self.nodes[0].getbalance(include_unspendable=True))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133457898",
      "id" : 133457898,
      "in_reply_to_id" : 132805193,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 5,
      "path" : "test/functional/wallet.py",
      "position" : null,
      "pull_request_review_id" : 56640065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133457898",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133458346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133458346"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, please align other arguments as this is currently the longest.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-16T14:03:03Z",
      "diff_hunk" : "@@ -755,6 +755,8 @@ UniValue getbalance(const JSONRPCRequest& request)\n             \"                     avoid passing this argument.\\n\"\n             \"2. minconf           (numeric, optional, default=1) Only include transactions confirmed at least this many times.\\n\"\n             \"3. include_watchonly (bool, optional, default=false) Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+            \"4. include_unspendable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133458346",
      "id" : 133458346,
      "in_reply_to_id" : 132976907,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 16,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56640618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133458346",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "IMO from the wallet point of view those UTXO should always be part of the balance, and in that case this should be a bug fix and not require more options. WDYT?\r\n\r\nEdit: unless `getbalance` defaults to available balance. If that's the case the option can be `include_unavailable` (default false) or `only_available` (default true).",
      "created_at" : "2017-08-16T14:18:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-322786328",
      "id" : 322786328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-16T14:41:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322786328",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "Yes `getbalance` is available balance, I think, so I don't think it should default to including these. Of course, there is the option of making the coin select include these coins even though they're not in the mempool, in which case `getbalance` could include them, but that's for another time (and PR).\r\n\r\nHm, `include_unavailable` seems like a better name for it than `include_unspendable`.",
      "created_at" : "2017-08-17T05:12:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-322970593",
      "id" : 322970593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2017-08-17T05:12:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322970593",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133624848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133624848"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, `include_watchonly` is slightly longer, but I think realigning is a good idea yeah.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2017-08-17T05:16:02Z",
      "diff_hunk" : "@@ -755,6 +755,8 @@ UniValue getbalance(const JSONRPCRequest& request)\n             \"                     avoid passing this argument.\\n\"\n             \"2. minconf           (numeric, optional, default=1) Only include transactions confirmed at least this many times.\\n\"\n             \"3. include_watchonly (bool, optional, default=false) Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+            \"4. include_unspendable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r133624848",
      "id" : 133624848,
      "in_reply_to_id" : 132976907,
      "original_commit_id" : "5b644c85b725b11fd44d0412868023419b06492b",
      "original_position" : 16,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 56826673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/133624848",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased this, but now it is not available unless the user enables deprecated account. I could\r\n\r\n1. Add a new \"index 0\" parameter to the non-deprecated variant, replacing `\"account\"`, and allowing up to 1 argument for the new style. This obviously could be potentially confusing.\r\n2. Keep the index and allow up to 4 indices in new style, but require that items at index 0..2 are all null. Fine for `-named` style but ughy otherwise.\r\n\r\nPing @jnewbery.\r\n\r\nEdit: I went with the second option in c8c147a.",
      "created_at" : "2018-05-22T02:52:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-390846515",
      "id" : 390846515,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2018-05-22T04:10:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390846515",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think I prefer option (1). Overloading parameters can be confusing, but I think it's better in this case because:\r\n\r\n- the meaning of argument 0 is not ambiguous - it's fixed by setting the `deprecaterrpc` argument.\r\n- `include_unavailable` is a bool and `account` is a string\r\n- the `account`, `minconf` and `include_watchonly` parameters will be removed in the next release.\r\n- going with option (2) will lock us in to having 3 dummy arguments for future releases.",
      "created_at" : "2018-05-22T15:10:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-391027560",
      "id" : 391027560,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2018-05-22T15:10:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391027560",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery I definitely *prefer* option 1 but I wasn't sure it would be disruptive. Will switch.",
      "created_at" : "2018-05-22T23:23:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-391172101",
      "id" : 391172101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2018-05-22T23:23:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391172101",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery See 0c28d8f -- I split up the descriptions based on deprecation, and fixed several text issues (e.g. RPC examples using the deprecated stuff). I think this change alone is worth a PR, to be honest.\r\n\r\nFWIW I also removed `include_unavailable` from the deprecated variant since we're removing it anyway.\r\n\r\nSince \"accounts\" is not JSON-parsed and \"include_unavailable\" wants to be, I am temporarily doing the conversion manually (testing for \"true\" or \"1\"). Once accounts are removed, we can add param 0 to clients.cpp and remove the manual stuff.",
      "created_at" : "2018-05-22T23:33:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-391173654",
      "id" : 391173654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2018-05-23T00:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391173654",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190295026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190295026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: variables and arguments should be in snake_case (same for all args below)",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-23T15:32:46Z",
      "diff_hunk" : "@@ -2042,7 +2042,7 @@ bool CWalletTx::InMempool() const\n     return fInMempool;\n }\n \n-bool CWalletTx::IsTrusted() const\n+bool CWalletTx::IsTrusted(bool trustUnavailable) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190295026",
      "id" : 190295026,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122642985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190295026",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190295383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190295383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this call `IsTrusted()` with `includeUnavailable`? If not, coins that are in the mempool could show up in both the balance and the unconfirmed balance.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-23T15:33:38Z",
      "diff_hunk" : "@@ -2141,31 +2142,31 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  */\n \n \n-CAmount CWallet::GetBalance() const\n+CAmount CWallet::GetBalance(bool includeUnavailable) const\n {\n     CAmount nTotal = 0;\n     {\n         LOCK2(cs_main, cs_wallet);\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx* pcoin = &entry.second;\n-            if (pcoin->IsTrusted())\n+            if (pcoin->IsTrusted(includeUnavailable))\n                 nTotal += pcoin->GetAvailableCredit();\n         }\n     }\n \n     return nTotal;\n }\n \n-CAmount CWallet::GetUnconfirmedBalance() const\n+CAmount CWallet::GetUnconfirmedBalance(bool includeUnavailable) const\n {\n     CAmount nTotal = 0;\n     {\n         LOCK2(cs_main, cs_wallet);\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx* pcoin = &entry.second;\n-            if (!pcoin->IsTrusted() && pcoin->GetDepthInMainChain() == 0 && pcoin->InMempool())\n+            if (!pcoin->IsTrusted() && pcoin->GetDepthInMainChain() == 0 && (includeUnavailable || pcoin->InMempool()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190295383",
      "id" : 190295383,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 53,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122642985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190295383",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190296922"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190296922"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: can be moved below the `if (IsDeprecatedRPCEnabled(\"accounts\")) {` block and the `!IsDeprecatedRPCEnabled(\"accounts\")` condition removed (since the code below the `if (IsDeprecatedRPCEnabled(\"accounts\")) {` block is effectively the else branch.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-23T15:37:08Z",
      "diff_hunk" : "@@ -832,48 +832,74 @@ static UniValue getbalance(const JSONRPCRequest& request)\n         return NullUniValue;\n     }\n \n-    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() != 0 && !IsDeprecatedRPCEnabled(\"accounts\")))\n-        throw std::runtime_error(\n-            \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n-            \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n-            \"The available balance is what the wallet considers currently spendable, and is\\n\"\n-            \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n-            \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n-            \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n-            \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n-            \"\\nArguments:\\n\"\n-            \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n-            \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n-            \"                     specific account name to find the balance associated with wallet keys in\\n\"\n-            \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n-            \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n-            \"                     the balance associated with all wallet keys regardless of account.\\n\"\n-            \"                     When this option is specified, it calculates the balance in a different\\n\"\n-            \"                     way than when it is not specified, and which can count spends twice when\\n\"\n-            \"                     there are conflicting pending transactions (such as those created by\\n\"\n-            \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n-            \"                     balances. In general, account balance calculation is not considered\\n\"\n-            \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n-            \"                     avoid passing this argument.\\n\"\n-            \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n-            \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n-            \"\\nResult:\\n\"\n-            \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n-            \"\\nExamples:\\n\"\n-            \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\") +\n-            \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n-            \"\\nAs a json rpc call\\n\"\n-            + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n-        );\n+    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() > 1 && !IsDeprecatedRPCEnabled(\"accounts\"))) {\n+        if (IsDeprecatedRPCEnabled(\"accounts\")) {\n+            throw std::runtime_error(\n+                \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n+                \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n+                \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n+                \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n+                \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n+                \"                     specific account name to find the balance associated with wallet keys in\\n\"\n+                \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n+                \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n+                \"                     the balance associated with all wallet keys regardless of account.\\n\"\n+                \"                     When this option is specified, it calculates the balance in a different\\n\"\n+                \"                     way than when it is not specified, and which can count spends twice when\\n\"\n+                \"                     there are conflicting pending transactions (such as those created by\\n\"\n+                \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n+                \"                     balances. In general, account balance calculation is not considered\\n\"\n+                \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n+                \"                     avoid passing this argument.\\n\"\n+                \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n+                \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n+            );\n+        } else {\n+            throw std::runtime_error(\n+                \"getbalance ( include_unavailable )\\n\"\n+                \"\\nReturns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. include_unavailable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but possibly in the future)\\n\"\n+                \"                                                       spendable.\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet, including currently unspendable UTXO:s\\n\"\n+                + HelpExampleCli(\"getbalance\", \"true\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"true\")\n+            );\n+        }\n+    }\n \n     // Make sure the results are valid at least up to the most recent block\n     // the user could have gotten from another RPC command prior to now\n     pwallet->BlockUntilSyncedToCurrentChain();\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n+    // params[0] is not converted from JSON until account stuff is removed, so we need to manually convert it here",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190296922",
      "id" : 190296922,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 103,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122642985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190296922",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190316137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190316137"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: since you're changing the help text for this and `getunconfirmedbalance`, perhaps correct it to say \"the *wallet's* ...\" instead of \"the *server's* ...\"",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-23T16:29:54Z",
      "diff_hunk" : "@@ -832,48 +832,74 @@ static UniValue getbalance(const JSONRPCRequest& request)\n         return NullUniValue;\n     }\n \n-    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() != 0 && !IsDeprecatedRPCEnabled(\"accounts\")))\n-        throw std::runtime_error(\n-            \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n-            \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n-            \"The available balance is what the wallet considers currently spendable, and is\\n\"\n-            \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n-            \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n-            \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n-            \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n-            \"\\nArguments:\\n\"\n-            \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n-            \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n-            \"                     specific account name to find the balance associated with wallet keys in\\n\"\n-            \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n-            \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n-            \"                     the balance associated with all wallet keys regardless of account.\\n\"\n-            \"                     When this option is specified, it calculates the balance in a different\\n\"\n-            \"                     way than when it is not specified, and which can count spends twice when\\n\"\n-            \"                     there are conflicting pending transactions (such as those created by\\n\"\n-            \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n-            \"                     balances. In general, account balance calculation is not considered\\n\"\n-            \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n-            \"                     avoid passing this argument.\\n\"\n-            \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n-            \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n-            \"\\nResult:\\n\"\n-            \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n-            \"\\nExamples:\\n\"\n-            \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\") +\n-            \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n-            \"\\nAs a json rpc call\\n\"\n-            + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n-        );\n+    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() > 1 && !IsDeprecatedRPCEnabled(\"accounts\"))) {\n+        if (IsDeprecatedRPCEnabled(\"accounts\")) {\n+            throw std::runtime_error(\n+                \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n+                \"\\nIf account is not specified, returns the server's total available balance.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190316137",
      "id" : 190316137,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 43,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 43,
      "pull_request_review_id" : 122642985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190316137",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190321122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190321122"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's a bit ugly to replicate the univalue parsing here, but I think it's ok since it's only going to be in here for one release.\r\n\r\nI think you should remove the `request.params[0].get_str() == \"1\"` (1 isn't interpreted as true in univalue). You may also throw an error if `request.params[0].get_str()` is not `false` or `true` (so passing `True` for example doesn't silently fail and leave `include_unavailable` as false.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-23T16:45:55Z",
      "diff_hunk" : "@@ -832,48 +832,74 @@ static UniValue getbalance(const JSONRPCRequest& request)\n         return NullUniValue;\n     }\n \n-    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() != 0 && !IsDeprecatedRPCEnabled(\"accounts\")))\n-        throw std::runtime_error(\n-            \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n-            \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n-            \"The available balance is what the wallet considers currently spendable, and is\\n\"\n-            \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n-            \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n-            \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n-            \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n-            \"\\nArguments:\\n\"\n-            \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n-            \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n-            \"                     specific account name to find the balance associated with wallet keys in\\n\"\n-            \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n-            \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n-            \"                     the balance associated with all wallet keys regardless of account.\\n\"\n-            \"                     When this option is specified, it calculates the balance in a different\\n\"\n-            \"                     way than when it is not specified, and which can count spends twice when\\n\"\n-            \"                     there are conflicting pending transactions (such as those created by\\n\"\n-            \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n-            \"                     balances. In general, account balance calculation is not considered\\n\"\n-            \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n-            \"                     avoid passing this argument.\\n\"\n-            \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n-            \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n-            \"\\nResult:\\n\"\n-            \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n-            \"\\nExamples:\\n\"\n-            \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\") +\n-            \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n-            \"\\nAs a json rpc call\\n\"\n-            + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n-        );\n+    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() > 1 && !IsDeprecatedRPCEnabled(\"accounts\"))) {\n+        if (IsDeprecatedRPCEnabled(\"accounts\")) {\n+            throw std::runtime_error(\n+                \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n+                \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n+                \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n+                \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n+                \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n+                \"                     specific account name to find the balance associated with wallet keys in\\n\"\n+                \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n+                \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n+                \"                     the balance associated with all wallet keys regardless of account.\\n\"\n+                \"                     When this option is specified, it calculates the balance in a different\\n\"\n+                \"                     way than when it is not specified, and which can count spends twice when\\n\"\n+                \"                     there are conflicting pending transactions (such as those created by\\n\"\n+                \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n+                \"                     balances. In general, account balance calculation is not considered\\n\"\n+                \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n+                \"                     avoid passing this argument.\\n\"\n+                \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n+                \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n+            );\n+        } else {\n+            throw std::runtime_error(\n+                \"getbalance ( include_unavailable )\\n\"\n+                \"\\nReturns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. include_unavailable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but possibly in the future)\\n\"\n+                \"                                                       spendable.\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet, including currently unspendable UTXO:s\\n\"\n+                + HelpExampleCli(\"getbalance\", \"true\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"true\")\n+            );\n+        }\n+    }\n \n     // Make sure the results are valid at least up to the most recent block\n     // the user could have gotten from another RPC command prior to now\n     pwallet->BlockUntilSyncedToCurrentChain();\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n+    // params[0] is not converted from JSON until account stuff is removed, so we need to manually convert it here\n+    // TODO: add param[0] to clients.cpp for getbalance and switch to get_bool() here, once account stuff is removed\n+    const bool include_unavailable = !IsDeprecatedRPCEnabled(\"accounts\") && !request.params[0].isNull() && (request.params[0].get_str() == \"1\" || request.params[0].get_str() == \"true\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190321122",
      "id" : 190321122,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 105,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122642985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190321122",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190464972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190464972"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure. I'll add tests to check that this is not the case.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-24T04:47:47Z",
      "diff_hunk" : "@@ -2141,31 +2142,31 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  */\n \n \n-CAmount CWallet::GetBalance() const\n+CAmount CWallet::GetBalance(bool includeUnavailable) const\n {\n     CAmount nTotal = 0;\n     {\n         LOCK2(cs_main, cs_wallet);\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx* pcoin = &entry.second;\n-            if (pcoin->IsTrusted())\n+            if (pcoin->IsTrusted(includeUnavailable))\n                 nTotal += pcoin->GetAvailableCredit();\n         }\n     }\n \n     return nTotal;\n }\n \n-CAmount CWallet::GetUnconfirmedBalance() const\n+CAmount CWallet::GetUnconfirmedBalance(bool includeUnavailable) const\n {\n     CAmount nTotal = 0;\n     {\n         LOCK2(cs_main, cs_wallet);\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx* pcoin = &entry.second;\n-            if (!pcoin->IsTrusted() && pcoin->GetDepthInMainChain() == 0 && pcoin->InMempool())\n+            if (!pcoin->IsTrusted() && pcoin->GetDepthInMainChain() == 0 && (includeUnavailable || pcoin->InMempool()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190464972",
      "id" : 190464972,
      "in_reply_to_id" : 190295383,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 53,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122844563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190464972",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190465078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190465078"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point!",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-24T04:48:53Z",
      "diff_hunk" : "@@ -832,48 +832,74 @@ static UniValue getbalance(const JSONRPCRequest& request)\n         return NullUniValue;\n     }\n \n-    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() != 0 && !IsDeprecatedRPCEnabled(\"accounts\")))\n-        throw std::runtime_error(\n-            \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n-            \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n-            \"The available balance is what the wallet considers currently spendable, and is\\n\"\n-            \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n-            \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n-            \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n-            \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n-            \"\\nArguments:\\n\"\n-            \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n-            \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n-            \"                     specific account name to find the balance associated with wallet keys in\\n\"\n-            \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n-            \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n-            \"                     the balance associated with all wallet keys regardless of account.\\n\"\n-            \"                     When this option is specified, it calculates the balance in a different\\n\"\n-            \"                     way than when it is not specified, and which can count spends twice when\\n\"\n-            \"                     there are conflicting pending transactions (such as those created by\\n\"\n-            \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n-            \"                     balances. In general, account balance calculation is not considered\\n\"\n-            \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n-            \"                     avoid passing this argument.\\n\"\n-            \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n-            \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n-            \"\\nResult:\\n\"\n-            \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n-            \"\\nExamples:\\n\"\n-            \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\") +\n-            \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n-            \"\\nAs a json rpc call\\n\"\n-            + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n-        );\n+    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() > 1 && !IsDeprecatedRPCEnabled(\"accounts\"))) {\n+        if (IsDeprecatedRPCEnabled(\"accounts\")) {\n+            throw std::runtime_error(\n+                \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n+                \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n+                \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n+                \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n+                \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n+                \"                     specific account name to find the balance associated with wallet keys in\\n\"\n+                \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n+                \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n+                \"                     the balance associated with all wallet keys regardless of account.\\n\"\n+                \"                     When this option is specified, it calculates the balance in a different\\n\"\n+                \"                     way than when it is not specified, and which can count spends twice when\\n\"\n+                \"                     there are conflicting pending transactions (such as those created by\\n\"\n+                \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n+                \"                     balances. In general, account balance calculation is not considered\\n\"\n+                \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n+                \"                     avoid passing this argument.\\n\"\n+                \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n+                \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n+            );\n+        } else {\n+            throw std::runtime_error(\n+                \"getbalance ( include_unavailable )\\n\"\n+                \"\\nReturns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. include_unavailable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but possibly in the future)\\n\"\n+                \"                                                       spendable.\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet, including currently unspendable UTXO:s\\n\"\n+                + HelpExampleCli(\"getbalance\", \"true\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"true\")\n+            );\n+        }\n+    }\n \n     // Make sure the results are valid at least up to the most recent block\n     // the user could have gotten from another RPC command prior to now\n     pwallet->BlockUntilSyncedToCurrentChain();\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n+    // params[0] is not converted from JSON until account stuff is removed, so we need to manually convert it here",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190465078",
      "id" : 190465078,
      "in_reply_to_id" : 190296922,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 103,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122844693,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190465078",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190465419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190465419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I thought `1` was true. E.g. `getrawtransaction <id> 1`. But that seems to be a special case for `getrawtransaction`, actually. Changing as you suggest.",
      "commit_id" : "a73ecd6ca6597f1c2612588e17c49b89007a9ef7",
      "created_at" : "2018-05-24T04:51:49Z",
      "diff_hunk" : "@@ -832,48 +832,74 @@ static UniValue getbalance(const JSONRPCRequest& request)\n         return NullUniValue;\n     }\n \n-    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() != 0 && !IsDeprecatedRPCEnabled(\"accounts\")))\n-        throw std::runtime_error(\n-            \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n-            \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n-            \"The available balance is what the wallet considers currently spendable, and is\\n\"\n-            \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n-            \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n-            \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n-            \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n-            \"\\nArguments:\\n\"\n-            \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n-            \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n-            \"                     specific account name to find the balance associated with wallet keys in\\n\"\n-            \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n-            \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n-            \"                     the balance associated with all wallet keys regardless of account.\\n\"\n-            \"                     When this option is specified, it calculates the balance in a different\\n\"\n-            \"                     way than when it is not specified, and which can count spends twice when\\n\"\n-            \"                     there are conflicting pending transactions (such as those created by\\n\"\n-            \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n-            \"                     balances. In general, account balance calculation is not considered\\n\"\n-            \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n-            \"                     avoid passing this argument.\\n\"\n-            \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n-            \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n-            \"\\nResult:\\n\"\n-            \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n-            \"\\nExamples:\\n\"\n-            \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\") +\n-            \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n-            + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n-            \"\\nAs a json rpc call\\n\"\n-            + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n-        );\n+    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() > 1 && !IsDeprecatedRPCEnabled(\"accounts\"))) {\n+        if (IsDeprecatedRPCEnabled(\"accounts\")) {\n+            throw std::runtime_error(\n+                \"getbalance ( \\\"account\\\" minconf include_watchonly )\\n\"\n+                \"\\nIf account is not specified, returns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"If account is specified (DEPRECATED), returns the balance in the account.\\n\"\n+                \"Note that the account \\\"\\\" is not the same as leaving the parameter out.\\n\"\n+                \"The server total may be different to the balance in the default \\\"\\\" account.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. \\\"account\\\"         (string, optional) DEPRECATED. This argument will be removed in V0.18. \\n\"\n+                \"                     To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. The account string may be given as a\\n\"\n+                \"                     specific account name to find the balance associated with wallet keys in\\n\"\n+                \"                     a named account, or as the empty string (\\\"\\\") to find the balance\\n\"\n+                \"                     associated with wallet keys not in any named account, or as \\\"*\\\" to find\\n\"\n+                \"                     the balance associated with all wallet keys regardless of account.\\n\"\n+                \"                     When this option is specified, it calculates the balance in a different\\n\"\n+                \"                     way than when it is not specified, and which can count spends twice when\\n\"\n+                \"                     there are conflicting pending transactions (such as those created by\\n\"\n+                \"                     the bumpfee command), temporarily resulting in low or even negative\\n\"\n+                \"                     balances. In general, account balance calculation is not considered\\n\"\n+                \"                     reliable and has resulted in confusing outcomes, so it is recommended to\\n\"\n+                \"                     avoid passing this argument.\\n\"\n+                \"2. minconf           (numeric, optional, default=1) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Only include transactions confirmed at least this many times.\\n\"\n+                \"3. include_watchonly (bool, optional, default=false) DEPRECATED. Only valid when an account is specified. This argument will be removed in V0.18. To use this deprecated argument, start bitcoind with -deprecatedrpc=accounts. Also include balance in watch-only addresses (see 'importaddress')\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received for this account.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet with 1 or more confirmations\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet at least 6 blocks confirmed\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\\\"*\\\" 6\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"\\\"*\\\", 6\")\n+            );\n+        } else {\n+            throw std::runtime_error(\n+                \"getbalance ( include_unavailable )\\n\"\n+                \"\\nReturns the server's total available balance.\\n\"\n+                \"The available balance is what the wallet considers currently spendable, and is\\n\"\n+                \"thus affected by options which limit spendability such as -spendzeroconfchange.\\n\"\n+                \"\\nArguments:\\n\"\n+                \"1. include_unavailable (bool, optional, default=false) Also include balance for UTXOs which are currently not (but possibly in the future)\\n\"\n+                \"                                                       spendable.\\n\"\n+                \"\\nResult:\\n\"\n+                \"amount              (numeric) The total amount in \" + CURRENCY_UNIT + \" received.\\n\"\n+                \"\\nExamples:\\n\"\n+                \"\\nThe total amount in the wallet\\n\"\n+                + HelpExampleCli(\"getbalance\", \"\") +\n+                \"\\nThe total amount in the wallet, including currently unspendable UTXO:s\\n\"\n+                + HelpExampleCli(\"getbalance\", \"true\") +\n+                \"\\nAs a json rpc call\\n\"\n+                + HelpExampleRpc(\"getbalance\", \"true\")\n+            );\n+        }\n+    }\n \n     // Make sure the results are valid at least up to the most recent block\n     // the user could have gotten from another RPC command prior to now\n     pwallet->BlockUntilSyncedToCurrentChain();\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n+    // params[0] is not converted from JSON until account stuff is removed, so we need to manually convert it here\n+    // TODO: add param[0] to clients.cpp for getbalance and switch to get_bool() here, once account stuff is removed\n+    const bool include_unavailable = !IsDeprecatedRPCEnabled(\"accounts\") && !request.params[0].isNull() && (request.params[0].get_str() == \"1\" || request.params[0].get_str() == \"true\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#discussion_r190465419",
      "id" : 190465419,
      "in_reply_to_id" : 190321122,
      "original_commit_id" : "fdbf735a7c4118c346c1bc93483acd743ec26cef",
      "original_position" : 105,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122845022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11020",
      "updated_at" : "2018-05-24T04:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190465419",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery \r\n> Should this call IsTrusted() with includeUnavailable? If not, coins that are in the mempool could show up in both the balance and the unconfirmed balance.\r\n\r\nLooking at the tests (it was a while since I wrote this), I think the idea was that it should be counted in both (see wallet_basic.py changes). Is this problematic?",
      "created_at" : "2018-05-24T04:57:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11020#issuecomment-391588259",
      "id" : 391588259,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11020",
      "updated_at" : "2018-05-24T04:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391588259",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   }
]
