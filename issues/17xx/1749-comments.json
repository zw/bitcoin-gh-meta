[
   {
      "body" : "What are the advantages and disadvantages of this?\n\nI'm ok with the changes although I don't like \"include three cpps in one cpp\", as it adds an almost-empty cpp in src/. I'd like it somewhat better if you moved the resulting jsonrpc.cpp to src/json instead.\n\nAlso, I might misunderstand what you're trying to do but you should probably remove the individual files (`src/json/json_spirit_*.cpp`) from the build systems otherwise you'll link them twice?\n",
      "created_at" : "2012-08-29T05:25:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1749#issuecomment-8115606",
      "id" : 8115606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1749",
      "updated_at" : "2012-08-29T05:27:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8115606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "This eliminates duplicating the templates in each *rpc*.o file.\n\nsrc/json/json_spirit_*.cpp are never built or linked.\n",
      "created_at" : "2012-08-29T05:35:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1749#issuecomment-8115728",
      "id" : 8115728,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1749",
      "updated_at" : "2012-08-29T05:35:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8115728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "OK I guess that will save some compilation time. I still don't like the almost-empty cpp though.\n\nThey are linked individually in bitcoin-qt.pro... probably, that is a the mistake then.\n",
      "created_at" : "2012-08-29T05:39:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1749#issuecomment-8115768",
      "id" : 8115768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1749",
      "updated_at" : "2012-08-29T05:39:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8115768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Sadly, bitcoinrpc.cpp's requirement of templates kills this optimization.  We can see that it makes a positive impact on compiled code size in several cases:\n```\n[jgarzik@localhost src]$ ls -l obj.vanilla/*rpc*.o \n-rw-rw-r-- 1 jgarzik jgarzik 9235016 Aug 29 00:52 obj.vanilla/bitcoinrpc.o\n-rw-rw-r-- 1 jgarzik jgarzik 2193688 Aug 29 00:53 obj.vanilla/rpcblockchain.o\n-rw-rw-r-- 1 jgarzik jgarzik 2427808 Aug 29 00:52 obj.vanilla/rpcdump.o\n-rw-rw-r-- 1 jgarzik jgarzik 3848484 Aug 29 00:53 obj.vanilla/rpcmining.o\n-rw-rw-r-- 1 jgarzik jgarzik 1433740 Aug 29 00:52 obj.vanilla/rpcnet.o\n-rw-rw-r-- 1 jgarzik jgarzik 4616688 Aug 29 00:54 obj.vanilla/rpcrawtransaction.o\n-rw-rw-r-- 1 jgarzik jgarzik 5919696 Aug 29 00:53 obj.vanilla/rpcwallet.o\n[jgarzik@localhost src]$ ls -l obj/*rpc*.o \n-rw-rw-r-- 1 jgarzik jgarzik 9235044 Aug 29 01:21 obj/bitcoinrpc.o\n-rw-rw-r-- 1 jgarzik jgarzik 2157036 Aug 29 01:22 obj/rpcblockchain.o\n-rw-rw-r-- 1 jgarzik jgarzik 2377376 Aug 29 01:21 obj/rpcdump.o\n-rw-rw-r-- 1 jgarzik jgarzik 3809184 Aug 29 01:21 obj/rpcmining.o\n-rw-rw-r-- 1 jgarzik jgarzik 1445256 Aug 29 01:21 obj/rpcnet.o\n-rw-rw-r-- 1 jgarzik jgarzik 4627340 Aug 29 01:23 obj/rpcrawtransaction.o\n-rw-rw-r-- 1 jgarzik jgarzik 5849288 Aug 29 01:22 obj/rpcwallet.o\n```\n\nHowever, due to bitcoinrpc.cpp's templates requirement, and other caveats (SEE BELOW), the final size is worse:\n```\n[jgarzik@localhost src]$ size obj.vanilla/bitcoind obj/bitcoind\n   text\t   data\t    bss\t    dec\t    hex\tfilename\n2688992\t   5368\t   7464\t2701824\t 293a00\tobj.vanilla/bitcoind\n3987711\t   5508\t   8232\t4001451\t 3d0eab\tobj/bitcoind\n\n[jgarzik@localhost src]$ ls -l obj.vanilla/bitcoind obj/bitcoind\n-rwxrwxr-x 1 jgarzik jgarzik 58337880 Aug 29 01:27 obj/bitcoind\n-rwxrwxr-x 1 jgarzik jgarzik 36560716 Aug 29 00:56 obj.vanilla/bitcoind\n```\n\nIf we can eliminate the template usage from bitcoinrpc.cpp, then this solution becomes viable.\n\nCaveats:\na) My i386 laptop does not work with -flto, which should dramatically improve the situation (but still the code is duplicated, due to bitcoinrpc.cpp's use of templates)\nb) libjson.o would be better constructed as a library archive (libjson.a).  However, as we use all the modules, this would probably not result in code savings.\n",
      "created_at" : "2012-08-29T05:40:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1749#issuecomment-8115783",
      "id" : 8115783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1749",
      "updated_at" : "2012-08-29T05:41:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8115783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   }
]
