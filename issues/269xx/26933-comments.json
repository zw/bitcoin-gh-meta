[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/26933#pullrequestreview-1388204359), [ajtowns](https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1523120410) |\n| Concept ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1401991736), [sdaftuar](https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1496286578) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26812](https://github.com/bitcoin/bitcoin/pull/26812) (test: add end-to-end tests for CConnman and PeerManager by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-20T13:33:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1398399449",
      "id" : 1398399449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585TWeHZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1398399449/reactions"
      },
      "updated_at" : "2023-04-26T09:49:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1398399449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CC @sdaftuar @ajtowns @instagibbs",
      "created_at" : "2023-01-20T13:52:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1398425920",
      "id" : 1398425920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585TWklA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1398425920/reactions"
      },
      "updated_at" : "2023-01-20T13:52:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1398425920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> * We can remove these transactions in `TrimToSize()`, but 2500 is not within our acceptable limits.\r\n\r\nI'm not sure I see why this is a problem? Can't we have the situation where 1000s of txs get evicted anyway, simply by accepting a high fee rate 400kb tx that then causes a large number of small min feerate txs (with no unconfirmed ancestors/descendants) to be evicted due to hitting the mempool limit? (At least evicting ~350 otherwise unrelated txs that way seems possible -- simple 1-in 1-out txs seem to contribute ~1150 bytes to mempool usage each for me, so 350 of them should use about 402kB)\r\n\r\n> (what if the 0-fee ancestor is bumped by something else?)\r\n\r\nWe essentially have to do the work to see if the ancestors are bumped by something else anyway, whether they're 0-fee or not (when we evict the conflicted descendant; its ancestors' descendant fee rates get updated). When we get to TrimToSize, we just look at the already calculated descendant score, and evict the low ones. But the logic there doesn't change if the lowest fee rate is 0 or 1 sat/vb?\r\n\r\n> 06:30 < sdaftuar> i think my concern is that the mempool shouldn't have things in it that would never get mined, eg because they're below minrelay fee (which we compare against in the mining code iirc)\r\n\r\nWouldn't it make more sense to address that directly, ie by having TrimToSize trim txs whose descendant score is below min relay fee, even if the mempool isn't full? Then txs who lose their CPFP child will get trimmed essentially immediately, no matter how they got in, and no matter why the parent might have been removed?\r\n\r\nI don't mind the concept here (which I summarise as \"only allow txs below min relay fee via some scheme that deliberately limits the complexity\"), but it seems more like a \"here's another special case\" instead of \"here's a simple rule that's easy for everyone to think about\".",
      "created_at" : "2023-01-23T07:38:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1399919892",
      "id" : 1399919892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585TcRUU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1399919892/reactions"
      },
      "updated_at" : "2023-01-23T07:38:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1399919892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Slightly out of order:\r\n\r\n> Wouldn't it make more sense to address that directly, ie by having TrimToSize trim txs whose descendant score is below min relay fee, even if the mempool isn't full?\r\n\r\nbtw I have this as the next commit (https://github.com/bitcoin/bitcoin/pull/25038/commits/898847e1907eda3d87d19ea43099b71d9eded5f4 or \"[mempool] evict everything below min relay fee in TrimToSize()\" commit in #25038). My concern was whether it would be problematic to have many such transactions to trim, hence these changes beforehand. If we instead decide that we're ok with this, I'm happy to drop these.\r\n\r\nSomewhat relevant, I'd also wonder if we should add a `TrimToSize()` at the end of reorgs. Same reason, so we don't add below-minrelayfee from disconnected blocks. And same concern, that it could make the process slower.\r\n\r\n> I'm not sure I see why this is a problem? Can't we have the situation where 1000s of txs get evicted anyway, simply by accepting a high fee rate 400kb tx that then causes a large number of small min feerate txs (with no unconfirmed ancestors/descendants) to be evicted due to hitting the mempool limit?\r\n\r\nYes, it is definitely not otherwise impossible to be evicting 1000s of transactions in `TrimToSize()`. But since package cpfp would be a new way of permitting such transactions, I'd rather lean towards being conservative?",
      "created_at" : "2023-01-23T09:34:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1400040869",
      "id" : 1400040869,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585Tcu2l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400040869/reactions"
      },
      "updated_at" : "2023-01-23T09:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400040869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Wouldn't it make more sense to address that directly, ie by having TrimToSize trim txs whose descendant score is below min relay fee, even if the mempool isn't full? \r\n\r\nThis is insufficient for preventing transactions that will never be mined from staying in the mempool, because `TrimToSize` would leave transactions in the mempool if a parent and multiple children appear to have enough fee for the combined package size, even though no single child has an ancestor fee rate above the min relay fee (eg a \"children-pay-for-parent\" scenario).\r\n\r\nSo I think while having a call to `TrimToSize` shouldn't hurt (and would be needed in the case of v3), we seem to need an approach like this PR to avoid the problem generally.",
      "created_at" : "2023-01-23T10:47:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1400143991",
      "id" : 1400143991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585TdIB3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400143991/reactions"
      },
      "updated_at" : "2023-01-23T21:05:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400143991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2023-01-23T21:06:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1400978614",
      "id" : 1400978614,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585TgTy2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400978614/reactions"
      },
      "updated_at" : "2023-01-23T21:06:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400978614",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@glozow\r\n\r\n> My concern was whether it would be problematic to have many such transactions to trim, hence these changes beforehand. If we instead decide that we're ok with this, I'm happy to drop these.\r\n\r\nI'm not sure that we shouldn't be concerned about using up too much CPU in such cases; just that if we are, there are other analogous cases we should be concerned about too...\r\n\r\n@sdaftuar\r\n\r\n> This is insufficient for preventing transactions that will never be mined from staying in the mempool, because 'TrimToSize' would leave transactions in the mempool if a parent and multiple children appear to have enough fee for the combined package size, even though no single child has an ancestor fee rate above the min relay fee (eg a \"children-pay-for-parents scenario).\r\n\r\nRight, but that's a reflection of us using ancestor score for mining, but descendant score for mempool removal... So presumably we'd get similar behaviour even if min relay fee is 0 -- ie, if we have a parent/children relationship like that where the parent has a high descendant score but the children have low ancestor scores, then they'll remain in the mempool while we evict txs with a fee rate in between those values due to the mempool being full, even if it turns out those txs would be mined while the child txs would not. (Though the key value there is what people are using for `-blockmintxfee` not the min relay fee per se...)\r\n\r\nReplacing descendant score is a big, possibly impossible, project though, so Concept ACK on working around it in this way in the meantime. I think it would be better to be much clearer on exactly what this is achieving though.",
      "created_at" : "2023-01-23T21:09:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1400981797",
      "id" : 1400981797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585TgUkl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400981797/reactions"
      },
      "updated_at" : "2023-01-23T21:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400981797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2023-01-24T13:57:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1401991736",
      "id" : 1401991736,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585TkLI4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1401991736/reactions"
      },
      "updated_at" : "2023-01-24T13:57:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1401991736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Replacing descendant score is a big, possibly impossible, project though, so Concept ACK on working around it in this way in the meantime. I think it would be better to be much clearer on exactly what this is achieving though.\r\n\r\nAgreed. I've rewritten the description to focus on the fact that we can end up with descendant packages of transactions that would never be mined but still get to hang out in the mempool. I've also written a test to demonstrate this [here](https://github.com/glozow/bitcoin/commits/26933-motivation), on top of the \"evict everything below min relay feerate in TrimToSize()\" commit (to show it doesn't fix this issue), and added a description of this test to the OP so it would be in the commit log. I could adapt the test for this PR, but most of it would not be executed when the changes are in place, so I'm not sure how meaningful it would be.",
      "created_at" : "2023-01-30T12:16:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1408516682",
      "id" : 1408516682,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585T9EJK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1408516682/reactions"
      },
      "updated_at" : "2023-01-30T12:16:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1408516682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1092047087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092047087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "micro-nit: I don't think we need this new variable? Could just use `target_feerate.GetFee(...)` in the next line...",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-01-31T14:52:48Z",
      "diff_hunk" : "@@ -426,6 +426,33 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n     return mempool_transactions;\n }\n \n+void TestChain100Setup::MockMempoolMinFee(const CFeeRate& target_feerate)\n+{\n+    LOCK2(cs_main, m_node.mempool->cs);\n+    // Transactions in the mempool will affect the new minimum feerate.\n+    assert(m_node.mempool->size() == 0);\n+    // The target feerate cannot be too low...\n+    // ...otherwise the transaction's feerate will need to be negative.\n+    assert(target_feerate > m_node.mempool->m_incremental_relay_feerate);\n+    // ...otherwise this is not meaningful. The feerate policy uses the maximum of both feerates.\n+    assert(target_feerate > m_node.mempool->m_min_relay_feerate);\n+\n+    // Manually create an invalid transaction. Manually set the fee in the CTxMemPoolEntry to\n+    // achieve the exact target feerate.\n+    CMutableTransaction mtx = CMutableTransaction();\n+    mtx.vin.push_back(CTxIn{COutPoint{InsecureRand256(), 0}});\n+    mtx.vout.push_back(CTxOut(1 * COIN, GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE))));\n+    const auto tx{MakeTransactionRef(mtx)};\n+    LockPoints lp;\n+    CFeeRate tx_feerate(target_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1092047087",
      "id" : 1092047087,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BF1Dv",
      "original_commit_id" : "522cb10f2c250e7acc56e8c02d33fcdb69817c1d",
      "original_line" : 447,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : null,
      "pull_request_review_id" : 1277374478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092047087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-31T20:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092047087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1092136338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092136338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe worth expanding this comment slightly to explain why this check is here (especially since this check is partially duplicated in the check at line 830 below).",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-01-31T15:55:30Z",
      "diff_hunk" : "@@ -819,9 +819,14 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_NOT_STANDARD, \"bad-txns-too-many-sigops\",\n                 strprintf(\"%d\", nSigOpsCost));\n \n-    // No individual transactions are allowed below the min relay feerate and mempool min feerate except from\n-    // disconnected blocks and transactions in a package. Package transactions will be checked using\n-    // package feerate later.\n+    // No individual transactions are allowed below the min relay feerate except from disconnected blocks.\n+    if (!bypass_limits && ws.m_modified_fees < m_pool.m_min_relay_feerate.GetFee(ws.m_vsize)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1092136338",
      "id" : 1092136338,
      "line" : 827,
      "node_id" : "PRRC_kwDOABII585BGK2S",
      "original_commit_id" : "fd2b3c8c9bba2ee7129633b713831b170f18e75d",
      "original_line" : 827,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 12,
      "pull_request_review_id" : 1277374478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092136338/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-31T20:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092136338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1092433429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092433429"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I think this comment needs some correction, doesn't parse for me.",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-01-31T20:17:03Z",
      "diff_hunk" : "@@ -76,6 +83,44 @@ def run_test(self):\n         self.log.info('Create a mempool tx that will not pass mempoolminfee')\n         assert_raises_rpc_error(-26, \"mempool min fee not met\", miniwallet.send_self_transfer, from_node=node, fee_rate=relayfee)\n \n+        self.log.info(\"Check that submitpackage allows cpfp of a parent below mempool min feerate\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PTxInvStore())\n+\n+        # Package with 2 parents and 1 child. One parent pays for itself using modified fees, and\n+        # another has 0 fees but is bumped by child.\n+        tx_poor = miniwallet.create_self_transfer(fee_rate=relayfee)\n+        tx_rich = miniwallet.create_self_transfer(fee=0, fee_rate=0)\n+        node.prioritisetransaction(tx_rich[\"txid\"], 0, int(DEFAULT_FEE * COIN))\n+        package_txns = [tx_rich, tx_poor]\n+        coins = [tx[\"new_utxo\"] for tx in package_txns]\n+        tx_child = miniwallet.create_self_transfer_multi(utxos_to_spend=coins, fee_per_output=10000) #DEFAULT_FEE\n+        package_txns.append(tx_child)\n+\n+        submitpackage_result = node.submitpackage([tx[\"hex\"] for tx in package_txns])\n+\n+        rich_parent_result = submitpackage_result[\"tx-results\"][tx_rich[\"wtxid\"]]\n+        poor_parent_result = submitpackage_result[\"tx-results\"][tx_poor[\"wtxid\"]]\n+        child_result = submitpackage_result[\"tx-results\"][tx_child[\"tx\"].getwtxid()]\n+        assert_fee_amount(poor_parent_result[\"fees\"][\"base\"], tx_poor[\"tx\"].get_vsize(), relayfee)\n+        assert_equal(rich_parent_result[\"fees\"][\"base\"], 0)\n+        assert_equal(child_result[\"fees\"][\"base\"], DEFAULT_FEE)\n+        # The \"rich\" parent does not require CPFP so its effective feerate.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1092433429",
      "id" : 1092433429,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BHTYV",
      "original_commit_id" : "d32f445ab9f9a65d7bd0eec828b8a3de0d07d635",
      "original_line" : 108,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 1277374478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092433429/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-31T20:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092433429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093031279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093031279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d32f445ab9f9a65d7bd0eec828b8a3de0d07d635\r\nthe `-1BTC` comment is irrelevant now?\r\n(i guess it's technically still relevant, but became more confusing)",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T10:25:06Z",
      "diff_hunk" : "@@ -658,7 +662,7 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n     // Package feerate is calculated using modified fees, and prioritisetransaction accepts negative\n     // fee deltas. This should be taken into account. De-prioritise the parent transaction by -1BTC,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093031279",
      "id" : 1093031279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BJlVv",
      "original_commit_id" : "d32f445ab9f9a65d7bd0eec828b8a3de0d07d635",
      "original_line" : 663,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1278835188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093031279/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T10:29:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093031279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093039398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039398"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, fixed",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T10:32:36Z",
      "diff_hunk" : "@@ -426,6 +426,33 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n     return mempool_transactions;\n }\n \n+void TestChain100Setup::MockMempoolMinFee(const CFeeRate& target_feerate)\n+{\n+    LOCK2(cs_main, m_node.mempool->cs);\n+    // Transactions in the mempool will affect the new minimum feerate.\n+    assert(m_node.mempool->size() == 0);\n+    // The target feerate cannot be too low...\n+    // ...otherwise the transaction's feerate will need to be negative.\n+    assert(target_feerate > m_node.mempool->m_incremental_relay_feerate);\n+    // ...otherwise this is not meaningful. The feerate policy uses the maximum of both feerates.\n+    assert(target_feerate > m_node.mempool->m_min_relay_feerate);\n+\n+    // Manually create an invalid transaction. Manually set the fee in the CTxMemPoolEntry to\n+    // achieve the exact target feerate.\n+    CMutableTransaction mtx = CMutableTransaction();\n+    mtx.vin.push_back(CTxIn{COutPoint{InsecureRand256(), 0}});\n+    mtx.vout.push_back(CTxOut(1 * COIN, GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE))));\n+    const auto tx{MakeTransactionRef(mtx)};\n+    LockPoints lp;\n+    CFeeRate tx_feerate(target_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093039398",
      "id" : 1093039398,
      "in_reply_to_id" : 1092047087,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BJnUm",
      "original_commit_id" : "522cb10f2c250e7acc56e8c02d33fcdb69817c1d",
      "original_line" : 447,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : null,
      "pull_request_review_id" : 1278847653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039398/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T10:37:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093039702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039702"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a bit about how this check is different from `CheckFeeRate`",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T10:32:56Z",
      "diff_hunk" : "@@ -819,9 +819,14 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_NOT_STANDARD, \"bad-txns-too-many-sigops\",\n                 strprintf(\"%d\", nSigOpsCost));\n \n-    // No individual transactions are allowed below the min relay feerate and mempool min feerate except from\n-    // disconnected blocks and transactions in a package. Package transactions will be checked using\n-    // package feerate later.\n+    // No individual transactions are allowed below the min relay feerate except from disconnected blocks.\n+    if (!bypass_limits && ws.m_modified_fees < m_pool.m_min_relay_feerate.GetFee(ws.m_vsize)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093039702",
      "id" : 1093039702,
      "in_reply_to_id" : 1092136338,
      "line" : 827,
      "node_id" : "PRRC_kwDOABII585BJnZW",
      "original_commit_id" : "fd2b3c8c9bba2ee7129633b713831b170f18e75d",
      "original_line" : 827,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 12,
      "pull_request_review_id" : 1278847653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039702/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T10:37:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093039792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, fixed",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T10:33:01Z",
      "diff_hunk" : "@@ -76,6 +83,44 @@ def run_test(self):\n         self.log.info('Create a mempool tx that will not pass mempoolminfee')\n         assert_raises_rpc_error(-26, \"mempool min fee not met\", miniwallet.send_self_transfer, from_node=node, fee_rate=relayfee)\n \n+        self.log.info(\"Check that submitpackage allows cpfp of a parent below mempool min feerate\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PTxInvStore())\n+\n+        # Package with 2 parents and 1 child. One parent pays for itself using modified fees, and\n+        # another has 0 fees but is bumped by child.\n+        tx_poor = miniwallet.create_self_transfer(fee_rate=relayfee)\n+        tx_rich = miniwallet.create_self_transfer(fee=0, fee_rate=0)\n+        node.prioritisetransaction(tx_rich[\"txid\"], 0, int(DEFAULT_FEE * COIN))\n+        package_txns = [tx_rich, tx_poor]\n+        coins = [tx[\"new_utxo\"] for tx in package_txns]\n+        tx_child = miniwallet.create_self_transfer_multi(utxos_to_spend=coins, fee_per_output=10000) #DEFAULT_FEE\n+        package_txns.append(tx_child)\n+\n+        submitpackage_result = node.submitpackage([tx[\"hex\"] for tx in package_txns])\n+\n+        rich_parent_result = submitpackage_result[\"tx-results\"][tx_rich[\"wtxid\"]]\n+        poor_parent_result = submitpackage_result[\"tx-results\"][tx_poor[\"wtxid\"]]\n+        child_result = submitpackage_result[\"tx-results\"][tx_child[\"tx\"].getwtxid()]\n+        assert_fee_amount(poor_parent_result[\"fees\"][\"base\"], tx_poor[\"tx\"].get_vsize(), relayfee)\n+        assert_equal(rich_parent_result[\"fees\"][\"base\"], 0)\n+        assert_equal(child_result[\"fees\"][\"base\"], DEFAULT_FEE)\n+        # The \"rich\" parent does not require CPFP so its effective feerate.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093039792",
      "id" : 1093039792,
      "in_reply_to_id" : 1092433429,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BJnaw",
      "original_commit_id" : "d32f445ab9f9a65d7bd0eec828b8a3de0d07d635",
      "original_line" : 108,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 1278847653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039792/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T10:37:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093039792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093044513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093044513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Amended to remove the `-1BTC`",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T10:37:12Z",
      "diff_hunk" : "@@ -658,7 +662,7 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n     // Package feerate is calculated using modified fees, and prioritisetransaction accepts negative\n     // fee deltas. This should be taken into account. De-prioritise the parent transaction by -1BTC,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093044513",
      "id" : 1093044513,
      "in_reply_to_id" : 1093031279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BJokh",
      "original_commit_id" : "d32f445ab9f9a65d7bd0eec828b8a3de0d07d635",
      "original_line" : 663,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1278847653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093044513/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T10:37:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093044513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093079863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093079863"
         }
      },
      "author_association" : "MEMBER",
      "body" : "490f3c1a8eabac737e196e7fffd7765aa941f65a\r\nI assume another parent is `tx_poor`, meaning it pays `relayfee` rather than 0?",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T11:11:08Z",
      "diff_hunk" : "@@ -76,6 +83,44 @@ def run_test(self):\n         self.log.info('Create a mempool tx that will not pass mempoolminfee')\n         assert_raises_rpc_error(-26, \"mempool min fee not met\", miniwallet.send_self_transfer, from_node=node, fee_rate=relayfee)\n \n+        self.log.info(\"Check that submitpackage allows cpfp of a parent below mempool min feerate\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PTxInvStore())\n+\n+        # Package with 2 parents and 1 child. One parent pays for itself using modified fees, and\n+        # another has 0 fees but is bumped by child.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093079863",
      "id" : 1093079863,
      "line" : 91,
      "node_id" : "PRRC_kwDOABII585BJxM3",
      "original_commit_id" : "490f3c1a8eabac737e196e7fffd7765aa941f65a",
      "original_line" : 91,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 42,
      "pull_request_review_id" : 1278905383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093079863/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T11:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093079863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093086983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093086983"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fce52c8004744b8af96ff07b419db21979348330\r\nWhy using modifiedFees in this check instead of regular fees?",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T11:18:13Z",
      "diff_hunk" : "@@ -819,9 +819,18 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_NOT_STANDARD, \"bad-txns-too-many-sigops\",\n                 strprintf(\"%d\", nSigOpsCost));\n \n-    // No individual transactions are allowed below the min relay feerate and mempool min feerate except from\n-    // disconnected blocks and transactions in a package. Package transactions will be checked using\n-    // package feerate later.\n+    // No individual transactions are allowed below the min relay feerate except from disconnected blocks.\n+    // This requirement, unlike CheckFeeRate, cannot be bypassed using m_package_feerates because,\n+    // while a tx could be package CPFP'd when entering the mempool, we do not have a DoS-resistant\n+    // method of ensuring the tx remains bumped. For example, the fee-bumping child could disappear\n+    // due to a replacement.\n+    if (!bypass_limits && ws.m_modified_fees < m_pool.m_min_relay_feerate.GetFee(ws.m_vsize)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093086983",
      "id" : 1093086983,
      "line" : 827,
      "node_id" : "PRRC_kwDOABII585BJy8H",
      "original_commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "original_line" : 827,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 12,
      "pull_request_review_id" : 1278905383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093086983/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T11:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093086983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093090124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093090124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We always use modified fees for these checks, otherwise we're breaking the `prioritisetransaction` RPC's expected behavior",
      "commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "created_at" : "2023-02-01T11:21:25Z",
      "diff_hunk" : "@@ -819,9 +819,18 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_NOT_STANDARD, \"bad-txns-too-many-sigops\",\n                 strprintf(\"%d\", nSigOpsCost));\n \n-    // No individual transactions are allowed below the min relay feerate and mempool min feerate except from\n-    // disconnected blocks and transactions in a package. Package transactions will be checked using\n-    // package feerate later.\n+    // No individual transactions are allowed below the min relay feerate except from disconnected blocks.\n+    // This requirement, unlike CheckFeeRate, cannot be bypassed using m_package_feerates because,\n+    // while a tx could be package CPFP'd when entering the mempool, we do not have a DoS-resistant\n+    // method of ensuring the tx remains bumped. For example, the fee-bumping child could disappear\n+    // due to a replacement.\n+    if (!bypass_limits && ws.m_modified_fees < m_pool.m_min_relay_feerate.GetFee(ws.m_vsize)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093090124",
      "id" : 1093090124,
      "in_reply_to_id" : 1093086983,
      "line" : 827,
      "node_id" : "PRRC_kwDOABII585BJztM",
      "original_commit_id" : "fce52c8004744b8af96ff07b419db21979348330",
      "original_line" : 827,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 12,
      "pull_request_review_id" : 1278920859,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093090124/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T11:21:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093090124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093218247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093218247"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, I've updated this comment along with a few others.",
      "commit_id" : "f636daf4c89da7b2b72d05e73de1ca86449a36a6",
      "created_at" : "2023-02-01T13:25:16Z",
      "diff_hunk" : "@@ -76,6 +83,44 @@ def run_test(self):\n         self.log.info('Create a mempool tx that will not pass mempoolminfee')\n         assert_raises_rpc_error(-26, \"mempool min fee not met\", miniwallet.send_self_transfer, from_node=node, fee_rate=relayfee)\n \n+        self.log.info(\"Check that submitpackage allows cpfp of a parent below mempool min feerate\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PTxInvStore())\n+\n+        # Package with 2 parents and 1 child. One parent pays for itself using modified fees, and\n+        # another has 0 fees but is bumped by child.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1093218247",
      "id" : 1093218247,
      "in_reply_to_id" : 1093079863,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BKS_H",
      "original_commit_id" : "490f3c1a8eabac737e196e7fffd7765aa941f65a",
      "original_line" : 91,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 1279110150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093218247/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T13:25:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1093218247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Gave this more thought... I think I have a better solution to this problem:\r\n\r\nFundamentally the issue with txs below the minrelayfee in the mempool is a problem because (a) the mining code refuses to select ancestor packages below the blockmintxfee, and (b) TrimToSize() necessarily operates on descendant packages and cannot detect when this is the case.\r\n\r\nThere seems to be basically no good reason anymore for the mining code to not mine whatever makes it in to the mempool.  Philosophically, we ought to ensure that whatever gets into the mempool meets the miner's feerate criteria, and then just mine whatever is there.  Doing otherwise opens up possibilities for DoS, if it's possible to fill the mempool with transactions that would never be selected.\r\n\r\nSo instead I think an easier solution to this problem is to (a) drop the blockmintxfee feerate check in the mining code, and (b) modify `TrimToSize()` to evict descendant packages below the minrelayfee, which should be called whenever there is a reorg or whenever a transaction is added to the mempool (which could be an RBF that leaves a dangling 0-fee transaction lying around).  The result of these two changes is that we might pick up a transaction or package in block creation that appears to be below the minrelayfee, but whenever we do so it should open up the door to being able to include transactions that bring the cumulative feerate up to above the minrelayfee, because we're ensuring that every transaction has a total descendant package that is sufficiently high feerate to be mined.  I think this should be ok?\r\n\r\nAnyway, one reason I like this alternate approach better is that this PR leaves open a possibility of 0-fee transactions being added to the mempool as a result of a reorg, and I was able to sketch out a possible DoS that takes advantage of seeding the mempool with 0-fee transactions and then using those to fill the mempool up with transactions that would both never be mined and be expensive to evict (via TrimToSize()), which basically would cause the relay fees for everyone on the network to be much higher than they should be.  I'm not sure this is a very practical attack, but given that it would still exist I think an alternate approach that covers this case (with no downsides I can see) seems better...",
      "created_at" : "2023-02-01T16:10:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1412320818",
      "id" : 1412320818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585ULk4y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412320818/reactions"
      },
      "updated_at" : "2023-02-01T16:10:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412320818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also, I think it would make sense to drop the `blockmintxfee` parameter altogether.  I think that variable is a holdover from the days when we supported priority transactions, but today it makes no sense to have transactions in your mempool you would never mine (eg if blockmintxfee > minrelayfee), and if you set blockmintxfee to be below minrelayfee, then it mostly has no effect, because how would such low fee transactions make it into your mempool in the first place?  ",
      "created_at" : "2023-02-01T16:12:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1412324432",
      "id" : 1412324432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585ULlxQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412324432/reactions"
      },
      "updated_at" : "2023-02-01T16:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412324432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar sorry can you spell out what exactly the proposal is by walking through the \"24 below-minrelayfeerate transactions\" case, and why that's not a problem? ",
      "created_at" : "2023-02-01T16:54:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1412388326",
      "id" : 1412388326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585UL1Xm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412388326/reactions"
      },
      "updated_at" : "2023-02-01T16:54:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412388326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @sdaftuar sorry can you spell out what exactly the proposal is by walking through the \"24 below-minrelayfeerate transactions\" case, and why that's not a problem?\r\n\r\nSure, the proposal is twofold: (1) get rid of any feerate checks in the mining code (ie remove the comparison to `blockmintxfee` in addPackageTransactions), and (2) modify TrimToSize() so that we evict any descendant package from the mempool if the package is below the minrelayfee.  (Technically we need to also invoke this function on the mempool after a reorg, so maybe that's 3 things, but conceptually it's the same idea -- whenever we might have changed the mempool in a way that could have added a 0-fee transaction, run TrimToSize() to evict it so that we limit junk from being relayed on the network.)\r\n\r\nI believe the scenario you're asking about is one where we have a zero-fee parent in the mempool, with a bunch of children that are all above the minrelayfee themselves, but each one, when taken with the parent will have an ancestor feerate below the minrelayfee.  Originally I put this scenario out there as a DoS vector, because the mining code currently will not select any such transactions.  However if we change the mining code to skip the relay fee check, then this whole package will eventually get included in a block instead, which means that there is no free relay (because all those fee-paying transactions will be mined).  Moreover, if the descendant package in total has a feerate greater than the minrelayfee, then I think apart from edge cases around which transactions make it in at the end of a block, this is basically achieving the miner's goals anyway of including transactions that in total have a high enough feerate.\r\n\r\nIf we didn't include the `TrimToSize()` modification to evict descendant packages below the minrelayfee, then there could be an issue where 0-fee transactions might get included in a block, which ought to be strictly worse for a miner than omitting such transactions (because they take longer to validate than a block without the transaction, and there's no additional benefit to the miner for including them) -- hence that is an important part of the change as well.\r\n\r\n",
      "created_at" : "2023-02-01T17:13:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1412419283",
      "id" : 1412419283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585UL87T",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412419283/reactions"
      },
      "updated_at" : "2023-02-01T17:13:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412419283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I reviewed the code f636daf4c89da7b2b72d05e73de1ca86449a36a6 and it seems correct.\r\nHowever, I think the other approach #27018 makes more sense. Not just because of the particular reorg issue, but in general it seems to cover more mempool garbage situations.\r\n\r\n@glozow I have two questions though.\r\n1. In #27018 you say\r\n>Though they don't need to be mutually exclusive, e.g. we could both require individual transactions to meet minrelayfeerate and also evict below-minrelayfeerate entries in TrimToSize().\r\n\r\nWhat would be a practical benefit of this PR (#26933) if #27018 is already merged? (e.g., better UX, attack mitigated, cleaner code, etc.).\r\n\r\n2. If only #27018 is merged and this one is not, what would change to v3 and ephemeral anchors?",
      "created_at" : "2023-02-02T07:04:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1413246009",
      "id" : 1413246009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585UPGw5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1413246009/reactions"
      },
      "updated_at" : "2023-02-02T07:04:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1413246009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What would be a practical benefit of this PR (https://github.com/bitcoin/bitcoin/pull/26933) if https://github.com/bitcoin/bitcoin/pull/27018 is already merged? (e.g., better UX, attack mitigated, cleaner code, etc.).\r\n\r\nMy reservation with a #27018-only approach is we haven't answered whether we're ok with `TrimToSize()` (and thus reorgs and RBFs) potentially evicting many entries (I'lll re-post the 2500-tx scenario on that PR).\r\n\r\nMy original intent was to do this PR + evict everything below minrelayfeerate in `TrimToSize()`, which I think partially (?) addresses the problem with seeding mempool in a reorg (you can't bump both the reorged tx + a large 0-fee tx with 1-parent-1-child v3, and you can't attach multiple descendants to anything v3).\r\n\r\n> If only https://github.com/bitcoin/bitcoin/pull/27018 is merged and this one is not, what would change to v3 and ephemeral anchors?\r\n\r\nNothing is really changing with v3 regardless. If we do this PR, *only* v3 transactions can be below minrelayfeerate and bumped through package CPFP. If we don't do this PR, v3 still has the same rules, it's just that below-minrelayfeerate is no longer exclusive to v3.",
      "created_at" : "2023-02-02T09:45:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1413433757",
      "id" : 1413433757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585UP0md",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1413433757/reactions"
      },
      "updated_at" : "2023-02-02T09:45:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1413433757",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Did some naive benchmarking with https://github.com/bitcoin/bitcoin/pull/27019 and on my basic laptop got 0.72 seconds for evicting 100 packages of size 25 each (2500 txns total). \r\n\r\nedit: Using not very scientific methods of repeating the bench with and without eviction steps, it appears to roughly take half that amount of time for the evictions themselves, regardless of topology. ~0.33s",
      "created_at" : "2023-02-02T14:35:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1413841878",
      "id" : 1413841878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585URYPW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1413841878/reactions"
      },
      "updated_at" : "2023-02-02T16:32:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1413841878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is insufficient for preventing transactions that will never be mined from staying in the mempool, because `TrimToSize` would leave transactions in the mempool if a parent and multiple children appear to have enough fee for the combined package size, even though no single child has an ancestor fee rate above the min relay fee (eg a \"children-pay-for-parent\" scenario).\r\n\r\nWould this be fixable by having `TrimToSize` remove any tx whose ancestor fee rate is below the minrelay fee if it also has no descendants (`m_children.empty()`) ? You could probably merge that into the descendant feerate index, just by pretending the descendant fee rate is zero if both those conditions are true.",
      "created_at" : "2023-02-04T09:05:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1416703484",
      "id" : 1416703484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585UcS38",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1416703484/reactions"
      },
      "updated_at" : "2023-02-04T09:05:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1416703484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns I think that gets tricky due to sibling pays for parent situations; in fact I think you could evict something under that criteria in situations where no RBF or anything strange was involved at all:\n\nPackage (A, B) accepted to mempool, A is 0 fee and B pays for A.\n\nPackage (C, D) is accepted to mempool, C is 0 fee, and D pays for C AND D is a child of A.\n\nD could have an ancestor feerate less than the minrelayfee (if it doesn't pay for A and C), but nothing wrong with it being in the mempool.",
      "created_at" : "2023-02-04T10:07:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1416713975",
      "id" : 1416713975,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585UcVb3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1416713975/reactions"
      },
      "updated_at" : "2023-02-04T10:07:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1416713975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ajtowns I think that gets tricky due to sibling pays for parent situations; in fact I think you could evict something under that criteria in situations where no RBF or anything strange was involved at all:\r\n\r\nMaybe simplifying it, and just have `TrimToSize` remove any tx with no descendants whose modified fee is below minrelay?   (Again, by setting the artificially treating descendantscore as -infinity in that case) Certainly doesn't cover every case, but would remove anything below minfee that only made it into the mempool via a CPFP that later got evicted?\r\n\r\n(The point being to avoid that being a way of getting free-relay while mempools are mostly empty)",
      "created_at" : "2023-02-10T01:15:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1425044454",
      "id" : 1425044454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585U8HPm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1425044454/reactions"
      },
      "updated_at" : "2023-02-10T01:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1425044454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns Trimming *anything* having a desc feerate of 0 should also be ok along those same lines?",
      "created_at" : "2023-02-10T16:03:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1426019716",
      "id" : 1426019716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585U_1WE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1426019716/reactions"
      },
      "updated_at" : "2023-02-10T16:03:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1426019716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think in the interests of moving the package relay and v3 project forward, it makes sense to adopt this approach and defer potential improvements like #27018 to the future. My thinking is that this PR is a conservative way forward that seems obviously safe; our eviction logic on the other hand has a number of shortcomings, which I think will be best to fix up first before making more changes to use the eviction logic in new scenarios. We can work on the mempool and eviction in parallel and (hopefully) once we have something that works better, we can revisit this limitation and see if we can lift it in the future.\r\n\r\nSo (re-?) concept ACK... Will try to give this a review again soon.",
      "created_at" : "2023-04-04T16:42:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1496286578",
      "id" : 1496286578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585ZL4Vy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1496286578/reactions"
      },
      "updated_at" : "2023-04-04T16:42:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1496286578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased, there was a silent merge conflict",
      "created_at" : "2023-04-05T10:37:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1497274400",
      "id" : 1497274400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585ZPpgg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1497274400/reactions"
      },
      "updated_at" : "2023-04-05T10:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1497274400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1162786364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162786364"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure if I'm just reading too fast, but was the intent here to check that the mempool minfee for the *child* is <= 800?  Seems like we did the parent checks up above, but maybe I'm missing something...?",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-11T13:03:04Z",
      "diff_hunk" : "@@ -709,22 +713,26 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n     }\n \n     // Just because we allow low-fee parents doesn't mean we allow low-feerate packages.\n-    // This package just pays 200 satoshis total. This would be enough to pay for the child alone,\n-    // but isn't enough for the entire package to meet the 1sat/vbyte minimum.\n+    // The mempool minimum feerate is 5sat/vB, but this package just pays 800 satoshis total.\n+    // This would be enough to pay for the child alone, but isn't enough for the entire package.\n     Package package_still_too_low;\n     auto mtx_parent_cheap = CreateValidMempoolTransaction(/*input_transaction=*/m_coinbase_txns[1], /*input_vout=*/0,\n                                                           /*input_height=*/0, /*input_signing_key=*/coinbaseKey,\n                                                           /*output_destination=*/parent_spk,\n-                                                          /*output_amount=*/coinbase_value, /*submit=*/false);\n+                                                          /*output_amount=*/coinbase_value - 200, /*submit=*/false);\n     CTransactionRef tx_parent_cheap = MakeTransactionRef(mtx_parent_cheap);\n     package_still_too_low.push_back(tx_parent_cheap);\n+    BOOST_CHECK(m_node.mempool->GetMinFee().GetFee(GetVirtualTransactionSize(*tx_parent_cheap)) > 200);\n+    BOOST_CHECK(m_node.mempool->m_min_relay_feerate.GetFee(GetVirtualTransactionSize(*tx_parent_cheap)) <= 200);\n \n     auto mtx_child_cheap = CreateValidMempoolTransaction(/*input_transaction=*/tx_parent_cheap, /*input_vout=*/0,\n                                                          /*input_height=*/101, /*input_signing_key=*/child_key,\n                                                          /*output_destination=*/child_spk,\n-                                                         /*output_amount=*/coinbase_value - 200, /*submit=*/false);\n+                                                         /*output_amount=*/coinbase_value - 800, /*submit=*/false);\n     CTransactionRef tx_child_cheap = MakeTransactionRef(mtx_child_cheap);\n     package_still_too_low.push_back(tx_child_cheap);\n+    BOOST_CHECK(m_node.mempool->GetMinFee().GetFee(GetVirtualTransactionSize(*tx_parent_cheap)) <= 800);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1162786364",
      "id" : 1162786364,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FTrY8",
      "original_commit_id" : "85c1cd0673a1b5929723969a3f0e63fa699389b9",
      "original_line" : 734,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1379203883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162786364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-11T18:31:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162786364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1163980505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163980505"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes you're right, this should be checking the child. Edited this to be checking that \"This would be enough to pay for the child alone.\"",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T11:10:20Z",
      "diff_hunk" : "@@ -709,22 +713,26 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n     }\n \n     // Just because we allow low-fee parents doesn't mean we allow low-feerate packages.\n-    // This package just pays 200 satoshis total. This would be enough to pay for the child alone,\n-    // but isn't enough for the entire package to meet the 1sat/vbyte minimum.\n+    // The mempool minimum feerate is 5sat/vB, but this package just pays 800 satoshis total.\n+    // This would be enough to pay for the child alone, but isn't enough for the entire package.\n     Package package_still_too_low;\n     auto mtx_parent_cheap = CreateValidMempoolTransaction(/*input_transaction=*/m_coinbase_txns[1], /*input_vout=*/0,\n                                                           /*input_height=*/0, /*input_signing_key=*/coinbaseKey,\n                                                           /*output_destination=*/parent_spk,\n-                                                          /*output_amount=*/coinbase_value, /*submit=*/false);\n+                                                          /*output_amount=*/coinbase_value - 200, /*submit=*/false);\n     CTransactionRef tx_parent_cheap = MakeTransactionRef(mtx_parent_cheap);\n     package_still_too_low.push_back(tx_parent_cheap);\n+    BOOST_CHECK(m_node.mempool->GetMinFee().GetFee(GetVirtualTransactionSize(*tx_parent_cheap)) > 200);\n+    BOOST_CHECK(m_node.mempool->m_min_relay_feerate.GetFee(GetVirtualTransactionSize(*tx_parent_cheap)) <= 200);\n \n     auto mtx_child_cheap = CreateValidMempoolTransaction(/*input_transaction=*/tx_parent_cheap, /*input_vout=*/0,\n                                                          /*input_height=*/101, /*input_signing_key=*/child_key,\n                                                          /*output_destination=*/child_spk,\n-                                                         /*output_amount=*/coinbase_value - 200, /*submit=*/false);\n+                                                         /*output_amount=*/coinbase_value - 800, /*submit=*/false);\n     CTransactionRef tx_child_cheap = MakeTransactionRef(mtx_child_cheap);\n     package_still_too_low.push_back(tx_child_cheap);\n+    BOOST_CHECK(m_node.mempool->GetMinFee().GetFee(GetVirtualTransactionSize(*tx_parent_cheap)) <= 800);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1163980505",
      "id" : 1163980505,
      "in_reply_to_id" : 1162786364,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FYO7Z",
      "original_commit_id" : "85c1cd0673a1b5929723969a3f0e63fa699389b9",
      "original_line" : 734,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1381075459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163980505/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T11:13:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163980505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK\r\n\r\nI find both variants unsatisfactory for different reasons, but while we're working on something potentially better, I think this small change is the most reasonable, as it can be removed simply if improved upon. Meanwhile, we can continue moving forward with package relay/RBF/et al.",
      "created_at" : "2023-04-12T14:24:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1505372661",
      "id" : 1505372661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585Zuin1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505372661/reactions"
      },
      "updated_at" : "2023-04-12T14:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505372661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess I don't really understand how this PR on its own helps anything -- we don't do package relay yet, so except for a regtest only rpc, these changes should be unobservable?\r\n\r\nWould it make sense to replace this with a PR that enabled package relay without v3 or package RBF, and included this policy? I think that would be the first ~10 commits from #25038? That seems like it would be more meaningful progress...",
      "created_at" : "2023-04-12T15:32:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1505483056",
      "id" : 1505483056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585Zu9kw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505483056/reactions"
      },
      "updated_at" : "2023-04-12T15:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505483056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think either way is \"meaningful progress\", but I'm not averse to coupling the commits if we're in agreement on this PR's commits.\r\n\r\nHaving this in would also allow https://github.com/bitcoin/bitcoin/pull/26711 to move forward",
      "created_at" : "2023-04-12T16:01:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1505540220",
      "id" : 1505540220,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585ZvLh8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505540220/reactions"
      },
      "updated_at" : "2023-04-12T16:02:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505540220",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164413849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164413849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm confused, why is the subtraction of incremental relay total fee necessary?",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T17:06:20Z",
      "diff_hunk" : "@@ -432,6 +432,32 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n     return mempool_transactions;\n }\n \n+void TestChain100Setup::MockMempoolMinFee(const CFeeRate& target_feerate)\n+{\n+    LOCK2(cs_main, m_node.mempool->cs);\n+    // Transactions in the mempool will affect the new minimum feerate.\n+    assert(m_node.mempool->size() == 0);\n+    // The target feerate cannot be too low...\n+    // ...otherwise the transaction's feerate will need to be negative.\n+    assert(target_feerate > m_node.mempool->m_incremental_relay_feerate);\n+    // ...otherwise this is not meaningful. The feerate policy uses the maximum of both feerates.\n+    assert(target_feerate > m_node.mempool->m_min_relay_feerate);\n+\n+    // Manually create an invalid transaction. Manually set the fee in the CTxMemPoolEntry to\n+    // achieve the exact target feerate.\n+    CMutableTransaction mtx = CMutableTransaction();\n+    mtx.vin.push_back(CTxIn{COutPoint{g_insecure_rand_ctx.rand256(), 0}});\n+    mtx.vout.push_back(CTxOut(1 * COIN, GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE))));\n+    const auto tx{MakeTransactionRef(mtx)};\n+    LockPoints lp;\n+    const auto tx_fee = target_feerate.GetFee(GetVirtualTransactionSize(*tx)) -",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164413849",
      "id" : 1164413849,
      "line" : 453,
      "node_id" : "PRRC_kwDOABII585FZ4uZ",
      "original_commit_id" : "359b1ff9bb9e0e6cd08ecfc94694e50391d5cc04",
      "original_line" : 453,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 22,
      "pull_request_review_id" : 1381747251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164413849/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T17:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164413849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164415485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164415485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "New mempool min feerate is the feerate of removed + incremental:\r\nhttps://github.com/bitcoin/bitcoin/blob/7f4ab67e7be615b2425a85fb65872fc2327f58c3/src/txmempool.cpp#L1063-L1068",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T17:08:05Z",
      "diff_hunk" : "@@ -432,6 +432,32 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n     return mempool_transactions;\n }\n \n+void TestChain100Setup::MockMempoolMinFee(const CFeeRate& target_feerate)\n+{\n+    LOCK2(cs_main, m_node.mempool->cs);\n+    // Transactions in the mempool will affect the new minimum feerate.\n+    assert(m_node.mempool->size() == 0);\n+    // The target feerate cannot be too low...\n+    // ...otherwise the transaction's feerate will need to be negative.\n+    assert(target_feerate > m_node.mempool->m_incremental_relay_feerate);\n+    // ...otherwise this is not meaningful. The feerate policy uses the maximum of both feerates.\n+    assert(target_feerate > m_node.mempool->m_min_relay_feerate);\n+\n+    // Manually create an invalid transaction. Manually set the fee in the CTxMemPoolEntry to\n+    // achieve the exact target feerate.\n+    CMutableTransaction mtx = CMutableTransaction();\n+    mtx.vin.push_back(CTxIn{COutPoint{g_insecure_rand_ctx.rand256(), 0}});\n+    mtx.vout.push_back(CTxOut(1 * COIN, GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE))));\n+    const auto tx{MakeTransactionRef(mtx)};\n+    LockPoints lp;\n+    const auto tx_fee = target_feerate.GetFee(GetVirtualTransactionSize(*tx)) -",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164415485",
      "id" : 1164415485,
      "in_reply_to_id" : 1164413849,
      "line" : 453,
      "node_id" : "PRRC_kwDOABII585FZ5H9",
      "original_commit_id" : "359b1ff9bb9e0e6cd08ecfc94694e50391d5cc04",
      "original_line" : 453,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 22,
      "pull_request_review_id" : 1381749740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164415485/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T17:08:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164415485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164418072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164418072"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, adding a comment to this effect helps. Seems really out of place otherwise.",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T17:10:38Z",
      "diff_hunk" : "@@ -432,6 +432,32 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n     return mempool_transactions;\n }\n \n+void TestChain100Setup::MockMempoolMinFee(const CFeeRate& target_feerate)\n+{\n+    LOCK2(cs_main, m_node.mempool->cs);\n+    // Transactions in the mempool will affect the new minimum feerate.\n+    assert(m_node.mempool->size() == 0);\n+    // The target feerate cannot be too low...\n+    // ...otherwise the transaction's feerate will need to be negative.\n+    assert(target_feerate > m_node.mempool->m_incremental_relay_feerate);\n+    // ...otherwise this is not meaningful. The feerate policy uses the maximum of both feerates.\n+    assert(target_feerate > m_node.mempool->m_min_relay_feerate);\n+\n+    // Manually create an invalid transaction. Manually set the fee in the CTxMemPoolEntry to\n+    // achieve the exact target feerate.\n+    CMutableTransaction mtx = CMutableTransaction();\n+    mtx.vin.push_back(CTxIn{COutPoint{g_insecure_rand_ctx.rand256(), 0}});\n+    mtx.vout.push_back(CTxOut(1 * COIN, GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE))));\n+    const auto tx{MakeTransactionRef(mtx)};\n+    LockPoints lp;\n+    const auto tx_fee = target_feerate.GetFee(GetVirtualTransactionSize(*tx)) -",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164418072",
      "id" : 1164418072,
      "in_reply_to_id" : 1164413849,
      "line" : 453,
      "node_id" : "PRRC_kwDOABII585FZ5wY",
      "original_commit_id" : "359b1ff9bb9e0e6cd08ecfc94694e50391d5cc04",
      "original_line" : 453,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 22,
      "pull_request_review_id" : 1381753592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164418072/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T17:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164418072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164429604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164429604"
         }
      },
      "author_association" : "MEMBER",
      "body" : "name the 200 `low_fee_amt` and reuse everywhere?",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T17:22:30Z",
      "diff_hunk" : "@@ -560,13 +561,15 @@ BOOST_FIXTURE_TEST_CASE(package_witness_swap_tests, TestChain100Setup)\n     BOOST_CHECK(parent2_v2_result.m_result_type == MempoolAcceptResult::ResultType::VALID);\n     package_mixed.push_back(ptx_parent2_v1);\n \n-    // parent3 will be a new transaction. Put 0 fees on it to make it invalid on its own.\n+    // parent3 will be a new transaction. Put a low feerate to make it invalid on its own.\n     auto mtx_parent3 = CreateValidMempoolTransaction(/*input_transaction=*/m_coinbase_txns[3], /*input_vout=*/0,\n                                                      /*input_height=*/0, /*input_signing_key=*/coinbaseKey,\n                                                      /*output_destination=*/acs_spk,\n-                                                     /*output_amount=*/CAmount(50 * COIN), /*submit=*/false);\n+                                                     /*output_amount=*/CAmount(50 * COIN - 200), /*submit=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164429604",
      "id" : 1164429604,
      "line" : 568,
      "node_id" : "PRRC_kwDOABII585FZ8kk",
      "original_commit_id" : "8d2c5b6e5bd928485e9e97c03987f4b1cfc75f0c",
      "original_line" : 568,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 18,
      "pull_request_review_id" : 1381762702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164429604/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T18:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164429604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164440396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164440396"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could we use `CTxMemPool::info` on parent and child to assert that the (fee + nFeeDelta) summed == 0 for the test so I don't have to think so hard to know this is right",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T17:29:31Z",
      "diff_hunk" : "@@ -657,9 +661,9 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n     package_cpfp.push_back(tx_child);\n \n     // Package feerate is calculated using modified fees, and prioritisetransaction accepts negative\n-    // fee deltas. This should be taken into account. De-prioritise the parent transaction by -1BTC,\n-    // bringing the package feerate to 0.\n-    m_node.mempool->PrioritiseTransaction(tx_parent->GetHash(), -1 * COIN);\n+    // fee deltas. This should be taken into account. De-prioritise the parent transaction\n+    // to bring the package feerate to 0.\n+    m_node.mempool->PrioritiseTransaction(tx_parent->GetHash(), child_value - coinbase_value);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164440396",
      "id" : 1164440396,
      "line" : 666,
      "node_id" : "PRRC_kwDOABII585FZ_NM",
      "original_commit_id" : "8d2c5b6e5bd928485e9e97c03987f4b1cfc75f0c",
      "original_line" : 666,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 55,
      "pull_request_review_id" : 1381762702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164440396/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T18:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164440396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164445008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164445008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use `parent_fee`",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T17:33:01Z",
      "diff_hunk" : "@@ -752,18 +757,18 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n         expected_pool_size += 2;\n         BOOST_CHECK_MESSAGE(submit_prioritised_package.m_state.IsValid(),\n                 \"Package validation unexpectedly failed\" << submit_prioritised_package.m_state.GetRejectReason());\n-        const CFeeRate expected_feerate(1 * COIN + 200,\n+        const CFeeRate expected_feerate(1 * COIN + 800,\n             GetVirtualTransactionSize(*tx_parent_cheap) + GetVirtualTransactionSize(*tx_child_cheap));\n         BOOST_CHECK_EQUAL(submit_prioritised_package.m_tx_results.size(), package_still_too_low.size());\n         auto it_parent = submit_prioritised_package.m_tx_results.find(tx_parent_cheap->GetWitnessHash());\n         auto it_child = submit_prioritised_package.m_tx_results.find(tx_child_cheap->GetWitnessHash());\n         BOOST_CHECK(it_parent != submit_prioritised_package.m_tx_results.end());\n         BOOST_CHECK(it_parent->second.m_result_type == MempoolAcceptResult::ResultType::VALID);\n-        BOOST_CHECK(it_parent->second.m_base_fees.value() == 0);\n+        BOOST_CHECK(it_parent->second.m_base_fees.value() == 200);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164445008",
      "id" : 1164445008,
      "line" : 770,
      "node_id" : "PRRC_kwDOABII585FaAVQ",
      "original_commit_id" : "8d2c5b6e5bd928485e9e97c03987f4b1cfc75f0c",
      "original_line" : 767,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 152,
      "pull_request_review_id" : 1381762702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164445008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T18:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164445008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164445361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164445361"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use `child_fee`",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-12T17:33:21Z",
      "diff_hunk" : "@@ -752,18 +757,18 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n         expected_pool_size += 2;\n         BOOST_CHECK_MESSAGE(submit_prioritised_package.m_state.IsValid(),\n                 \"Package validation unexpectedly failed\" << submit_prioritised_package.m_state.GetRejectReason());\n-        const CFeeRate expected_feerate(1 * COIN + 200,\n+        const CFeeRate expected_feerate(1 * COIN + 800,\n             GetVirtualTransactionSize(*tx_parent_cheap) + GetVirtualTransactionSize(*tx_child_cheap));\n         BOOST_CHECK_EQUAL(submit_prioritised_package.m_tx_results.size(), package_still_too_low.size());\n         auto it_parent = submit_prioritised_package.m_tx_results.find(tx_parent_cheap->GetWitnessHash());\n         auto it_child = submit_prioritised_package.m_tx_results.find(tx_child_cheap->GetWitnessHash());\n         BOOST_CHECK(it_parent != submit_prioritised_package.m_tx_results.end());\n         BOOST_CHECK(it_parent->second.m_result_type == MempoolAcceptResult::ResultType::VALID);\n-        BOOST_CHECK(it_parent->second.m_base_fees.value() == 0);\n+        BOOST_CHECK(it_parent->second.m_base_fees.value() == 200);\n         BOOST_CHECK(it_parent->second.m_effective_feerate.value() == expected_feerate);\n         BOOST_CHECK(it_child != submit_prioritised_package.m_tx_results.end());\n         BOOST_CHECK(it_child->second.m_result_type == MempoolAcceptResult::ResultType::VALID);\n-        BOOST_CHECK(it_child->second.m_base_fees.value() == 200);\n+        BOOST_CHECK(it_child->second.m_base_fees.value() == 600);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164445361",
      "id" : 1164445361,
      "line" : 774,
      "node_id" : "PRRC_kwDOABII585FaAax",
      "original_commit_id" : "8d2c5b6e5bd928485e9e97c03987f4b1cfc75f0c",
      "original_line" : 771,
      "original_position" : 142,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 157,
      "pull_request_review_id" : 1381762702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164445361/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-12T18:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1164445361",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Would it make sense to replace this with a PR that enabled package relay without v3 or package RBF, and included this policy? I think that would be the first ~10 commits from https://github.com/bitcoin/bitcoin/pull/25038? That seems like it would be more meaningful progress...\r\n\r\nRight, the changes for package relay only (i.e. no v3, no package RBF) would be this, persist packages across restart, and allow any ancestor package instead of just child-with-parents. Basically this PR + the first 7 commits of #25038 + the original #26711. I've now pushed all of it to #26711 so hopefully it's more clear what that looks like.\r\n\r\nPutting more of it in this PR would be more progress of course, but I'm given to believe that less stuff per PR == easier to review.\r\nI could add all the commits that are shared between #25038 and #26711 here? Happy to cut the PRs in whichever way makes the most sense to y'all.",
      "created_at" : "2023-04-12T18:04:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1505710683",
      "id" : 1505710683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585Zv1Jb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505710683/reactions"
      },
      "updated_at" : "2023-04-12T18:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505710683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Right, the changes for package relay only (i.e. no v3, no package RBF) would be this, persist packages across restart, and allow any ancestor package instead of just child-with-parents.\r\n\r\nSorry, I more just mean \"what's the minimal set of additional commits that need this that results in something that's useful on its own?\"\r\n\r\nMaybe the current overarching \"useful thing\" is just \"package mempool acceptance works in regtest via rpc in a way that would be acceptable to expose on mainnet for packages put together by random peers\", and that's already a multi-step thing, and this PR is already a step forward on that path? If so, maybe it would be worth creating an issue with a task list of the steps?\r\n\r\n - [ ] avoid the risk of below minrelaytxfee txs hanging around forever in the mempool\r\n   - [ ] v1, v2 txs should never be below minrelaytxfee (26933)\r\n   - [ ] regularly trim mempool txs with descendent fee of 0 (or less), even when the mempool is not full (27018)\r\n   - [ ] drop the default blockminfee to 0, to avoid mining non-full blocks when there are fee paying txs in the mempool, so that any below minrelaytxfee txs eventually get mined anyway (27018)\r\n - [ ] apply mempool min fee rules to packages correctly (26711)\r\n - [ ] when loading a saved mempool, prevent parents from being evicted as they might be cpfp'ed by later transactions that haven't been loaded yet (26711)\r\n - [ ] handle arbitrary packages of possibly completely unrelated txs sensibly (26711)\r\n - [ ] support v3 tx rules? (25038)\r\n - [ ] support ephemeral anchors? (26403)\r\n - [ ] support package rbf? (25038)\r\n\r\n(huh, abbreviating package relay as \"PR\" is instantly confusing)",
      "created_at" : "2023-04-13T14:26:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1507067647",
      "id" : 1507067647,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585Z1Ab_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1507067647/reactions"
      },
      "updated_at" : "2023-04-13T14:26:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1507067647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1166795553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166795553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We can't because these get rejected and `info()` only works on transactions that make it into the mempool.",
      "commit_id" : "6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-14T12:47:56Z",
      "diff_hunk" : "@@ -657,9 +661,9 @@ BOOST_FIXTURE_TEST_CASE(package_cpfp_tests, TestChain100Setup)\n     package_cpfp.push_back(tx_child);\n \n     // Package feerate is calculated using modified fees, and prioritisetransaction accepts negative\n-    // fee deltas. This should be taken into account. De-prioritise the parent transaction by -1BTC,\n-    // bringing the package feerate to 0.\n-    m_node.mempool->PrioritiseTransaction(tx_parent->GetHash(), -1 * COIN);\n+    // fee deltas. This should be taken into account. De-prioritise the parent transaction\n+    // to bring the package feerate to 0.\n+    m_node.mempool->PrioritiseTransaction(tx_parent->GetHash(), child_value - coinbase_value);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1166795553",
      "id" : 1166795553,
      "in_reply_to_id" : 1164440396,
      "line" : 666,
      "node_id" : "PRRC_kwDOABII585Fi-Mh",
      "original_commit_id" : "8d2c5b6e5bd928485e9e97c03987f4b1cfc75f0c",
      "original_line" : 666,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 55,
      "pull_request_review_id" : 1385399359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166795553/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-14T12:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166795553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns thanks for the feedback, I'm not really sure where to draw the line between useful and not useful but I've made a tracking issue #27463. I've marked places where I think the outcome is meaningful (e.g. \"after this, we could expose on p2p and it would be safe\").",
      "created_at" : "2023-04-14T12:48:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1508455396",
      "id" : 1508455396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585Z6TPk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1508455396/reactions"
      },
      "updated_at" : "2023-04-14T12:48:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1508455396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 6fb01d26c57f6af7205721e528bbafee8fa41027",
      "created_at" : "2023-04-17T05:51:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1510743503",
      "id" : 1510743503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585aDB3P",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510743503/reactions"
      },
      "updated_at" : "2023-04-17T05:51:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510743503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'm not really sure where to draw the line between useful and not useful\r\n\r\nI think \"submitpackage\" would count as obviously useful if it was available on mainnet -- even without package relay, a miner could expose that via a web form to allow people to do cpfp bumps when the (miner's) mempool is full, eg.\r\n\r\nI was viewing that RPC more as \"here's a way of exposing some code we're working on so we can test it while it's in development\", but if you look at it as \"here's something that would be useful already, except we don't want to expose it because if someone submits a sub-minrelayfee tx it'll clog up their mempool without ever having any possibility of getting relayed\", then this PR fixes that problem.\r\n\r\nI think with this PR merged, we could reasonably expose submitpackage outside of regtest, though should keep it debug-only/experimental (after this PR, I think it's never worse than having 500MB in the mempool and submitting a min mempool fee tx, and we already allow that).",
      "created_at" : "2023-04-17T07:36:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1510851570",
      "id" : 1510851570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585aDcPy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510851570/reactions"
      },
      "updated_at" : "2023-04-17T07:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510851570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "6fb01d2...563a2ee addressed\r\n- https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164418072\r\n- https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164429604\r\n- https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164445008\r\n- https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1164445361",
      "created_at" : "2023-04-17T09:14:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1510988023",
      "id" : 1510988023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585aD9j3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510988023/reactions"
      },
      "updated_at" : "2023-04-17T09:14:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510988023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Last push fixes + tests the case where package meets mempool min feerate, but hits maxmempool and is evicted immediately (the user-facing effect is that submitpackage now throws a different and more helpful JSONRPCError). Don't know why I hadn't been testing that already, my bad.\r\n\r\n> I think \"submitpackage\" would count as obviously useful if it was available on mainnet -- even without package relay, a miner could expose that via a web form to allow people to do cpfp bumps when the (miner's) mempool is full, eg.\r\n\r\nThat makes sense to me as a useful use case, though I'm unsure if we should encourage miners to accept txns the rest of the network can't see.\r\n\r\n> I think with this PR merged, we could reasonably expose submitpackage outside of regtest, though should keep it debug-only/experimental (after this PR, I think it's never worse than having 500MB in the mempool and submitting a min mempool fee tx, and we already allow that).\r\n\r\nThought about this for a bit. While there are edge cases where the package won't go in, and submitpackage doesn't have a maxfeerate/maxburn check, I suppose this is not unsafe. Could open the RPC in a followup?",
      "created_at" : "2023-04-17T12:01:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1511209727",
      "id" : 1511209727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585aEzr_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1511209727/reactions"
      },
      "updated_at" : "2023-04-17T12:02:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1511209727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1168777037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168777037"
         }
      },
      "author_association" : "MEMBER",
      "body" : "should this just be None and have a check that it's non-None later? or is this value important?",
      "commit_id" : "bf77fc9cb45209b9c560208c65abc94209cd7919",
      "created_at" : "2023-04-17T14:20:02Z",
      "diff_hunk" : "@@ -119,7 +119,31 @@ def run_test(self):\n \n         # The node will broadcast each transaction, still abiding by its peer's fee filter\n         peer.wait_for_broadcast([tx[\"tx\"].getwtxid() for tx in package_txns])\n-        self.generate(node, 1)\n+\n+        self.log.info(\"Check a package that passes mempoolminfee but is evicted immediately after submission\")\n+        mempoolmin_feerate = node.getmempoolinfo()[\"mempoolminfee\"]\n+        current_mempool = node.getrawmempool(verbose=False)\n+        worst_feerate_btcvb = Decimal(\"21000000\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#discussion_r1168777037",
      "id" : 1168777037,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII585Fqh9N",
      "original_commit_id" : "bf77fc9cb45209b9c560208c65abc94209cd7919",
      "original_line" : 126,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 85,
      "pull_request_review_id" : 1388204359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26933",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168777037/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-17T14:27:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168777037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> (the user-facing effect is that submitpackage now throws a different and more helpful JSONRPCError)\r\n\r\nFor those following at home, the legacy reason it was giving was the first transaction in package's individual submission error, aka missing mempool min fee.",
      "created_at" : "2023-04-17T14:38:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1511498138",
      "id" : 1511498138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585aF6Ga",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1511498138/reactions"
      },
      "updated_at" : "2023-04-17T14:38:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1511498138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "reACK bf77fc9cb45209b9c560208c65abc94209cd7919",
      "created_at" : "2023-04-26T09:49:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1523120410",
      "id" : 1523120410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585ayPka",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523120410/reactions"
      },
      "updated_at" : "2023-04-26T09:49:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523120410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just ran into this today while testing #27463.\r\n\r\nTo make testing of package submission easier, should we have an option to allow this on test networks? Or perhaps a way to set a minimum for `GetMinFee()`?\r\n\r\n@sdaftuar does mempool clustering fix this? E.g. is it just a matter of (occasionally) evicting chunks below `-minrelaytxfee`? From the above discussion I get the impression that the answer is yes, but most of this was discussed before that proposal came out.",
      "created_at" : "2023-11-23T14:11:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1824503673",
      "id" : 1824503673,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585sv7d5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1824503673/reactions"
      },
      "updated_at" : "2023-11-23T14:11:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1824503673",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors testing it includes making sure nothing below minrelay can enter the mempool, unfortunately until v3(where 0-fee will be allowed) or cluster mempool is deployed, which makes trimming very fast",
      "created_at" : "2023-11-23T14:18:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26933#issuecomment-1824513479",
      "id" : 1824513479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26933",
      "node_id" : "IC_kwDOABII585sv93H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1824513479/reactions"
      },
      "updated_at" : "2023-11-23T14:18:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1824513479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   }
]
