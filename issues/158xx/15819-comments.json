[
   {
      "author_association" : "MEMBER",
      "body" : "If nobody can reproduce this, I might try nuking and reinstalling Homebrew entirely.",
      "created_at" : "2019-04-15T13:39:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15819#issuecomment-483255518",
      "id" : 483255518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15819",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MzI1NTUxOA==",
      "updated_at" : "2019-04-15T13:39:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/483255518",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I presume the functional tests (and unit tests?) fail?",
      "created_at" : "2019-04-15T13:48:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15819#issuecomment-483258772",
      "id" : 483258772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15819",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MzI1ODc3Mg==",
      "updated_at" : "2019-04-15T13:48:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/483258772",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I should add: I can run with `-nowallet` without a crash (until I load a wallet).\r\n\r\nFunctional tests fail. Most unit tests pass, but the PSBT one threw an error last time I tried.",
      "created_at" : "2019-04-15T13:57:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15819#issuecomment-483262387",
      "id" : 483262387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15819",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MzI2MjM4Nw==",
      "updated_at" : "2019-04-15T13:57:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/483262387",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'd be a bit surprised if the `brew` installed `berkeley-db@4` was the sole cause of this issue (fwiw I'm not seeing any issues with it and `master`). That formula has only changed a couple times over the last few years.\r\n\r\nThe most recent [change](https://github.com/Homebrew/homebrew-core/pull/32552) was to fix compiling with Xcode 10, which is just applying [this patch](https://raw.githubusercontent.com/Homebrew/formula-patches/4c55b1/berkeley-db%404/clang.diff). That patch is equivalent to what we apply in [depends](https://github.com/bitcoin/bitcoin/blob/598323911e930d67e678e464353eb570ad3bf2b7/depends/packages/bdb.mk#L17), and that we download in [contrib/install_db4.sh](https://github.com/bitcoin/bitcoin/blob/598323911e930d67e678e464353eb570ad3bf2b7/contrib/install_db4.sh#L68).\r\n\r\nIs it possible that you've (re)installed `berkeley-db@4`, or compiled with outdated Xcode/command line tools/macOS headers installed, and that could be the cause of the issue?\r\n\r\nDo you have a copy of that `A` env that others could test with? \r\n\r\n> If nobody can reproduce this, I might try nuking and reinstalling Homebrew entirely.\r\n\r\nI'd hold off on doing that (unless you have an easy way to reset to your current installed packages etc). What's the output of `brew doctor`?\r\nCan you try completely removing and installing `berkeley-db@4` and check if the issue persists?",
      "created_at" : "2019-04-16T08:29:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15819#issuecomment-483563613",
      "id" : 483563613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15819",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MzU2MzYxMw==",
      "updated_at" : "2019-04-16T11:44:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/483563613",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think wallet A is interesting (though there's a good chance it was created with a newer BDB version), because it also crashed when creating a fresh wallet.\r\n\r\nI also don't think `berkeley-db@4` the sole cause. I tried removing and reinstalling `berkeley-db@4` (though not `berkeley-db` yet). I also didn't try older versions of master, so it's not even certain that anything there caused it.\r\n\r\n`brew doctor` doesn't show seem interesting, but [here it is](https://gist.github.com/Sjors/94e766a953d8d8966fa6eae94489f4d2).\r\n\r\nThe other strange thing is that when I remove `berkeley-db@4` and use `--with-incompatible-bdb` the following doesn't go away: `CPPFLAGS -I/usr/local/Cellar/berkeley-db@4`. That directory is empty. I tried both `make distclean` and `git clean -dfx` with no effect. ",
      "created_at" : "2019-04-16T11:40:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15819#issuecomment-483624525",
      "id" : 483624525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15819",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MzYyNDUyNQ==",
      "updated_at" : "2019-04-16T11:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/483624525",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I reinstalled all of Homebrew and also used `berkeley-db4` (as specified in the [docs]()) instead of `berkeley-db@4`. This results in a slightly different CPPFLAGS `-I/usr/local/opt/berkeley-db@4/include`. No more crash.\r\n\r\nThe [macOS build instructions](https://github.com/bitcoin/bitcoin/blob/master/doc/build-osx.md#dependencies) also specify `berkeley-db4`. I can't remember what the reason was that I switched to `berkeley-db@4`.",
      "created_at" : "2019-04-24T09:44:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15819#issuecomment-486148798",
      "id" : 486148798,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15819",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NjE0ODc5OA==",
      "updated_at" : "2019-04-24T09:44:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/486148798",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
