[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\n\r\nThere is an argument against doing things like this:  that it's better to fail deterministically rather than fail randomly at some point in the future and have created incorrect expectations of functionality.  But setting prune to some large \"future\" amount is a perfectly reasonable configuration.  And this doesn't cause it to fail randomly, but rather work until it doesn't.  So I don't believe the general argument against this sort of thing offsets the benefit.",
      "created_at" : "2019-04-22T18:44:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-485509311",
      "id" : 485509311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTUwOTMxMQ==",
      "updated_at" : "2019-04-22T18:44:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485509311",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems to affect importaddress, importpubkey, importprivkey, and importwallet but not importmulti. I wonder how the new behavior compares to importmulti behavior, and if there's a difference, whether that's justified.",
      "created_at" : "2019-04-22T19:16:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-485519649",
      "id" : 485519649,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTUxOTY0OQ==",
      "updated_at" : "2019-04-22T19:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485519649",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2019-04-22T19:30:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-485523746",
      "id" : 485523746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTUyMzc0Ng==",
      "updated_at" : "2019-04-27T15:15:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485523746",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky The only difference between importmulti and the other calls is that in importmulti you can \"opt-out\" of scanning early blocks by setting a later timestamp. Otherwise, my change makes all calls behave in the same way.\r\n\r\nEdit: I believe the only difference is that importmulti will import the keys and then fail the rescan, whereas the other calls will exit early and not attempt to import anything.",
      "created_at" : "2019-04-22T19:34:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-485524753",
      "id" : 485524753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTUyNDc1Mw==",
      "updated_at" : "2019-04-22T19:59:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485524753",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Edit: I believe the only difference is that importmulti will import the keys and then fail the rescan, whereas the other calls will exit early and not attempt to import anything.\r\n\r\nWhy a different behavior? It's already possible to call `importmulti ... '{\"rescan\": false}'` and then `rescanblockchain ...`? I think RPCs should (try to) be atomic so that the client doesn't have to figure out what succeeded or not.",
      "created_at" : "2019-04-24T20:12:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-486407340",
      "id" : 486407340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NjQwNzM0MA==",
      "updated_at" : "2019-04-24T20:12:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/486407340",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why a different behavior?\r\n\r\nI don't know. I didn't write the importmulti RPC and I don't plan to change it in this pull request.",
      "created_at" : "2019-04-24T20:23:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-486411063",
      "id" : 486411063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NjQxMTA2Mw==",
      "updated_at" : "2019-04-24T20:23:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/486411063",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278306246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278306246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move to the chain lock?",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-04-24T20:33:49Z",
      "diff_hunk" : "@@ -326,7 +326,11 @@ class ChainImpl : public Chain\n     CFeeRate relayIncrementalFee() override { return ::incrementalRelayFee; }\n     CFeeRate relayDustFee() override { return ::dustRelayFee; }\n     CAmount maxTxFee() override { return ::maxTxFee; }\n-    bool getPruneMode() override { return ::fPruneMode; }\n+    bool havePruned() override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278306246",
      "id" : 278306246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3ODMwNjI0Ng==",
      "original_commit_id" : "fad84519391a05f2ad42381cca9135323b709657",
      "original_position" : 5,
      "path" : "src/interfaces/chain.cpp",
      "position" : 11,
      "pull_request_review_id" : 230341302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278306246",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278307845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278307845"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A block can be pruned before RescanWallet (L202). What would be the error then?",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-04-24T20:38:11Z",
      "diff_hunk" : "@@ -157,8 +157,8 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         if (!request.params[2].isNull())\n             fRescan = request.params[2].get_bool();\n \n-        if (fRescan && pwallet->chain().getPruneMode()) {\n-            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled in pruned mode\");\n+        if (fRescan && pwallet->chain().havePruned()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278307845",
      "id" : 278307845,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3ODMwNzg0NQ==",
      "original_commit_id" : "fad84519391a05f2ad42381cca9135323b709657",
      "original_position" : 6,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 12,
      "pull_request_review_id" : 230341302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278307845",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278315111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278315111"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It will throw an error `\"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\"`",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-04-24T20:57:57Z",
      "diff_hunk" : "@@ -157,8 +157,8 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         if (!request.params[2].isNull())\n             fRescan = request.params[2].get_bool();\n \n-        if (fRescan && pwallet->chain().getPruneMode()) {\n-            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled in pruned mode\");\n+        if (fRescan && pwallet->chain().havePruned()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278315111",
      "id" : 278315111,
      "in_reply_to_id" : 278307845,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3ODMxNTExMQ==",
      "original_commit_id" : "fad84519391a05f2ad42381cca9135323b709657",
      "original_position" : 6,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 12,
      "pull_request_review_id" : 230352707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278315111",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278315293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278315293"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why?",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-04-24T20:58:28Z",
      "diff_hunk" : "@@ -326,7 +326,11 @@ class ChainImpl : public Chain\n     CFeeRate relayIncrementalFee() override { return ::incrementalRelayFee; }\n     CFeeRate relayDustFee() override { return ::dustRelayFee; }\n     CAmount maxTxFee() override { return ::maxTxFee; }\n-    bool getPruneMode() override { return ::fPruneMode; }\n+    bool havePruned() override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278315293",
      "id" : 278315293,
      "in_reply_to_id" : 278306246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3ODMxNTI5Mw==",
      "original_commit_id" : "fad84519391a05f2ad42381cca9135323b709657",
      "original_position" : 5,
      "path" : "src/interfaces/chain.cpp",
      "position" : 11,
      "pull_request_review_id" : 230352946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278315293",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278316048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278316048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry for the brief reply, but see here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fad84519391a05f2ad42381cca9135323b709657/src/interfaces/chain.h#L69-L73\r\n\r\nThe chain lock is deprecated and will be removed in the future.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-04-24T21:00:32Z",
      "diff_hunk" : "@@ -326,7 +326,11 @@ class ChainImpl : public Chain\n     CFeeRate relayIncrementalFee() override { return ::incrementalRelayFee; }\n     CFeeRate relayDustFee() override { return ::dustRelayFee; }\n     CAmount maxTxFee() override { return ::maxTxFee; }\n-    bool getPruneMode() override { return ::fPruneMode; }\n+    bool havePruned() override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278316048",
      "id" : 278316048,
      "in_reply_to_id" : 278306246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3ODMxNjA0OA==",
      "original_commit_id" : "fad84519391a05f2ad42381cca9135323b709657",
      "original_position" : 5,
      "path" : "src/interfaces/chain.cpp",
      "position" : 11,
      "pull_request_review_id" : 230353926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/278316048",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Concept ACK. Correct me if I'm wrong, but it doesn't have to fail if all required blocks are available right?\r\n\r\nimportmulti does not fail the rescan when all blocks after the timestamp are available, but it fails *after* the import if a block is missing.\r\nthe other import* (after my change) also do not fail the rescan when all blocks after time=0 are available. However, they fail *before* the import if a block is missing.",
      "created_at" : "2019-04-24T21:03:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-486425232",
      "id" : 486425232,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NjQyNTIzMg==",
      "updated_at" : "2019-04-24T21:03:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/486425232",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Let's use prune height instead, so `rescanblockchain` can be picky about it?",
      "created_at" : "2019-05-01T06:02:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-488217020",
      "id" : 488217020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODIxNzAyMA==",
      "updated_at" : "2019-05-01T06:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488217020",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I am not touching `rescanblockchain` at all. Could you explain what you mean?",
      "created_at" : "2019-05-01T14:02:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-488290292",
      "id" : 488290292,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODI5MDI5Mg==",
      "updated_at" : "2019-05-01T14:02:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488290292",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I mean it would make sense to use a common interface with `rescanblockchain`, which would need prune-height rather than have-pruned.",
      "created_at" : "2019-05-01T23:26:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-488489329",
      "id" : 488489329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODQ4OTMyOQ==",
      "updated_at" : "2019-05-01T23:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488489329",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oh, the RPCs I touch are already deprecated in favor of importmulti, so I'd rather not add features to them.",
      "created_at" : "2019-05-02T13:10:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-488666562",
      "id" : 488666562,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODY2NjU2Mg==",
      "updated_at" : "2019-05-02T13:10:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488666562",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm commenting on the src/interfaces changes specifically.",
      "created_at" : "2019-05-02T18:17:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-488777086",
      "id" : 488777086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODc3NzA4Ng==",
      "updated_at" : "2019-05-02T18:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488777086",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ah. Yeah, since we don't store the prune height, this would complicate my changes slightly. I think the additional code can be added later (when needed in rescanblockchain).",
      "created_at" : "2019-05-02T18:21:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-488778502",
      "id" : 488778502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODc3ODUwMg==",
      "updated_at" : "2019-05-02T18:21:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488778502",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm a little concerned about this change. Anywhere that `havePruned()` is called without `cs_main` is racy, since a block may be pruned after `havePruned()` is called. We therefore need to make sure that the code after those `havePruned()` calls is robust against being run when blocks have been pruned. If that's the case, why not just remove the `chain().getPruneMode()` check entirely and let the error-handling in the later code handle when a block is missing?\r\n\r\nThe four call sites in rpcdump do not hold `cs_main`. The call site in `CreateWalletFromFile()` does hold `cs_main` indirectly through `locked_chain`, but a goal is to remove that lock.",
      "created_at" : "2019-05-03T17:25:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-489175006",
      "id" : 489175006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4OTE3NTAwNg==",
      "updated_at" : "2019-05-03T17:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/489175006",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery The check is only there to provide a nice error message. As you correctly observe it is not needed for correctness. Should I clarify that with a comment?\r\n\r\nThe error message otherwise would be https://github.com/bitcoin/bitcoin/pull/15870#discussion_r278315111",
      "created_at" : "2019-05-03T17:49:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-489182583",
      "id" : 489182583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4OTE4MjU4Mw==",
      "updated_at" : "2019-05-03T17:49:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/489182583",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The check is only there to provide a nice error message. As you correctly observe it is not needed for correctness. Should I clarify that with a comment?\r\n\r\nYes, that sounds good. Thanks!",
      "created_at" : "2019-05-03T17:57:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-489185056",
      "id" : 489185056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4OTE4NTA1Ng==",
      "updated_at" : "2019-05-03T17:57:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/489185056",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r280892339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/280892339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: indentation\r\n\r\nEDIT: just remove this function entirely",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-03T18:59:19Z",
      "diff_hunk" : "@@ -40,9 +39,6 @@ class Variant(collections.namedtuple(\"Variant\", \"call data rescan prune\")):\n     \"\"\"Helper for importing one key and verifying scanned transactions.\"\"\"\n \n     def try_rpc(self, func, *args, **kwargs):\n-        if self.expect_disabled:\n-            assert_raises_rpc_error(-4, \"Rescan is disabled in pruned mode\", func, *args, **kwargs)\n-        else:\n             return func(*args, **kwargs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r280892339",
      "id" : 280892339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MDg5MjMzOQ==",
      "original_commit_id" : "fa9fa5d647092710aa03dadf92433584e9fe26a3",
      "original_position" : 15,
      "path" : "test/functional/wallet_import_rescan.py",
      "position" : null,
      "pull_request_review_id" : 233623884,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/280892339",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r280902472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/280902472"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-03T19:33:35Z",
      "diff_hunk" : "@@ -40,9 +39,6 @@ class Variant(collections.namedtuple(\"Variant\", \"call data rescan prune\")):\n     \"\"\"Helper for importing one key and verifying scanned transactions.\"\"\"\n \n     def try_rpc(self, func, *args, **kwargs):\n-        if self.expect_disabled:\n-            assert_raises_rpc_error(-4, \"Rescan is disabled in pruned mode\", func, *args, **kwargs)\n-        else:\n             return func(*args, **kwargs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r280902472",
      "id" : 280902472,
      "in_reply_to_id" : 280892339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MDkwMjQ3Mg==",
      "original_commit_id" : "fa9fa5d647092710aa03dadf92433584e9fe26a3",
      "original_position" : 15,
      "path" : "test/functional/wallet_import_rescan.py",
      "position" : null,
      "pull_request_review_id" : 233637159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/280902472",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "created_at" : "2019-05-03T19:46:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-489218060",
      "id" : 489218060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4OTIxODA2MA==",
      "updated_at" : "2019-05-03T19:46:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/489218060",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281252918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281252918"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Update year in line 1? `// Copyright (c) 2009-2018 The Bitcoin Core developers`",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T16:11:54Z",
      "diff_hunk" : "@@ -157,8 +157,11 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         if (!request.params[2].isNull())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281252918",
      "id" : 281252918,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI1MjkxOA==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 1,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 7,
      "pull_request_review_id" : 234065801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281252918",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281253401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281253401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: space after // in lines 4222 and 4223",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T16:13:15Z",
      "diff_hunk" : "@@ -4221,8 +4221,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(interfaces::Chain& chain,\n     {\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281253401",
      "id" : 281253401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI1MzQwMQ==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 234065801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281253401",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281254503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281254503"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps out of PR scope but the docs in lines 4222 and 4223 could be clearer, e.g. is \"error\" the end of a sentence and \"this\" the start of a sentence, or...",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T16:16:25Z",
      "diff_hunk" : "@@ -4221,8 +4221,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(interfaces::Chain& chain,\n     {\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281254503",
      "id" : 281254503,
      "in_reply_to_id" : 281253401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI1NDUwMw==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 234065801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281254503",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281261523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281261523"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Does the code doc in 588 correspond correctly with the error message in 589? ",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T16:36:31Z",
      "diff_hunk" : "@@ -573,7 +582,10 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.ToString());\n \n-    if (pwallet->chain().getPruneMode()) {\n+    if (pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled in pruned mode\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281261523",
      "id" : 281261523,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI2MTUyMw==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 51,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 234065801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281261523",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281264587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281264587"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be worth extracting this code block repeated in `importprivkey`, `importaddress`, `importpubkey`, and `importwallet` (the latter with a different error message).\r\n\r\n```cpp\r\n    if (fRescan && pwallet->chain().havePruned()) {\r\n        // Exit early and print an error.\r\n        // If a block is pruned after this check, we will import the key(s),\r\n        // but fail the rescan with a generic error.\r\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled when blocks are pruned\");\r\n    }\r\n```\r\n\r\nEdit: I understand it may be a premature or unnecessary optimisation. Just an observation.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T16:45:40Z",
      "diff_hunk" : "@@ -314,8 +317,11 @@ UniValue importaddress(const JSONRPCRequest& request)\n     if (!request.params[2].isNull())\n         fRescan = request.params[2].get_bool();\n \n-    if (fRescan && pwallet->chain().getPruneMode()) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled in pruned mode\");\n+    if (fRescan && pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled when blocks are pruned\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281264587",
      "id" : 281264587,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI2NDU4Nw==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 24,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 30,
      "pull_request_review_id" : 234065801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281264587",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281270503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281270503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, \"importing wallet\" means \"importing key(s)\", I believe.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T17:01:41Z",
      "diff_hunk" : "@@ -573,7 +582,10 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.ToString());\n \n-    if (pwallet->chain().getPruneMode()) {\n+    if (pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled in pruned mode\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281270503",
      "id" : 281270503,
      "in_reply_to_id" : 281261523,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI3MDUwMw==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 51,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 234087587,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281270503",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281270849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281270849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, could make sense. Will do if I have to touch for other reasons.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T17:02:40Z",
      "diff_hunk" : "@@ -314,8 +317,11 @@ UniValue importaddress(const JSONRPCRequest& request)\n     if (!request.params[2].isNull())\n         fRescan = request.params[2].get_bool();\n \n-    if (fRescan && pwallet->chain().getPruneMode()) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled in pruned mode\");\n+    if (fRescan && pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled when blocks are pruned\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281270849",
      "id" : 281270849,
      "in_reply_to_id" : 281264587,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI3MDg0OQ==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 24,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 30,
      "pull_request_review_id" : 234087988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281270849",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281271143"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281271143"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is only a dev comment, so no need to over-optimize. Will take specific suggestions if I need to touch this pull for other reasons, though.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T17:03:36Z",
      "diff_hunk" : "@@ -4221,8 +4221,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(interfaces::Chain& chain,\n     {\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281271143",
      "id" : 281271143,
      "in_reply_to_id" : 281253401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI3MTE0Mw==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 234088366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281271143",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281277772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281277772"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think \"no need to over-optimize\" is a helpful response. The grammar is wrong. Why not correct it?",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T17:20:58Z",
      "diff_hunk" : "@@ -4221,8 +4221,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(interfaces::Chain& chain,\n     {\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281277772",
      "id" : 281277772,
      "in_reply_to_id" : 281253401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI3Nzc3Mg==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 234096556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281277772",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281294785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281294785"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done with a scripted diff",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T18:07:26Z",
      "diff_hunk" : "@@ -157,8 +157,11 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         if (!request.params[2].isNull())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281294785",
      "id" : 281294785,
      "in_reply_to_id" : 281252918,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI5NDc4NQ==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 1,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 7,
      "pull_request_review_id" : 234118842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281294785",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281294894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281294894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a dot and space if that is what you meant",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-06T18:07:46Z",
      "diff_hunk" : "@@ -4221,8 +4221,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(interfaces::Chain& chain,\n     {\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r281294894",
      "id" : 281294894,
      "in_reply_to_id" : 281253401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTI5NDg5NA==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 234118998,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281294894",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. My first read of this was that it'd permit rescanning pruned chains, as long as the to-be-rescanned blocks are not pruned, but it seems to just be about whether or not any blocks are actually pruned (independent of the ones to be rescanned), right?",
      "created_at" : "2019-05-09T22:59:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-491096807",
      "id" : 491096807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MTA5NjgwNw==",
      "updated_at" : "2019-05-09T22:59:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/491096807",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The legacy calls would always rescan the whole chain. As soon as one block is pruned, it fails.",
      "created_at" : "2019-05-10T12:22:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-491269852",
      "id" : 491269852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MTI2OTg1Mg==",
      "updated_at" : "2019-05-10T12:22:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/491269852",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Out of scope for this PR but somewhat related -- would there be any reason to not attempt to fetch the pruned blocks from the P2P network to allow the rescan to happen?",
      "created_at" : "2019-05-15T04:40:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-492500634",
      "id" : 492500634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjUwMDYzNA==",
      "updated_at" : "2019-05-15T04:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492500634",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9447167?v=4",
         "events_url" : "https://api.github.com/users/wpaulino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wpaulino/followers",
         "following_url" : "https://api.github.com/users/wpaulino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wpaulino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wpaulino",
         "id" : 9447167,
         "login" : "wpaulino",
         "node_id" : "MDQ6VXNlcjk0NDcxNjc=",
         "organizations_url" : "https://api.github.com/users/wpaulino/orgs",
         "received_events_url" : "https://api.github.com/users/wpaulino/received_events",
         "repos_url" : "https://api.github.com/users/wpaulino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wpaulino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wpaulino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wpaulino"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Jup, but that might be something to do only after #15946",
      "created_at" : "2019-05-15T12:00:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-492624925",
      "id" : 492624925,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjYyNDkyNQ==",
      "updated_at" : "2019-05-15T12:00:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492624925",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284334252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284334252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe `s/in pruned mode/when blocks are pruned/` for consistency with the other error messages.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-15T16:05:35Z",
      "diff_hunk" : "@@ -573,7 +582,10 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.ToString());\n \n-    if (pwallet->chain().getPruneMode()) {\n+    if (pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled in pruned mode\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284334252",
      "id" : 284334252,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDMzNDI1Mg==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 51,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 237923331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284334252",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284359219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284359219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Now there is no longer any test coverage for the \"rescan is disabled\" cases, but I'm not sure if there's an easy way to add it back. Maybe a `pruneblockchain` RPC call could be added.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-15T17:07:07Z",
      "diff_hunk" : "@@ -39,23 +38,17 @@\n class Variant(collections.namedtuple(\"Variant\", \"call data rescan prune\")):\n     \"\"\"Helper for importing one key and verifying scanned transactions.\"\"\"\n \n-    def try_rpc(self, func, *args, **kwargs):\n-        if self.expect_disabled:\n-            assert_raises_rpc_error(-4, \"Rescan is disabled in pruned mode\", func, *args, **kwargs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284359219",
      "id" : 284359219,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDM1OTIxOQ==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 14,
      "path" : "test/functional/wallet_import_rescan.py",
      "position" : 14,
      "pull_request_review_id" : 237923331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284359219",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/15870/commits/aaaa57c2aad3a6278559ae3db5d953c847c6ffcb\r\n\r\nMakes a lot of sense to allow rescanning for as long as we can as @gmaxwell notes above - and indeed it might even be prudent for most users to set a future-proofing prune value that reflects their disk limitations at startup time. Better that your node start pruning vs. run out of disk space and exit. \r\n\r\nMaybe in the future we could even default to such a thing based on the datadir device if pruning-enabled-but-not-done-yet behavior is equivalent to a non-pruning node. Or introduce an \"adaptive\" pruning mode, which periodically polls for available disk space and adjusts the prune target accordingly. But of course this is all out of scope for this change.",
      "created_at" : "2019-05-15T17:23:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-492746119",
      "id" : 492746119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5Mjc0NjExOQ==",
      "updated_at" : "2019-05-15T17:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492746119",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jamesob you mean an option to ensure a minimum free space?",
      "created_at" : "2019-05-15T17:29:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-492748421",
      "id" : 492748421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5Mjc0ODQyMQ==",
      "updated_at" : "2019-05-15T17:29:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492748421",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284376933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284376933"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If a test was added, it should also (or more importantly) test `importmulti`, so I am not actually decreasing test coverage here.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-15T17:50:55Z",
      "diff_hunk" : "@@ -39,23 +38,17 @@\n class Variant(collections.namedtuple(\"Variant\", \"call data rescan prune\")):\n     \"\"\"Helper for importing one key and verifying scanned transactions.\"\"\"\n \n-    def try_rpc(self, func, *args, **kwargs):\n-        if self.expect_disabled:\n-            assert_raises_rpc_error(-4, \"Rescan is disabled in pruned mode\", func, *args, **kwargs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284376933",
      "id" : 284376933,
      "in_reply_to_id" : 284359219,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDM3NjkzMw==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 14,
      "path" : "test/functional/wallet_import_rescan.py",
      "position" : 14,
      "pull_request_review_id" : 237976934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284376933",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284377125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284377125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree that a test would be nice for that case, but can be done in a follow up pull request.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-15T17:51:21Z",
      "diff_hunk" : "@@ -39,23 +38,17 @@\n class Variant(collections.namedtuple(\"Variant\", \"call data rescan prune\")):\n     \"\"\"Helper for importing one key and verifying scanned transactions.\"\"\"\n \n-    def try_rpc(self, func, *args, **kwargs):\n-        if self.expect_disabled:\n-            assert_raises_rpc_error(-4, \"Rescan is disabled in pruned mode\", func, *args, **kwargs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284377125",
      "id" : 284377125,
      "in_reply_to_id" : 284359219,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDM3NzEyNQ==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 14,
      "path" : "test/functional/wallet_import_rescan.py",
      "position" : 14,
      "pull_request_review_id" : 237977177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284377125",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284381570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284381570"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> it should also (or more importantly) test importmulti\r\n\r\nIn case it helps, there is currently a unit test for importmulti behavior with pruning: https://github.com/bitcoin/bitcoin/blob/2d16fb7a2b6a9e5a2535295d2de03e27c2438d1f/src/wallet/test/wallet_tests.cpp#L158",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-15T18:01:30Z",
      "diff_hunk" : "@@ -39,23 +38,17 @@\n class Variant(collections.namedtuple(\"Variant\", \"call data rescan prune\")):\n     \"\"\"Helper for importing one key and verifying scanned transactions.\"\"\"\n \n-    def try_rpc(self, func, *args, **kwargs):\n-        if self.expect_disabled:\n-            assert_raises_rpc_error(-4, \"Rescan is disabled in pruned mode\", func, *args, **kwargs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284381570",
      "id" : 284381570,
      "in_reply_to_id" : 284359219,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDM4MTU3MA==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 14,
      "path" : "test/functional/wallet_import_rescan.py",
      "position" : 14,
      "pull_request_review_id" : 237982628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284381570",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284385846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284385846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done (and added a release note)",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-15T18:11:59Z",
      "diff_hunk" : "@@ -573,7 +582,10 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.ToString());\n \n-    if (pwallet->chain().getPruneMode()) {\n+    if (pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled in pruned mode\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284385846",
      "id" : 284385846,
      "in_reply_to_id" : 284334252,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDM4NTg0Ng==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 51,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 237987865,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-15T18:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284385846",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284713285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284713285"
         }
      },
      "author_association" : "MEMBER",
      "body" : "faf3729242c5e9486e137e549f05bf20bd3908a0\r\n\r\nYeah, in a follow up is fine.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-16T13:44:38Z",
      "diff_hunk" : "@@ -314,8 +317,11 @@ UniValue importaddress(const JSONRPCRequest& request)\n     if (!request.params[2].isNull())\n         fRescan = request.params[2].get_bool();\n \n-    if (fRescan && pwallet->chain().getPruneMode()) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled in pruned mode\");\n+    if (fRescan && pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled when blocks are pruned\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284713285",
      "id" : 284713285,
      "in_reply_to_id" : 281264587,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDcxMzI4NQ==",
      "original_commit_id" : "fa9f3cc89442e9b332a27b81b04201bb4a0caf28",
      "original_position" : 24,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 30,
      "pull_request_review_id" : 238391319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-16T13:58:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284713285",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284717609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284717609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749\r\n\r\nThis should be in 1s commit.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-16T13:53:10Z",
      "diff_hunk" : "@@ -573,8 +582,11 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.ToString());\n \n-    if (pwallet->chain().getPruneMode()) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled in pruned mode\");\n+    if (pwallet->chain().havePruned()) {\n+        // Exit early and print an error.\n+        // If a block is pruned after this check, we will import the key(s),\n+        // but fail the rescan with a generic error.\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled when blocks are pruned\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284717609",
      "id" : 284717609,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDcxNzYwOQ==",
      "original_commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "original_position" : 58,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 58,
      "pull_request_review_id" : 238391319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-16T13:58:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284717609",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284718591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284718591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "faf3729242c5e9486e137e549f05bf20bd3908a0\r\n\r\nThe dump file contains timestamps so, correct me if I'm wrong, it could only throw this error if earliest is pruned - the same for `importmulti` if timestamps are given.\r\n\r\nEdit: especially when manual pruning.",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-16T13:55:09Z",
      "diff_hunk" : "@@ -573,7 +582,10 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.ToString());\n \n-    if (pwallet->chain().getPruneMode()) {\n+    if (pwallet->chain().havePruned()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284718591",
      "id" : 284718591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDcxODU5MQ==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 47,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 54,
      "pull_request_review_id" : 238391319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-16T14:15:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284718591",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @jamesob you mean an option to ensure a minimum free space?\r\n\r\nIf you mean \"prune as little as possible and only until necessitated by lack of space,\" yes. Some kind of adaptive prune would just be a measure to avoid hitting an out-of-disk error for as long as possible. But this is out of scope in terms of this PR so maybe I'll file an issue later or something.",
      "created_at" : "2019-05-16T14:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#issuecomment-493084995",
      "id" : 493084995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MzA4NDk5NQ==",
      "updated_at" : "2019-05-16T14:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493084995",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284747583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284747583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not suggesting you change this PR, but for future reference we now have a handy `WITH_LOCK` macro: https://github.com/bitcoin/bitcoin/blob/fd61b9fc22faaa946ca43211c6c43b40ca4a860c/src/sync.h#L209",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-16T14:50:51Z",
      "diff_hunk" : "@@ -325,7 +325,11 @@ class ChainImpl : public Chain\n     CFeeRate relayMinFee() override { return ::minRelayTxFee; }\n     CFeeRate relayIncrementalFee() override { return ::incrementalRelayFee; }\n     CFeeRate relayDustFee() override { return ::dustRelayFee; }\n-    bool getPruneMode() override { return ::fPruneMode; }\n+    bool havePruned() override\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284747583",
      "id" : 284747583,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc0NzU4Mw==",
      "original_commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "original_position" : 13,
      "path" : "src/interfaces/chain.cpp",
      "position" : 13,
      "pull_request_review_id" : 238445964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-16T14:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284747583",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284762760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284762760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds like a nice follow up pull request",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-16T15:20:10Z",
      "diff_hunk" : "@@ -573,7 +582,10 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.ToString());\n \n-    if (pwallet->chain().getPruneMode()) {\n+    if (pwallet->chain().havePruned()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284762760",
      "id" : 284762760,
      "in_reply_to_id" : 284718591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc2Mjc2MA==",
      "original_commit_id" : "faf3729242c5e9486e137e549f05bf20bd3908a0",
      "original_position" : 47,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 54,
      "pull_request_review_id" : 238465628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-16T15:20:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284762760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284763116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284763116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I fail to see how this makes the code any easier to read",
      "commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "created_at" : "2019-05-16T15:20:55Z",
      "diff_hunk" : "@@ -325,7 +325,11 @@ class ChainImpl : public Chain\n     CFeeRate relayMinFee() override { return ::minRelayTxFee; }\n     CFeeRate relayIncrementalFee() override { return ::incrementalRelayFee; }\n     CFeeRate relayDustFee() override { return ::dustRelayFee; }\n-    bool getPruneMode() override { return ::fPruneMode; }\n+    bool havePruned() override\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15870#discussion_r284763116",
      "id" : 284763116,
      "in_reply_to_id" : 284747583,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc2MzExNg==",
      "original_commit_id" : "fa7e311e169349bfcf1dab8b980724e8ddf4e749",
      "original_position" : 13,
      "path" : "src/interfaces/chain.cpp",
      "position" : 13,
      "pull_request_review_id" : 238466080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15870",
      "updated_at" : "2019-05-16T15:20:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284763116",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
