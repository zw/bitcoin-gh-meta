{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "I have a testnet wallet I've used for some time in [Coldcard](https://github.com/Coldcard/firmware) testing, specifically to generate PSBT files for signing exercises. However, this wallet isn't generating PSBT files I want anymore. Specifically, it is making (unsigned, funded) PSBT files referencing a BIP32 fingerprint that I don't expect.\r\n\r\nAt first I thought it was an issue with encoding the values in the PSBT, and so I dumped the wallet backup to understand the problem.\r\n\r\nAfter some investigation, I find that the wallet backup doesn't contain enough information about the true contents of the wallet. There appears to be two private masterkeys in effect, and I have no way to get the details of the unknown one, aside from its fingerprint.\r\n\r\nUsing the `tprv` at the top of the file, I can reconstruct the private key of only 2049 of the 5506 addresses listed in the file.\r\n\r\nSpecifically, here are two lines that are in conflict (IMHO), because both have the same derivation path, `m/0'/0'/100'`, and yet different private keys!\r\n\r\n```\r\ncU7tcXeY4FtTAx5nH8uGaVSjTLVKfw8KxPmQeRs6nzucuSK33YQJ 2019-04-12T13:39:26Z reserve=1 # addr=2N9UWoUEdn8s2TcBid2wV2KMCp1Fk38r1h8 hdkeypath=m/0'/0'/100'\r\ncRtqv76chtn8KNrgeanMiUFaKHu9hK1E724Rj7fkZ6Rb5cGHR6q2 2018-05-17T14:25:41Z change=1 # addr=2N9aAP4Saa8njbBUkT54fnGpd5q8sGHv5xs hdkeypath=m/0'/0'/100'\r\n```\r\nThe first one makes sense based on the tprv at the top of the file. The other does not, and must be based on a different seed.\r\n\r\n_(There is only one `hdseed=1` line in the wallet backup.)_\r\n\r\nDoing `getaddressinfo` on the two addresses, indicates a different `hdmasterfingerprint` which corresponds to the unhelpful fingerprint I was seeing in the PSBT files:\r\n\r\n```\r\ngetaddressinfo 2N9UWoUEdn8s2TcBid2wV2KMCp1Fk38r1h8\r\n{\r\n  \"address\": \"2N9UWoUEdn8s2TcBid2wV2KMCp1Fk38r1h8\",\r\n  \"scriptPubKey\": \"a914b205748e497252c0b8c9aef4ad0c58e240d6980c87\",\r\n  \"ismine\": true,\r\n  \"solvable\": true,\r\n  \"desc\": \"sh(wpkh([645716a2/0'/0'/100']0350b7abfc54438575aa9cb3ef9e9e3684df49887acbfbbc7f2c1f76b81f96c619))#gypp23kt\",\r\n  \"iswatchonly\": false,\r\n  \"isscript\": true,\r\n  \"iswitness\": false,\r\n  \"script\": \"witness_v0_keyhash\",\r\n  \"hex\": \"0014baebc7c67a0313b882d4635cf069736138cc4bba\",\r\n  \"pubkey\": \"0350b7abfc54438575aa9cb3ef9e9e3684df49887acbfbbc7f2c1f76b81f96c619\",\r\n  \"embedded\": {\r\n    \"isscript\": false,\r\n    \"iswitness\": true,\r\n    \"witness_version\": 0,\r\n    \"witness_program\": \"baebc7c67a0313b882d4635cf069736138cc4bba\",\r\n    \"pubkey\": \"0350b7abfc54438575aa9cb3ef9e9e3684df49887acbfbbc7f2c1f76b81f96c619\",\r\n    \"address\": \"tb1qht4u03n6qvfm3qk5vdw0q6tnvyuvcja6q4027j\",\r\n    \"scriptPubKey\": \"0014baebc7c67a0313b882d4635cf069736138cc4bba\"\r\n  },\r\n  \"ischange\": true,\r\n  \"timestamp\": 1555076366,\r\n  \"hdkeypath\": \"m/0'/0'/100'\",\r\n  \"hdseedid\": \"3551b50538470b990d080f23226c37d98312e81e\",\r\n  \"hdmasterfingerprint\": \"645716a2\",\r\n  \"labels\": [\r\n  ]\r\n}\r\n\r\ngetaddressinfo 2N9aAP4Saa8njbBUkT54fnGpd5q8sGHv5xs\r\n{\r\n  \"address\": \"2N9aAP4Saa8njbBUkT54fnGpd5q8sGHv5xs\",\r\n  \"scriptPubKey\": \"a914b316e792f59c35560228a5d1d5dc2eca09f98e9c87\",\r\n  \"ismine\": true,\r\n  \"solvable\": true,\r\n  \"desc\": \"sh(wpkh([d79ed905/0'/0'/100']0222fe08b7bf79fb0e0f82f50e22c1da4d2db33776983c5a883d70d97524694df1))#a8p3w0dm\",\r\n  \"iswatchonly\": false,\r\n  \"isscript\": true,\r\n  \"iswitness\": false,\r\n  \"script\": \"witness_v0_keyhash\",\r\n  \"hex\": \"001434471490de4b879e516af87cc9c5569f67335f8b\",\r\n  \"pubkey\": \"0222fe08b7bf79fb0e0f82f50e22c1da4d2db33776983c5a883d70d97524694df1\",\r\n  \"embedded\": {\r\n    \"isscript\": false,\r\n    \"iswitness\": true,\r\n    \"witness_version\": 0,\r\n    \"witness_program\": \"34471490de4b879e516af87cc9c5569f67335f8b\",\r\n    \"pubkey\": \"0222fe08b7bf79fb0e0f82f50e22c1da4d2db33776983c5a883d70d97524694df1\",\r\n    \"address\": \"tb1qx3r3fyx7fwreu5t2lp7vn32knannxhuteu8h8f\",\r\n    \"scriptPubKey\": \"001434471490de4b879e516af87cc9c5569f67335f8b\"\r\n  },\r\n  \"ischange\": true,\r\n  \"timestamp\": 1526567141,\r\n  \"hdkeypath\": \"m/0'/0'/100'\",\r\n  \"hdseedid\": \"e0301044cb99ba73398c9187c32bad4a9cdf9247\",\r\n  \"hdmasterfingerprint\": \"d79ed905\",\r\n  \"labels\": [\r\n  ]\r\n}\r\n```\r\n\r\n`645716a2` is the fingerprint expected, and I have no idea where `d79ed905` comes from!\r\n\r\nMy questions/comments:\r\n\r\n- What RPC call do I make to dump the private key with hdseed \"d79ed905\" ??\r\n- This wallet has been around a while, since 16.0, and might have accumulated some cruft. This analysis was done with 18.0\r\n\r\nGenerally, WTF is going on here, and is it safe that the wallet backup hasn't captured all the HD seeds?! If it has captured that value, where can I find the secrets for `d79ed905` in the wallet backup?",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15884/comments",
   "created_at" : "2019-04-24T14:27:11Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15884/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/15884",
   "id" : 436730246,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15884/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU0MzY3MzAyNDY=",
   "number" : 15884,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Incomplete information in wallet backup and/or unexpected BIP32 seed",
   "updated_at" : "2019-04-24T17:53:30Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15884",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/1482781?v=4",
      "events_url" : "https://api.github.com/users/peter-conalgo/events{/privacy}",
      "followers_url" : "https://api.github.com/users/peter-conalgo/followers",
      "following_url" : "https://api.github.com/users/peter-conalgo/following{/other_user}",
      "gists_url" : "https://api.github.com/users/peter-conalgo/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/peter-conalgo",
      "id" : 1482781,
      "login" : "peter-conalgo",
      "node_id" : "MDQ6VXNlcjE0ODI3ODE=",
      "organizations_url" : "https://api.github.com/users/peter-conalgo/orgs",
      "received_events_url" : "https://api.github.com/users/peter-conalgo/received_events",
      "repos_url" : "https://api.github.com/users/peter-conalgo/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/peter-conalgo/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/peter-conalgo/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/peter-conalgo"
   }
}
