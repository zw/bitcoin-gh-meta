[
   {
      "body" : "Concept ACK, but why run on a schedule rather than after/before accepting new txns?",
      "created_at" : "2015-07-09T03:27:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119803941",
      "id" : 119803941,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T03:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119803941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "It takes a while for the condition to clear once noticed.  You don't want to run it too frequently.\r\n",
      "created_at" : "2015-07-09T04:58:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119817888",
      "id" : 119817888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T04:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119817888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I mean for setting the condition and increasing the minimum fee.. otherwise someone just needs to flood you as fast as they can before it kicks in, right?",
      "created_at" : "2015-07-09T05:05:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119820386",
      "id" : 119820386,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T05:05:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119820386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@luke-jr That is the ideal, but it requires a bit more effort.  Must avoid adding too much code to the per-tx fast path.\r\n\r\nA likely solution is perform inexpensive per-tx checks on total mempool size, then trigger some background action.  Such a solution would trigger upon the first tx exceeding high water limit.\r\n",
      "created_at" : "2015-07-09T06:03:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119830044",
      "id" : 119830044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T06:03:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119830044",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "First tx exceeding the limit trigger SGTM",
      "created_at" : "2015-07-09T06:07:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119830846",
      "id" : 119830846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T06:07:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119830846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Concept ACK. Nice work Jeff.",
      "created_at" : "2015-07-09T07:33:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119856632",
      "id" : 119856632,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T07:33:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119856632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/637706?v=3",
         "events_url" : "https://api.github.com/users/randy-waterhouse/events{/privacy}",
         "followers_url" : "https://api.github.com/users/randy-waterhouse/followers",
         "following_url" : "https://api.github.com/users/randy-waterhouse/following{/other_user}",
         "gists_url" : "https://api.github.com/users/randy-waterhouse/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/randy-waterhouse",
         "id" : 637706,
         "login" : "randy-waterhouse",
         "organizations_url" : "https://api.github.com/users/randy-waterhouse/orgs",
         "received_events_url" : "https://api.github.com/users/randy-waterhouse/received_events",
         "repos_url" : "https://api.github.com/users/randy-waterhouse/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/randy-waterhouse/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/randy-waterhouse/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/randy-waterhouse"
      }
   },
   {
      "body" : "Let's imagine the memory pool hits the low watermark and at that time it consists of 80% spam transactions at 100 bits/kb.  Then the lowest fee rate in the top half will be 100bits/kb and so further spam at the same rate will still enter the pool?  This will continue so long as the spammer can produce >50% of the transactions arriving at the node.",
      "created_at" : "2015-07-09T10:31:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119903967",
      "id" : 119903967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T10:31:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119903967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34245304"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34245304"
         }
      },
      "body" : "Just ran into this sane check (while testing with 5s interval). Maybe it would be worth to add a `LogPrint(\"mempool\", \"Janitor has been disabled because of insane interval\")` or similar.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:21:39Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)\n+        PoolmanLowWater = -1;\n+    else {\n+        PoolmanLowWater = GetArg(\"-mempoollowwater\", -1);\n+        if (PoolmanLowWater < 0 || PoolmanLowWater > PoolmanHighWater)\n+            PoolmanLowWater = PoolmanHighWater / 2;\n+    }\n+\n+    // if interval too small or zero, janitor is disabled\n+    static const int janitorSaneInterval = 10;\n+    if ((janitorInterval < janitorSaneInterval) ||\n+        (PoolmanHighWater <= 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34245304",
      "id" : 34245304,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 86,
      "path" : "src/poolman.cpp",
      "position" : 87,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34245304",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34245390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34245390"
         }
      },
      "body" : "rm *1000?",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:23:33Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)\n+        PoolmanLowWater = -1;\n+    else {\n+        PoolmanLowWater = GetArg(\"-mempoollowwater\", -1);\n+        if (PoolmanLowWater < 0 || PoolmanLowWater > PoolmanHighWater)\n+            PoolmanLowWater = PoolmanHighWater / 2;\n+    }\n+\n+    // if interval too small or zero, janitor is disabled\n+    static const int janitorSaneInterval = 10;\n+    if ((janitorInterval < janitorSaneInterval) ||\n+        (PoolmanHighWater <= 0)) {\n+        janitorInterval = 0;\n+        PoolmanLowWater = -1;\n+        PoolmanHighWater = 0;\n+    }\n+\n+    // start mempool janitor\n+    if (janitorInterval > 0)\n+        scheduler.scheduleEvery(&TxMempoolJanitor, janitorInterval * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34245390",
      "id" : 34245390,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 94,
      "path" : "src/poolman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34245390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34245882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34245882"
         }
      },
      "body" : "This should be flexible, so please use something like above with -dbcache. Also update to ``0 = disable`` (spaces usage), while you are on it.\r\n\r\nAlso true for the other 2 options!",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:32:19Z",
      "diff_hunk" : "@@ -281,8 +282,11 @@ std::string HelpMessage(HelpMessageMode mode)\n     }\n     strUsage += HelpMessageOpt(\"-datadir=<dir>\", _(\"Specify data directory\"));\n     strUsage += HelpMessageOpt(\"-dbcache=<n>\", strprintf(_(\"Set database cache size in megabytes (%d to %d, default: %d)\"), nMinDbCache, nMaxDbCache, nDefaultDbCache));\n+    strUsage += HelpMessageOpt(\"-janitorinterval=<n>\", _(\"Number of seconds between each mempool janitor run (default: 10 minutes, 0=disable)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34245882",
      "id" : 34245882,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 12,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34245882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246813"
         }
      },
      "body" : "Nit: Missing license, missing header group ordering and also std namespace polution.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:48:21Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246813",
      "id" : 34246813,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 1,
      "path" : "src/poolman.cpp",
      "position" : 4,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246854"
         }
      },
      "body" : "Nit: Missing license header and wrong header naming string, should be ``BITCOIN_POOLMAN_H`` here and at the header end.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:49:16Z",
      "diff_hunk" : "@@ -0,0 +1,8 @@\n+#ifndef __BITCOIN_POOLMAN_H__",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246854",
      "id" : 34246854,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 1,
      "path" : "src/poolman.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246924"
         }
      },
      "body" : "The ``.clear()`` doesn't need a lock?",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:50:44Z",
      "diff_hunk" : "@@ -311,6 +311,19 @@ void CTxMemPool::queryHashes(vector<uint256>& vtxid)\n         vtxid.push_back((*mi).first);\n }\n \n+void CTxMemPool::queryFees(vector<CFeeRate>& vfees)\n+{\n+    vfees.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246924",
      "id" : 34246924,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 6,
      "path" : "src/txmempool.cpp",
      "position" : 6,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246957"
         }
      },
      "body" : "Nit: ``size_t``?",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:51:20Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34246957",
      "id" : 34246957,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 28,
      "path" : "src/poolman.cpp",
      "position" : 29,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34246957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34247358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34247358"
         }
      },
      "body" : "No. It doesn't.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:57:13Z",
      "diff_hunk" : "@@ -311,6 +311,19 @@ void CTxMemPool::queryHashes(vector<uint256>& vtxid)\n         vtxid.push_back((*mi).first);\n }\n \n+void CTxMemPool::queryFees(vector<CFeeRate>& vfees)\n+{\n+    vfees.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34247358",
      "id" : 34247358,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 6,
      "path" : "src/txmempool.cpp",
      "position" : 6,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34247358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34247406"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34247406"
         }
      },
      "body" : "IMO okay because: `unsigned long CTxMemPool::size()`",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T11:58:11Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34247406",
      "id" : 34247406,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 28,
      "path" : "src/poolman.cpp",
      "position" : 29,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34247406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Tested a bit. Had to add three commits to get it running: https://github.com/jonasschnelli/bitcoin/commits/2015/07/mempool_janitor\r\n\r\n**Nice work!**\r\n\r\nI'm not sure but it feels that it somehow doesn't prevent from flooded mempools.\r\nExample: if someone is flooding your node with 1tx/s with a correct minRelayTxFee (lets assume 1000/kb), the janitor will always keep the minRelayTxFee at 1000/kb, because the back of the vector of all feerates / 2 will very likely to still be 1000/kb.\r\n\r\nI have set up a test: https://github.com/jonasschnelli/bitcoin/commit/086a59fc2084126dfbf8c28829cc236bfd3635f2\r\n\r\nSure this is not a real world example, but i would say even if <1/2 of the tx would contain higher fees, the floating relay fee would still stick at 1000/kb.\r\n\r\nMaybe it should somehow take the mempool size into the calculation (correlated with the block size).",
      "created_at" : "2015-07-09T12:23:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-119942020",
      "id" : 119942020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T12:23:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119942020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jgarzik \r\n[quote luke]Concept ACK, but why run on a schedule rather than after/before accepting new txns? [/quote] \r\n[quote jgarzik ] It takes a while for the condition to clear once noticed. You don't want to run it too frequently. [/quote] \r\n\r\nIsn't a integer set and compare per transaction that keeps track of the mempool size a very, very fast operation? Using scheduling for this seems overkill to me.",
      "created_at" : "2015-07-09T15:04:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120018354",
      "id" : 120018354,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T15:04:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120018354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4090425?v=3",
         "events_url" : "https://api.github.com/users/willsteel/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willsteel/followers",
         "following_url" : "https://api.github.com/users/willsteel/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willsteel/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willsteel",
         "id" : 4090425,
         "login" : "willsteel",
         "organizations_url" : "https://api.github.com/users/willsteel/orgs",
         "received_events_url" : "https://api.github.com/users/willsteel/received_events",
         "repos_url" : "https://api.github.com/users/willsteel/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willsteel/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willsteel/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willsteel"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34274319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34274319"
         }
      },
      "body" : "Don't allow janitor to compete with confirmation.  Minimum highwater should be something like 2 hours of maximum confirmation bytes.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T16:31:46Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34274319",
      "id" : 34274319,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 75,
      "path" : "src/poolman.cpp",
      "position" : 76,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34274319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "@jonasschnelli You are correct that this patch would not effectively prevent mempool flooding if the spam transactions all have the same fee/kb and make up for more than half of the mempool. Sorting by unique fee/kb values and then using the lowest entry of the top half as minRelayTxFee would however seem to fix this.",
      "created_at" : "2015-07-09T18:20:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120093845",
      "id" : 120093845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T18:20:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120093845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10465353?v=3",
         "events_url" : "https://api.github.com/users/andreas-cubits/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andreas-cubits/followers",
         "following_url" : "https://api.github.com/users/andreas-cubits/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andreas-cubits/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andreas-cubits",
         "id" : 10465353,
         "login" : "andreas-cubits",
         "organizations_url" : "https://api.github.com/users/andreas-cubits/orgs",
         "received_events_url" : "https://api.github.com/users/andreas-cubits/received_events",
         "repos_url" : "https://api.github.com/users/andreas-cubits/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andreas-cubits/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andreas-cubits/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andreas-cubits"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34292756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34292756"
         }
      },
      "body" : "Yea, scheduleEvery's second arg is seconds, not millis.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T19:21:04Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)\n+        PoolmanLowWater = -1;\n+    else {\n+        PoolmanLowWater = GetArg(\"-mempoollowwater\", -1);\n+        if (PoolmanLowWater < 0 || PoolmanLowWater > PoolmanHighWater)\n+            PoolmanLowWater = PoolmanHighWater / 2;\n+    }\n+\n+    // if interval too small or zero, janitor is disabled\n+    static const int janitorSaneInterval = 10;\n+    if ((janitorInterval < janitorSaneInterval) ||\n+        (PoolmanHighWater <= 0)) {\n+        janitorInterval = 0;\n+        PoolmanLowWater = -1;\n+        PoolmanHighWater = 0;\n+    }\n+\n+    // start mempool janitor\n+    if (janitorInterval > 0)\n+        scheduler.scheduleEvery(&TxMempoolJanitor, janitorInterval * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34292756",
      "id" : 34292756,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 94,
      "path" : "src/poolman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34292756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I'm not a big fan of increasing the dust limit dynamically as a part of this. I'd much prefer to only increase the relay fee itself and not touch dust. Still, it seems the majority of what this patch rejects are dust transactions, not rejecting free transactions using the rate limiter.",
      "created_at" : "2015-07-09T19:35:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120121188",
      "id" : 120121188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T19:35:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120121188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34296187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34296187"
         }
      },
      "body" : "what do you need from main?",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T19:55:40Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34296187",
      "id" : 34296187,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 5,
      "path" : "src/poolman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34296187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34296284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34296284"
         }
      },
      "body" : "Can't these be attributes of the class?",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T19:56:26Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34296284",
      "id" : 34296284,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 15,
      "path" : "src/poolman.cpp",
      "position" : 16,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34296284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34296390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34296390"
         }
      },
      "body" : "Can't all GetArg() calls be made from a function/method that is only called from init? ",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T19:57:27Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)\n+        PoolmanLowWater = -1;\n+    else {\n+        PoolmanLowWater = GetArg(\"-mempoollowwater\", -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34296390",
      "id" : 34296390,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 78,
      "path" : "src/poolman.cpp",
      "position" : 79,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34296390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Apart from the nits, I wonder if this could be integrated with the fee estimator in policy/fees.o",
      "created_at" : "2015-07-09T19:59:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120128114",
      "id" : 120128114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T19:59:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120128114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299281"
         }
      },
      "body" : "The minimum relay fee global\r\n",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T20:23:02Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299281",
      "id" : 34299281,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 5,
      "path" : "src/poolman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299340"
         }
      },
      "body" : "which class?",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T20:23:13Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299340",
      "id" : 34299340,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 15,
      "path" : "src/poolman.cpp",
      "position" : 16,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299393"
         }
      },
      "body" : "Um, it is made from a function that is only called from init.\r\n",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T20:23:41Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)\n+        PoolmanLowWater = -1;\n+    else {\n+        PoolmanLowWater = GetArg(\"-mempoollowwater\", -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299393",
      "id" : 34299393,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 78,
      "path" : "src/poolman.cpp",
      "position" : 79,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299907"
         }
      },
      "body" : "Oh, sure, it is still not an attribute of CStandardPolicy...nevermind then.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T20:28:51Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299907",
      "id" : 34299907,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 5,
      "path" : "src/poolman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299974"
         }
      },
      "body" : "Yes, sorry. Fast read.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T20:29:24Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)\n+        PoolmanLowWater = -1;\n+    else {\n+        PoolmanLowWater = GetArg(\"-mempoollowwater\", -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34299974",
      "id" : 34299974,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 78,
      "path" : "src/poolman.cpp",
      "position" : 79,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34299974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34300186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34300186"
         }
      },
      "body" : "A new class could be created to avoid new globals here. Or as said, this could be incorporated to the fee estimator.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-09T20:31:37Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34300186",
      "id" : 34300186,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 15,
      "path" : "src/poolman.cpp",
      "position" : 16,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34300186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon You mean like https://github.com/TheBlueMatt/bitcoin/commit/e68aee1e93d82ccb4c7310149581c8c5d738cd4a ? :p\r\nCurrently limits mempool to only a few MBs",
      "created_at" : "2015-07-09T21:29:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120149184",
      "id" : 120149184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-09T21:29:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120149184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@jtimon @TheBlueMatt integrating fee estimation with mempool management risks integrating wallet function with network function of the node.",
      "created_at" : "2015-07-10T00:45:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120186863",
      "id" : 120186863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-10T00:45:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120186863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/637706?v=3",
         "events_url" : "https://api.github.com/users/randy-waterhouse/events{/privacy}",
         "followers_url" : "https://api.github.com/users/randy-waterhouse/followers",
         "following_url" : "https://api.github.com/users/randy-waterhouse/following{/other_user}",
         "gists_url" : "https://api.github.com/users/randy-waterhouse/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/randy-waterhouse",
         "id" : 637706,
         "login" : "randy-waterhouse",
         "organizations_url" : "https://api.github.com/users/randy-waterhouse/orgs",
         "received_events_url" : "https://api.github.com/users/randy-waterhouse/received_events",
         "repos_url" : "https://api.github.com/users/randy-waterhouse/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/randy-waterhouse/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/randy-waterhouse/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/randy-waterhouse"
      }
   },
   {
      "body" : "@randy-waterhouse Huh? fee estimation code is managed by mempool...it is called by the wallet, but it is not a \"wallet function\". (dunno if it makes sense to use it to manage minimum tx fee, though, it may not work so great when looking at many-block confirmations, I havent dug into it much)",
      "created_at" : "2015-07-10T00:49:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120187640",
      "id" : 120187640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-10T00:50:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120187640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34326956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34326956"
         }
      },
      "body" : "The scanning interval and the high water mark are two very different things.  Presumably the high water mark should be ~2 days, less a small factor.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-10T04:26:44Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34326956",
      "id" : 34326956,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 75,
      "path" : "src/poolman.cpp",
      "position" : 76,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34326956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34327056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34327056"
         }
      },
      "body" : "Added some whitespace.  It does not make sense to use strprintf() in these cases, however.\r\n",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-10T04:30:43Z",
      "diff_hunk" : "@@ -281,8 +282,11 @@ std::string HelpMessage(HelpMessageMode mode)\n     }\n     strUsage += HelpMessageOpt(\"-datadir=<dir>\", _(\"Specify data directory\"));\n     strUsage += HelpMessageOpt(\"-dbcache=<n>\", strprintf(_(\"Set database cache size in megabytes (%d to %d, default: %d)\"), nMinDbCache, nMaxDbCache, nDefaultDbCache));\n+    strUsage += HelpMessageOpt(\"-janitorinterval=<n>\", _(\"Number of seconds between each mempool janitor run (default: 10 minutes, 0=disable)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34327056",
      "id" : 34327056,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 12,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34327056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Fixed bug found by @jonasschnelli and some minor nits.\r\n\r\nWill address the @luke-jr feedback RE triggering next.\r\n",
      "created_at" : "2015-07-10T04:33:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120222453",
      "id" : 120222453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-10T04:33:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120222453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34327148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34327148"
         }
      },
      "body" : "leaning towards no, but will consider...  need a conditional inside that code block as the 0=disabled case should not trigger a message about insanity :)\r\n",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-10T04:35:20Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)\n+        PoolmanLowWater = -1;\n+    else {\n+        PoolmanLowWater = GetArg(\"-mempoollowwater\", -1);\n+        if (PoolmanLowWater < 0 || PoolmanLowWater > PoolmanHighWater)\n+            PoolmanLowWater = PoolmanHighWater / 2;\n+    }\n+\n+    // if interval too small or zero, janitor is disabled\n+    static const int janitorSaneInterval = 10;\n+    if ((janitorInterval < janitorSaneInterval) ||\n+        (PoolmanHighWater <= 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34327148",
      "id" : 34327148,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 86,
      "path" : "src/poolman.cpp",
      "position" : 87,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T04:35:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34327148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34335040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34335040"
         }
      },
      "body" : "Can the mempool be passed as a parameter to TxMempoolJanitor() instead of using main.o's global?",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-10T08:12:59Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2015 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"amount.h\"\n+#include \"main.h\"\n+#include \"poolman.h\"\n+#include \"util.h\"\n+#include \"utiltime.h\"\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34335040",
      "id" : 34335040,
      "original_commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "original_position" : 30,
      "path" : "src/poolman.cpp",
      "position" : 30,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-10T08:12:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34335040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "> @jtimon @TheBlueMatt integrating fee estimation with mempool management risks integrating wallet function with network function of the node.\r\n\r\nThis (and the estimator) are policy code. Assuming #6068 ever gets merged, I plan to:\r\n\r\n1) Turn minRelayTxFee global into a CStandardPolicy attribute (decoupling the mempool from that global, but coupling it to CPolicy [which now returns a ref to the estimator]).\r\n2) Decouple the mempool from CPolicy.\r\n\r\nIn fact I've already done this, but it is bitrotten.\r\nIf the new globals introduced here were attributes of the estimator my plan would probably be easier to execute.\r\nIf #6068 gets merged, this can be moved to policy/policy instead of policy/fees, whatever makes more sense. At some point we need to stop producing new policy-related globals...\r\n\r\n@morcos may be interested in this PR too.",
      "created_at" : "2015-07-10T08:17:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120287415",
      "id" : 120287415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-10T08:17:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120287415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jgarzik I saw some of your conversation with @pstratem on -dev IRC last night.  \r\nI now agree with you that expiration by age makes the most sense.  But I wonder if there is an edge case where somehow the mempool is able to be flooded quickly with mostly low fee transactions that will cause recent (but still oldest) high fee transactions to get booted.  Perhaps an age check could trigger booting by fees as well..\r\n\r\nRegardless, I think its important to keep the mempool sorted by fees.  Fee estimation is badly in need of an improvement which would let it walk the mempool to see how many blocks worth of transactions are already in queue with higher fees.  This is the only way to reasonably respond to momentary spikes in transaction volume.  What do you think about using #6331 as a framework to add these other improvements...\r\n\r\n",
      "created_at" : "2015-07-10T11:16:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#issuecomment-120387395",
      "id" : 120387395,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6402",
      "updated_at" : "2015-07-10T11:16:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120387395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34406990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34406990"
         }
      },
      "body" : "@jgarzik Suppose highwater and max_blocksize are 1MB, and transaction flow is exactly 1MB/10min.  Whenever you get a slow block, you're going end up raising minrelayfee.  So 0 is too low a minimum ... it needs to be high enough that the adjustment is not triggered for reasonably slow blocks.",
      "commit_id" : "6c449bdcfe73526f09df8f3ad581f49467f7b2dd",
      "created_at" : "2015-07-11T00:31:50Z",
      "diff_hunk" : "@@ -0,0 +1,96 @@\n+\n+#include <algorithm>\n+#include <vector>\n+#include \"poolman.h\"\n+#include \"main.h\"\n+#include \"util.h\"\n+#include \"amount.h\"\n+#include \"utiltime.h\"\n+\n+using namespace std;\n+\n+static int64_t PoolmanLowWater, PoolmanHighWater;\n+static bool janitorInit = false;\n+static bool floatingFee = false;\n+static CFeeRate origTxFee;\n+\n+void TxMempoolJanitor()\n+{\n+    int64_t nStart = GetTimeMillis();\n+\n+    // remember original minimum tx fee\n+    if (!janitorInit) {\n+        janitorInit = true;\n+        origTxFee = ::minRelayTxFee;\n+    }\n+\n+    // query mempool stats\n+    unsigned long totalTx = mempool.size();\n+    int64_t totalSize = mempool.GetTotalTxSize();\n+\n+    // if below low water, disable janitor\n+    if (totalSize < PoolmanLowWater || totalTx < 2) {\n+        if (floatingFee) {\n+            floatingFee = false;\n+            ::minRelayTxFee = origTxFee;\n+        }\n+        LogPrint(\"mempool\", \"mempool level low, run complete,  %dms\\n\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // if below high water, no more work.  floating fee might be active.\n+    if ((int64_t)mempool.GetTotalTxSize() < PoolmanHighWater) {\n+        LogPrint(\"mempool\", \"mempool level %s, run complete,  %dms\\n\",\n+                 floatingFee ? \"draining\" : \"adequate\",\n+                 GetTimeMillis() - nStart);\n+        return;\n+    }\n+\n+    // we are above high water.  float relay fee in response.\n+    floatingFee = true;\n+\n+    // get sorted list of fees in mempool\n+    vector<CFeeRate> vfees;\n+    mempool.queryFees(vfees);\n+    std::sort(vfees.begin(), vfees.end());\n+    std::reverse(vfees.begin(), vfees.end());\n+    vfees.resize(vfees.size() / 2);\n+\n+    // set relay fee to lowest rate of top half of mempool\n+    ::minRelayTxFee = vfees.back();\n+\n+    LogPrint(\"mempool\", \"mempool janitor run complete, fee rate %s, %dms\\n\",\n+             ::minRelayTxFee.ToString(),\n+             GetTimeMillis() - nStart);\n+}\n+\n+void InitTxMempoolJanitor(CScheduler& scheduler)\n+{\n+    // mempool janitor execution interval.  default interval: 10 min\n+    int janitorInterval = GetArg(\"-janitorinterval\", (60 * 10));\n+\n+    // mempool janitor low water, high water marks\n+    PoolmanHighWater = GetArg(\"-mempoolhighwater\", 0);\n+    if (PoolmanHighWater <= 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6402#discussion_r34406990",
      "id" : 34406990,
      "original_commit_id" : "e459798a3c94e43c40325403d648ef1ec4031888",
      "original_position" : 75,
      "path" : "src/poolman.cpp",
      "position" : 76,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6402",
      "updated_at" : "2015-07-11T00:34:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34406990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   }
]
