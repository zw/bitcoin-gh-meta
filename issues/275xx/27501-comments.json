[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/27501#pullrequestreview-1394327087), [stickies-v](https://github.com/bitcoin/bitcoin/pull/27501#pullrequestreview-1395462615) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27464](https://github.com/bitcoin/bitcoin/pull/27464) (fuzz: re-enable prioritisetransaction & analyzepsbt RPC by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-20T15:01:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#issuecomment-1516488500",
      "id" : 1516488500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27501",
      "node_id" : "IC_kwDOABII585aY8c0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516488500/reactions"
      },
      "updated_at" : "2023-04-21T10:15:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516488500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172733241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172733241"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\r\n```\r\n\r\nnit",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:05:17Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172733241",
      "id" : 1172733241,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5n05",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 916,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394217946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172733241/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172733241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172737216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172737216"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Won't this need mempool.cs to ensure an atomic result? Otherwise you may get nonsense back on a data race, like a parent missing from the mempool, when the child is in the mempool, no?",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:08:21Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172737216",
      "id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5ozA",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394217946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172737216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172737216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172747649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172747649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes good point. Will add a lock-already-held `exists` and put this all under `LOCK(mempool.cs)`",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:16:29Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172747649",
      "id" : 1172747649,
      "in_reply_to_id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5rWB",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394239870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172747649/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172747649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172748986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172748986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, or would it be better to have `CTxMemPool::GetPrioritisationMap` take the lock and create a map from txid to pair<fee, bool>?\r\nedit: doing this one",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:17:36Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172748986",
      "id" : 1172748986,
      "in_reply_to_id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5rq6",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394242045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172748986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:41:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172748986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172792521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172792521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:52:04Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172792521",
      "id" : 1172792521,
      "in_reply_to_id" : 1172733241,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F52TJ",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 916,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394306674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172792521/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:52:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172792521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172799613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172799613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:57:53Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172799613",
      "id" : 1172799613,
      "in_reply_to_id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F54B9",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394317134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172799613/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:57:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172799613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172806194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172806194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "clang-format new code (only if you retouch)",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T16:03:26Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta_exists_pair] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta_exists_pair.first));\n+            result_inner.pushKV(\"in-mempool\", delta_exists_pair.second);\n+            rpc_result.pushKV(txid.GetHex(), result_inner);\n+        }\n+        return rpc_result;\n+},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172806194",
      "id" : 1172806194,
      "line" : 944,
      "node_id" : "PRRC_kwDOABII585F55oy",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 944,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 35,
      "pull_request_review_id" : 1394327087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172806194/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T16:12:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172806194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172814908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172814908"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        result.try_emplace(txid, delta, in_mempool);\r\n```\r\n\r\nnit: `try_emplace` should avoid duplicate and unneeded (move) constructor calls? Also, it is shorter.",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T16:11:16Z",
      "diff_hunk" : "@@ -889,6 +894,18 @@ void CTxMemPool::ClearPrioritisation(const uint256& hash)\n     mapDeltas.erase(hash);\n }\n \n+std::map<uint256, std::pair<CAmount, bool>> CTxMemPool::GetPrioritisationMap() const\n+{\n+    AssertLockNotHeld(cs);\n+    LOCK(cs);\n+    std::map<uint256, std::pair<CAmount, bool>> result;\n+    for (const auto& [txid, delta] : mapDeltas) {\n+        const bool in_mempool{mapTx.count(txid) != 0};\n+        result.emplace(std::make_pair(txid, std::make_pair(delta, in_mempool)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172814908",
      "id" : 1172814908,
      "line" : 904,
      "node_id" : "PRRC_kwDOABII585F57w8",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 904,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 26,
      "pull_request_review_id" : 1394327087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172814908/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T16:12:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172814908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe add a short description for what  `mapDeltas` is to the PR description under \"motivation / background\"? afaict `mapDeltas` also doesn't have any code documentation.",
      "created_at" : "2023-04-20T16:11:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#issuecomment-1516600484",
      "id" : 1516600484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27501",
      "node_id" : "IC_kwDOABII585aZXyk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516600484/reactions"
      },
      "updated_at" : "2023-04-20T16:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516600484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173574801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173574801"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by txid\",\r\n```",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-21T09:48:16Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173574801",
      "id" : 1173574801,
      "line" : 919,
      "node_id" : "PRRC_kwDOABII585F81SR",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 919,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 10,
      "pull_request_review_id" : 1395462615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173574801/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-21T10:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173574801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173597419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173597419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Slight rephrasing suggestion:\r\n```suggestion\r\n    /** Return a map of all entries in mapDeltas with as value their fee delta and whether the transaction is present in the mempoool. */\r\n```",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-21T10:12:45Z",
      "diff_hunk" : "@@ -515,6 +515,8 @@ class CTxMemPool\n     void PrioritiseTransaction(const uint256& hash, const CAmount& nFeeDelta);\n     void ApplyDelta(const uint256& hash, CAmount &nFeeDelta) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     void ClearPrioritisation(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    /** Return a copy of mapDeltas in which values include fee delta and whether the transaction is present in the mempoool. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173597419",
      "id" : 1173597419,
      "line" : 518,
      "node_id" : "PRRC_kwDOABII585F86zr",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 518,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 4,
      "pull_request_review_id" : 1395462615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173597419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-21T10:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173597419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-04-21T12:45:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#issuecomment-1517783284",
      "id" : 1517783284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27501",
      "node_id" : "IC_kwDOABII585ad4j0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517783284/reactions"
      },
      "updated_at" : "2023-04-21T12:45:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517783284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1174424310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174424310"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 2b04a58972e18ffd06535ad2778547db7426b05d \"[rpc] add getprioritisationmap\"\r\n\r\nnit: saying that this RPC \"Returns a map of all fee deltas in memory pool\" might be a  bit confusing for users because you can run `prioritisetransaction` even if a tx is not yet in the mempool. Perhaps the following would be better:\r\n```suggestion\r\n        \"Returns a map of all user-created fee deltas by txid, and whether the tx is present in mempool.\",",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-22T14:43:26Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1174424310",
      "id" : 1174424310,
      "line" : 916,
      "node_id" : "PRRC_kwDOABII585GAEr2",
      "original_commit_id" : "2b04a58972e18ffd06535ad2778547db7426b05d",
      "original_line" : 916,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 7,
      "pull_request_review_id" : 1396747574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174424310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-22T15:03:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174424310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183878715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183878715"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Makes sense, taken",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T15:47:52Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183878715",
      "id" : 1183878715,
      "in_reply_to_id" : 1174424310,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GkI47",
      "original_commit_id" : "2b04a58972e18ffd06535ad2778547db7426b05d",
      "original_line" : 916,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1411212761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183878715/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T15:54:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183878715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183878971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183878971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T15:48:01Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183878971",
      "id" : 1183878971,
      "in_reply_to_id" : 1173574801,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GkI87",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 919,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1411212761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183878971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T15:54:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183878971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183879477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183879477"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Brilliant, done",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T15:48:21Z",
      "diff_hunk" : "@@ -889,6 +894,18 @@ void CTxMemPool::ClearPrioritisation(const uint256& hash)\n     mapDeltas.erase(hash);\n }\n \n+std::map<uint256, std::pair<CAmount, bool>> CTxMemPool::GetPrioritisationMap() const\n+{\n+    AssertLockNotHeld(cs);\n+    LOCK(cs);\n+    std::map<uint256, std::pair<CAmount, bool>> result;\n+    for (const auto& [txid, delta] : mapDeltas) {\n+        const bool in_mempool{mapTx.count(txid) != 0};\n+        result.emplace(std::make_pair(txid, std::make_pair(delta, in_mempool)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183879477",
      "id" : 1183879477,
      "in_reply_to_id" : 1172814908,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GkJE1",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 904,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1411212761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183879477/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T15:54:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183879477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183879659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183879659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T15:48:29Z",
      "diff_hunk" : "@@ -515,6 +515,8 @@ class CTxMemPool\n     void PrioritiseTransaction(const uint256& hash, const CAmount& nFeeDelta);\n     void ApplyDelta(const uint256& hash, CAmount &nFeeDelta) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     void ClearPrioritisation(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    /** Return a copy of mapDeltas in which values include fee delta and whether the transaction is present in the mempoool. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183879659",
      "id" : 1183879659,
      "in_reply_to_id" : 1173597419,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GkJHr",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 518,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 1411212761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183879659/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T15:54:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183879659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183886938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183886938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T15:54:23Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta_exists_pair] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta_exists_pair.first));\n+            result_inner.pushKV(\"in-mempool\", delta_exists_pair.second);\n+            rpc_result.pushKV(txid.GetHex(), result_inner);\n+        }\n+        return rpc_result;\n+},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1183886938",
      "id" : 1183886938,
      "in_reply_to_id" : 1172806194,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GkK5a",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 944,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1411212761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183886938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T15:54:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183886938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184370245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184370245"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "tiny nit: should keep the list alphabetically sorted (that is, add the new RPC between \"getpeerinfo\" and \"getrawmempool\")",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T22:37:47Z",
      "diff_hunk" : "@@ -127,6 +127,7 @@ const std::vector<std::string> RPC_COMMANDS_SAFE_FOR_FUZZING{\n     \"getmempoolancestors\",\n     \"getmempooldescendants\",\n     \"getmempoolentry\",\n+    \"getprioritisationmap\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184370245",
      "id" : 1184370245,
      "line" : 130,
      "node_id" : "PRRC_kwDOABII585GmA5F",
      "original_commit_id" : "ec179560a51edaf296745f02bacf6e1eb872ef8d",
      "original_line" : 130,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/rpc.cpp",
      "position" : 4,
      "pull_request_review_id" : 1412001811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184370245/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T23:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184370245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184372400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184372400"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, could get rid of extra variable:\r\n```suggestion\r\n            for (const auto& [txid, delta_exists_pair] : mempool.GetPrioritisationMap()) {\r\n```",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T22:40:15Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all user-created (see prioritisetransaction) fee deltas by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by txid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+        {\n+            NodeContext& node = EnsureAnyNodeContext(request.context);\n+            CTxMemPool& mempool = EnsureMemPool(node);\n+            UniValue rpc_result{UniValue::VOBJ};\n+            const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+            for (const auto& [txid, delta_exists_pair] : prioritisation_map) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184372400",
      "id" : 1184372400,
      "line" : 937,
      "node_id" : "PRRC_kwDOABII585GmBaw",
      "original_commit_id" : "ec179560a51edaf296745f02bacf6e1eb872ef8d",
      "original_line" : 937,
      "original_position" : 28,
      "original_start_line" : 936,
      "path" : "src/rpc/mempool.cpp",
      "position" : 28,
      "pull_request_review_id" : 1412001811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184372400/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 936,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-03T23:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184372400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184382264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184382264"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `COIN` is defined in messages.py and should be imported from there",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-03T22:54:52Z",
      "diff_hunk" : "@@ -11,14 +11,15 @@\n \"\"\"\n \n from datetime import timedelta\n+from decimal import Decimal\n \n from test_framework.messages import DEFAULT_MEMPOOL_EXPIRY_HOURS\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n     assert_raises_rpc_error,\n )\n-from test_framework.wallet import MiniWallet\n+from test_framework.wallet import COIN, MiniWallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184382264",
      "id" : 1184382264,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585GmD04",
      "original_commit_id" : "55c513b526dd7224f42c38f881baec87dd578ca4",
      "original_line" : 22,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/mempool_expiry.py",
      "position" : 13,
      "pull_request_review_id" : 1412001811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184382264/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T23:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184382264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184496189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184496189"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`map` is a C++ concept, this is returning a json object. Wouldn't avoiding the implementation baggage by calling it something like `getprioritisetransactions` be better?",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-04T03:06:01Z",
      "diff_hunk" : "@@ -0,0 +1,3 @@\n+- A new `getprioritisationmap` RPC has been added. It returns a map of all fee deltas created by the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184496189",
      "id" : 1184496189,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585Gmfo9",
      "original_commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-27501.md",
      "position" : 1,
      "pull_request_review_id" : 1412201117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184496189/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T03:55:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184496189",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184502562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184502562"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Having `struct delta_info { uint256 txid, CAmount delta, bool in_mempool }` and returning a `vector<delta_info>` might make this a little quicker (using `reserve()` upfront would avoid memory allocations on each iteration).",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-04T03:14:35Z",
      "diff_hunk" : "@@ -890,6 +895,18 @@ void CTxMemPool::ClearPrioritisation(const uint256& hash)\n     mapDeltas.erase(hash);\n }\n \n+std::map<uint256, std::pair<CAmount, bool>> CTxMemPool::GetPrioritisationMap() const\n+{\n+    AssertLockNotHeld(cs);\n+    LOCK(cs);\n+    std::map<uint256, std::pair<CAmount, bool>> result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184502562",
      "id" : 1184502562,
      "line" : 902,
      "node_id" : "PRRC_kwDOABII585GmhMi",
      "original_commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "original_line" : 902,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 23,
      "pull_request_review_id" : 1412201117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184502562/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T03:55:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184502562",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184508118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184508118"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't these messages be returned as an RPC result?\r\n\r\nShouldn't the message here also show the resulting total `delta`, and perhaps whether the tx was already in the mempool (`nTransactionsUpdated > 0`)?",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-04T03:26:34Z",
      "diff_hunk" : "@@ -870,8 +870,13 @@ void CTxMemPool::PrioritiseTransaction(const uint256& hash, const CAmount& nFeeD\n             }\n             ++nTransactionsUpdated;\n         }\n+        if (delta == 0) {\n+            mapDeltas.erase(hash);\n+            LogPrintf(\"PrioritiseTransaction: %s delta cleared\\n\", hash.ToString());\n+        } else {\n+            LogPrintf(\"PrioritiseTransaction: %s fee += %s\\n\", hash.ToString(), FormatMoney(nFeeDelta));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184508118",
      "id" : 1184508118,
      "line" : 877,
      "node_id" : "PRRC_kwDOABII585GmijW",
      "original_commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "original_line" : 877,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 8,
      "pull_request_review_id" : 1412201117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184508118/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T03:55:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184508118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184510850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184510850"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These should be `\"fee_delta\"` and `\"in_mempool\"` -- hyphens are annoying because they often get interpreted as a subtraction, so it's easier to say `jq .[].fee_delta` than `jq .[].\"fee-delta\"`. Also more consistent with other code (cf #24528).",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-04T03:33:51Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all user-created (see prioritisetransaction) fee deltas by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by txid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184510850",
      "id" : 1184510850,
      "line" : 923,
      "node_id" : "PRRC_kwDOABII585GmjOC",
      "original_commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "original_line" : 923,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 14,
      "pull_request_review_id" : 1412201117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184510850/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T03:55:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184510850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184514467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184514467"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"transaction txid\" is redundant here",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-04T03:43:14Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all user-created (see prioritisetransaction) fee deltas by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by txid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184514467",
      "id" : 1184514467,
      "line" : 921,
      "node_id" : "PRRC_kwDOABII585GmkGj",
      "original_commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "original_line" : 921,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 12,
      "pull_request_review_id" : 1412201117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184514467/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T03:55:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184514467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184516693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184516693"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're already looking up the tx here, so you could use `find()` instead and on success also return the total modified fee.",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-04T03:50:07Z",
      "diff_hunk" : "@@ -890,6 +895,18 @@ void CTxMemPool::ClearPrioritisation(const uint256& hash)\n     mapDeltas.erase(hash);\n }\n \n+std::map<uint256, std::pair<CAmount, bool>> CTxMemPool::GetPrioritisationMap() const\n+{\n+    AssertLockNotHeld(cs);\n+    LOCK(cs);\n+    std::map<uint256, std::pair<CAmount, bool>> result;\n+    for (const auto& [txid, delta] : mapDeltas) {\n+        const bool in_mempool{mapTx.count(txid) != 0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184516693",
      "id" : 1184516693,
      "line" : 904,
      "node_id" : "PRRC_kwDOABII585GmkpV",
      "original_commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "original_line" : 904,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 25,
      "pull_request_review_id" : 1412201117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184516693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T03:55:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184516693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184518158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184518158"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you have txindex enabled, you could lookup the txid of any `in-mempool: false` transactions in the txindex here, and, if found, calculate how many confirmations the tx has, and report that. That seems like it would be fairly useful, though not sure it's actually worth the effort (compared to writing a script that just calls `getrawtransaction $txid 1 | jq .confirmations`).",
      "commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "created_at" : "2023-05-04T03:54:50Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all user-created (see prioritisetransaction) fee deltas by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by txid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+        {\n+            NodeContext& node = EnsureAnyNodeContext(request.context);\n+            CTxMemPool& mempool = EnsureMemPool(node);\n+            UniValue rpc_result{UniValue::VOBJ};\n+            const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+            for (const auto& [txid, delta_exists_pair] : prioritisation_map) {\n+                UniValue result_inner{UniValue::VOBJ};\n+                result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta_exists_pair.first));\n+                result_inner.pushKV(\"in-mempool\", delta_exists_pair.second);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1184518158",
      "id" : 1184518158,
      "line" : 940,
      "node_id" : "PRRC_kwDOABII585GmlAO",
      "original_commit_id" : "ab47d8bc1daa8821df445acded5a7e3cf2d6b05a",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 31,
      "pull_request_review_id" : 1412201117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184518158/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T03:55:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184518158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
