[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517861239), [kristapsk](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517878136), [MaxHillebrand](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517885182), [mzumsande](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1518004494), [ajtowns](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1523087063), [RandyMcMillan](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1525684935), [brunoerg](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1526013801), [amitiuttarwar](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1525672113), [0xB10C](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1528893509), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1742700208) |\n| Approach NACK | [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1659618783) |\n| Stale ACK | [pinheadmz](https://github.com/bitcoin/bitcoin/pull/27509#pullrequestreview-1555409244) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28222](https://github.com/bitcoin/bitcoin/pull/28222) (Use shared_ptr for CNode inside CConnman by willcl-ark)\n* [#28170](https://github.com/bitcoin/bitcoin/pull/28170) (p2p: adaptive connections services flags by furszy)\n* [#28107](https://github.com/bitcoin/bitcoin/pull/28107) (util: Type-safe transaction identifiers by dergoegge)\n* [#28043](https://github.com/bitcoin/bitcoin/pull/28043) (fuzz: Test headers pre-sync through p2p interface by dergoegge)\n* [#27837](https://github.com/bitcoin/bitcoin/pull/27837) (net: introduce block tracker to retry to download blocks after failure by furszy)\n* [#27826](https://github.com/bitcoin/bitcoin/pull/27826) (validation: log which peer sent us a header by Sjors)\n* [#27675](https://github.com/bitcoin/bitcoin/pull/27675) (p2p: Drop m_recently_announced_invs bloom filter by ajtowns)\n* [#27539](https://github.com/bitcoin/bitcoin/pull/27539) (init: Fixes for file descriptor accounting by Empact)\n* [#27407](https://github.com/bitcoin/bitcoin/pull/27407) (net, refactor: Privatise CNode send queue by dergoegge)\n* [#27213](https://github.com/bitcoin/bitcoin/pull/27213) (p2p: Diversify automatic outbound connections with respect to networks by amitiuttarwar)\n* [#27114](https://github.com/bitcoin/bitcoin/pull/27114) (p2p: Allow whitelisting outgoing connections by brunoerg)\n* [#26697](https://github.com/bitcoin/bitcoin/pull/26697) (logging: use bitset for categories by LarryRuane)\n* [#26621](https://github.com/bitcoin/bitcoin/pull/26621) (refactor: Continue moving application data from CNode to Peer by dergoegge)\n* [#25832](https://github.com/bitcoin/bitcoin/pull/25832) (tracing: network connection tracepoints by 0xB10C)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25284](https://github.com/bitcoin/bitcoin/pull/25284) (net: Use serialization parameters for CAddress serialization by MarcoFalke)\n* [#25268](https://github.com/bitcoin/bitcoin/pull/25268) (refactor: Introduce EvictionManager by dergoegge)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-21T13:39:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517851104",
      "id" : 1517851104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeJHg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517851104/reactions"
      },
      "updated_at" : "2023-10-02T09:37:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517851104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK - cool!\r\n\r\nNot sure about \"only\" relaying to Tor and I2P but seems useful as an option.\r\n\r\n> after handshake is completed one local transaction is pushed to the peer and the connection is closed\r\n\r\nhttps://github.com/bitcoin/bitcoin/issues/4432 comes to mind",
      "created_at" : "2023-04-21T13:47:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517861239",
      "id" : 1517861239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeLl3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517861239/reactions"
      },
      "updated_at" : "2023-04-21T13:50:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517861239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-04-21T13:58:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517878136",
      "id" : 1517878136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aePt4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517878136/reactions"
      },
      "updated_at" : "2023-04-21T13:58:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517878136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK",
      "created_at" : "2023-04-21T14:03:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517885182",
      "id" : 1517885182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeRb-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517885182/reactions"
      },
      "updated_at" : "2023-04-21T14:03:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517885182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/30683012?v=4",
         "events_url" : "https://api.github.com/users/MaxHillebrand/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MaxHillebrand/followers",
         "following_url" : "https://api.github.com/users/MaxHillebrand/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MaxHillebrand/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MaxHillebrand",
         "id" : 30683012,
         "login" : "MaxHillebrand",
         "node_id" : "MDQ6VXNlcjMwNjgzMDEy",
         "organizations_url" : "https://api.github.com/users/MaxHillebrand/orgs",
         "received_events_url" : "https://api.github.com/users/MaxHillebrand/received_events",
         "repos_url" : "https://api.github.com/users/MaxHillebrand/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MaxHillebrand/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MaxHillebrand/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MaxHillebrand"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looking at the current implementation, I am not sure how useful this is going to be, if the transaction is sent along with the potentially uniquely identifying UA comment, or other fingerprints in the version message. Maybe it makes sense to define a static version message, similar to how the tor browser replaces headers with constants?",
      "created_at" : "2023-04-21T14:06:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517890871",
      "id" : 1517890871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeS03",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517890871/reactions"
      },
      "updated_at" : "2023-04-21T14:06:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517890871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke Good idea! Perhaps it's worth mimicking `bitcoin-submittx` (https://github.com/laanwj/bitcoin-submittx/blob/master/bitcoin-submittx#L28) ?",
      "created_at" : "2023-04-21T14:10:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517896418",
      "id" : 1517896418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeULi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517896418/reactions"
      },
      "updated_at" : "2023-04-21T14:10:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517896418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Looking at the current implementation, I am not sure how useful this is going to be, if the transaction is sent along with the potentially uniquely identifying UA comment, or other fingerprints in the version message. Maybe it makes sense to define a static version message, similar to how the tor browser replaces headers with constants?\r\n\r\nOr it could randomize it, from the list of different version strings.",
      "created_at" : "2023-04-21T14:16:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517904089",
      "id" : 1517904089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeWDZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517904089/reactions"
      },
      "updated_at" : "2023-04-21T14:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517904089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "One shot connections + immediate tx broadcast without inv,getdata exchange leaks that the tx is likely being broadcast for the first time (easy to censor the tx as the receiver).\r\n\r\nPerhaps it is worth combining this with https://github.com/bitcoin/bitcoin/pull/27213 and instead of one-shot connections we broadcast only to existing selected connections on these privacy networks. Our own transactions would then still benefit from being broadcast along side other transactions.",
      "created_at" : "2023-04-21T14:21:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517911046",
      "id" : 1517911046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeXwG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517911046/reactions"
      },
      "updated_at" : "2023-04-21T14:22:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517911046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Not sure if this should be the default or an optional mode (in some cases, a faster and more reliable transmission may be more important than privacy).\r\n\r\nIt might also be helpful to combine this with some heuristics that the tx percolated through the network: \r\nFor example, require that 2 of your regular full outbound connections  (that you didn't send it to ) have inv'ed the tx back to you - otherwise try again after some time.\r\n",
      "created_at" : "2023-04-21T15:31:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1518004494",
      "id" : 1518004494,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aeukO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518004494/reactions"
      },
      "updated_at" : "2023-04-21T15:47:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518004494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> potentially uniquely identifying UA comment, or other fingerprints in the version message\r\n\r\nadded to the TODO in the OP\r\n\r\n> One shot connections + immediate tx broadcast without inv,getdata exchange leaks that the tx is likely being broadcast for the first time (easy to censor the tx as the receiver).\r\n\r\nYes. I was thinking its probably ok to broadcast to a few peers, not just one. And if they blackhole it, then the code will retry. We can retry more aggressively if it keeps being blackholed. I think it is ok to assume that there are some honest nodes in our addrman.\r\n\r\n> Perhaps it is worth combining this with https://github.com/bitcoin/bitcoin/pull/27213 and instead of one-shot connections we broadcast only to existing selected connections on these privacy networks.\r\n\r\nThere are two aspects of this:\r\n1. Linking a bitcoin transaction to IP address/geolocation. Broadcasting to long-lived Tor/I2P connections solves this (modulo other issues like linking Tor nodes with IP addresses).\r\n2. Linking one bitcoin transaction with another bitcoin transaction that otherwise are unrelated. To solve/mitigate this we need to send each transaction over its individual connection and that connection to not be linkable to other connections.\r\n\r\n> Not sure if this should be the default or an optional mode\r\n\r\nRight, also assuming there will be bugs/unexpected things - maybe have an option to enable/disable this. Hardest would be to introduce it without an option to disable it. Softest approach would be: 1. introduce under an option with default off, 2. in next version flip the default to on (if it seems to be working well)\r\n\r\n> It might also be helpful to combine this with some heuristics that the tx percolated through the network:\r\nFor example, require that 2 of your regular full outbound connections (that you didn't send it to ) have inv'ed the tx back to you - otherwise try again after some time.\r\n\r\nI actually changed the behavior to do something like that in 512077bb8805eacb671eabcf9d62463a2a6e6a39 `net_processing: relay local transactions via the SENSITIVE_RELAY mechanism` in this PR: see where `RemoveUnbroadcastTx()` was called before / is called now. Maybe that deserves a separate commit. Before we would be ok as long as we pushed the tx to the peer. Now we wait until we receive an `INV` about that tx from somebody. There is some room for improvement - added in the TODO in the OP.",
      "created_at" : "2023-04-22T06:51:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1518536516",
      "id" : 1518536516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585agwdE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518536516/reactions"
      },
      "updated_at" : "2023-04-22T06:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518536516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that in the suggested approach we might reveal information by _not_ inv'ing our own tx to others.\r\nIf a spy is connected to each node, we might send the tx to them first currently (master), but with the PR, if we are now the only node that never inv's the tx to them at all (provided that all other nodes do that eventually with the flooding mechanism) that would equally identify us as the source.",
      "created_at" : "2023-04-22T13:59:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1518666764",
      "id" : 1518666764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585ahQQM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518666764/reactions"
      },
      "updated_at" : "2023-04-22T14:17:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518666764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande, right, ideally, after the initial broadcast via the short-lived connection, the node should behave as if it does not know the tx:\r\n* before it gets `INV` for that tx, exclude it from `GETDATA` and `MEMPOOL` replies\r\n* if it gets `INV` for that tx, request the entire tx via `GETDATA`\r\n* broadcast to others",
      "created_at" : "2023-04-23T09:34:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1519011804",
      "id" : 1519011804,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585aikfc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1519011804/reactions"
      },
      "updated_at" : "2023-04-23T09:34:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1519011804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nMight be good to have some way of being able to configure where to connect to for sensitive relay, defaulting to tor/i2p, but so that you could perhaps enable specific ipv4/ipv6 addresses as well, particularly for testing purposes.",
      "created_at" : "2023-04-26T09:26:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1523087063",
      "id" : 1523087063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585ayHbX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523087063/reactions"
      },
      "updated_at" : "2023-04-26T09:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523087063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "concept ACK \r\n\r\na high level question: the privacy benefit comes from the guarantees of using the altnets - the lifecycle of the connection is expected to reveal that the tx is an initial broadcast. if a spy is able to reliably fingerprint a node between networks, this mechanism could potentially degrade privacy. could it be worthwhile to mitigate this by occasionally broadcast non-wallet txs via the same short-lived connections, or broadcast a couple additional txs over the same connection? obv some big tradeoffs, just want to consider the possibility. even if we are able to ensure no leaks _now_, it is difficult to guarantee this over time of developing the project. \r",
      "created_at" : "2023-04-27T13:11:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1525672113",
      "id" : 1525672113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585a7-ix",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525672113/reactions"
      },
      "updated_at" : "2023-04-28T18:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525672113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK ",
      "created_at" : "2023-04-27T13:19:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1525684935",
      "id" : 1525684935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585a8BrH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525684935/reactions"
      },
      "updated_at" : "2023-04-27T13:19:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525684935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/152159?v=4",
         "events_url" : "https://api.github.com/users/RandyMcMillan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RandyMcMillan/followers",
         "following_url" : "https://api.github.com/users/RandyMcMillan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RandyMcMillan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RandyMcMillan",
         "id" : 152159,
         "login" : "RandyMcMillan",
         "node_id" : "MDQ6VXNlcjE1MjE1OQ==",
         "organizations_url" : "https://api.github.com/users/RandyMcMillan/orgs",
         "received_events_url" : "https://api.github.com/users/RandyMcMillan/received_events",
         "repos_url" : "https://api.github.com/users/RandyMcMillan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RandyMcMillan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RandyMcMillan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RandyMcMillan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Disagree with:\n\nopened regardless of max connections limits\n\nThe connection should be established after another tor/i2p connection is dropped - this way the connection appears to be just another connection - nothing special about it.",
      "created_at" : "2023-04-27T13:31:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1525701626",
      "id" : 1525701626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585a8Fv6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525701626/reactions"
      },
      "updated_at" : "2023-04-27T13:31:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525701626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/152159?v=4",
         "events_url" : "https://api.github.com/users/RandyMcMillan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RandyMcMillan/followers",
         "following_url" : "https://api.github.com/users/RandyMcMillan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RandyMcMillan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RandyMcMillan",
         "id" : 152159,
         "login" : "RandyMcMillan",
         "node_id" : "MDQ6VXNlcjE1MjE1OQ==",
         "organizations_url" : "https://api.github.com/users/RandyMcMillan/orgs",
         "received_events_url" : "https://api.github.com/users/RandyMcMillan/received_events",
         "repos_url" : "https://api.github.com/users/RandyMcMillan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RandyMcMillan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RandyMcMillan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RandyMcMillan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It may also be useful to randomize the duration of the connection? \n\nAdditionally - padding the connection with dummy txs during its lifecycle may help obfuscate the real payload? ",
      "created_at" : "2023-04-27T13:39:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1525715201",
      "id" : 1525715201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585a8JEB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525715201/reactions"
      },
      "updated_at" : "2023-04-27T13:39:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525715201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/152159?v=4",
         "events_url" : "https://api.github.com/users/RandyMcMillan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RandyMcMillan/followers",
         "following_url" : "https://api.github.com/users/RandyMcMillan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RandyMcMillan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RandyMcMillan",
         "id" : 152159,
         "login" : "RandyMcMillan",
         "node_id" : "MDQ6VXNlcjE1MjE1OQ==",
         "organizations_url" : "https://api.github.com/users/RandyMcMillan/orgs",
         "received_events_url" : "https://api.github.com/users/RandyMcMillan/received_events",
         "repos_url" : "https://api.github.com/users/RandyMcMillan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RandyMcMillan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RandyMcMillan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RandyMcMillan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-04-27T16:40:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1526013801",
      "id" : 1526013801,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585a9R9p",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1526013801/reactions"
      },
      "updated_at" : "2023-04-27T16:40:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1526013801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> One shot connections + immediate tx broadcast without inv,getdata exchange leaks that the tx is likely being broadcast for the first time (easy to censor the tx as the receiver).\r\n\r\nI agree. My main concern is about how to ensure the transaction has not been censored. It seems easy for an attacker to identify someone opened a connection just to relay its own transaction.\r\n\r\n> Now we wait until we receive an INV about that tx from somebody\r\n\r\nJust to clarify: We would open the short-lived connection to relay our own transaction and close it right after and then, we wait until we receive an INV about that tx from somebody, if not, we would try to do it (open a new short-lived conn...) all over again?",
      "created_at" : "2023-04-28T16:06:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1527780479",
      "id" : 1527780479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585bEBR_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1527780479/reactions"
      },
      "updated_at" : "2023-04-28T16:06:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1527780479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK!",
      "created_at" : "2023-04-29T23:15:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1528893509",
      "id" : 1528893509,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585bIRBF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1528893509/reactions"
      },
      "updated_at" : "2023-04-29T23:15:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1528893509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> We could wait for more than one INV, from peers that we have selected (outbound) and that are specifically not the ones we broadcasted to (via short-lived connection).\r\n\r\nIdeally, if outbound has clearnet connections, we would resume normal operation IFF one of those connections INV's it. This reduces risk of sybil influencing the node.\r\n\r\n",
      "created_at" : "2023-05-04T13:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1534767675",
      "id" : 1534767675,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585berI7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1534767675/reactions"
      },
      "updated_at" : "2023-05-04T13:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1534767675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1186579724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1186579724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Rather than doing this, it might make more sense to have simplified relay logic be to send the messages:\r\n\r\n * VERSION\r\n * [after receiving VERSION] VERACK\r\n * [after receiving VERACK] INV\r\n * [after receiving GETDATA] TX\r\n * PING\r\n * [after receiving PONG] disconnect\r\n\r\n?",
      "commit_id" : "512077bb8805eacb671eabcf9d62463a2a6e6a39",
      "created_at" : "2023-05-06T01:35:40Z",
      "diff_hunk" : "@@ -377,6 +377,8 @@ class CNode\n     /** Offset inside the first vSendMsg already sent */\n     size_t nSendOffset GUARDED_BY(cs_vSend){0};\n     uint64_t nSendBytes GUARDED_BY(cs_vSend){0};\n+    /** Disconnect after this or more bytes have been written to the socket. */\n+    std::optional<uint64_t> m_disconnect_after_send_bytes GUARDED_BY(cs_vSend);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1186579724",
      "id" : 1186579724,
      "line" : 381,
      "node_id" : "PRRC_kwDOABII585GucUM",
      "original_commit_id" : "2f3f5203f2e6bd9a1ac45fe7ae53503bda807e21",
      "original_line" : 381,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_review_id" : 1415616055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1186579724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-06T01:35:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1186579724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1192301612"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192301612"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, and maybe also send `wtxidrelay`. Any reason not to send `TX` directly and avoid the `INV`, like below?\r\n\r\n* VERSION\r\n* [after receiving VERSION] WTXIDRELAY VERACK\r\n* [after receiving VERACK] TX\r\n* PING\r\n* [after receiving PONG] disconnect",
      "commit_id" : "512077bb8805eacb671eabcf9d62463a2a6e6a39",
      "created_at" : "2023-05-12T12:29:56Z",
      "diff_hunk" : "@@ -377,6 +377,8 @@ class CNode\n     /** Offset inside the first vSendMsg already sent */\n     size_t nSendOffset GUARDED_BY(cs_vSend){0};\n     uint64_t nSendBytes GUARDED_BY(cs_vSend){0};\n+    /** Disconnect after this or more bytes have been written to the socket. */\n+    std::optional<uint64_t> m_disconnect_after_send_bytes GUARDED_BY(cs_vSend);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1192301612",
      "id" : 1192301612,
      "in_reply_to_id" : 1186579724,
      "line" : 381,
      "node_id" : "PRRC_kwDOABII585HERQs",
      "original_commit_id" : "2f3f5203f2e6bd9a1ac45fe7ae53503bda807e21",
      "original_line" : 381,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_review_id" : 1424412189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192301612/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-12T12:29:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192301612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks all for the feedback!\r\n\r\n> Just to clarify: We would open the short-lived connection to relay our own transaction and close it right after and then, we wait until we receive an INV about that tx from somebody, if not, we would try to do it (open a new short-lived conn...) all over again?\r\n\r\nYes. But we may as well send to a few peers at the same time, then wait. And, I am not sure, maybe if it does not work for a long time, then fall back to the existent mechanism?\r\n\r\nThe worst that can happen is if our addrman is filled with malicious Tor peers that blackhole such initial announcements. But even if 90% of them are blackholes, then after a dozen attempts we should eventually send to a honest node which will propagate it to the network. Attempts are cheap and don't reveal any of the identity of the sender.\r\n",
      "created_at" : "2023-05-12T12:41:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1545683197",
      "id" : 1545683197,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585cIUD9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545683197/reactions"
      },
      "updated_at" : "2023-05-12T12:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545683197",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1192502249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192502249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Any reason not to send `TX` directly and avoid the `INV`, like below?\r\n\r\nIt has been suggested to stop processing unrequested TXs messages, see #21224. While that didn't make it, the idea is still floating around. If bitcoin core itself started relying on unrequested TX msgs being processed, that would probably kill it once for all. \r\nMaybe that's ok, but we should make sure that there aren't alternative clients that would ignore unrequested TXs.",
      "commit_id" : "512077bb8805eacb671eabcf9d62463a2a6e6a39",
      "created_at" : "2023-05-12T15:13:16Z",
      "diff_hunk" : "@@ -377,6 +377,8 @@ class CNode\n     /** Offset inside the first vSendMsg already sent */\n     size_t nSendOffset GUARDED_BY(cs_vSend){0};\n     uint64_t nSendBytes GUARDED_BY(cs_vSend){0};\n+    /** Disconnect after this or more bytes have been written to the socket. */\n+    std::optional<uint64_t> m_disconnect_after_send_bytes GUARDED_BY(cs_vSend);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1192502249",
      "id" : 1192502249,
      "in_reply_to_id" : 1186579724,
      "line" : 381,
      "node_id" : "PRRC_kwDOABII585HFCPp",
      "original_commit_id" : "2f3f5203f2e6bd9a1ac45fe7ae53503bda807e21",
      "original_line" : 381,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_review_id" : 1424708843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192502249/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-12T15:13:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192502249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1192851862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192851862"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also, if you send the `INV` first and wait for a request to send the actual tx, you might be a little more confident that the peer you connected to is really relaying txs, not just gathering statistics.\r\n\r\nI was thinking that you could send a fixed `VERSION` string and no feature messages (`WTXIDRELAY`, `SENDADDRV2`, etc), as a way of minimising how identifiable your node is versus other clients doing sensitive-relay. (I don't think you can have a larger anonymity set than that, since \"send a single tx and close the connection\" seems pretty distinct)",
      "commit_id" : "512077bb8805eacb671eabcf9d62463a2a6e6a39",
      "created_at" : "2023-05-12T22:58:06Z",
      "diff_hunk" : "@@ -377,6 +377,8 @@ class CNode\n     /** Offset inside the first vSendMsg already sent */\n     size_t nSendOffset GUARDED_BY(cs_vSend){0};\n     uint64_t nSendBytes GUARDED_BY(cs_vSend){0};\n+    /** Disconnect after this or more bytes have been written to the socket. */\n+    std::optional<uint64_t> m_disconnect_after_send_bytes GUARDED_BY(cs_vSend);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1192851862",
      "id" : 1192851862,
      "in_reply_to_id" : 1186579724,
      "line" : 381,
      "node_id" : "PRRC_kwDOABII585HGXmW",
      "original_commit_id" : "2f3f5203f2e6bd9a1ac45fe7ae53503bda807e21",
      "original_line" : 381,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_review_id" : 1425238233,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192851862/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-12T22:58:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192851862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1195027764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195027764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We don't accept transactions while in IBD, so sending an INV first might be an easy way to catch that condition too. Checking that we're on the same tip, and respecting feefilter might also catch those cases, and be worth doing anyway though.",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-05-16T11:34:10Z",
      "diff_hunk" : "@@ -377,6 +377,8 @@ class CNode\n     /** Offset inside the first vSendMsg already sent */\n     size_t nSendOffset GUARDED_BY(cs_vSend){0};\n     uint64_t nSendBytes GUARDED_BY(cs_vSend){0};\n+    /** Disconnect after this or more bytes have been written to the socket. */\n+    std::optional<uint64_t> m_disconnect_after_send_bytes GUARDED_BY(cs_vSend);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1195027764",
      "id" : 1195027764,
      "in_reply_to_id" : 1186579724,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HOq00",
      "original_commit_id" : "2f3f5203f2e6bd9a1ac45fe7ae53503bda807e21",
      "original_line" : 381,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1428366641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195027764/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T11:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195027764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1212835700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212835700"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> we should make sure that there aren't alternative clients that would ignore unrequested TXs\r\n\r\nThere is a precedent: from https://developer.bitcoin.org/reference/p2p_networking.html#tx\r\n\r\n> [BitcoinJ](http://bitcoinj.github.io/) will send a [âtxâ message](https://developer.bitcoin.org/reference/p2p_networking.html#tx) unsolicited for transactions it originates\r\n\r\n",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T09:05:32Z",
      "diff_hunk" : "@@ -377,6 +377,8 @@ class CNode\n     /** Offset inside the first vSendMsg already sent */\n     size_t nSendOffset GUARDED_BY(cs_vSend){0};\n     uint64_t nSendBytes GUARDED_BY(cs_vSend){0};\n+    /** Disconnect after this or more bytes have been written to the socket. */\n+    std::optional<uint64_t> m_disconnect_after_send_bytes GUARDED_BY(cs_vSend);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1212835700",
      "id" : 1212835700,
      "in_reply_to_id" : 1186579724,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ISmd0",
      "original_commit_id" : "2f3f5203f2e6bd9a1ac45fe7ae53503bda807e21",
      "original_line" : 381,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1454959689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212835700/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T09:05:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212835700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1212837257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212837257"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For now I kept it to send `TX` right away as this is simpler and somebody blackhole-ing the transaction is ok.",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T09:06:56Z",
      "diff_hunk" : "@@ -377,6 +377,8 @@ class CNode\n     /** Offset inside the first vSendMsg already sent */\n     size_t nSendOffset GUARDED_BY(cs_vSend){0};\n     uint64_t nSendBytes GUARDED_BY(cs_vSend){0};\n+    /** Disconnect after this or more bytes have been written to the socket. */\n+    std::optional<uint64_t> m_disconnect_after_send_bytes GUARDED_BY(cs_vSend);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1212837257",
      "id" : 1212837257,
      "in_reply_to_id" : 1186579724,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ISm2J",
      "original_commit_id" : "2f3f5203f2e6bd9a1ac45fe7ae53503bda807e21",
      "original_line" : 381,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1454962263,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212837257/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T09:06:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212837257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`>>` This is ready for review and testing `<<`\r\n\r\n> ... if the transaction is sent along with the potentially uniquely identifying UA comment, or other fingerprints in the version message. Maybe it makes sense to define a static version message ...\r\n\r\n@MarcoFalke, I went with a [completely static `VERSION` message](https://github.com/vasild/bitcoin/blob/b73810f80917dd882d6161f6892f10f8c46a8193/src/net_processing.cpp#L1439-L1446)\r\n\r\n> ... Perhaps it's worth mimicking `bitcoin-submittx`\r\n\r\n@sipa, [done](https://github.com/vasild/bitcoin/blob/b73810f80917dd882d6161f6892f10f8c46a8193/src/net_processing.cpp#L1444)\r\n\r\n> Or it could randomize it, from the list of different version strings.\r\n\r\n@kristapsk, could be, but I did not do that (yet). I think a constant suffices and is the simplest thing to do.\r\n\r\n> Not sure if this should be the default or an optional mode\r\n\r\n@mzumsande, I made it optional, guarded by a new option `-sensitiverelayowntx` which is \"off\" by default. If all goes well, we can consider flipping the default to \"on\" after one release.\r\n\r\n> It might also be helpful to combine this with some heuristics that the tx percolated through the network: For example, require that 2 of your regular full outbound connections (that you didn't send it to ) have inv'ed the tx back to you - otherwise try again after some time.\r\n\r\nThat makes sense and is a room for improvement, let me summarize:\r\n\r\n* In `master` we consider the transaction percolated through the network after we push it to a peer (no wait for `INV` from somebody else).\r\n* In this PR, currently, we want for `INV` from somebody, ask for the full transaction with `GETDATA` and after we receive it, then consider it done.\r\n\r\nI am trying to strike a balance between simplicity (too simple and maybe it will break) and robustness (requires more complexity). Now, at the cost of more complexity we can require more:\r\n* an `INV` from more than one peer.\r\n* an `INV` from IPv4, IPv6 or CJDNS peer.\r\n* an `INV` from an outbound peer.\r\n\r\nWe have to start behaving normally after we get the first `INV`, which means to relay to all peers and include the transaction in `GETDATA` and `MEMPOOL` replies. Thus to achieve any of the above, it would be necessary to split the list of \"unbroadcast\" transactions in two:\r\n1. (now) transactions that we have to send via short-lived sensitive relay connections and we hide from `GETDATA` and `MEMPOOL` and ask for the full transaction once we get `INV`\r\n2. (new list) transactions that we have to send via short-lived sensitive relay connections, but we have already received them via at least one `INV`, so include them in `GETDATA` and `MEMPOOL`\r\n\r\n> If a spy is connected to each node, we might send the tx to them first currently (master), but with the PR, if we are now the only node that never inv's the tx to them at all (provided that all other nodes do that eventually with the flooding mechanism) that would equally identify us as the source.\r\n\r\n@mzumsande, I believe that is fixed now - once we get an `INV`, we will flood it to everybody and start behaving normally.\r\n\r\n> Might be good to have some way of being able to configure where to connect to for sensitive relay, defaulting to tor/i2p, but so that you could perhaps enable specific ipv4/ipv6 addresses as well, particularly for testing purposes.\r\n\r\n@ajtowns, sensitive relay via IPv4 seems like a way to shoot yourself in the foot. I extended the testing framework a bit to have a proper functional test for this.\r\n\r\n> ... if a spy is able to reliably fingerprint a node between networks, this mechanism could potentially degrade privacy ...\r\n\r\n@amitiuttarwar, no because the spy will not be able to relate the sensitive relay connection to another connection with the transaction originator on the same network.\r\n\r\n> The connection should be established after another tor/i2p connection is dropped - this way the connection appears to be just another connection - nothing special about it.\r\n> It may also be useful to randomize the duration of the connection?\r\n> Additionally - padding the connection with dummy txs during its lifecycle may help obfuscate the real payload?\r\n\r\n@RandyMcMillan, I am not sure why another connection should be dropped. I think adding more transactions in the broadcast is going to bring little value because they will be transactions that have already propageted through the network. A spy would be able to identify which one is the unbroadcast transaction. The point here is that even that the spy knows this is initial broadcast, they can't identify the sender and the worst they can do is blackhole the transaction.\r\n\r\n> > One shot connections + immediate tx broadcast without inv,getdata exchange leaks that the tx is likely being broadcast for the first time (easy to censor the tx as the receiver).\r\n\r\n> I agree. My main concern is about how to ensure the transaction has not been censored. It seems easy for an attacker to identify someone opened a connection just to relay its own transaction.\r\n\r\n@brunoerg, Yes, that should be ok.\r\n\r\n> Ideally, if outbound has clearnet connections, we would resume normal operation IFF one of those connections INV's it. This reduces risk of sybil influencing the node.\r\n\r\n@instagibbs, Yes, see a few lines above, we would need two lists of unbroadcast transactions.\r\n",
      "created_at" : "2023-06-01T09:32:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1571690382",
      "id" : 1571690382,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585drheO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1571690382/reactions"
      },
      "updated_at" : "2023-06-01T09:32:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1571690382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1212891740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212891740"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This, together with the other change from commit 0ec7b979e7a9d4c30a97c39c2a64768d7c5662b1 `net_processing: omit unbroadcast txs from replies to GETDATA and MEMPOOL` alter the behavior even if sensitive relay is not used (e.g. disabled or Tor and I2P not reachable).\r\n\r\nI think it is beneficial in that case too, but is not the purpose of this PR to improve that. Should this be guarded by `if (UseSensitiveRelay())`?",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T09:47:53Z",
      "diff_hunk" : "@@ -5729,6 +5918,16 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (tx_relay->m_bloom_filter) {\n                             if (!tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         }\n+                        if (WITH_LOCK(m_mempool.cs, return m_mempool.IsUnbroadcastTx(GenTxid::Txid(txinfo.tx->GetHash())))) {\n+                            LogPrintLevel( /* Continued */\n+                                BCLog::SENSITIVE_RELAY,\n+                                BCLog::Level::Info,\n+                                \"Omitting INV for unbroadcast transaction (txid=%s) from MEMPOOL reply peer=%d%s\\n\",\n+                                txinfo.tx->GetHash().ToString(),\n+                                pto->GetId(),\n+                                fLogIPs ? strprintf(\", peeraddr=%s\", pto->addr.ToStringAddrPort()) : \"\");\n+                            continue;\n+                        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1212891740",
      "id" : 1212891740,
      "line" : 5930,
      "node_id" : "PRRC_kwDOABII585IS0Jc",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 5930,
      "original_position" : 519,
      "original_start_line" : 5921,
      "path" : "src/net_processing.cpp",
      "position" : 519,
      "pull_request_review_id" : 1455044242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212891740/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 5921,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-01T09:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212891740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213240959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213240959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In e310a0d285db0b82b0c201a56f92a7bfe4663226, you added these verifications, I think it would be useful if you add coverage for them in b6fd6b525d3ee4d89331dc04d86f854cb1decccd\r\n\r\nSuggestion (did it to test e310a0d285db0b82b0c201a56f92a7bfe4663226):\r\n```diff\r\ndiff --git a/test/functional/p2p_local_tx_relay.py b/test/functional/p2p_local_tx_relay.py\r\nindex 0b115352d..46215110e 100755\r\n--- a/test/functional/p2p_local_tx_relay.py\r\n+++ b/test/functional/p2p_local_tx_relay.py\r\n@@ -140,12 +140,12 @@ class P2PLocalTxRelay(BitcoinTestFramework):\r\n\r\n     def setup_nodes(self):\r\n         # Start a SOCKS5 proxy server.\r\n-        socks5_server_config = Socks5Configuration()\r\n-        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(new_p2p_index()))\r\n-        socks5_server_config.unauth = True\r\n-        socks5_server_config.auth = True\r\n+        self.socks5_server_config = Socks5Configuration()\r\n+        self.socks5_server_config.addr = (\"127.0.0.1\", p2p_port(new_p2p_index()))\r\n+        self.socks5_server_config.unauth = True\r\n+        self.socks5_server_config.auth = True\r\n\r\n-        self.socks5_server = Socks5Server(socks5_server_config)\r\n+        self.socks5_server = Socks5Server(self.socks5_server_config)\r\n         self.socks5_server.start()\r\n\r\n         ports_base = p2p_port(MAX_NODES) + 15000\r\n@@ -171,7 +171,7 @@ class P2PLocalTxRelay(BitcoinTestFramework):\r\n             [\r\n                 \"-peerbloomfilters\", # needed to test replies to MEMPOOL\r\n                 \"-sensitiverelayowntx\",\r\n-                f\"-proxy={socks5_server_config.addr[0]}:{socks5_server_config.addr[1]}\"\r\n+                f\"-proxy={self.socks5_server_config.addr[0]}:{self.socks5_server_config.addr[1]}\"\r\n             ]\r\n         ])\r\n         self.start_nodes()\r\n@@ -243,6 +243,15 @@ class P2PLocalTxRelay(BitcoinTestFramework):\r\n         self.log.info(\"Waiting for normal broadcast to another observer\")\r\n         observer_outbound.wait_for_inv([inv])\r\n\r\n+        self.log.info(\"Test an invalid usage of -sensitiverelayowntx throw an init error\")\r\n+        self.stop_node(0)\r\n+        args_errors = {\r\n+            \"Sensitive relay of own transactions requested (-sensitiverelayowntx), but none of Tor or I2P networks\r\nis reachable\": [\"-sensitiverelayowntx\"],\r\n+            \"Sensitive relay of own transactions requested (-sensitiverelayowntx), but -connect is also configured.\r\n They are incompatible because the sensitive relay needs to open a new connection to a randomly chosen Tor or I2P pe\r\ner\" : [\"-sensitiverelayowntx\", \"-connect='127.0.0.1'\", f\"-proxy={self.socks5_server_config.addr[0]}:{self.socks5_ser\r\nver_config.addr[1]}\"]\r\n+        }\r\n+        for msg, args in args_errors.items():\r\n+            node0.assert_start_raises_init_error(extra_args=args, expected_msg=f'Error: {msg}')\r\n+\r\n\r\n if __name__ == '__main__':\r\n     P2PLocalTxRelay().main()\r\n```",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T14:24:34Z",
      "diff_hunk" : "@@ -1865,6 +1866,19 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213240959",
      "id" : 1213240959,
      "line" : 1869,
      "node_id" : "PRRC_kwDOABII585IUJZ_",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 1869,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 12,
      "pull_request_review_id" : 1455611371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213240959/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T14:24:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213240959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213295906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213295906"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 31dd230738c43a529c63331eb23135e42d083e8f: At this point (creation of `open_sensitive_relay`), is there any possibility of both tor and i2p to be unreachable?",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T15:01:04Z",
      "diff_hunk" : "@@ -1650,7 +1650,25 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n             return;\n \n-        CSemaphoreGrant grant(*semOutbound);\n+        const size_t sensitive_relay_connections_to_open{m_sensitive_relay_connections_to_open.load()};\n+        const bool tor_reachable{IsReachable(NET_ONION)};\n+        const bool i2p_reachable{IsReachable(NET_I2P)};\n+        const bool open_sensitive_relay{sensitive_relay_connections_to_open > 0 &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213295906",
      "id" : 1213295906,
      "line" : 1656,
      "node_id" : "PRRC_kwDOABII585IUW0i",
      "original_commit_id" : "31dd230738c43a529c63331eb23135e42d083e8f",
      "original_line" : 1656,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 25,
      "pull_request_review_id" : 1455700161,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213295906/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T15:01:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213295906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213371595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213371595"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good observation. If both Tor and I2P are unreachable then `m_sensitive_relay_connections_to_open` should always be zero. Inside `PeerManagerImpl::ScheduleLocalTxForRelay()` `UseSensitiveRelay()` would return `false` and `m_connman.ScheduleSensitiveRelayConnections()` which increments the counter will never be called.\r\n\r\nNow, that is the logic of some code far away, in another file. I did not want to rely on it because if we enter here and both are unreachable, then it will end up in an infinite loop. An assert that at least one is reachable is the other option, but I am trying to code this \"defensively\", following @sdaftuar's comment from another PR that excessive asserts in the networking code are better avoided.",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T15:58:11Z",
      "diff_hunk" : "@@ -1650,7 +1650,25 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n             return;\n \n-        CSemaphoreGrant grant(*semOutbound);\n+        const size_t sensitive_relay_connections_to_open{m_sensitive_relay_connections_to_open.load()};\n+        const bool tor_reachable{IsReachable(NET_ONION)};\n+        const bool i2p_reachable{IsReachable(NET_I2P)};\n+        const bool open_sensitive_relay{sensitive_relay_connections_to_open > 0 &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213371595",
      "id" : 1213371595,
      "in_reply_to_id" : 1213295906,
      "line" : 1656,
      "node_id" : "PRRC_kwDOABII585IUpTL",
      "original_commit_id" : "31dd230738c43a529c63331eb23135e42d083e8f",
      "original_line" : 1656,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 25,
      "pull_request_review_id" : 1455819215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213371595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T15:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213371595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213534764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213534764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think there is no need of creating a global variable like `g_p2p_index`. We could do something like:\r\n```diff\r\ndiff --git a/test/functional/p2p_local_tx_relay.py b/test/functional/p2p_local_tx_relay.py\r\nindex 0b115352d..9f4c6aaa5 100755\r\n--- a/test/functional/p2p_local_tx_relay.py\r\n+++ b/test/functional/p2p_local_tx_relay.py\r\n@@ -36,12 +36,6 @@ MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\r\n MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\r\n SENSITIVE_RELAY_NUM_BROADCAST_PER_TX = 5\r\n \r\n-g_p2p_index = None\r\n-def new_p2p_index():\r\n-    global g_p2p_index\r\n-    g_p2p_index += 1\r\n-    return g_p2p_index\r\n-\r\n # Fill addrman with these addresses. Must have enough Tor addresses, so that even\r\n # if all 10 default connections are opened to a Tor address (!?) there must be more\r\n # for sensitive relays.\r\n@@ -135,13 +129,16 @@ class P2PLocalTxRelay(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n         self.disable_autoconnect = False\r\n         self.num_nodes = 1\r\n-        global g_p2p_index\r\n-        g_p2p_index = self.num_nodes - 1\r\n+        self.g_p2p_index = self.num_nodes - 1\r\n+\r\n+    def new_p2p_index(self):\r\n+        self.g_p2p_index += 1\r\n+        return self.g_p2p_index\r\n \r\n     def setup_nodes(self):\r\n         # Start a SOCKS5 proxy server.\r\n         socks5_server_config = Socks5Configuration()\r\n-        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(new_p2p_index()))\r\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.new_p2p_index()))\r\n         socks5_server_config.unauth = True\r\n         socks5_server_config.auth = True\r\n```",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T18:35:03Z",
      "diff_hunk" : "@@ -0,0 +1,248 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when sensitive relay is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (node0)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS)\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The sensitive relay TX recipients (SENSITIVE_RELAY_NUM_BROADCAST_PER_TX):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< observer_inbound\n+\"\"\"\n+\n+from test_framework.p2p import P2PDataStore, P2PInterface, P2P_SERVICES\n+from test_framework.messages import msg_getdata, msg_inv, msg_mempool, CInv, MSG_WTX\n+from test_framework.socks5 import Socks5Configuration, Socks5Server\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal, MAX_NODES, p2p_port\n+from test_framework.wallet import MiniWallet\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+SENSITIVE_RELAY_NUM_BROADCAST_PER_TX = 5\n+\n+g_p2p_index = None\n+def new_p2p_index():\n+    global g_p2p_index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213534764",
      "id" : 1213534764,
      "line" : 41,
      "node_id" : "PRRC_kwDOABII585IVRIs",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 41,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/p2p_local_tx_relay.py",
      "position" : 41,
      "pull_request_review_id" : 1456079399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213534764/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T18:35:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213534764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213614742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213614742"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I suppose it bypass the `maxconnection`, does it? If so, it worths to update the `-maxconnections` mentioning it.",
      "commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "created_at" : "2023-06-01T19:53:02Z",
      "diff_hunk" : "@@ -1747,18 +1767,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         bool anchor = false;\n         bool fFeeler = false;\n \n-        // Determine what type of connection to open. Opening\n-        // BLOCK_RELAY connections to addresses from anchors.dat gets the highest\n-        // priority. Then we open OUTBOUND_FULL_RELAY priority until we\n-        // meet our full-relay capacity. Then we open BLOCK_RELAY connection\n-        // until we hit our block-relay-only peer limit.\n-        // GetTryNewOutboundPeer() gets set when a stale tip is detected, so we\n-        // try opening an additional OUTBOUND_FULL_RELAY connection. If none of\n-        // these conditions are met, check to see if it's time to try an extra\n-        // block-relay-only peer (to confirm our tip is current, see below) or the next_feeler\n-        // timer to decide if we should open a FEELER.\n-\n-        if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay)) {\n+        // Determine what type of connection to open, in order of priority:\n+        // * SENSITIVE_RELAY if needed\n+        // * BLOCK_RELAY connections to addresses from anchors.dat\n+        // * OUTBOUND_FULL_RELAY until we reach full-relay capacity\n+        // * BLOCK_RELAY until we reach block-relay-only peer limit.\n+        // * OUTBOUND_FULL_RELAY if GetTryNewOutboundPeer() is true (a stale tip is detected)\n+        // * BLOCK_RELAY if it's time to try an extra block-relay-only peer (to confirm our tip is current)\n+        // * FEELER if it's time to try a feeler\n+        // * else retry the loop (sleep a bit and start from the top of this list)\n+\n+        if (open_sensitive_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1213614742",
      "id" : 1213614742,
      "line" : 1780,
      "node_id" : "PRRC_kwDOABII585IVkqW",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 1780,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 78,
      "pull_request_review_id" : 1456206463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213614742/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T19:53:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213614742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`b6fd6b525d...92fb45b5ef`: rebase and address suggestions",
      "created_at" : "2023-06-02T09:09:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1573408760",
      "id" : 1573408760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585dyE_4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1573408760/reactions"
      },
      "updated_at" : "2023-06-02T09:09:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1573408760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214126425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214126425"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added this test, but in `feature_config_args.py` because it checks interaction between some config args. That fits better than `p2p_local_tx_relay.py`:\r\n> Test how locally submitted transactions are sent to the network when sensitive relay is used.",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T09:11:31Z",
      "diff_hunk" : "@@ -1865,6 +1866,19 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214126425",
      "id" : 1214126425,
      "in_reply_to_id" : 1213240959,
      "line" : 1869,
      "node_id" : "PRRC_kwDOABII585IXhlZ",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 1869,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 21,
      "pull_request_review_id" : 1456965293,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214126425/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T09:11:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214126425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214127166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214127166"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a comment in the code in case somebody else wonders the same.",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T09:12:16Z",
      "diff_hunk" : "@@ -1650,7 +1650,25 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n             return;\n \n-        CSemaphoreGrant grant(*semOutbound);\n+        const size_t sensitive_relay_connections_to_open{m_sensitive_relay_connections_to_open.load()};\n+        const bool tor_reachable{IsReachable(NET_ONION)};\n+        const bool i2p_reachable{IsReachable(NET_I2P)};\n+        const bool open_sensitive_relay{sensitive_relay_connections_to_open > 0 &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214127166",
      "id" : 1214127166,
      "in_reply_to_id" : 1213295906,
      "line" : 1658,
      "node_id" : "PRRC_kwDOABII585IXhw-",
      "original_commit_id" : "31dd230738c43a529c63331eb23135e42d083e8f",
      "original_line" : 1658,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 27,
      "pull_request_review_id" : 1456966396,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214127166/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T09:12:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214127166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214128768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214128768"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I removed `new_p2p_index()` because it was used in just one place. Earlier it was used also for all listeners behind the SOCKS5 proxy, but I had to stop using `p2p_port()` for that because it exceeded `MAX_NODES` (12).",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T09:13:56Z",
      "diff_hunk" : "@@ -0,0 +1,248 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when sensitive relay is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (node0)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS)\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The sensitive relay TX recipients (SENSITIVE_RELAY_NUM_BROADCAST_PER_TX):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< observer_inbound\n+\"\"\"\n+\n+from test_framework.p2p import P2PDataStore, P2PInterface, P2P_SERVICES\n+from test_framework.messages import msg_getdata, msg_inv, msg_mempool, CInv, MSG_WTX\n+from test_framework.socks5 import Socks5Configuration, Socks5Server\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal, MAX_NODES, p2p_port\n+from test_framework.wallet import MiniWallet\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+SENSITIVE_RELAY_NUM_BROADCAST_PER_TX = 5\n+\n+g_p2p_index = None\n+def new_p2p_index():\n+    global g_p2p_index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214128768",
      "id" : 1214128768,
      "in_reply_to_id" : 1213534764,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IXiKA",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 41,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/p2p_local_tx_relay.py",
      "position" : null,
      "pull_request_review_id" : 1456968958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214128768/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T09:13:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214128768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214131440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214131440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes. That is a bit hidden/implicit in the creation of the grant, in `master`:\r\n\r\n```cpp\r\nCSemaphoreGrant grant(*semOutbound);\r\n```\r\n\r\nthis would hang if there are too many connections, waiting for a free slot to be available (somebody to disconnect).\r\n\r\nAdded a mention to it in the description of `-maxconnections`.",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T09:16:41Z",
      "diff_hunk" : "@@ -1747,18 +1767,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         bool anchor = false;\n         bool fFeeler = false;\n \n-        // Determine what type of connection to open. Opening\n-        // BLOCK_RELAY connections to addresses from anchors.dat gets the highest\n-        // priority. Then we open OUTBOUND_FULL_RELAY priority until we\n-        // meet our full-relay capacity. Then we open BLOCK_RELAY connection\n-        // until we hit our block-relay-only peer limit.\n-        // GetTryNewOutboundPeer() gets set when a stale tip is detected, so we\n-        // try opening an additional OUTBOUND_FULL_RELAY connection. If none of\n-        // these conditions are met, check to see if it's time to try an extra\n-        // block-relay-only peer (to confirm our tip is current, see below) or the next_feeler\n-        // timer to decide if we should open a FEELER.\n-\n-        if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay)) {\n+        // Determine what type of connection to open, in order of priority:\n+        // * SENSITIVE_RELAY if needed\n+        // * BLOCK_RELAY connections to addresses from anchors.dat\n+        // * OUTBOUND_FULL_RELAY until we reach full-relay capacity\n+        // * BLOCK_RELAY until we reach block-relay-only peer limit.\n+        // * OUTBOUND_FULL_RELAY if GetTryNewOutboundPeer() is true (a stale tip is detected)\n+        // * BLOCK_RELAY if it's time to try an extra block-relay-only peer (to confirm our tip is current)\n+        // * FEELER if it's time to try a feeler\n+        // * else retry the loop (sleep a bit and start from the top of this list)\n+\n+        if (open_sensitive_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214131440",
      "id" : 1214131440,
      "in_reply_to_id" : 1213614742,
      "line" : 1782,
      "node_id" : "PRRC_kwDOABII585IXizw",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 1782,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 80,
      "pull_request_review_id" : 1456973222,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214131440/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T09:16:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214131440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214671917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214671917"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why use a funny value here instead of our actual subver? I'm guessing it's for extra anonymity? Could there be any downsides though, like nodes that refuse connections to certain agents?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T18:11:10Z",
      "diff_hunk" : "@@ -1422,26 +1429,53 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    m_connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, addr_you, // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CService(), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay));\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsSensitiveRelayConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214671917",
      "id" : 1214671917,
      "line" : 1444,
      "node_id" : "PRRC_kwDOABII585IZmwt",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 1444,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1458209334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214671917/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214671917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214675802"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214675802"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this extra ping needed for sensitive connections ?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T18:16:18Z",
      "diff_hunk" : "@@ -3515,6 +3614,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTx(pfrom, *peer, interruptMsgProc);\n+\n+            MaybeSendPing(pfrom, *peer, GetTime<std::chrono::microseconds>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214675802",
      "id" : 1214675802,
      "line" : 3639,
      "node_id" : "PRRC_kwDOABII585IZnta",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 3626,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 417,
      "pull_request_review_id" : 1458209334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214675802/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214675802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214678210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214678210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why disconnect the sensitive connection on PONG? Could that ever happen before we send our tx messages out?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T18:19:29Z",
      "diff_hunk" : "@@ -4788,6 +4911,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {\n+                            pfrom.fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214678210",
      "id" : 1214678210,
      "line" : 4945,
      "node_id" : "PRRC_kwDOABII585IZoTC",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 4915,
      "original_position" : 217,
      "original_start_line" : 4914,
      "path" : "src/net_processing.cpp",
      "position" : 489,
      "pull_request_review_id" : 1458209334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214678210/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 4944,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214678210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214684616"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214684616"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was just about to ask! Wouldn't this only hurt users who don't have sensitive relay available? Maybe `MEMPOOL` requests don't matter so much but wouldn't omitting from `GETDATA` prevent our own TX from being broadcast at all?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T18:27:21Z",
      "diff_hunk" : "@@ -5729,6 +5918,16 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (tx_relay->m_bloom_filter) {\n                             if (!tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         }\n+                        if (WITH_LOCK(m_mempool.cs, return m_mempool.IsUnbroadcastTx(GenTxid::Txid(txinfo.tx->GetHash())))) {\n+                            LogPrintLevel( /* Continued */\n+                                BCLog::SENSITIVE_RELAY,\n+                                BCLog::Level::Info,\n+                                \"Omitting INV for unbroadcast transaction (txid=%s) from MEMPOOL reply peer=%d%s\\n\",\n+                                txinfo.tx->GetHash().ToString(),\n+                                pto->GetId(),\n+                                fLogIPs ? strprintf(\", peeraddr=%s\", pto->addr.ToStringAddrPort()) : \"\");\n+                            continue;\n+                        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214684616",
      "id" : 1214684616,
      "in_reply_to_id" : 1212891740,
      "line" : 5930,
      "node_id" : "PRRC_kwDOABII585IZp3I",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 5930,
      "original_position" : 519,
      "original_start_line" : 5921,
      "path" : "src/net_processing.cpp",
      "position" : 519,
      "pull_request_review_id" : 1458209334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214684616/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 5921,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214684616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214690639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214690639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just so I understand: this change is required because with the PR we wouldn't send our own TX in response to a `MEMPOOL` message, so you quickly spin up a dummy peer to send the TX to us first. Then we can assert that it was relayed to `fitler_peer` ?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T18:35:05Z",
      "diff_hunk" : "@@ -136,13 +141,23 @@ def test_msg_mempool(self):\n         filter_peer = P2PBloomFilter()\n \n         self.log.debug(\"Create a tx relevant to the peer before connecting\")\n-        txid = self.wallet.send_to(from_node=self.nodes[0], scriptPubKey=filter_peer.watch_script_pubkey, amount=9 * COIN)[\"txid\"]\n+\n+        amount = 9 * COIN\n+        fee = 1000\n+        tx = self.wallet.create_self_transfer(fee_rate=0)[\"tx\"]\n+        assert_greater_than_or_equal(tx.vout[0].nValue, amount + fee)\n+        tx.vout[0].nValue -= (amount + fee)\n+        tx.vout.append(CTxOut(amount, filter_peer.watch_script_pubkey))\n+        tx.rehash()\n+\n+        tx_sender = self.nodes[0].add_p2p_connection(P2PInterface())\n+        tx_sender.send_message(msg_tx(tx))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214690639",
      "id" : 1214690639,
      "line" : 154,
      "node_id" : "PRRC_kwDOABII585IZrVP",
      "original_commit_id" : "d2cb1585e331641bc7f2ae89de196eb8d663fd84",
      "original_line" : 154,
      "original_position" : 41,
      "original_start_line" : 153,
      "path" : "test/functional/p2p_filter.py",
      "position" : 41,
      "pull_request_review_id" : 1458209334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214690639/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 153,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214690639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214696791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214696791"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: don't we usually do this kind of logic in one line?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T18:43:34Z",
      "diff_hunk" : "@@ -2078,6 +2078,13 @@ void PeerManagerImpl::BlockChecked(const CBlock& block, const BlockValidationSta\n \n bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid)\n {\n+    if (UseSensitiveRelay()) {\n+        LOCK(m_mempool.cs);\n+        if (m_mempool.IsUnbroadcastTx(gtxid)) {\n+            return false;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214696791",
      "id" : 1214696791,
      "line" : 2085,
      "node_id" : "PRRC_kwDOABII585IZs1X",
      "original_commit_id" : "da000ed0a67bca3f1e5765eab4300bcb636bcab8",
      "original_line" : 2085,
      "original_position" : 8,
      "original_start_line" : 2083,
      "path" : "src/net_processing.cpp",
      "position" : 141,
      "pull_request_review_id" : 1458209334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214696791/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2083,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214696791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214698071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214698071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Super cool idea! Is there common chance for failure here though? This relies on a chain of peers from the sensitive relay node back to us that haven't seen the tx yet.",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T18:45:21Z",
      "diff_hunk" : "@@ -4210,6 +4219,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         m_txrequest.ReceivedResponse(pfrom.GetId(), txid);\n         if (tx.HasWitness()) m_txrequest.ReceivedResponse(pfrom.GetId(), wtxid);\n \n+        if (UseSensitiveRelay() && m_mempool.RemoveUnbroadcastTx(txid)) {\n+            LogPrintLevel( /* Continued */\n+                BCLog::SENSITIVE_RELAY,\n+                BCLog::Level::Info,\n+                \"Received own transaction (txid=%s) from the network from peer=%d%s; \"\n+                \"stopping sensitive broadcast and broadcasting it to everybody as if it is not our transaction\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214698071",
      "id" : 1214698071,
      "line" : 4227,
      "node_id" : "PRRC_kwDOABII585IZtJX",
      "original_commit_id" : "da000ed0a67bca3f1e5765eab4300bcb636bcab8",
      "original_line" : 4227,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 451,
      "pull_request_review_id" : 1458209334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214698071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214698071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214738570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214738570"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(I just realized I answered my own question from https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214675802)\r\n\r\nBut still, don't we also send automatic PINGs ? Could that result in premature disconnection?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T19:20:47Z",
      "diff_hunk" : "@@ -4788,6 +4911,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {\n+                            pfrom.fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214738570",
      "id" : 1214738570,
      "in_reply_to_id" : 1214678210,
      "line" : 4945,
      "node_id" : "PRRC_kwDOABII585IZ3CK",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 4915,
      "original_position" : 217,
      "original_start_line" : 4914,
      "path" : "src/net_processing.cpp",
      "position" : 489,
      "pull_request_review_id" : 1458360554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214738570/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 4944,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-02T19:20:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214738570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Correct me please if I'm missing anything. Considering:\r\n```\r\n- Once we get an INV from somebody, request the transaction with GETDATA, as if we didn't have it before.\r\n\r\n- After we receive the full transaction as a TX message, in reply to our GETDATA request, only then consider the transaction has propagated through the network and remove it from the unbroadcast list.\r\n```\r\nand\r\n```\r\nWe could wait for more than one INV, from peers that we have selected (outbound) and that are specifically not the ones we broadcasted to (via short-lived connection)\r\n```\r\nIn case my node doesn't accept inbound connections and supports clearnet + tor, however, my addrman has majority ipv4/6 addresses, seems like there is a chance of not having any connection with a Tor peer, so it would make harder to know that my transaction has been propagated? Seems like #27213 could boost this feature?",
      "created_at" : "2023-06-02T20:53:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1574302283",
      "id" : 1574302283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585d1fJL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1574302283/reactions"
      },
      "updated_at" : "2023-06-02T20:53:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1574302283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214831451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214831451"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems for extra anonymity, but I have a similar doubt, couldn't I make easier for someone to censor us?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T20:55:32Z",
      "diff_hunk" : "@@ -1422,26 +1429,53 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    m_connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, addr_you, // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CService(), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay));\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsSensitiveRelayConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214831451",
      "id" : 1214831451,
      "in_reply_to_id" : 1214671917,
      "line" : 1444,
      "node_id" : "PRRC_kwDOABII585IaNtb",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 1444,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1458467993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214831451/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T20:55:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214831451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214832859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214832859"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unless we want to sybil the network and fake long-term connections, it's obvious what this connection will be about? Just retry with new peers until someone honest propagates it?",
      "commit_id" : "92fb45b5ef8560bc7a37223b096e625fa9f284d0",
      "created_at" : "2023-06-02T20:57:07Z",
      "diff_hunk" : "@@ -1422,26 +1429,53 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    m_connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, addr_you, // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CService(), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay));\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsSensitiveRelayConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214832859",
      "id" : 1214832859,
      "in_reply_to_id" : 1214671917,
      "line" : 1444,
      "node_id" : "PRRC_kwDOABII585IaODb",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 1444,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1458469430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214832859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T20:57:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214832859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`92fb45b5ef...c9acf32606`: make the python linter happy and avoid a race in the test - `wait_for_connect()` could time out as if a connection never arrived even if it did. This happens if the peer is connects  and disconnects before `wait_for_connect()` is called.\r\n\r\n`c9acf32606...2eae1f8f13`: make the python linter happy (even more)",
      "created_at" : "2023-06-05T04:43:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1576033040",
      "id" : 1576033040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585d8FsQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576033040/reactions"
      },
      "updated_at" : "2023-06-05T04:45:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576033040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218012577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218012577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For `GETDATA`, this only applies to transactions which we have not `INV`ed to the peer. Otherwise `INV`ed transactions will be sent via:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/f4a8269dfc144cc918570bdb870aa5143a11c1fe/src/net_processing.cpp#L2307",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T12:35:48Z",
      "diff_hunk" : "@@ -5729,6 +5918,16 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (tx_relay->m_bloom_filter) {\n                             if (!tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         }\n+                        if (WITH_LOCK(m_mempool.cs, return m_mempool.IsUnbroadcastTx(GenTxid::Txid(txinfo.tx->GetHash())))) {\n+                            LogPrintLevel( /* Continued */\n+                                BCLog::SENSITIVE_RELAY,\n+                                BCLog::Level::Info,\n+                                \"Omitting INV for unbroadcast transaction (txid=%s) from MEMPOOL reply peer=%d%s\\n\",\n+                                txinfo.tx->GetHash().ToString(),\n+                                pto->GetId(),\n+                                fLogIPs ? strprintf(\", peeraddr=%s\", pto->addr.ToStringAddrPort()) : \"\");\n+                            continue;\n+                        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218012577",
      "id" : 1218012577,
      "in_reply_to_id" : 1212891740,
      "line" : 5930,
      "node_id" : "PRRC_kwDOABII585ImWWh",
      "original_commit_id" : "b6fd6b525d3ee4d89331dc04d86f854cb1decccd",
      "original_line" : 5930,
      "original_position" : 519,
      "original_start_line" : 5921,
      "path" : "src/net_processing.cpp",
      "position" : 519,
      "pull_request_review_id" : 1462433959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218012577/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 5921,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T12:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218012577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218020772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218020772"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "TLDR: @instagibbs, right! :)\r\n\r\nFirst, the problem with the user-agent string is that it can be customized which will totally reveal the identity of the sender. Next idea is to use the non-customized user-agent even if `-uacomment=` is configured. But then, why even reveal the version - whether it is 26.0 or 27.0? Right after a new release there will be few nodes that run the just-released version and thus the anonymity set will be small. So this string better be constant - either empty string or whatever other constant. `/pynode:0.0.1/` was suggested here - https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517896418",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T12:43:12Z",
      "diff_hunk" : "@@ -1422,26 +1429,53 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    m_connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, addr_you, // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CService(), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay));\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsSensitiveRelayConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218020772",
      "id" : 1218020772,
      "in_reply_to_id" : 1214671917,
      "line" : 1444,
      "node_id" : "PRRC_kwDOABII585ImYWk",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 1444,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1462448234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218020772/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T12:43:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218020772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218073603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218073603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just one ping will be send. It is needed because without it the receiving bitcoind may ignore the TX message since the sender disconnects immediately after that, see https://github.com/bitcoin/bitcoin/issues/4432. Sending a ping and waiting for pong ensures that the preceding TX message has been processed (unless somebody implements out-of-order messages processing).",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T13:26:49Z",
      "diff_hunk" : "@@ -3515,6 +3614,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTx(pfrom, *peer, interruptMsgProc);\n+\n+            MaybeSendPing(pfrom, *peer, GetTime<std::chrono::microseconds>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218073603",
      "id" : 1218073603,
      "in_reply_to_id" : 1214675802,
      "line" : 3639,
      "node_id" : "PRRC_kwDOABII585ImlQD",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 3639,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 417,
      "pull_request_review_id" : 1462540270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218073603/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T13:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218073603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218082238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218082238"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Why disconnect the sensitive connection on PONG?\r\n\r\nBecause then we assume the TX message that preceded the PING message has been processed.\r\n\r\n> Could that ever happen before we send our tx messages out?\r\n\r\nYes, if the peer sends us unsolicited PONG without us sending PING before that.\r\n\r\n> But still, don't we also send automatic PINGs?\r\n\r\nYes, and for the sensitive relay connections this should be the first PING. The point is to send TX before any PING.",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T13:32:10Z",
      "diff_hunk" : "@@ -4788,6 +4911,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {\n+                            pfrom.fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218082238",
      "id" : 1218082238,
      "in_reply_to_id" : 1214678210,
      "line" : 4945,
      "node_id" : "PRRC_kwDOABII585ImnW-",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 4945,
      "original_position" : 217,
      "original_start_line" : 4914,
      "path" : "src/net_processing.cpp",
      "position" : 489,
      "pull_request_review_id" : 1462554319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218082238/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 4944,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T13:32:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218082238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218088888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218088888"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, exactly. Before this change the test sent the transaction to the node using RPC and so it becomes locally-submitted, sensitive, unbroadcast, our own, etc transaction. With this change to the test it sends the transaction to the node via the P2P interface, so it is treated as normal, foreign, non-sensitive transaction and thus included in the MEMPOOL reply.\r\n\r\nBtw, if changes from c70da509e4224f738fa0229e1f434a854629acf2 `net_processing: omit unbroadcast txs from replies to GETDATA and MEMPOOL` are restricted only to `if (UseSensitiveRelay()) {` then this tweak to the test will not be necessary.",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T13:36:59Z",
      "diff_hunk" : "@@ -136,13 +141,23 @@ def test_msg_mempool(self):\n         filter_peer = P2PBloomFilter()\n \n         self.log.debug(\"Create a tx relevant to the peer before connecting\")\n-        txid = self.wallet.send_to(from_node=self.nodes[0], scriptPubKey=filter_peer.watch_script_pubkey, amount=9 * COIN)[\"txid\"]\n+\n+        amount = 9 * COIN\n+        fee = 1000\n+        tx = self.wallet.create_self_transfer(fee_rate=0)[\"tx\"]\n+        assert_greater_than_or_equal(tx.vout[0].nValue, amount + fee)\n+        tx.vout[0].nValue -= (amount + fee)\n+        tx.vout.append(CTxOut(amount, filter_peer.watch_script_pubkey))\n+        tx.rehash()\n+\n+        tx_sender = self.nodes[0].add_p2p_connection(P2PInterface())\n+        tx_sender.send_message(msg_tx(tx))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218088888",
      "id" : 1218088888,
      "in_reply_to_id" : 1214690639,
      "line" : 154,
      "node_id" : "PRRC_kwDOABII585Imo-4",
      "original_commit_id" : "d2cb1585e331641bc7f2ae89de196eb8d663fd84",
      "original_line" : 154,
      "original_position" : 41,
      "original_start_line" : 153,
      "path" : "test/functional/p2p_filter.py",
      "position" : 41,
      "pull_request_review_id" : 1462570773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218088888/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 153,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T13:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218088888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "would like to see an updated OP that details what changes have been made, including precisely how often these connections are being made",
      "created_at" : "2023-06-05T13:38:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1576826080",
      "id" : 1576826080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585d_HTg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576826080/reactions"
      },
      "updated_at" : "2023-06-05T13:38:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576826080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> In case my node doesn't accept inbound connections and supports clearnet + tor, however, my addrman has majority ipv4/6 addresses, seems like there is a chance of not having any connection with a Tor peer, so it would make harder to know that my transaction has been propagated?\r\n\r\n@brunoerg, Why? I couldn't follow. But anyway - as of now this PR does not wait for more than one peer to give back the transaction to us.",
      "created_at" : "2023-06-05T14:06:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1576875849",
      "id" : 1576875849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585d_TdJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576875849/reactions"
      },
      "updated_at" : "2023-06-05T14:06:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576875849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218179793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218179793"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok understood. In that case, would it make sense to be very explicit about what this connection is about? I mean user agent could essentially be \"I am going to send you one TX and then disconnect\". Additional behavior could even be encoded on the recipient side, maybe to ensure we don't disconnect prematurely ?",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T14:44:53Z",
      "diff_hunk" : "@@ -1422,26 +1429,53 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    m_connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, addr_you, // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CService(), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay));\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsSensitiveRelayConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218179793",
      "id" : 1218179793,
      "in_reply_to_id" : 1214671917,
      "line" : 1444,
      "node_id" : "PRRC_kwDOABII585Im_LR",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 1444,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1462721593,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218179793/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T14:44:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218179793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "General question about this: what will be the impact on tor/i2p nodes? (Like, resources-wise for those operators) are there even enough hidden services nodes with inbound slots to support this? In a world where all TXs are broadcast to the network through \"exit nodes\" are there any other possible drawbacks ?",
      "created_at" : "2023-06-05T14:46:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1576942166",
      "id" : 1576942166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585d_jpW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576942166/reactions"
      },
      "updated_at" : "2023-06-05T14:46:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1576942166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218267977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218267977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Yes, if the peer sends us unsolicited PONG without us sending PING before that.\r\n\r\nI don't think the peer can guess the right ping nonce reliably , can it?",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T15:46:26Z",
      "diff_hunk" : "@@ -4788,6 +4911,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {\n+                            pfrom.fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218267977",
      "id" : 1218267977,
      "in_reply_to_id" : 1214678210,
      "line" : 4945,
      "node_id" : "PRRC_kwDOABII585InUtJ",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 4945,
      "original_position" : 217,
      "original_start_line" : 4914,
      "path" : "src/net_processing.cpp",
      "position" : 489,
      "pull_request_review_id" : 1462865826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218267977/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 4944,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T15:46:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218267977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@instagibbs added some more info to the OP, but feel free to reach on `#bitcoin-core-dev` to clarify things. Once a local transaction is is received, 5 such connections will be made right away. If we still consider the transaction unbroadcast after 10-15 mins, then it will be retried (5 new connections). These 10-15 mins are how `master` does things now but I think if sensitive relay is used this can be made more aggressive and/or increase the number of peers we broadcast to. E.g. after 3 minutes broadcast to 10 peers.\r\n\r\n> General question about this: what will be the impact on tor/i2p nodes? (Like, resources-wise for those operators) are there even enough hidden services nodes with inbound slots to support this?\r\n\r\n@pinheadmz, good question. Traffic-wise - the selected recipients will receive the transaction via a short-lived connection, but even now they do receive the transaction in one way or another. The overhead is the extra handshake of the new connection. Some quick tests show, from the point of view of the tx sender: sent 180 bytes (excluding the transaction itself), received 239 bytes.\r\n\r\nInbound slots-wise: Some [back of the envelope calculation](https://en.wikipedia.org/wiki/Back-of-the-envelope_calculation):\r\n* The historical maximum for the Bitcoin network of incoming transactions has been about 10 new transactions per second, typically that is 3-4 tx/sec. Lets say `3..10` tx/sec.\r\n* Each new tx causes 5 new connections to be opened, so for one second `15..50` new connections will be opened in total in that second (`3*5..10*5`).\r\n* Lets say one short-lived connection takes `2..10` seconds. That is a moving window of `2..10` seconds.\r\n* In the next `2..10` seconds they will not be closed and so for `2..10` seconds `30..500` new connections will be opened (`2*15..10*50`).\r\n* The constant load of those `30..500` extra connections will be spread evenly amongst ~10k listening Tor or I2P nodes. So each listening Tor or I2P node will have to handle `0.003..0.05` more incoming connections.\r\n\r\n>  In a world where all TXs are broadcast to the network through \"exit nodes\" are there any other possible drawbacks ?\r\n\r\nBy \"exit nodes\" you mean the new sensitive relay mechanism and not Tor-to-IPv4 exit nodes, right? If the Tor or I2P network stops working then the Bitcoin nodes that are connected to it and have the sensitive relay enabled will not be able to broadcast their transactions. Maybe we should eventually fall back to the old relay mechanism after some time has passed in unsuccessful sensitive relay attempts.\r\n\r\nBut notice - as the author of this, I have a blind spot for its drawbacks!",
      "created_at" : "2023-06-05T16:17:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1577096803",
      "id" : 1577096803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585eAJZj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577096803/reactions"
      },
      "updated_at" : "2023-06-05T16:17:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577096803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  I think if sensitive relay is used this can be made more aggressive and/or increase the number of peers we broadcast to. E.g. after 3 minutes broadcast to 10 peers.\r\n\r\nI think for first cut matching current behavior is probably best. If Tor is being sybiled, I don't think hammering things even harder is going to fix much. Time-sensitive users should probably just avoid using this feature altogether, at least until there is some sort of fallback mechanism introduced.",
      "created_at" : "2023-06-05T16:24:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1577106769",
      "id" : 1577106769,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585eAL1R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577106769/reactions"
      },
      "updated_at" : "2023-06-05T16:24:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577106769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Tor-to-IPv4 exit nodes,\r\n\r\nI was more asking about this, not as much from a vulnerability standpoint but more like, the bottleneck created by all TXs going through a specific subset of network nodes first. I think your envelope math is reassuring though - I didn't realize there were so many Tor nodes already",
      "created_at" : "2023-06-05T17:15:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1577177916",
      "id" : 1577177916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585eAdM8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577177916/reactions"
      },
      "updated_at" : "2023-06-05T17:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577177916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218585985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218585985"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There could be a race with the `torcontrol` thread, which may set `NET_ONION` to reachable before this line is encountered or only later.",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T20:57:42Z",
      "diff_hunk" : "@@ -1865,6 +1866,19 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX)) {\n+        if (!IsReachable(NET_ONION) && !IsReachable(NET_I2P)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218585985",
      "id" : 1218585985,
      "line" : 1870,
      "node_id" : "PRRC_kwDOABII585IoiWB",
      "original_commit_id" : "f73bb4cbc4fc3b89abadc60aec18aa0b774d5791",
      "original_line" : 1870,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 22,
      "pull_request_review_id" : 1463428381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218585985/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218585985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218588419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218588419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "typo: sensitive-relay (extra \"t\")",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T20:59:51Z",
      "diff_hunk" : "@@ -451,6 +451,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         if (conn_type == \"block-relay-only\") return \"block\";\n         if (conn_type == \"manual\" || conn_type == \"feeler\") return conn_type;\n         if (conn_type == \"addr-fetch\") return \"addr\";\n+        if (conn_type == \"senstitive-relay\") return \"srelay\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218588419",
      "id" : 1218588419,
      "line" : 454,
      "node_id" : "PRRC_kwDOABII585Ioi8D",
      "original_commit_id" : "b33fd076327cd8dbeb96e7f80f86f95060c2d5f8",
      "original_line" : 454,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 4,
      "pull_request_review_id" : 1463428381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218588419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218588419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218597944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218597944"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If this bypasses `-maxconnections`,  could we run into trouble if we don't have sufficient file descriptors (see `RaiseFileDescriptorLimit()` call in init)?",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T21:12:01Z",
      "diff_hunk" : "@@ -486,7 +486,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-forcednsseed\", strprintf(\"Always query for peer addresses via DNS lookup (default: %u)\", DEFAULT_FORCEDNSSEED), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listen\", strprintf(\"Accept connections from outside (default: %u if no -proxy, -connect or -maxconnections=0)\", DEFAULT_LISTEN), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listenonion\", strprintf(\"Automatically create Tor onion service (default: %d)\", DEFAULT_LISTEN_ONION), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u.\", DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u. It does not apply to short-lived sensitive relay connections either.\", DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218597944",
      "id" : 1218597944,
      "line" : 489,
      "node_id" : "PRRC_kwDOABII585IolQ4",
      "original_commit_id" : "a35e4056e2d4df77a071a1c33e788b80fb4f3c2b",
      "original_line" : 489,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 1463428381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218597944/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218597944",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218631408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218631408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm a bit worried about this priority: What would happen if we, for some reason, aren't able to make successful sensitive relay connections (e.g. we think that we can connect to Tor but misconfigured something, or maybe we can connect but don't have any addresses for these networks in our addrman).\r\nWouldn't we try again and again (since this is the first priority and `m_sensitive_relay_connections_to_open` is never reduced) and never attempt to make an outbound connection of another type?",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-05T21:51:19Z",
      "diff_hunk" : "@@ -1749,18 +1769,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         bool anchor = false;\n         bool fFeeler = false;\n \n-        // Determine what type of connection to open. Opening\n-        // BLOCK_RELAY connections to addresses from anchors.dat gets the highest\n-        // priority. Then we open OUTBOUND_FULL_RELAY priority until we\n-        // meet our full-relay capacity. Then we open BLOCK_RELAY connection\n-        // until we hit our block-relay-only peer limit.\n-        // GetTryNewOutboundPeer() gets set when a stale tip is detected, so we\n-        // try opening an additional OUTBOUND_FULL_RELAY connection. If none of\n-        // these conditions are met, check to see if it's time to try an extra\n-        // block-relay-only peer (to confirm our tip is current, see below) or the next_feeler\n-        // timer to decide if we should open a FEELER.\n-\n-        if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay)) {\n+        // Determine what type of connection to open, in order of priority:\n+        // * SENSITIVE_RELAY if needed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218631408",
      "id" : 1218631408,
      "line" : 1773,
      "node_id" : "PRRC_kwDOABII585Iotbw",
      "original_commit_id" : "a35e4056e2d4df77a071a1c33e788b80fb4f3c2b",
      "original_line" : 1773,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 71,
      "pull_request_review_id" : 1463428381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218631408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218631408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1219111950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219111950"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The guidelines allow both and I prefer this because: https://github.com/vasild/bitcoin/wiki/if-on-the-same-line",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-06T07:51:01Z",
      "diff_hunk" : "@@ -2078,6 +2078,13 @@ void PeerManagerImpl::BlockChecked(const CBlock& block, const BlockValidationSta\n \n bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid)\n {\n+    if (UseSensitiveRelay()) {\n+        LOCK(m_mempool.cs);\n+        if (m_mempool.IsUnbroadcastTx(gtxid)) {\n+            return false;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1219111950",
      "id" : 1219111950,
      "in_reply_to_id" : 1214696791,
      "line" : 2085,
      "node_id" : "PRRC_kwDOABII585IqiwO",
      "original_commit_id" : "da000ed0a67bca3f1e5765eab4300bcb636bcab8",
      "original_line" : 2085,
      "original_position" : 8,
      "original_start_line" : 2083,
      "path" : "src/net_processing.cpp",
      "position" : 141,
      "pull_request_review_id" : 1464510532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219111950/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2083,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-06T07:51:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219111950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1219127718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219127718"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This chain of peers is desired / demanded to consider the transaction successfully propagated. Lets say we are connected to 30 peers (some inbound, some outbound). If somebody of them gets the transaction (from somebody else, not from us) he will tell us about it due to the normal flooding mechanism because he will not be aware we have it. If all our 30 peers stay silent about the transaction, it means that they did not get it which is a sign it propagated only to some part of the network or did not propagate at all.\r\n\r\nMy understanding is that normally it takes a few seconds for a transaction to reach _every node_ in the network due to the flooding mechanism.",
      "commit_id" : "2eae1f8f130a7f003726c332d82b1280c0a06f15",
      "created_at" : "2023-06-06T07:59:51Z",
      "diff_hunk" : "@@ -4210,6 +4219,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         m_txrequest.ReceivedResponse(pfrom.GetId(), txid);\n         if (tx.HasWitness()) m_txrequest.ReceivedResponse(pfrom.GetId(), wtxid);\n \n+        if (UseSensitiveRelay() && m_mempool.RemoveUnbroadcastTx(txid)) {\n+            LogPrintLevel( /* Continued */\n+                BCLog::SENSITIVE_RELAY,\n+                BCLog::Level::Info,\n+                \"Received own transaction (txid=%s) from the network from peer=%d%s; \"\n+                \"stopping sensitive broadcast and broadcasting it to everybody as if it is not our transaction\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1219127718",
      "id" : 1219127718,
      "in_reply_to_id" : 1214698071,
      "line" : 4227,
      "node_id" : "PRRC_kwDOABII585Iqmmm",
      "original_commit_id" : "da000ed0a67bca3f1e5765eab4300bcb636bcab8",
      "original_line" : 4227,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 451,
      "pull_request_review_id" : 1464531191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219127718/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-06T07:59:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219127718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Tor-to-IPv4 exit nodes,\r\n> \r\n> I was more asking about this, not as much from a vulnerability standpoint but more like, the bottleneck created by all TXs going through a specific subset of network nodes first. I think your envelope math is reassuring though - I didn't realize there were so many Tor nodes already\r\n\r\nWell, ok, we don't know how many of those Tor or I2P nodes are also connected to clearnet. For this secondary propagation (after sensitive relay has fired the transaction) however it does not matter if sensitive relay was used initially or not. The transaction will go to/from all the networks anyway due to the flooding mechanism like it happens currently.",
      "created_at" : "2023-06-06T08:12:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1578149945",
      "id" : 1578149945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585eEKg5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1578149945/reactions"
      },
      "updated_at" : "2023-06-06T08:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1578149945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`2eae1f8f13...ff88e08363`: address suggestions",
      "created_at" : "2023-06-08T14:47:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1582729266",
      "id" : 1582729266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585eVogy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1582729266/reactions"
      },
      "updated_at" : "2023-06-08T14:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1582729266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223152947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223152947"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed.",
      "commit_id" : "5fd41b9fbf38a627cee66856221d225e8c952a4d",
      "created_at" : "2023-06-08T14:47:53Z",
      "diff_hunk" : "@@ -451,6 +451,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         if (conn_type == \"block-relay-only\") return \"block\";\n         if (conn_type == \"manual\" || conn_type == \"feeler\") return conn_type;\n         if (conn_type == \"addr-fetch\") return \"addr\";\n+        if (conn_type == \"senstitive-relay\") return \"srelay\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223152947",
      "id" : 1223152947,
      "in_reply_to_id" : 1218588419,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585I59Uz",
      "original_commit_id" : "b33fd076327cd8dbeb96e7f80f86f95060c2d5f8",
      "original_line" : 454,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 1470120014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223152947/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-08T14:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223152947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223163824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223163824"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, I relaxed the condition a bit to error only if we are sure Tor is unreachable and will remain unreachable. There is still a chance that the tor control thread will not set Tor to reachable, but there is also a chance that Tor is set to reachable here, but the Tor server is down. Later at runtime we do check again the reachable networks and in general the code must work when some or all of those networks go down.",
      "commit_id" : "5fd41b9fbf38a627cee66856221d225e8c952a4d",
      "created_at" : "2023-06-08T14:53:40Z",
      "diff_hunk" : "@@ -1865,6 +1866,19 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX)) {\n+        if (!IsReachable(NET_ONION) && !IsReachable(NET_I2P)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223163824",
      "id" : 1223163824,
      "in_reply_to_id" : 1218585985,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585I5_-w",
      "original_commit_id" : "f73bb4cbc4fc3b89abadc60aec18aa0b774d5791",
      "original_line" : 1870,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1470134560,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223163824/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-08T14:53:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223163824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223171823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223171823"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes! I changed this to not try 2 consecutive sensitive relay connections. That is - after attempting one, give way to others (if any, otherwise sleep 0.5s) and only then try another sensitive relay.",
      "commit_id" : "5fd41b9fbf38a627cee66856221d225e8c952a4d",
      "created_at" : "2023-06-08T14:58:47Z",
      "diff_hunk" : "@@ -1749,18 +1769,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         bool anchor = false;\n         bool fFeeler = false;\n \n-        // Determine what type of connection to open. Opening\n-        // BLOCK_RELAY connections to addresses from anchors.dat gets the highest\n-        // priority. Then we open OUTBOUND_FULL_RELAY priority until we\n-        // meet our full-relay capacity. Then we open BLOCK_RELAY connection\n-        // until we hit our block-relay-only peer limit.\n-        // GetTryNewOutboundPeer() gets set when a stale tip is detected, so we\n-        // try opening an additional OUTBOUND_FULL_RELAY connection. If none of\n-        // these conditions are met, check to see if it's time to try an extra\n-        // block-relay-only peer (to confirm our tip is current, see below) or the next_feeler\n-        // timer to decide if we should open a FEELER.\n-\n-        if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay)) {\n+        // Determine what type of connection to open, in order of priority:\n+        // * SENSITIVE_RELAY if needed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223171823",
      "id" : 1223171823,
      "in_reply_to_id" : 1218631408,
      "line" : 1825,
      "node_id" : "PRRC_kwDOABII585I6B7v",
      "original_commit_id" : "a35e4056e2d4df77a071a1c33e788b80fb4f3c2b",
      "original_line" : 1825,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 221,
      "pull_request_review_id" : 1470147374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223171823/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-08T14:58:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223171823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223178234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223178234"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, at least I should raise the fd limit, but by how much? Should we limit the number of sensitive relay connections? I think it makes sense to try as hard as possible even if that means sometimes a temporary error of running out of file descriptors. Or is that not a good idea? I guess in some cases a node operator may submit many transactions at once to their node. What do you think would be the best approach?",
      "commit_id" : "5fd41b9fbf38a627cee66856221d225e8c952a4d",
      "created_at" : "2023-06-08T15:02:15Z",
      "diff_hunk" : "@@ -486,7 +486,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-forcednsseed\", strprintf(\"Always query for peer addresses via DNS lookup (default: %u)\", DEFAULT_FORCEDNSSEED), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listen\", strprintf(\"Accept connections from outside (default: %u if no -proxy, -connect or -maxconnections=0)\", DEFAULT_LISTEN), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listenonion\", strprintf(\"Automatically create Tor onion service (default: %d)\", DEFAULT_LISTEN_ONION), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u.\", DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u. It does not apply to short-lived sensitive relay connections either.\", DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1223178234",
      "id" : 1223178234,
      "in_reply_to_id" : 1218597944,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585I6Df6",
      "original_commit_id" : "a35e4056e2d4df77a071a1c33e788b80fb4f3c2b",
      "original_line" : 489,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1470156383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223178234/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-08T15:02:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223178234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`ff88e08363...5fd41b9fbf`: limit the maximum number of sensitive relay connections that can be opened (discussion: https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1218597944)",
      "created_at" : "2023-06-09T10:10:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1584327078",
      "id" : 1584327078,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585ebumm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584327078/reactions"
      },
      "updated_at" : "2023-06-09T10:10:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584327078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1224124709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224124709"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I put a cap on the maximum number of sensitive relay connections that can be opened. Breaking through the max open file descriptors looks like a bad idea - it would also hamper access to the filesystem, even if temporarily. I assume somebody may submit thousands of local transactions in no time.",
      "commit_id" : "5fd41b9fbf38a627cee66856221d225e8c952a4d",
      "created_at" : "2023-06-09T10:13:49Z",
      "diff_hunk" : "@@ -486,7 +486,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-forcednsseed\", strprintf(\"Always query for peer addresses via DNS lookup (default: %u)\", DEFAULT_FORCEDNSSEED), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listen\", strprintf(\"Accept connections from outside (default: %u if no -proxy, -connect or -maxconnections=0)\", DEFAULT_LISTEN), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listenonion\", strprintf(\"Automatically create Tor onion service (default: %d)\", DEFAULT_LISTEN_ONION), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u.\", DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u. It does not apply to short-lived sensitive relay connections either.\", DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1224124709",
      "id" : 1224124709,
      "in_reply_to_id" : 1218597944,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585I9qkl",
      "original_commit_id" : "a35e4056e2d4df77a071a1c33e788b80fb4f3c2b",
      "original_line" : 489,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1471667915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224124709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-09T10:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224124709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-09T18:33:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1584988312",
      "id" : 1584988312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585eeQCY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584988312/reactions"
      },
      "updated_at" : "2023-06-09T18:33:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1584988312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`5fd41b9fbf...bde055d28f`:\r\n* rebase due to conflicts\r\n* adjust the added test to expect that some non-sensitive relay connection may be opened before sensitive tx relay is complete; this is because the code was changed to be less aggressive and may open other connections even if sensitive relay ones are needed\r\n* extract a move-only change in `ThreadOpenConnections()` to a separate commit to make it easier to review (new commit: ec6f4ac210 `net: move peers counting before grant acquisition in ThreadOpenConnections()`)",
      "created_at" : "2023-06-27T08:42:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1609055465",
      "id" : 1609055465,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585f6Dzp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1609055465/reactions"
      },
      "updated_at" : "2023-06-27T08:42:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1609055465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1253796131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253796131"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This implementation of that logic doesn't seem ideal to me:\r\n\r\n * sending the TX without doing INV/GETDATA first risks having the TX be ignored as unrequested\r\n\r\n * `PushUnbroadcastTx` doesn't actually send the TX, but `MaybeSendPing` does actually send the PING, so you might get the PONG and closes the connection before the other end has actually received/processed the TX",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-06T00:50:11Z",
      "diff_hunk" : "@@ -3515,6 +3614,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTx(pfrom, *peer, interruptMsgProc);\n+\n+            MaybeSendPing(pfrom, *peer, GetTime<std::chrono::microseconds>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1253796131",
      "id" : 1253796131,
      "in_reply_to_id" : 1214675802,
      "line" : 3731,
      "node_id" : "PRRC_kwDOABII585Ku2kj",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 3731,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 417,
      "pull_request_review_id" : 1515567642,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253796131/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T00:50:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253796131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1254309734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254309734"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, yes, this is in the \"nonce match\" branch of the logic that handles PONG. So, the answer to \"Could that ever happen before we send our tx messages out?\" is just \"No\".",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-06T11:33:00Z",
      "diff_hunk" : "@@ -4788,6 +4911,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {\n+                            pfrom.fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1254309734",
      "id" : 1254309734,
      "in_reply_to_id" : 1214678210,
      "line" : 4949,
      "node_id" : "PRRC_kwDOABII585Kwz9m",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 4949,
      "original_position" : 217,
      "original_start_line" : 4914,
      "path" : "src/net_processing.cpp",
      "position" : 489,
      "pull_request_review_id" : 1516342252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254309734/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 4948,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-06T11:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254309734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1254444996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254444996"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> sending the TX without doing INV/GETDATA first risks having the TX be ignored as unrequested\r\n\r\nI thought about doing `INV` first and waiting for get data but decided to not do that for the following reasons:\r\n\r\n1. Bitcoin Core accepts unsolicited transactions. According to https://developer.bitcoin.org/reference/p2p_networking.html#tx there is already some software that sends unsolicited transactions.\r\n2. It would add complexity to the implementation.\r\n3. After `INV` we would have to wait for some time for `GETDATA`, then in some cases when the wait is too little we risk cutting the connection just before we get `GETDATA`.\r\n4. Last, but this is the most important IMO: it does not matter. There is redundancy: the transaction will be sent to more than one peer and we will retry if we don't hear back from the network about it. It is expected and is ok if some of the peers we send the transaction drops it.\r\n\r\n> `PushUnbroadcastTx` doesn't actually send the TX, but `MaybeSendPing` does actually send the PING, so you might get the PONG and closes the connection before the other end has actually received/processed the TX\r\n\r\nI don't think so. Both `PushUnbroadcastTx()` and `MaybeSendPing()` end up calling `PushMessage()` which enqueues the message in `CNode::vSendMsg`. This is done synchronously so the transaction will go before the ping. Then messages from `CNode::vSendMsg` are processed and sent in the order they were added (FIFO).\r\n",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-06T13:29:10Z",
      "diff_hunk" : "@@ -3515,6 +3614,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTx(pfrom, *peer, interruptMsgProc);\n+\n+            MaybeSendPing(pfrom, *peer, GetTime<std::chrono::microseconds>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1254444996",
      "id" : 1254444996,
      "in_reply_to_id" : 1214675802,
      "line" : 3731,
      "node_id" : "PRRC_kwDOABII585KxU_E",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 3731,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 417,
      "pull_request_review_id" : 1516556628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254444996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T13:29:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254444996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1254506653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254506653"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't think so.\r\n\r\nYou're right -- I missed seeing the call to `ProcessGetData` and assumed it wasn't picked up until the next `ProcessMessages`.",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-06T14:14:27Z",
      "diff_hunk" : "@@ -3515,6 +3614,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTx(pfrom, *peer, interruptMsgProc);\n+\n+            MaybeSendPing(pfrom, *peer, GetTime<std::chrono::microseconds>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1254506653",
      "id" : 1254506653,
      "in_reply_to_id" : 1214675802,
      "line" : 3731,
      "node_id" : "PRRC_kwDOABII585KxkCd",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 3731,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 417,
      "pull_request_review_id" : 1516655704,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254506653/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T14:14:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254506653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267244372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267244372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC this line schedules a replacement sensitive connection because the one we were passed in has the wrong services and so it gets dumped. I think this is the only line in this function that makes it apply strictly to only sensitive relays. So I wonder if that should be asserted at the top? Or could be renamed to `PushUnbroadcastTxToSensistiveRelay()`? At the very least maybe sensitive-only should be explained in the function description on L933 ?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-18T19:50:48Z",
      "diff_hunk" : "@@ -3292,6 +3367,56 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::PushUnbroadcastTx(CNode& node, Peer& peer, const std::atomic<bool>& interrupt)\n+{\n+    Peer::TxRelay* tx_relay{peer.GetTxRelay()};\n+    if (tx_relay == nullptr) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no transactions relay with this peer (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        m_connman.ScheduleSensitiveRelayConnections(1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267244372",
      "id" : 1267244372,
      "line" : 3380,
      "node_id" : "PRRC_kwDOABII585LiJ1U",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 3380,
      "original_position" : 234,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 234,
      "pull_request_review_id" : 1535806985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267244372/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-18T20:36:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267244372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267248349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267248349"
         }
      },
      "author_association" : "MEMBER",
      "body" : "wow, is this really the fastest way to get a random element from `std::set` ? funny.",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-18T19:55:45Z",
      "diff_hunk" : "@@ -3292,6 +3367,56 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::PushUnbroadcastTx(CNode& node, Peer& peer, const std::atomic<bool>& interrupt)\n+{\n+    Peer::TxRelay* tx_relay{peer.GetTxRelay()};\n+    if (tx_relay == nullptr) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no transactions relay with this peer (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        m_connman.ScheduleSensitiveRelayConnections(1);\n+        return;\n+    }\n+\n+    const auto unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+\n+    if (unbroadcast_txids.empty()) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no more sensitive transactions to \"\n+                      \"relay (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        return;\n+    }\n+\n+    // Randomly pick some transaction from unbroadcast_txids.\n+    const uint64_t n{FastRandomContext{}.randrange(unbroadcast_txids.size())};\n+    auto tx_iter = unbroadcast_txids.begin();\n+    for (uint64_t i = 0; i < n; ++i) {\n+        ++tx_iter;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267248349",
      "id" : 1267248349,
      "line" : 3402,
      "node_id" : "PRRC_kwDOABII585LiKzd",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 3402,
      "original_position" : 256,
      "original_start_line" : 3400,
      "path" : "src/net_processing.cpp",
      "position" : 256,
      "pull_request_review_id" : 1535806985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267248349/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3400,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-18T20:36:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267248349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267253028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267253028"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it make any sense here to manually set `peer.m_ping_queued = true` to guarantee (not \"maybe\") sending ping?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-18T20:01:30Z",
      "diff_hunk" : "@@ -3579,6 +3719,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTx(pfrom, *peer, interruptMsgProc);\n+\n+            MaybeSendPing(pfrom, *peer, GetTime<std::chrono::microseconds>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267253028",
      "id" : 1267253028,
      "line" : 3731,
      "node_id" : "PRRC_kwDOABII585LiL8k",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 3731,
      "original_position" : 417,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 417,
      "pull_request_review_id" : 1535806985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267253028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-18T20:36:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267253028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267276546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267276546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see `.node` used below and I don't think you really use `.requested_to_addr` anywhere after setting it below? Could this just be an array of `CAddress` or something like that?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-18T20:29:47Z",
      "diff_hunk" : "@@ -40,6 +41,16 @@ def __init__(self):\n         self.af = socket.AF_INET # Bind address family\n         self.unauth = False  # Support unauthenticated\n         self.auth = False  # Support authentication\n+        # An array of objects like:\n+        # {\n+        #     \"listen_addr\": \"127.0.0.1\"\n+        #     \"listen_port\": 28276\n+        #     \"node\": python_p2p_node,\n+        #     \"requested_to_addr\": \"the_client_asked_to_connect_to_this_addr.onion\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267276546",
      "id" : 1267276546,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII585LiRsC",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 49,
      "original_position" : 17,
      "original_start_line" : 46,
      "path" : "test/functional/test_framework/socks5.py",
      "position" : 17,
      "pull_request_review_id" : 1535806985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267276546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 46,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-18T20:36:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267276546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267277048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267277048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this guy need an `else`? Maybe raise error that a connection request was made after all destinations have been used?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-18T20:30:22Z",
      "diff_hunk" : "@@ -116,6 +127,30 @@ def handle(self):\n             cmdin = Socks5Command(cmd, atyp, addr, port, username, password)\n             self.serv.queue.put(cmdin)\n             logger.info('Proxy: %s', cmdin)\n+\n+            if self.serv.conf.destinations_used < len(self.serv.conf.destinations):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267277048",
      "id" : 1267277048,
      "line" : 131,
      "node_id" : "PRRC_kwDOABII585LiRz4",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 131,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/socks5.py",
      "position" : 30,
      "pull_request_review_id" : 1535806985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267277048/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-18T20:36:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267277048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267279962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267279962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why did you need this to support wtxid? Is that how we are verifying our TX made the round trip out and back (without being malleated)?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-18T20:33:53Z",
      "diff_hunk" : "@@ -1003,13 +1003,35 @@ size_t CTxMemPool::DynamicMemoryUsage() const {\n     return memusage::MallocUsage(sizeof(CTxMemPoolEntry) + 15 * sizeof(void*)) * mapTx.size() + memusage::DynamicUsage(mapNextTx) + memusage::DynamicUsage(mapDeltas) + memusage::DynamicUsage(vTxHashes) + cachedInnerUsage;\n }\n \n-void CTxMemPool::RemoveUnbroadcastTx(const uint256& txid, const bool unchecked) {\n+bool CTxMemPool::RemoveUnbroadcastTx(const uint256& txid, const bool unchecked) {\n     LOCK(cs);\n \n     if (m_unbroadcast_txids.erase(txid))\n     {\n         LogPrint(BCLog::MEMPOOL, \"Removed %i from set of unbroadcast txns%s\\n\", txid.GetHex(), (unchecked ? \" before confirmation that txn was sent out\" : \"\"));\n+        return true;\n+    }\n+    return false;\n+}\n+\n+bool CTxMemPool::IsUnbroadcastTx(const GenTxid& gtxid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1267279962",
      "id" : 1267279962,
      "line" : 1017,
      "node_id" : "PRRC_kwDOABII585LiSha",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 1017,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 16,
      "pull_request_review_id" : 1535806985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267279962/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-18T20:36:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267279962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1275287508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275287508"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I added some extra logs to bitcoind and ran the test, these addrs fail `IsRoutable()`. I assume these are CJDNS addresses?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-26T17:33:42Z",
      "diff_hunk" : "@@ -0,0 +1,294 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when sensitive relay is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (node0)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The sensitive relay TX recipients\n+               |   |       (SENSITIVE_RELAY_NUM_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< observer_inbound\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_getdata,\n+    msg_inv,\n+    msg_mempool,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+SENSITIVE_RELAY_NUM_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more\n+# for sensitive relays.\n+addresses = [\n+    \"1.65.195.98\",\n+    \"2.59.236.56\",\n+    \"2.83.114.20\",\n+    \"2.248.194.16\",\n+    \"5.2.154.6\",\n+    \"5.101.140.30\",\n+    \"5.128.87.126\",\n+    \"5.144.21.49\",\n+    \"5.172.132.104\",\n+    \"5.188.62.18\",\n+    \"5.200.2.180\",\n+    \"8.129.184.255\",\n+    \"8.209.105.138\",\n+    \"12.34.98.148\",\n+    \"14.199.102.151\",\n+    \"18.27.79.17\",\n+    \"18.27.124.231\",\n+    \"18.216.249.151\",\n+    \"23.88.155.58\",\n+    \"23.93.101.158\",\n+    \"[2001:19f0:1000:1db3:5400:4ff:fe56:5a8d]\",\n+    \"[2001:19f0:5:24da:3eec:efff:feb9:f36e]\",\n+    \"[2001:19f0:5:24da::]\",\n+    \"[2001:19f0:5:4535:3eec:efff:feb9:87e4]\",\n+    \"[2001:19f0:5:4535::]\",\n+    \"[2001:1bc0:c1::2000]\",\n+    \"[2001:1c04:4008:6300:8a5f:2678:114b:a660]\",\n+    \"[2001:41d0:203:3739::]\",\n+    \"[2001:41d0:203:8f49::]\",\n+    \"[2001:41d0:203:bb0a::]\",\n+    \"[2001:41d0:2:bf8f::]\",\n+    \"[2001:41d0:303:de8b::]\",\n+    \"[2001:41d0:403:3d61::]\",\n+    \"[2001:41d0:405:9600::]\",\n+    \"[2001:41d0:8:ed7f::1]\",\n+    \"[2001:41d0:a:69a2::1]\",\n+    \"[2001:41f0::62:6974:636f:696e]\",\n+    \"[2001:470:1b62::]\",\n+    \"[2001:470:1f05:43b:2831:8530:7179:5864]\",\n+    \"[2001:470:1f09:b14::11]\",\n+    \"2bqghnldu6mcug4pikzprwhtjjnsyederctvci6klcwzepnjd46ikjyd.onion\",\n+    \"4lr3w2iyyl5u5l6tosizclykf5v3smqroqdn2i4h3kq6pfbbjb2xytad.onion\",\n+    \"5g72ppm3krkorsfopcm2bi7wlv4ohhs4u4mlseymasn7g7zhdcyjpfid.onion\",\n+    \"5sbmcl4m5api5tqafi4gcckrn3y52sz5mskxf3t6iw4bp7erwiptrgqd.onion\",\n+    \"776aegl7tfhg6oiqqy76jnwrwbvcytsx2qegcgh2mjqujll4376ohlid.onion\",\n+    \"77mdte42srl42shdh2mhtjr7nf7dmedqrw6bkcdekhdvmnld6ojyyiad.onion\",\n+    \"azbpsh4arqlm6442wfimy7qr65bmha2zhgjg7wbaji6vvaug53hur2qd.onion\",\n+    \"b64xcbleqmwgq2u46bh4hegnlrzzvxntyzbmucn3zt7cssm7y4ubv3id.onion\",\n+    \"bsqbtcparrfihlwolt4xgjbf4cgqckvrvsfyvy6vhiqrnh4w6ghixoid.onion\",\n+    \"bsqbtctulf2g4jtjsdfgl2ed7qs6zz5wqx27qnyiik7laockryvszqqd.onion\",\n+    \"cwi3ekrwhig47dhhzfenr5hbvckj7fzaojygvazi2lucsenwbzwoyiqd.onion\",\n+    \"devinbtcmwkuitvxl3tfi5of4zau46ymeannkjv6fpnylkgf3q5fa3id.onion\",\n+    \"devinbtctu7uctl7hly2juu3thbgeivfnvw3ckj3phy6nyvpnx66yeyd.onion\",\n+    \"devinbtcyk643iruzfpaxw3on2jket7rbjmwygm42dmdyub3ietrbmid.onion\",\n+    \"dtql5vci4iaml4anmueftqr7bfgzqlauzfy4rc2tfgulldd3ekyijjyd.onion\",\n+    \"emzybtc25oddoa2prol2znpz2axnrg6k77xwgirmhv7igoiucddsxiad.onion\",\n+    \"emzybtc3ewh7zihpkdvuwlgxrhzcxy2p5fvjggp7ngjbxcytxvt4rjid.onion\",\n+    \"emzybtc454ewbviqnmgtgx3rgublsgkk23r4onbhidcv36wremue4kqd.onion\",\n+    \"emzybtc5bnpb2o6gh54oquiox54o4r7yn4a2wiiwzrjonlouaibm2zid.onion\",\n+    \"fpz6r5ppsakkwypjcglz6gcnwt7ytfhxskkfhzu62tnylcknh3eq6pad.onion\",\n+    \"255fhcp6ajvftnyo7bwz3an3t4a4brhopm3bamyh2iu5r3gnr2rq.b32.i2p\",\n+    \"27yrtht5b5bzom2w5ajb27najuqvuydtzb7bavlak25wkufec5mq.b32.i2p\",\n+    \"3gocb7wc4zvbmmebktet7gujccuux4ifk3kqilnxnj5wpdpqx2hq.b32.i2p\",\n+    \"4fcc23wt3hyjk3csfzcdyjz5pcwg5dzhdqgma6bch2qyiakcbboa.b32.i2p\",\n+    \"4osyqeknhx5qf3a73jeimexwclmt42cju6xdp7icja4ixxguu2hq.b32.i2p\",\n+    \"4umsi4nlmgyp4rckosg4vegd2ysljvid47zu7pqsollkaszcbpqq.b32.i2p\",\n+    \"6j2ezegd3e2e2x3o3pox335f5vxfthrrigkdrbgfbdjchm5h4awa.b32.i2p\",\n+    \"6n36ljyr55szci5ygidmxqer64qr24f4qmnymnbvgehz7qinxnla.b32.i2p\",\n+    \"72yjs6mvlby3ky6mgpvvlemmwq5pfcznrzd34jkhclgrishqdxva.b32.i2p\",\n+    \"a5qsnv3maw77mlmmzlcglu6twje6ttctd3fhpbfwcbpmewx6fczq.b32.i2p\",\n+    \"aovep2pco7v2k4rheofrgytbgk23eg22dczpsjqgqtxcqqvmxk6a.b32.i2p\",\n+    \"bitcoi656nll5hu6u7ddzrmzysdtwtnzcnrjd4rfdqbeey7dmn5a.b32.i2p\",\n+    \"brifkruhlkgrj65hffybrjrjqcgdgqs2r7siizb5b2232nruik3a.b32.i2p\",\n+    \"c4gfnttsuwqomiygupdqqqyy5y5emnk5c73hrfvatri67prd7vyq.b32.i2p\",\n+    \"day3hgxyrtwjslt54sikevbhxxs4qzo7d6vi72ipmscqtq3qmijq.b32.i2p\",\n+    \"du5kydummi23bjfp6bd7owsvrijgt7zhvxmz5h5f5spcioeoetwq.b32.i2p\",\n+    \"e55k6wu46rzp4pg5pk5npgbr3zz45bc3ihtzu2xcye5vwnzdy7pq.b32.i2p\",\n+    \"eciohu5nq7vsvwjjc52epskuk75d24iccgzmhbzrwonw6lx4gdva.b32.i2p\",\n+    \"ejlnngarmhqvune74ko7kk55xtgbz5i5ncs4vmnvjpy3l7y63xaa.b32.i2p\",\n+    \"fhzlp3xroabohnmjonu5iqazwhlbbwh5cpujvw2azcu3srqdceja.b32.i2p\",\n+    \"[fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa]\",\n+    \"[fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce]\",\n+    \"[fcdc:73ae:b1a9:1bf8:d4c2:811:a4c7:c34e]\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1275287508",
      "id" : 1275287508,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII585MA1fU",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 150,
      "original_position" : 150,
      "original_start_line" : 148,
      "path" : "test/functional/p2p_local_tx_relay.py",
      "position" : 150,
      "pull_request_review_id" : 1548267148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275287508/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 148,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-26T17:44:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275287508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1275391537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275391537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, these three are CJDNS.",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-26T19:21:19Z",
      "diff_hunk" : "@@ -0,0 +1,294 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when sensitive relay is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (node0)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The sensitive relay TX recipients\n+               |   |       (SENSITIVE_RELAY_NUM_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< observer_inbound\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_getdata,\n+    msg_inv,\n+    msg_mempool,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+SENSITIVE_RELAY_NUM_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more\n+# for sensitive relays.\n+addresses = [\n+    \"1.65.195.98\",\n+    \"2.59.236.56\",\n+    \"2.83.114.20\",\n+    \"2.248.194.16\",\n+    \"5.2.154.6\",\n+    \"5.101.140.30\",\n+    \"5.128.87.126\",\n+    \"5.144.21.49\",\n+    \"5.172.132.104\",\n+    \"5.188.62.18\",\n+    \"5.200.2.180\",\n+    \"8.129.184.255\",\n+    \"8.209.105.138\",\n+    \"12.34.98.148\",\n+    \"14.199.102.151\",\n+    \"18.27.79.17\",\n+    \"18.27.124.231\",\n+    \"18.216.249.151\",\n+    \"23.88.155.58\",\n+    \"23.93.101.158\",\n+    \"[2001:19f0:1000:1db3:5400:4ff:fe56:5a8d]\",\n+    \"[2001:19f0:5:24da:3eec:efff:feb9:f36e]\",\n+    \"[2001:19f0:5:24da::]\",\n+    \"[2001:19f0:5:4535:3eec:efff:feb9:87e4]\",\n+    \"[2001:19f0:5:4535::]\",\n+    \"[2001:1bc0:c1::2000]\",\n+    \"[2001:1c04:4008:6300:8a5f:2678:114b:a660]\",\n+    \"[2001:41d0:203:3739::]\",\n+    \"[2001:41d0:203:8f49::]\",\n+    \"[2001:41d0:203:bb0a::]\",\n+    \"[2001:41d0:2:bf8f::]\",\n+    \"[2001:41d0:303:de8b::]\",\n+    \"[2001:41d0:403:3d61::]\",\n+    \"[2001:41d0:405:9600::]\",\n+    \"[2001:41d0:8:ed7f::1]\",\n+    \"[2001:41d0:a:69a2::1]\",\n+    \"[2001:41f0::62:6974:636f:696e]\",\n+    \"[2001:470:1b62::]\",\n+    \"[2001:470:1f05:43b:2831:8530:7179:5864]\",\n+    \"[2001:470:1f09:b14::11]\",\n+    \"2bqghnldu6mcug4pikzprwhtjjnsyederctvci6klcwzepnjd46ikjyd.onion\",\n+    \"4lr3w2iyyl5u5l6tosizclykf5v3smqroqdn2i4h3kq6pfbbjb2xytad.onion\",\n+    \"5g72ppm3krkorsfopcm2bi7wlv4ohhs4u4mlseymasn7g7zhdcyjpfid.onion\",\n+    \"5sbmcl4m5api5tqafi4gcckrn3y52sz5mskxf3t6iw4bp7erwiptrgqd.onion\",\n+    \"776aegl7tfhg6oiqqy76jnwrwbvcytsx2qegcgh2mjqujll4376ohlid.onion\",\n+    \"77mdte42srl42shdh2mhtjr7nf7dmedqrw6bkcdekhdvmnld6ojyyiad.onion\",\n+    \"azbpsh4arqlm6442wfimy7qr65bmha2zhgjg7wbaji6vvaug53hur2qd.onion\",\n+    \"b64xcbleqmwgq2u46bh4hegnlrzzvxntyzbmucn3zt7cssm7y4ubv3id.onion\",\n+    \"bsqbtcparrfihlwolt4xgjbf4cgqckvrvsfyvy6vhiqrnh4w6ghixoid.onion\",\n+    \"bsqbtctulf2g4jtjsdfgl2ed7qs6zz5wqx27qnyiik7laockryvszqqd.onion\",\n+    \"cwi3ekrwhig47dhhzfenr5hbvckj7fzaojygvazi2lucsenwbzwoyiqd.onion\",\n+    \"devinbtcmwkuitvxl3tfi5of4zau46ymeannkjv6fpnylkgf3q5fa3id.onion\",\n+    \"devinbtctu7uctl7hly2juu3thbgeivfnvw3ckj3phy6nyvpnx66yeyd.onion\",\n+    \"devinbtcyk643iruzfpaxw3on2jket7rbjmwygm42dmdyub3ietrbmid.onion\",\n+    \"dtql5vci4iaml4anmueftqr7bfgzqlauzfy4rc2tfgulldd3ekyijjyd.onion\",\n+    \"emzybtc25oddoa2prol2znpz2axnrg6k77xwgirmhv7igoiucddsxiad.onion\",\n+    \"emzybtc3ewh7zihpkdvuwlgxrhzcxy2p5fvjggp7ngjbxcytxvt4rjid.onion\",\n+    \"emzybtc454ewbviqnmgtgx3rgublsgkk23r4onbhidcv36wremue4kqd.onion\",\n+    \"emzybtc5bnpb2o6gh54oquiox54o4r7yn4a2wiiwzrjonlouaibm2zid.onion\",\n+    \"fpz6r5ppsakkwypjcglz6gcnwt7ytfhxskkfhzu62tnylcknh3eq6pad.onion\",\n+    \"255fhcp6ajvftnyo7bwz3an3t4a4brhopm3bamyh2iu5r3gnr2rq.b32.i2p\",\n+    \"27yrtht5b5bzom2w5ajb27najuqvuydtzb7bavlak25wkufec5mq.b32.i2p\",\n+    \"3gocb7wc4zvbmmebktet7gujccuux4ifk3kqilnxnj5wpdpqx2hq.b32.i2p\",\n+    \"4fcc23wt3hyjk3csfzcdyjz5pcwg5dzhdqgma6bch2qyiakcbboa.b32.i2p\",\n+    \"4osyqeknhx5qf3a73jeimexwclmt42cju6xdp7icja4ixxguu2hq.b32.i2p\",\n+    \"4umsi4nlmgyp4rckosg4vegd2ysljvid47zu7pqsollkaszcbpqq.b32.i2p\",\n+    \"6j2ezegd3e2e2x3o3pox335f5vxfthrrigkdrbgfbdjchm5h4awa.b32.i2p\",\n+    \"6n36ljyr55szci5ygidmxqer64qr24f4qmnymnbvgehz7qinxnla.b32.i2p\",\n+    \"72yjs6mvlby3ky6mgpvvlemmwq5pfcznrzd34jkhclgrishqdxva.b32.i2p\",\n+    \"a5qsnv3maw77mlmmzlcglu6twje6ttctd3fhpbfwcbpmewx6fczq.b32.i2p\",\n+    \"aovep2pco7v2k4rheofrgytbgk23eg22dczpsjqgqtxcqqvmxk6a.b32.i2p\",\n+    \"bitcoi656nll5hu6u7ddzrmzysdtwtnzcnrjd4rfdqbeey7dmn5a.b32.i2p\",\n+    \"brifkruhlkgrj65hffybrjrjqcgdgqs2r7siizb5b2232nruik3a.b32.i2p\",\n+    \"c4gfnttsuwqomiygupdqqqyy5y5emnk5c73hrfvatri67prd7vyq.b32.i2p\",\n+    \"day3hgxyrtwjslt54sikevbhxxs4qzo7d6vi72ipmscqtq3qmijq.b32.i2p\",\n+    \"du5kydummi23bjfp6bd7owsvrijgt7zhvxmz5h5f5spcioeoetwq.b32.i2p\",\n+    \"e55k6wu46rzp4pg5pk5npgbr3zz45bc3ihtzu2xcye5vwnzdy7pq.b32.i2p\",\n+    \"eciohu5nq7vsvwjjc52epskuk75d24iccgzmhbzrwonw6lx4gdva.b32.i2p\",\n+    \"ejlnngarmhqvune74ko7kk55xtgbz5i5ncs4vmnvjpy3l7y63xaa.b32.i2p\",\n+    \"fhzlp3xroabohnmjonu5iqazwhlbbwh5cpujvw2azcu3srqdceja.b32.i2p\",\n+    \"[fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa]\",\n+    \"[fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce]\",\n+    \"[fcdc:73ae:b1a9:1bf8:d4c2:811:a4c7:c34e]\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1275391537",
      "id" : 1275391537,
      "in_reply_to_id" : 1275287508,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII585MBO4x",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 150,
      "original_position" : 150,
      "original_start_line" : 148,
      "path" : "test/functional/p2p_local_tx_relay.py",
      "position" : 150,
      "pull_request_review_id" : 1548440940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275391537/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 148,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-26T19:21:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275391537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1275392099"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275392099"
         }
      },
      "author_association" : "MEMBER",
      "body" : "does the test node need a config flag to route?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-26T19:22:01Z",
      "diff_hunk" : "@@ -0,0 +1,294 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when sensitive relay is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (node0)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The sensitive relay TX recipients\n+               |   |       (SENSITIVE_RELAY_NUM_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< observer_inbound\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_getdata,\n+    msg_inv,\n+    msg_mempool,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+SENSITIVE_RELAY_NUM_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more\n+# for sensitive relays.\n+addresses = [\n+    \"1.65.195.98\",\n+    \"2.59.236.56\",\n+    \"2.83.114.20\",\n+    \"2.248.194.16\",\n+    \"5.2.154.6\",\n+    \"5.101.140.30\",\n+    \"5.128.87.126\",\n+    \"5.144.21.49\",\n+    \"5.172.132.104\",\n+    \"5.188.62.18\",\n+    \"5.200.2.180\",\n+    \"8.129.184.255\",\n+    \"8.209.105.138\",\n+    \"12.34.98.148\",\n+    \"14.199.102.151\",\n+    \"18.27.79.17\",\n+    \"18.27.124.231\",\n+    \"18.216.249.151\",\n+    \"23.88.155.58\",\n+    \"23.93.101.158\",\n+    \"[2001:19f0:1000:1db3:5400:4ff:fe56:5a8d]\",\n+    \"[2001:19f0:5:24da:3eec:efff:feb9:f36e]\",\n+    \"[2001:19f0:5:24da::]\",\n+    \"[2001:19f0:5:4535:3eec:efff:feb9:87e4]\",\n+    \"[2001:19f0:5:4535::]\",\n+    \"[2001:1bc0:c1::2000]\",\n+    \"[2001:1c04:4008:6300:8a5f:2678:114b:a660]\",\n+    \"[2001:41d0:203:3739::]\",\n+    \"[2001:41d0:203:8f49::]\",\n+    \"[2001:41d0:203:bb0a::]\",\n+    \"[2001:41d0:2:bf8f::]\",\n+    \"[2001:41d0:303:de8b::]\",\n+    \"[2001:41d0:403:3d61::]\",\n+    \"[2001:41d0:405:9600::]\",\n+    \"[2001:41d0:8:ed7f::1]\",\n+    \"[2001:41d0:a:69a2::1]\",\n+    \"[2001:41f0::62:6974:636f:696e]\",\n+    \"[2001:470:1b62::]\",\n+    \"[2001:470:1f05:43b:2831:8530:7179:5864]\",\n+    \"[2001:470:1f09:b14::11]\",\n+    \"2bqghnldu6mcug4pikzprwhtjjnsyederctvci6klcwzepnjd46ikjyd.onion\",\n+    \"4lr3w2iyyl5u5l6tosizclykf5v3smqroqdn2i4h3kq6pfbbjb2xytad.onion\",\n+    \"5g72ppm3krkorsfopcm2bi7wlv4ohhs4u4mlseymasn7g7zhdcyjpfid.onion\",\n+    \"5sbmcl4m5api5tqafi4gcckrn3y52sz5mskxf3t6iw4bp7erwiptrgqd.onion\",\n+    \"776aegl7tfhg6oiqqy76jnwrwbvcytsx2qegcgh2mjqujll4376ohlid.onion\",\n+    \"77mdte42srl42shdh2mhtjr7nf7dmedqrw6bkcdekhdvmnld6ojyyiad.onion\",\n+    \"azbpsh4arqlm6442wfimy7qr65bmha2zhgjg7wbaji6vvaug53hur2qd.onion\",\n+    \"b64xcbleqmwgq2u46bh4hegnlrzzvxntyzbmucn3zt7cssm7y4ubv3id.onion\",\n+    \"bsqbtcparrfihlwolt4xgjbf4cgqckvrvsfyvy6vhiqrnh4w6ghixoid.onion\",\n+    \"bsqbtctulf2g4jtjsdfgl2ed7qs6zz5wqx27qnyiik7laockryvszqqd.onion\",\n+    \"cwi3ekrwhig47dhhzfenr5hbvckj7fzaojygvazi2lucsenwbzwoyiqd.onion\",\n+    \"devinbtcmwkuitvxl3tfi5of4zau46ymeannkjv6fpnylkgf3q5fa3id.onion\",\n+    \"devinbtctu7uctl7hly2juu3thbgeivfnvw3ckj3phy6nyvpnx66yeyd.onion\",\n+    \"devinbtcyk643iruzfpaxw3on2jket7rbjmwygm42dmdyub3ietrbmid.onion\",\n+    \"dtql5vci4iaml4anmueftqr7bfgzqlauzfy4rc2tfgulldd3ekyijjyd.onion\",\n+    \"emzybtc25oddoa2prol2znpz2axnrg6k77xwgirmhv7igoiucddsxiad.onion\",\n+    \"emzybtc3ewh7zihpkdvuwlgxrhzcxy2p5fvjggp7ngjbxcytxvt4rjid.onion\",\n+    \"emzybtc454ewbviqnmgtgx3rgublsgkk23r4onbhidcv36wremue4kqd.onion\",\n+    \"emzybtc5bnpb2o6gh54oquiox54o4r7yn4a2wiiwzrjonlouaibm2zid.onion\",\n+    \"fpz6r5ppsakkwypjcglz6gcnwt7ytfhxskkfhzu62tnylcknh3eq6pad.onion\",\n+    \"255fhcp6ajvftnyo7bwz3an3t4a4brhopm3bamyh2iu5r3gnr2rq.b32.i2p\",\n+    \"27yrtht5b5bzom2w5ajb27najuqvuydtzb7bavlak25wkufec5mq.b32.i2p\",\n+    \"3gocb7wc4zvbmmebktet7gujccuux4ifk3kqilnxnj5wpdpqx2hq.b32.i2p\",\n+    \"4fcc23wt3hyjk3csfzcdyjz5pcwg5dzhdqgma6bch2qyiakcbboa.b32.i2p\",\n+    \"4osyqeknhx5qf3a73jeimexwclmt42cju6xdp7icja4ixxguu2hq.b32.i2p\",\n+    \"4umsi4nlmgyp4rckosg4vegd2ysljvid47zu7pqsollkaszcbpqq.b32.i2p\",\n+    \"6j2ezegd3e2e2x3o3pox335f5vxfthrrigkdrbgfbdjchm5h4awa.b32.i2p\",\n+    \"6n36ljyr55szci5ygidmxqer64qr24f4qmnymnbvgehz7qinxnla.b32.i2p\",\n+    \"72yjs6mvlby3ky6mgpvvlemmwq5pfcznrzd34jkhclgrishqdxva.b32.i2p\",\n+    \"a5qsnv3maw77mlmmzlcglu6twje6ttctd3fhpbfwcbpmewx6fczq.b32.i2p\",\n+    \"aovep2pco7v2k4rheofrgytbgk23eg22dczpsjqgqtxcqqvmxk6a.b32.i2p\",\n+    \"bitcoi656nll5hu6u7ddzrmzysdtwtnzcnrjd4rfdqbeey7dmn5a.b32.i2p\",\n+    \"brifkruhlkgrj65hffybrjrjqcgdgqs2r7siizb5b2232nruik3a.b32.i2p\",\n+    \"c4gfnttsuwqomiygupdqqqyy5y5emnk5c73hrfvatri67prd7vyq.b32.i2p\",\n+    \"day3hgxyrtwjslt54sikevbhxxs4qzo7d6vi72ipmscqtq3qmijq.b32.i2p\",\n+    \"du5kydummi23bjfp6bd7owsvrijgt7zhvxmz5h5f5spcioeoetwq.b32.i2p\",\n+    \"e55k6wu46rzp4pg5pk5npgbr3zz45bc3ihtzu2xcye5vwnzdy7pq.b32.i2p\",\n+    \"eciohu5nq7vsvwjjc52epskuk75d24iccgzmhbzrwonw6lx4gdva.b32.i2p\",\n+    \"ejlnngarmhqvune74ko7kk55xtgbz5i5ncs4vmnvjpy3l7y63xaa.b32.i2p\",\n+    \"fhzlp3xroabohnmjonu5iqazwhlbbwh5cpujvw2azcu3srqdceja.b32.i2p\",\n+    \"[fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa]\",\n+    \"[fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce]\",\n+    \"[fcdc:73ae:b1a9:1bf8:d4c2:811:a4c7:c34e]\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1275392099",
      "id" : 1275392099,
      "in_reply_to_id" : 1275287508,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII585MBPBj",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 150,
      "original_position" : 150,
      "original_start_line" : 148,
      "path" : "test/functional/p2p_local_tx_relay.py",
      "position" : 150,
      "pull_request_review_id" : 1548441864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275392099/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 148,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-26T19:22:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275392099",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276217017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276217017"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> IIUC this line schedules a replacement sensitive connection because the one we were passed in has the wrong services and so it gets dumped.\r\n\r\nYes.\r\n\r\n> I think this is the only line in this function that makes it apply strictly to only sensitive relays. So I wonder if that should be asserted at the top? Or could be renamed to `PushUnbroadcastTxToSensistiveRelay()`? At the very least maybe sensitive-only should be explained in the function description on L933 ?\r\n\r\nRight. While this function will work if called for non-sensitive-relay peer (it will send the tx to the peer), this is not the intention because it will be bad for privacy and it is only called under `if (pfrom.IsSensitiveRelayConn()) {`.\r\n\r\nRenamed as suggested and added `Assume()`;",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-27T12:35:26Z",
      "diff_hunk" : "@@ -3292,6 +3367,56 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::PushUnbroadcastTx(CNode& node, Peer& peer, const std::atomic<bool>& interrupt)\n+{\n+    Peer::TxRelay* tx_relay{peer.GetTxRelay()};\n+    if (tx_relay == nullptr) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no transactions relay with this peer (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        m_connman.ScheduleSensitiveRelayConnections(1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276217017",
      "id" : 1276217017,
      "in_reply_to_id" : 1267244372,
      "line" : 3380,
      "node_id" : "PRRC_kwDOABII585MEYa5",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 3380,
      "original_position" : 234,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 234,
      "pull_request_review_id" : 1549746400,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276217017/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T12:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276217017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276240357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276240357"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure if the low level net layer is the right place to inspect high level p2p messages and then decide to drop them. It may be good to enumerate why this is needed (if at all).",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-27T12:53:56Z",
      "diff_hunk" : "@@ -2853,6 +2953,22 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     AssertLockNotHeld(m_total_bytes_sent_mutex);\n+\n+    if (pnode->IsSensitiveRelayConn() &&\n+        msg.m_type != NetMsgType::VERSION &&\n+        msg.m_type != NetMsgType::VERACK &&\n+        msg.m_type != NetMsgType::TX &&\n+        msg.m_type != NetMsgType::PING) {\n+\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Omitting send of message '%s', peer=%d%s\\n\",\n+                      msg.m_type,\n+                      pnode->GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", pnode->addr.ToStringAddrPort()) : \"\");\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276240357",
      "id" : 1276240357,
      "line" : 2969,
      "node_id" : "PRRC_kwDOABII585MEeHl",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 2969,
      "original_position" : 323,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 323,
      "pull_request_review_id" : 1549783541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276240357/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T13:04:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276240357",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276243984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276243984"
         }
      },
      "author_association" : "MEMBER",
      "body" : "shouldn't this use the peerman options struct?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-27T12:57:01Z",
      "diff_hunk" : "@@ -2092,6 +2141,26 @@ void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid\n     };\n }\n \n+bool PeerManagerImpl::UseSensitiveRelay() const\n+{\n+    return gArgs.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276243984",
      "id" : 1276243984,
      "line" : 2146,
      "node_id" : "PRRC_kwDOABII585MEfAQ",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 2146,
      "original_position" : 162,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 162,
      "pull_request_review_id" : 1549783541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276243984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T13:04:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276243984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276249120"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276249120"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Any reason to re-implement `std::advance()`?",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-27T13:01:19Z",
      "diff_hunk" : "@@ -3292,6 +3367,56 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::PushUnbroadcastTx(CNode& node, Peer& peer, const std::atomic<bool>& interrupt)\n+{\n+    Peer::TxRelay* tx_relay{peer.GetTxRelay()};\n+    if (tx_relay == nullptr) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no transactions relay with this peer (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        m_connman.ScheduleSensitiveRelayConnections(1);\n+        return;\n+    }\n+\n+    const auto unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+\n+    if (unbroadcast_txids.empty()) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no more sensitive transactions to \"\n+                      \"relay (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        return;\n+    }\n+\n+    // Randomly pick some transaction from unbroadcast_txids.\n+    const uint64_t n{FastRandomContext{}.randrange(unbroadcast_txids.size())};\n+    auto tx_iter = unbroadcast_txids.begin();\n+    for (uint64_t i = 0; i < n; ++i) {\n+        ++tx_iter;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276249120",
      "id" : 1276249120,
      "in_reply_to_id" : 1267248349,
      "line" : 3402,
      "node_id" : "PRRC_kwDOABII585MEgQg",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 3402,
      "original_position" : 256,
      "original_start_line" : 3400,
      "path" : "src/net_processing.cpp",
      "position" : 256,
      "pull_request_review_id" : 1549783541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276249120/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3400,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-27T13:04:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276249120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure how effective it is to put the transaction into the mempool. I know that your implementation treats the positive case (reply to an `inv` as if the tx wasn't there, or withhold the tx in reply to a `getdata`). However, a failure to reply to an otherwise valid `inv` can still be used to query the mempool. Or similarly, a failure to (also) withhold related transactions in an otherwise valid `getdata` can be used to query the mempool. (For example, if the transaction was a CPFP and the parent can't be in your mempool due to the minimum fee-rate, but your node happily replies).\r\n\r\nI don't think there is a general solution to this, other than to never add the transaction to the mempool.",
      "created_at" : "2023-07-27T13:10:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1653599387",
      "id" : 1653599387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585ij-yb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653599387/reactions"
      },
      "updated_at" : "2023-07-27T13:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653599387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276302188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276302188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, it does not provide a direct access to an arbitrary element. This is `O(unbroadcast_txids.size())` if faster is required we have to change the container (or extend it with supplementary vector). I shortened this a bit to:\r\n\r\n```cpp\r\nconst auto tx_iter = std::next(unbroadcast_txids.begin(), FastRandomContext{}.randrange(unbroadcast_txids.size()));\r\n```\r\n\r\nThis is still linear, but at least a bit short and (I hope) as easy to read.",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-27T13:42:51Z",
      "diff_hunk" : "@@ -3292,6 +3367,56 @@ void PeerManagerImpl::ProcessCompactBlockTxns(CNode& pfrom, Peer& peer, const Bl\n     return;\n }\n \n+void PeerManagerImpl::PushUnbroadcastTx(CNode& node, Peer& peer, const std::atomic<bool>& interrupt)\n+{\n+    Peer::TxRelay* tx_relay{peer.GetTxRelay()};\n+    if (tx_relay == nullptr) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no transactions relay with this peer (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        m_connman.ScheduleSensitiveRelayConnections(1);\n+        return;\n+    }\n+\n+    const auto unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+\n+    if (unbroadcast_txids.empty()) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Disconnecting: no more sensitive transactions to \"\n+                      \"relay (connected in vain), peer=%d%s\\n\",\n+                      node.GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", node.addr.ToStringAddrPort()) : \"\");\n+        node.fDisconnect = true;\n+        return;\n+    }\n+\n+    // Randomly pick some transaction from unbroadcast_txids.\n+    const uint64_t n{FastRandomContext{}.randrange(unbroadcast_txids.size())};\n+    auto tx_iter = unbroadcast_txids.begin();\n+    for (uint64_t i = 0; i < n; ++i) {\n+        ++tx_iter;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276302188",
      "id" : 1276302188,
      "in_reply_to_id" : 1267248349,
      "line" : 3402,
      "node_id" : "PRRC_kwDOABII585MEtNs",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 3402,
      "original_position" : 256,
      "original_start_line" : 3400,
      "path" : "src/net_processing.cpp",
      "position" : 256,
      "pull_request_review_id" : 1549884238,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276302188/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3400,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-27T13:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276302188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276860339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276860339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't like outright lying in the UA. Why not just send it blank? Or at least some kind of standard for \"I am not telling you\"",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-27T22:02:01Z",
      "diff_hunk" : "@@ -1422,26 +1429,53 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    m_connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, addr_you, // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CService(), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay));\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsSensitiveRelayConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276860339",
      "id" : 1276860339,
      "in_reply_to_id" : 1214671917,
      "line" : 1441,
      "node_id" : "PRRC_kwDOABII585MG1ez",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 1441,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1550892103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276860339/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T22:02:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276860339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278482371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278482371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right! Better to ensure explicitly than rely on the internals of `MaybeSendPing()`, the clock and the fact this is the first call to `MaybeSendPing()` for this peer.",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-30T03:08:18Z",
      "diff_hunk" : "@@ -3579,6 +3719,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTx(pfrom, *peer, interruptMsgProc);\n+\n+            MaybeSendPing(pfrom, *peer, GetTime<std::chrono::microseconds>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278482371",
      "id" : 1278482371,
      "in_reply_to_id" : 1267253028,
      "line" : 3731,
      "node_id" : "PRRC_kwDOABII585MNBfD",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 3731,
      "original_position" : 417,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 417,
      "pull_request_review_id" : 1553539836,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278482371/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T03:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278482371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278482946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278482946"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Both `.node` and `.requested_to_addr` members are used by the test - `.node` is used to check/query what messages `bitcoind` has sent to this peer and `.requested_to_addr` is used to check that the connection was made to an `.onion` address (and not e.g. an IPv4 address).",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-30T03:19:10Z",
      "diff_hunk" : "@@ -40,6 +41,16 @@ def __init__(self):\n         self.af = socket.AF_INET # Bind address family\n         self.unauth = False  # Support unauthenticated\n         self.auth = False  # Support authentication\n+        # An array of objects like:\n+        # {\n+        #     \"listen_addr\": \"127.0.0.1\"\n+        #     \"listen_port\": 28276\n+        #     \"node\": python_p2p_node,\n+        #     \"requested_to_addr\": \"the_client_asked_to_connect_to_this_addr.onion\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278482946",
      "id" : 1278482946,
      "in_reply_to_id" : 1267276546,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII585MNBoC",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 49,
      "original_position" : 17,
      "original_start_line" : 46,
      "path" : "test/functional/test_framework/socks5.py",
      "position" : 17,
      "pull_request_review_id" : 1553540345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278482946/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 46,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-30T03:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278482946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278493071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278493071"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't do that because my idea was to fall back to the old behavior of just closing the connection after the first `N` connections have been redirected (all destinations have been used). But you are right, I added a warning message now to ease diagnosing test behavior if that happens. Didn't `raise` because there is no error from the point of view of `socks5.py`.",
      "commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "created_at" : "2023-07-30T03:37:09Z",
      "diff_hunk" : "@@ -116,6 +127,30 @@ def handle(self):\n             cmdin = Socks5Command(cmd, atyp, addr, port, username, password)\n             self.serv.queue.put(cmdin)\n             logger.info('Proxy: %s', cmdin)\n+\n+            if self.serv.conf.destinations_used < len(self.serv.conf.destinations):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278493071",
      "id" : 1278493071,
      "in_reply_to_id" : 1267277048,
      "line" : 131,
      "node_id" : "PRRC_kwDOABII585MNEGP",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 131,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/socks5.py",
      "position" : 30,
      "pull_request_review_id" : 1553553290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278493071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T03:37:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278493071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278505682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278505682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just for convenience to be able to check if this is an unbroadcast transaction from `PeerManagerImpl::AlreadyHaveTx()` which has the id as `GenTxid`.\r\n\r\n`CTxMemPool::m_unbroadcast_txids` tracks transactions by `txid` (not `wtxid`). This is relevant: https://github.com/bitcoin/bitcoin/pull/18044#discussion_r460495254.",
      "commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "created_at" : "2023-07-30T04:08:51Z",
      "diff_hunk" : "@@ -1003,13 +1003,35 @@ size_t CTxMemPool::DynamicMemoryUsage() const {\n     return memusage::MallocUsage(sizeof(CTxMemPoolEntry) + 15 * sizeof(void*)) * mapTx.size() + memusage::DynamicUsage(mapNextTx) + memusage::DynamicUsage(mapDeltas) + memusage::DynamicUsage(vTxHashes) + cachedInnerUsage;\n }\n \n-void CTxMemPool::RemoveUnbroadcastTx(const uint256& txid, const bool unchecked) {\n+bool CTxMemPool::RemoveUnbroadcastTx(const uint256& txid, const bool unchecked) {\n     LOCK(cs);\n \n     if (m_unbroadcast_txids.erase(txid))\n     {\n         LogPrint(BCLog::MEMPOOL, \"Removed %i from set of unbroadcast txns%s\\n\", txid.GetHex(), (unchecked ? \" before confirmation that txn was sent out\" : \"\"));\n+        return true;\n+    }\n+    return false;\n+}\n+\n+bool CTxMemPool::IsUnbroadcastTx(const GenTxid& gtxid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278505682",
      "id" : 1278505682,
      "in_reply_to_id" : 1267279962,
      "line" : 1017,
      "node_id" : "PRRC_kwDOABII585MNHLS",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 1017,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 16,
      "pull_request_review_id" : 1553575220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278505682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T04:08:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278505682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278506090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278506090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right! I added `-cjdnsreachable`. This changed the test from:\r\n\r\n```\r\nTestFramework (DEBUG): Could not add [fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa] to node0's addrman (collision?)\r\n```\r\n\r\nto\r\n\r\n```\r\nTestFramework (DEBUG): Added [fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa] to node0's addrman\r\n```\r\n\r\nThanks!",
      "commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "created_at" : "2023-07-30T04:16:01Z",
      "diff_hunk" : "@@ -0,0 +1,294 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when sensitive relay is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (node0)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The sensitive relay TX recipients\n+               |   |       (SENSITIVE_RELAY_NUM_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< observer_inbound\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_getdata,\n+    msg_inv,\n+    msg_mempool,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+SENSITIVE_RELAY_NUM_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more\n+# for sensitive relays.\n+addresses = [\n+    \"1.65.195.98\",\n+    \"2.59.236.56\",\n+    \"2.83.114.20\",\n+    \"2.248.194.16\",\n+    \"5.2.154.6\",\n+    \"5.101.140.30\",\n+    \"5.128.87.126\",\n+    \"5.144.21.49\",\n+    \"5.172.132.104\",\n+    \"5.188.62.18\",\n+    \"5.200.2.180\",\n+    \"8.129.184.255\",\n+    \"8.209.105.138\",\n+    \"12.34.98.148\",\n+    \"14.199.102.151\",\n+    \"18.27.79.17\",\n+    \"18.27.124.231\",\n+    \"18.216.249.151\",\n+    \"23.88.155.58\",\n+    \"23.93.101.158\",\n+    \"[2001:19f0:1000:1db3:5400:4ff:fe56:5a8d]\",\n+    \"[2001:19f0:5:24da:3eec:efff:feb9:f36e]\",\n+    \"[2001:19f0:5:24da::]\",\n+    \"[2001:19f0:5:4535:3eec:efff:feb9:87e4]\",\n+    \"[2001:19f0:5:4535::]\",\n+    \"[2001:1bc0:c1::2000]\",\n+    \"[2001:1c04:4008:6300:8a5f:2678:114b:a660]\",\n+    \"[2001:41d0:203:3739::]\",\n+    \"[2001:41d0:203:8f49::]\",\n+    \"[2001:41d0:203:bb0a::]\",\n+    \"[2001:41d0:2:bf8f::]\",\n+    \"[2001:41d0:303:de8b::]\",\n+    \"[2001:41d0:403:3d61::]\",\n+    \"[2001:41d0:405:9600::]\",\n+    \"[2001:41d0:8:ed7f::1]\",\n+    \"[2001:41d0:a:69a2::1]\",\n+    \"[2001:41f0::62:6974:636f:696e]\",\n+    \"[2001:470:1b62::]\",\n+    \"[2001:470:1f05:43b:2831:8530:7179:5864]\",\n+    \"[2001:470:1f09:b14::11]\",\n+    \"2bqghnldu6mcug4pikzprwhtjjnsyederctvci6klcwzepnjd46ikjyd.onion\",\n+    \"4lr3w2iyyl5u5l6tosizclykf5v3smqroqdn2i4h3kq6pfbbjb2xytad.onion\",\n+    \"5g72ppm3krkorsfopcm2bi7wlv4ohhs4u4mlseymasn7g7zhdcyjpfid.onion\",\n+    \"5sbmcl4m5api5tqafi4gcckrn3y52sz5mskxf3t6iw4bp7erwiptrgqd.onion\",\n+    \"776aegl7tfhg6oiqqy76jnwrwbvcytsx2qegcgh2mjqujll4376ohlid.onion\",\n+    \"77mdte42srl42shdh2mhtjr7nf7dmedqrw6bkcdekhdvmnld6ojyyiad.onion\",\n+    \"azbpsh4arqlm6442wfimy7qr65bmha2zhgjg7wbaji6vvaug53hur2qd.onion\",\n+    \"b64xcbleqmwgq2u46bh4hegnlrzzvxntyzbmucn3zt7cssm7y4ubv3id.onion\",\n+    \"bsqbtcparrfihlwolt4xgjbf4cgqckvrvsfyvy6vhiqrnh4w6ghixoid.onion\",\n+    \"bsqbtctulf2g4jtjsdfgl2ed7qs6zz5wqx27qnyiik7laockryvszqqd.onion\",\n+    \"cwi3ekrwhig47dhhzfenr5hbvckj7fzaojygvazi2lucsenwbzwoyiqd.onion\",\n+    \"devinbtcmwkuitvxl3tfi5of4zau46ymeannkjv6fpnylkgf3q5fa3id.onion\",\n+    \"devinbtctu7uctl7hly2juu3thbgeivfnvw3ckj3phy6nyvpnx66yeyd.onion\",\n+    \"devinbtcyk643iruzfpaxw3on2jket7rbjmwygm42dmdyub3ietrbmid.onion\",\n+    \"dtql5vci4iaml4anmueftqr7bfgzqlauzfy4rc2tfgulldd3ekyijjyd.onion\",\n+    \"emzybtc25oddoa2prol2znpz2axnrg6k77xwgirmhv7igoiucddsxiad.onion\",\n+    \"emzybtc3ewh7zihpkdvuwlgxrhzcxy2p5fvjggp7ngjbxcytxvt4rjid.onion\",\n+    \"emzybtc454ewbviqnmgtgx3rgublsgkk23r4onbhidcv36wremue4kqd.onion\",\n+    \"emzybtc5bnpb2o6gh54oquiox54o4r7yn4a2wiiwzrjonlouaibm2zid.onion\",\n+    \"fpz6r5ppsakkwypjcglz6gcnwt7ytfhxskkfhzu62tnylcknh3eq6pad.onion\",\n+    \"255fhcp6ajvftnyo7bwz3an3t4a4brhopm3bamyh2iu5r3gnr2rq.b32.i2p\",\n+    \"27yrtht5b5bzom2w5ajb27najuqvuydtzb7bavlak25wkufec5mq.b32.i2p\",\n+    \"3gocb7wc4zvbmmebktet7gujccuux4ifk3kqilnxnj5wpdpqx2hq.b32.i2p\",\n+    \"4fcc23wt3hyjk3csfzcdyjz5pcwg5dzhdqgma6bch2qyiakcbboa.b32.i2p\",\n+    \"4osyqeknhx5qf3a73jeimexwclmt42cju6xdp7icja4ixxguu2hq.b32.i2p\",\n+    \"4umsi4nlmgyp4rckosg4vegd2ysljvid47zu7pqsollkaszcbpqq.b32.i2p\",\n+    \"6j2ezegd3e2e2x3o3pox335f5vxfthrrigkdrbgfbdjchm5h4awa.b32.i2p\",\n+    \"6n36ljyr55szci5ygidmxqer64qr24f4qmnymnbvgehz7qinxnla.b32.i2p\",\n+    \"72yjs6mvlby3ky6mgpvvlemmwq5pfcznrzd34jkhclgrishqdxva.b32.i2p\",\n+    \"a5qsnv3maw77mlmmzlcglu6twje6ttctd3fhpbfwcbpmewx6fczq.b32.i2p\",\n+    \"aovep2pco7v2k4rheofrgytbgk23eg22dczpsjqgqtxcqqvmxk6a.b32.i2p\",\n+    \"bitcoi656nll5hu6u7ddzrmzysdtwtnzcnrjd4rfdqbeey7dmn5a.b32.i2p\",\n+    \"brifkruhlkgrj65hffybrjrjqcgdgqs2r7siizb5b2232nruik3a.b32.i2p\",\n+    \"c4gfnttsuwqomiygupdqqqyy5y5emnk5c73hrfvatri67prd7vyq.b32.i2p\",\n+    \"day3hgxyrtwjslt54sikevbhxxs4qzo7d6vi72ipmscqtq3qmijq.b32.i2p\",\n+    \"du5kydummi23bjfp6bd7owsvrijgt7zhvxmz5h5f5spcioeoetwq.b32.i2p\",\n+    \"e55k6wu46rzp4pg5pk5npgbr3zz45bc3ihtzu2xcye5vwnzdy7pq.b32.i2p\",\n+    \"eciohu5nq7vsvwjjc52epskuk75d24iccgzmhbzrwonw6lx4gdva.b32.i2p\",\n+    \"ejlnngarmhqvune74ko7kk55xtgbz5i5ncs4vmnvjpy3l7y63xaa.b32.i2p\",\n+    \"fhzlp3xroabohnmjonu5iqazwhlbbwh5cpujvw2azcu3srqdceja.b32.i2p\",\n+    \"[fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa]\",\n+    \"[fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce]\",\n+    \"[fcdc:73ae:b1a9:1bf8:d4c2:811:a4c7:c34e]\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278506090",
      "id" : 1278506090,
      "in_reply_to_id" : 1275287508,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII585MNHRq",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 150,
      "original_position" : 150,
      "original_start_line" : 148,
      "path" : "test/functional/p2p_local_tx_relay.py",
      "position" : 150,
      "pull_request_review_id" : 1553575688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278506090/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 148,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-30T04:16:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278506090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278506979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278506979"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I can't find an options struct in `PeerManager` or in `PeerManagerImpl`. Did you mean `struct CConnman::Options`? `gArgs` is used in some other places in `PeerManagerImpl` too, so I assumed it is ok.\r\n\r\nEdit: I see the options struct was added recently and caused this not to compile. Rebased and changed this to use `PeerManager::m_opts`.",
      "commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "created_at" : "2023-07-30T04:30:55Z",
      "diff_hunk" : "@@ -2092,6 +2141,26 @@ void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid\n     };\n }\n \n+bool PeerManagerImpl::UseSensitiveRelay() const\n+{\n+    return gArgs.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278506979",
      "id" : 1278506979,
      "in_reply_to_id" : 1276243984,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MNHfj",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 2148,
      "original_position" : 162,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1553576461,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278506979/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T05:07:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278506979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278507242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278507242"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess an alternative would be to have a new method `PeerManagerImpl::PushMessage()` which does this check and then calls `CConnman::PushMessage()`. And replace all calls to `m_connman.PushMessage()` (there are 53 of them) with `PushMessage()`. Would that be desirable?",
      "commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "created_at" : "2023-07-30T04:35:14Z",
      "diff_hunk" : "@@ -2853,6 +2953,22 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     AssertLockNotHeld(m_total_bytes_sent_mutex);\n+\n+    if (pnode->IsSensitiveRelayConn() &&\n+        msg.m_type != NetMsgType::VERSION &&\n+        msg.m_type != NetMsgType::VERACK &&\n+        msg.m_type != NetMsgType::TX &&\n+        msg.m_type != NetMsgType::PING) {\n+\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Omitting send of message '%s', peer=%d%s\\n\",\n+                      msg.m_type,\n+                      pnode->GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", pnode->addr.ToStringAddrPort()) : \"\");\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278507242",
      "id" : 1278507242,
      "in_reply_to_id" : 1276240357,
      "line" : 2967,
      "node_id" : "PRRC_kwDOABII585MNHjq",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 2967,
      "original_position" : 323,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 323,
      "pull_request_review_id" : 1553576679,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278507242/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T04:35:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278507242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`bde055d28f...96ea776776`: address suggestions",
      "created_at" : "2023-07-30T04:37:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1657040602",
      "id" : 1657040602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585ixG7a",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657040602/reactions"
      },
      "updated_at" : "2023-07-30T04:37:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657040602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`96ea776776...7a3206dc8e`: rebase due to conflicts",
      "created_at" : "2023-07-30T05:05:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1657043863",
      "id" : 1657043863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585ixHuX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657043863/reactions"
      },
      "updated_at" : "2023-07-30T05:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657043863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278521260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278521260"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It may be good to enumerate why this is needed (if at all).",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-30T07:05:16Z",
      "diff_hunk" : "@@ -2853,6 +2953,22 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     AssertLockNotHeld(m_total_bytes_sent_mutex);\n+\n+    if (pnode->IsSensitiveRelayConn() &&\n+        msg.m_type != NetMsgType::VERSION &&\n+        msg.m_type != NetMsgType::VERACK &&\n+        msg.m_type != NetMsgType::TX &&\n+        msg.m_type != NetMsgType::PING) {\n+\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Omitting send of message '%s', peer=%d%s\\n\",\n+                      msg.m_type,\n+                      pnode->GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", pnode->addr.ToStringAddrPort()) : \"\");\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1278521260",
      "id" : 1278521260,
      "in_reply_to_id" : 1276240357,
      "line" : 2967,
      "node_id" : "PRRC_kwDOABII585MNK-s",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 2967,
      "original_position" : 323,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 323,
      "pull_request_review_id" : 1553591840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278521260/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T07:05:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278521260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279166534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279166534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this should go into `net_processing.h` where it is used",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T11:31:34Z",
      "diff_hunk" : "@@ -49,6 +49,8 @@ class CNode;\n class CScheduler;\n struct bilingual_str;\n \n+/** Default for -sensitiverelayowntx. */\n+static const bool DEFAULT_SENSITIVE_RELAY_OWN_TX{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279166534",
      "id" : 1279166534,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII585MPohG",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 53,
      "original_position" : 5,
      "original_start_line" : 52,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_review_id" : 1554560960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279166534/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 52,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279166534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279194945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279194945"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Using the txid here can leak the tx origin.\r\n\r\ne.g. an attacker changes the witness of your tx (such that the tx is invalid) and sends it to you, if you then announce the original tx to your peers it is obvious that the tx originated from you.",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T12:01:36Z",
      "diff_hunk" : "@@ -4144,6 +4309,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         m_txrequest.ReceivedResponse(pfrom.GetId(), txid);\n         if (tx.HasWitness()) m_txrequest.ReceivedResponse(pfrom.GetId(), wtxid);\n \n+        if (UseSensitiveRelay() && m_mempool.RemoveUnbroadcastTx(txid)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279194945",
      "id" : 1279194945,
      "line" : 4312,
      "node_id" : "PRRC_kwDOABII585MPvdB",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 4312,
      "original_position" : 458,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 458,
      "pull_request_review_id" : 1554560960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279194945/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279194945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279206967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279206967"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unless I'm missing something, the pings on sensitive connections never timeout. So if the peer doesn't respond to the ping the connection only closes after 20min (`TIMEOUT_INTERVAL`).",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T12:14:16Z",
      "diff_hunk" : "@@ -4760,6 +4942,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279206967",
      "id" : 1279206967,
      "line" : 4945,
      "node_id" : "PRRC_kwDOABII585MPyY3",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 4945,
      "original_position" : 500,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 500,
      "pull_request_review_id" : 1554560960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279206967/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279206967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279227800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279227800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not processing messages that are irrelevant to this type of tx relay is the right move but it still leaves room for tx origin leakage through fingerprinting in the version handshake.\r\n\r\nIn other words, if it is possible to fingerprint a node solely based on version handshake messages then it is possible for the receiver of a \"sensitive-relay\" tx to figure out which public addresses belong to the node that broadcast the tx.",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T12:31:50Z",
      "diff_hunk" : "@@ -3698,6 +3851,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279227800",
      "id" : 1279227800,
      "line" : 3854,
      "node_id" : "PRRC_kwDOABII585MP3eY",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 3854,
      "original_position" : 439,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 439,
      "pull_request_review_id" : 1554560960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279227800/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279227800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279249579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279249579"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "_(beware, https://bikeshed.com/)_\r\n\r\nI think any constant is ok and `bitcoin-submittx`'s string (`/pynode:0.0.1/`) was already suggested by @sipa here https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517896418. That suggestion has 6 positive reactions. It is about increasing the anonymity set, in case different versions or different softwares use this technique.\r\n\r\n> some kind of standard for \"I am not telling you\"\r\n\r\nI don't think there is, but we can standardize `/pynode:0.0.1/` as \"I am not telling you\"? ;-)\r\n\r\nShould I change this to an empty string? If this comment collects more :+1: + :heart: than https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517896418 then I will change it.",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T12:49:38Z",
      "diff_hunk" : "@@ -1422,26 +1429,53 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    m_connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, addr_you, // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CService(), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay));\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsSensitiveRelayConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279249579",
      "id" : 1279249579,
      "in_reply_to_id" : 1214671917,
      "line" : 1441,
      "node_id" : "PRRC_kwDOABII585MP8yr",
      "original_commit_id" : "504453a394d28c6bef7faaeaac98ac98f96bb0ae",
      "original_line" : 1441,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 97,
      "pull_request_review_id" : 1554700574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279249579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-31T12:49:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279249579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7a3206dc8e...2541f09439`: add a comment wrt https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1276240357",
      "created_at" : "2023-07-31T13:02:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1658332910",
      "id" : 1658332910,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i2Cbu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658332910/reactions"
      },
      "updated_at" : "2023-07-31T13:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658332910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279277093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279277093"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It is good to have all unneeded messages dropped from a central place (where all messages go through) even if it seems that the code will not send such messages now - this way it is proof wrt future changes. The code that decides which message to send is scattered all over the place and is difficult to follow.\r\n\r\nI added this comment\r\n\r\n```cpp\r\n// Ensure sensitive relay connections only send VERSION, VERACK, TX or PING. Others are not needed and may degrade privacy.\r\n```\r\n\r\n",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T13:14:02Z",
      "diff_hunk" : "@@ -2853,6 +2953,22 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     AssertLockNotHeld(m_total_bytes_sent_mutex);\n+\n+    if (pnode->IsSensitiveRelayConn() &&\n+        msg.m_type != NetMsgType::VERSION &&\n+        msg.m_type != NetMsgType::VERACK &&\n+        msg.m_type != NetMsgType::TX &&\n+        msg.m_type != NetMsgType::PING) {\n+\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Omitting send of message '%s', peer=%d%s\\n\",\n+                      msg.m_type,\n+                      pnode->GetId(),\n+                      fLogIPs ? strprintf(\", peeraddr=%s\", pnode->addr.ToStringAddrPort()) : \"\");\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279277093",
      "id" : 1279277093,
      "in_reply_to_id" : 1276240357,
      "line" : 2967,
      "node_id" : "PRRC_kwDOABII585MQDgl",
      "original_commit_id" : "bde055d28f5d41d9e923f770d130010e72441e91",
      "original_line" : 2967,
      "original_position" : 323,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 323,
      "pull_request_review_id" : 1554746026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279277093/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-31T13:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279277093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279295208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279295208"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        // Ensure sensitive relay connections only send the above message types. Others are not needed and may degrade privacy.\r\n```\r\n\r\n(nit), to avoid having to touch this line again in the future, if something changes.",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T13:26:42Z",
      "diff_hunk" : "@@ -2851,6 +2951,22 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     AssertLockNotHeld(m_total_bytes_sent_mutex);\n+\n+    if (pnode->IsSensitiveRelayConn() &&\n+        msg.m_type != NetMsgType::VERSION &&\n+        msg.m_type != NetMsgType::VERACK &&\n+        msg.m_type != NetMsgType::TX &&\n+        msg.m_type != NetMsgType::PING) {\n+        // Ensure sensitive relay connections only send VERSION, VERACK, TX or PING. Others are not needed and may degrade privacy.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279295208",
      "id" : 1279295208,
      "line" : 2960,
      "node_id" : "PRRC_kwDOABII585MQH7o",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 2960,
      "original_position" : 316,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 316,
      "pull_request_review_id" : 1554774350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279295208/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T06:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279295208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279343481"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279343481"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What about children of local txs? They currently leak tx origin as well.\r\n\r\nThey should be treated as orphans until the parent tx is scheduled for relay to all.",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T14:01:04Z",
      "diff_hunk" : "@@ -4144,6 +4309,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         m_txrequest.ReceivedResponse(pfrom.GetId(), txid);\n         if (tx.HasWitness()) m_txrequest.ReceivedResponse(pfrom.GetId(), wtxid);\n \n+        if (UseSensitiveRelay() && m_mempool.RemoveUnbroadcastTx(txid)) {\n+            LogPrintLevel( /* Continued */\n+                BCLog::SENSITIVE_RELAY,\n+                BCLog::Level::Info,\n+                \"Received own transaction (txid=%s) from the network from peer=%d%s; \"\n+                \"stopping sensitive broadcast and broadcasting it to everybody as if it is not our transaction\\n\",\n+                txid.ToString(),\n+                pfrom.GetId(),\n+                fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToStringAddrPort()) : \"\");\n+\n+            m_txrequest.ForgetTxHash(txid);\n+            m_txrequest.ForgetTxHash(wtxid);\n+            ScheduleTxForRelayToAll(txid, wtxid);\n+            pfrom.m_last_tx_time = GetTime<std::chrono::seconds>();\n+            return;\n+        }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279343481",
      "id" : 1279343481,
      "line" : 4328,
      "node_id" : "PRRC_kwDOABII585MQTt5",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 4328,
      "original_position" : 474,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 474,
      "pull_request_review_id" : 1554560960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279343481/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279343481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279655081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279655081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: s/send/sent",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-07-31T17:24:06Z",
      "diff_hunk" : "@@ -3576,6 +3716,19 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTxToSensistiveRelay(pfrom, *peer, interruptMsgProc);\n+\n+            peer->m_ping_queued = true; // Ensure a ping will be send: mimick a request via RPC.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1279655081",
      "id" : 1279655081,
      "line" : 3728,
      "node_id" : "PRRC_kwDOABII585MRfyp",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 3728,
      "original_position" : 428,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 428,
      "pull_request_review_id" : 1555409244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279655081/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-31T18:54:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279655081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ran with this feature on signet and found a few unexpected behaviors:\r\n\r\n1. `-sensitiverelay=1` and `-onlynet=ipv4` should probably throw an init error. In this configuration, sensitive stuff seems to be ignored and new wallet TXs are relayed via ipv4 peers like normal. Is \"only use tor for sensitive relay\" a possible configuration? ð https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281726530\r\n\r\n2. Rapidly sending multiple transactions `\"...incremented the number of connections to open from 20 to 25...\"` this number grows rapidly and decreases slowly (especially on signet) I wonder if it should max out at some point or reduce the tx:relay-peer ratio from 5:1 to just 1:1 ð https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281768350\r\n\r\n3. Restarting the node and reloading the wallet logged messages about pushing the unbroadcast TXs to the mempool, but I do not think any sensitive-relay connections were triggered to deliver those. Eventually I tried sending another new TX and then, even though only 5 sensitive connections were being opened for that one new TX, over time those connections were used for some of the backlog (\"pretending peer requested tx...\"). Until the 5 sensitive connections dropped down to 0. **update: eventually `ReattemptInitialBroadcast` triggered and the backlog increased the count to 100 sensitive connections ð https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281830292\r\n\r\n4. Finally, on signet I never got an INV for one of my own txs back. so `getmempoolinfo : unbroadcastcount` only ever increased. I notice that the tests only use python `P2PInterface()`'s for peers and the `observer_outbound` peer and is manually forced to inv our txid... makes me wonder if real bitcoind peers have different enough relay behavior that it doesnt work as well in production. For example, we pretend our sensitive relay peers requested a tx when they didn't. Does bitcoind still relay TXs it didn't getdata for? Also I suppose given that some of my signet TXs weren't going out, there could be an issue with orphans and peers that are missing my parents. I may try writing tests with more network bitcoind nodes, or set it up locally but routed through Tor. ð https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1284610972\r\n\r\nI'm going to continue playing with all this and see if I can figure anything out. It's definitely cool to see some `srelay` connections pop up in the `-netinfo` dashboard!",
      "created_at" : "2023-07-31T19:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1659008138",
      "id" : 1659008138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i4nSK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659008138/reactions"
      },
      "updated_at" : "2023-08-05T14:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659008138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Approach NACK, (but Concept ACK). Leaving a NACK only to have DrahtBot create an anchor to this comment, to avoid GitHub from hiding it as well.\r\n\r\nI don't think you've seen https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1653599387 and GitHub is already hiding it by default.",
      "created_at" : "2023-08-01T05:59:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1659618783",
      "id" : 1659618783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i68Xf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659618783/reactions"
      },
      "updated_at" : "2023-08-01T05:59:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659618783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke, I am not sure I fully understand in [your comment](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1653599387). Can you elaborate on the CPFP example?\r\n\r\nIn general, wrt the privacy of the transaction originator, do you think that the \"sensitive relay\" mechanism from this PR could be worse than the current \"send to all\" from `master` in some cases? Or do you think that it is better than `master` but it can be done even better?",
      "created_at" : "2023-08-01T11:31:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1660128648",
      "id" : 1660128648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i842I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660128648/reactions"
      },
      "updated_at" : "2023-08-01T11:31:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660128648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> do you think that the \"sensitive relay\" mechanism from this PR could be worse \r\n\r\nYes, my understanding is that this pull strictly decreases privacy when the underlying wallet makes use of transactions chains (whether or not for intentional or accidental CPFP shouldn't matter), or transaction replacements, or mutually exclusive transactions (\"conflicts\", \"double-spends\" or insufficient rbf-fee), or if the transaction recipient is the attacker and can create transactions spending the \"sensitive\" output. The CPFP example is just an example. The general idea is that it is impossible to hide a transaction being in the mempool once it is added to the mempool.\r\n\r\nThe reason why this pull makes it strictly worse, is because previously an attacker could only guess which was the originating node. Now, the attacker can uniquely identify the node.\r\n\r\nFor example (using the CPFP example):\r\n\r\n* Wallet creates a low_fee_tx and relays it to the whole network.\r\n* A day later, Wallet sees the low_fee_tx was dropped from the local (small) mempool (with a lower minfee than the rest of the network) and creates a high_fee_tx child, adding back the parent to the mempool.\r\n* The attacker receives `high_fee_tx` as \"sensitive\" transaction. (With less precision the attack should work as well, if the attacker received the transactions as a fluffed transaction from the network).\r\n* The attacker, being connected to all clearnet network nodes and knowing the minfee of all network nodes (via the feefilter message), ask all nodes for high_fee_tx and low_fee_tx.\r\n* The only node that withholds high_fee_tx and replies with low_fee_tx, despite it violating the minfeefilter it requested its peers to honour, is the victim node. Thus, it is uniquely identified.\r\n\r\nI don't think this unique identification is currently possible.\r\n\r\nLet me know if I am missing something, or if I should come up with more examples.",
      "created_at" : "2023-08-01T12:13:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1660192852",
      "id" : 1660192852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i9IhU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660192852/reactions"
      },
      "updated_at" : "2023-08-01T12:13:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660192852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the only correct approach to implement something like this, is to keep the unbroadcast transaction within the wallet (in a special unbroadcast state until it's echoed back). In this unbroadcast state, rebroadcasts can happen (directly to sensitive relay peers only, bypassing the mempool), but outputs are not available for creating descendant transactions.",
      "created_at" : "2023-08-01T13:03:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1660269660",
      "id" : 1660269660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i9bRc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660269660/reactions"
      },
      "updated_at" : "2023-08-01T13:03:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660269660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> but outputs are not available for creating descendant transactions.\r\n\r\nIn theory they could be used to create transactions, under the assumption that created transactions generally and eventually relay, but that can be fixed independent of the relay issue here. Pretty sure there is a tracking issue about this already, which likely affects `-nowalletbroadcast` and `-nospendzeroconfchange` users.",
      "created_at" : "2023-08-01T13:09:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1660280410",
      "id" : 1660280410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i9d5a",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660280410/reactions"
      },
      "updated_at" : "2023-08-01T13:10:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660280410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for looking into this! I will address trivial stuff/comments first and then will _try_ to address the other concerns in chronological order.\r\n\r\nI am open to exploring in more detail the option of not putting the transaction in the mempool. I considered this in the beginning but I got the impression that this is going to be more complicated. Anyway I want to first try to address all concerns or, if not possible, get convinced that putting the transaction in the mempool is non-workable. Edit: some parts of this PR will be reused even if changed to skip the mempool.\r\n\r\nI don't like the idea of a separate tool because that's like saying \"we can't get the current software to do it properly, so we will create another software\".\r\n\r\n@MarcoFalke, yes, more concrete examples to try to shoot this down are welcome ;-)",
      "created_at" : "2023-08-01T16:11:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1660642848",
      "id" : 1660642848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i-2Yg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660642848/reactions"
      },
      "updated_at" : "2023-08-01T16:23:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660642848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I considered this in the beginning but I got the impression that this is going to be more complicated.\r\n\r\nMy guess would have been that it will be a lot simpler, at least for reviewers.\r\n\r\n> Edit: some parts of this PR will be reused even if changed to skip the mempool.\r\n\r\nYes, everything except for the mempool / high level p2p stuff can probably stay as-is.\r\n\r\n> @MarcoFalke, yes, more concrete examples to try to shoot this down are welcome ;-)\r\n\r\nWould be good to explain what is wrong/missing from the example and explanations that are given above.",
      "created_at" : "2023-08-01T16:27:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1660675919",
      "id" : 1660675919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585i--dP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660675919/reactions"
      },
      "updated_at" : "2023-08-01T16:27:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660675919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I don't like the idea of a separate tool because that's like saying \"we can't get the current software to do it properly, so we will create another software\".\r\n\r\n\"we can't get the current software to do it properly\" that is kinda true w.r.t. fingerprinting, or it would at least require significant effort to avoid it completely. Fingerprinting negates the usefulness of this feature, because `\"The peers that receive the transaction could deduce that this is initial transaction broadcast from the transaction originator. This is ok, they can't identify the sender\"` is no longer true (for listening nodes).\r\n\r\nI'd prefer a separate tool as we otherwise turn fingerprinting into a big maintenance issue. A separate tool guarantees that there is no internal state overlap which makes fingerprinting very hard (if not impossible).",
      "created_at" : "2023-08-02T10:18:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1661944988",
      "id" : 1661944988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585jD0Sc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661944988/reactions"
      },
      "updated_at" : "2023-08-02T10:18:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661944988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'd prefer a separate tool as we otherwise turn fingerprinting into a big maintenance issue. A separate tool guarantees that there is no internal state overlap which makes fingerprinting very hard (if not impossible).\r\n\r\nNot sure why this requires a separate tool? I think a separate internal module (or internal library that is linked, or whatever) should be able to achieve the same, with the added benefit that users can use it in Bitcoin Core without having to fiddle with another binary.",
      "created_at" : "2023-08-02T10:37:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1661971280",
      "id" : 1661971280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585jD6tQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661971280/reactions"
      },
      "updated_at" : "2023-08-02T10:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661971280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281726530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281726530"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "_moving discussion from https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1659008138_\r\n\r\n> 1. `-sensitiverelay=1` and `-onlynet=ipv4` should probably throw an init error. In this configuration, sensitive stuff seems to be ignored and new wallet TXs are relayed via ipv4 peers like normal.\r\n\r\nThis check was supposed to prevent that but it was too strict. Apparently you have `listenonion=1` which means that later, after startup, we will connect to the Tor control and may set the Tor proxy and make the Tor network reachable. It is a bit weird that `listenonion` remains with the default `1` when `onlynet=ipv4` is used. It means the node will only make outgoing connections to IPv4, but will listen for and accept incoming connections from the Tor network :eyes:.\r\n\r\nI relaxed the check to also trigger the error if `onlynet` has been used (and if `!IsReachable(NET_ONION)` at the time of the check, that means `onlynet` was used but tor was omitted from it).\r\n\r\n> Is \"only use tor for sensitive relay\" a possible configuration?\r\n\r\nYes, if the node does not have I2P connectivity. Then only Tor will be used. But if the node has both Tor and I2P connectivity then both will be used. Do you mean that if both networks are reachable, to use only Tor for sensitive relay? I didn't do that because I see no usecase for it.",
      "commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "created_at" : "2023-08-02T10:39:11Z",
      "diff_hunk" : "@@ -1853,6 +1873,22 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX)) {\n+        // If -listenonion is set, then NET_ONION may not be reachable now\n+        // but may become reachable later, thus only error here if it is not\n+        // reachable and will not become reachable for sure.\n+        if (!IsReachable(NET_I2P) && !IsReachable(NET_ONION) && !listenonion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281726530",
      "id" : 1281726530,
      "line" : 1880,
      "node_id" : "PRRC_kwDOABII585MZZhC",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 1880,
      "original_position" : 82,
      "original_start_line" : 1876,
      "path" : "src/init.cpp",
      "position" : 82,
      "pull_request_review_id" : 1558720800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281726530/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1876,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-02T10:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281726530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think a separate internal module (or internal library that is linked, or whatever) should be able to achieve the same, with the added benefit that users can use it in Bitcoin Core without having to fiddle with another binary.\r\n\r\nSure but that is the \"significant effort\" i was referring to. You would need to completely decouple this new logic (and its state) from the other full node networking and message processing logic.",
      "created_at" : "2023-08-02T10:41:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1661976345",
      "id" : 1661976345,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585jD78Z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661976345/reactions"
      },
      "updated_at" : "2023-08-02T10:41:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661976345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281768350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281768350"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "_moving discussion from https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1659008138_\r\n\r\n> 2. Rapidly sending multiple transactions \"...incremented the number of connections to open from 20 to 25...\" this number grows rapidly and decreases slowly (especially on signet) I wonder if it should max out at some point or reduce the tx:relay-peer ratio from 5:1 to just 1:1\r\n\r\n`MAX_SENSITIVE_RELAY_CONNECTIONS` (64) is supposed to cap it. Did it exceed 64?",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T11:22:31Z",
      "diff_hunk" : "@@ -1605,6 +1606,59 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+/**\n+ * Decide whether to open a sensitive relay connection and if yes, to which network.\n+ * @param[in,out] net When called, this should have a value if the previous attempt\n+ * to open a connection was sensitive relay (successful or not). When the function\n+ * ends if this has value then it will contain the network to which to open the\n+ * connection.\n+ * @param[in] num_needed Number of sensitive relay connections that need to be opened.\n+ * @param[in] num_opened Number of sensitive relay connections that are currently opened.\n+ */\n+static void MaybePickSensitiveRelayNetwork(std::optional<Network>& net, size_t num_needed, size_t num_opened)\n+{\n+    if (net.has_value()) {\n+        // Yield to other connection types.\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_needed == 0) {\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_opened >= MAX_SENSITIVE_RELAY_CONNECTIONS) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Requested to open %d connection(s), but there are already %d \"\n+                      \"such connections opened, will wait for some of them to be \"\n+                      \"closed before opening a new one\\n\",\n+                      num_needed,\n+                      num_opened);\n+        net = std::nullopt;\n+        return;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281768350",
      "id" : 1281768350,
      "line" : 1641,
      "node_id" : "PRRC_kwDOABII585MZjue",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 1641,
      "original_position" : 53,
      "original_start_line" : 1631,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 1558788882,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281768350/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1631,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:25:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281768350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281830292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281830292"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "_moving discussion from https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1659008138_\r\n\r\n> 3. Restarting the node and reloading the wallet logged messages about pushing the unbroadcast TXs to the mempool, but I do not think any sensitive-relay connections were triggered to deliver those. Eventually I tried sending another new TX and then, even though only 5 sensitive connections were being opened for that one new TX, over time those connections were used for some of the backlog (\"pretending peer requested tx...\"). Until the 5 sensitive connections dropped down to 0. **update: eventually `ReattemptInitialBroadcast` triggered and the backlog increased the count to 100 sensitive connections\r\n\r\nThis looks to be the same in `master` (I only read the code). Maybe it can be improved. When a new transaction arrives, `BroadcastTransaction()` is called which adds it to the mempool (via `node.mempool->AddUnbroadcastTx()`) and also schedules it for relay (via `node.peerman->ScheduleLocalTxForRelay()`).\r\n\r\nHowever after a restart, `LoadMempool()` only adds it to the mempool (via `pool.AddUnbroadcastTx()`). `BroadcastTransaction()` is not called and neither `ScheduleLocalTxForRelay()` is called.\r\n\r\nThis should improve it:\r\n\r\n<details>\r\n<summary>[patch] relay all unbroadcast transactions at startup</summary>\r\n\r\n```diff\r\ndiff --git i/src/net_processing.cpp w/src/net_processing.cpp\r\nindex b541cba0b9..1300d0daf0 100644\r\n--- i/src/net_processing.cpp\r\n+++ w/src/net_processing.cpp\r\n@@ -510,13 +510,14 @@ public:\r\n     bool ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, !m_recent_confirmed_transactions_mutex, !m_most_recent_block_mutex, !m_headers_presync_mutex, g_msgproc_mutex);\r\n     bool SendMessages(CNode* pto) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, !m_recent_confirmed_transactions_mutex, !m_most_recent_block_mutex, g_msgproc_mutex);\r\n \r\n     /** Implement PeerManager */\r\n-    void StartScheduledTasks(CScheduler& scheduler) override;\r\n+    void StartScheduledTasks(CScheduler& scheduler) override\r\n+        EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n     void CheckForStaleTipAndEvictPeers() override;\r\n     std::optional<std::string> FetchBlock(NodeId peer_id, const CBlockIndex& block_index) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n     bool GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n     bool IgnoresIncomingTxs() override { return m_opts.ignore_incoming_txs; }\r\n     void SendPings() override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n@@ -1869,22 +1870,33 @@ PeerManagerImpl::PeerManagerImpl(CConnman& connman, AddrMan& addrman,\r\n         m_txreconciliation = std::make_unique<TxReconciliationTracker>(TXRECONCILIATION_VERSION);\r\n     }\r\n }\r\n \r\n void PeerManagerImpl::StartScheduledTasks(CScheduler& scheduler)\r\n {\r\n+    AssertLockNotHeld(m_peer_mutex);\r\n+\r\n     // Stale tip checking and peer eviction are on two different timers, but we\r\n     // don't want them to get out of sync due to drift in the scheduler, so we\r\n     // combine them in one function and schedule at the quicker (peer-eviction)\r\n     // timer.\r\n     static_assert(EXTRA_PEER_CHECK_INTERVAL < STALE_CHECK_INTERVAL, \"peer eviction timer should be less than stale tip check timer\");\r\n     scheduler.scheduleEvery([this] { this->CheckForStaleTipAndEvictPeers(); }, std::chrono::seconds{EXTRA_PEER_CHECK_INTERVAL});\r\n \r\n     // schedule next run for 10-15 minutes in the future\r\n     const std::chrono::milliseconds delta = 10min + GetRandMillis(5min);\r\n     scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\r\n+\r\n+    if (m_opts.sensitiverelayowntx) {\r\n+        for (const auto& txid : m_mempool.GetUnbroadcastTxs()) {\r\n+            CTransactionRef tx = m_mempool.get(txid);\r\n+            if (tx != nullptr) {\r\n+                ScheduleLocalTxForRelay(txid, tx->GetWitnessHash());\r\n+            }\r\n+        }\r\n+    }\r\n }\r\n \r\n /**\r\n  * Evict orphan txn pool entries based on a newly connected\r\n  * block, remember the recently confirmed transactions, and delete tracked\r\n  * announcements for them. Also save the time of the last tip update and\r\n```\r\n</details>\r\n\r\nI did not include it in this PR yet. What do you think?\r\n\r\nIt looks like an improvement in `master` too, but I only did it if sensitive relay is used because the purpose of this PR is not to change the behavior when `-sensitiverelayowntx=0` compared to `master`.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:24:35Z",
      "diff_hunk" : "@@ -77,8 +78,14 @@ class PeerManager : public CValidationInterface, public NetEventsInterface\n     /** Whether this node ignores txs received over p2p. */\n     virtual bool IgnoresIncomingTxs() = 0;\n \n-    /** Relay transaction to all peers. */\n-    virtual void RelayTransaction(const uint256& txid, const uint256& wtxid) = 0;\n+    /** Schedule a transaction to be relayed to all peers at a later time. */\n+    virtual void ScheduleTxForRelayToAll(const uint256& txid, const uint256& wtxid) = 0;\n+\n+    /**\n+     * Schedule a local transaction to be relayed. This is done asynchronously\n+     * either via short-lived privacy connections or via `ScheduleTxForRelayToAll()`.\n+     */\n+    virtual void ScheduleLocalTxForRelay(const uint256& txid, const uint256& wtxid) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281830292",
      "id" : 1281830292,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII585MZy2U",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 90,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 30,
      "pull_request_review_id" : 1558788882,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281830292/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:25:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281830292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`2541f09439...6e6f83b0f7`: rebase due to conflicts and address some suggestions and issues. Also ditch `UseSensitiveRelay()` and use `m_opts.sensitiverelayowntx` directly.",
      "created_at" : "2023-08-02T12:38:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1662136231",
      "id" : 1662136231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585jEi-n",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1662136231/reactions"
      },
      "updated_at" : "2023-08-02T12:38:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1662136231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281846678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281846678"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:39:31Z",
      "diff_hunk" : "@@ -3576,6 +3716,19 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         pfrom.fSuccessfullyConnected = true;\n+\n+        if (pfrom.IsSensitiveRelayConn()) {\n+            // The peer may intend to later send us NetMsgType::FEEFILTER limiting\n+            // cheap transactions, but we don't wait for that and thus we may send\n+            // them a transaction below their threshold. This is ok because this\n+            // relay logic is designed to work even in cases when the peer drops\n+            // the transaction (due to it being too cheap, or for other reasons).\n+            PushUnbroadcastTxToSensistiveRelay(pfrom, *peer, interruptMsgProc);\n+\n+            peer->m_ping_queued = true; // Ensure a ping will be send: mimick a request via RPC.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281846678",
      "id" : 1281846678,
      "in_reply_to_id" : 1279655081,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MZ22W",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 3728,
      "original_position" : 428,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1558915601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281846678/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:39:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281846678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281847092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281847092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:39:52Z",
      "diff_hunk" : "@@ -2851,6 +2951,22 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     AssertLockNotHeld(m_total_bytes_sent_mutex);\n+\n+    if (pnode->IsSensitiveRelayConn() &&\n+        msg.m_type != NetMsgType::VERSION &&\n+        msg.m_type != NetMsgType::VERACK &&\n+        msg.m_type != NetMsgType::TX &&\n+        msg.m_type != NetMsgType::PING) {\n+        // Ensure sensitive relay connections only send VERSION, VERACK, TX or PING. Others are not needed and may degrade privacy.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281847092",
      "id" : 1281847092,
      "in_reply_to_id" : 1279295208,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MZ280",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 2960,
      "original_position" : 316,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1558916261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281847092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:39:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281847092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281847815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281847815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Moved, thanks!",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:40:35Z",
      "diff_hunk" : "@@ -49,6 +49,8 @@ class CNode;\n class CScheduler;\n struct bilingual_str;\n \n+/** Default for -sensitiverelayowntx. */\n+static const bool DEFAULT_SENSITIVE_RELAY_OWN_TX{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281847815",
      "id" : 1281847815,
      "in_reply_to_id" : 1279166534,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MZ3IH",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 53,
      "original_position" : 5,
      "original_start_line" : 52,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1558917449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281847815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281847815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281851228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281851228"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good! This should be moved a bit below, after the transaction has been added to the mempool: `const MempoolAcceptResult result = m_chainman.ProcessTransaction(ptx);` and conditional on `result`.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:43:41Z",
      "diff_hunk" : "@@ -4144,6 +4309,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         m_txrequest.ReceivedResponse(pfrom.GetId(), txid);\n         if (tx.HasWitness()) m_txrequest.ReceivedResponse(pfrom.GetId(), wtxid);\n \n+        if (UseSensitiveRelay() && m_mempool.RemoveUnbroadcastTx(txid)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281851228",
      "id" : 1281851228,
      "in_reply_to_id" : 1279194945,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MZ39c",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 4312,
      "original_position" : 458,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1558922898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281851228/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281851228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281854368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281854368"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes. This is the case for all connections - if the peer goes silent, but does not close the connection, then we will close it after 20 minutes. Do you think that is not suitable for sensitive relay connections? If yes, what to do better?",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:46:27Z",
      "diff_hunk" : "@@ -4760,6 +4942,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281854368",
      "id" : 1281854368,
      "in_reply_to_id" : 1279206967,
      "line" : 4936,
      "node_id" : "PRRC_kwDOABII585MZ4ug",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 4936,
      "original_position" : 500,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 484,
      "pull_request_review_id" : 1558927828,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281854368/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281854368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281863833"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281863833"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For sensitive relay connections it is not possible to fingerprint based on the version handshake or any other messages exchanged (see the OP under \"The messages exchange should look like this\").\r\n\r\nThe only non-constant in the `VERSION` message we send is the peer nonce, then `VERACK` has no payload and the only payload in the `PING` is the ping nonce.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:54:06Z",
      "diff_hunk" : "@@ -3698,6 +3851,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281863833",
      "id" : 1281863833,
      "in_reply_to_id" : 1279227800,
      "line" : 3845,
      "node_id" : "PRRC_kwDOABII585MZ7CZ",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 3845,
      "original_position" : 439,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 423,
      "pull_request_review_id" : 1558942431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281863833/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:54:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281863833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281864257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281864257"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh for some reason I thought our ping timeout was smaller than `TIMEOUT_INTERVAL` (turns out it's the same). Feel free to consider this a nit.\r\n\r\nBut I think it would be reasonable for these connections to timeout much quicker anyway, since we don't care about keeping them around. ",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T12:54:23Z",
      "diff_hunk" : "@@ -4760,6 +4942,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281864257",
      "id" : 1281864257,
      "in_reply_to_id" : 1279206967,
      "line" : 4936,
      "node_id" : "PRRC_kwDOABII585MZ7JB",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 4936,
      "original_position" : 500,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 484,
      "pull_request_review_id" : 1558942969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281864257/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T12:54:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281864257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281871273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281871273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> The only non-constant in the VERSION message we send is the peer nonce\r\n\r\nYes and this can be used for fingerprinting, because we disconnect incoming connections that match an already existing nonce.\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/2fa60f0b683cefd7956273986dafe3bde00c98fd/src/net_processing.cpp#L3361-L3366\r\n\r\nAnd I wouldn't be surprised if there are more ways to fingerprint in the version handshake. This will also end up being a maintenance concern going forward, mostly as a burden for reviewers as it's hard to test for these things.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T13:00:05Z",
      "diff_hunk" : "@@ -3698,6 +3851,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1281871273",
      "id" : 1281871273,
      "in_reply_to_id" : 1279227800,
      "line" : 3845,
      "node_id" : "PRRC_kwDOABII585MZ82p",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 3845,
      "original_position" : 439,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 423,
      "pull_request_review_id" : 1558954481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281871273/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T13:00:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281871273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282340187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282340187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2023-08-02T19:32:23Z [sensitiverelay:debug]\r\n  Request for 5 new connections, incremented the number of connections to open from 90 to 95\r\n```\r\n\r\nand,\r\n\r\n```\r\n2023-08-02T19:58:39Z [sensitiverelay:debug] Requested to open 170 connection(s), trying to open one\r\n```",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T19:33:31Z",
      "diff_hunk" : "@@ -1605,6 +1606,59 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+/**\n+ * Decide whether to open a sensitive relay connection and if yes, to which network.\n+ * @param[in,out] net When called, this should have a value if the previous attempt\n+ * to open a connection was sensitive relay (successful or not). When the function\n+ * ends if this has value then it will contain the network to which to open the\n+ * connection.\n+ * @param[in] num_needed Number of sensitive relay connections that need to be opened.\n+ * @param[in] num_opened Number of sensitive relay connections that are currently opened.\n+ */\n+static void MaybePickSensitiveRelayNetwork(std::optional<Network>& net, size_t num_needed, size_t num_opened)\n+{\n+    if (net.has_value()) {\n+        // Yield to other connection types.\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_needed == 0) {\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_opened >= MAX_SENSITIVE_RELAY_CONNECTIONS) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Requested to open %d connection(s), but there are already %d \"\n+                      \"such connections opened, will wait for some of them to be \"\n+                      \"closed before opening a new one\\n\",\n+                      num_needed,\n+                      num_opened);\n+        net = std::nullopt;\n+        return;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282340187",
      "id" : 1282340187,
      "in_reply_to_id" : 1281768350,
      "line" : 1641,
      "node_id" : "PRRC_kwDOABII585MbvVb",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 1641,
      "original_position" : 53,
      "original_start_line" : 1631,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 1559717710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282340187/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1631,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-02T19:59:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282340187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282341818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282341818"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I meant, if IPv4 and Tor are the only reachable networks, that Tor connections would *only* be made for sensitive relay connections. That's why I tried `-onlynet=ipv4 -sensitiverelayowntx=1`",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T19:35:33Z",
      "diff_hunk" : "@@ -1853,6 +1873,22 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX)) {\n+        // If -listenonion is set, then NET_ONION may not be reachable now\n+        // but may become reachable later, thus only error here if it is not\n+        // reachable and will not become reachable for sure.\n+        if (!IsReachable(NET_I2P) && !IsReachable(NET_ONION) && !listenonion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282341818",
      "id" : 1282341818,
      "in_reply_to_id" : 1281726530,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mbvu6",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 1880,
      "original_position" : 82,
      "original_start_line" : 1876,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1559720352,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282341818/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-02T19:35:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282341818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282412077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282412077"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's up to `332` now, after 45 min the wallet tried another rebroadcast. Also worth noting that so far none of these signet TXs are coming back to me, appearing on signet explorers, or reducing the mempool unbroadcastcount. I'll try to figure out why thats not working.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-02T20:57:19Z",
      "diff_hunk" : "@@ -1605,6 +1606,59 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+/**\n+ * Decide whether to open a sensitive relay connection and if yes, to which network.\n+ * @param[in,out] net When called, this should have a value if the previous attempt\n+ * to open a connection was sensitive relay (successful or not). When the function\n+ * ends if this has value then it will contain the network to which to open the\n+ * connection.\n+ * @param[in] num_needed Number of sensitive relay connections that need to be opened.\n+ * @param[in] num_opened Number of sensitive relay connections that are currently opened.\n+ */\n+static void MaybePickSensitiveRelayNetwork(std::optional<Network>& net, size_t num_needed, size_t num_opened)\n+{\n+    if (net.has_value()) {\n+        // Yield to other connection types.\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_needed == 0) {\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_opened >= MAX_SENSITIVE_RELAY_CONNECTIONS) {\n+        LogPrintLevel(BCLog::SENSITIVE_RELAY, /* Continued */\n+                      BCLog::Level::Debug,\n+                      \"Requested to open %d connection(s), but there are already %d \"\n+                      \"such connections opened, will wait for some of them to be \"\n+                      \"closed before opening a new one\\n\",\n+                      num_needed,\n+                      num_opened);\n+        net = std::nullopt;\n+        return;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282412077",
      "id" : 1282412077,
      "in_reply_to_id" : 1281768350,
      "line" : 1641,
      "node_id" : "PRRC_kwDOABII585McA4t",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 1641,
      "original_position" : 53,
      "original_start_line" : 1631,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 1559832228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282412077/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1631,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-02T20:57:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282412077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282771837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282771837"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"we disconnect incoming connections that match an already existing nonce\" _but only for connections with incomplete handshake_. So the spy has to try to connect back to the node copying the nonce before they send ther `VERACK`, ie before they know this is a sensitive relay connection.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-03T07:31:46Z",
      "diff_hunk" : "@@ -3698,6 +3851,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282771837",
      "id" : 1282771837,
      "in_reply_to_id" : 1279227800,
      "line" : 3845,
      "node_id" : "PRRC_kwDOABII585MdYt9",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 3845,
      "original_position" : 439,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 423,
      "pull_request_review_id" : 1560417984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282771837/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T07:31:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282771837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282776719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282776719"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, I did not consider that.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-03T07:35:46Z",
      "diff_hunk" : "@@ -1853,6 +1873,22 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-sensitiverelayowntx\", DEFAULT_SENSITIVE_RELAY_OWN_TX)) {\n+        // If -listenonion is set, then NET_ONION may not be reachable now\n+        // but may become reachable later, thus only error here if it is not\n+        // reachable and will not become reachable for sure.\n+        if (!IsReachable(NET_I2P) && !IsReachable(NET_ONION) && !listenonion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1282776719",
      "id" : 1282776719,
      "in_reply_to_id" : 1281726530,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MdZ6P",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 1880,
      "original_position" : 82,
      "original_start_line" : 1876,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1560425910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282776719/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-03T07:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282776719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1283311586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283311586"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> So the spy has to try to connect back to the node copying the nonce before they send ther VERACK, ie before they know this is a sensitive relay connection.\r\n\r\nThey know it's likely a sensitive relay connection based on the version message they receive. So they withhold their verack on that connection and then keep connecting and sending version messages to all public addresses until they found the node that disconnects them for sending the right nonce. After that they can send the verack and receive the tx.",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-03T14:42:59Z",
      "diff_hunk" : "@@ -3698,6 +3851,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (pfrom.IsSensitiveRelayConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1283311586",
      "id" : 1283311586,
      "in_reply_to_id" : 1279227800,
      "line" : 3845,
      "node_id" : "PRRC_kwDOABII585Mfcfi",
      "original_commit_id" : "7a3206dc8e4c4ca2c7b66f9ccbfaafc4bd829240",
      "original_line" : 3845,
      "original_position" : 439,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 423,
      "pull_request_review_id" : 1561268055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283311586/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T14:43:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283311586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1283345857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283345857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "OK I see. In that case, it can be a follow-up. Probably there is some reason we keep the scheduler and don't resend right on startup (we wouldn't want spy nodes detecting our restart! ...?)",
      "commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "created_at" : "2023-08-03T15:08:10Z",
      "diff_hunk" : "@@ -77,8 +78,14 @@ class PeerManager : public CValidationInterface, public NetEventsInterface\n     /** Whether this node ignores txs received over p2p. */\n     virtual bool IgnoresIncomingTxs() = 0;\n \n-    /** Relay transaction to all peers. */\n-    virtual void RelayTransaction(const uint256& txid, const uint256& wtxid) = 0;\n+    /** Schedule a transaction to be relayed to all peers at a later time. */\n+    virtual void ScheduleTxForRelayToAll(const uint256& txid, const uint256& wtxid) = 0;\n+\n+    /**\n+     * Schedule a local transaction to be relayed. This is done asynchronously\n+     * either via short-lived privacy connections or via `ScheduleTxForRelayToAll()`.\n+     */\n+    virtual void ScheduleLocalTxForRelay(const uint256& txid, const uint256& wtxid) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1283345857",
      "id" : 1283345857,
      "in_reply_to_id" : 1281830292,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII585Mfk3B",
      "original_commit_id" : "2541f09439099ec3e73f7c5a12f809f190e6af1d",
      "original_line" : 90,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 30,
      "pull_request_review_id" : 1561320176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283345857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T15:08:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283345857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1284610972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284610972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "_moving discussion from https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1659008138_\r\n\r\n> 4. Finally, on signet I never got an INV for one of my own txs back. so getmempoolinfo : unbroadcastcount only ever increased. I notice that the tests only use python P2PInterface()'s for peers and the observer_outbound peer and is manually forced to inv our txid... makes me wonder if real bitcoind peers have different enough relay behavior that it doesnt work as well in production. For example, we pretend our sensitive relay peers requested a tx when they didn't. Does bitcoind still relay TXs it didn't getdata for? Also I suppose given that some of my signet TXs weren't going out, there could be an issue with orphans and peers that are missing my parents. I may try writing tests with more network bitcoind nodes, or set it up locally but routed through Tor.\r\n\r\nThe witness was not serialized, so the recipients rejected the transaction :face_with_spiral_eyes: I fixed this and updated the test to catch cases where `bitcoind` would not accept or further relay the transaction to other peers. Now the test has one more `bitcoind`, which is used as a recipient.",
      "commit_id" : "36074c093b3649b45e265e351afa95c85d04af68",
      "created_at" : "2023-08-04T16:13:29Z",
      "diff_hunk" : "@@ -4144,6 +4300,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         m_txrequest.ReceivedResponse(pfrom.GetId(), txid);\n         if (tx.HasWitness()) m_txrequest.ReceivedResponse(pfrom.GetId(), wtxid);\n \n+        if (m_opts.sensitiverelayowntx && m_mempool.RemoveUnbroadcastTx(txid)) {\n+            LogPrintLevel( /* Continued */\n+                BCLog::SENSITIVE_RELAY,\n+                BCLog::Level::Info,\n+                \"Received own transaction (txid=%s) from the network from peer=%d%s; \"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1284610972",
      "id" : 1284610972,
      "line" : 4326,
      "node_id" : "PRRC_kwDOABII585MkZuc",
      "original_commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "original_line" : 4307,
      "original_position" : 446,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 465,
      "pull_request_review_id" : 1563183234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284610972/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T16:13:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284610972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`6e6f83b0f7...36074c093b`: rebase, fix a bug where [we sent the transaction without the witness](https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1284610972), and extend the test to cover that",
      "created_at" : "2023-08-04T16:15:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1665867224",
      "id" : 1665867224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585jSx3Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1665867224/reactions"
      },
      "updated_at" : "2023-08-04T16:15:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1665867224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1284699462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284699462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ðº  ah nice! I thought there might be something wrong with the transactions themselves, but when I restarted without sensitive relay everything broadcast fine. I didn't think of serialization being the issue! So, great catch.",
      "commit_id" : "36074c093b3649b45e265e351afa95c85d04af68",
      "created_at" : "2023-08-04T17:49:57Z",
      "diff_hunk" : "@@ -4144,6 +4300,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         m_txrequest.ReceivedResponse(pfrom.GetId(), txid);\n         if (tx.HasWitness()) m_txrequest.ReceivedResponse(pfrom.GetId(), wtxid);\n \n+        if (m_opts.sensitiverelayowntx && m_mempool.RemoveUnbroadcastTx(txid)) {\n+            LogPrintLevel( /* Continued */\n+                BCLog::SENSITIVE_RELAY,\n+                BCLog::Level::Info,\n+                \"Received own transaction (txid=%s) from the network from peer=%d%s; \"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1284699462",
      "id" : 1284699462,
      "in_reply_to_id" : 1284610972,
      "line" : 4326,
      "node_id" : "PRRC_kwDOABII585MkvVG",
      "original_commit_id" : "6e6f83b0f788376a3b9720c5e0e4e48e6770431b",
      "original_line" : 4307,
      "original_position" : 446,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 465,
      "pull_request_review_id" : 1563324428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284699462/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T17:49:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284699462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-08-06T17:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1666931788",
      "id" : 1666931788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585jW1xM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1666931788/reactions"
      },
      "updated_at" : "2023-08-06T17:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1666931788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild Re your question on IRC about the wallet when not adding the tx to the mempool: Not counting non-mempool change is a pre-existing issue with the wallet, and I think should be fixed unrelated to this pull request. As I said previously, this can be observed with current wallet settings, see https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1660280410. So I think all you'd need to do here is add yet another setting to the wallet (disabled by default) to enable this feature.\r\n\r\nConceptually, it seems easier to fix, review and test the local wallet issue about counting change, than it is to fix the remote p2p behavior of withholding or supplying transactions that are in or out of the mempool.\r\n\r\n",
      "created_at" : "2023-08-31T14:33:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1701168556",
      "id" : 1701168556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585lZcWs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1701168556/reactions"
      },
      "updated_at" : "2023-08-31T14:33:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1701168556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm noticing this in the log when sending a tx:\r\n\r\n> 2023-09-12 10:12:40 2023-09-12T14:12:40Z [miner] Submitting wtx 86a83ee7c540e833b1132969f13ce770adae8f80e50bba6038eaec6ff1185657 to mempool for relay\r\n\r\nbut we are not actually submitting anything to the mempool, right ...?\r\n\r\nOr yes we are but not to the part of the mempool where we relay to peers over clear net? (i.e. is that what \"m_unbroadcast_txids\" is?)",
      "created_at" : "2023-09-12T14:14:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1715810973",
      "id" : 1715810973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585mRTKd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715810973/reactions"
      },
      "updated_at" : "2023-09-12T14:15:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715810973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@pinheadmz that log is from before this PR and I did not modify it. It is true that right now on `master` and on this PR the transaction is added to the mempool and also, in addition to `m_unbroadcast_txids`. Thus I think the message is ok.\r\n\r\nHowever, given the feedback above and on IRC, I will change this to not add the transaction to the mempool. I am just figuring out how to exactly handle it. Then this message \"Submitting ... to mempool for relay\" would be inaccurate. It is a good opportunity to discuss this f2f.",
      "created_at" : "2023-09-13T08:01:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1717137820",
      "id" : 1717137820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585mWXGc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717137820/reactions"
      },
      "updated_at" : "2023-09-13T08:01:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717137820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1327681911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327681911"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe `-walletsensitiverelay`?",
      "commit_id" : "36074c093b3649b45e265e351afa95c85d04af68",
      "created_at" : "2023-09-15T19:08:38Z",
      "diff_hunk" : "@@ -600,6 +600,7 @@ void SetupServerArgs(ArgsManager& argsman)\n                    OptionsCategory::NODE_RELAY);\n     argsman.AddArg(\"-minrelaytxfee=<amt>\", strprintf(\"Fees (in %s/kvB) smaller than this are considered zero fee for relaying, mining and transaction creation (default: %s)\",\n         CURRENCY_UNIT, FormatMoney(DEFAULT_MIN_RELAY_TX_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);\n+    argsman.AddArg(\"-sensitiverelayowntx\", strprintf(\"Relay locally submitted transactions via short lived connections to Tor or I2P for improved privacy. There are two aspects of this - linking transaction-origin/Bitcoin-owner with IP-address/geolocation and linking seemingly unrelated transactions to the same owner/origin (this applies even if the node is running in tor-only mode) (default: %u)\", DEFAULT_SENSITIVE_RELAY_OWN_TX), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1327681911",
      "id" : 1327681911,
      "line" : 603,
      "node_id" : "PRRC_kwDOABII585PItF3",
      "original_commit_id" : "36074c093b3649b45e265e351afa95c85d04af68",
      "original_line" : 603,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 1629563247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327681911/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T19:08:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327681911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "we discussed this proposal in person, and I wanted to share some of my current thoughts here: \r\n- I agree with the alternate approach to keep the transaction out of the mempool. it's very difficult to ensure that there aren't any information leaks, and even if we are able to achieve that with the current code, it is unrealistic to be able to maintain that over time \r\n- the idea of starting via RPC submission only seems like a good way to incrementally develop this feature \r\n- in the current implementation, we schedule opening 5 connections per transaction, but then there's randomness around which one of the transactions each connection decides to broadcast. this could lead to a lot of variability if there are multiple transactions queued around the same time, which doesn't seem desirable. It makes more sense to me for there to be a direct mapping\r\n\r\n@vasild \r\n>  I will change this to not add the transaction to the mempool. I am just figuring out how to exactly handle it.\r\n\r\nmy recommendation is to make this PR a draft until you have a new proposal and are ready for further review. happy to take a look when the new approach is figured out :) ",
      "created_at" : "2023-09-29T21:01:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1741483846",
      "id" : 1741483846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585nzO9G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741483846/reactions"
      },
      "updated_at" : "2023-09-29T21:01:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741483846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Looking for the next actions w.r.t not adding to the mempool.",
      "created_at" : "2023-10-02T09:37:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1742700208",
      "id" : 1742700208,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585n336w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1742700208/reactions"
      },
      "updated_at" : "2023-10-02T09:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1742700208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2023-12-31T01:54:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1872647725",
      "id" : 1872647725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
      "node_id" : "IC_kwDOABII585vnlYt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1872647725/reactions"
      },
      "updated_at" : "2023-12-31T01:54:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1872647725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
