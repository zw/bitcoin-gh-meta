[
   {
      "author_association" : "MEMBER",
      "body" : "I experienced this as well.",
      "created_at" : "2023-05-07T09:14:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537366596",
      "id" : 1537366596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bolpE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537366596/reactions"
      },
      "updated_at" : "2023-05-07T09:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537366596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Been seeing this on my 24.0.1 public nodes as well, it's not 100% CPU usage as such, but a single CPU core is spinning at 100%. One 24.0.1 node with listen=0 did not seem affected.\r\n\r\nI noticed that after a node restart, the CPU usage went back to normal (and is still normal after a day) even though the mempool was loaded from disk - though it might be because it's no longer entirely full due to mempoolminfee.\r\n\r\nPS: These nodes do **not** run in debug mode.",
      "created_at" : "2023-05-07T18:39:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537513884",
      "id" : 1537513884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpJmc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537513884/reactions"
      },
      "updated_at" : "2023-05-07T18:50:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537513884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just to confirm, yours was in debug mode as well? Otherwise it'd be concerning.\n\n-------- Original Message --------\nOn May 7, 2023, 8:39 PM, ArmchairCryptologist wrote:\n\n> Been seeing this on my 24.0.1 public nodes as well, it's not 100% CPU usage as such, but a single CPU core is spinning at 100%. One 24.0.1 node with listen=0 did not seem affected.\n>\n> I noticed that after a node restart, the CPU usage went back to normal (and is still normal after a day) even though the mempool was loaded from disk - though it might be because it's not entirely full.\n>\n> â\n> Reply to this email directly, [view it on GitHub](https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537513884), or [unsubscribe](https://github.com/notifications/unsubscribe-auth/AFLK3F7KEP44Z6OFB25VRUDXE7T6FANCNFSM6AAAAAAXXYXUTA).\n> You are receiving this because you commented.Message ID: ***@***.***>",
      "created_at" : "2023-05-07T20:17:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537531968",
      "id" : 1537531968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpOBA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537531968/reactions"
      },
      "updated_at" : "2023-05-07T20:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537531968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Just to confirm, yours was in debug mode as well? Otherwise it'd be concerning.\r\n\r\nMy nodes are NOT in debug mode, no. I run four public nodes (24.0.1) with different server hosts, and all four of them were spinning a CPU core at 100% and experiencing slowness with block/transaction handling when I checked them yesterday, two to the point where they started occasionally dropping connectivity to my private nodes. Like I mentioned, one 24.0.1 node which does not accept incoming connections (but is connected to untrusted nodes) did not have this issue. The other private nodes still run 23.0.0 and also do not have any issues, though these only connect through my own public nodes so they aren't directly exposed to untrusted nodes.",
      "created_at" : "2023-05-07T20:29:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537534014",
      "id" : 1537534014,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpOg-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537534014/reactions"
      },
      "updated_at" : "2023-05-07T20:29:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537534014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> PS: These nodes do **not** run in debug mode.\r\n\r\nWith the issue I described here patched around, I see a different problem that also results in b-msghand using ~100% of a single cpu. It seems to be spent in `make_heap` in `net_processing.cpp` which in turn seems to be due to the internal queues for which txs need to be INVed to which peers growing much too large (I've observed >60,000 entries in each of 6 peers, eg). It seems to be exacerbated by a combination of inbound peers that aren't really relaying transactions (so the queue is only being cleared when we send things, so effectively half or a third of the rate compared to if they were sending INVs as well) and other peers sending txs to us at a rate much faster than the network can actually support.\r\n\r\nThat's a different bug though, so I'll open it up as a different issue after getting some better data...",
      "created_at" : "2023-05-07T21:31:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537544963",
      "id" : 1537544963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpRMD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537544963/reactions"
      },
      "updated_at" : "2023-05-07T21:31:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537544963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, if anyone wants to mitigate the `make_heap` thing; I think something like:\r\n\r\n```sh\r\n$ bitcoin-cli getpeerinfo | jq -j '.[] | (.bytessent_per_msg.inv, \" \", .bytesrecv_per_msg.inv, \" \", .addr, \"\\n\")' | grep ' null ' | sort -n\r\n```\r\n\r\nshould list the nodes where you're sending lots of inv data, without receiving anything in return. Doing a temporary \"setban\" on those to disconnect them will clear their inv queue and should speed things up temporarily.",
      "created_at" : "2023-05-07T21:37:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537545897",
      "id" : 1537545897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpRap",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537545897/reactions"
      },
      "updated_at" : "2023-05-07T21:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537545897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Of the four nodes, the one that was restarted on May 6th is now back to spinning 100% of a CPU core (60% average CPU usage on a two-core VM the last hour) while the three that were restarted yesterday are also seeing high CPU usage but not 100% all the time (between 30% and 38% average CPU usage on a two-core VM), so it's building back up relatively quickly. I also verified that the mempool is not fully committed (usage is at 251217552).\r\n\r\nThere were around 15 peers with bytessent_per_msg.inv over 100000 without any received ones, but even after doing setban on them and verifying that they have been disconnected, the CPU usage did not drop noticeably if at all. This is probably because the node has 180 connected peers, and 140+ of those have both bytessent_per_msg.inv and bytesrecv_per_msg.inv over 100000, so disconnecting 15 of them for not sending any probably doesn't do much..\r\n\r\nBased on what you say about it being a different bug I assume that it is not an issue introduced with 24.0, but I reverted one of the nodes to 23.0 just to verify.",
      "created_at" : "2023-05-08T05:43:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537784340",
      "id" : 1537784340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bqLoU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537784340/reactions"
      },
      "updated_at" : "2023-05-08T05:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537784340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Just to confirm, yours was in debug mode as well? Otherwise it'd be concerning.\r\n\r\nWhat is debug mode? A binary compiled with `--enable-debug` option or `debug=1` saved in bitcoin.conf?\r\n",
      "created_at" : "2023-05-08T07:27:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537886785",
      "id" : 1537886785,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bqkpB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537886785/reactions"
      },
      "updated_at" : "2023-05-08T07:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537886785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/131737050?v=4",
         "events_url" : "https://api.github.com/users/localbool/events{/privacy}",
         "followers_url" : "https://api.github.com/users/localbool/followers",
         "following_url" : "https://api.github.com/users/localbool/following{/other_user}",
         "gists_url" : "https://api.github.com/users/localbool/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/localbool",
         "id" : 131737050,
         "login" : "localbool",
         "node_id" : "U_kgDOB9ol2g",
         "organizations_url" : "https://api.github.com/users/localbool/orgs",
         "received_events_url" : "https://api.github.com/users/localbool/received_events",
         "repos_url" : "https://api.github.com/users/localbool/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/localbool/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/localbool/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/localbool"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What is debug mode? A binary compiled with `--enable-debug` option or `debug=1` saved in bitcoin.conf?\n> \n> \n\nCompiled with `--enable-debug`",
      "created_at" : "2023-05-08T07:28:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537887983",
      "id" : 1537887983,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bqk7v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537887983/reactions"
      },
      "updated_at" : "2023-05-08T07:28:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537887983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Same issue with 24.0.1 node today and went back to normal after daemon reload. My node do NOT run in debug mode too.",
      "created_at" : "2023-05-08T19:07:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1538897495",
      "id" : 1538897495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bubZX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538897495/reactions"
      },
      "updated_at" : "2023-05-08T19:07:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538897495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25859850?v=4",
         "events_url" : "https://api.github.com/users/disappointed72/events{/privacy}",
         "followers_url" : "https://api.github.com/users/disappointed72/followers",
         "following_url" : "https://api.github.com/users/disappointed72/following{/other_user}",
         "gists_url" : "https://api.github.com/users/disappointed72/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/disappointed72",
         "id" : 25859850,
         "login" : "disappointed72",
         "node_id" : "MDQ6VXNlcjI1ODU5ODUw",
         "organizations_url" : "https://api.github.com/users/disappointed72/orgs",
         "received_events_url" : "https://api.github.com/users/disappointed72/received_events",
         "repos_url" : "https://api.github.com/users/disappointed72/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/disappointed72/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/disappointed72/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/disappointed72"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have the same problem. `bitcoind` started using 100% cpu (single thread) on my servers. I used the binary from https://bitcoincore.org/bin/bitcoin-core-24.0.1/bitcoin-24.0.1-x86_64-linux-gnu.tar.gz\r\n\r\n<img src=\"https://img.poiuty.com/a/3c/c68204e690ae2d605cfd60e03eee0f3c.jpg\">\r\n\r\nBuilt bitcoind from source (v24.0.1.tar.gz). Works fine for an hour now.\r\n```\r\n./configure --without-gui --disable-zmq --disable-wallet\r\n```\r\n\r\n<img src=\"https://img.poiuty.com/a/7b/5234d849fcf5248c4a1adaf5011bc57b.jpg\">",
      "created_at" : "2023-05-08T20:09:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1538980020",
      "id" : 1538980020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585buvi0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538980020/reactions"
      },
      "updated_at" : "2023-05-08T20:09:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538980020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3885951?v=4",
         "events_url" : "https://api.github.com/users/poiuty/events{/privacy}",
         "followers_url" : "https://api.github.com/users/poiuty/followers",
         "following_url" : "https://api.github.com/users/poiuty/following{/other_user}",
         "gists_url" : "https://api.github.com/users/poiuty/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/poiuty",
         "id" : 3885951,
         "login" : "poiuty",
         "node_id" : "MDQ6VXNlcjM4ODU5NTE=",
         "organizations_url" : "https://api.github.com/users/poiuty/orgs",
         "received_events_url" : "https://api.github.com/users/poiuty/received_events",
         "repos_url" : "https://api.github.com/users/poiuty/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/poiuty/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/poiuty/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/poiuty"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Same issue with 24.0.1 node today and went back to normal after daemon reload. My node do NOT run in debug mode too.\r\n\r\nSame here since yesterday, using the 24.0.1 binaries NOT running in debug mode. (Binaries from https://bitcoincore.org/bin/bitcoin-core-24.0.1/bitcoin-24.0.1-x86_64-linux-gnu.tar.gz). I didn't restart the node, but used the setban approach as pointed out here https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537784340\r\n\r\nSince then, the single core load has decreased to 45% without restart and made the node cli and RPC calls responsive again, regardless of mempool allocation peaking at 300MB. So this has brought relief to some extent.\r\n\r\nUsing this command to identify those peers: `bitcoin-cli getpeerinfo | jq -r '.[] | if (.bytessent_per_msg.inv > 100000 and .bytesrecv_per_msg.inv == null) then .addr else empty end'`\r\n",
      "created_at" : "2023-05-08T20:29:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1539007849",
      "id" : 1539007849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bu2Vp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1539007849/reactions"
      },
      "updated_at" : "2023-05-08T20:34:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1539007849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6901486?v=4",
         "events_url" : "https://api.github.com/users/golden-guy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/golden-guy/followers",
         "following_url" : "https://api.github.com/users/golden-guy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/golden-guy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/golden-guy",
         "id" : 6901486,
         "login" : "golden-guy",
         "node_id" : "MDQ6VXNlcjY5MDE0ODY=",
         "organizations_url" : "https://api.github.com/users/golden-guy/orgs",
         "received_events_url" : "https://api.github.com/users/golden-guy/received_events",
         "repos_url" : "https://api.github.com/users/golden-guy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/golden-guy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/golden-guy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/golden-guy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The above command on my listening node (running a mess of commits on top of master from ~March) returns localhost (probably my mempool instance) plus 10 other peers. Five of those are universities (e.g. [DNS Bitcoin Monitoring](https://www.dsn.kastel.kit.edu/bitcoin/data.html), 3 Digital Ocean. Some of them are bitcoinj wallets, i.e. you wouldn't expect them to relay anything to us (except perhaps if they make a transaction).\r\n\r\nCPU use looks normal to me, it's not compiled with --enable-debug. Last restart was 3 days ago. I also have `peerbloomfilters=0` (default since v0.19).\r\n\r\n",
      "created_at" : "2023-05-09T08:28:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1539677521",
      "id" : 1539677521,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bxZ1R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1539677521/reactions"
      },
      "updated_at" : "2023-05-09T09:02:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1539677521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Just to confirm, after a day or so I'm seeing the same kind of CPU load increasing over time with the node I downgraded to 23.0.0, so this other issue probably was not introduced with 24.0.1.\r\n\r\nReducing maxconnections to a low-ish number (100 or less) seems to at least significantly delay the problem, though I can't say yet whether it'll mitigate it entirely. 150-200 is definitely causing issues on a 4 GHz Xeon.\r\n\r\n> I didn't restart the node, but used the setban approach as pointed out here https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537784340\r\n\r\nThat comment was actually a reply to a comment by @ajtowns who pointed that out as a possible mitigation to a potential issue he identified, but said comment seems to have been removed (too much information?), so it probably seems somewhat out-of-context.",
      "created_at" : "2023-05-09T09:27:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1539774342",
      "id" : 1539774342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bxxeG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1539774342/reactions"
      },
      "updated_at" : "2023-05-09T09:31:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1539774342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ArmchairCryptologist do you have `peerbloomfilters` on?",
      "created_at" : "2023-05-09T11:56:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1540014195",
      "id" : 1540014195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bysBz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540014195/reactions"
      },
      "updated_at" : "2023-05-09T11:56:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540014195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @ArmchairCryptologist do you have peerbloomfilters on?\r\n\r\nNope. The nodes are pretty much running with the default settings except for maxconnections. But like I mentioned earlier, I'm only seeing this on well-connected public nodes, so if you get <100 incoming connections you might not be having this issue.",
      "created_at" : "2023-05-09T12:16:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1540022998",
      "id" : 1540022998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585byuLW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540022998/reactions"
      },
      "updated_at" : "2023-05-09T12:19:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540022998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This is true for 2 (two) full nodes that run with `pruning` off, `peerbloomfilters` off, `maxmempool` set to 2048 and `maxconnections` set to 500, where both have an average between 170 and 225 active peers.  They are also **NOT** in debug mode, but still affected by abnormally high CPU usage and RAM consumption.\r\n\r\nBoth use fairly reasonable CPUs and are at 100% CPU usage and a lot of RAM (like 8GB only bitcoind). For reference:\r\n\r\n  \"connections\": 222,\r\n  \"connections_in\": 212,\r\n  \"connections_out\": 10,\r\n\r\n![bitcoind-res](https://github.com/bitcoin/bitcoin/assets/6549887/c0c43907-ca26-4af7-bedc-4058f0660370)\r\n",
      "created_at" : "2023-05-09T15:09:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1540339751",
      "id" : 1540339751,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bz7gn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540339751/reactions"
      },
      "updated_at" : "2023-05-09T15:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540339751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6549887?v=4",
         "events_url" : "https://api.github.com/users/gits7r/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gits7r/followers",
         "following_url" : "https://api.github.com/users/gits7r/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gits7r/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gits7r",
         "id" : 6549887,
         "login" : "gits7r",
         "node_id" : "MDQ6VXNlcjY1NDk4ODc=",
         "organizations_url" : "https://api.github.com/users/gits7r/orgs",
         "received_events_url" : "https://api.github.com/users/gits7r/received_events",
         "repos_url" : "https://api.github.com/users/gits7r/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gits7r/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gits7r/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gits7r"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This is true for 2 (two) full nodes that run with pruning off, peerbloomfilters off, maxmempool set to 2048 and maxconnections set to 500, where both have an average between 170 and 225 active peers.\r\n\r\nThis particular case seems like you have configured bitcoind to do more than your cpu can handle during higher-traffic times. Consider reducing maxconnections for now. And perhaps shrink maxmempool - may I ask why you are using 2048?",
      "created_at" : "2023-05-09T15:43:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1540433286",
      "id" : 1540433286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b0SWG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540433286/reactions"
      },
      "updated_at" : "2023-05-09T15:43:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540433286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "For the reporters using [htop](https://htop.dev/) to analyze CPU usage (which is the case for at least @poiuty @gits7r, according to the posted screenshots): could you go to the display settings (reachable via key F2) and activate \"tree view\" and the global option \"show custom thread names\"? This would show the CPU usage per thread, which could be interesting for further investigation, e.g.:\r\n\r\n![image](https://github.com/bitcoin/bitcoin/assets/91535/3b20748f-86db-4f4c-a185-496135d3b5ec)\r\n\r\n(FWIW I'm running a listening pruned node on some quite lame dual-core virtual server, have rarely seen more than 10-15% CPU usage the last few days; will tinker around with higher maxmempool/maxconnections settings to see if I can reproduce the issue reported above).",
      "created_at" : "2023-05-10T01:02:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1541097841",
      "id" : 1541097841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b20lx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541097841/reactions"
      },
      "updated_at" : "2023-05-10T01:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541097841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think #27610 should improve the non-debug cpu usage in b-msghand. Both commits should cleanly cherry-pick for on top of v24.x; and the first commit (the \"CompareDepthAndScore\" one) should cleanly cherry-pick for v23.x.",
      "created_at" : "2023-05-10T02:23:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1541197101",
      "id" : 1541197101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b3M0t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541197101/reactions"
      },
      "updated_at" : "2023-05-10T02:23:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541197101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Using this command to identify those peers: `bitcoin-cli getpeerinfo | jq -r '.[] | if (.bytessent_per_msg.inv > 100000 and .bytesrecv_per_msg.inv == null) then .addr else empty end'`\r\n\r\nSomeone posted https://news.ycombinator.com/item?id=35824998 linking to a DoS script https://github.com/visualbasic6/drain/blob/c8373b55d83832f95fb0a77aca56436adeffb58d/drain-btc.py a day before this issue. It's possible someone may be using the script targeting public nodes. \r\n\r\nCheck your `bytessent_per_msg.headers` for anomalous hits. I'm seeing `bytessent_per_msg.headers=2542689711` and 100% CPU util on `b-msghand` thread when testing the DoS script for 10s with single thread on my localhost node.",
      "created_at" : "2023-05-10T05:29:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1541373834",
      "id" : 1541373834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b33-K",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541373834/reactions"
      },
      "updated_at" : "2023-05-10T05:29:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541373834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/500869?v=4",
         "events_url" : "https://api.github.com/users/ayeowch/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ayeowch/followers",
         "following_url" : "https://api.github.com/users/ayeowch/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ayeowch/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ayeowch",
         "id" : 500869,
         "login" : "ayeowch",
         "node_id" : "MDQ6VXNlcjUwMDg2OQ==",
         "organizations_url" : "https://api.github.com/users/ayeowch/orgs",
         "received_events_url" : "https://api.github.com/users/ayeowch/received_events",
         "repos_url" : "https://api.github.com/users/ayeowch/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ayeowch/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ayeowch/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ayeowch"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> It's possible someone may be using the script targeting public nodes.\r\n\r\nFWIW, I was not seeing any ridiculous bytessent_per_msg.inv numbers on any of my nodes. In fact the highest counts on all of my public nodes is my private nodes, but not by much.\r\n\r\nA notable change happened yesterday (May 9th) around 14:25 UTC where the CPU load on all the public nodes dropped drastically at the same time, and they all look normal at present. The high-fee BRC-20 token spam we were seeing also appear to have quieted down a bit, so it seems likely that the issues were simply related to that. Unless it starts back up it might be hard to diagnose this further without artificially generating a similar traffic pattern.\r\n\r\nIncidentally, the command originally provided by @ajtowns which lists the peer addresses with the inv numbers was:\r\n\r\n`bitcoin-cli getpeerinfo | jq -j '.[] | (.bytessent_per_msg.inv, \" \", .bytesrecv_per_msg.inv, \" \", .addr, \"\\n\")' | grep ' null ' | sort -n`\r\n\r\n(Remove the `| grep ' null '` part to show nodes that are also sending invs.)\r\n\r\nEdit: I misread your post, I see you are referring to the headers field. I'm not seeing any anomalous hits at present, and it doesn't seem consistent with the behavior I was seeing with gradual increase of CPU usage over time, but I'll check it to rule it out if the problem reappears.",
      "created_at" : "2023-05-10T05:40:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1541380556",
      "id" : 1541380556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b35nM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541380556/reactions"
      },
      "updated_at" : "2023-05-10T06:41:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541380556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Using: `bitcoin-cli getpeerinfo | jq -j '.[] | (.bytessent_per_msg.headers, \" \", .addr, \"\\n\")' | sort -n | grep -v 127.0.0.1`\r\n\r\nMy highest `bytessent_per_msg.headers` 35 KB (for non localhost), i.e. a _lot_ less than the 2.5 GB @ayeowch is seeing. CPU still calm. The node has 114 inbound connections (and 10 out).\r\n\r\nI guess that means none of my peers have asked me for the full 64 MB headers chain during this session.",
      "created_at" : "2023-05-10T07:33:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1541496964",
      "id" : 1541496964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b4WCE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541496964/reactions"
      },
      "updated_at" : "2023-05-10T07:48:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541496964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ayeowch running that particular script against a modest Intel i5-8400 with 6 cores, either from another computer on the LAN or from the machine itself, I don't see any noticeable CPU difference (compared to all the other stuff its running). Even when downloading 10GB of headers in a few minutes, which is probably a faster download rate than you experienced given the total (though you tally disconnected peers too I suppose).",
      "created_at" : "2023-05-10T09:09:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1541635412",
      "id" : 1541635412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b431U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541635412/reactions"
      },
      "updated_at" : "2023-05-10T09:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541635412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW I am also seeing some sustained high CPU usage on a listening (non debug mode) 24.0.1 node from the `b-msghand` thread:\r\n\r\n![htop ~_001](https://github.com/bitcoin/bitcoin/assets/6606587/d80b439c-ba93-4659-8cfc-b6be7981b1c6)\r\n\r\n\r\nI am used to seeing this thread at ~1% on this machine:\r\n\r\n![htop ~_002](https://github.com/bitcoin/bitcoin/assets/6606587/8f31aa77-98ea-4aac-9ed9-ba6a466de9cd)\r\n\r\n\r\nI also have a number of these \"hungry\" peers:\r\n\r\n```fish\r\nbitcoin in ~ took 53s â bitcoin-cli getpeerinfo | jq -j '.[] | (.bytessent_per_msg.inv, \" \", .bytesrecv_per_msg.inv, \" \", .addr, \"\\n\")' | grep ' null ' | sort -n\r\n2501 null xx.xx.xx.xx:xxxx\r\n6379589 null xx.xx.xx.xx:xxxx\r\n19839661 null xx.xx.xx.xx:xxxx\r\n24468696 null xx.xx.xx.xx:xxxx\r\n38336458 null xx.xx.xx.xx:xxxx\r\n62889263 null xx.xx.xx.xx:xxxx\r\n79513965 null xx.xx.xx.xx:xxxx\r\n80910412 null xx.xx.xx.xx:xxxx\r\n80972609 null xx.xx.xx.xx:xxxx\r\n82147824 null xx.xx.xx.xx:xxxx\r\n343710563 null xx.xx.xx.xx:xxxx\r\n484505648 null xx.xx.xx.xx:xxxx\r\n484552023 null xx.xx.xx.xx:xxxx\r\n484575864 null xx.xx.xx.xx:xxxx\r\n```\r\n\r\nThis hardware usually deals with `bitcoind` pretty easily and has been running with maxconnections for a while:\r\n\r\n```fish\r\nbitcoin in ~ â bitcoin-cli getnettotals\r\n{\r\n  \"totalbytesrecv\": 49382137900,\r\n  \"totalbytessent\": 1290284641863,\r\n  \"timemillis\": 1683631908883,\r\n  \"uploadtarget\": {\r\n    \"timeframe\": 86400,\r\n    \"target\": 0,\r\n    \"target_reached\": false,\r\n    \"serve_historical_blocks\": true,\r\n    \"bytes_left_in_cycle\": 0,\r\n    \"time_left_in_cycle\": 0\r\n  }\r\n}\r\n```\r\n\r\nI will cherry-pick https://github.com/bitcoin/bitcoin/pull/27610 on top of 24.0.1 and see how it fares.",
      "created_at" : "2023-05-10T09:52:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1541828229",
      "id" : 1541828229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585b5m6F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541828229/reactions"
      },
      "updated_at" : "2023-05-10T09:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541828229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   }
]
