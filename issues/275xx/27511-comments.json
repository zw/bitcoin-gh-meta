[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [brunoerg](https://github.com/bitcoin/bitcoin/pull/27511#pullrequestreview-1402136223), [mzumsande](https://github.com/bitcoin/bitcoin/pull/27511#pullrequestreview-1424964754) |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/27511#issuecomment-1518117272) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-04-21T16:28:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#issuecomment-1518070845",
      "id" : 1518070845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27511",
      "node_id" : "IC_kwDOABII585ae-w9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 1,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518070845/reactions"
      },
      "updated_at" : "2023-05-12T18:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518070845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This PR is based on master from two months age. You may need to rebase it to current master for the (tidy) CI to be green.",
      "created_at" : "2023-04-21T17:00:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#issuecomment-1518103852",
      "id" : 1518103852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27511",
      "node_id" : "IC_kwDOABII585afG0s",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518103852/reactions"
      },
      "updated_at" : "2023-04-21T17:01:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518103852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested Concept ACK. It might be good to have the breakdown of pre/post `IsTerrible` filtering (RPC getnodeaddresses and CLI -addrinfo return post) -- see the large differences between them.\r\n\r\n<img width=\"517\" alt=\"Screenshot 2023-04-21 at 10 21 42\" src=\"https://user-images.githubusercontent.com/2415484/233697542-d345a8c2-bce2-4558-89d9-56afd4279305.png\">\r\n\r\n\r\n",
      "created_at" : "2023-04-21T17:13:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#issuecomment-1518117272",
      "id" : 1518117272,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27511",
      "node_id" : "IC_kwDOABII585afKGY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518117272/reactions"
      },
      "updated_at" : "2023-05-12T18:19:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518117272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27511#discussion_r1174005736"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27511"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174005736"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe a final \"totals\" field with the totals for each?",
      "commit_id" : "c505611f08a850acb97dea9cc03b36aa468929ca",
      "created_at" : "2023-04-21T17:17:33Z",
      "diff_hunk" : "@@ -966,6 +966,48 @@ static RPCHelpMan addpeeraddress()\n     };\n }\n \n+static RPCHelpMan getaddrmaninfo()\n+{\n+    return RPCHelpMan{\"getaddrmaninfo\",\n+                      \"\\nReturns the number of addresses in the `new` and `tried` tables and their sum for all networks. This RPC is for testing only.\\n\",\n+                      {},\n+                      RPCResult{\n+                              RPCResult::Type::OBJ_DYN, \"\", \"json object with network type as keys\",\n+                              {\n+                                      {RPCResult::Type::OBJ, \"network\", \"the network (\" + Join(GetNetworkNames(), \", \") + \")\",\n+                                       {\n+                                               {RPCResult::Type::NUM, \"new\", \"number of addresses in new table\"},\n+                                               {RPCResult::Type::NUM, \"tried\", \"number of addresses in tried table\"},\n+                                               {RPCResult::Type::NUM, \"total\", \"total number of addresses in both new/tried tables from a network\"},\n+                                       }},\n+                              }\n+                      },\n+                      RPCExamples{\n+                              HelpExampleCli(\"getaddrmaninfo\", \"\")\n+                              + HelpExampleRpc(\"getaddrmaninfo\", \"\")\n+                      },\n+                      [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+                      {\n+                          NodeContext& node = EnsureAnyNodeContext(request.context);\n+                          if (!node.addrman) {\n+                              throw JSONRPCError(RPC_CLIENT_P2P_DISABLED, \"Error: Address manager functionality missing or disabled\");\n+                          }\n+\n+                          UniValue ret(UniValue::VOBJ);\n+                          for (int n = 0; n < NET_MAX; ++n) {\n+                              enum Network network = static_cast<enum Network>(n);\n+                              if (network == NET_UNROUTABLE || network == NET_INTERNAL) continue;\n+                              UniValue obj(UniValue::VOBJ);\n+                              obj.pushKV(\"new\", node.addrman->Size(network, true));\n+                              obj.pushKV(\"tried\", node.addrman->Size(network, false));\n+                              obj.pushKV(\"total\", node.addrman->Size(network));\n+                              ret.pushKV(GetNetworkName(network), obj);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#discussion_r1174005736",
      "id" : 1174005736,
      "line" : 1004,
      "node_id" : "PRRC_kwDOABII585F-efo",
      "original_commit_id" : "c505611f08a850acb97dea9cc03b36aa468929ca",
      "original_line" : 1004,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 39,
      "pull_request_review_id" : 1396138526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27511",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174005736/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-21T17:17:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174005736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27511#discussion_r1181081666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27511"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181081666"
         }
      },
      "author_association" : "NONE",
      "body" : "Do you think we can add total to this test aswell?",
      "commit_id" : "c505611f08a850acb97dea9cc03b36aa468929ca",
      "created_at" : "2023-04-29T13:50:54Z",
      "diff_hunk" : "@@ -328,6 +329,19 @@ def test_addpeeraddress(self):\n             addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n             assert_equal(len(addrs), 2)\n \n+    def test_getaddrmaninfo(self):\n+        self.log.info(\"Test getaddrmaninfo\")\n+        node = self.nodes[1]\n+\n+        self.log.debug(\"Test that getaddrmaninfo is a hidden RPC\")\n+        # It is hidden from general help, but its detailed help may be called directly.\n+        assert \"getaddrmaninfo\" not in node.help()\n+        assert \"getaddrmaninfo\" in node.help(\"getaddrmaninfo\")\n+\n+        # current count of ipv4 addresses in addrman is {'new':1, 'tried':1}\n+        res = node.getaddrmaninfo()\n+        assert_equal(res[\"ipv4\"][\"new\"], 1)\n+        assert_equal(res[\"ipv4\"][\"tried\"], 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#discussion_r1181081666",
      "id" : 1181081666,
      "line" : 344,
      "node_id" : "PRRC_kwDOABII585GZeBC",
      "original_commit_id" : "c505611f08a850acb97dea9cc03b36aa468929ca",
      "original_line" : 344,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 24,
      "pull_request_review_id" : 1406986003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27511",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181081666/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-29T13:50:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181081666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> \"terrible\" is an internal property\r\n\r\nIt's used in RPC getnodeaddresses and CLI -addrinfo to return only non-IsTerrible peers to users. (I meant pre and post that filtering in the suggestion above).",
      "created_at" : "2023-05-12T18:24:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#issuecomment-1546119966",
      "id" : 1546119966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27511",
      "node_id" : "IC_kwDOABII585cJ-se",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546119966/reactions"
      },
      "updated_at" : "2023-05-12T18:25:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546119966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It's used in RPC getnodeaddresses and CLI -addrinfo to return only non-IsTerrible peers to users. (I meant pre and post that filtering in the suggestion above).\r\n\r\nin my opinion unfortunately. I think this was mostly coincidental, because #13152 chose to reuse an addrman function used only for GETADDR answers before. Then #21595 used that output without any mentioning of that restriction, and the doc was only adjusted a year later in #24370. I think that ideally we never should have exposed the terrible filter in the first place.",
      "created_at" : "2023-05-12T18:39:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#issuecomment-1546135453",
      "id" : 1546135453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27511",
      "node_id" : "IC_kwDOABII585cKCed",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546135453/reactions"
      },
      "updated_at" : "2023-05-12T18:39:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546135453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think that ideally we never should have exposed the terrible filter in the first place.\r\n\r\n@mzumsande do you want to propose some changes to remove its exposure?",
      "created_at" : "2023-05-15T10:30:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27511#issuecomment-1547603057",
      "id" : 1547603057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27511",
      "node_id" : "IC_kwDOABII585cPoxx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1547603057/reactions"
      },
      "updated_at" : "2023-05-15T10:30:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1547603057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
