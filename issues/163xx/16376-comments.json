[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've seen the \"node gets stuck in shutdown\" thing myself, caused by the \"get dns peers\" thread taking forever. If you check in debug.log, you should see \"dnsseed thread start\" without a corresponding \"dnsseed thread exit\". I think if you wait about 5 minutes you should see it finish up.",
      "created_at" : "2019-07-12T01:51:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16376#issuecomment-510713821",
      "id" : 510713821,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16376",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDcxMzgyMQ==",
      "updated_at" : "2019-07-12T01:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510713821",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "In my case it's not dnsseed, which has not been launched at the point of startup where the shutdown happens, plus I've been waiting for 30 minutes without anything happening. But of course the root cause could be related.",
      "created_at" : "2019-07-12T10:45:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16376#issuecomment-510841351",
      "id" : 510841351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16376",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDg0MTM1MQ==",
      "updated_at" : "2019-07-12T10:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510841351",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, I think there's a race if shutdown happens early:\r\n\r\n    init                       torcontrol\r\n    StartTor()\r\n      event_base_new()\r\n      std::thread()\r\n    InterruptTor()\r\n      event_base_loopbreak()\r\n                               TorControlThread()\r\n                                    TorController()\r\n                                    event_base_dispatch()\r\n    StopTorControl()\r\n      torControlThread.join()    \r\n\r\nIf `_loopbreak` is called before `_dispatch` has started, it won't have any effect. Calling `event_base_loopexit(gBase,nullptr)` instead (or as well) seems like it fixes it. ",
      "created_at" : "2019-07-16T14:00:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16376#issuecomment-511828485",
      "id" : 511828485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16376",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMTgyODQ4NQ==",
      "updated_at" : "2019-07-16T14:00:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/511828485",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I also hit the \"hang\" regarding dnsseed thread: https://github.com/bitcoin/bitcoin/issues/15657#issuecomment-475965674\r\n\r\nI'll try to reproduce the race.",
      "created_at" : "2019-07-16T23:48:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16376#issuecomment-512043741",
      "id" : 512043741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16376",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMjA0Mzc0MQ==",
      "updated_at" : "2019-07-16T23:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/512043741",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I found it reproduced pretty easily on master by invoking bitcoind with `-proxy=127.0.0.1:9050 -listen=1 -bind=127.0.0.1 -whitebind=127.0.0.1:0` fwiw.",
      "created_at" : "2019-07-17T10:39:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16376#issuecomment-512200820",
      "id" : 512200820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16376",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMjIwMDgyMA==",
      "updated_at" : "2019-07-17T10:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/512200820",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
