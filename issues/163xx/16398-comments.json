[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> One use case could be to determine if smart contracts that are set up with multiple txs would be accepted by current consensus and policy rules.\r\n\r\nI think I basically understand this change, but not the use cases. I would love an ELI5 of the above `testmempoolaccept` use case. Specifically who might be calling the `testmempoolaccept` to build what kind of application.\r\n\r\nAlso, it would be useful to know if you think other applications of transaction pool layers could be more or equally useful as `testmempoolaccept`. IIRC these layers could also help implementing dandelion? Basically, I'd love to see some kind of post like #15605 or #14895 that explains what motivated these changes and how they can be built on and used.",
      "created_at" : "2019-07-16T16:10:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16398#issuecomment-511883188",
      "id" : 511883188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMTg4MzE4OA==",
      "updated_at" : "2019-07-16T16:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/511883188",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16421](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16421.html) (Conservatively accept RBF bumps bumping one tx at the package limits by TheBlueMatt)\n* [#16409](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16409.html) (Remove mempool expiry, treat txs as replaceable instead by MarcoFalke)\n* [#16401](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16401.html) (Package relay by sdaftuar)\n* [#16400](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16400.html) ([refactor] Rewrite AcceptToMemoryPoolWorker() using smaller parts by sdaftuar)\n* [#15921](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15921.html) (Tidy up ValidationState interface by jnewbery)\n* [#15681](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15681.html) ([mempool] Allow one extra single-ancestor transaction per package by TheBlueMatt)\n* [#15606](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15606.html) ([experimental] UTXO snapshots by jamesob)\n* [#15192](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15192.html) (Add missing cs_main locks in ThreadImport(...)/Shutdown(...)/gettxoutsetinfo(...)/InitScriptExecutionCache(). Add missing locking annotations. by practicalswift)\n* [#15169](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15169.html) (Parallelize CheckInputs() in AcceptToMemoryPool() by sdaftuar)\n* [#10443](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10443.html) (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-07-16T18:43:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16398#issuecomment-511937839",
      "id" : 511937839,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMTkzNzgzOQ==",
      "updated_at" : "2019-07-18T23:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/511937839",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16398#discussion_r305575441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16398"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305575441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ð",
      "commit_id" : "197fa405b92ca921e85097893cf8e1da3a3f32a2",
      "created_at" : "2019-07-20T10:22:10Z",
      "diff_hunk" : "@@ -598,6 +690,48 @@ static void CheckInputsAndUpdateCoins(const CTransaction& tx, CCoinsViewCache& m\n     UpdateCoins(tx, mempoolDuplicate, std::numeric_limits<int>::max());\n }\n \n+void TxPoolLayer::check() const\n+{\n+    std::list<const CTxMemPoolEntry*> waitingOnDependants;\n+    std::vector<const CTxMemPoolEntry*> all_txs;\n+    for (const CTxMemPoolEntry& e : m_cache_added) {\n+        all_txs.emplace_back(&e);\n+        assert(m_cache_map_links.find(txiter{txiter_nested{m_cache_added.iterator_to(e)}}) != m_cache_map_links.end());\n+    }\n+    for (const CTxMemPoolEntry& e : m_tx_pool.mapTx) {\n+        if (m_cache_removed.find(e.GetTx().GetHash()) == m_cache_removed.end()) {\n+            all_txs.emplace_back(&e);\n+        }\n+    }\n+    for (const CTxMemPoolEntry* e : all_txs) {\n+        const CTransaction& tx = e->GetTx();\n+        const auto it = *GetIter(tx.GetHash());\n+        setEntries setParentCheck;\n+        for (const CTxIn& txin : tx.vin) {\n+            if (exists(txin.prevout.hash)) {\n+                setParentCheck.insert(*GetIter(txin.prevout.hash));\n+            }\n+            const CTransaction* c_tx = GetConflictTx(txin.prevout);\n+            assert(c_tx = &tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16398#discussion_r305575441",
      "id" : 305575441,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNTU3NTQ0MQ==",
      "original_commit_id" : "197fa405b92ca921e85097893cf8e1da3a3f32a2",
      "original_position" : 437,
      "path" : "src/txmempool.cpp",
      "position" : 437,
      "pull_request_review_id" : 264492436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16398",
      "updated_at" : "2019-07-20T10:22:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305575441",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
