[
   {
      "author_association" : "NONE",
      "body" : "I'm working on it.  Plan is to harden the function to not read at end and after. I have some initial small draft changes, and want to add testing. Maybe, we can even highlight the issue via additional fuzz+msan tests.\r\n\r\n",
      "created_at" : "2024-02-02T02:38:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1922687448",
      "id" : 1922687448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585ymeHY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1922687448/reactions"
      },
      "updated_at" : "2024-02-02T02:38:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1922687448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/158417236?v=4",
         "events_url" : "https://api.github.com/users/daniel-btc-nym/events{/privacy}",
         "followers_url" : "https://api.github.com/users/daniel-btc-nym/followers",
         "following_url" : "https://api.github.com/users/daniel-btc-nym/following{/other_user}",
         "gists_url" : "https://api.github.com/users/daniel-btc-nym/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/daniel-btc-nym",
         "id" : 158417236,
         "login" : "daniel-btc-nym",
         "node_id" : "U_kgDOCXFBVA",
         "organizations_url" : "https://api.github.com/users/daniel-btc-nym/orgs",
         "received_events_url" : "https://api.github.com/users/daniel-btc-nym/received_events",
         "repos_url" : "https://api.github.com/users/daniel-btc-nym/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/daniel-btc-nym/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/daniel-btc-nym/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/daniel-btc-nym"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I guess this can be fixed by using std::string_view::starts_with",
      "created_at" : "2024-02-05T12:09:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1926850992",
      "id" : 1926850992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585y2Wmw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1926850992/reactions"
      },
      "updated_at" : "2024-02-05T12:09:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1926850992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The bug here isn't actually that bad: \r\n\r\n- It uses strncmp(..., 4) and strncmp(..., 5) respectively: so, in worst case it will read 3 or 5 bytes after end.\r\n- Similar for the number parsing.\r\n\r\nIn any case, I have a change that fixes both  (adding guards for reading past end, and making the code pretty / easy to read again). I have unit tests for the keywords (true, false, null) but want to add some for the numbers.\r\n\r\nHaven't made any progress on MSAN. But if we would poison data around begin and end, we could write some exhaustive tests for small inputs. If we restrict to (printable characters, or these mentioned in the code), we could then be pretty certain the new code is correct. \r\n\r\nTouching code is always a risk, so I am trying to minimize it.\r\n\r\nFWIW, my code so far: https://github.com/bitcoin/bitcoin/commit/b77afc50b14ea1af61ea3b32e75d2aa974b07844\r\n\r\n",
      "created_at" : "2024-02-08T03:18:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1933300387",
      "id" : 1933300387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585zO9Kj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1933300387/reactions"
      },
      "updated_at" : "2024-02-08T03:31:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1933300387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/158417236?v=4",
         "events_url" : "https://api.github.com/users/daniel-btc-nym/events{/privacy}",
         "followers_url" : "https://api.github.com/users/daniel-btc-nym/followers",
         "following_url" : "https://api.github.com/users/daniel-btc-nym/following{/other_user}",
         "gists_url" : "https://api.github.com/users/daniel-btc-nym/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/daniel-btc-nym",
         "id" : 158417236,
         "login" : "daniel-btc-nym",
         "node_id" : "U_kgDOCXFBVA",
         "organizations_url" : "https://api.github.com/users/daniel-btc-nym/orgs",
         "received_events_url" : "https://api.github.com/users/daniel-btc-nym/received_events",
         "repos_url" : "https://api.github.com/users/daniel-btc-nym/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/daniel-btc-nym/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/daniel-btc-nym/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/daniel-btc-nym"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Haven't made any progress on MSAN.\r\n\r\nYou can copy the bytes into a vector first and call `shrink_to_fit`, which should be enough to tell msan where the data really ends?",
      "created_at" : "2024-02-08T08:37:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1933591792",
      "id" : 1933591792,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585zQETw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1933591792/reactions"
      },
      "updated_at" : "2024-02-08T08:37:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1933591792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I still need to look into how MSAN is integrated into the current unit test suite. Questions like: how can I run the unit tests I added under MSAN? Are all unit tests run under MSAN with a certain make target ... the basics. I am very new to this repository here :)",
      "created_at" : "2024-02-08T13:22:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1934115970",
      "id" : 1934115970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585zSESC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934115970/reactions"
      },
      "updated_at" : "2024-02-08T13:22:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934115970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/158417236?v=4",
         "events_url" : "https://api.github.com/users/daniel-btc-nym/events{/privacy}",
         "followers_url" : "https://api.github.com/users/daniel-btc-nym/followers",
         "following_url" : "https://api.github.com/users/daniel-btc-nym/following{/other_user}",
         "gists_url" : "https://api.github.com/users/daniel-btc-nym/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/daniel-btc-nym",
         "id" : 158417236,
         "login" : "daniel-btc-nym",
         "node_id" : "U_kgDOCXFBVA",
         "organizations_url" : "https://api.github.com/users/daniel-btc-nym/orgs",
         "received_events_url" : "https://api.github.com/users/daniel-btc-nym/received_events",
         "repos_url" : "https://api.github.com/users/daniel-btc-nym/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/daniel-btc-nym/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/daniel-btc-nym/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/daniel-btc-nym"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It is probably not worth it to try to setup msan, as it requires building llvm from scratch.\r\n\r\nIt is easier to just use valgrind. For example: `valgrind ./src/test/test_bitcoin -t vector_tests`",
      "created_at" : "2024-02-08T13:25:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1934121806",
      "id" : 1934121806,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585zSFtO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934121806/reactions"
      },
      "updated_at" : "2024-02-08T13:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934121806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Yeah, I ran some valgrind tests before and after my changes and it clearly showed the \"uninitialized\" accesses when we copy the data first into a tight vector as you suggested.\r\n\r\nI added more test coverage and think this should be enough for this issue.\r\n\r\nWhat do you think about  [the changes](https://github.com/bitcoin/bitcoin/compare/master...daniel-btc-nym:bitcoin:master)?\r\n\r\nIf they look OK, I can merge them into a single commit  --  (I suppose by forking again?)  --  and then making a pull-request?",
      "created_at" : "2024-02-09T03:40:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1935289038",
      "id" : 1935289038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585zWirO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935289038/reactions"
      },
      "updated_at" : "2024-02-09T03:41:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935289038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/158417236?v=4",
         "events_url" : "https://api.github.com/users/daniel-btc-nym/events{/privacy}",
         "followers_url" : "https://api.github.com/users/daniel-btc-nym/followers",
         "following_url" : "https://api.github.com/users/daniel-btc-nym/following{/other_user}",
         "gists_url" : "https://api.github.com/users/daniel-btc-nym/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/daniel-btc-nym",
         "id" : 158417236,
         "login" : "daniel-btc-nym",
         "node_id" : "U_kgDOCXFBVA",
         "organizations_url" : "https://api.github.com/users/daniel-btc-nym/orgs",
         "received_events_url" : "https://api.github.com/users/daniel-btc-nym/received_events",
         "repos_url" : "https://api.github.com/users/daniel-btc-nym/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/daniel-btc-nym/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/daniel-btc-nym/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/daniel-btc-nym"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I like bugfixes the most, when they are touching only a single line of code. But if more changes are required, then that is fine, too.\r\n\r\nI checked that this is only a theoretical issue in Bitcoin Core, and can not be hit in production code, but it may still be good to fix it.\r\n\r\nIt may be good to update the fuzz target to catch the issue here: `src/test/fuzz/parse_univalue.cpp`",
      "created_at" : "2024-02-09T08:45:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1935535162",
      "id" : 1935535162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII585zXew6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935535162/reactions"
      },
      "updated_at" : "2024-02-09T08:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935535162",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I like bugfixes the most, when they are touching only a single line of code. But if more changes are required, then that is fine, too.\r\n\r\nMy changes have a few orthogonal, but related fixes and test additions. We could make different pull-requests for them. Let me know what you prefer.\r\n\r\nFor example:\r\n1. Check strncmp will not go out of bound. This is lines 99-115 in univalue_read.cpp ; unit tests that call `no_reading_beyond_end_test` \r\n1. Change parsing of numbers, where there were two places that might read past the end. This is lines 126-143 in univalue_read.cpp ; unit test that call: `parsing_numbers_beyond_end_test`.\r\n1. Added `exhaustive_short_string_test unit test`, which was previously causing errors when run in valgrind; now runs cleanly.\r\n1. Added a couple more unit tests such as parsing the empty buffer.\r\n1. Fixed: `fail18.json` which is a test where the nesting is too deep.\r\n1. Added `pass5.json` which is a test where the nesting is just shallow enough to pass.\r\n\r\n> It may be good to update the fuzz target to catch the issue here: `src/test/fuzz/parse_univalue.cpp`\r\n\r\nI added it in, and ran the fuzzer using HONGGFUZZ. Since this isn't a \"runaway\" overflow, we don't get any crashes. When running the entire fuzzer under valgrind, we seem to get all sorts of (seemingly unrelated) problems.\r\n\r\nI thus added a mini-exhaustive test that runs quickly and cleanly under valgrind now, but didn't before.\r\n\r\nA few more questions:\r\n\r\n- Are we adhering to any line lengths conventions?\r\n- Are we adhering to conventions for variable names and function names?\r\n- My changes *do* change the semantics for the corner-cases where we were reading past the end of the buffer before: For example, previously:  `char buf[] = \"true\"; getJsonToken(tokenVal, consumed, buf, buf + 1);` would parse as `JTOK_KW_TRUE`  and now returns `JTOK_ERR`. There are also the opposite: previously, `char buf[] = \"01\"; getJsonToken(tokenVal, consumed, buf, buf + 1);` would error since we do not allow leading 0s, but now, this would parse as \"0\".\r\n- Do we have some place where we could dump outputs from valgrind that I could link to in the commit messages or pull-request explanation? I would like to show before / after? Or basically, anywhere that creates durable data that can easily be linked to?\r\n- What do you suggest my next steps would be?  I am fairly happy with the [code](https://github.com/bitcoin/bitcoin/compare/master...daniel-btc-nym:bitcoin:master).\r\n",
      "created_at" : "2024-02-17T16:50:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28260#issuecomment-1950254374",
      "id" : 1950254374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28260",
      "node_id" : "IC_kwDOABII5850PoUm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1950254374/reactions"
      },
      "updated_at" : "2024-02-17T16:52:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1950254374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/158417236?v=4",
         "events_url" : "https://api.github.com/users/daniel-btc-nym/events{/privacy}",
         "followers_url" : "https://api.github.com/users/daniel-btc-nym/followers",
         "following_url" : "https://api.github.com/users/daniel-btc-nym/following{/other_user}",
         "gists_url" : "https://api.github.com/users/daniel-btc-nym/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/daniel-btc-nym",
         "id" : 158417236,
         "login" : "daniel-btc-nym",
         "node_id" : "U_kgDOCXFBVA",
         "organizations_url" : "https://api.github.com/users/daniel-btc-nym/orgs",
         "received_events_url" : "https://api.github.com/users/daniel-btc-nym/received_events",
         "repos_url" : "https://api.github.com/users/daniel-btc-nym/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/daniel-btc-nym/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/daniel-btc-nym/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/daniel-btc-nym"
      }
   }
]
