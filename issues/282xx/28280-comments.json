[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28280).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [jamesob](https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1691875284) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29700](https://github.com/bitcoin/bitcoin/pull/29700) (kernel, refactor: return error status on all fatal errors by ryanofsky)\n* [#28233](https://github.com/bitcoin/bitcoin/pull/28233) (validation: don't clear cache on periodic flush: >2x block connection speed by andrewtoth)\n* [#28216](https://github.com/bitcoin/bitcoin/pull/28216) (fuzz: a new target for the coins database by darosior)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-08-16T22:38:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1681358199",
      "id" : 1681358199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585kN313",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681358199/reactions"
      },
      "updated_at" : "2024-04-04T07:50:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681358199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1296524385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296524385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If these were iterators into the map, rather than pointers to the value, I think you wouldn't need the `m_outpoint`.",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-08-16T23:14:03Z",
      "diff_hunk" : "@@ -103,8 +103,16 @@ class Coin\n  */\n struct CCoinsCacheEntry\n {\n+private:\n+    //! These are used to create a doubly linked list of dirty entries. They are\n+    //! set in SetFlags and unset in ClearFlags.\n+    CCoinsCacheEntry *m_prev{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1296524385",
      "id" : 1296524385,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NR2Rh",
      "original_commit_id" : "dbd663c4461cf0d8f478d46e224a966293db3bd3",
      "original_line" : 109,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : null,
      "pull_request_review_id" : 1581554153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296524385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-16T23:14:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296524385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1297300532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297300532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, it seems iterators may get invalidated when a map rehash occurs, but pointers to elements don't.\r\n\r\nI think you can however store pointers to `std::pair<const COutPoint, CoinsCacheEntry>` (the `value_type` of the map). Would that help alleviate the need for `m_outpoint`?",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-08-17T14:23:57Z",
      "diff_hunk" : "@@ -103,8 +103,16 @@ class Coin\n  */\n struct CCoinsCacheEntry\n {\n+private:\n+    //! These are used to create a doubly linked list of dirty entries. They are\n+    //! set in SetFlags and unset in ClearFlags.\n+    CCoinsCacheEntry *m_prev{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1297300532",
      "id" : 1297300532,
      "in_reply_to_id" : 1296524385,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NUzw0",
      "original_commit_id" : "dbd663c4461cf0d8f478d46e224a966293db3bd3",
      "original_line" : 109,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : null,
      "pull_request_review_id" : 1582751611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297300532/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T14:55:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297300532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1297307567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297307567"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Brilliant, thanks! Was just trying this last night, this looks like the way. Will give it a shot.",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-08-17T14:28:58Z",
      "diff_hunk" : "@@ -103,8 +103,16 @@ class Coin\n  */\n struct CCoinsCacheEntry\n {\n+private:\n+    //! These are used to create a doubly linked list of dirty entries. They are\n+    //! set in SetFlags and unset in ClearFlags.\n+    CCoinsCacheEntry *m_prev{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1297307567",
      "id" : 1297307567,
      "in_reply_to_id" : 1296524385,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NU1ev",
      "original_commit_id" : "dbd663c4461cf0d8f478d46e224a966293db3bd3",
      "original_line" : 109,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : null,
      "pull_request_review_id" : 1582762652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297307567/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T14:29:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297307567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1297701571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297701571"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa done! Thank you for the elegant solution.",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-08-17T20:21:49Z",
      "diff_hunk" : "@@ -103,8 +103,16 @@ class Coin\n  */\n struct CCoinsCacheEntry\n {\n+private:\n+    //! These are used to create a doubly linked list of dirty entries. They are\n+    //! set in SetFlags and unset in ClearFlags.\n+    CCoinsCacheEntry *m_prev{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1297701571",
      "id" : 1297701571,
      "in_reply_to_id" : 1296524385,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NWVrD",
      "original_commit_id" : "dbd663c4461cf0d8f478d46e224a966293db3bd3",
      "original_line" : 109,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : null,
      "pull_request_review_id" : 1583408156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297701571/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T20:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1297701571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK! I'll try to repro the bench results in the next week or so.",
      "created_at" : "2023-08-24T15:14:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1691875284",
      "id" : 1691875284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585k1_fU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 2,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1691875284/reactions"
      },
      "updated_at" : "2023-08-24T15:14:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1691875284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@andrewtoth Not sure if you have seen https://github.com/bitcoin/bitcoin/pull/20827 which is a different approach but has a similar effect.",
      "created_at" : "2023-08-30T07:52:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1698672209",
      "id" : 1698672209,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585lP65R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698672209/reactions"
      },
      "updated_at" : "2023-08-30T07:52:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698672209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@0xB10C indeed I have seen that one. I believe they complement each other. #20827 reduces IBD time for larger `prune` values and this PR reduces it even more for smaller `prune` values. I should benchmark this on top of that one.\r\nAlso, I'm curious how you are performing your benchmarks and generating all those nice graphs. Do you mind sharing what tools you use?",
      "created_at" : "2023-08-30T19:13:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1699702875",
      "id" : 1699702875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585lT2hb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699702875/reactions"
      },
      "updated_at" : "2023-08-31T02:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699702875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Also, I'm curious how you are performing your benchmarks and generating all those nice graphs. Do you mind sharing what tools you use?\r\n\r\nAt the time I had a spare and otherwise idle machine set up I could use. I don't have the bash script at hand but IIRC I had a merge base (MB)  and a pull-request (PR) binary I'd run with different `prune` and `dbcache` configurations. After each run, the script would rename and move the debug log (with extra `-debug=coindb -debug=prune`) to a separate folder. After all runs were done, I loaded the debug logs into the following Jupyter notebooks to parse the debug logs and to generate the graphs. For anyone revisiting this, these are the relevant comments https://github.com/bitcoin/bitcoin/pull/20827#issuecomment-1009016428, https://github.com/bitcoin/bitcoin/pull/20827#issuecomment-1017603590, and https://github.com/bitcoin/bitcoin/pull/20827#issuecomment-1023108273 for my setup and results.\r\n\r\nI've uploaded the jupyter nodebooks here https://gist.github.com/0xB10C/89c2903290cfb1840792d41dcd079646. The first was used for a partial IBD from 500k-600k and the second one with a full IBD. Both times syncing from a local node on the same host. The notebooks expect the debug log files with the name `debug_{binary}_{cset}_{run}.log` where {binary} is either MB or PR, {cset} is an integer specifying the configuration set (pruning and dbcache parameter), and {run} is an integer numbering the run of this binary-cset combination if I did multiple. Feel free to remix and share in any way you want. Keep in mind that parsing logs is quite fragile as log message format can change. Feel free to reach out if there are questions. \r\n\r\n\r\n\r\n\r\n",
      "created_at" : "2023-08-31T06:35:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1700446063",
      "id" : 1700446063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585lWr9v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700446063/reactions"
      },
      "updated_at" : "2023-08-31T06:35:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700446063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Bench running now, should have some results in the next day or so.\r\n```shell\r\n$ ( bitcoinperf --no-teardown bench-pr --num-blocks 30_000 --run-id no-flush-on-prune \\\r\n    --bitcoind-args='-dbcache=4000 -prune=550' --run-count 3 28280 && \\\r\n    pushover 'Bench for andrewtoth SUCCEEDED!' ) || \\\r\n  pushover 'Bench for andrewtoth failed'\r\n```",
      "created_at" : "2023-09-20T17:47:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1728185226",
      "id" : 1728185226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585nAgOK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728185226/reactions"
      },
      "updated_at" : "2023-09-20T17:47:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728185226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Local IBD of 30_000 blocks with `-prune=550` from a Taproot-enabled height didn't show any difference. I didn't have `-log=prune` enabled, so my bench debug.log was basically useless. Rerunning...",
      "created_at" : "2023-09-27T10:25:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1737126367",
      "id" : 1737126367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585ninHf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737126367/reactions"
      },
      "updated_at" : "2023-09-27T10:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737126367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-11-08T15:29:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1802125401",
      "id" : 1802125401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585rakBZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802125401/reactions"
      },
      "updated_at" : "2023-11-08T15:29:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802125401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased, ran the following benchmark using hyperfine. Sync to block 800k 3 times on master commit and the last commit of this branch (I updated the commit recently, but no code changes only commit order changes to satisfy CI), dbcache=4000 and prune=550:\r\n\r\n```\r\nhyperfine \\\r\n--export-markdown ~/bench.md \\\r\n--show-output --parameter-list commit 498994b6f55d04a7940f832e7fbd17e5acdaff15,216bd93138a46cdfa66523878a36d0e634476079 \\\r\n--prepare 'git checkout {commit} && make -j$(nproc) src/bitcoind; sync; sudo /sbin/sysctl vm.drop_caches=3; rm -rf ~/.bitcoin/blocks; rm -rf ~/.bitcoin/chainstate;' \\\r\n-M 3 './src/bitcoind -dbcache=4000 -prune=550 -printtoconsole=0 -connect=<local_node> -stopatheight=800000'\r\n```\r\n\r\nResults from `~/bench.md`:\r\n| Command | Mean [s] | Min [s] | Max [s] | Relative |\r\n|:---|---:|---:|---:|---:|\r\n| `./src/bitcoind -dbcache=4000 -datadir=/home/user/.bitcoin -prune=550 -printtoconsole=0 -connect=192.168.2.11:8333 -stopatheight=800000` | 27609.574 Â± 37.857 | 27580.531 | 27652.389 | 1.24 Â± 0.00 |\r\n| `./src/bitcoind -dbcache=4000 -datadir=/home/user/.bitcoin -prune=550 -printtoconsole=0 -connect=192.168.2.11:8333 -stopatheight=800000` | 22188.405 Â± 52.561 | 22128.517 | 22226.878 | 1.00 |\r\n\r\nThe second commit is this branch, so it runs 24% faster than master.\r\n\r\n@jamesob I suppose 30k blocks is not enough to appreciate the effect of syncing with a full cache?",
      "created_at" : "2023-12-03T18:30:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1837561632",
      "id" : 1837561632,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585thvcg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1837561632/reactions"
      },
      "updated_at" : "2023-12-03T18:34:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1837561632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414243104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414243104"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "While you are at it, I'd use `CCoinsCacheEntry = default;`. clang-tidy usually warns against this: https://clang.llvm.org/extra/clang-tidy/checks/modernize/use-equals-default.html",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-12-04T17:26:57Z",
      "diff_hunk" : "@@ -138,9 +137,9 @@ struct CCoinsCacheEntry\n         FRESH = (1 << 1),\n     };\n \n-    CCoinsCacheEntry() : flags(0) {}\n-    explicit CCoinsCacheEntry(Coin&& coin_) : coin(std::move(coin_)), flags(0) {}\n-    CCoinsCacheEntry(Coin&& coin_, unsigned char flag) : coin(std::move(coin_)), flags(flag) {}\n+    CCoinsCacheEntry() {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414243104",
      "id" : 1414243104,
      "line" : 140,
      "node_id" : "PRRC_kwDOABII585US6Mg",
      "original_commit_id" : "ba09f5039c4bd2868335d5616f86acbfa41bedd9",
      "original_line" : 140,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : 34,
      "pull_request_review_id" : 1763003369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414243104/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T20:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414243104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414384720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414384720"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think `SetFlags` is a bit confusing name, since it's more a `AddFlags`, because it doesn't simply set the flags, it ORs them together.\r\n\r\nAlternatively (and I think this is the better solution) really use `m_flags = flags` instead of `mflags |= flags`.",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-12-04T19:25:35Z",
      "diff_hunk" : "@@ -9,6 +9,42 @@\n #include <random.h>\n #include <util/trace.h>\n \n+void CCoinsCacheEntry::SetFlags(uint8_t flags, CoinsCachePair &self, CoinsCachePair &head)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414384720",
      "id" : 1414384720,
      "line" : 12,
      "node_id" : "PRRC_kwDOABII585UTcxQ",
      "original_commit_id" : "d66ad8efafe95445fcfcec6c07a6117faa32fa36",
      "original_line" : 12,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 4,
      "pull_request_review_id" : 1763003369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414384720/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T20:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414384720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414394258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414394258"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure if that is possible in the call, but when `emplace` doesn't create a new object because the outpoint is already present, then previously the flags didn't change. Now, the flag DIRTY is always added, regardless if the outpoint was already present in `cacheCoins` or not.",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-12-04T19:32:52Z",
      "diff_hunk" : "@@ -144,10 +144,11 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n \n void CCoinsViewCache::EmplaceCoinInternalDANGER(COutPoint&& outpoint, Coin&& coin) {\n     cachedCoinsUsage += coin.DynamicMemoryUsage();\n-    cacheCoins.emplace(\n+    auto it{cacheCoins.emplace(\n         std::piecewise_construct,\n         std::forward_as_tuple(std::move(outpoint)),\n-        std::forward_as_tuple(std::move(coin), CCoinsCacheEntry::DIRTY));\n+        std::forward_as_tuple(std::move(coin))).first};\n+    it->second.SetFlags(CCoinsCacheEntry::DIRTY, *it, m_flagged_head);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414394258",
      "id" : 1414394258,
      "line" : 151,
      "node_id" : "PRRC_kwDOABII585UTfGS",
      "original_commit_id" : "ba09f5039c4bd2868335d5616f86acbfa41bedd9",
      "original_line" : 151,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 89,
      "pull_request_review_id" : 1763003369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414394258/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T20:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414394258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414402060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414402060"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd use `itUs = cacheCoins.try_emplace(it->first).first;` instead, it's just less code and does the same thing",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-12-04T19:40:15Z",
      "diff_hunk" : "@@ -214,22 +216,23 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     hashBlock = hashBlockIn;\n }\n \n-bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn, bool erase) {\n-    for (CCoinsMap::iterator it = mapCoins.begin();\n-            it != mapCoins.end();\n-            it = erase ? mapCoins.erase(it) : std::next(it)) {\n+bool CCoinsViewCache::BatchWrite(CoinsCachePair *pairs, const uint256 &hashBlockIn, bool erase) {\n+    for (auto it{pairs};\n+            it != nullptr;\n+            it = it->second.Next(erase)) {\n         // Ignore non-dirty entries (optimization).\n-        if (!(it->second.flags & CCoinsCacheEntry::DIRTY)) {\n+        if (!(it->second.GetFlags() & CCoinsCacheEntry::DIRTY)) {\n             continue;\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n             // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.flags & CCoinsCacheEntry::FRESH && it->second.coin.IsSpent())) {\n+            if (!(it->second.GetFlags() & CCoinsCacheEntry::FRESH && it->second.coin.IsSpent())) {\n                 // Create the coin in the parent cache, move the data up\n                 // and mark it as dirty.\n-                CCoinsCacheEntry& entry = cacheCoins[it->first];\n+                itUs = cacheCoins.emplace(std::piecewise_construct, std::forward_as_tuple(it->first), std::tuple<>()).first;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414402060",
      "id" : 1414402060,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII585UThAM",
      "original_commit_id" : "ba09f5039c4bd2868335d5616f86acbfa41bedd9",
      "original_line" : 234,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 133,
      "pull_request_review_id" : 1763003369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414402060/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T20:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414402060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414435232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414435232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, you could move that line in front of the `if`, then remove the else, like so:\r\n\r\n```cpp\r\nconst auto next_entry{it->second.Next(/*clear_flags=*/true)};\r\nif (it->second.coin.IsSpent()) {\r\n    cachedCoinsUsage -= it->second.coin.DynamicMemoryUsage();\r\n    cacheCoins.erase(it->first);\r\n}\r\nit = next_entry;\r\n```",
      "commit_id" : "0d83e209311d7286465255e592c9cfd9c8f84e7f",
      "created_at" : "2023-12-04T20:12:08Z",
      "diff_hunk" : "@@ -301,16 +306,20 @@ bool CCoinsViewCache::Flush() {\n \n bool CCoinsViewCache::Sync()\n {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/false);\n+    const auto fOk{base->BatchWrite(m_flagged_head.second.Next(), hashBlock, /*erase=*/false)};\n     // Instead of clearing `cacheCoins` as we would in Flush(), just clear the\n     // FRESH/DIRTY flags of any coin that isn't spent.\n-    for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {\n+    for (auto it{m_flagged_head.second.Next()}; it != nullptr; ) {\n         if (it->second.coin.IsSpent()) {\n+            // We need to get next entry before we erase this entry.\n+            // Since cacheCoins owns the entry, it will be deallocated before we\n+            // can access the next entry if we erase first.\n+            const auto next_entry{it->second.Next(/*clear_flags=*/true)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414435232",
      "id" : 1414435232,
      "line" : 317,
      "node_id" : "PRRC_kwDOABII585UTpGg",
      "original_commit_id" : "ba09f5039c4bd2868335d5616f86acbfa41bedd9",
      "original_line" : 317,
      "original_position" : 175,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 214,
      "pull_request_review_id" : 1763003369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414435232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-04T20:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414435232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414758537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414758537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Only 2 of the 6 previous `flags` assignments (aside from `= 0`) used simple assignment, the other 4 use OR assignment. The 2 that use simple assignment we know logically that they must have been just created and therefore their flags are 0 so we are not overwriting any existing flags. Therefore an OR assignment in those 2 cases is logically equivalent.\r\n\r\nSo if we were to go with your second suggestion we would need to modify behavior to make sure we assign the new flags we wish to set OR'd with the current flags so we don't overwrite existing flags. Or create separate Set and Add methods. I think that would make this patch more cumbersome.\r\n\r\nIt seems to me your first suggestion would be the path of least resistance. Updated to `AddFlags`.",
      "commit_id" : "c40714d94fa7fb68d1e61e5f192084289276cb74",
      "created_at" : "2023-12-05T02:15:17Z",
      "diff_hunk" : "@@ -9,6 +9,42 @@\n #include <random.h>\n #include <util/trace.h>\n \n+void CCoinsCacheEntry::SetFlags(uint8_t flags, CoinsCachePair &self, CoinsCachePair &head)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1414758537",
      "id" : 1414758537,
      "in_reply_to_id" : 1414384720,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585UU4CJ",
      "original_commit_id" : "d66ad8efafe95445fcfcec6c07a6117faa32fa36",
      "original_line" : 12,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : null,
      "pull_request_review_id" : 1763789494,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414758537/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-05T03:32:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1414758537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@martinus thank you very much for your review! I updated the PR with all your suggestions.",
      "created_at" : "2023-12-05T03:03:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1839920097",
      "id" : 1839920097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585tqvPh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1839920097/reactions"
      },
      "updated_at" : "2023-12-05T03:03:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1839920097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't think this through yet, but this might be an alternative way to achieve the same thing: Instead of the double linked list, split the `cacheCoins` map up into 4 different maps, one map for each flag setting, e.g. as a `std::array<CCoinMap, 4> m_cache_coins_per_flag;`. Index is the flag, e.g. `m_cache_coins_per_flag[FRESH | DIRTY]` to get the map with all entries that are fresh & dirty. Instead of setting a flag & linking the list, use the unordered_map's `auto node = extract(...)` and `insert(std::move(node))` to move the entry to the corresponding map. This only relinks the unordered_map node and causes no allocation, pointers to the entry stay valid. \r\n\r\nThis approach would have a few advantages:\r\n* Less memory usage: no `m_flag` member is needed that actually required 8 bytes due to alignment, no 2 pointers needed for interlinking, and multiple maps means overall bucket sizes will stay smaller.\r\n* processing the maps might be faster: iteration is fast because e.g. skipping non-dirty entries is trivial (they are in a different map). There might be a hashing overhead though from `extract()` and `insert()`.\r\n\r\nFor this to work, all 4 maps need to use the same `m_cache_coins_memory_resource` (`insert()` into a different map where the allocator doesn't compare equal is undefined behavior).",
      "created_at" : "2023-12-05T05:55:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1840061587",
      "id" : 1840061587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585trRyT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1840061587/reactions"
      },
      "updated_at" : "2023-12-05T05:59:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1840061587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1415458663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415458663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "One thing I don't like about `modernize-use-equals-default` is that it makes aggregate initialization possible again, when a developer disabled it by declaring a constructor.\r\n\r\nThough, now that C++20 will be required soon, I guess it can be enabled. C.f.\r\n\r\n```cpp\r\nstruct A {\r\n    // A() {}; // \"main\" fn fails to compile under C++17 and 20\r\n    A() = default;  // \"main\" fn fails to compile under C++20\r\n    int b{};\r\n};\r\n\r\nint main() { (void)A{1}; }\r\n",
      "commit_id" : "c40714d94fa7fb68d1e61e5f192084289276cb74",
      "created_at" : "2023-12-05T11:46:54Z",
      "diff_hunk" : "@@ -138,9 +137,9 @@ struct CCoinsCacheEntry\n         FRESH = (1 << 1),\n     };\n \n-    CCoinsCacheEntry() : flags(0) {}\n-    explicit CCoinsCacheEntry(Coin&& coin_) : coin(std::move(coin_)), flags(0) {}\n-    CCoinsCacheEntry(Coin&& coin_, unsigned char flag) : coin(std::move(coin_)), flags(flag) {}\n+    CCoinsCacheEntry() {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1415458663",
      "id" : 1415458663,
      "in_reply_to_id" : 1414243104,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585UXi9n",
      "original_commit_id" : "ba09f5039c4bd2868335d5616f86acbfa41bedd9",
      "original_line" : 140,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : null,
      "pull_request_review_id" : 1764866102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415458663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-05T11:46:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415458663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1415481883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415481883"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, I wasn't aware of that, good to know :+1: ",
      "commit_id" : "c40714d94fa7fb68d1e61e5f192084289276cb74",
      "created_at" : "2023-12-05T12:00:07Z",
      "diff_hunk" : "@@ -138,9 +137,9 @@ struct CCoinsCacheEntry\n         FRESH = (1 << 1),\n     };\n \n-    CCoinsCacheEntry() : flags(0) {}\n-    explicit CCoinsCacheEntry(Coin&& coin_) : coin(std::move(coin_)), flags(0) {}\n-    CCoinsCacheEntry(Coin&& coin_, unsigned char flag) : coin(std::move(coin_)), flags(flag) {}\n+    CCoinsCacheEntry() {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1415481883",
      "id" : 1415481883,
      "in_reply_to_id" : 1414243104,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585UXoob",
      "original_commit_id" : "ba09f5039c4bd2868335d5616f86acbfa41bedd9",
      "original_line" : 140,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : null,
      "pull_request_review_id" : 1764898773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415481883/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-05T12:00:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1415481883",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@martinus something similar was mentioned in https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-457720636. However, with your approach every access would require 4 lookups.",
      "created_at" : "2023-12-05T13:19:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1840779612",
      "id" : 1840779612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585tuBFc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1840779612/reactions"
      },
      "updated_at" : "2023-12-05T13:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1840779612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @martinus something similar was mentioned in [#15265 (comment)](https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-457720636). However, with your approach every access would require 4 lookups.\r\n\r\nHa, of course; I didn't think about that at all. ",
      "created_at" : "2023-12-05T19:43:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1841506238",
      "id" : 1841506238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII585twye-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1841506238/reactions"
      },
      "updated_at" : "2023-12-05T19:43:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1841506238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/22665800478</sub>",
      "created_at" : "2024-03-14T18:08:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-1998045192",
      "id" : 1998045192,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII5853F8AI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1998045192/reactions"
      },
      "updated_at" : "2024-03-14T18:08:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1998045192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1527532617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527532617"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"coins: add cache entry linked list fields and methods\"\r\n\r\nNit: `//!` is for doxygen comments on the *next* definition. Since this is really a comment on the next two, it probably shouldn't be a doxygen comment.",
      "commit_id" : "25bdbc7f340884b3ab871c7948a4f2693037b871",
      "created_at" : "2024-03-17T15:12:09Z",
      "diff_hunk" : "@@ -103,6 +106,14 @@ class Coin\n  */\n struct CCoinsCacheEntry\n {\n+private:\n+    //! These are used to create a doubly linked list of flagged entries. They",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1527532617",
      "id" : 1527532617,
      "line" : 110,
      "node_id" : "PRRC_kwDOABII585bDExJ",
      "original_commit_id" : "56faed97cd462345578b482c2d2089081ca393b6",
      "original_line" : 110,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/coins.h",
      "position" : 15,
      "pull_request_review_id" : 1941500013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527532617/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-17T15:22:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527532617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1527533452"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527533452"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"coins: track dirty cache entries in doubly linked list\"\r\n\r\nUse a C++17 structured binding:\r\n\r\n```c++\r\nauto [it, inserted] = cacheCoins.emplace(\r\n```",
      "commit_id" : "25bdbc7f340884b3ab871c7948a4f2693037b871",
      "created_at" : "2024-03-17T15:16:08Z",
      "diff_hunk" : "@@ -108,10 +108,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n \n void CCoinsViewCache::EmplaceCoinInternalDANGER(COutPoint&& outpoint, Coin&& coin) {\n     cachedCoinsUsage += coin.DynamicMemoryUsage();\n-    cacheCoins.emplace(\n+    CCoinsMap::iterator it;\n+    bool inserted;\n+    std::tie(it, inserted) = cacheCoins.emplace(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1527533452",
      "id" : 1527533452,
      "line" : 113,
      "node_id" : "PRRC_kwDOABII585bDE-M",
      "original_commit_id" : "75a248f770fed4d8bf664bb9d5ed1f80e51c9bc8",
      "original_line" : 113,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 47,
      "pull_request_review_id" : 1941500013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527533452/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-17T15:22:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527533452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1527534087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527534087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"coins: track dirty cache entries in doubly linked list\"\r\n\r\nShould `FRESH`-but-not-`DIRTY` be flagged? I believe those correspond to spent but unmodified coins fetched from the parent cache.\r\n\r\nIf the rule is flagged == dirty, then perhaps it makes sense to instead of having `AddFlags` and `Clearflags` have a single `SetFlags`, which knows whether the new state is supposed to be in the list or not (moving the responsibility of flagged-or-not to that function instead of the caller). EDIT: I notice you used to have a `SetFlags`, actually, but my comments is more about where the responsibility lies for deciding whether an entry ought to be flagged or not than the actual function names.",
      "commit_id" : "25bdbc7f340884b3ab871c7948a4f2693037b871",
      "created_at" : "2024-03-17T15:19:45Z",
      "diff_hunk" : "@@ -51,7 +51,7 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n     if (ret->second.coin.IsSpent()) {\n         // The parent only has an empty entry for this outpoint; we can consider our\n         // version as fresh.\n-        ret->second.flags = CCoinsCacheEntry::FRESH;\n+        ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_flagged_head);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1527534087",
      "id" : 1527534087,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585bDFIH",
      "original_commit_id" : "75a248f770fed4d8bf664bb9d5ed1f80e51c9bc8",
      "original_line" : 54,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 23,
      "pull_request_review_id" : 1941500013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527534087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-17T15:54:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527534087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1532602577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532602577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Should `FRESH`-but-not-`DIRTY` be flagged? I believe those correspond to spent but unmodified coins fetched from the parent cache.\r\n\r\nYes, but only because in this case they are also spent. We erase all spent coins from the cache after doing a non-erasing batch write. There would be no way to track spent-but-not-`DIRTY` otherwise except by scanning the entire cache.\r\n\r\nSince the only case where we have `FRESH`-but-not-`DIRTY` is where the coin is spent, it makes sense to me to just add this to the linked list as well. Before proposing this PR I did call the linked list head `m_dirty_head`, but after not finding an efficient way to remove non-dirty spent entries, I decided to call it `m_flagged_head`.\r\n\r\nIf this makes sense to you I can add a comment here explaining this.",
      "commit_id" : "25bdbc7f340884b3ab871c7948a4f2693037b871",
      "created_at" : "2024-03-20T18:32:51Z",
      "diff_hunk" : "@@ -51,7 +51,7 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n     if (ret->second.coin.IsSpent()) {\n         // The parent only has an empty entry for this outpoint; we can consider our\n         // version as fresh.\n-        ret->second.flags = CCoinsCacheEntry::FRESH;\n+        ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_flagged_head);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1532602577",
      "id" : 1532602577,
      "in_reply_to_id" : 1527534087,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585bWajR",
      "original_commit_id" : "75a248f770fed4d8bf664bb9d5ed1f80e51c9bc8",
      "original_line" : 54,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 23,
      "pull_request_review_id" : 1949746270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532602577/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-20T18:32:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532602577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1532606237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532606237"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@andrewtoth Ah, I see, that makes sense. I would be good to add comments to explain that flagged means \"FRESH, DIRTY, or both\" and why.",
      "commit_id" : "25bdbc7f340884b3ab871c7948a4f2693037b871",
      "created_at" : "2024-03-20T18:35:18Z",
      "diff_hunk" : "@@ -51,7 +51,7 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n     if (ret->second.coin.IsSpent()) {\n         // The parent only has an empty entry for this outpoint; we can consider our\n         // version as fresh.\n-        ret->second.flags = CCoinsCacheEntry::FRESH;\n+        ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_flagged_head);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1532606237",
      "id" : 1532606237,
      "in_reply_to_id" : 1527534087,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585bWbcd",
      "original_commit_id" : "75a248f770fed4d8bf664bb9d5ed1f80e51c9bc8",
      "original_line" : 54,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 23,
      "pull_request_review_id" : 1949752247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532606237/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-20T18:35:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532606237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@0xB10C rebased after https://github.com/bitcoin/bitcoin/pull/20827 was merged, and ran the following benchmark:\r\n```\r\nhyperfine --export-markdown ~/bench.md --show-output --parameter-list commit 015ac13dcc964a31ef06dfdb565f88f901607f0e,25bdbc7f340884b3ab871c7948a4f2693037b871 --prepare 'git checkout {commit} && make -j$(nproc) src/bitcoind; sync; sudo /sbin/sysctl vm.drop_caches=3; rm -rf ~/.bitcoin/blocks; rm -rf ~/.bitcoin/chainstate;' -M 3 './src/bitcoind -dbcache=4000 -prune=550 -printtoconsole=0 -connect=<local network node ip> -stopatheight=800000'\r\n\r\n...\r\n\r\nBenchmark 1: ./src/bitcoind -dbcache=4000 -prune=550 -printtoconsole=0 -connect=<local network node ip> -stopatheight=800000 (commit = 015ac13dcc964a31ef06dfdb565f88f901607f0e)\r\n\r\n  Time (mean Â± Ï):     27241.365 s Â± 33.693 s    [User: 34791.898 s, System: 7357.098 s]\r\n  Range (min â¦ max):   27202.978 s â¦ 27266.037 s    3 runs\r\n\r\nBenchmark 2: ./src/bitcoind -dbcache=4000 -prune=550 -printtoconsole=0 -connect=<local network node ip> -stopatheight=800000 (commit = 25bdbc7f340884b3ab871c7948a4f2693037b871)\r\n\r\n  Time (mean Â± Ï):     22153.568 s Â± 37.663 s    [User: 27818.681 s, System: 4309.878 s]\r\n  Range (min â¦ max):   22119.682 s â¦ 22194.118 s    3 runs\r\n \r\nSummary\r\n  ./src/bitcoind -dbcache=4000 -prune=550 -printtoconsole=0 -connect=192.168.2.13 -stopatheight=800000 (commit = 25bdbc7f340884b3ab871c7948a4f2693037b871) ran\r\n    1.23 Â± 0.00 times faster than ./src/bitcoind -dbcache=4000 -prune=550 -printtoconsole=0 -connect=192.168.2.13 -stopatheight=800000 (commit = 015ac13dcc964a31ef06dfdb565f88f901607f0e)\r\n```\r\nSo this is 23% faster than master when using `dbcache=4000`, `prune=550`. (I just rebased again but 015ac13dcc964a31ef06dfdb565f88f901607f0e is master and 25bdbc7f340884b3ab871c7948a4f2693037b871 is my branch).\r\n\r\n@sipa thank you for your review! Addressed your nits and added more comments about flagged entries.\r\n",
      "created_at" : "2024-03-21T14:11:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-2012404862",
      "id" : 2012404862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII58538tx-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2012404862/reactions"
      },
      "updated_at" : "2024-03-21T14:15:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2012404862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-22T20:09:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-2015828895",
      "id" : 2015828895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII5854Jxuf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2015828895/reactions"
      },
      "updated_at" : "2024-03-22T20:09:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2015828895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and ran some faster benchmarks, 2 each but only until 400k. Will do some more going to 800k.\r\n\r\n|  | prune | dbcache | mean time (s) | speedup |\r\n|-----------:|----------:|------------:|--------:|--------------:|\r\n| master | 550 | 16384 | 2,018 | - |\r\n| branch | 550 | 16384 | 1,667 | 17.4% |\r\n| master | 550 | 450 | 2,069 | - |\r\n| branch | 550 | 450 | 1,822 | 11.9% |\r\n| master | 0 | 16384 | 1,447 | - |\r\n| branch | 0 | 16384 | 1,396 | 3.5% |\r\n| master | 0 | 450 | 1,546 | - |\r\n| branch | 0 | 450 | 1,527 |1.2%|\r\n\r\nCommand was\r\n```\r\nhyperfine \\\r\n--export-markdown ~/bench.md \\\r\n--show-output \\\r\n--parameter-list commit 0d509bab45d292caeaf34600e57b5928757c6005,499f1f029a265fbeb4824e5cb84726f82ca2824b \\\r\n--parameter-list dbcache 450,16384 \\\r\n--parameter-list prune 550,0 \\\r\n--prepare 'git checkout {commit} && \\\r\nmake -j$(nproc) src/bitcoind; \\\r\nsync; sudo /sbin/sysctl vm.drop_caches=3; \\\r\nrm -rf /home/user/.bitcoin/blocks; \\\r\nrm -rf /home/user/.bitcoin/chainstate;' \\\r\n-M 2 \\\r\n'echo '{commit}' && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-dbcache={dbcache} \\\r\n-prune={prune} \\\r\n-printtoconsole=0 \\\r\n-connect=<local node> \\\r\n-stopatheight=400000'\r\n```",
      "created_at" : "2024-04-04T21:26:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-2038255584",
      "id" : 2038255584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
      "node_id" : "IC_kwDOABII5855fU_g",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2038255584/reactions"
      },
      "updated_at" : "2024-04-04T21:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2038255584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   }
]
