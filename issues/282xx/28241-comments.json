[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28241).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28983](https://github.com/bitcoin/bitcoin/pull/28983) (Stratum v2 Template Provider (take 2) by Sjors)\n* [#28955](https://github.com/bitcoin/bitcoin/pull/28955) (index: block filters sync, reduce disk read operations by caching last header by furszy)\n* [#28875](https://github.com/bitcoin/bitcoin/pull/28875) (build: Pass sanitize flags to instrument `libsecp256k1` code by hebasto)\n* [#28201](https://github.com/bitcoin/bitcoin/pull/28201) (Silent Payments: sending by josibake)\n* [#28122](https://github.com/bitcoin/bitcoin/pull/28122) (Silent Payments: Implement BIP352 by josibake)\n* [#27351](https://github.com/bitcoin/bitcoin/pull/27351) (wallet: add `seeds` argument to `importdescriptors` by apoelstra)\n* [#27260](https://github.com/bitcoin/bitcoin/pull/27260) (Enhanced error messages for invalid network prefix during address parsing. by russeree)\n* [#24539](https://github.com/bitcoin/bitcoin/pull/24539) (Add a \"tx output spender\" index by sstone)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-08-09T09:13:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1670962513",
      "id" : 1670962513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jmN1R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670962513/reactions"
      },
      "updated_at" : "2024-01-24T02:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670962513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'd like to keep this based on #28122 but that requires some refactoring there. See https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1670943979.",
      "created_at" : "2023-08-09T09:15:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1670965334",
      "id" : 1670965334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jmOhW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670965334/reactions"
      },
      "updated_at" : "2023-08-09T09:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670965334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'd like to keep this based on #28122 but that requires some refactoring there. See [#28122 (comment)](https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1670943979).\r\n\r\nyou can also rebase on https://github.com/bitcoin/bitcoin/pull/27827 , which has everything, or just the receiving PR. Might be easier then to reason about which functions belong in which PRs if we can see it all together. I think the functions you need are introduced in the receiving PR (#28202)",
      "created_at" : "2023-08-09T09:39:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1670999533",
      "id" : 1670999533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jmW3t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670999533/reactions"
      },
      "updated_at" : "2023-08-09T09:39:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670999533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'll take a stab at rebasing on the bigger thing. It makes sense to do that and then unrebase / debase(?) it later.",
      "created_at" : "2023-08-09T11:40:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1671166932",
      "id" : 1671166932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jm_vU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671166932/reactions"
      },
      "updated_at" : "2023-08-09T11:40:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671166932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I ended up \"borrowing\" some code from the followup PRs, without having to rebase on them.\r\n\r\nThis code compiles and the index doesn't crash. That's about the extend of it though :-) For now.",
      "created_at" : "2023-08-09T14:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1671573912",
      "id" : 1671573912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jojGY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671573912/reactions"
      },
      "updated_at" : "2023-08-09T14:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671573912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hi, I have a little question about the motivation for making this index in Core. Afaiu, an implementation of electrum server (or any light client backend) could construct this index as easily, and I think it would be better separation of concerns to let them take responsibility for this instead of Core. Or maybe it's necessary for the consistency check you're mentioning? I'm not sure of what it is.",
      "created_at" : "2023-09-04T12:23:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1705177519",
      "id" : 1705177519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585lovGv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705177519/reactions"
      },
      "updated_at" : "2023-09-04T12:23:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705177519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11726747?v=4",
         "events_url" : "https://api.github.com/users/Sosthene00/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sosthene00/followers",
         "following_url" : "https://api.github.com/users/Sosthene00/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sosthene00/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sosthene00",
         "id" : 11726747,
         "login" : "Sosthene00",
         "node_id" : "MDQ6VXNlcjExNzI2NzQ3",
         "organizations_url" : "https://api.github.com/users/Sosthene00/orgs",
         "received_events_url" : "https://api.github.com/users/Sosthene00/received_events",
         "repos_url" : "https://api.github.com/users/Sosthene00/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sosthene00/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sosthene00/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sosthene00"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sosthene00 I find it useful to have this index for developing and reviewing the silent payment implementation. But as you say, it may not be worth merging eventually. I'm not sure about that yet.\r\n\r\nThere's also the possibility of building something like this on top of the Kernel, when that project is a bit further along.",
      "created_at" : "2023-09-04T14:39:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1705381372",
      "id" : 1705381372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585lpg38",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705381372/reactions"
      },
      "updated_at" : "2023-09-04T14:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705381372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-07T16:04:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1710417733",
      "id" : 1710417733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585l8udF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710417733/reactions"
      },
      "updated_at" : "2023-09-07T16:04:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710417733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased to use `GetSilentPaymentsTweakDataFromTxInputs`. Otherwise still WIP.",
      "created_at" : "2023-09-19T14:49:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1725798395",
      "id" : 1725798395,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m3Zf7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1725798395/reactions"
      },
      "updated_at" : "2023-09-19T14:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1725798395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a simple RPC method to get the tweaked public key for a given transaction. I'd like to sanity check it against some other implementation.\r\n\r\nSignet: [dacb55db5c506a34771bf8ac3664e2510c17e80ada81347300fb4223f2d6c545](https://mempool.space/signet/tx/dacb55db5c506a34771bf8ac3664e2510c17e80ada81347300fb4223f2d6c545)\r\n\r\n`getsilentpaymenttxdata` result: `03fc95cfeac43e9179c002d32a042626e5a2b289a8d7a4a0c88fbf81d570cef987`\r\n\r\n\r\n",
      "created_at" : "2023-09-19T16:20:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1726028248",
      "id" : 1726028248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m4RnY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726028248/reactions"
      },
      "updated_at" : "2023-09-19T16:20:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726028248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-19T18:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1726248570",
      "id" : 1726248570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m5HZ6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726248570/reactions"
      },
      "updated_at" : "2023-09-19T18:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726248570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331775156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331775156"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this logic doesn't match the BIP, as it currently implements \"all outputs have to be taproot outputs\" rather than \"at least _one_ output has to be a taproot output\"? Could use `std::none_of` to achieve the latter (https://en.cppreference.com/w/cpp/algorithm/all_any_none_of).\r\n\r\nSomething like\r\n```\r\n    if (std::none_of(tx.vout.begin(), tx.vout.end(), [](const TxOut& txout) {\r\n            std::vector<std::vector<unsigned char>> solutions;\r\n            return Solver(vout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;\r\n        }) {\r\n        return false;\r\n    }\r\n```\r\n(untested)",
      "commit_id" : "8b63994eccf981e0d2cd907ed41b1633842d0a3f",
      "created_at" : "2023-09-20T15:03:39Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331775156",
      "id" : 1331775156,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII585PYUa0",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 64,
      "pull_request_review_id" : 1635872510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331775156/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:03:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331775156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331881346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331881346"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@josibake it sounds like this should be another helper function. The index shouldn't be too far in the weeds of the BIP rules.\r\n\r\nHowever, I'll look into fixing this.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T16:09:49Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331881346",
      "id" : 1331881346,
      "in_reply_to_id" : 1331775156,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PYuWC",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1636035765,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331881346/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T16:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331881346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr since you've been working on indexes, do you have any feedback on indexer best practices I should follow? ",
      "created_at" : "2023-09-20T16:13:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1728050950",
      "id" : 1728050950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m__cG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728050950/reactions"
      },
      "updated_at" : "2023-09-20T16:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728050950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331900870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331900870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be fixed now.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T16:26:14Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331900870",
      "id" : 1331900870,
      "in_reply_to_id" : 1331775156,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PYzHG",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1636065708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331900870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T16:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331900870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331905745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331905745"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It might be nice if the indexer base class can skip ahead to a minimum height, as it takes a bunch of time to go through all the blocks.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T16:30:17Z",
      "diff_hunk" : "@@ -0,0 +1,134 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks)\n+{\n+    CDBBatch batch(*this);\n+    batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tweaks.first), tweaks.second);\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs, CBlockUndo& block_undo, std::vector<CPubKey>& tweaked_pub_key_sums)\n+{\n+    assert(txs.size() - 1 == block_undo.vtxundo.size());\n+\n+    for (uint32_t i=0; i < txs.size(); i++) {\n+        auto& tx = txs.at(i);\n+\n+        if (tx->IsCoinBase()) {\n+            continue;\n+        }\n+\n+        for (auto& vout : tx->vout) {\n+            if (std::none_of(tx->vout.begin(), tx->vout.end(), [vout](const CTxOut& txout) {\n+                std::vector<std::vector<unsigned char>> solutions;\n+                return Solver(vout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;\n+            })) {\n+                continue;\n+            }\n+        }\n+\n+        // -1 as blockundo does not have coinbase tx\n+        CTxUndo undoTX{block_undo.vtxundo.at(i - 1)};\n+        std::map<COutPoint, Coin> coins;\n+\n+        for (uint32_t j = 0; j < tx->vin.size(); j++) {\n+            coins[tx->vin.at(j).prevout] = undoTX.vprevout.at(j);\n+        }\n+\n+        const auto tweak_data = wallet::GetSilentPaymentsTweakDataFromTxInputs(tx->vin, coins);\n+\n+        if (!tweak_data) continue;\n+\n+        const uint256 outpoint_hash = tweak_data->first;\n+        CPubKey tweaked_pub_key_sum = tweak_data->second;\n+        if (!tweaked_pub_key_sum.TweakAdd(outpoint_hash.begin())) {\n+            // TODO: Is this bad??\n+            continue;\n+        }\n+        assert(tweaked_pub_key_sum.IsFullyValid());\n+        tweaked_pub_key_sums.emplace_back(tweaked_pub_key_sum);\n+    }\n+\n+    // TODO: so this can never fail?\n+    return true;\n+\n+\n+}\n+\n+bool SilentPaymentIndex::CustomAppend(const interfaces::BlockInfo& block)\n+{\n+    // Exclude genesis block transaction because outputs are not spendable.\n+    if (block.height == 0) return true;\n+\n+    assert(block.data);\n+\n+    Consensus::Params consensus = Params().GetConsensus();\n+\n+    if (block.height < consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331905745",
      "id" : 1331905745,
      "line" : 103,
      "node_id" : "PRRC_kwDOABII585PY0TR",
      "original_commit_id" : "91fd02f4474c1cfae2aaa5064866e9766dbd7379",
      "original_line" : 103,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 103,
      "pull_request_review_id" : 1636074083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331905745/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T16:30:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331905745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331983796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331983796"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, pushing new fix.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T17:42:45Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331983796",
      "id" : 1331983796,
      "in_reply_to_id" : 1331775156,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PZHW0",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1636196767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331983796/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T17:42:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331983796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The index (as generated by 46b32b63d57a62466a2b2181e28bab477dc8de95) is 54GB on mainnet and took about 2 hours to generate (of which much time was wasted looping through pre-taproot blocks). Something like #26966 could make it even faster.\r\n\r\nI'd like to compare the results in this mainnet index to another implementation, if someone can point me to one.",
      "created_at" : "2023-09-21T09:42:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1729224452",
      "id" : 1729224452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nEd8E",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729224452/reactions"
      },
      "updated_at" : "2023-09-21T09:43:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729224452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@setavenger you mentioned using a light client in the tracking issue. Does that have an index or some other way to compare to this PR?",
      "created_at" : "2023-09-28T08:34:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1738712806",
      "id" : 1738712806,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585noqbm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738712806/reactions"
      },
      "updated_at" : "2023-09-28T08:34:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738712806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @setavenger you mentioned using a light client in the tracking issue. Does that have an index or some other way to compare to this PR?\r\n\r\nHmm I don't think it matches exactly what you are doing here. My backend was built as a \"light client\" itself and with the assumption that it would only index forward looking from a certain activation point. It does create an index but it's not running a full node which means there's a lot of networking happening to services that offer prevout information per transacton. I would be surprised if it would take less than two hours to index the entire chain. Plus I would probably get rate limited before even being able to index the entire chain.\r\n\r\nThat being said I was thinking of upgrading my backend to using a fullnode I could give an update then.",
      "created_at" : "2023-09-28T11:15:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1738949322",
      "id" : 1738949322,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585npkLK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738949322/reactions"
      },
      "updated_at" : "2023-09-28T11:15:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738949322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I see. Even a few spot checks against what this index produces would be useful though.",
      "created_at" : "2023-09-28T13:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1739195463",
      "id" : 1739195463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nqgRH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739195463/reactions"
      },
      "updated_at" : "2023-09-28T13:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739195463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Yeah, we could do that perhaps for selected blocks. I just have to get the handling of P2PKH inputs in order, then I should be able to index any block from the chain.",
      "created_at" : "2023-09-28T15:15:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1739502295",
      "id" : 1739502295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nrrLX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739502295/reactions"
      },
      "updated_at" : "2023-09-28T15:15:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739502295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340496572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340496572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`silentpaymentindex`?",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-28T17:54:18Z",
      "diff_hunk" : "@@ -905,6 +917,8 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n     if (args.GetIntArg(\"-prune\", 0)) {\n         if (args.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n+        if (args.GetBoolArg(\"-silentpaymentindex\", DEFAULT_SILENT_PAYMENT_INDEX))\n+            return InitError(_(\"Prune mode is incompatible with -txospenderindex.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340496572",
      "id" : 1340496572,
      "line" : 921,
      "node_id" : "PRRC_kwDOABII585P5lq8",
      "original_commit_id" : "432b7a235a2972b5c0064ab9eca44606760aa9b8",
      "original_line" : 921,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 45,
      "pull_request_review_id" : 1649426783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340496572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T19:54:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340496572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340671534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340671534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, we don't have the possibility to skip blocks yet, so I think we would need to add it as a feature on base index, I have started drafting it here, though it's not functional yet: https://github.com/fjahr/bitcoin/commit/cd7bf1249765a011210653c393b3a0fdb7106d55\r\n\r\nBut I also guess 2h doesn't sound extremely bad, we might want more than one silentpaymentindex to motivate something like this.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-28T21:09:42Z",
      "diff_hunk" : "@@ -0,0 +1,134 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks)\n+{\n+    CDBBatch batch(*this);\n+    batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tweaks.first), tweaks.second);\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs, CBlockUndo& block_undo, std::vector<CPubKey>& tweaked_pub_key_sums)\n+{\n+    assert(txs.size() - 1 == block_undo.vtxundo.size());\n+\n+    for (uint32_t i=0; i < txs.size(); i++) {\n+        auto& tx = txs.at(i);\n+\n+        if (tx->IsCoinBase()) {\n+            continue;\n+        }\n+\n+        for (auto& vout : tx->vout) {\n+            if (std::none_of(tx->vout.begin(), tx->vout.end(), [vout](const CTxOut& txout) {\n+                std::vector<std::vector<unsigned char>> solutions;\n+                return Solver(vout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;\n+            })) {\n+                continue;\n+            }\n+        }\n+\n+        // -1 as blockundo does not have coinbase tx\n+        CTxUndo undoTX{block_undo.vtxundo.at(i - 1)};\n+        std::map<COutPoint, Coin> coins;\n+\n+        for (uint32_t j = 0; j < tx->vin.size(); j++) {\n+            coins[tx->vin.at(j).prevout] = undoTX.vprevout.at(j);\n+        }\n+\n+        const auto tweak_data = wallet::GetSilentPaymentsTweakDataFromTxInputs(tx->vin, coins);\n+\n+        if (!tweak_data) continue;\n+\n+        const uint256 outpoint_hash = tweak_data->first;\n+        CPubKey tweaked_pub_key_sum = tweak_data->second;\n+        if (!tweaked_pub_key_sum.TweakAdd(outpoint_hash.begin())) {\n+            // TODO: Is this bad??\n+            continue;\n+        }\n+        assert(tweaked_pub_key_sum.IsFullyValid());\n+        tweaked_pub_key_sums.emplace_back(tweaked_pub_key_sum);\n+    }\n+\n+    // TODO: so this can never fail?\n+    return true;\n+\n+\n+}\n+\n+bool SilentPaymentIndex::CustomAppend(const interfaces::BlockInfo& block)\n+{\n+    // Exclude genesis block transaction because outputs are not spendable.\n+    if (block.height == 0) return true;\n+\n+    assert(block.data);\n+\n+    Consensus::Params consensus = Params().GetConsensus();\n+\n+    if (block.height < consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340671534",
      "id" : 1340671534,
      "in_reply_to_id" : 1331905745,
      "line" : 103,
      "node_id" : "PRRC_kwDOABII585P6QYu",
      "original_commit_id" : "91fd02f4474c1cfae2aaa5064866e9766dbd7379",
      "original_line" : 103,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 103,
      "pull_request_review_id" : 1649715687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340671534/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T21:09:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340671534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1341036797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341036797"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I should probably get rid of this error, since the entry for each block is independent, pruning shouldn't be a problem.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-29T07:54:56Z",
      "diff_hunk" : "@@ -905,6 +917,8 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n     if (args.GetIntArg(\"-prune\", 0)) {\n         if (args.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n+        if (args.GetBoolArg(\"-silentpaymentindex\", DEFAULT_SILENT_PAYMENT_INDEX))\n+            return InitError(_(\"Prune mode is incompatible with -txospenderindex.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1341036797",
      "id" : 1341036797,
      "in_reply_to_id" : 1340496572,
      "line" : 921,
      "node_id" : "PRRC_kwDOABII585P7pj9",
      "original_commit_id" : "432b7a235a2972b5c0064ab9eca44606760aa9b8",
      "original_line" : 921,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 45,
      "pull_request_review_id" : 1650257409,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341036797/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T07:54:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341036797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Silent Payments is built with versioning in mind. They're not types like with BIP157 filters, but rather ways to support transactions that have inputs with new script patterns.\r\n\r\nUnless there's no more soft forks, it's quite likely to actually need these new versions. E.g. any new taproot version will need a new silent payment version in order to be able to spend from it.\r\n\r\nThat said, I have not thought at all on how to handle such versioning. Although the `-silentpaymentindex` takes a version number, the index itself doesn't have versioning. I'll have to study the BIP more closely to figure out how versioning works.\r\n\r\nThe most simple solution is to just redesign and rebuild the index by the time that's needed. But if basic versioning can be supported with little code complexity and storage overhead, I would prefer that.\r\n\r\nAdded a note to the PR description to address this. \r\n\r\n> I currently have to set -silentpaymentindex=0 explicitly if I don't want to activate it in this branch\r\n\r\nWill look into that along with the above. The index should be off by default. I probably want the user to set the maximum supported silent paymnets version. That way they won't automatically upgrade later (which might involve increased storage requirements). But since the first version is `0` that's an ambiguous argument. Adding a `v` prefix would be an easy solution:\r\n\r\n* `-silentpaymentindex=0`: index is off (default)\r\n* `-silentpaymentindex=v0`: index version 0\r\n\r\nIn the future, either:\r\n* `-silentpaymentindex=v1`: index version 0 and 1; or\r\n* `-silentpaymentindex=v1`: index _only_ version 1 (makes no sense if the v1 index is a superset of v0, so I have to read up on this)\r\n\r\n> it will need reorg robustness\r\n\r\nThe index is stored and queried by block hash. Each entry is independent (nothing cumulative). So I think it's fine to keep reorged blocks around. But there should be a test to make sure the new block is added.",
      "created_at" : "2023-09-29T08:03:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1740477714",
      "id" : 1740477714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nvZUS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740477714/reactions"
      },
      "updated_at" : "2023-09-29T08:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740477714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I posted a short wish list of helper functions on the base PR, to make the index a bit less aware of low level protocol details: https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1738728491",
      "created_at" : "2023-09-29T08:07:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1740482543",
      "id" : 1740482543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nvafv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740482543/reactions"
      },
      "updated_at" : "2023-09-29T08:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740482543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I am still confused why we need to let users decide which version of the index they want to run. What is the motivation to let users run an older version of the index explicitly even though they have a newer version available in their node and the newer version isn't missing anything? I don't see a good reason for it aside from maybe storage space. So then I think the index should be either on or off and it will be updated with every softfork to accommodate for the new types once the softfork activates. That way there is also no reindex needed if users upgrade their nodes in time. We could do explicit versioning in this scenario if it helps to simplify things I am not sure it's even needed.\r\n\r\nAnd if the storage argument is really something that matters, then I don't see why we wouldn't treat it just like blockfilterstypes. It seems much simpler to have separate indexes for each of these new softforks/silentpayment versions rather than deal with all the compatibility stuff inside a single index. That would also make sense in light of the storage argument: If I am just starting to use silent payments with segwit v5 then I don't care about the silent payments that were maybe done before on older segwit versions and I could save a lot of space if I can just run `-siltentpaymentindex=5` or so.\r\n\r\nEDIT: Is it an issue with the second suggests path that senders can theoretically send to any version after taproot and the receiver can not control it? In that case I guess the first path makes even more sense because then there is really no reason for receivers to run with an older version of the index.",
      "created_at" : "2023-09-29T15:16:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1741055405",
      "id" : 1741055405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nxmWt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741055405/reactions"
      },
      "updated_at" : "2023-09-29T15:31:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741055405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What is the motivation to let users run an older version of the index explicitly even though they have a newer version available in their node and the newer version isn't missing anything? I don't see a good reason for it aside from maybe storage space.\r\n\r\nStorage space would be the reason. Though in general I expect new soft forks to have low transaction counts and therefore not much extra storage. So maybe that's not a big deal.\r\n\r\nThe other question is how to serve older clients. That might involve keeping one version entry per block and then joining them as needed. But that doesn't require versioning at the `-silentpaymentindex` level.",
      "created_at" : "2023-09-29T16:36:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1741188015",
      "id" : 1741188015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nyGuv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741188015/reactions"
      },
      "updated_at" : "2023-09-29T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741188015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and added a simple functional test, which includes a (hopefully) deterministic tweak. ",
      "created_at" : "2023-12-11T11:48:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1849912410",
      "id" : 1849912410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585uQ2xa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1849912410/reactions"
      },
      "updated_at" : "2023-12-11T11:48:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1849912410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-26T13:13:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1912049718",
      "id" : 1912049718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585x95A2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912049718/reactions"
      },
      "updated_at" : "2024-01-26T13:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912049718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors I've made some on #28122 to reflect the changes in the BIP + a few naming cleanups on the functions. Should be good to go for a rebase here, if you're still working on this.",
      "created_at" : "2024-01-26T15:04:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1912215341",
      "id" : 1912215341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585x-hct",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912215341/reactions"
      },
      "updated_at" : "2024-01-26T15:04:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912215341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Will do soon(tm)",
      "created_at" : "2024-01-29T09:39:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1914312450",
      "id" : 1914312450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yGhcC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 1,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1914312450/reactions"
      },
      "updated_at" : "2024-01-29T09:39:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1914312450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I was tinkering around with this and had a few thoughts:\r\n\r\n* Being able to specify a `start_height` sounds like something that would be generally useful for all indexes, not just this one. I've been toying with the idea of what it would take to have a \"pruned\" txindex and I would need to be able to start from a specific height for that. @fjahr I took the branch you started and got it working with a little tinkering here: https://github.com/josibake/bitcoin/tree/add-start-height-to-base-index . With a little more work this could probably be it's own PR. Feel free to grab this branch, or I can open a PR if you're busy with other stuff!\r\n* I wanted to see how difficult it would be to make this as a new `BlockFilterType`, and it was way easier than I thought it would be. The blockfilterindex code is really well designed! I copied the SP logic from this PR and got a hacked together working branch here: https://github.com/josibake/bitcoin/tree/implement-bip352-blockfilterindex (this syncs on my laptop in < 1 hr on mainnet and ends up being around 1.5gb on disk)\r\n\r\nWith the `blockfilterindex`, all we would need to do is propose a new filter type BIP and everything Just Works (TM) for light clients that support BIP157. I don't see any easy way to \"prune\" this index to only have data for the UTXO set.. but I also don't see a way to easily do that with a general index like we have in this PR either. I'm also less convinced this matters (for right now), and more worried we might be prematurely optimizing at this stage.\r\n\r\n@Sjors brought up some good points about versioning, but I can see that working with a block filter index in that we would just propose a new filter type for new version types (fine, so long as we don't frequently update silent payments versions), or if we do find ourselves needing to frequently update the version we just build versioning into the encoded filter e.g. return data for all versions and let the clients figure it out, or split up the encoded filter into sections with version bytes? \r\n\r\nCurious what you guys think on how to proceed, @Sjors @fjahr. In my mind, it makes more sense to go with a custom index if we have a clean way to support pruning to the UTXO set, and we'd also need to think about how to make this index available to light clients. If instead we go the blockfilterindex route, we get all the infrastructure for supporting light clients for free (and fast wallet rescans), but probably more difficult to build in custom logic like SP versions and UTXO pruning, since the blockfilterindexes are somewhat rigid in how they are built.",
      "created_at" : "2024-01-31T19:24:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1919780358",
      "id" : 1919780358,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585ybYYG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1919780358/reactions"
      },
      "updated_at" : "2024-01-31T19:24:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1919780358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> With a little more work this could probably be it's own PR. Feel free to grab this branch, or I can open a PR if you're busy with other stuff!\r\n\r\nIf you're feeling momentum, best just open a new PR. I'll then close this one. I can always take back the baton and reopen. ",
      "created_at" : "2024-02-01T13:26:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1921321547",
      "id" : 1921321547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yhQpL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921321547/reactions"
      },
      "updated_at" : "2024-02-01T13:26:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921321547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > With a little more work this could probably be it's own PR. Feel free to grab this branch, or I can open a PR if you're busy with other stuff!\r\n> \r\n> If you're feeling momentum, best just open a new PR. I'll then close this one. I can always take back the baton and reopen.\r\n\r\nI was referring to opening a PR just for adding `start_height` to the indexes (the work that @fjahr had started), but I'm also happy to open a blockfilterindex PR! Although, curious if you had any thoughts regarding the rest of my comment re: pruning to the UTXO set and versioning?\r\n",
      "created_at" : "2024-02-01T13:50:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1921373748",
      "id" : 1921373748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yhdY0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921373748/reactions"
      },
      "updated_at" : "2024-02-01T13:50:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921373748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@josibake I'll get back to you on those later.",
      "created_at" : "2024-02-01T14:20:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1921448658",
      "id" : 1921448658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yhvrS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921448658/reactions"
      },
      "updated_at" : "2024-02-01T14:20:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921448658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
