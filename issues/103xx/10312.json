{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "### Describe\r\n1. The specfile declare `Version: 0.12.0` and inject it to the source URLs to get some files which haven't added yet in tag `v0.12.0`\r\n2. The specfile still declare `Version: 0.12.0` when changes breaking the build process for v0.12.0 are committed. (#9956)\r\n3. testscript p2p-fullblocktest.py fail (with specfile in d34995a, just before #9956 mess up the directory structure)\r\n### Reproduce\r\n1. \r\n```markdown\r\nspectool -g -f ~/rpmbuild/SPECS/bitcoin.spec\r\nGetting https://bitcoin.org/bin/bitcoin-core-0.12.0/bitcoin-0.12.0.tar.gz to ./bitcoin-0.12.0.tar.gz\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 5272k  100 5272k    0     0   193k      0  0:00:27  0:00:27 --:--:--  205k\r\nGetting http://download.oracle.com/berkeley-db/db-4.8.30.NC.tar.gz to ./db-4.8.30.NC.tar.gz\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 21.7M  100 21.7M    0     0  3728k      0  0:00:05  0:00:05 --:--:-- 3970k\r\nGetting https://raw.githubusercontent.com/bitcoin/bitcoin/v0.12.0/contrib/debian/examples/bitcoin.conf to ./bitcoin.conf\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100  4617  100  4617    0     0   6599      0 --:--:-- --:--:-- --:--:--  6595\r\nGetting https://upload.wikimedia.org/wikipedia/commons/4/46/Bitcoin.svg to ./Bitcoin.svg\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100  1498  100  1498    0     0   1606      0 --:--:-- --:--:-- --:--:--  1607\r\nGetting https://raw.githubusercontent.com/bitcoin/bitcoin/v0.12.0/doc/man/bitcoind.1 to ./bitcoind.1\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\n**curl: (22) The requested URL returned error: 404 Not Found**\r\nGetting https://raw.githubusercontent.com/bitcoin/bitcoin/v0.12.0/doc/man/bitcoin-cli.1 to ./bitcoin-cli.1\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\n**curl: (22) The requested URL returned error: 404 Not Found**\r\nGetting https://raw.githubusercontent.com/bitcoin/bitcoin/v0.12.0/doc/man/bitcoin-qt.1 to ./bitcoin-qt.1\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\n**curl: (22) The requested URL returned error: 404 Not Found**\r\nGetting https://raw.githubusercontent.com/bitcoin/bitcoin/v0.12.0/contrib/rpm/bitcoin.te to ./bitcoin.te\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\n**curl: (22) The requested URL returned error: 404 Not Found**\r\nGetting https://raw.githubusercontent.com/bitcoin/bitcoin/v0.12.0/contrib/rpm/bitcoin.fc to ./bitcoin.fc\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\n**curl: (22) The requested URL returned error: 404 Not Found**\r\nGetting https://raw.githubusercontent.com/bitcoin/bitcoin/v0.12.0/contrib/rpm/bitcoin.if to ./bitcoin.if\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\n**curl: (22) The requested URL returned error: 404 Not Found**\r\n```\r\n2. Execute rpmbuild with specfiles from *master HEAD* or *0.12 HEAD* result in `test/bitcoin-util-test.py: No such file or directory` . In `v0.12.0` , the specfile haven't been added.\r\n3. With specfile from d34995a, the build run smooth and fail in this test:\r\n```\r\nRunning testscript p2p-fullblocktest.py ...\r\nTraceback (most recent call last):\r\n  File \"qa/pull-tester/rpc-tests.py\", line 260, in <module>\r\n    runtests()\r\n  File \"qa/pull-tester/rpc-tests.py\", line 160, in runtests\r\n    rpcTestDir + testScripts[i] + flags, shell=True)\r\n  File \"/usr/lib64/python2.7/subprocess.py\", line 542, in check_call\r\n    raise CalledProcessError(retcode, cmd)\r\nsubprocess.CalledProcessError: Command '/home/khoa/rpmbuild/BUILD/bitcoin-0.12.0/qa/rpc-tests/p2p-fullblocktest.py --srcdir /home/khoa/rpmbuild/BUILD/bitcoin-0.12.0/src  ' returned non-zero exit status -11\r\nerror: Bad exit status from /var/tmp/rpm-tmp.HqT4St (%check)\r\n\r\n\r\nRPM build errors:\r\n    Bad exit status from /var/tmp/rpm-tmp.HqT4St (%check)\r\n```\r\n/var/tmp/rpm-tmp.HqT4St\r\n```\r\n#!/bin/sh\r\n\r\n  RPM_SOURCE_DIR=\"/home/khoa/rpmbuild/SOURCES\"\r\n  RPM_BUILD_DIR=\"/home/khoa/rpmbuild/BUILD\"\r\n  RPM_OPT_FLAGS=\"-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches   -m64 -mtune=generic\"\r\n  RPM_LD_FLAGS=\"-Wl,-z,relro \"\r\n  RPM_ARCH=\"x86_64\"\r\n  RPM_OS=\"linux\"\r\n  export RPM_SOURCE_DIR RPM_BUILD_DIR RPM_OPT_FLAGS RPM_LD_FLAGS RPM_ARCH RPM_OS\r\n  RPM_DOC_DIR=\"/usr/share/doc\"\r\n  export RPM_DOC_DIR\r\n  RPM_PACKAGE_NAME=\"bitcoin\"\r\n  RPM_PACKAGE_VERSION=\"0.12.0\"\r\n  RPM_PACKAGE_RELEASE=\"2.el7.local\"\r\n  export RPM_PACKAGE_NAME RPM_PACKAGE_VERSION RPM_PACKAGE_RELEASE\r\n  LANG=C\r\n  export LANG\r\n  unset CDPATH DISPLAY ||:\r\n  RPM_BUILD_ROOT=\"/home/khoa/rpmbuild/BUILDROOT/bitcoin-0.12.0-2.el7.local.x86_64\"\r\n  export RPM_BUILD_ROOT\r\n  \r\n  PKG_CONFIG_PATH=\"${PKG_CONFIG_PATH}:/usr/lib64/pkgconfig:/usr/share/pkgconfig\"\r\n  export PKG_CONFIG_PATH\r\n  \r\n  set -x\r\n  umask 022\r\n  cd \"/home/khoa/rpmbuild/BUILD\"\r\ncd 'bitcoin-0.12.0'\r\nmake check\r\npushd src\r\nsrcdir=. test/bitcoin-util-test.py\r\npopd\r\nqa/pull-tester/rpc-tests.py -extended\r\n\r\n\r\n```\r\n### Expected behaviour\r\n1. The files is available for fetching with spectool (hardcode a commit with appropriate files).\r\n2. Commits with backward-incompatible changes with a version should not declare that version anymore, or clearly point out a commit in which packager can find appropriate specfile.\r\n3. The test pass. \r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10312/comments",
   "created_at" : "2017-05-02T09:33:04Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10312/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/10312",
   "id" : 225641042,
   "labels" : [
      {
         "color" : "770000",
         "default" : false,
         "id" : 234878,
         "name" : "Linux/Unix",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Linux/Unix"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10312/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 10312,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "RPM build fail: Wrongs in specfile Source fields, testscript p2p-fullblocktest.py fail",
   "updated_at" : "2017-05-02T12:50:52Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10312",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/13129825?v=4",
      "events_url" : "https://api.github.com/users/voanhcuoc/events{/privacy}",
      "followers_url" : "https://api.github.com/users/voanhcuoc/followers",
      "following_url" : "https://api.github.com/users/voanhcuoc/following{/other_user}",
      "gists_url" : "https://api.github.com/users/voanhcuoc/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/voanhcuoc",
      "id" : 13129825,
      "login" : "voanhcuoc",
      "organizations_url" : "https://api.github.com/users/voanhcuoc/orgs",
      "received_events_url" : "https://api.github.com/users/voanhcuoc/received_events",
      "repos_url" : "https://api.github.com/users/voanhcuoc/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/voanhcuoc/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/voanhcuoc/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/voanhcuoc"
   }
}
