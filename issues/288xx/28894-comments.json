[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28894).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1822850560), [achow101](https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1839550503) |\n| Concept ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/28894#pullrequestreview-1737343840) |\n| Approach ACK | [S3RK](https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1827396359) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28574](https://github.com/bitcoin/bitcoin/pull/28574) (wallet: optimize migration process, batch db transactions by furszy)\n* [#28333](https://github.com/bitcoin/bitcoin/pull/28333) (wallet: Construct ScriptPubKeyMans with all data rather than loaded progressively by achow101)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#26008](https://github.com/bitcoin/bitcoin/pull/26008) (wallet: cache IsMine scriptPubKeys to improve performance of descriptor wallets by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-11-16T14:44:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1814587752",
      "id" : 1814587752,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28894",
      "node_id" : "IC_kwDOABII585sKGlo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1814587752/reactions"
      },
      "updated_at" : "2023-12-04T21:56:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1814587752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1400325124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1400325124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "da133a80bae311373337a0d9c474667a5f73908d nit: `TopUpWithDB`",
      "commit_id" : "1901360ca52c6563a40dc78633cc492a822ac7a9",
      "created_at" : "2023-11-21T10:04:34Z",
      "diff_hunk" : "@@ -582,6 +582,9 @@ class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n     // Fetch the SigningProvider for a given index and optionally include private keys. Called by the above functions.\n     std::unique_ptr<FlatSigningProvider> GetSigningProvider(int32_t index, bool include_private = false) const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\n \n+    //! Same as 'TopUp' but designed for use within a batch transaction context\n+    bool TopUpWithDb(WalletBatch& batch, unsigned int size = 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1400325124",
      "id" : 1400325124,
      "line" : 586,
      "node_id" : "PRRC_kwDOABII585Td0QE",
      "original_commit_id" : "da133a80bae311373337a0d9c474667a5f73908d",
      "original_line" : 586,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 14,
      "pull_request_review_id" : 1741582965,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1400325124/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-21T10:40:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1400325124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1400342212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1400342212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1901360ca52c6563a40dc78633cc492a822ac7a9: nit \"is committed to disk\"",
      "commit_id" : "1901360ca52c6563a40dc78633cc492a822ac7a9",
      "created_at" : "2023-11-21T10:16:31Z",
      "diff_hunk" : "@@ -3535,23 +3535,30 @@ void CWallet::SetupDescriptorScriptPubKeyMans(const CExtKey& master_key)\n {\n     AssertLockHeld(cs_wallet);\n \n+    // Create single batch txn\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) throw std::runtime_error(\"Error: cannot create db transaction for descriptors setup\");\n+\n     for (bool internal : {false, true}) {\n         for (OutputType t : OUTPUT_TYPES) {\n             auto spk_manager = std::unique_ptr<DescriptorScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, m_keypool_size));\n             if (IsCrypted()) {\n                 if (IsLocked()) {\n                     throw std::runtime_error(std::string(__func__) + \": Wallet is locked, cannot setup new descriptors\");\n                 }\n-                if (!spk_manager->CheckDecryptionKey(vMasterKey) && !spk_manager->Encrypt(vMasterKey, nullptr)) {\n+                if (!spk_manager->CheckDecryptionKey(vMasterKey) && !spk_manager->Encrypt(vMasterKey, &batch)) {\n                     throw std::runtime_error(std::string(__func__) + \": Could not encrypt new descriptors\");\n                 }\n             }\n-            spk_manager->SetupDescriptorGeneration(master_key, t, internal);\n+            spk_manager->SetupDescriptorGeneration(batch, master_key, t, internal);\n             uint256 id = spk_manager->GetID();\n             AddScriptPubKeyMan(id, std::move(spk_manager));\n-            AddActiveScriptPubKeyMan(id, t, internal);\n+            AddActiveScriptPubKeyManWithDb(batch, id, t, internal);\n         }\n     }\n+\n+    // Ensure information is dumped to disk",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1400342212",
      "id" : 1400342212,
      "line" : 3560,
      "node_id" : "PRRC_kwDOABII585Td4bE",
      "original_commit_id" : "1901360ca52c6563a40dc78633cc492a822ac7a9",
      "original_line" : 3560,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 29,
      "pull_request_review_id" : 1741582965,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1400342212/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-21T10:40:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1400342212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1401415167"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1401415167"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as suggested",
      "commit_id" : "f05302427386fe63f4929a7198652cb1e4ab3bcc",
      "created_at" : "2023-11-22T02:03:27Z",
      "diff_hunk" : "@@ -3535,23 +3535,30 @@ void CWallet::SetupDescriptorScriptPubKeyMans(const CExtKey& master_key)\n {\n     AssertLockHeld(cs_wallet);\n \n+    // Create single batch txn\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) throw std::runtime_error(\"Error: cannot create db transaction for descriptors setup\");\n+\n     for (bool internal : {false, true}) {\n         for (OutputType t : OUTPUT_TYPES) {\n             auto spk_manager = std::unique_ptr<DescriptorScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, m_keypool_size));\n             if (IsCrypted()) {\n                 if (IsLocked()) {\n                     throw std::runtime_error(std::string(__func__) + \": Wallet is locked, cannot setup new descriptors\");\n                 }\n-                if (!spk_manager->CheckDecryptionKey(vMasterKey) && !spk_manager->Encrypt(vMasterKey, nullptr)) {\n+                if (!spk_manager->CheckDecryptionKey(vMasterKey) && !spk_manager->Encrypt(vMasterKey, &batch)) {\n                     throw std::runtime_error(std::string(__func__) + \": Could not encrypt new descriptors\");\n                 }\n             }\n-            spk_manager->SetupDescriptorGeneration(master_key, t, internal);\n+            spk_manager->SetupDescriptorGeneration(batch, master_key, t, internal);\n             uint256 id = spk_manager->GetID();\n             AddScriptPubKeyMan(id, std::move(spk_manager));\n-            AddActiveScriptPubKeyMan(id, t, internal);\n+            AddActiveScriptPubKeyManWithDb(batch, id, t, internal);\n         }\n     }\n+\n+    // Ensure information is dumped to disk",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1401415167",
      "id" : 1401415167,
      "in_reply_to_id" : 1400342212,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Th-X_",
      "original_commit_id" : "1901360ca52c6563a40dc78633cc492a822ac7a9",
      "original_line" : 3560,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1743431942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1401415167/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-22T02:03:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1401415167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1401415245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1401415245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as suggested",
      "commit_id" : "f05302427386fe63f4929a7198652cb1e4ab3bcc",
      "created_at" : "2023-11-22T02:03:33Z",
      "diff_hunk" : "@@ -582,6 +582,9 @@ class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n     // Fetch the SigningProvider for a given index and optionally include private keys. Called by the above functions.\n     std::unique_ptr<FlatSigningProvider> GetSigningProvider(int32_t index, bool include_private = false) const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\n \n+    //! Same as 'TopUp' but designed for use within a batch transaction context\n+    bool TopUpWithDb(WalletBatch& batch, unsigned int size = 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1401415245",
      "id" : 1401415245,
      "in_reply_to_id" : 1400325124,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Th-ZN",
      "original_commit_id" : "da133a80bae311373337a0d9c474667a5f73908d",
      "original_line" : 586,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 1743431942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1401415245/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-22T02:03:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1401415245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated per feedback, thanks for the review @Sjors.\r\n\r\n> Here's a commit that batches the descriptor import for external signers: https://github.com/Sjors/bitcoin/commit/286883a68d24e3600d9e608ccdea55763c50dde1 (I had to make TopupWithDB() public)\r\n\r\nThanks. Pulled the commit and made two changes to it:\r\n1) Instead of making `TopupWithDB()` public, made it protected. The `ExternalSignerScriptPubKeyMan` class is derived from `DescriptorScriptPubKeyMan`.\r\n2) Removed the unimplemented `SetupDescriptor()` function from `DescriptorScriptPubKeyMan`. Only `ExternalSignerScriptPubKeyMan` utilizes it.",
      "created_at" : "2023-11-22T02:09:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1821977377",
      "id" : 1821977377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28894",
      "node_id" : "IC_kwDOABII585smSsh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1821977377/reactions"
      },
      "updated_at" : "2023-11-22T02:09:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1821977377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK f05302427386fe63f4929a7198652cb1e4ab3bcc\r\n\r\nCI failure seems spurious",
      "created_at" : "2023-11-22T14:13:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1822850560",
      "id" : 1822850560,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28894",
      "node_id" : "IC_kwDOABII585spn4A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1822850560/reactions"
      },
      "updated_at" : "2023-11-22T14:13:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1822850560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept and Approach ACK",
      "created_at" : "2023-11-27T08:56:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1827396359",
      "id" : 1827396359,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28894",
      "node_id" : "IC_kwDOABII585s69sH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1827396359/reactions"
      },
      "updated_at" : "2023-11-27T08:56:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1827396359",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK f05302427386fe63f4929a7198652cb1e4ab3bcc",
      "created_at" : "2023-12-04T21:56:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#issuecomment-1839550503",
      "id" : 1839550503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28894",
      "node_id" : "IC_kwDOABII585tpVAn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1839550503/reactions"
      },
      "updated_at" : "2023-12-04T21:56:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1839550503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1420361508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420361508"
         }
      },
      "author_association" : "MEMBER",
      "body" : "question: Does it need to be random? `m_path_root` should already be (more) random. If not, it would be good to remove. Also, to reduce the use of `c_str`, which (in other parts of the code) is fragile and can lead to bugs. So `git grep c_str` will be less verbose if unused used of c_str are removed.",
      "commit_id" : "f05302427386fe63f4929a7198652cb1e4ab3bcc",
      "created_at" : "2023-12-08T12:19:49Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2023-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <node/context.h>\n+#include <random.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/context.h>\n+#include <wallet/wallet.h>\n+\n+namespace wallet {\n+static void WalletCreate(benchmark::Bench& bench, bool encrypted)\n+{\n+    auto test_setup = MakeNoLogFileContext<TestingSetup>();\n+    FastRandomContext random;\n+\n+    WalletContext context;\n+    context.args = &test_setup->m_args;\n+    context.chain = test_setup->m_node.chain.get();\n+\n+    DatabaseOptions options;\n+    options.require_format = DatabaseFormat::SQLITE;\n+    options.require_create = true;\n+    options.create_flags = WALLET_FLAG_DESCRIPTORS;\n+\n+    if (encrypted) {\n+        options.create_passphrase = random.rand256().ToString();\n+    }\n+\n+    DatabaseStatus status;\n+    bilingual_str error_string;\n+    std::vector<bilingual_str> warnings;\n+\n+    fs::path wallet_path = test_setup->m_path_root / strprintf(\"test_wallet_%d\", random.rand32()).c_str();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1420361508",
      "id" : 1420361508,
      "line" : 35,
      "node_id" : "PRRC_kwDOABII585UqP8k",
      "original_commit_id" : "f05302427386fe63f4929a7198652cb1e4ab3bcc",
      "original_line" : 35,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create.cpp",
      "position" : 35,
      "pull_request_review_id" : 1772228056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420361508/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-08T12:19:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420361508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1420492611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420492611"
         }
      },
      "author_association" : "MEMBER",
      "body" : "no, it doesn't. Initially, the `wallet_path` was inside the `bench.run()` lambda to create wallets under different paths. This was to avoid flushing the wallet to disk and removing the directory within the benchmark execution (which has nothing to do with what we are trying to benchmark). Then, at the end, I changed the approach to occupy less memory.\r\n\r\nBut.. thinking it further now, we could go back to the previous approach and not be concerned about memory by setting the max iterations number. Also, probably for another working path, wouldn't be bad to introduce a way to clean up stuff within the benchmark execution that is deliberately not included in the bench results.\r\n\r\nThoughts?",
      "commit_id" : "f05302427386fe63f4929a7198652cb1e4ab3bcc",
      "created_at" : "2023-12-08T14:04:39Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2023-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <node/context.h>\n+#include <random.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/context.h>\n+#include <wallet/wallet.h>\n+\n+namespace wallet {\n+static void WalletCreate(benchmark::Bench& bench, bool encrypted)\n+{\n+    auto test_setup = MakeNoLogFileContext<TestingSetup>();\n+    FastRandomContext random;\n+\n+    WalletContext context;\n+    context.args = &test_setup->m_args;\n+    context.chain = test_setup->m_node.chain.get();\n+\n+    DatabaseOptions options;\n+    options.require_format = DatabaseFormat::SQLITE;\n+    options.require_create = true;\n+    options.create_flags = WALLET_FLAG_DESCRIPTORS;\n+\n+    if (encrypted) {\n+        options.create_passphrase = random.rand256().ToString();\n+    }\n+\n+    DatabaseStatus status;\n+    bilingual_str error_string;\n+    std::vector<bilingual_str> warnings;\n+\n+    fs::path wallet_path = test_setup->m_path_root / strprintf(\"test_wallet_%d\", random.rand32()).c_str();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1420492611",
      "id" : 1420492611,
      "in_reply_to_id" : 1420361508,
      "line" : 35,
      "node_id" : "PRRC_kwDOABII585Uqv9D",
      "original_commit_id" : "f05302427386fe63f4929a7198652cb1e4ab3bcc",
      "original_line" : 35,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create.cpp",
      "position" : 35,
      "pull_request_review_id" : 1772416956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28894",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420492611/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-08T14:05:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420492611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
