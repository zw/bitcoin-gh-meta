{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "to allocate our limited outbound slots correctly, and to ensure addnode\r\nconnections benefit from their intended protections.\r\n\r\nOur addnode logic usually connects the addnode peers before the automatic\r\noutbound logic does, but not always, as a connection race can occur.  If an \r\naddnode peer disconnects us and if it was the only one from its network, there\r\ncan be a race between reconnecting to it with the addnode thread, and it being\r\npicked as automatic network-specific outbound peer.  Or our internet connection\r\nor router or the addnode peer could be temporarily offline, and then return\r\nonline during the automatic outbound thread.  Or we could add a new manual peer\r\nusing the addnode RPC at that time.\r\n    \r\nThe race can be more apparent when our node doesn't know many peers, or with\r\nnetworks like cjdns that currently have few bitcoin peers.\r\n    \r\nWhen an addnode peer is connected as an automatic outbound peer and is the only\r\nconnection we have to a network, it can be protected by our new outbound\r\neviction logic and persist in the \"wrong role\".\r\n    \r\nFinally, there does not seem to be a reason to make block-relay or short-lived\r\nfeeler connections to addnode peers, as the addnode logic will ensure we connect\r\nto them if they are up, within the addnode connection limit.\r\n    \r\nFix these issues by checking if the address is an addnode peer in our automatic\r\noutbound connection logic.\r\n",
   "closed_at" : "2023-11-22T11:47:27Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 10,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28895/comments",
   "created_at" : "2023-11-16T16:44:14Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28895/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/28895",
   "id" : 1997289709,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28895/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585fpy78",
   "number" : 28895,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/28895.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28895",
      "merged_at" : "2023-11-22T11:47:27Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/28895.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28895"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28895/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28895/timeline",
   "title" : "p2p: do not make automatic outbound connections to addnode peers",
   "updated_at" : "2023-11-22T11:57:37Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28895",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
      "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jonatack/followers",
      "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jonatack",
      "id" : 2415484,
      "login" : "jonatack",
      "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
      "organizations_url" : "https://api.github.com/users/jonatack/orgs",
      "received_events_url" : "https://api.github.com/users/jonatack/received_events",
      "repos_url" : "https://api.github.com/users/jonatack/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jonatack"
   }
}
