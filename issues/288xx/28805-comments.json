[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28805).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1798376058), [stratospher](https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1802144035) |\n| Stale ACK | [kashifs](https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1798591280) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28521](https://github.com/bitcoin/bitcoin/pull/28521) (net: additional disconnect logging by Sjors)\n* [#28120](https://github.com/bitcoin/bitcoin/pull/28120) (p2p: make block download logic aware of limited peers threshold by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-11-06T22:06:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1796823907",
      "id" : 1796823907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rGVtj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1796823907/reactions"
      },
      "updated_at" : "2023-11-08T22:38:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1796823907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FYI @stratospher @TheStack",
      "created_at" : "2023-11-06T22:07:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1796828203",
      "id" : 1796828203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rGWwr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1796828203/reactions"
      },
      "updated_at" : "2023-11-06T22:07:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1796828203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-11-07T12:07:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1798376058",
      "id" : 1798376058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rMQp6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798376058/reactions"
      },
      "updated_at" : "2023-11-07T12:07:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798376058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Though after #24748 we might also want to consider running the entire suite with `--v2transport` in some CI.\r\n\r\nI presume this will fix itself, once and if v2 is enabled by default?",
      "created_at" : "2023-11-07T12:17:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1798390693",
      "id" : 1798390693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rMUOl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798390693/reactions"
      },
      "updated_at" : "2023-11-07T12:17:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798390693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "tACK [6b77f9](https://github.com/bitcoin/bitcoin/pull/28805/commits/6b77f9f96a923a70a246697827fcaf5551d77331)\r\n\r\nRead through all updated code, pulled branch, compiled from source, ran:\r\n\r\n`python3 wallet_multiwallet.py --usecli --v2transport`",
      "created_at" : "2023-11-07T14:05:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1798591280",
      "id" : 1798591280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rNFMw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798591280/reactions"
      },
      "updated_at" : "2023-11-07T14:05:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798591280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1489460?v=4",
         "events_url" : "https://api.github.com/users/kashifs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kashifs/followers",
         "following_url" : "https://api.github.com/users/kashifs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kashifs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kashifs",
         "id" : 1489460,
         "login" : "kashifs",
         "node_id" : "MDQ6VXNlcjE0ODk0NjA=",
         "organizations_url" : "https://api.github.com/users/kashifs/orgs",
         "received_events_url" : "https://api.github.com/users/kashifs/received_events",
         "repos_url" : "https://api.github.com/users/kashifs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kashifs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kashifs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kashifs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I presume this will fix itself, once and if v2 is enabled by default?\r\n\r\nAfter enabling v2 by default for the functional tests, we'd probably still want to run some or all of the tests with `-v2transport=0` to avoid regressions - so I don't think that would change much.",
      "created_at" : "2023-11-07T15:12:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1798836337",
      "id" : 1798836337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rOBBx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798836337/reactions"
      },
      "updated_at" : "2023-11-07T15:12:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798836337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok, feel free to add it to any task, for example `ci/test/00_setup_env_native_qt5.sh`.",
      "created_at" : "2023-11-07T17:33:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1799301221",
      "id" : 1799301221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rPyhl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1799301221/reactions"
      },
      "updated_at" : "2023-11-07T17:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1799301221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Ok, feel free to add it to any task, for example `ci/test/00_setup_env_native_qt5.sh`.\r\n\r\nThanks, though I won't add it to this PR.\r\nI'm open to suggestions, but in my opinion the best way to proceed might be to first get #24748 in to upgrade the python p2p framework. I expect we will then need a similar PR to this one to fix some minor issues with the existing tests before turning it on for all tests (something I started working on), and maybe only after we should make a `--v2transport` task.",
      "created_at" : "2023-11-07T17:51:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1799340396",
      "id" : 1799340396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rP8Fs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1799340396/reactions"
      },
      "updated_at" : "2023-11-07T17:52:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1799340396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice! Concept ACK.\r\n\r\n> \"Before, a global -v2transport provided to the test would be dropped when restarting the node within a test.\"\r\n\r\n@mzumsande, wanted to confirm which scenario you're talking about. i tried it out in [this file](https://github.com/stratospher/bitcoin/blob/ab72033bdf9e3e2155fe645a1c4b71d0d6249a57/test/functional/test_v2transport.py).\r\n\r\n1. when test is run with `--v2transport` option and `TestNode` (with no `extra_args` passed in the test) is restarted? `TestNode` restarted as a v2 node on both master and PR. \r\n2. when test is run with `--v2transport` option and `TestNode` (initially no `extra_args` passed) is restarted with `extra_args \"v2transport=0\"`? `TestNode` restarted as v1 node on master(with 2 lines modified) and restarted as v1 node on PR. is this the scenario which the PR fixes?\r\n3. when test is run with `--v2transport` option and `TestNode`(initially `extra_args \"v2transport=0\"`) is restarted? `TestNode` restarted as a v2 node on both master and PR. so both master and PR doesn't seem to fix it.",
      "created_at" : "2023-11-08T15:38:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1802144035",
      "id" : 1802144035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585raokj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802144035/reactions"
      },
      "updated_at" : "2023-11-08T15:38:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802144035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @mzumsande, wanted to confirm which scenario you're talking about.\r\n\r\nI was observing that multiple following tests fail on master with `--v2transport` e.g. `interface_zmq.py`,Â `p2p_permissions.py`, `feature_assumeutxo.py` and some wallet tests.\r\nThese tests have in common that they useÂ `self.restart_node()` with changing some unrelated `extra_args`, which would then cause `--v2transport` to be dropped.\r\n\r\nI think the problem is as follows:\r\n\r\n- On firstÂ startup of a node, `self.extra_args` is set in `__init__` (this inserts `--v2transport` into `self.extra_args` on master, but not in my branch, which puts the global option into `self.args`)\r\n- If `--v2transport=1` in args, and also `--v2transport=0` in `extra_args`, `extra_args` takes precedence (this can happen with my branch) => this is fine in my opinion.\r\n- When we call `restart_node` without specifying any extra_args, `self.extra_args` will be used. This is also fine.\r\n- When we call `restart_node` and do specify `extra_args`, `self.extra_args` will be ignored, and the passed `extra_args` will be used, together with the `args`. That causes the above tests on master to fail.\r\n- However, `self.extra_args` is not updated in `restart_node` (so another restart_node will use the original self.extra_args), and other tests rely on this behavior! So the passed `extra_args` are transitory and not saved, so referring to `self.extra_args` [here](https://github.com/mzumsande/bitcoin/blob/6b77f9f96a923a70a246697827fcaf5551d77331/test/functional/test_framework/test_framework.py#L604) is not correct when the transitory `extra_args` are used (this causes your CASE 2 on my branch to fail).\r\n\r\nDoes this make sense? I'll try to come up with a fix for this.\r\n\r\n",
      "created_at" : "2023-11-08T20:07:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1802573479",
      "id" : 1802573479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rcRan",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802573479/reactions"
      },
      "updated_at" : "2023-11-08T20:07:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802573479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I changed the first commit to save the default behavior (global `--v2transport`) in the TestNode init and add an entry to `args`, and then deciding in `TestNode::start()` (which is called for both the initial startup and for restarts) based on this and possible `extra_args` whether to actually use v2 or not.",
      "created_at" : "2023-11-08T22:45:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#issuecomment-1802811199",
      "id" : 1802811199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
      "node_id" : "IC_kwDOABII585rdLc_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802811199/reactions"
      },
      "updated_at" : "2023-11-08T22:45:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802811199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1388909333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388909333"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "68a9001: there's a behaviour difference when test is run with `--v2transport` option and `TestNode`(initially `\"v2transport=0\"`) is restarted with:\r\n- `extra_args` supplied => `TestNode` restarts as v2 node\r\n- `extra_args` not supplied => `TestNode` restarts as v1 node\r\n\r\n~~maybe when `extra_args` is `None`, we could remove `\"v2transport\"` stuff it gets from the old `self.extra_args` using something like `extra_args = list(filter(lambda s: not s.startswith(\"-v2transport=\"), extra_args))`?~~\r\n\r\nEDIT: realised this won't work because during `TestNode` initialisation, `extra_args` is `None` and not just during restarts.",
      "commit_id" : "35fb9930adb3501b29d3ad20d2e74c0114f2bcbe",
      "created_at" : "2023-11-10T05:07:36Z",
      "diff_hunk" : "@@ -198,6 +204,8 @@ def start(self, extra_args=None, *, cwd=None, stdout=None, stderr=None, env=None\n         if extra_args is None:\n             extra_args = self.extra_args\n \n+        self.use_v2transport = \"-v2transport=1\" in extra_args or (self.default_to_v2 and \"-v2transport=0\" not in extra_args)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1388909333",
      "id" : 1388909333,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII585SyRMV",
      "original_commit_id" : "68a90017519874793e34e3b439a63e5aa3a6f6a7",
      "original_line" : 207,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 26,
      "pull_request_review_id" : 1724008322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388909333/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-10T05:30:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388909333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1390101144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390101144"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "One small drawback of the current way of inspecting `extra_args` for the v2transport option is that it doesn't work if the argument is specified in a slightly different format with same meaning. For example, `-v2transport=0`/`-v2transport=1` could also be passed as `-nov2transport`/`-v2transport`, `-nov2transport=1`/`-nov2transport=0` (admittedly, no sane person would use the last one though). It might be worth it to consider that in a follow-up, e.g. by enforcing with an assertion that arguments that contain the string \"v2transport\" must be prefixed by \"-\" and suffixed by either \"=0\" or \"=1\". As far as I can see, that's the first time that the test framework needs to inspect bitcoind arguments, so that's a new problem. \r\n\r\n@stratospher: I agree that this is a bit counter-intuitive, but it's in line with the current behavior of `restart_node` (that apparently many tests rely on), i.e. \"if no extra_args are passed, restart with the ones that were initially specified (`self.extra_args`)\", in your example `-v2transport=0`.",
      "commit_id" : "35fb9930adb3501b29d3ad20d2e74c0114f2bcbe",
      "created_at" : "2023-11-11T02:54:17Z",
      "diff_hunk" : "@@ -198,6 +204,8 @@ def start(self, extra_args=None, *, cwd=None, stdout=None, stderr=None, env=None\n         if extra_args is None:\n             extra_args = self.extra_args\n \n+        self.use_v2transport = \"-v2transport=1\" in extra_args or (self.default_to_v2 and \"-v2transport=0\" not in extra_args)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1390101144",
      "id" : 1390101144,
      "in_reply_to_id" : 1388909333,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII585S20KY",
      "original_commit_id" : "68a90017519874793e34e3b439a63e5aa3a6f6a7",
      "original_line" : 207,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 26,
      "pull_request_review_id" : 1725906070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390101144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T02:54:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390101144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1390105880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390105880"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> \"if no extra_args are passed, restart with the ones that were initially specified (self.extra_args)\"\r\n\r\noh interesting! so https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1388909333 is out of scope for this PR.",
      "commit_id" : "35fb9930adb3501b29d3ad20d2e74c0114f2bcbe",
      "created_at" : "2023-11-11T03:22:28Z",
      "diff_hunk" : "@@ -198,6 +204,8 @@ def start(self, extra_args=None, *, cwd=None, stdout=None, stderr=None, env=None\n         if extra_args is None:\n             extra_args = self.extra_args\n \n+        self.use_v2transport = \"-v2transport=1\" in extra_args or (self.default_to_v2 and \"-v2transport=0\" not in extra_args)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1390105880",
      "id" : 1390105880,
      "in_reply_to_id" : 1388909333,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII585S21UY",
      "original_commit_id" : "68a90017519874793e34e3b439a63e5aa3a6f6a7",
      "original_line" : 207,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 26,
      "pull_request_review_id" : 1725911889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390105880/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T03:22:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390105880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1399433051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1399433051"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> One small drawback of the current way of inspecting `extra_args` for the v2transport option is that it doesn't work if the argument is specified in a slightly different format with same meaning.\r\n\r\nGood point - I agree that it makes sense to leave this for a possible follow-up. I'm not sur if we want to port all of the argsmanager logic into python, but having something a bit more general so that it could be reused by other args than just `-v2transport` in the future would be nice.",
      "commit_id" : "35fb9930adb3501b29d3ad20d2e74c0114f2bcbe",
      "created_at" : "2023-11-20T16:10:34Z",
      "diff_hunk" : "@@ -198,6 +204,8 @@ def start(self, extra_args=None, *, cwd=None, stdout=None, stderr=None, env=None\n         if extra_args is None:\n             extra_args = self.extra_args\n \n+        self.use_v2transport = \"-v2transport=1\" in extra_args or (self.default_to_v2 and \"-v2transport=0\" not in extra_args)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28805#discussion_r1399433051",
      "id" : 1399433051,
      "in_reply_to_id" : 1388909333,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII585Taadb",
      "original_commit_id" : "68a90017519874793e34e3b439a63e5aa3a6f6a7",
      "original_line" : 207,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 26,
      "pull_request_review_id" : 1740194661,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1399433051/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-20T16:10:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1399433051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
