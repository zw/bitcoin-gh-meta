[
   {
      "author_association" : "MEMBER",
      "body" : "I am not sure how doable this is, as it requires every storage access to be mocked in all parts of the codebase?\r\n\r\nI think it would be better to fix the underlying timeouts and crashes, and treat them as bugs.",
      "created_at" : "2023-11-07T10:39:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28811#issuecomment-1798247265",
      "id" : 1798247265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28811",
      "node_id" : "IC_kwDOABII585rLxNh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798247265/reactions"
      },
      "updated_at" : "2023-11-07T10:39:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798247265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think it would be better to fix the underlying timeouts and crashes, and treat them as bugs.\r\n\r\nI mean for crashes sure but for timeouts I have the suspicion that this happens on almost all targets that use `TestingSetup`. There might even be another reason for why these files stick around besides timeouts.\r\n\r\nThere is just no nice way of preventing this besides \"don't create tmp files\" and I don't want to be running around \"fixing\" dozens of targets and trying to maintain this everytime we add a new one.\r\n\r\nIdeally we should probably do both: dont create tmp files and avoid timeouts in targets.\r\n\r\n> I am not sure how doable this is, as it requires every storage access to be mocked in all parts of the codebase?\r\n\r\nThis is why I opened the issue, I don't know how we can achieve this without a bunch of refactoring.\r\n\r\nBlock storage would probably be the biggest blocker, making that interface more abstract and then having a `InMemoryBlockManager` would be nice but no one is gonna review that or it would take years to get merged.\r\n\r\n---\r\n\r\nI have not yet tried restricting the maximum input size that afl++ generates, maybe that works as a temporary workaround.",
      "created_at" : "2023-11-07T11:08:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28811#issuecomment-1798293005",
      "id" : 1798293005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28811",
      "node_id" : "IC_kwDOABII585rL8YN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798293005/reactions"
      },
      "updated_at" : "2023-11-07T11:08:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798293005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I don't want to be running around \"fixing\" dozens of targets and trying to maintain this everytime we add a new one.\r\n\r\nIn essence, this is identical to the rpc timeout issue in functional tests. I don't think a cheat code is available to sidestep maintenance here.\r\n\r\nIf you only care about not creating leftover tmp files, you can increase the timeout massively. If temp files are still created, it should be reported and treated as a bug and fixed.\r\n\r\nHowever, I think we should also treat lower timeouts as bugs, because they harm the fuzz engine from making progress, and also block the CI if many of those inputs end up in the git repo.",
      "created_at" : "2023-11-07T11:49:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28811#issuecomment-1798350581",
      "id" : 1798350581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28811",
      "node_id" : "IC_kwDOABII585rMKb1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798350581/reactions"
      },
      "updated_at" : "2023-11-07T11:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798350581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The fact that timeouts or crashes lead to left over files on disk is a bug and we should fix that. Otherwise it isn't really possible to conduct long running fuzzing campaigns using afl++ (or other engines that use the fork-server model) without running out of disk space.\r\n\r\nWe should also fix the timeouts and crashes themselves but that is not what I wanted to document with this issue.",
      "created_at" : "2023-11-07T13:11:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28811#issuecomment-1798477310",
      "id" : 1798477310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28811",
      "node_id" : "IC_kwDOABII585rMpX-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798477310/reactions"
      },
      "updated_at" : "2023-11-07T13:11:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798477310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> We should also fix the timeouts and crashes themselves but that is not what I wanted to document with this issue.\r\n\r\nOk. I've opened https://github.com/bitcoin/bitcoin/issues/28812 to investigate and fix them. OSS-Fuzz only has 5 targets affected, and it would be good if you checked and reported any timeouts and crashes you found as well.",
      "created_at" : "2023-11-07T13:41:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28811#issuecomment-1798543387",
      "id" : 1798543387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28811",
      "node_id" : "IC_kwDOABII585rM5gb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798543387/reactions"
      },
      "updated_at" : "2023-11-07T13:41:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798543387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure what to do here. There are some options:\r\n\r\n* Forcing a static directory path per fuzzing task (Identified by target name + the CPU it runs on, or the \"worker ID\"), which will be cleared before the fuzz process starts.\r\n* Detecting a low storage and then aborting the fuzzing campaign with a verbose error message, educating about the timeout?\r\n* (something else?)\r\n\r\nI think an early abort makes the most sense, because with frequent timeouts, it doesn't make sense to continue the fuzzing campaign anyway.",
      "created_at" : "2023-12-08T11:46:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28811#issuecomment-1847041403",
      "id" : 1847041403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28811",
      "node_id" : "IC_kwDOABII585uF517",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847041403/reactions"
      },
      "updated_at" : "2023-12-08T11:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847041403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "* we could (but probably won't) refactor our code so that we don't need to go to disk at all.\r\n* or use a custom signal handler for e.g. SIGUSR1 that deletes the data dir and then exits without any other cleanup. Afl++ can be told to send any signal instead of SIGKILL to children on timeout, etc with `AFL_KILL_SIGNAL`.\r\n\r\nI've worked around this so far by using a ram disk and fuzzing inside a docker container, once the disk is full the whole thing just dies and I can inspect the container afterwards for timeout inputs.\r\n",
      "created_at" : "2023-12-08T12:59:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28811#issuecomment-1847123265",
      "id" : 1847123265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28811",
      "node_id" : "IC_kwDOABII585uGN1B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847123265/reactions"
      },
      "updated_at" : "2023-12-08T12:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847123265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   }
]
