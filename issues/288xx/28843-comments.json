[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28843).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/28843#pullrequestreview-1724777099) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28676](https://github.com/bitcoin/bitcoin/pull/28676) ([WIP] Cluster mempool implementation by sdaftuar)\n* [#28051](https://github.com/bitcoin/bitcoin/pull/28051) (Get rid of shutdown.cpp/shutdown.h, use SignalInterrupt directly by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-11-10T11:06:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28843#issuecomment-1805523316",
      "id" : 1805523316,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28843",
      "node_id" : "IC_kwDOABII585rnhl0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805523316/reactions"
      },
      "updated_at" : "2023-12-07T20:49:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1805523316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28843#discussion_r1390058040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390058040"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why aren't you just changing `addPackageTxs` to use `m_mempool` directly? Seems simpler, and doesn't change the public api. Something like https://github.com/ajtowns/bitcoin/commit/944d8bc87690389de9bd51a6ea8a3223d10e4002",
      "commit_id" : "ed71a7b9e1e67d6155fe1def5acf51beb12c9baf",
      "created_at" : "2023-11-11T00:23:59Z",
      "diff_hunk" : "@@ -138,9 +137,9 @@ std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(const CScript& sc\n \n     int nPackagesSelected = 0;\n     int nDescendantsUpdated = 0;\n-    if (m_mempool) {\n-        LOCK(m_mempool->cs);\n-        addPackageTxs(*m_mempool, nPackagesSelected, nDescendantsUpdated);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28843#discussion_r1390058040",
      "id" : 1390058040,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585S2po4",
      "original_commit_id" : "ed71a7b9e1e67d6155fe1def5acf51beb12c9baf",
      "original_line" : 143,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 37,
      "pull_request_review_id" : 1725840342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28843",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390058040/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T00:24:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390058040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28843#discussion_r1390177609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390177609"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looking at the review discussion in #25223 introducing a check in the function and using the arrow operator feels like a step back in code quality. I also feel like having raw pointers as class members is something we should try to avoid, since its ownership semantics are ambiguous. Relying on the member variable precludes this later [comment](https://github.com/bitcoin/bitcoin/pull/25223#discussion_r898233059) on the one I linked in the PR description by making a refactor into fully static functions harder.",
      "commit_id" : "ed71a7b9e1e67d6155fe1def5acf51beb12c9baf",
      "created_at" : "2023-11-11T08:27:09Z",
      "diff_hunk" : "@@ -138,9 +137,9 @@ std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(const CScript& sc\n \n     int nPackagesSelected = 0;\n     int nDescendantsUpdated = 0;\n-    if (m_mempool) {\n-        LOCK(m_mempool->cs);\n-        addPackageTxs(*m_mempool, nPackagesSelected, nDescendantsUpdated);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28843#discussion_r1390177609",
      "id" : 1390177609,
      "in_reply_to_id" : 1390058040,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585S3G1J",
      "original_commit_id" : "ed71a7b9e1e67d6155fe1def5acf51beb12c9baf",
      "original_line" : 143,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 37,
      "pull_request_review_id" : 1726010120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28843",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390177609/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T08:27:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390177609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28843#discussion_r1390312985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390312985"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I could see that being an argument for doing away with `BlockAssembler` entirely (at least as a public interface), and replacing `BlockAssembler(chainstate, mempool, options).CreateNewBlock(scriptPubKeyIn)` it with a function: `CreateNewBlock(chainstate, mempool, scriptPubKeyIn, options)` (effectively reverting #7598).\r\n\r\nBut if you're keeping `BlockAssembler` around, the entire point of that class is to assemble a block with txs from the mempool -- that's why most of its private functions require `CTxMemPool::setEntries` references, eg -- so it seems pretty strange to make it clumsier at doing that by pulling data it needs to do its job out of the class itself.\r\n\r\n(Unrelated, but also seems a bit bogus to call the `m_last_block_*` things \"members\" when they're really globals...)",
      "commit_id" : "ed71a7b9e1e67d6155fe1def5acf51beb12c9baf",
      "created_at" : "2023-11-12T01:18:04Z",
      "diff_hunk" : "@@ -138,9 +137,9 @@ std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(const CScript& sc\n \n     int nPackagesSelected = 0;\n     int nDescendantsUpdated = 0;\n-    if (m_mempool) {\n-        LOCK(m_mempool->cs);\n-        addPackageTxs(*m_mempool, nPackagesSelected, nDescendantsUpdated);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28843#discussion_r1390312985",
      "id" : 1390312985,
      "in_reply_to_id" : 1390058040,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585S3n4Z",
      "original_commit_id" : "ed71a7b9e1e67d6155fe1def5acf51beb12c9baf",
      "original_line" : 143,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 37,
      "pull_request_review_id" : 1726156922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28843",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390312985/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-12T01:18:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390312985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-12-14T21:43:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28843#issuecomment-1856688933",
      "id" : 1856688933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28843",
      "node_id" : "IC_kwDOABII585uqtMl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1856688933/reactions"
      },
      "updated_at" : "2023-12-14T21:43:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1856688933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
