[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28824).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-11-08T16:07:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28824#issuecomment-1802203254",
      "id" : 1802203254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28824",
      "node_id" : "IC_kwDOABII585ra3B2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802203254/reactions"
      },
      "updated_at" : "2023-11-08T16:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802203254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28824#discussion_r1387462425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28824"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387462425"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems much harder to understand to me -- you need to convert it to `0x07a120` then convert that to decimal to get back to the nice round number block height? In particular mistaking it for `0x20a107` (2,138,375) would be particularly misleading.",
      "commit_id" : "fde11cb0fa300914721f55932a3bfabfcd428d27",
      "created_at" : "2023-11-09T04:12:28Z",
      "diff_hunk" : "@@ -133,7 +133,7 @@ def decodescript_script_pub_key(self):\n         cltv_script = '63' + push_public_key + 'ad670320a107b17568' + push_public_key + 'ac'\n         rpc_result = self.nodes[0].decodescript(cltv_script)\n         assert_equal('nonstandard', rpc_result['type'])\n-        assert_equal('OP_IF ' + public_key + ' OP_CHECKSIGVERIFY OP_ELSE 500000 OP_CHECKLOCKTIMEVERIFY OP_DROP OP_ENDIF ' + public_key + ' OP_CHECKSIG', rpc_result['asm'])\n+        assert_equal('OP_IF ' + public_key + ' OP_CHECKSIGVERIFY OP_ELSE 20a107 OP_CHECKLOCKTIMEVERIFY OP_DROP OP_ENDIF ' + public_key + ' OP_CHECKSIG', rpc_result['asm'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28824#discussion_r1387462425",
      "id" : 1387462425,
      "line" : 136,
      "node_id" : "PRRC_kwDOABII585Ssv8Z",
      "original_commit_id" : "fde11cb0fa300914721f55932a3bfabfcd428d27",
      "original_line" : 136,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_decodescript.py",
      "position" : 5,
      "pull_request_review_id" : 1721660658,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28824",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387462425/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T04:12:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387462425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28824#discussion_r1387463136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28824"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387463136"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This also seems confusing, particularly if it appears in something like `DUP SIZE 20 EQUALVERIFY HASH160 <x> EQUAL` -- whoops, that's actually saying the input should be 32 bytes, not 20 bytes.",
      "commit_id" : "fde11cb0fa300914721f55932a3bfabfcd428d27",
      "created_at" : "2023-11-09T04:14:19Z",
      "diff_hunk" : "@@ -170,7 +170,7 @@ def test_send(self, from_wallet, to_wallet=None, amount=None, data=None,\n                 else:\n                     assert_greater_than(from_balance_before - from_balance, amount)\n             else:\n-                assert next((out for out in tx[\"vout\"] if out[\"scriptPubKey\"][\"asm\"] == \"OP_RETURN 35\"), None)\n+                assert next((out for out in tx[\"vout\"] if out[\"scriptPubKey\"][\"asm\"] == \"OP_RETURN 23\"), None)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28824#discussion_r1387463136",
      "id" : 1387463136,
      "line" : 173,
      "node_id" : "PRRC_kwDOABII585SswHg",
      "original_commit_id" : "fde11cb0fa300914721f55932a3bfabfcd428d27",
      "original_line" : 173,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 5,
      "pull_request_review_id" : 1721661821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28824",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387463136/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T04:14:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387463136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "In the dart library coinlib (https://pub.dev/packages/coinlib) I followed the same approach of encoding everything in HEX with integers encoded as LE. However -1 is encoded as -1. See the code here: https://github.com/peercoin/coinlib/blob/master/coinlib/lib/src/scripts/operations.dart\r\n\r\nI did this to avoid changing the ASM too much. However, I'm happy to move towards using `0x` for hex and presenting decimal for smaller data of up-to 32bits if this is introduced in Bitcoin. This would make the ASM easy to understand and read.",
      "created_at" : "2023-11-09T09:32:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28824#issuecomment-1803471329",
      "id" : 1803471329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28824",
      "node_id" : "IC_kwDOABII585rfsnh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1803471329/reactions"
      },
      "updated_at" : "2023-11-09T09:33:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1803471329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1679965?v=4",
         "events_url" : "https://api.github.com/users/MatthewLM/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MatthewLM/followers",
         "following_url" : "https://api.github.com/users/MatthewLM/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MatthewLM/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MatthewLM",
         "id" : 1679965,
         "login" : "MatthewLM",
         "node_id" : "MDQ6VXNlcjE2Nzk5NjU=",
         "organizations_url" : "https://api.github.com/users/MatthewLM/orgs",
         "received_events_url" : "https://api.github.com/users/MatthewLM/received_events",
         "repos_url" : "https://api.github.com/users/MatthewLM/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MatthewLM/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MatthewLM/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MatthewLM"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ajtowns @MatthewLM thank for your comments.\r\n\r\nI agree that after these changes some ASM fields will be less human-readable-friendly in LE hex.\r\n\r\nPrefixing with `0d` was another possibility discussed previously, but there still exists a chance that someone will interpret these as hex-encoded values, as `d` is a valid hex char (whereas `x` is clearly not decimal or hex). e.g this is not necessarily _that_ much clearer, but does offer some improvement:\r\n\r\n```sh\r\n$ bitcoin-cli -regtest decodescript 0511121314150457c74942 | jq .asm\r\n\"1112131415 0d1112131415\"\r\n\r\n$ src/bitcoin-cli -regtest decodescript 0512345678900320A107b1 | jq .asm\r\n\"1234567890 0d500000 OP_CHECKLOCKTIMEVERIFY\"\r\n\r\n```\r\n\r\nThinking about this more, it feels like the question to be answered is perhaps \"is the `asm` field supposed to be human or machine readable?\" If the former, then maintaining decimal for small values, and adding a hex-prefix for > 4 byte values might be most desirable, even it it leaves some ambiguity in some circumstances?\r\n\r\n```sh\r\n$ src/bitcoin-cli -regtest decodescript 0512345678900320A107b1 | jq .asm\r\n\"0x1234567890 500000 OP_CHECKLOCKTIMEVERIFY\"\r\n```\r\n\r\nThis would create a moderately inconvenient interface in a few of the tests (and possibly some downstream users relying on this output) where hex prefixes, if present, have to be stripped from rpc output, but perhaps that's not too terrible.\r\n\r\nIf we are designing the asm output to be a canonical, machine-readable format then my opinion remains that using hex-only makes the most sense.\r\n\r\nFWIW [btcdeb](https://github.com/bitcoin-core/btcdeb) interprets all values as decimal but prints a warning that they are ambiguous:\r\n\r\n```sh\r\n$ btcc 1234567890 500000 OP_CHECKLOCKTIMEVERIFY\r\nwarning: ambiguous input 1234567890 is interpreted as a numeric value; use 0x1234567890 to force into hexadecimal interpretation\r\nwarning: ambiguous input 500000 is interpreted as a numeric value; use 0x500000 to force into hexadecimal interpretation\r\n04d20296490320a107b1\r\n\r\n$ btcc 0x1234567890 500000 OP_CHECKLOCKTIMEVERIFY\r\nwarning: ambiguous input 500000 is interpreted as a numeric value; use 0x500000 to force into hexadecimal interpretation\r\n0512345678900320a107b1\r\n\r\n```\r\n\r\nAnd consequently generates a different script without manually specifying hex. I don't know what other tools do by default.",
      "created_at" : "2023-11-09T16:25:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28824#issuecomment-1804150932",
      "id" : 1804150932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28824",
      "node_id" : "IC_kwDOABII585riSiU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804150932/reactions"
      },
      "updated_at" : "2023-11-09T16:25:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804150932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I agree that `0d` is not a good idea, much better to go with `0x` for hex.",
      "created_at" : "2023-11-09T16:31:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28824#issuecomment-1804161011",
      "id" : 1804161011,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28824",
      "node_id" : "IC_kwDOABII585riU_z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804161011/reactions"
      },
      "updated_at" : "2023-11-09T16:31:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804161011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1679965?v=4",
         "events_url" : "https://api.github.com/users/MatthewLM/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MatthewLM/followers",
         "following_url" : "https://api.github.com/users/MatthewLM/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MatthewLM/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MatthewLM",
         "id" : 1679965,
         "login" : "MatthewLM",
         "node_id" : "MDQ6VXNlcjE2Nzk5NjU=",
         "organizations_url" : "https://api.github.com/users/MatthewLM/orgs",
         "received_events_url" : "https://api.github.com/users/MatthewLM/received_events",
         "repos_url" : "https://api.github.com/users/MatthewLM/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MatthewLM/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MatthewLM/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MatthewLM"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Thinking about this more, it feels like the question to be answered is perhaps \"is the `asm` field supposed to be human or machine readable?\"\r\n\r\nI think it's human readable? For machines we could just give the raw hex script and not bother with an asm format.\r\n\r\nAnyway, how about going for something more left field and having `decodescript 0511121314150457c74942` output `[1112131415] 1112131415` where the square brackets indicated \"quoted hexidecimal\", and values without square brackets are always decimal numbers within `CScriptNum` range? That would still be pretty clear for pubkeys:\r\n\r\n```\r\n2 [027d28a3580d0823dbee34f1df927ee58664eb8349e79b94017ddaf3f7e159153f] [03a3af0f49a21d29106ebeef9b3c3d69fc375c856a7153d97156a5b7a161ca6c25] 2 OP_CHECKMULTISIG\r\n```\r\n\r\nCould perhaps also represent non-minimal pushes that way, eg the different encodings of -1 or `[ff]`, something like:\r\n\r\n```\r\n decodescript 4f -> -1\r\n decodescript 0181 -> [0:81]\r\n decodescript 4c0181 -> [1:81]\r\n decodescript 4d010081 -> [2:81]\r\n decodescript 4e0100000081 -> [4:81]\r\n```",
      "created_at" : "2023-11-09T20:39:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28824#issuecomment-1804651014",
      "id" : 1804651014,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28824",
      "node_id" : "IC_kwDOABII585rkMoG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804651014/reactions"
      },
      "updated_at" : "2023-11-09T20:39:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804651014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
