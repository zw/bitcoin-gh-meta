[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29575).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1919982697), [1440000bytes](https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981551759), [brunoerg](https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981893004) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29538](https://github.com/bitcoin/bitcoin/pull/29538) (refactor: Improve naming of CBlock::GetHash() -> GetHeaderHash() by fjahr)\n* [#29530](https://github.com/bitcoin/bitcoin/pull/29530) (rpc/net: Adds misbehaving_score to getpeerinfo by sr-gi)\n* [#29415](https://github.com/bitcoin/bitcoin/pull/29415) (Broadcast own transactions only via short-lived Tor or I2P connections by vasild)\n* [#25832](https://github.com/bitcoin/bitcoin/pull/25832) (tracing: network connection tracepoints by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-03-06T12:54:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1980808115",
      "id" : 1980808115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852ELuz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1980808115/reactions"
      },
      "updated_at" : "2024-03-07T00:24:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1980808115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK ",
      "created_at" : "2024-03-06T18:42:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981551759",
      "id" : 1981551759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852HBSP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1981551759/reactions"
      },
      "updated_at" : "2024-03-06T18:42:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1981551759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/147166694?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 147166694,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOCMWV5g",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2024-03-06T22:09:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981893004",
      "id" : 1981893004,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852IUmM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1981893004/reactions"
      },
      "updated_at" : "2024-03-06T22:09:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1981893004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have been monitoring peer misbehavior with the misbehaving tracepoint from https://github.com/bitcoin/bitcoin/pull/25832. In the past weeks, I've seen the following misbehavior across 10 nodes:\r\n- `header with invalid proof of work` [100]: very frequent\r\n- `mutated block` [100]: these are frequent. I was running #29412 where we disconnect for each mutated block (compared to only disconnecting for mutated blocks we hadn't seen before)\r\n- `invalid header received` [10]: these are infrequent (\"Sending us more than 8 headers in a single headers message\")\r\n- `headers message size = X` [20]: only seen one occurrence (\"Sending us more than 2000 headers in a single headers message that does not connect to our block tree\")\r\n\r\nI've looked at a few of these `invalid header received` misbehaviors and they all came from the same IP address with a (fake?) v26.0 Bitcoin Core user agent and always claiming their start height to be 153681 (in the version msg). Seems ok to disconnect these?\r\n\r\nI'll keep an eye on further misbehavior.",
      "created_at" : "2024-03-07T10:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983207221",
      "id" : 1983207221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852NVc1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983207221/reactions"
      },
      "updated_at" : "2024-03-07T10:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983207221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> due to interaction between BIP130 and variations in system clocks (the max 2 hour in the future rule)\r\n\r\nPerhaps we can tolerate this if the block is less than 10 hours in the future and disconnect if it's more? It seems cheap enough to process slightly-too-far-in-the-future headers, and they are enormously expensive to produce.\r\n\r\n(for other reviewers, look for `MAX_NUM_UNCONNECTING_HEADERS_MSGS` to see where this is handled)\r\n\r\nThe peer might also be telling us about a reorg longer than `MAX_BLOCKS_TO_ANNOUNCE = 8`. In `UpdatedBlockTip` we:\r\n\r\n> limit announcements in case of a huge reorganization.\r\n> Rely on the peer's synchronization mechanism in that case.\r\n\r\nSo we should not disconnect the first time around.\r\n\r\nThe `HandleFewUnconnectingHeaders` documentation should probably mention this.\r\n\r\nhttps://github.com/Sjors/bitcoin/commit/fad8c5be6e05091e409186ea73e683a987e3b324 illustrates how we could limit this to just _once_ (`MAX_NUM_UNCONNECTING_HEADERS_MSGS = 2`), since > 8 block reorgs should be rare. If we were to immedidately disconnect (`MAX_NUM_UNCONNECTING_HEADERS_MSGS = 1` then step 5 of `p2p_sendheaders.py` fails). This doesn't account for the time difference issue. And in any case it can be done in a followup. And of course we wouldn't need an integer, but could instead call it `m_chicken_little`.",
      "created_at" : "2024-03-07T11:04:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983273094",
      "id" : 1983273094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852NliG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983273094/reactions"
      },
      "updated_at" : "2024-03-07T13:54:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983273094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://github.com/Sjors/bitcoin/commit/00a7dccc1c6957ce5a6a00d5322a25f949956e6d is one approach of dealing with the time difference issue. If any of the headers are `> MAX_FUTURE_BLOCK_TIME * 10` in the future we disconnect with `time-too-new`. We could perhaps increase the number to allow for even more incorrect clocks, but I'm not sure how useful that is.\r\n\r\nSome of the comments in that commit may be spurious; I can't think of a useful attack where a peer (e.g. Bob) sends us headers, three hours in the future, with fake PoW. All Bob would achieve is that we ask ~another peer (Caroll)~ Bob for the missing headers, which ~Caroll either won't have, or she does we disconnect her~ he either sends, for which we disconnect. Or he doesn't send and tries again, at which point we disconnect him.\r\n\r\nI also don't know if if it's even worth checking if a header is in the far future, but at least it makes for more useful log entries? (it's nice to know the difference between a peer with a broken clock and a peer that falsely announces a large reorg)",
      "created_at" : "2024-03-07T15:00:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983692133",
      "id" : 1983692133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852PL1l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983692133/reactions"
      },
      "updated_at" : "2024-03-07T19:04:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983692133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I discussed this with @sdaftuar, @mzumsande, @sr-gi in person, and decided to instead just drop the Misbehavior score for unconnecting headers. The rationale is that this misbehavior was originally intended to prevent bandwidth wastage due to very broken (but likely non-malicious) nodes actually observed on the network that respond to GETHEADERS with a response unrelated to the request, triggering a request cycle. This has however largely been addressed by #25454, which limits the number of (not responded to) GETHEADERS requests in flight to one, with a 2 minute timeout. With that, the specific misbehavior is largely irrelevant (for inbound peers, it is now mostly harmless; for outbound peers, the eviction logic will eventually kick them out if they're not keeping up with headers at all).",
      "created_at" : "2024-03-07T16:40:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983969260",
      "id" : 1983969260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852QPfs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983969260/reactions"
      },
      "updated_at" : "2024-03-07T16:44:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983969260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reviewed dee6ca279cac97e167c82b0b2a61d2d2f8df1d47\r\n\r\nI'll run the log commit for a while.\r\n\r\nI'm still a bit on the fence about a903bba4d65720265659c6d4dae6cd8d9ec89c0f.\r\n\r\n> With that, the specific misbehavior is largely irrelevant (for inbound peers, it is now mostly harmless; ...\r\n\r\nSome context here for other reviewers, when you look at `SelectNodeToEvict` one of the criteria that prevents eviction is if they sent us novel blocks. This means that peers that keep sending us useless headers, will probably not enjoy this protection and eventually get replaced. Unless they _also_ give use useful data, in which case they're ... useful - and we can just humor their headers shenaningans.\r\n\r\n> ...  for outbound peers, the eviction logic will eventually kick them out if they're not keeping up with headers at all).\r\n\r\nIIUC outbound peer eviction is handled in `PeerManagerImpl::ConsiderEviction`, which loses its patience after `CHAIN_SYNC_TIMEOUT + HEADERS_RESPONSE_TIME`. That seems a bit late though, if all our outbound peers are slow? Even if that's rare, it seems better to have as many \"fit\" outbound peers as possible.\r\n\r\n\r\nAlso... It might still be useful, even if not needed for security, to _know_ if a peer sent us disconnecting headers. Although the `NET` log still provides a log message `received header %s: missing prev block %s, sending getheaders (%d) to end (peer=%d)`, we don't know the outcome.\r\n\r\nTracking if the peer did this before, e.g. with something like `m_chicken_little`, would make this easier. But not sure if it's worth the complexity. It seems all this would do is reveal that someone tried an attack that we believe to be useless.\r\n\r\n",
      "created_at" : "2024-03-07T19:36:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1984287276",
      "id" : 1984287276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852RdIs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984287276/reactions"
      },
      "updated_at" : "2024-03-07T19:37:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984287276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors It's worth taking into account that despite its history as originally being a \"DoS score\", the discouragement logic isn't particularly good at preventing *intentional* abuse of resources; scoring systems are inherently easy to bypass: just do enough to keep the score acceptable, and be as wasteful otherwise (or even better, if many IP addresses are available, use several). The only real solution, in my opinion, for actual DoS protection is keeping track of how many resources (bandwidth, CPU, I/O, ...) we spend on behalf of every peer, and whenever those resources become a bottleneck for us, throttle the worst peers.\r\n\r\nSo the purpose for the discouragement logic as I see it is avoiding wasting resources on (unintentionally) *broken* peers. These are somewhat distinct from *useless* peers (which is what the outbound eviction logic is aimed to prevent). There is an infinite amount of potential broken behavior one can imagine, and clearly we cannot have code for all of it. \r\n\r\nAnother reason for the misbehavior detection is to help protocol implementers get a good idea for expectations around parts of the protocol that aren't formally specified. And arguably, unconnecting headers isn't a protocol violation, at least in the context of BIP130 announcements, so disconnecting for something that's very rare but not impossible to trigger in what we'd consider a perfectly compliant protocol implementation would be confusing.",
      "created_at" : "2024-03-07T20:39:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1984388837",
      "id" : 1984388837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
      "node_id" : "IC_kwDOABII5852R17l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984388837/reactions"
      },
      "updated_at" : "2024-03-07T20:42:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984388837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
