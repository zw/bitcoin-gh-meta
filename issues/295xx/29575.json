{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "So far, discouragement of peers triggers when their misbehavior score exceeds 100 points. Most types of misbehavior increment the score by 100, triggering immediate discouragement, but some type do not. This PR makes all increments equal to 100 (meaning any misbehavior will immediately cause disconnection and discouragement), and then removes the logic to track the score entirely.\r\n\r\nThis simplifies the code a bit, but also makes protocol expectations clearer: if a peer misbehaves, they get disconnected. There is no good reason why certain types of protocol violations should be permitted 4 times (howmuch=20) or 9 times (howmuch=10), while many others are never allowed. Furthermore, the distinction between these looks arbitrary.\r\n\r\nTo assess whether this does not unduly affect existing other software on the network, I've been running this with an additional patch (see https://github.com/sipa/bitcoin/commits/202403_nomisbehave_log) that adds logging whenever behavior is detected whose misbehavior increment is changed by this PR. Over the past day I have not seen any instances on my well-connected node (~150 incoming connections), but will continue to monitor.\r\n\r\nThe specific types of misbehavior that are changed are:\r\n* Sending us a `block` which does not connect to our header tree (which necessarily must have been unsollicited). [used to be score 10]\r\n* Sending us a `headers` with a non-continuous headers sequence. [used to be score 20]\r\n* Sending us 10 (*) separate BIP130 headers announcements that do not connect to our block tree [used to be score 20]\r\n* Sending us more than 8 headers in a single `headers` message (which thus does not get treated as a BIP130 announcement) that does not connect to our block tree. [used to be score 10]\r\n* Sending us more than 1000 addresses in a single `addr` or `addrv2 message [used to be score 20]\r\n* Sending us more than 50000 invs in a single `inv` message [used to be score 20]\r\n* Sending us more than 2000 headers in a single `headers` message [used to be score 20]\r\n\r\nI believe that none of these behaviors are unavoidable, except for the one marked (*) which can in theory happen still due to interaction between BIP130 and variations in system clocks (the max 2 hour in the future rule). That only still only triggers after 10 violations, but we could consider increasing that number, or not treating it as misbehavior entirely.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575/comments",
   "created_at" : "2024-03-06T12:54:56Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575",
   "id" : 2171442551,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585o1hNH",
   "number" : 29575,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/29575.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29575",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/29575.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
   },
   "reactions" : {
      "+1" : 2,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 2,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575/timeline",
   "title" : "net_processing: make any misbehavior trigger immediate discouragement",
   "updated_at" : "2024-03-06T13:24:00Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   }
}
