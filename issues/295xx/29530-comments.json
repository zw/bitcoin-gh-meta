[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29530).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [tdb3](https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974959543) |\n| Concept ACK | [0xB10C](https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974733090), [brunoerg](https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974003810), [dergoegge](https://github.com/bitcoin/bitcoin/pull/29530#pullrequestreview-1912642548) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27052](https://github.com/bitcoin/bitcoin/pull/27052) (test: rpc: add last block announcement time to getpeerinfo result by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-03-01T21:46:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1973969122",
      "id" : 1973969122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
      "node_id" : "IC_kwDOABII5851qGDi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973969122/reactions"
      },
      "updated_at" : "2024-03-03T00:36:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973969122",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In this PR I have only patched `rpc_net.py` to cover the newly added field, but there is no testing for it being increased.\r\n\r\nI'm planning to do a followup patching tests that may be relying on asserting logs to catch misbehavior, but I'm open to adding some tests for this if the current coverage seems insufficient (`rpc_net.py` doesn't seem to be the right place to do so though)",
      "created_at" : "2024-03-01T22:11:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974000606",
      "id" : 1974000606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
      "node_id" : "IC_kwDOABII5851qNve",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974000606/reactions"
      },
      "updated_at" : "2024-03-01T22:15:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974000606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nSuggestion:\r\n```diff\r\ndiff --git a/test/functional/p2p_invalid_messages.py b/test/functional/p2p_invalid_messages.py\r\nindex 40a69936bc..750447815e 100755\r\n--- a/test/functional/p2p_invalid_messages.py\r\n+++ b/test/functional/p2p_invalid_messages.py\r\n@@ -323,6 +323,8 @@ class InvalidMessagesTest(BitcoinTestFramework):\r\n         del block_headers[random.randrange(1, len(block_headers)-1)]\r\n         with self.nodes[0].assert_debug_log(expected_msgs=MISBEHAVING_NONCONTINUOUS_HEADERS_MSGS):\r\n             peer.send_and_ping(msg_headers(block_headers))\r\n+\r\n+        assert_equal(self.nodes[0].getpeerinfo()[0]['misbehavior_score'], 20)\r\n         self.nodes[0].disconnect_p2ps()\r\n \r\n     def test_resource_exhaustion(self):\r\n```",
      "created_at" : "2024-03-01T22:13:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974003810",
      "id" : 1974003810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
      "node_id" : "IC_kwDOABII5851qOhi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974003810/reactions"
      },
      "updated_at" : "2024-03-02T09:38:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974003810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2024-03-02T08:46:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974733090",
      "id" : 1974733090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
      "node_id" : "IC_kwDOABII5851tAki",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974733090/reactions"
      },
      "updated_at" : "2024-03-02T08:46:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974733090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1509946764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1509946764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    int misbehavior_score{0};\r\n```\r\n\r\nnit: I think the `m_` only makes sense if there are methods on the struct/class or if there likely will be.",
      "commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "created_at" : "2024-03-02T11:02:13Z",
      "diff_hunk" : "@@ -41,6 +41,7 @@ struct CNodeStateStats {\n     bool m_addr_relay_enabled{false};\n     ServiceFlags their_services;\n     int64_t presync_height{-1};\n+    int m_misbehavior_score{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1509946764",
      "id" : 1509946764,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585Z__WM",
      "original_commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "original_line" : 44,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 4,
      "pull_request_review_id" : 1912642548,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1509946764/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-02T11:06:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1509946764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510005882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510005882"
         }
      },
      "author_association" : "NONE",
      "body" : "Disconnected or banned?",
      "commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "created_at" : "2024-03-02T17:02:40Z",
      "diff_hunk" : "@@ -186,6 +186,8 @@ static RPCHelpMan getpeerinfo()\n                                                               \"best capture connection behaviors.\"},\n                     {RPCResult::Type::STR, \"transport_protocol_type\", \"Type of transport protocol: \\n\" + Join(TRANSPORT_TYPE_DOC, \",\\n\") + \".\\n\"},\n                     {RPCResult::Type::STR, \"session_id\", \"The session ID for this connection, or \\\"\\\" if there is none (\\\"v2\\\" transport protocol only).\\n\"},\n+                    {RPCResult::Type::NUM, \"misbehavior_score\", \"The accumulated misbehavior score for this peer.\\n\"\n+                                                                 \"The peer will be disconnected if 100 is reached.\\n\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510005882",
      "id" : 1510005882,
      "line" : 190,
      "node_id" : "PRRC_kwDOABII585aANx6",
      "original_commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "original_line" : 190,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1912692895,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510005882/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-02T17:02:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510005882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/147166694?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 147166694,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOCMWV5g",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I think it should be called banscore: https://github.com/bitcoin/bitcoin/pull/19469",
      "created_at" : "2024-03-02T18:25:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974871458",
      "id" : 1974871458,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
      "node_id" : "IC_kwDOABII5851tiWi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974871458/reactions"
      },
      "updated_at" : "2024-03-02T18:25:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974871458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/147166694?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 147166694,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOCMWV5g",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510023600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510023600"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Disconnected and discouraged, no?",
      "commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "created_at" : "2024-03-02T19:14:40Z",
      "diff_hunk" : "@@ -186,6 +186,8 @@ static RPCHelpMan getpeerinfo()\n                                                               \"best capture connection behaviors.\"},\n                     {RPCResult::Type::STR, \"transport_protocol_type\", \"Type of transport protocol: \\n\" + Join(TRANSPORT_TYPE_DOC, \",\\n\") + \".\\n\"},\n                     {RPCResult::Type::STR, \"session_id\", \"The session ID for this connection, or \\\"\\\" if there is none (\\\"v2\\\" transport protocol only).\\n\"},\n+                    {RPCResult::Type::NUM, \"misbehavior_score\", \"The accumulated misbehavior score for this peer.\\n\"\n+                                                                 \"The peer will be disconnected if 100 is reached.\\n\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510023600",
      "id" : 1510023600,
      "in_reply_to_id" : 1510005882,
      "line" : 190,
      "node_id" : "PRRC_kwDOABII585aASGw",
      "original_commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "original_line" : 190,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1912709100,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510023600/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-02T19:14:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510023600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Disconnected or banned?\n>\n> I think it should be called banscore: https://github.com/bitcoin/bitcoin/pull/19469\n\nThe banscore is not a thing anymore afaik, and it hasn't been for some time. When the misbehavior score reaches 100 peers are disconnected and disencouranged, but not banned anymore.\n\nYou can still ban peers manually via rpc IIRC, but this doesn't happen automatically due to misbehavior anymore.\n\n",
      "created_at" : "2024-03-02T23:09:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974935352",
      "id" : 1974935352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
      "node_id" : "IC_kwDOABII5851tx84",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974935352/reactions"
      },
      "updated_at" : "2024-03-02T23:14:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974935352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510100460"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510100460"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Technically yes, but it feels like the disencoragement is an implementation detail completely transparent to the end user. I feel it's not worth mentioning, but I won't oppose it if there's consensus",
      "commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "created_at" : "2024-03-02T23:13:16Z",
      "diff_hunk" : "@@ -186,6 +186,8 @@ static RPCHelpMan getpeerinfo()\n                                                               \"best capture connection behaviors.\"},\n                     {RPCResult::Type::STR, \"transport_protocol_type\", \"Type of transport protocol: \\n\" + Join(TRANSPORT_TYPE_DOC, \",\\n\") + \".\\n\"},\n                     {RPCResult::Type::STR, \"session_id\", \"The session ID for this connection, or \\\"\\\" if there is none (\\\"v2\\\" transport protocol only).\\n\"},\n+                    {RPCResult::Type::NUM, \"misbehavior_score\", \"The accumulated misbehavior score for this peer.\\n\"\n+                                                                 \"The peer will be disconnected if 100 is reached.\\n\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510100460",
      "id" : 1510100460,
      "in_reply_to_id" : 1510005882,
      "line" : 190,
      "node_id" : "PRRC_kwDOABII585aAk3s",
      "original_commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "original_line" : 190,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1912775733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510100460/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-02T23:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510100460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510100802"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510100802"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "IMO it's ok to leave as is.",
      "commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "created_at" : "2024-03-02T23:16:38Z",
      "diff_hunk" : "@@ -186,6 +186,8 @@ static RPCHelpMan getpeerinfo()\n                                                               \"best capture connection behaviors.\"},\n                     {RPCResult::Type::STR, \"transport_protocol_type\", \"Type of transport protocol: \\n\" + Join(TRANSPORT_TYPE_DOC, \",\\n\") + \".\\n\"},\n                     {RPCResult::Type::STR, \"session_id\", \"The session ID for this connection, or \\\"\\\" if there is none (\\\"v2\\\" transport protocol only).\\n\"},\n+                    {RPCResult::Type::NUM, \"misbehavior_score\", \"The accumulated misbehavior score for this peer.\\n\"\n+                                                                 \"The peer will be disconnected if 100 is reached.\\n\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510100802",
      "id" : 1510100802,
      "in_reply_to_id" : 1510005882,
      "line" : 190,
      "node_id" : "PRRC_kwDOABII585aAk9C",
      "original_commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "original_line" : 190,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1912776061,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510100802/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-02T23:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510100802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ACK for 976d61c974ed045c2e2497dcebc4d1fcc4d60a29.\r\n\r\nExcellent improvement allowing checking of `misbehavior_score` directly, rather than through logs.\r\nI'm assuming the goal is to first add the capability to check the `misbehavior_score` in this PR, then update `p2p_invalid_messages.py` and `p2p_filter.py` in subsequent PR(s).  This approach makes sense to me, and helps tell the story for the commit log. \r\n\r\nBuilt.  Ran affected functional test `rpc_net.py` (test passed).\r\n\r\n### Exercising RPC\r\nAs a quick sanity check, getpeerinfo was called (using bitcoin-cli and curl, bitcoind connected to peers on a signet).  `misbehavior_score` is reported for each peer as expected.\r\n\r\n### Functional Test Usage\r\nPerformed a very quick modification of p2p_filter.py, which currently relies on `assert_debug_log(['Misbehaving'])` statements.  The mod uses the capability added by this PR to obtain `misbehavior_score` directly, rather than indirectly through log statements.  The PR's additional capability seems to work very nicely.\r\n```python\r\n    def test_size_limits(self, filter_peer):\r\n        self.log.info('Check that too large filter is rejected')\r\n        with self.nodes[0].assert_debug_log(['Misbehaving']):\r\n            filter_peer.send_and_ping(msg_filterload(data=b'\\xbb'*(MAX_BLOOM_FILTER_SIZE+1)))\r\n        peer_info = self.nodes[0].getpeerinfo()\r\n        assert_equal(peer_info[0]['misbehavior_score'], 100)\r\n```\r\n",
      "created_at" : "2024-03-03T00:36:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#issuecomment-1974959543",
      "id" : 1974959543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
      "node_id" : "IC_kwDOABII5851t323",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974959543/reactions"
      },
      "updated_at" : "2024-03-03T00:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1974959543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510897405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510897405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At the moment `developer-notes.md` just says \"Class member variables have a `m_` prefix.\", and most new variables in this struct already follow that pattern.",
      "commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "created_at" : "2024-03-04T09:56:38Z",
      "diff_hunk" : "@@ -41,6 +41,7 @@ struct CNodeStateStats {\n     bool m_addr_relay_enabled{false};\n     ServiceFlags their_services;\n     int64_t presync_height{-1};\n+    int m_misbehavior_score{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510897405",
      "id" : 1510897405,
      "in_reply_to_id" : 1509946764,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585aDnb9",
      "original_commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "original_line" : 44,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 4,
      "pull_request_review_id" : 1913886338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510897405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-04T09:56:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510897405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510933713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510933713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Based on my reading of `banman.h`, we could add something like: \"Their IP is not banned, but subsequent connections from the same address are given lower priority (see banman.h)\"\r\n\r\n\"lower priority\" is a bit vague, but I think it more clearly captures what \"discourage\" is trying to do: priotize _other_ peers, but tolerate this ex-peer if it comes back, in case it gives us something useful.",
      "commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "created_at" : "2024-03-04T10:25:06Z",
      "diff_hunk" : "@@ -186,6 +186,8 @@ static RPCHelpMan getpeerinfo()\n                                                               \"best capture connection behaviors.\"},\n                     {RPCResult::Type::STR, \"transport_protocol_type\", \"Type of transport protocol: \\n\" + Join(TRANSPORT_TYPE_DOC, \",\\n\") + \".\\n\"},\n                     {RPCResult::Type::STR, \"session_id\", \"The session ID for this connection, or \\\"\\\" if there is none (\\\"v2\\\" transport protocol only).\\n\"},\n+                    {RPCResult::Type::NUM, \"misbehavior_score\", \"The accumulated misbehavior score for this peer.\\n\"\n+                                                                 \"The peer will be disconnected if 100 is reached.\\n\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29530#discussion_r1510933713",
      "id" : 1510933713,
      "in_reply_to_id" : 1510005882,
      "line" : 190,
      "node_id" : "PRRC_kwDOABII585aDwTR",
      "original_commit_id" : "976d61c974ed045c2e2497dcebc4d1fcc4d60a29",
      "original_line" : 190,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1913946739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510933713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-04T10:25:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510933713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
