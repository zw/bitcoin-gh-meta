[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29502).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/29502#issuecomment-1973953349), [S3RK](https://github.com/bitcoin/bitcoin/pull/29502#issuecomment-1978249354) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29278](https://github.com/bitcoin/bitcoin/pull/29278) (Wallet:  Add `maxfeerate` wallet startup option by ismaelsadeeq)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-02-28T09:55:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#issuecomment-1968620809",
      "id" : 1968620809,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29502",
      "node_id" : "IC_kwDOABII5851VsUJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1968620809/reactions"
      },
      "updated_at" : "2024-03-05T08:54:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1968620809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/22070837167</sub>",
      "created_at" : "2024-02-28T10:00:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#issuecomment-1968630168",
      "id" : 1968630168,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29502",
      "node_id" : "IC_kwDOABII5851VumY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1968630168/reactions"
      },
      "updated_at" : "2024-02-28T10:00:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1968630168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1506784303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506784303"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The reverse is also true - the estimate can be a bit smaller than the real weight because the tx that we are using to perform this size calculation could have a shorter signature. So I don't think this actually fixes the problem, it just results in a fee too low error occasionally rather than a fee too high error.",
      "commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "created_at" : "2024-02-28T23:11:13Z",
      "diff_hunk" : "@@ -543,11 +543,16 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + len of num scriptWitness stack items + (length of stack item + stack item) * N stack items\n+        # Note that occasionally this weight estimate may be slightly larger than the real weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1506784303",
      "id" : 1506784303,
      "line" : 547,
      "node_id" : "PRRC_kwDOABII585Zz7Qv",
      "original_commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "original_line" : 547,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 6,
      "pull_request_review_id" : 1907623863,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506784303/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T23:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506784303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1507390713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1507390713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `assert_fee_amount` function allows the estimate to be a bit larger with a 2 vbyte buffer but not smaller.\r\n\r\nI can think of a few options:\r\n\r\n- Replicate the 2 vbyte allowance in the smaller direction\r\n- As you already suggested, switch the test to taproot\r\n\r\nI'm leaning towards the latter as I don't like the idea of adding an allowance for every test that uses that assert.\r\n\r\nAs an aside I think it would be better to have two fee assertion functions, one that is precise and another that takes an allowance that can be specified in each tests. This way the intention of the test is clear, at the moment tests benefit from this allowance whether they need it or not.\r\n\r\n@achow101 what are your thoughts?\r\n\r\n",
      "commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "created_at" : "2024-02-29T10:55:42Z",
      "diff_hunk" : "@@ -543,11 +543,16 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + len of num scriptWitness stack items + (length of stack item + stack item) * N stack items\n+        # Note that occasionally this weight estimate may be slightly larger than the real weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1507390713",
      "id" : 1507390713,
      "in_reply_to_id" : 1506784303,
      "line" : 547,
      "node_id" : "PRRC_kwDOABII585Z2PT5",
      "original_commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "original_line" : 547,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 6,
      "pull_request_review_id" : 1908567893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1507390713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-29T10:56:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1507390713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1204616?v=4",
         "events_url" : "https://api.github.com/users/m3dwards/events{/privacy}",
         "followers_url" : "https://api.github.com/users/m3dwards/followers",
         "following_url" : "https://api.github.com/users/m3dwards/following{/other_user}",
         "gists_url" : "https://api.github.com/users/m3dwards/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/m3dwards",
         "id" : 1204616,
         "login" : "m3dwards",
         "node_id" : "MDQ6VXNlcjEyMDQ2MTY=",
         "organizations_url" : "https://api.github.com/users/m3dwards/orgs",
         "received_events_url" : "https://api.github.com/users/m3dwards/received_events",
         "repos_url" : "https://api.github.com/users/m3dwards/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/m3dwards/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/m3dwards/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/m3dwards"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1507991983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1507991983"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, using taproot might result in a little bit less test coverage. IIRC the script chosen for the external utxo in this test is p2sh-segwit because it will have both a scriptSig and scriptWitness. This lets us check that coin control is applying the weight correctly for both legacy and segwit scripts. As Taproot is segwit only, we'd lose the coverage of the legacy side of things.\r\n\r\nA different solution we could try is to check that the feerate is as we expected, rather than checking that the fee was expected. Since we are targeting an integer sat/vb feerate, the calculated feerate of the final tx should only ever be higher than the target by less than 1 sat/vb, so we could just calculate the sat/vbyte feerate, rounded down, and check that was what we expected.",
      "commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "created_at" : "2024-02-29T18:12:47Z",
      "diff_hunk" : "@@ -543,11 +543,16 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + len of num scriptWitness stack items + (length of stack item + stack item) * N stack items\n+        # Note that occasionally this weight estimate may be slightly larger than the real weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1507991983",
      "id" : 1507991983,
      "in_reply_to_id" : 1506784303,
      "line" : 547,
      "node_id" : "PRRC_kwDOABII585Z4iGv",
      "original_commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "original_line" : 547,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 6,
      "pull_request_review_id" : 1909557859,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1507991983/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-29T18:12:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1507991983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1508816813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508816813"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If the final feerate is only ever higher than the expected then the existing assertion should take care of that.\r\n\r\nBut I understood that the estimate can both be high or low depending on if a signature used for the estimate was smaller or the signature used in the final transaction was smaller.\r\n\r\nWe can still calculate the feerate in sats/vb but rounding up or down to the nearest integer.",
      "commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "created_at" : "2024-03-01T10:45:46Z",
      "diff_hunk" : "@@ -543,11 +543,16 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + len of num scriptWitness stack items + (length of stack item + stack item) * N stack items\n+        # Note that occasionally this weight estimate may be slightly larger than the real weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1508816813",
      "id" : 1508816813,
      "in_reply_to_id" : 1506784303,
      "line" : 547,
      "node_id" : "PRRC_kwDOABII585Z7ret",
      "original_commit_id" : "6c547b3c9acba2b528355af2a0848eb0fa20b441",
      "original_line" : 547,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 6,
      "pull_request_review_id" : 1910849275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508816813/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-01T10:45:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508816813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1204616?v=4",
         "events_url" : "https://api.github.com/users/m3dwards/events{/privacy}",
         "followers_url" : "https://api.github.com/users/m3dwards/followers",
         "following_url" : "https://api.github.com/users/m3dwards/following{/other_user}",
         "gists_url" : "https://api.github.com/users/m3dwards/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/m3dwards",
         "id" : 1204616,
         "login" : "m3dwards",
         "node_id" : "MDQ6VXNlcjEyMDQ2MTY=",
         "organizations_url" : "https://api.github.com/users/m3dwards/orgs",
         "received_events_url" : "https://api.github.com/users/m3dwards/received_events",
         "repos_url" : "https://api.github.com/users/m3dwards/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/m3dwards/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/m3dwards/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/m3dwards"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed new version addressing @achow101 's comments.\r\n\r\nSwitched the assertion in `wallet_send.py` to calculate the fee _rate_ to the nearest satoshi rather than the precise fee.",
      "created_at" : "2024-03-01T13:25:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#issuecomment-1973200608",
      "id" : 1973200608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29502",
      "node_id" : "IC_kwDOABII5851nKbg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973200608/reactions"
      },
      "updated_at" : "2024-03-01T13:28:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973200608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1204616?v=4",
         "events_url" : "https://api.github.com/users/m3dwards/events{/privacy}",
         "followers_url" : "https://api.github.com/users/m3dwards/followers",
         "following_url" : "https://api.github.com/users/m3dwards/following{/other_user}",
         "gists_url" : "https://api.github.com/users/m3dwards/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/m3dwards",
         "id" : 1204616,
         "login" : "m3dwards",
         "node_id" : "MDQ6VXNlcjEyMDQ2MTY=",
         "organizations_url" : "https://api.github.com/users/m3dwards/orgs",
         "received_events_url" : "https://api.github.com/users/m3dwards/received_events",
         "repos_url" : "https://api.github.com/users/m3dwards/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/m3dwards/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/m3dwards/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/m3dwards"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK e67ab174c9c04bba7a10724b7e694dd57f732177",
      "created_at" : "2024-03-01T21:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#issuecomment-1973953349",
      "id" : 1973953349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29502",
      "node_id" : "IC_kwDOABII5851qCNF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973953349/reactions"
      },
      "updated_at" : "2024-03-01T21:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973953349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1510732930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510732930"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should we also divide `len(psbt_in[\"final_scriptwitness\"])` by 2 to get size in bytes?",
      "commit_id" : "e67ab174c9c04bba7a10724b7e694dd57f732177",
      "created_at" : "2024-03-04T08:08:26Z",
      "diff_hunk" : "@@ -543,11 +543,16 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + len of num scriptWitness stack items + (length of stack item + stack item) * N stack items\n+        # Note that occasionally this weight estimate may be slightly larger or smaller than the real weight\n+        # as sometimes ECDSA signatures are one byte shorter than expected with a probability of 1/128\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n-        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwitness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig))\n+        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(ser_compact_size(len(psbt_in[\"final_scriptwitness\"])))) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1510732930",
      "id" : 1510732930,
      "line" : 551,
      "node_id" : "PRRC_kwDOABII585aC_SC",
      "original_commit_id" : "e67ab174c9c04bba7a10724b7e694dd57f732177",
      "original_line" : 551,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 13,
      "pull_request_review_id" : 1913606151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510732930/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-04T08:08:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1510732930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1511017545"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511017545"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The divide by 2 is for turning a hex string into a count of bytes.\r\n\r\nThe length (read count) of the scriptWitnesses is just that, a count and not a hex string. Further this count is passed into function `ser_compact_size` that returns bytes so a simple length of this gives us the byte length we are after.",
      "commit_id" : "e67ab174c9c04bba7a10724b7e694dd57f732177",
      "created_at" : "2024-03-04T11:34:29Z",
      "diff_hunk" : "@@ -543,11 +543,16 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + len of num scriptWitness stack items + (length of stack item + stack item) * N stack items\n+        # Note that occasionally this weight estimate may be slightly larger or smaller than the real weight\n+        # as sometimes ECDSA signatures are one byte shorter than expected with a probability of 1/128\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n-        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwitness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig))\n+        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(ser_compact_size(len(psbt_in[\"final_scriptwitness\"])))) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1511017545",
      "id" : 1511017545,
      "in_reply_to_id" : 1510732930,
      "line" : 551,
      "node_id" : "PRRC_kwDOABII585aEExJ",
      "original_commit_id" : "e67ab174c9c04bba7a10724b7e694dd57f732177",
      "original_line" : 551,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 13,
      "pull_request_review_id" : 1914083806,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511017545/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-04T11:34:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511017545",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1204616?v=4",
         "events_url" : "https://api.github.com/users/m3dwards/events{/privacy}",
         "followers_url" : "https://api.github.com/users/m3dwards/followers",
         "following_url" : "https://api.github.com/users/m3dwards/following{/other_user}",
         "gists_url" : "https://api.github.com/users/m3dwards/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/m3dwards",
         "id" : 1204616,
         "login" : "m3dwards",
         "node_id" : "MDQ6VXNlcjEyMDQ2MTY=",
         "organizations_url" : "https://api.github.com/users/m3dwards/orgs",
         "received_events_url" : "https://api.github.com/users/m3dwards/received_events",
         "repos_url" : "https://api.github.com/users/m3dwards/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/m3dwards/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/m3dwards/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/m3dwards"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1512387090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1512387090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, you're right. I thought witness is also serialised. Got myself confused.",
      "commit_id" : "e67ab174c9c04bba7a10724b7e694dd57f732177",
      "created_at" : "2024-03-05T08:54:01Z",
      "diff_hunk" : "@@ -543,11 +543,16 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + len of num scriptWitness stack items + (length of stack item + stack item) * N stack items\n+        # Note that occasionally this weight estimate may be slightly larger or smaller than the real weight\n+        # as sometimes ECDSA signatures are one byte shorter than expected with a probability of 1/128\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n-        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwitness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig))\n+        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(ser_compact_size(len(psbt_in[\"final_scriptwitness\"])))) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#discussion_r1512387090",
      "id" : 1512387090,
      "in_reply_to_id" : 1510732930,
      "line" : 551,
      "node_id" : "PRRC_kwDOABII585aJTIS",
      "original_commit_id" : "e67ab174c9c04bba7a10724b7e694dd57f732177",
      "original_line" : 551,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 13,
      "pull_request_review_id" : 1916276131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1512387090/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-05T08:54:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1512387090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK e67ab174c9c04bba7a10724b7e694dd57f732177",
      "created_at" : "2024-03-05T08:54:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29502#issuecomment-1978249354",
      "id" : 1978249354,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29502",
      "node_id" : "IC_kwDOABII58516bCK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1978249354/reactions"
      },
      "updated_at" : "2024-03-05T08:54:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1978249354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   }
]
