[
   {
      "author_association" : "MEMBER",
      "body" : "I'd love to be making more connect attempts to distinct hosts at once, but I'm not super eager to add more threads: each one implies quite a few megabytes of additional memory usage (both res and virt, from the per thread stacks and the malloc pools) which are problematic on low memory systems.  Perhaps it's ultimately worth it, but have you looked into just making the connects() non-blocking and handling them asynchronously?\r\n\r\nStartup isn't the only time this should be useful, it would also be nice to reconnect quickly when we've lost our peers due to a network interruption.\r\n\r\nAside, I don't see what in this is preventing it from trying the same netgroup multiple times concurrently, which should probably be avoided. (Perhaps by just passing in a filter to addrman to tell it to return only hosts where netgroup%threads==thread ?) ",
      "created_at" : "2019-02-28T15:26:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15502#issuecomment-468314537",
      "id" : 468314537,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15502",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODMxNDUzNw==",
      "updated_at" : "2019-02-28T15:26:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468314537",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Aside, I don't see what in this is preventing it from trying the same netgroup multiple times concurrently, which should probably be avoided. (Perhaps by just passing in a filter to addrman to tell it to return only hosts where netgroup%threads==thread ?)\r\n\r\nIt's putting the addresses being tried in `vFastConnect` which contains a bool/address pair. The bool is true if the address is ready to be tried, and false if it's finished with and ready to be replaced. If the bool is true, the address's group is added to setConnected when picking new addresses to try, which should prevent the same netgroup from being tried multiple times.\r\n\r\n(I was trying for something not too intrusive, so haven't looked at async/non-blocking connect())",
      "created_at" : "2019-02-28T15:56:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15502#issuecomment-468326556",
      "id" : 468326556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15502",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODMyNjU1Ng==",
      "updated_at" : "2019-02-28T15:56:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468326556",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15759](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15759.html) (p2p: Add 2 outbound block-relay-only connections by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-04-05T21:43:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15502#issuecomment-480431600",
      "id" : 480431600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15502",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDQzMTYwMA==",
      "updated_at" : "2019-08-29T21:08:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480431600",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-04-09T20:19:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15502#issuecomment-481419173",
      "id" : 481419173,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15502",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MTQxOTE3Mw==",
      "updated_at" : "2019-04-09T20:19:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/481419173",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@naumenkogs Did you want to have a look here and Concept ACK or NACK ?",
      "created_at" : "2019-07-30T06:00:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15502#issuecomment-516275326",
      "id" : 516275326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15502",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjI3NTMyNg==",
      "updated_at" : "2019-07-30T06:00:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516275326",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the trade-off is straightforward, as Greg points out: bootstrap speed vs. memory usage.\r\n\r\nIt certainly would be more attractive if we make non-blocking connections instead, but I don't have an idea of how much effort that would require.\r\n\r\nIf we decide to stick to the current proposal, perhaps we can pass this as an argument?\r\nJust --fast-bootstrap for now, and then we might merge it with something else (for example, with the default memory allocation for utreexo cache or whatnot) so that at the end we have high-memory mode? Let me know if this discussion happened before and there is a consensus that parameters like this is generally a bad idea :)",
      "created_at" : "2019-07-30T15:23:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15502#issuecomment-516468100",
      "id" : 516468100,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15502",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjQ2ODEwMA==",
      "updated_at" : "2019-07-30T15:23:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516468100",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think #16939 is enough to stop the privacy leak here, but would still be nice to connect to nodes more quickly. I think it might not be too hard to do a select() loop just for non-proxied (and non-tor) connections, so I'll give that a go. ",
      "created_at" : "2019-09-23T11:04:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15502#issuecomment-534052858",
      "id" : 534052858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15502",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDA1Mjg1OA==",
      "updated_at" : "2019-09-23T11:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534052858",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
