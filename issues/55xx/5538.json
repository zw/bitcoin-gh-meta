{
   "assignee" : null,
   "body" : "There are ways to create blocks that take a lot of time to verify. Here https://bitcointalk.org/?topic=140078 I created a block with a single prevout dependency that took 3 minutes to verify. I found another way to create a block with a single prevout dependency that take 1 minute to verify and verification time is not related to signature verification time. But since this problem has already been discussed, there is nothing new there. Here I propose a minimum change to protect miners from attacks with slow blocks.\r\n\r\nThe Core code holds the cs_main lock in ProcessNewBlock() when a block is being verified, so a miner receiving a slow block would keep mining on an outdated parent. It will not receive new templates based on that block because it's still being verified, and if he solves the block, that block won't be chosen to be the tip of best chain because just after the lock is released, ActivateBestChain() will be called and it will add the slow competing block to the chain, preventing the miner's local block from entering the best chain. (But this may not be always the case because since the RPC runs in another thread, it's possible that the OS scheduler switches to the RPC thread just after the lock is released, and the RPC thread finally calls ActivateBestChain() before the network thread).\r\n\r\nOf course, it has been said that miners should run two instances of bitcoind, one serving the miners and the other serving the network. However I think that this is a fault in bicoind that should be corrected.\r\nMaybe we can change the Core such that if a block submitted by the submitblock RPC call has the same height as a competing block which is the tip, then the block locally submitted has precedence and becomes the new tip. Also we could add a program argument --higher-precedence:ip which would allow blocks submitted by a peer on this ip to have precedence over blocks of equal height submitted by unknown nodes.\r\n\r\nAs a side-note, all information we can gather about slow blocks is important since there is a plan to increase the block size. For instance, if we don't rewrite the CHECKSIG logic, and we let MAX_BLOCK_SIGOPS increase 10x along with a 10 Mb block, then a block with a single prevout dependency could be crafted to take more than 5 hours to verify. ",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 14,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5538/comments",
   "created_at" : "2014-12-24T21:43:57Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5538/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/5538",
   "id" : 52837684,
   "labels" : [
      {
         "color" : "c7def8",
         "name" : "Mining",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Mining"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5538/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 5538,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Prioritize submitblock blocks to prevent attacks on miners using slow-to-verify blocks",
   "updated_at" : "2016-02-16T13:05:18Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5538",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1752347?v=3",
      "events_url" : "https://api.github.com/users/SergioDemianLerner/events{/privacy}",
      "followers_url" : "https://api.github.com/users/SergioDemianLerner/followers",
      "following_url" : "https://api.github.com/users/SergioDemianLerner/following{/other_user}",
      "gists_url" : "https://api.github.com/users/SergioDemianLerner/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/SergioDemianLerner",
      "id" : 1752347,
      "login" : "SergioDemianLerner",
      "organizations_url" : "https://api.github.com/users/SergioDemianLerner/orgs",
      "received_events_url" : "https://api.github.com/users/SergioDemianLerner/received_events",
      "repos_url" : "https://api.github.com/users/SergioDemianLerner/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/SergioDemianLerner/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/SergioDemianLerner/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/SergioDemianLerner"
   }
}
