{
   "assignee" : null,
   "body" : "I've been running bitcoin-qt inside gdb for over a year now, because it used to crash pretty often.  It just crashed for the first time in over 6 months, a week or two after upgrading to the recent release.  I would guess this is a new issue introduced in 0.9.\r\n\r\nI built the code myself, from the git v0.9.0 tag, on a 64 bit Linux system.\r\n\r\nHere's what gdb said:\r\n\r\n    Program received signal SIGSEGV, Segmentation fault.\r\n    CMerkleTx::GetDepthInMainChainINTERNAL (this=this@entry=0x7fffb77d7ac0, \r\n        pindexRet=@0x7fffffffd148: 0x555556ca0120) at main.cpp:884\r\n    884\t    if (!pindex || !chainActive.Contains(pindex))\r\n    (gdb) where\r\n    #0  CMerkleTx::GetDepthInMainChainINTERNAL (this=this@entry=0x7fffb77d7ac0, \r\n        pindexRet=@0x7fffffffd148: 0x555556ca0120) at main.cpp:884\r\n    #1  0x000055555571dca6 in CMerkleTx::GetDepthInMainChain (\r\n        this=this@entry=0x7fffb77d7ac0, pindexRet=@0x7fffffffd148: 0x555556ca0120)\r\n        at main.cpp:901\r\n    #2  0x00005555556b632d in GetDepthInMainChain (this=0x7fffb77d7ac0)\r\n        at ../../src/main.h:466\r\n    #3  CWalletTx::IsTrusted (this=this@entry=0x7fffb77d7ac0)\r\n        at ../../src/wallet.h:665\r\n    #4  0x00005555556b40cd in TransactionRecord::updateStatus (\r\n        this=this@entry=0x555556c00ca0, wtx=...) at transactionrecord.cpp:167\r\n    #5  0x00005555556933cd in TransactionTablePriv::index (this=<optimized out>, \r\n        idx=idx@entry=6314) at transactiontablemodel.cpp:201\r\n    #6  0x000055555569231e in TransactionTableModel::index (this=0x555556a5b340, \r\n        row=6314, column=0, parent=...) at transactiontablemodel.cpp:615\r\n    #7  0x000055555568f398 in TransactionFilterProxy::filterAcceptsRow (this=\r\n        0x55555625ee30, sourceRow=6314, sourceParent=...)\r\n        at transactionfilterproxy.cpp:33\r\n\r\nand here's debug.log (it looks like bitcoin-qt was only just getting started):\r\n\r\n    2014-03-31 04:41:51 Bitcoin version v0.9.0-1-gd824858-beta (2014-03-20 09:19:05 -0700)\r\n    2014-03-31 04:41:51 Using OpenSSL version OpenSSL 1.0.1c 10 May 2012\r\n    2014-03-31 04:41:51 Default data directory /home/chris/.bitcoin\r\n    2014-03-31 04:41:51 Using data directory /home/chris/.bitcoin\r\n    2014-03-31 04:41:51 Using at most 125 connections (1024 file descriptors available)\r\n    2014-03-31 04:41:51 Using 2 threads for script verification\r\n    2014-03-31 04:41:51 Using wallet wallet.dat\r\n    2014-03-31 04:41:51 init message: Verifying wallet...\r\n    2014-03-31 04:41:51 dbenv.open LogDir=/home/chris/.bitcoin/database ErrorFile=/home/chris/.bitcoin/db.log\r\n    2014-03-31 04:42:16 Bound to [::]:8333\r\n    2014-03-31 04:42:16 Bound to 0.0.0.0:8333\r\n    2014-03-31 04:42:16 init message: Loading block index...\r\n    2014-03-31 04:42:16 Opening LevelDB in /home/chris/.bitcoin/blocks/index\r\n    2014-03-31 04:42:17 Opened LevelDB successfully\r\n    2014-03-31 04:42:17 Opening LevelDB in /home/chris/.bitcoin/chainstate\r\n    2014-03-31 04:42:18 Opened LevelDB successfully\r\n    2014-03-31 04:42:36 LoadBlockIndexDB(): last block file = 89\r\n    2014-03-31 04:42:36 LoadBlockIndexDB(): last block file info: CBlockFileInfo(blocks=338, size=67010312, heights=292948...293280, time=2014-03-28...2014-03-30)\r\n    2014-03-31 04:42:36 LoadBlockIndexDB(): transaction index disabled\r\n    2014-03-31 04:42:36 LoadBlockIndexDB(): hashBestChain=000000000000000052d11e4b468cf8e66152f4687ccf6f7b24a4eb8c7c183bbb height=293280 date=2014-03-30 20:05:47 progress=0.998126\r\n    2014-03-31 04:42:36 init message: Verifying blocks...\r\n    2014-03-31 04:42:36 Verifying last 288 blocks at level 2\r\n    2014-03-31 04:43:30 No coin database inconsistencies in last 0 blocks (0 transactions)\r\n    2014-03-31 04:43:30  block index           74479ms\r\n    2014-03-31 04:43:30 init message: Loading wallet...\r\n    2014-03-31 04:44:50 nFileVersion = 90000\r\n    2014-03-31 04:44:50 Keys: 36667 plaintext, 0 encrypted, 0 w/ metadata, 36667 total\r\n    2014-03-31 04:44:50  wallet                80181ms\r\n    2014-03-31 04:44:50 init message: Loading addresses...\r\n    2014-03-31 04:44:50 Loaded 18722 addresses from peers.dat  118ms\r\n    2014-03-31 04:44:50 mapBlockIndex.size() = 293606\r\n    2014-03-31 04:44:50 nBestHeight = 293280\r\n    2014-03-31 04:44:50 setKeyPool.size() = 4996\r\n    2014-03-31 04:44:50 mapWallet.size() = 30432\r\n    2014-03-31 04:44:50 mapAddressBook.size() = 19485\r\n    2014-03-31 04:44:50 ext-ip thread start\r\n    2014-03-31 04:44:50 dnsseed thread start\r\n    2014-03-31 04:44:50 net thread start\r\n    2014-03-31 04:44:50 Loading addresses from DNS seeds (could take a while)\r\n    2014-03-31 04:44:50 addcon thread start\r\n    2014-03-31 04:44:50 msghand thread start\r\n    2014-03-31 04:44:50 opencon thread start\r\n    2014-03-31 04:44:50 dumpaddr thread start\r\n    2014-03-31 04:44:50 init message: Done loading\r\n    2014-03-31 04:44:51 ERROR: AcceptToMemoryPool : nonstandard transaction: dust\r\n    2014-03-31 04:44:51 GetMyExternalIP() received [a.b.c.d] a.b.c.d:0\r\n    2014-03-31 04:44:51 GetMyExternalIP() returned a.b.c.d\r\n    2014-03-31 04:44:51 AddLocal(a.b.c.d:8333,4)\r\n    2014-03-31 04:44:51 ext-ip thread exit\r\n    2014-03-31 04:44:51 ERROR: AcceptToMemoryPool : nonstandard transaction: dust\r\n    2014-03-31 04:44:51 ERROR: AcceptToMemoryPool : nonstandard transaction: dust\r\n    2014-03-31 04:44:51 ERROR: AcceptToMemoryPool : nonstandard transaction: dust\r\n    2014-03-31 04:44:51 receive version message: /Satoshi:0.8.6/: version 70001, blocks=293333, us=a.b.c.d:9089, them=e.f.g.h:8333, peer=e.f.g.h:8333\r\n    2014-03-31 04:44:51 Added time data, samples 2, offset -7 (+0 minutes)\r\n    2014-03-31 04:44:51 ERROR: AcceptToMemoryPool : nonstandard transaction: dust\r\n    2014-03-31 04:44:51 Initialization result: 1\r\n    2014-03-31 04:44:53 Pre-allocating up to position 0x5000000 in blk00089.dat\r\n    2014-03-31 04:45:08 118 addresses found from DNS seeds\r\n    2014-03-31 04:45:08 dnsseed thread exit",
   "closed_at" : "2014-04-22T11:35:47Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 33,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3997/comments",
   "created_at" : "2014-04-02T20:16:29Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3997/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/3997",
   "id" : 30721356,
   "labels" : [
      {
         "color" : "FBBAAB",
         "name" : "Bug",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "e10c02",
         "name" : "Priority High",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Priority%20High"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3997/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 3997,
   "state" : "closed",
   "title" : "crash in CMerkleTx::GetDepthInMainChainINTERNAL()",
   "updated_at" : "2014-04-24T17:02:58Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3997",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
      "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dooglus/followers",
      "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dooglus",
      "id" : 573356,
      "login" : "dooglus",
      "organizations_url" : "https://api.github.com/users/dooglus/orgs",
      "received_events_url" : "https://api.github.com/users/dooglus/received_events",
      "repos_url" : "https://api.github.com/users/dooglus/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dooglus"
   }
}
