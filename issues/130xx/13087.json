{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "### Expected behavior:\r\n\r\n1. `importaddress` or `importpubkey` a watching-only address or pubkey with a label\r\n2. Receive a transaction to that address; observe that the label has been applied to that transaction\r\n3. `importprivkey` the private key for that address without specifying any change to the label\r\n4. Have the previous label still applied to the transaction after the import.\r\n\r\n### Observed behavior on 0.15 and current master:\r\n\r\nSteps 1-3 the same.\r\n4. Previous label is replaced with the default empty label (\"\")\r\n\r\nProblem seems to have occurred on 0.15 and affects the latest master (see subsequent details).  I'd suspect all versions are affected, i.e. it's not a regression.\r\n\r\n### Steps to reproduce\r\n\r\n```bash\r\n## For testing\r\nADDRESS=2N6Y2wdhd91mQnZ8qCeH6hT5aZZygXFnNjP\r\nPRIVKEY=cQriWp98xU9ghRvDKbzkRcgcecQLezjYwtPUjLNN5kzT8GbdnxQt\r\n\r\n## Starting a fresh regtest (i.e. ~/.bitcoin/regtest/ previously deleted)\r\n$ bitcoind -daemon -regtest\r\nBitcoin server starting\r\n\r\n## Import the address with a label and no rescan\r\n$ bitcoin-cli -regtest importaddress $ADDRESS \"Watch-only test\" false\r\n\r\n## Mine a generation tx to the address (regular spending works too)\r\n$ bitcoin-cli -regtest generatetoaddress 1 $ADDRESS > /dev/null\r\n\r\n## Bury the generation tx so it shows up in the wallet\r\n$ bitcoin-cli -regtest generate 100 > /dev/null\r\n\r\n## See that the address label was applied to the tx\r\n$ bitcoin-cli -regtest listunspent | jq .[].label\r\n\"Watch-only test\"\r\n\r\n## Import the private key.  Note the 'label' parameter is not explicitly passed\r\n$ bitcoin-cli -regtest importprivkey $PRIVKEY\r\n\r\n## See that the address label has been set to empty :-(\r\n$ bitcoin-cli -regtest listunspent | jq .[].label\r\n```\r\n\r\nSame thing happens if `importpubkey` is substituted for `importaddress`.  I haven't tested `importmulti` for either address/pubkey or privkey import, nor have I tested using named parameters.\r\n\r\n### Use case\r\n\r\nI was watching-only addresses from my cold wallet, then moved my coins to new addresses and (after some confirmations) imported the old private keys so that I could sell fork coins.  I didn't realize until now when I was trying to do some bookkeeping that all my old cold wallet labels were reset (happily, I have backups, so nothing is lost but time).\r\n\r\n### Possibly related issues\r\n\r\n- #12698 looks related but the poster there says that it works on mainnet.  I discovered my problem from actual use on mainnet and reproduced on regtest.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13087/comments",
   "created_at" : "2018-04-26T09:58:31Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13087/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/13087",
   "id" : 317958538,
   "labels" : [
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13087/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUzMTc5NTg1Mzg=",
   "number" : 13087,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "importprivkey unsets labels set with importaddress and importpubkey",
   "updated_at" : "2018-06-03T15:02:11Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13087",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/61096?v=4",
      "events_url" : "https://api.github.com/users/harding/events{/privacy}",
      "followers_url" : "https://api.github.com/users/harding/followers",
      "following_url" : "https://api.github.com/users/harding/following{/other_user}",
      "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/harding",
      "id" : 61096,
      "login" : "harding",
      "node_id" : "MDQ6VXNlcjYxMDk2",
      "organizations_url" : "https://api.github.com/users/harding/orgs",
      "received_events_url" : "https://api.github.com/users/harding/received_events",
      "repos_url" : "https://api.github.com/users/harding/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/harding"
   }
}
