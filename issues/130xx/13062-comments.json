[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r183571007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183571007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note, equivalent to `count = std::dynamic_extent` in std::span.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-23T23:54:52Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }\n+\n+    constexpr Span<C> subspan(std::ptrdiff_t offset) const noexcept { return Span<C>(m_data + offset, m_size - offset); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r183571007",
      "id" : 183571007,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MzU3MTAwNw==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_line" : 36,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 114594507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183571007",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Makes `interpreter.cpp` more self-contained, that's good.\r\nVerified that:\r\n- Consensus `IsPayToScriptHash` matches `CScript::IsPayToScriptHash`: copy-only apart from variable names\r\n- Consensus `IsWitnessProgram` matches `CScript::IsWitnessProgram`: \r\n  - a size_t becomes ptr_diff_t: not an issue as only positive values are possible (unsigned char + 2)\r\n  - `std::vector<unsigned char>(this->begin() + 2, this->end())` becomes `script.subspan(2)`: should be ok, it's defined as `Span(m_data + offset, m_size - offset)`\r\n- Consensus `IsPushOnly` matches `CScript::IsPushOnly`:\r\n  - `pc` becomes `Span` instead of a `const_iterator`: effective behavior is the same\r\n  - `GetOp` becomes `GetScriptOp`: GetOp is already defined in that way, so should be fine\r\n\r\nOther changes look straightforward.\r\n\r\nutACK 91c12000dd97d7b9b9c82d1bbc92c7bbadd3d6ed",
      "created_at" : "2018-04-25T13:51:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-384294167",
      "id" : 384294167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-25T13:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384294167",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems to be lacking a bunch of motivation. Can you clarify *why* you want to run a script stored in a span?",
      "created_at" : "2018-04-27T16:40:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385026068",
      "id" : 385026068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T16:40:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385026068",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@TheBlueMatt They're not stored in a Span; a Span is just a way to refer to a script stored anywhere (vector, array, prevector, whatever custom structure that can hold a continuous sequence of bytes).\n\nI'll add some more motivation.",
      "created_at" : "2018-04-27T16:51:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385029327",
      "id" : 385029327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T16:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385029327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Suresure, I was asking for motivation of where we want to do this in the immediate future (do you have any branches that run scripts in non-prevector form?). The only place I can think of it being useful is in libbitcoinconsensus.",
      "created_at" : "2018-04-27T16:55:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385030495",
      "id" : 385030495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T16:55:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385030495",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@TheBlueMatt No code to show, but I added some thoughts to the PR description.",
      "created_at" : "2018-04-27T17:02:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385032610",
      "id" : 385032610,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T17:02:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385032610",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, the scriptPubKey/scriptSig distinction seems like a reasonable idea. Would love to see a branch with that implemented to see the feasibility of using this in the short-term after a merge.",
      "created_at" : "2018-04-27T17:12:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385035134",
      "id" : 385035134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T17:12:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385035134",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184820685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184820685"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this needs a check before dereference. Before, it would've been caught in the real GetScriptOp() by the newly removed\r\n```c++\r\nif (pc >= end)\r\n    return false;\r\n```",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-27T22:29:48Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184820685",
      "id" : 184820685,
      "line" : 329,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgyMDY4NQ==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_line" : 329,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : 80,
      "pull_request_review_id" : 116100048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184820685",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184822784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184822784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems unnecessarily brittle. How about caching the before-size and adding back the difference from the final script.size() ?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-27T22:45:40Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    assert(&*script.end() == &*end);\n+    pc += (&*script.begin() - &*pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184822784",
      "id" : 184822784,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgyMjc4NA==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_line" : 336,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 116100048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184822784",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184826273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184826273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "how did ```script[1]``` sneak in here?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-27T23:16:45Z",
      "diff_hunk" : "@@ -1383,6 +1383,44 @@ bool TransactionSignatureChecker::CheckSequence(const CScriptNum& nSequence) con\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[1] > OP_16)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184826273",
      "id" : 184826273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgyNjI3Mw==",
      "original_commit_id" : "5aa2610dd4152a0de0953c26fce3ef7132b0ff00",
      "original_line" : 1399,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 116100048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184826273",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830547"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830547"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed, going to add a test.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-28T00:04:36Z",
      "diff_hunk" : "@@ -1383,6 +1383,44 @@ bool TransactionSignatureChecker::CheckSequence(const CScriptNum& nSequence) con\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[1] > OP_16)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830547",
      "id" : 184830547,
      "in_reply_to_id" : 184826273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgzMDU0Nw==",
      "original_commit_id" : "5aa2610dd4152a0de0953c26fce3ef7132b0ff00",
      "original_line" : 1399,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 116111518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830547",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch, fixed.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-28T00:04:46Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830564",
      "id" : 184830564,
      "in_reply_to_id" : 184820685,
      "line" : 329,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgzMDU2NA==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_line" : 329,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : 80,
      "pull_request_review_id" : 116111538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830564",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's indeed cleaner; done.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-28T00:04:58Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    assert(&*script.end() == &*end);\n+    pc += (&*script.begin() - &*pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830577",
      "id" : 184830577,
      "in_reply_to_id" : 184822784,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgzMDU3Nw==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_line" : 336,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 116111556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830577",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r185124184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185124184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, added a test in a follow-up commit.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-04-30T22:06:11Z",
      "diff_hunk" : "@@ -1383,6 +1383,44 @@ bool TransactionSignatureChecker::CheckSequence(const CScriptNum& nSequence) con\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[1] > OP_16)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r185124184",
      "id" : 185124184,
      "in_reply_to_id" : 184826273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTEyNDE4NA==",
      "original_commit_id" : "5aa2610dd4152a0de0953c26fce3ef7132b0ff00",
      "original_line" : 1399,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 116453727,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185124184",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Related discussion in IRC: https://botbot.me/freenode/bitcoin-core-dev/msg/99929791/",
      "created_at" : "2018-05-11T14:08:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-388374394",
      "id" : 388374394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-05-11T14:08:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388374394",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r189749671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189749671"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Which is the default, so I think it's fine. Generally all methods here mimic a subset of the behaviour of std::span, but sometimes with optional arguments/types omitted.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-05-22T00:34:08Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }\n+\n+    constexpr Span<C> subspan(std::ptrdiff_t offset) const noexcept { return Span<C>(m_data + offset, m_size - offset); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r189749671",
      "id" : 189749671,
      "in_reply_to_id" : 183571007,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4OTc0OTY3MQ==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_line" : 36,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 121988937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189749671",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192138723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192138723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's a bit dangerous to use `noexcept` for `operator[]`. If Span is used for a custom collection that might throw an exception here, using noexcept here will cause the app to terminate. `std::span`'s operator[] also does not use noexcept here either: http://en.cppreference.com/w/cpp/container/span/operator_at\r\n\r\nSame goes for `subspan`, it might be better to throw an exception for an invalid offset than to terminate.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-05-31T15:24:34Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192138723",
      "id" : 192138723,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjEzODcyMw==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 124855076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192138723",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192139489"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192139489"
         }
      },
      "author_association" : "MEMBER",
      "body" : "m_data is just a pointer; operator[] is pointer arithmetic + dereferencing of a pointer. There is no chance for anything custom.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-05-31T15:26:47Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192139489",
      "id" : 192139489,
      "in_reply_to_id" : 192138723,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjEzOTQ4OQ==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 124856089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192139489",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192142504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192142504"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah you are of course right",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-05-31T15:35:36Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192142504",
      "id" : 192142504,
      "in_reply_to_id" : 192138723,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjE0MjUwNA==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 124859954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192142504",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2018-05-31T18:53:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-393639530",
      "id" : 393639530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5MzYzOTUzMA==",
      "updated_at" : "2018-05-31T18:53:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/393639530",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395324"
         }
      },
      "author_association" : "MEMBER",
      "body" : "AFAICT span end can change whereas before the end iterator couldn't change. Is this worth noting?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-11T13:03:13Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395324",
      "id" : 194395324,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM5NTMyNA==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 279,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 127557645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395324",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could be `pc += script.begin() - &*pc`?\r\n\r\nIf so `old_size` above is not necessary if you add `Span(C* begin, C* end)` constructor.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-11T13:05:21Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395946",
      "id" : 194395946,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM5NTk0Ng==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 332,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 127557645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395946",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194396602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194396602"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should not touch `pc` if `!ret`?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-11T13:07:37Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194396602",
      "id" : 194396602,
      "in_reply_to_id" : 194395946,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM5NjYwMg==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 332,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 127557645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194396602",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 6ae8a5d681b181c7cb772778e18285139df74ece",
      "created_at" : "2018-06-11T22:58:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-396412833",
      "id" : 396412833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NjQxMjgzMw==",
      "updated_at" : "2018-06-11T22:58:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396412833",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248589"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Noted.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-18T22:46:27Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248589",
      "id" : 196248589,
      "in_reply_to_id" : 194395324,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI0ODU4OQ==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 279,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129765816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Could be `pc += script.begin() - &*pc`?\r\n\r\nNice, done.\r\n\r\n> Should not touch `pc` if `!ret`?\r\n\r\nYes it should. The old `GetScriptOp` implementation operating on iterators did too.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-18T22:47:30Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248776",
      "id" : 196248776,
      "in_reply_to_id" : 194395946,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI0ODc3Ng==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 332,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129766032,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248776",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196250627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196250627"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Okay.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-18T22:58:21Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196250627",
      "id" : 196250627,
      "in_reply_to_id" : 194395946,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI1MDYyNw==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 332,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129768194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196250627",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196251771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196251771"
         }
      },
      "author_association" : "MEMBER",
      "body" : " ",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-18T23:05:03Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196251771",
      "id" : 196251771,
      "in_reply_to_id" : 194395324,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI1MTc3MQ==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 279,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129769508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196251771",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196252546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196252546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure what you're asking here. Yes, it's a change, but I don't think it significant enough to point out in the commit, and certainly not in the code itself.\n\nIf you mean that it should be pointed out to other reviewers, I agree - and you just did :)",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-18T23:09:46Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196252546",
      "id" : 196252546,
      "in_reply_to_id" : 194395324,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI1MjU0Ng==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 279,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129770412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196252546",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196355787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196355787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok then.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-19T09:34:44Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196355787",
      "id" : 196355787,
      "in_reply_to_id" : 194395324,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjM1NTc4Nw==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_line" : 279,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129889833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196355787",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196984051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196984051"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just a thought: wouldn't asserting `pos < m_size` be a quick win here to catch out of bounds bugs during development?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-21T00:52:06Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196984051",
      "id" : 196984051,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5Njk4NDA1MQ==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 130636316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196984051",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK a0d0ae85471881fa7f11d023e4f63d9ea61c28b6",
      "created_at" : "2018-06-21T01:00:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-398943534",
      "id" : 398943534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5ODk0MzUzNA==",
      "updated_at" : "2018-06-21T01:00:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/398943534",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK ae8df82ad34a6baaf883411308255e6c6d093c53 ",
      "created_at" : "2018-06-21T01:04:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-398944076",
      "id" : 398944076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5ODk0NDA3Ng==",
      "updated_at" : "2018-06-21T01:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/398944076",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK ae8df82.",
      "created_at" : "2018-06-21T19:01:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-399209511",
      "id" : 399209511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5OTIwOTUxMQ==",
      "updated_at" : "2018-06-21T19:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/399209511",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197324958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197324958"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds like a good idea to add in a form of debug mode (like `DEBUG_ADDRMAN` etc), but perhaps independently of this PR?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-22T02:20:15Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197324958",
      "id" : 197324958,
      "in_reply_to_id" : 196984051,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NzMyNDk1OA==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 131048979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197324958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197325832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197325832"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ". usually asserts are disabled when NDEBUG is defined but it [looks like](https://github.com/bitcoin/bitcoin/blob/000abbb6b07410357a928768d7d56465ba0d3bac/src/validation.cpp#L51-L53) asserts can't be disabled in bitcoin for some reason? so would need to do something custom... \\_()_/",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-22T02:29:22Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197325832",
      "id" : 197325832,
      "in_reply_to_id" : 196984051,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NzMyNTgzMg==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 131050016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197325832",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197327016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197327016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, we already have that; see DEBUG_ADDRMAN, DEBUG_LOCKORDER, DEBUG_LOCKCONTENTION. More could be added.\n",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2018-06-22T02:35:36Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197327016",
      "id" : 197327016,
      "in_reply_to_id" : 196984051,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NzMyNzAxNg==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_line" : 34,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 131051240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197327016",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK ae8df82ad34a6baaf883411308255e6c6d093c53",
      "created_at" : "2018-06-29T22:05:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-401485757",
      "id" : 401485757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTQ4NTc1Nw==",
      "updated_at" : "2018-06-29T22:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401485757",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2018-08-01T18:42:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-409680069",
      "id" : 409680069,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwOTY4MDA2OQ==",
      "updated_at" : "2018-08-01T18:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/409680069",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25331](https://github.com/bitcoin/bitcoin/pull/25331) (Add HashWriter without ser-type and ser-version and use it where possible by MarcoFalke)\n* [#20100](https://github.com/bitcoin/bitcoin/pull/20100) (Script: split policy/error consensus codes for CLEANSTACK, MINIMALIF by sanket1729)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-21T15:18:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-423570136",
      "id" : 423570136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzU3MDEzNg==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423570136/reactions"
      },
      "updated_at" : "2022-06-11T00:59:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423570136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r220431584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220431584"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this is consensus code: is it worth making the implicit precision losing conversion explicit?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-09-26T05:40:32Z",
      "diff_hunk" : "@@ -299,31 +298,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    Span<const unsigned char> script(&*pc, end - pc);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += script.begin() - &*pc;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r220431584",
      "id" : 220431584,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMTU4NA==",
      "original_commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "original_position" : 81,
      "path" : "src/script/script.cpp",
      "position" : 81,
      "pull_request_review_id" : 158837477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-09-26T05:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220431584",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r220431804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220431804"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this is consensus code: is it worth making this implicit sign changing conversion explicit?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-09-26T05:41:52Z",
      "diff_hunk" : "@@ -1416,21 +1422,60 @@ bool GenericTransactionSignatureChecker<T>::CheckSequence(const CScriptNum& nSeq\n template class GenericTransactionSignatureChecker<CTransaction>;\n template class GenericTransactionSignatureChecker<CMutableTransaction>;\n \n-static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const std::vector<unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[0] > OP_16)) return false;\n+    if ((ptrdiff_t)(script[1] + 2) == script.size()) {\n+        version = CScript::DecodeOP_N((opcodetype)script[0]);\n+        program = script.subspan(2);\n+        return true;\n+    }\n+    return false;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsPushOnly. */\n+static bool IsPushOnly(const Span<const unsigned char>& script)\n+{\n+    Span<const unsigned char> pc = script;\n+    while (pc.size() > 0) {\n+        opcodetype opcode;\n+        if (!GetScriptOp(pc, opcode, nullptr)) return false;\n+        // Note that IsPushOnly() *does* consider OP_RESERVED to be a\n+        // push-type opcode, however execution of OP_RESERVED fails, so\n+        // it's not relevant to P2SH/BIP62 as the scriptSig would fail prior to\n+        // the P2SH special validation code being executed.\n+        if (opcode > OP_16) return false;\n+    }\n+    return true;\n+}\n+\n+static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const Span<const unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n {\n     std::vector<std::vector<unsigned char> > stack;\n-    CScript scriptPubKey;\n+    CScript temp_script;\n+    Span<const unsigned char> script;\n \n     if (witversion == 0) {\n         if (program.size() == WITNESS_V0_SCRIPTHASH_SIZE) {\n             // Version 0 segregated witness program: SHA256(CScript) inside the program, CScript + inputs in witness\n             if (witness.stack.size() == 0) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_WITNESS_EMPTY);\n             }\n-            scriptPubKey = CScript(witness.stack.back().begin(), witness.stack.back().end());\n+            script = MakeSpan(witness.stack.back());\n             stack = std::vector<std::vector<unsigned char> >(witness.stack.begin(), witness.stack.end() - 1);\n             uint256 hashScriptPubKey;\n-            CSHA256().Write(&scriptPubKey[0], scriptPubKey.size()).Finalize(hashScriptPubKey.begin());\n+            CSHA256().Write(script.data(), script.size()).Finalize(hashScriptPubKey.begin());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r220431804",
      "id" : 220431804,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMTgwNA==",
      "original_commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "original_position" : 148,
      "path" : "src/script/interpreter.cpp",
      "position" : 148,
      "pull_request_review_id" : 158837723,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-09-26T05:42:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220431804",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 269 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
      "created_at" : "2019-04-28T19:11:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-487407224",
      "id" : 487407224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NzQwNzIyNA==",
      "updated_at" : "2019-04-28T19:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/487407224",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-06-06T15:24:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-499542564",
      "id" : 499542564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5OTU0MjU2NA==",
      "updated_at" : "2019-06-06T15:24:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/499542564",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This still needs rebase (or should be closed)",
      "created_at" : "2019-09-30T12:58:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-536549075",
      "id" : 536549075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNjU0OTA3NQ==",
      "updated_at" : "2019-09-30T12:58:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/536549075",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Will rebase next week.",
      "created_at" : "2019-10-03T15:35:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-537999032",
      "id" : 537999032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNzk5OTAzMg==",
      "updated_at" : "2019-10-03T15:35:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/537999032",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2019-10-10T19:45:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-540752817",
      "id" : 540752817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDc1MjgxNw==",
      "updated_at" : "2019-10-10T19:45:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540752817",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, and also made `GetScriptOp` return a span for the data pushed.",
      "created_at" : "2019-11-09T19:33:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-552130130",
      "id" : 552130130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MjEzMDEzMA==",
      "updated_at" : "2019-11-09T19:33:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552130130",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Related discussion in IRC: https://botbot.me/freenode/bitcoin-core-dev/msg/99929791/\r\n\r\nThe link is dead unfortunately, is the IRC log still available at another place?",
      "created_at" : "2020-02-02T16:24:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-581151288",
      "id" : 581151288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MTE1MTI4OA==",
      "updated_at" : "2020-02-02T16:24:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/581151288",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373858351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373858351"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Is there any reason why an empty subspan on `script` ist preferred over just the default constructor (i.e. `*data_out = Span<const unsigned char>();`? For a zero-size span the address doesn't seem to matter.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-02T16:30:49Z",
      "diff_hunk" : "@@ -275,18 +276,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, Span<const unsigned char>* data_out)\n {\n     opcodeRet = OP_INVALIDOPCODE;\n-    if (pvchRet)\n-        pvchRet->clear();\n-    if (pc >= end)\n-        return false;\n+    if (data_out)\n+        *data_out = script.subspan(0, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373858351",
      "id" : 373858351,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1ODM1MQ==",
      "original_commit_id" : "c3ab02b8d0da2c6626c5a09c843cccc64b31c3fa",
      "original_line" : 283,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 351952432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373858351",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373858682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373858682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could also be done without constructing a new vector instance through `pvchRet->assign(...,...);`?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-02T16:35:27Z",
      "diff_hunk" : "@@ -298,31 +297,38 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (data_out) *data_out = script.subspan(0, nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    Span<const unsigned char> script(&*pc, end - pc);\n+    Span<const unsigned char> data;\n+    bool ret = GetScriptOp(script, opcodeRet, &data);\n+    if (pvchRet) *pvchRet = std::vector<unsigned char>(data.begin(), data.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373858682",
      "id" : 373858682,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1ODY4Mg==",
      "original_commit_id" : "c3ab02b8d0da2c6626c5a09c843cccc64b31c3fa",
      "original_line" : 331,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 351952432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373858682",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373858811"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373858811"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "With the changes, `vchPushValue` is now unused and can be deleted.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-02T16:37:33Z",
      "diff_hunk" : "@@ -288,9 +289,8 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     // static const valtype vchZero(0);\n     static const valtype vchTrue(1, 1);\n \n-    CScript::const_iterator pc = script.begin();\n-    CScript::const_iterator pend = script.end();\n-    CScript::const_iterator pbegincodehash = script.begin();\n+    Span<const unsigned char> pc = script;\n+    Span<const unsigned char> codehash = script;\n     opcodetype opcode;\n     valtype vchPushValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373858811",
      "id" : 373858811,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1ODgxMQ==",
      "original_commit_id" : "caff5a96297feb5ed83919195546761fc920cde3",
      "original_line" : 295,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 351952432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373858811",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373859204"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373859204"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Braces can be removed here as the if-body only consists of one single statement (to be consistent with the remaining ifs in the same function).",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-02T16:43:26Z",
      "diff_hunk" : "@@ -303,16 +303,18 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n \n     try\n     {\n-        while (pc < pend)\n+        while (pc.size() > 0)\n         {\n             bool fExec = !count(vfExec.begin(), vfExec.end(), false);\n \n             //\n             // Read instruction\n             //\n-            if (!script.GetOp(pc, opcode, vchPushValue))\n+            Span<const unsigned char> push_value;\n+            if (!GetScriptOp(pc, opcode, &push_value)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373859204",
      "id" : 373859204,
      "line" : 406,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1OTIwNA==",
      "original_commit_id" : "caff5a96297feb5ed83919195546761fc920cde3",
      "original_line" : 406,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 67,
      "pull_request_review_id" : 351952432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373859204",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373859580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373859580"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As `temp_script` is only used once, it could be declared and initialized immediately (as `const`) below at the place where it is needed.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-02T16:49:25Z",
      "diff_hunk" : "@@ -1461,21 +1461,22 @@ static bool IsPushOnly(const Span<const unsigned char>& script)\n     return true;\n }\n \n-static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const std::vector<unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n+static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const Span<const unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n {\n     std::vector<std::vector<unsigned char> > stack;\n-    CScript scriptPubKey;\n+    CScript temp_script;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373859580",
      "id" : 373859580,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1OTU4MA==",
      "original_commit_id" : "5b97a3162275b96814186f113c9f6371cdafcf53",
      "original_line" : 1467,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 351952432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373859580",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373859716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373859716"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Given that `temp_script` is declared as `const` (see previous reviews comment above), one can simply use `MakeSpan(temp_script)` here.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-02T16:51:43Z",
      "diff_hunk" : "@@ -1484,7 +1485,8 @@ static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion,\n             if (witness.stack.size() != 2) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_MISMATCH); // 2 items in witness\n             }\n-            scriptPubKey << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            temp_script << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            script = Span<const unsigned char>(temp_script.data(), temp_script.size());\n             stack = witness.stack;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373859716",
      "id" : 373859716,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1OTcxNg==",
      "original_commit_id" : "5b97a3162275b96814186f113c9f6371cdafcf53",
      "original_line" : 1487,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 351952432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373859716",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918216"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No reason, changed it.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-03T04:29:59Z",
      "diff_hunk" : "@@ -275,18 +276,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, Span<const unsigned char>* data_out)\n {\n     opcodeRet = OP_INVALIDOPCODE;\n-    if (pvchRet)\n-        pvchRet->clear();\n-    if (pc >= end)\n-        return false;\n+    if (data_out)\n+        *data_out = script.subspan(0, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918216",
      "id" : 373918216,
      "in_reply_to_id" : 373858351,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODIxNg==",
      "original_commit_id" : "c3ab02b8d0da2c6626c5a09c843cccc64b31c3fa",
      "original_line" : 283,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 352015857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918216",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918237"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, done.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-03T04:30:08Z",
      "diff_hunk" : "@@ -298,31 +297,38 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (data_out) *data_out = script.subspan(0, nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    Span<const unsigned char> script(&*pc, end - pc);\n+    Span<const unsigned char> data;\n+    bool ret = GetScriptOp(script, opcodeRet, &data);\n+    if (pvchRet) *pvchRet = std::vector<unsigned char>(data.begin(), data.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918237",
      "id" : 373918237,
      "in_reply_to_id" : 373858682,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODIzNw==",
      "original_commit_id" : "c3ab02b8d0da2c6626c5a09c843cccc64b31c3fa",
      "original_line" : 331,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 352015887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918237",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918264"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice find. Gone.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-03T04:30:20Z",
      "diff_hunk" : "@@ -288,9 +289,8 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     // static const valtype vchZero(0);\n     static const valtype vchTrue(1, 1);\n \n-    CScript::const_iterator pc = script.begin();\n-    CScript::const_iterator pend = script.end();\n-    CScript::const_iterator pbegincodehash = script.begin();\n+    Span<const unsigned char> pc = script;\n+    Span<const unsigned char> codehash = script;\n     opcodetype opcode;\n     valtype vchPushValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918264",
      "id" : 373918264,
      "in_reply_to_id" : 373858811,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODI2NA==",
      "original_commit_id" : "caff5a96297feb5ed83919195546761fc920cde3",
      "original_line" : 295,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 352015918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918264",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918418"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd rather not. The style guide only allows brace-less ifs if the then clause is on the same line as the if condition. Doing so would make the line a bit long in my opinion.\r\n\r\nThe fact that it's inconsistent with the code around it doesn't matter.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-03T04:31:24Z",
      "diff_hunk" : "@@ -303,16 +303,18 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n \n     try\n     {\n-        while (pc < pend)\n+        while (pc.size() > 0)\n         {\n             bool fExec = !count(vfExec.begin(), vfExec.end(), false);\n \n             //\n             // Read instruction\n             //\n-            if (!script.GetOp(pc, opcode, vchPushValue))\n+            Span<const unsigned char> push_value;\n+            if (!GetScriptOp(pc, opcode, &push_value)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918418",
      "id" : 373918418,
      "in_reply_to_id" : 373859204,
      "line" : 406,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODQxOA==",
      "original_commit_id" : "caff5a96297feb5ed83919195546761fc920cde3",
      "original_line" : 406,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 67,
      "pull_request_review_id" : 352016119,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918418",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918511"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's unfortunately incorrect. The `script` variable is a Span which doesn't have its own storage, so it needs the `temp_script` to remain intact over its lifetime. I've added a comment to clarify.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-03T04:32:10Z",
      "diff_hunk" : "@@ -1484,7 +1485,8 @@ static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion,\n             if (witness.stack.size() != 2) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_MISMATCH); // 2 items in witness\n             }\n-            scriptPubKey << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            temp_script << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            script = Span<const unsigned char>(temp_script.data(), temp_script.size());\n             stack = witness.stack;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918511",
      "id" : 373918511,
      "in_reply_to_id" : 373859716,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODUxMQ==",
      "original_commit_id" : "5b97a3162275b96814186f113c9f6371cdafcf53",
      "original_line" : 1487,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 352016230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918511",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918556"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That does not work (see other comment).",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-03T04:32:34Z",
      "diff_hunk" : "@@ -1461,21 +1461,22 @@ static bool IsPushOnly(const Span<const unsigned char>& script)\n     return true;\n }\n \n-static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const std::vector<unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n+static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const Span<const unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n {\n     std::vector<std::vector<unsigned char> > stack;\n-    CScript scriptPubKey;\n+    CScript temp_script;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r373918556",
      "id" : 373918556,
      "in_reply_to_id" : 373859580,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODU1Ng==",
      "original_commit_id" : "5b97a3162275b96814186f113c9f6371cdafcf53",
      "original_line" : 1467,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 352016289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373918556",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r374655110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374655110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Whoops, you are of course right, `temp_script` wouldn't be alive anymore when `script` is used below. The evil thing with errors like those is that they are hard to get catch by tests: when I tried out my suggestion all of the unit tests still passed successfully. Obviously even though `temp_script` wasn't alive anymore the data at the address was still there unmodified.\r\nOnly creating a destructor `~CScript() { assign(size(), 0}; }` that nullifies the data at the end helped to trigger the failures.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-04T12:58:51Z",
      "diff_hunk" : "@@ -1484,7 +1485,8 @@ static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion,\n             if (witness.stack.size() != 2) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_MISMATCH); // 2 items in witness\n             }\n-            scriptPubKey << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            temp_script << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            script = Span<const unsigned char>(temp_script.data(), temp_script.size());\n             stack = witness.stack;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r374655110",
      "id" : 374655110,
      "in_reply_to_id" : 373859716,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY1NTExMA==",
      "original_commit_id" : "5b97a3162275b96814186f113c9f6371cdafcf53",
      "original_line" : 1487,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 352954143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374655110",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r374659931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374659931"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, my assumption was that mimicing the surrounding style was favored over new style rather than the other way around, mea culpa.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-02-04T13:10:01Z",
      "diff_hunk" : "@@ -303,16 +303,18 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n \n     try\n     {\n-        while (pc < pend)\n+        while (pc.size() > 0)\n         {\n             bool fExec = !count(vfExec.begin(), vfExec.end(), false);\n \n             //\n             // Read instruction\n             //\n-            if (!script.GetOp(pc, opcode, vchPushValue))\n+            Span<const unsigned char> push_value;\n+            if (!GetScriptOp(pc, opcode, &push_value)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r374659931",
      "id" : 374659931,
      "in_reply_to_id" : 373859204,
      "line" : 406,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY1OTkzMQ==",
      "original_commit_id" : "caff5a96297feb5ed83919195546761fc920cde3",
      "original_line" : 406,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 67,
      "pull_request_review_id" : 352960645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374659931",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased (nontrivially) on the now-merged #18002.",
      "created_at" : "2020-03-14T02:07:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-598997297",
      "id" : 598997297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5ODk5NzI5Nw==",
      "updated_at" : "2020-03-14T02:07:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598997297",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-14T21:47:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-599138654",
      "id" : 599138654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5OTEzODY1NA==",
      "updated_at" : "2020-03-14T21:47:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599138654",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on top of the now-merged #16902.",
      "created_at" : "2020-03-14T22:05:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-599140625",
      "id" : 599140625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5OTE0MDYyNQ==",
      "updated_at" : "2020-03-14T22:05:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599140625",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-27T07:18:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-604851834",
      "id" : 604851834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNDg1MTgzNA==",
      "updated_at" : "2020-03-27T07:18:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604851834",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased now that #18388 is merged. Also added a commit to get rid of two more unnecessary CScript instances in the verification code.",
      "created_at" : "2020-03-27T23:18:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-605353057",
      "id" : 605353057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNTM1MzA1Nw==",
      "updated_at" : "2020-03-27T23:18:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605353057",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-10T18:45:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-612165146",
      "id" : 612165146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxMjE2NTE0Ng==",
      "updated_at" : "2020-04-10T18:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/612165146",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased now that #18422 is merged.",
      "created_at" : "2020-04-12T20:38:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-612672816",
      "id" : 612672816,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxMjY3MjgxNg==",
      "updated_at" : "2020-04-12T20:38:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/612672816",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-11T06:12:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-626492693",
      "id" : 626492693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNjQ5MjY5Mw==",
      "updated_at" : "2020-05-11T06:12:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/626492693",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "For those looking to review - this had 4 pre-rebase utACKs (laanwj, jb55, achow101, promag) and a code review ACK (theStack) with no NACKs or any show-stopping concerns raised.",
      "created_at" : "2020-06-18T16:57:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-646172018",
      "id" : 646172018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjE3MjAxOA==",
      "updated_at" : "2020-06-18T16:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646172018",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "post-rebase Concept ACK",
      "created_at" : "2020-06-18T18:04:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-646222140",
      "id" : 646222140,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjIyMjE0MA==",
      "updated_at" : "2020-06-18T18:04:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646222140",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(Trivially) rebased now that #18468 is merged.",
      "created_at" : "2020-06-19T18:33:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-646808620",
      "id" : 646808620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjgwODYyMA==",
      "updated_at" : "2020-06-19T18:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646808620",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just a general question/concern as I re-review: I don't see in the ```std::span``` docs what the guarantees are if the underlying structure is extended after the span is created. If it's supposed to remain generally sane (which I would vaguely expect because it's required to be contiguous), I'm nervous about prevector:\r\n```c++\r\nint main()\r\n{\r\n    std::vector<int> foo;\r\n    foo.push_back(1);\r\n    foo.push_back(2);\r\n    foo.push_back(3);\r\n    Span<int> foospan(foo);\r\n    foo.push_back(4);\r\n    printf(\"foospan last element: %i\\n\", foospan.back());\r\n\r\n    prevector<3, int> bar;\r\n    bar.push_back(1);\r\n    bar.push_back(2);\r\n    bar.push_back(3);\r\n    Span<int> barspan(bar);\r\n    bar.push_back(4);\r\n    printf(\"barspan last element: %i\\n\", barspan.back());\r\n}\r\n```\r\nresult:\r\n```bash\r\n$ ./spantest\r\nfoospan last element: 3\r\nbarspan last element: 6\r\n```",
      "created_at" : "2020-06-19T19:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-646829093",
      "id" : 646829093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjgyOTA5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-06-19T19:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646829093",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theuni I imagine that the guarantees for any container are that anything that may invalidate references, invalidates a span over those elements.\n\nIt's a good point that we should document reference/iterator invalidation for our custom data structures like prevector (which could be something like \"extending a prevector to any size beyond its preallocated limit invalidates all references\").\n\nBoth of your examples are UB (it's the same as taking a reference to container.back(), and then extending the container).",
      "created_at" : "2020-06-19T19:38:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-646831877",
      "id" : 646831877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjgzMTg3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-06-19T19:39:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646831877",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r443026997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443026997"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This would be much less confusing to read if reordered:\r\n```c++\r\nuint256 hashScriptPubKey;\r\nCSHA256().Write(stack.back().data(), stack.back().size()).Finalize(hashScriptPubKey.begin());\r\nif (memcmp(hashScriptPubKey.begin(), program.data(), 32)) {\r\n    return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_MISMATCH);\r\n}\r\nreturn ExecuteWitnessScript(stack, SpanPopBack(stack), flags, SigVersion::WITNESS_V0, checker, serror);\r\n```\r\nInstead of as-is, popping off the stack just before it would've been useful.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-06-19T20:17:11Z",
      "diff_hunk" : "@@ -1569,21 +1568,20 @@ static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion,\n             if (stack.size() == 0) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_WITNESS_EMPTY);\n             }\n-            const valtype& script_bytes = SpanPopBack(stack);\n-            scriptPubKey = CScript(script_bytes.begin(), script_bytes.end());\n+            const valtype& script = SpanPopBack(stack);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r443026997",
      "id" : 443026997,
      "line" : 1571,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzAyNjk5Nw==",
      "original_commit_id" : "a6b0522c44b61041317ea2a59446cc92c4b97265",
      "original_line" : 1571,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 188,
      "pull_request_review_id" : 434320717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443026997",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r446415552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446415552"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Huh, this code just didn't make sense - it had `script` already, why was it accessing it through `witness.stack.back()`?\r\n\r\nI've changed it to just use `Write(script.data(), script.size())`.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-06-26T21:21:30Z",
      "diff_hunk" : "@@ -1569,21 +1568,20 @@ static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion,\n             if (stack.size() == 0) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_WITNESS_EMPTY);\n             }\n-            const valtype& script_bytes = SpanPopBack(stack);\n-            scriptPubKey = CScript(script_bytes.begin(), script_bytes.end());\n+            const valtype& script = SpanPopBack(stack);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r446415552",
      "id" : 446415552,
      "in_reply_to_id" : 443026997,
      "line" : 1571,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQxNTU1Mg==",
      "original_commit_id" : "a6b0522c44b61041317ea2a59446cc92c4b97265",
      "original_line" : 1571,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 188,
      "pull_request_review_id" : 438602332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-26T21:21:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446415552",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r447294589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447294589"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do we get the benefit of the `Span` here even though it's only used in a short context?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-06-29T22:29:25Z",
      "diff_hunk" : "@@ -396,16 +395,18 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n \n     try\n     {\n-        while (pc < pend)\n+        while (pc.size() > 0)\n         {\n             bool fExec = vfExec.all_true();\n \n             //\n             // Read instruction\n             //\n-            if (!script.GetOp(pc, opcode, vchPushValue))\n+            Span<const unsigned char> push_value;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r447294589",
      "id" : 447294589,
      "line" : 405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI5NDU4OQ==",
      "original_commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "original_line" : 405,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 66,
      "pull_request_review_id" : 439545541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-29T22:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447294589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r448104318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448104318"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure what you mean by \"the benefit of the `Span`\". Spans are a more readable way of dealing with span-like data, but it depends what you care about, and what you compare with.\r\n\r\nCompared to the current code, it's more efficient: it's avoiding an allocation and a copy (vchPushValue was storing a copy of the pushed data). A copy still happens when emplacing on the stack, but only in executed branches.\r\n\r\nCompared to manually maintaining a pointer & length, which would be equally efficient... it's certainly a lot more readable.",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-07-01T04:11:39Z",
      "diff_hunk" : "@@ -396,16 +395,18 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n \n     try\n     {\n-        while (pc < pend)\n+        while (pc.size() > 0)\n         {\n             bool fExec = vfExec.all_true();\n \n             //\n             // Read instruction\n             //\n-            if (!script.GetOp(pc, opcode, vchPushValue))\n+            Span<const unsigned char> push_value;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r448104318",
      "id" : 448104318,
      "in_reply_to_id" : 447294589,
      "line" : 405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwNDMxOA==",
      "original_commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "original_line" : 405,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 66,
      "pull_request_review_id" : 440533156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T04:11:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448104318",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r448293401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448293401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I see, thanks",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-07-01T11:16:59Z",
      "diff_hunk" : "@@ -396,16 +395,18 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n \n     try\n     {\n-        while (pc < pend)\n+        while (pc.size() > 0)\n         {\n             bool fExec = vfExec.all_true();\n \n             //\n             // Read instruction\n             //\n-            if (!script.GetOp(pc, opcode, vchPushValue))\n+            Span<const unsigned char> push_value;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r448293401",
      "id" : 448293401,
      "in_reply_to_id" : 447294589,
      "line" : 405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI5MzQwMQ==",
      "original_commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "original_line" : 405,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 66,
      "pull_request_review_id" : 440776351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T11:17:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448293401",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r459410149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459410149"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Strictly speaking that's not semantically equivalent to the code replaced. Before it would compare `scriptSig` and the pushed `redeem_script` byte-by-byte, now with the change it only compares that the size matches and the first byte (the push).\r\nI guess that is indended though, as `redeem_script` is derived from `scriptSig` above anyways, and hence the content comparison is not needed?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-07-23T12:26:51Z",
      "diff_hunk" : "@@ -1674,8 +1676,7 @@ bool VerifyScript(const Span<const unsigned char>& scriptSig, const Span<const u\n         if (flags & SCRIPT_VERIFY_WITNESS) {\n             if (IsWitnessProgram(redeem_script, witnessversion, witnessprogram)) {\n                 hadWitness = true;\n-                const CScript expected_scriptsig = CScript() << redeem_script;\n-                if (scriptSig != expected_scriptsig) {\n+                if (scriptSig.size() != redeem_script.size() + 1 || scriptSig[0] != redeem_script.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r459410149",
      "id" : 459410149,
      "line" : 1679,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQxMDE0OQ==",
      "original_commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "original_line" : 1679,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 276,
      "pull_request_review_id" : 454078589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-23T12:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459410149",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-08-06T11:34:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-669874123",
      "id" : 669874123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTg3NDEyMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T11:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669874123",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > Related discussion in IRC: https://botbot.me/freenode/bitcoin-core-dev/msg/99929791/\r\n> \r\n> The link is dead unfortunately, is the IRC log still available at another place?\r\n\r\nhttp://www.erisian.com.au/bitcoin-core-dev/log-2018-05-10.html#l-524",
      "created_at" : "2020-08-06T12:03:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-669886290",
      "id" : 669886290,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTg4NjI5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T12:03:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669886290",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> As mentioned on IRC, I am a little nervous about the greedy Span constructor as I prefer the explicitness of MakeSpan, but as @sipa pointed out, it matches std::span's behavior.\r\n\r\nhttp://www.erisian.com.au/bitcoin-core-dev/log-2020-06-19.html#l-488",
      "created_at" : "2020-08-06T12:14:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-669890888",
      "id" : 669890888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTg5MDg4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T12:14:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669890888",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r466604751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466604751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "591f1037e474ffb1c9f84926bb8f846a515096e9\r\n\r\nnit: Mind adding `#include <algorithm>` ?",
      "commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "created_at" : "2020-08-06T18:26:10Z",
      "diff_hunk" : "@@ -1580,7 +1580,9 @@ static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion,\n             if (stack.size() != 2) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_MISMATCH); // 2 items in witness\n             }\n-            CScript script = CScript() << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            //! The script \"OP_DUP OP_HASH160 <program> OP_EQUALVERIFY OP_CHECKSIG\".\n+            unsigned char script[25] = {OP_DUP, OP_HASH160, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, OP_EQUALVERIFY, OP_CHECKSIG};\n+            std::copy(program.begin(), program.end(), script + 3);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r466604751",
      "id" : 466604751,
      "line" : 1585,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwNDc1MQ==",
      "original_commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "original_line" : 1585,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 206,
      "pull_request_review_id" : 462772231,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-06T18:31:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466604751",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r478629130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478629130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to make this private? `static` makes it harder to test and also the \"other\" version of IsPushOnly can't call this to avoid code duplication.",
      "commit_id" : "b0f90888f0dc22f04c10e7504cc8c3cc5e1dc405",
      "created_at" : "2020-08-27T18:55:57Z",
      "diff_hunk" : "@@ -1511,17 +1512,54 @@ static bool ExecuteWitnessScript(const Span<const valtype>& stack_span, const CS\n     }\n \n     // Run the script interpreter.\n-    if (!EvalScript(stack, scriptPubKey, flags, checker, sigversion, serror)) return false;\n+    if (!EvalScript(stack, script, flags, checker, sigversion, serror)) return false;\n \n     // Scripts inside witness implicitly require cleanstack behaviour\n     if (stack.size() != 1) return set_error(serror, SCRIPT_ERR_CLEANSTACK);\n     if (!CastToBool(stack.back())) return set_error(serror, SCRIPT_ERR_EVAL_FALSE);\n     return true;\n }\n \n-static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const std::vector<unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[0] > OP_16)) return false;\n+    if (std::size_t(script[1] + 2) == script.size()) {\n+        version = CScript::DecodeOP_N((opcodetype)script[0]);\n+        program = script.subspan(2);\n+        return true;\n+    }\n+    return false;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsPushOnly. */\n+static bool IsPushOnly(const Span<const unsigned char>& script)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r478629130",
      "id" : 478629130,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyOTEzMA==",
      "original_commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "original_line" : 1546,
      "original_position" : 161,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 476996152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-27T18:55:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478629130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r492703713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492703713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Was there a bad rebase here somewhere? The \"Introduce consensus versions of script type checks on Span\" doesn't actually use the new code and there's not a separate commit for `VerifyWitnessProgram` accepting spans -- both those are instead part of \"gMake VerifyScript operate on Span\" which has a weird typo in the commit title. (That commit also has a typo in the description: \"storare\")",
      "commit_id" : "b0f90888f0dc22f04c10e7504cc8c3cc5e1dc405",
      "created_at" : "2020-09-22T12:46:21Z",
      "diff_hunk" : "@@ -1519,6 +1519,44 @@ static bool ExecuteWitnessScript(const Span<const valtype>& stack_span, const CS\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r492703713",
      "id" : 492703713,
      "line" : 1851,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMzcxMw==",
      "original_commit_id" : "d711c1d79b2de6cf1ba8397e0e1a6f7f7550f53e",
      "original_line" : 1851,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 187,
      "pull_request_review_id" : 493419784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-22T14:35:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492703713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r492711092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492711092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That change makes me twitchy; maybe `static_assert(WITNESS_V0_KEYHASH_SIZE==20, \"consensus critical parameter will result in buffer overrun if changed\");` ?",
      "commit_id" : "b0f90888f0dc22f04c10e7504cc8c3cc5e1dc405",
      "created_at" : "2020-09-22T12:57:29Z",
      "diff_hunk" : "@@ -1580,7 +1580,9 @@ static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion,\n             if (stack.size() != 2) {\n                 return set_error(serror, SCRIPT_ERR_WITNESS_PROGRAM_MISMATCH); // 2 items in witness\n             }\n-            CScript script = CScript() << OP_DUP << OP_HASH160 << program << OP_EQUALVERIFY << OP_CHECKSIG;\n+            //! The script \"OP_DUP OP_HASH160 <program> OP_EQUALVERIFY OP_CHECKSIG\".\n+            unsigned char script[25] = {OP_DUP, OP_HASH160, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, OP_EQUALVERIFY, OP_CHECKSIG};\n+            std::copy(program.begin(), program.end(), script + 3);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r492711092",
      "id" : 492711092,
      "line" : 1941,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxMTA5Mg==",
      "original_commit_id" : "591f1037e474ffb1c9f84926bb8f846a515096e9",
      "original_line" : 1941,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 263,
      "pull_request_review_id" : 493419784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-22T14:35:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492711092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r492723037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492723037"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you rebase, could move the test additions to the first commit, since they're testing things that are already true.",
      "commit_id" : "b0f90888f0dc22f04c10e7504cc8c3cc5e1dc405",
      "created_at" : "2020-09-22T13:14:50Z",
      "diff_hunk" : "@@ -1269,6 +1269,10 @@\n [[\"51\", 0.00000000 ], \"\", \"0 0x206e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d\", \"P2SH,WITNESS\", \"WITNESS_PROGRAM_MISMATCH\", \"Witness script hash mismatch\"],\n [[\"00\", 0.00000000 ], \"\", \"0 0x206e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d\", \"\", \"OK\", \"Invalid witness script without WITNESS\"],\n [[\"51\", 0.00000000 ], \"\", \"0 0x206e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d\", \"\", \"OK\", \"Witness script hash mismatch without WITNESS\"],\n+[[\"51\", 0.00000000 ], \"\", \"-1 0x021234\", \"P2SH,WITNESS\", \"WITNESS_UNEXPECTED\", \"OP_1NEGATE does not introduce a witness program\"],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r492723037",
      "id" : 492723037,
      "line" : 1272,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyMzAzNw==",
      "original_commit_id" : "e1b6a6120afe05cd580b5397e4656201dad8da99",
      "original_line" : 1272,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/data/script_tests.json",
      "position" : 4,
      "pull_request_review_id" : 493419784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-22T14:35:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492723037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-10-15T11:11:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-709205564",
      "id" : 709205564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTIwNTU2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-15T11:11:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709205564",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on top of, and integrated with, the Taproot validation logic.",
      "created_at" : "2021-05-25T03:25:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-847500300",
      "id" : 847500300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NzUwMDMwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-25T03:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/847500300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r638426292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638426292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This commit just introduces these functions; they're used later on.",
      "commit_id" : "b0f90888f0dc22f04c10e7504cc8c3cc5e1dc405",
      "created_at" : "2021-05-25T03:28:59Z",
      "diff_hunk" : "@@ -1519,6 +1519,44 @@ static bool ExecuteWitnessScript(const Span<const valtype>& stack_span, const CS\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r638426292",
      "id" : 638426292,
      "in_reply_to_id" : 492703713,
      "line" : 1851,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODQyNjI5Mg==",
      "original_commit_id" : "d711c1d79b2de6cf1ba8397e0e1a6f7f7550f53e",
      "original_line" : 1851,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 187,
      "pull_request_review_id" : 667358643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-25T03:28:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638426292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-23T13:13:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-866824592",
      "id" : 866824592,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjgyNDU5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-23T13:13:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866824592",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Still wondering about https://github.com/bitcoin/bitcoin/pull/13062#discussion_r478629130 btw",
      "created_at" : "2021-06-23T13:21:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-866830602",
      "id" : 866830602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjgzMDYwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-23T13:21:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866830602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant?  Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant?  Please close.\n* Did the author lose interest or time to work on this?  Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2021-12-22T12:29:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-999541832",
      "id" : 999541832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "IC_kwDOABII5847k8xI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999541832/reactions"
      },
      "updated_at" : "2021-12-22T12:29:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999541832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think this can be closed for now due to inactivity for more than a year. It could then be reopened anytime if needed.",
      "created_at" : "2021-12-22T12:42:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-999548899",
      "id" : 999548899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "IC_kwDOABII5847k-fj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999548899/reactions"
      },
      "updated_at" : "2021-12-22T12:42:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999548899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. Will address outstanding comments soon.",
      "created_at" : "2021-12-24T21:34:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-1000935646",
      "id" : 1000935646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "IC_kwDOABII5847qRDe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000935646/reactions"
      },
      "updated_at" : "2021-12-24T21:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1000935646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-05T12:56:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-1088670434",
      "id" : 1088670434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "IC_kwDOABII585A48ri",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088670434/reactions"
      },
      "updated_at" : "2022-04-05T12:56:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088670434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2022-04-05T19:02:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-1089198670",
      "id" : 1089198670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "IC_kwDOABII585A69pO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1089198670/reactions"
      },
      "updated_at" : "2022-04-05T19:02:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1089198670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-22T07:57:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-1192293378",
      "id" : 1192293378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "IC_kwDOABII585HEPQC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192293378/reactions"
      },
      "updated_at" : "2022-07-22T07:57:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192293378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
