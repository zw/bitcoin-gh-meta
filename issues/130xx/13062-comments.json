[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r183571007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183571007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note, equivalent to `count = std::dynamic_extent` in std::span.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-23T23:54:52Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }\n+\n+    constexpr Span<C> subspan(std::ptrdiff_t offset) const noexcept { return Span<C>(m_data + offset, m_size - offset); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r183571007",
      "id" : 183571007,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MzU3MTAwNw==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_position" : 9,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 114594507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183571007",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Makes `interpreter.cpp` more self-contained, that's good.\r\nVerified that:\r\n- Consensus `IsPayToScriptHash` matches `CScript::IsPayToScriptHash`: copy-only apart from variable names\r\n- Consensus `IsWitnessProgram` matches `CScript::IsWitnessProgram`: \r\n  - a size_t becomes ptr_diff_t: not an issue as only positive values are possible (unsigned char + 2)\r\n  - `std::vector<unsigned char>(this->begin() + 2, this->end())` becomes `script.subspan(2)`: should be ok, it's defined as `Span(m_data + offset, m_size - offset)`\r\n- Consensus `IsPushOnly` matches `CScript::IsPushOnly`:\r\n  - `pc` becomes `Span` instead of a `const_iterator`: effective behavior is the same\r\n  - `GetOp` becomes `GetScriptOp`: GetOp is already defined in that way, so should be fine\r\n\r\nOther changes look straightforward.\r\n\r\nutACK 91c12000dd97d7b9b9c82d1bbc92c7bbadd3d6ed",
      "created_at" : "2018-04-25T13:51:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-384294167",
      "id" : 384294167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-25T13:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384294167",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems to be lacking a bunch of motivation. Can you clarify *why* you want to run a script stored in a span?",
      "created_at" : "2018-04-27T16:40:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385026068",
      "id" : 385026068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T16:40:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385026068",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@TheBlueMatt They're not stored in a Span; a Span is just a way to refer to a script stored anywhere (vector, array, prevector, whatever custom structure that can hold a continuous sequence of bytes).\n\nI'll add some more motivation.",
      "created_at" : "2018-04-27T16:51:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385029327",
      "id" : 385029327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T16:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385029327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Suresure, I was asking for motivation of where we want to do this in the immediate future (do you have any branches that run scripts in non-prevector form?). The only place I can think of it being useful is in libbitcoinconsensus.",
      "created_at" : "2018-04-27T16:55:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385030495",
      "id" : 385030495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T16:55:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385030495",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@TheBlueMatt No code to show, but I added some thoughts to the PR description.",
      "created_at" : "2018-04-27T17:02:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385032610",
      "id" : 385032610,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T17:02:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385032610",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, the scriptPubKey/scriptSig distinction seems like a reasonable idea. Would love to see a branch with that implemented to see the feasibility of using this in the short-term after a merge.",
      "created_at" : "2018-04-27T17:12:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-385035134",
      "id" : 385035134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-04-27T17:12:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385035134",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184820685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184820685"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this needs a check before dereference. Before, it would've been caught in the real GetScriptOp() by the newly removed\r\n```c++\r\nif (pc >= end)\r\n    return false;\r\n```",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-27T22:29:48Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184820685",
      "id" : 184820685,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgyMDY4NQ==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_position" : 78,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 116100048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184820685",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184822784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184822784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems unnecessarily brittle. How about caching the before-size and adding back the difference from the final script.size() ?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-27T22:45:40Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    assert(&*script.end() == &*end);\n+    pc += (&*script.begin() - &*pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184822784",
      "id" : 184822784,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgyMjc4NA==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_position" : 81,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 116100048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184822784",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184826273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184826273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "how did ```script[1]``` sneak in here?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-27T23:16:45Z",
      "diff_hunk" : "@@ -1383,6 +1383,44 @@ bool TransactionSignatureChecker::CheckSequence(const CScriptNum& nSequence) con\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[1] > OP_16)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184826273",
      "id" : 184826273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgyNjI3Mw==",
      "original_commit_id" : "5aa2610dd4152a0de0953c26fce3ef7132b0ff00",
      "original_position" : 17,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 116100048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184826273",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830547"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830547"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed, going to add a test.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-28T00:04:36Z",
      "diff_hunk" : "@@ -1383,6 +1383,44 @@ bool TransactionSignatureChecker::CheckSequence(const CScriptNum& nSequence) con\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[1] > OP_16)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830547",
      "id" : 184830547,
      "in_reply_to_id" : 184826273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgzMDU0Nw==",
      "original_commit_id" : "5aa2610dd4152a0de0953c26fce3ef7132b0ff00",
      "original_position" : 17,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 116111518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830547",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch, fixed.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-28T00:04:46Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830564",
      "id" : 184830564,
      "in_reply_to_id" : 184820685,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgzMDU2NA==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_position" : 78,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 116111538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830564",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's indeed cleaner; done.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-28T00:04:58Z",
      "diff_hunk" : "@@ -304,31 +303,36 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    Span<const unsigned char> script(&*pc, end - pc);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    assert(&*script.end() == &*end);\n+    pc += (&*script.begin() - &*pc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r184830577",
      "id" : 184830577,
      "in_reply_to_id" : 184822784,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NDgzMDU3Nw==",
      "original_commit_id" : "f31d811228b028d4059deb8bb3b679bd10d463a7",
      "original_position" : 81,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 116111556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184830577",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r185124184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185124184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, added a test in a follow-up commit.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-04-30T22:06:11Z",
      "diff_hunk" : "@@ -1383,6 +1383,44 @@ bool TransactionSignatureChecker::CheckSequence(const CScriptNum& nSequence) con\n     return true;\n }\n \n+/** Consensus-critical analogue of CScript::IsPayToScriptHash. */\n+static bool IsPayToScriptHash(const Span<const unsigned char>& script)\n+{\n+    return script.size() == 23 &&\n+           script[0] == OP_HASH160 &&\n+           script[1] == 0x14 &&\n+           script[22] == OP_EQUAL;\n+}\n+\n+/** Consensus-critical analogue of CScript::IsWitnessProgram. */\n+static bool IsWitnessProgram(const Span<const unsigned char>& script, int& version, Span<const unsigned char>& program)\n+{\n+    if (script.size() < 4 || script.size() > 42) return false;\n+    if (script[0] != OP_0 && (script[0] < OP_1 || script[1] > OP_16)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r185124184",
      "id" : 185124184,
      "in_reply_to_id" : 184826273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTEyNDE4NA==",
      "original_commit_id" : "5aa2610dd4152a0de0953c26fce3ef7132b0ff00",
      "original_position" : 17,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 116453727,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185124184",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Related discussion in IRC: https://botbot.me/freenode/bitcoin-core-dev/msg/99929791/",
      "created_at" : "2018-05-11T14:08:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-388374394",
      "id" : 388374394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "updated_at" : "2018-05-11T14:08:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388374394",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r189749671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189749671"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Which is the default, so I think it's fine. Generally all methods here mimic a subset of the behaviour of std::span, but sometimes with optional arguments/types omitted.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-05-22T00:34:08Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }\n+\n+    constexpr Span<C> subspan(std::ptrdiff_t offset) const noexcept { return Span<C>(m_data + offset, m_size - offset); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r189749671",
      "id" : 189749671,
      "in_reply_to_id" : 183571007,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4OTc0OTY3MQ==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_position" : 9,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 121988937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189749671",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192138723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192138723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's a bit dangerous to use `noexcept` for `operator[]`. If Span is used for a custom collection that might throw an exception here, using noexcept here will cause the app to terminate. `std::span`'s operator[] also does not use noexcept here either: http://en.cppreference.com/w/cpp/container/span/operator_at\r\n\r\nSame goes for `subspan`, it might be better to throw an exception for an invalid offset than to terminate.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-05-31T15:24:34Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192138723",
      "id" : 192138723,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjEzODcyMw==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_position" : 7,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 124855076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192138723",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192139489"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192139489"
         }
      },
      "author_association" : "MEMBER",
      "body" : "m_data is just a pointer; operator[] is pointer arithmetic + dereferencing of a pointer. There is no chance for anything custom.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-05-31T15:26:47Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192139489",
      "id" : 192139489,
      "in_reply_to_id" : 192138723,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjEzOTQ4OQ==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_position" : 7,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 124856089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192139489",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192142504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192142504"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah you are of course right",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-05-31T15:35:36Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r192142504",
      "id" : 192142504,
      "in_reply_to_id" : 192138723,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjE0MjUwNA==",
      "original_commit_id" : "3fd0d0bf52c5fd6f5a40e22460fcc666e4eea2d0",
      "original_position" : 7,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 124859954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192142504",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2018-05-31T18:53:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-393639530",
      "id" : 393639530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5MzYzOTUzMA==",
      "updated_at" : "2018-05-31T18:53:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/393639530",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395324"
         }
      },
      "author_association" : "MEMBER",
      "body" : "AFAICT span end can change whereas before the end iterator couldn't change. Is this worth noting?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-11T13:03:13Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395324",
      "id" : 194395324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM5NTMyNA==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 13,
      "path" : "src/script/script.cpp",
      "position" : 13,
      "pull_request_review_id" : 127557645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395324",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could be `pc += script.begin() - &*pc`?\r\n\r\nIf so `old_size` above is not necessary if you add `Span(C* begin, C* end)` constructor.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-11T13:05:21Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194395946",
      "id" : 194395946,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM5NTk0Ng==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 82,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 127557645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194395946",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194396602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194396602"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should not touch `pc` if `!ret`?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-11T13:07:37Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r194396602",
      "id" : 194396602,
      "in_reply_to_id" : 194395946,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM5NjYwMg==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 82,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 127557645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194396602",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 6ae8a5d681b181c7cb772778e18285139df74ece",
      "created_at" : "2018-06-11T22:58:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-396412833",
      "id" : 396412833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NjQxMjgzMw==",
      "updated_at" : "2018-06-11T22:58:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396412833",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248589"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Noted.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-18T22:46:27Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248589",
      "id" : 196248589,
      "in_reply_to_id" : 194395324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI0ODU4OQ==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 13,
      "path" : "src/script/script.cpp",
      "position" : 13,
      "pull_request_review_id" : 129765816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Could be `pc += script.begin() - &*pc`?\r\n\r\nNice, done.\r\n\r\n> Should not touch `pc` if `!ret`?\r\n\r\nYes it should. The old `GetScriptOp` implementation operating on iterators did too.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-18T22:47:30Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196248776",
      "id" : 196248776,
      "in_reply_to_id" : 194395946,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI0ODc3Ng==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 82,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129766032,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196248776",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196250627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196250627"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Okay.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-18T22:58:21Z",
      "diff_hunk" : "@@ -299,31 +298,37 @@ bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator en\n         }\n         else if (opcode == OP_PUSHDATA1)\n         {\n-            if (end - pc < 1)\n-                return false;\n-            nSize = *pc++;\n+            if (script.size() < 1) return false;\n+            nSize = script[0];\n+            script = script.subspan(1);\n         }\n         else if (opcode == OP_PUSHDATA2)\n         {\n-            if (end - pc < 2)\n-                return false;\n-            nSize = ReadLE16(&pc[0]);\n-            pc += 2;\n+            if (script.size() < 2) return false;\n+            nSize = ReadLE16(script.data());\n+            script = script.subspan(2);\n         }\n         else if (opcode == OP_PUSHDATA4)\n         {\n-            if (end - pc < 4)\n-                return false;\n-            nSize = ReadLE32(&pc[0]);\n-            pc += 4;\n+            if (script.size() < 4) return false;\n+            nSize = ReadLE32(script.data());\n+            script = script.subspan(4);\n         }\n-        if (end - pc < 0 || (unsigned int)(end - pc) < nSize)\n-            return false;\n-        if (pvchRet)\n-            pvchRet->assign(pc, pc + nSize);\n-        pc += nSize;\n+        if (script.size() < nSize) return false;\n+        if (pvchRet) pvchRet->assign(script.begin(), script.begin() + nSize);\n+        script = script.subspan(nSize);\n     }\n \n     opcodeRet = static_cast<opcodetype>(opcode);\n     return true;\n }\n+\n+bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+{\n+    if (pc >= end) return false;\n+    ptrdiff_t old_size = end - pc;\n+    Span<const unsigned char> script(&*pc, old_size);\n+    bool ret = GetScriptOp(script, opcodeRet, pvchRet);\n+    pc += (old_size - script.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196250627",
      "id" : 196250627,
      "in_reply_to_id" : 194395946,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI1MDYyNw==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 82,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 129768194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196250627",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196251771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196251771"
         }
      },
      "author_association" : "MEMBER",
      "body" : " ",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-18T23:05:03Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196251771",
      "id" : 196251771,
      "in_reply_to_id" : 194395324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI1MTc3MQ==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 13,
      "path" : "src/script/script.cpp",
      "position" : 13,
      "pull_request_review_id" : 129769508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196251771",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196252546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196252546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure what you're asking here. Yes, it's a change, but I don't think it significant enough to point out in the commit, and certainly not in the code itself.\n\nIf you mean that it should be pointed out to other reviewers, I agree - and you just did :)",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-18T23:09:46Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196252546",
      "id" : 196252546,
      "in_reply_to_id" : 194395324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjI1MjU0Ng==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 13,
      "path" : "src/script/script.cpp",
      "position" : 13,
      "pull_request_review_id" : 129770412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196252546",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196355787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196355787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok then.",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-19T09:34:44Z",
      "diff_hunk" : "@@ -276,18 +277,16 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n-bool GetScriptOp(CScriptBase::const_iterator& pc, CScriptBase::const_iterator end, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)\n+bool GetScriptOp(Span<const unsigned char>& script, opcodetype& opcodeRet, std::vector<unsigned char>* pvchRet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196355787",
      "id" : 196355787,
      "in_reply_to_id" : 194395324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjM1NTc4Nw==",
      "original_commit_id" : "c88b9efbdc479fda03e14bc13eb9b6ef1a2cefaf",
      "original_position" : 13,
      "path" : "src/script/script.cpp",
      "position" : 13,
      "pull_request_review_id" : 129889833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196355787",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196984051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196984051"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just a thought: wouldn't asserting `pos < m_size` be a quick win here to catch out of bounds bugs during development?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-21T00:52:06Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r196984051",
      "id" : 196984051,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5Njk4NDA1MQ==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_position" : 7,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 130636316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/196984051",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK a0d0ae85471881fa7f11d023e4f63d9ea61c28b6",
      "created_at" : "2018-06-21T01:00:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-398943534",
      "id" : 398943534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5ODk0MzUzNA==",
      "updated_at" : "2018-06-21T01:00:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/398943534",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK ae8df82ad34a6baaf883411308255e6c6d093c53 ",
      "created_at" : "2018-06-21T01:04:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-398944076",
      "id" : 398944076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5ODk0NDA3Ng==",
      "updated_at" : "2018-06-21T01:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/398944076",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK ae8df82.",
      "created_at" : "2018-06-21T19:01:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-399209511",
      "id" : 399209511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5OTIwOTUxMQ==",
      "updated_at" : "2018-06-21T19:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/399209511",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197324958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197324958"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds like a good idea to add in a form of debug mode (like `DEBUG_ADDRMAN` etc), but perhaps independently of this PR?",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-22T02:20:15Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197324958",
      "id" : 197324958,
      "in_reply_to_id" : 196984051,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NzMyNDk1OA==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_position" : 7,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 131048979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197324958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197325832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197325832"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ". usually asserts are disabled when NDEBUG is defined but it [looks like](https://github.com/bitcoin/bitcoin/blob/000abbb6b07410357a928768d7d56465ba0d3bac/src/validation.cpp#L51-L53) asserts can't be disabled in bitcoin for some reason? so would need to do something custom... \\_()_/",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-22T02:29:22Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197325832",
      "id" : 197325832,
      "in_reply_to_id" : 196984051,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NzMyNTgzMg==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_position" : 7,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 131050016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197325832",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197327016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197327016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, we already have that; see DEBUG_ADDRMAN, DEBUG_LOCKORDER, DEBUG_LOCKCONTENTION. More could be added.\n",
      "commit_id" : "2537e8a2617106bab7d904b1e2ed60ebe78e38cd",
      "created_at" : "2018-06-22T02:35:36Z",
      "diff_hunk" : "@@ -23,7 +23,12 @@ class Span\n     constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n \n     constexpr C* data() const noexcept { return m_data; }\n+    constexpr C* begin() const noexcept { return m_data; }\n+    constexpr C* end() const noexcept { return m_data + m_size; }\n     constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n+    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#discussion_r197327016",
      "id" : 197327016,
      "in_reply_to_id" : 196984051,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NzMyNzAxNg==",
      "original_commit_id" : "ae8df82ad34a6baaf883411308255e6c6d093c53",
      "original_position" : 7,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 131051240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13062",
      "updated_at" : "2018-08-01T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/197327016",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK ae8df82ad34a6baaf883411308255e6c6d093c53",
      "created_at" : "2018-06-29T22:05:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-401485757",
      "id" : 401485757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTQ4NTc1Nw==",
      "updated_at" : "2018-06-29T22:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401485757",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2018-08-01T18:42:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13062#issuecomment-409680069",
      "id" : 409680069,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13062",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwOTY4MDA2OQ==",
      "updated_at" : "2018-08-01T18:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/409680069",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
