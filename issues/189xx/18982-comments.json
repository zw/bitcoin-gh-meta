[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19116 ([WIP] wallet: use BlockFilterIndex in ScanForWalletTransactions by pstratem)\n* #18600 ([wallet] Track conflicted transactions removed from mempool and fix UI notifications by ariard)\n* #18354 (Use shared pointers only in validation interface by bvbfan)\n* #17443 (Drop checkFinalTx and use Median Time Past to check finality of wallet transactions by ariard)\n* #15719 (Wallet passive startup by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-15T13:58:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#issuecomment-629251455",
      "id" : 629251455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18982",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTI1MTQ1NQ==",
      "updated_at" : "2020-06-02T03:57:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629251455",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427797119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427797119"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we can dry-up MemPoolRemovalReason completely in the future. The only control flow pending on it I can see is in `removeUnchecked` and it's only consumed by `TransactionRemovedFromMempool`\r\n",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-20T07:29:25Z",
      "diff_hunk" : "@@ -21,6 +21,7 @@ class CConnman;\n class CValidationInterface;\n class uint256;\n class CScheduler;\n+enum class MemPoolRemovalReason;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427797119",
      "id" : 427797119,
      "line" : 24,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc5NzExOQ==",
      "original_commit_id" : "90118ec54f6921ed102ef45bb4f4d3a0ac8782b8",
      "original_line" : 24,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : 4,
      "pull_request_review_id" : 415061702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427797119",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427799161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427799161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you explain which one are going to updated with CONFLICTED status and which not, i.e transactions not directly connected to a previous wallet transaction ?",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-20T07:33:19Z",
      "diff_hunk" : "@@ -1111,12 +1112,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& ptx) {\n     }\n }\n \n-void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx) {\n+void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\n     LOCK(cs_wallet);\n     auto it = mapWallet.find(ptx->GetHash());\n     if (it != mapWallet.end()) {\n         it->second.fInMempool = false;\n     }\n+    // Handle transactions that were removed from the mempool because they\n+    // conflict with transactions in a newly connected block.\n+    if (reason == MemPoolRemovalReason::CONFLICT) {\n+        // Call SyncNotifications, so external -walletnotify notifications will\n+        // be triggered for these transactions. Set Status::UNCONFIRMED instead\n+        // of Status::CONFLICTED for a few reasons:\n+        //\n+        // 1. The transactionRemovedFromMempool callback does not currently\n+        //    provide the conflicting block's hash and height, and for backwards\n+        //    compatibility reasons it may not be not safe to store conflicted\n+        //    wallet transactions with a null block hash. See\n+        //    https://github.com/bitcoin/bitcoin/pull/18600#discussion_r420195993.\n+        // 2. For most of these transactions, wallet internal conflict detection",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427799161",
      "id" : 427799161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc5OTE2MQ==",
      "original_commit_id" : "90118ec54f6921ed102ef45bb4f4d3a0ac8782b8",
      "original_line" : 1133,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 415061702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427799161",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427799842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427799842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, document that conflict transaction tracking will always be a best-effort, an unconfirmed transaction may be removed while wallet is shutdown an therefore never getting the notification.",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-20T07:34:42Z",
      "diff_hunk" : "@@ -1111,12 +1112,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& ptx) {\n     }\n }\n \n-void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx) {\n+void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\n     LOCK(cs_wallet);\n     auto it = mapWallet.find(ptx->GetHash());\n     if (it != mapWallet.end()) {\n         it->second.fInMempool = false;\n     }\n+    // Handle transactions that were removed from the mempool because they\n+    // conflict with transactions in a newly connected block.\n+    if (reason == MemPoolRemovalReason::CONFLICT) {\n+        // Call SyncNotifications, so external -walletnotify notifications will\n+        // be triggered for these transactions. Set Status::UNCONFIRMED instead\n+        // of Status::CONFLICTED for a few reasons:\n+        //\n+        // 1. The transactionRemovedFromMempool callback does not currently\n+        //    provide the conflicting block's hash and height, and for backwards\n+        //    compatibility reasons it may not be not safe to store conflicted\n+        //    wallet transactions with a null block hash. See\n+        //    https://github.com/bitcoin/bitcoin/pull/18600#discussion_r420195993.\n+        // 2. For most of these transactions, wallet internal conflict detection\n+        //    and MarkConflicted logic will subsequently update them with\n+        //    CONFLICTED status anyway.\n+        // 3. Longstanding behavior since the sync implementation in\n+        //    https://github.com/bitcoin/bitcoin/pull/9371 and the prior sync\n+        //    implementation before that was to mark these transactions\n+        //    unconfirmed rather than conflicted.\n+        //\n+        // The wallet's heuristics for distinguishing between conflicted and\n+        // unconfirmed transactions are imperfect, so everything described above\n+        // could be rethought and changed in the future.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427799842",
      "id" : 427799842,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc5OTg0Mg==",
      "original_commit_id" : "90118ec54f6921ed102ef45bb4f4d3a0ac8782b8",
      "original_line" : 1143,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 415061702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427799842",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r428360222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428360222"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427797119\r\n\r\n> I think we can dry-up MemPoolRemovalReason completely in the future. The only control flow pending on it I can see is in `removeUnchecked` and it's only consumed by `TransactionRemovedFromMempool`\r\n\r\nI'm open to removing MemPoolRemovalReason in the future if it simplifies code, hopefully without losing debug or logging benefits or code clarity from using custom enum values instead of generic true/false values",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-20T23:16:46Z",
      "diff_hunk" : "@@ -21,6 +21,7 @@ class CConnman;\n class CValidationInterface;\n class uint256;\n class CScheduler;\n+enum class MemPoolRemovalReason;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r428360222",
      "id" : 428360222,
      "in_reply_to_id" : 427797119,
      "line" : 24,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2MDIyMg==",
      "original_commit_id" : "90118ec54f6921ed102ef45bb4f4d3a0ac8782b8",
      "original_line" : 24,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : 4,
      "pull_request_review_id" : 415777984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428360222",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r428360339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428360339"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427799842\r\n\r\n> Also, document that conflict transaction tracking will always be a best-effort, an unconfirmed transaction may be removed while wallet is shutdown an therefore never getting the notification.\r\n\r\nThe shutdown thing seems like a good thing to document, but this doesn't seem like a great place to document it. This comment, which is already pretty long, is just trying to say why this piece of code is written this way, and say that it isn't unchangeable without getting into how future improvements need to work.\r\n\r\nBut I made a new devwiki page https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking, and added a link here that I think would be a good place to document complications from shutdown. By the way,\r\nI'm not sure if shutdowns would be the main cause of problems in practice, since startup block and mempool rescanning is pretty good and there's a whole other set of problems that comes from the wallet having incomplete information about ancestors and whether wallet transactions are related to block and mempool transactions, which is even worse for detecting conflicted -> unconfimed transitions than for detecting unconfirmed -> conflicted transitions.",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-20T23:17:11Z",
      "diff_hunk" : "@@ -1111,12 +1112,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& ptx) {\n     }\n }\n \n-void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx) {\n+void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\n     LOCK(cs_wallet);\n     auto it = mapWallet.find(ptx->GetHash());\n     if (it != mapWallet.end()) {\n         it->second.fInMempool = false;\n     }\n+    // Handle transactions that were removed from the mempool because they\n+    // conflict with transactions in a newly connected block.\n+    if (reason == MemPoolRemovalReason::CONFLICT) {\n+        // Call SyncNotifications, so external -walletnotify notifications will\n+        // be triggered for these transactions. Set Status::UNCONFIRMED instead\n+        // of Status::CONFLICTED for a few reasons:\n+        //\n+        // 1. The transactionRemovedFromMempool callback does not currently\n+        //    provide the conflicting block's hash and height, and for backwards\n+        //    compatibility reasons it may not be not safe to store conflicted\n+        //    wallet transactions with a null block hash. See\n+        //    https://github.com/bitcoin/bitcoin/pull/18600#discussion_r420195993.\n+        // 2. For most of these transactions, wallet internal conflict detection\n+        //    and MarkConflicted logic will subsequently update them with\n+        //    CONFLICTED status anyway.\n+        // 3. Longstanding behavior since the sync implementation in\n+        //    https://github.com/bitcoin/bitcoin/pull/9371 and the prior sync\n+        //    implementation before that was to mark these transactions\n+        //    unconfirmed rather than conflicted.\n+        //\n+        // The wallet's heuristics for distinguishing between conflicted and\n+        // unconfirmed transactions are imperfect, so everything described above\n+        // could be rethought and changed in the future.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r428360339",
      "id" : 428360339,
      "in_reply_to_id" : 427799842,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2MDMzOQ==",
      "original_commit_id" : "90118ec54f6921ed102ef45bb4f4d3a0ac8782b8",
      "original_line" : 1143,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 415777984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428360339",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r428438413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428438413"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/18982#discussion_r427799161\r\n\r\n> Can you explain which one are going to updated with CONFLICTED status and which not, i.e transactions not directly connected to a previous wallet transaction ?\r\n\r\nSure, added more details",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-21T04:28:41Z",
      "diff_hunk" : "@@ -1111,12 +1112,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& ptx) {\n     }\n }\n \n-void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx) {\n+void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\n     LOCK(cs_wallet);\n     auto it = mapWallet.find(ptx->GetHash());\n     if (it != mapWallet.end()) {\n         it->second.fInMempool = false;\n     }\n+    // Handle transactions that were removed from the mempool because they\n+    // conflict with transactions in a newly connected block.\n+    if (reason == MemPoolRemovalReason::CONFLICT) {\n+        // Call SyncNotifications, so external -walletnotify notifications will\n+        // be triggered for these transactions. Set Status::UNCONFIRMED instead\n+        // of Status::CONFLICTED for a few reasons:\n+        //\n+        // 1. The transactionRemovedFromMempool callback does not currently\n+        //    provide the conflicting block's hash and height, and for backwards\n+        //    compatibility reasons it may not be not safe to store conflicted\n+        //    wallet transactions with a null block hash. See\n+        //    https://github.com/bitcoin/bitcoin/pull/18600#discussion_r420195993.\n+        // 2. For most of these transactions, wallet internal conflict detection",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r428438413",
      "id" : 428438413,
      "in_reply_to_id" : 427799161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQzODQxMw==",
      "original_commit_id" : "90118ec54f6921ed102ef45bb4f4d3a0ac8782b8",
      "original_line" : 1133,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 415777984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428438413",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "(requested @jonatack as reviewer to help with documentation, since a lot is added here, and it'd be good to know if it makes sense to someone not in the weeds of transaction state tracking)",
      "created_at" : "2020-05-21T11:53:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#issuecomment-632045253",
      "id" : 632045253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18982",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjA0NTI1Mw==",
      "updated_at" : "2020-05-21T11:55:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632045253",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429295636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429295636"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: remove EOL comma, otherwise some people following the link may end up here :)\r\n\r\n![Screenshot from 2020-05-22 16-50-24](https://user-images.githubusercontent.com/2415484/82680590-05f2f200-9c3c-11ea-81f8-fd2438d3a832.jpg)\r\n",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-22T14:54:23Z",
      "diff_hunk" : "@@ -1111,12 +1112,42 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& ptx) {\n     }\n }\n \n-void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx) {\n+void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\n     LOCK(cs_wallet);\n     auto it = mapWallet.find(ptx->GetHash());\n     if (it != mapWallet.end()) {\n         it->second.fInMempool = false;\n     }\n+    // Handle transactions that were removed from the mempool because they\n+    // conflict with transactions in a newly connected block.\n+    if (reason == MemPoolRemovalReason::CONFLICT) {\n+        // Call SyncNotifications, so external -walletnotify notifications will\n+        // be triggered for these transactions. Set Status::UNCONFIRMED instead\n+        // of Status::CONFLICTED for a few reasons:\n+        //\n+        // 1. The transactionRemovedFromMempool callback does not currently\n+        //    provide the conflicting block's hash and height, and for backwards\n+        //    compatibility reasons it may not be not safe to store conflicted\n+        //    wallet transactions with a null block hash. See\n+        //    https://github.com/bitcoin/bitcoin/pull/18600#discussion_r420195993.\n+        // 2. For most of these transactions, the wallet's internal conflict\n+        //    detection in the blockConnected handler will subsequently call\n+        //    MarkConflicted and update them with CONFLICTED status anyway. This\n+        //    applies to any wallet transaction that has inputs spent in the\n+        //    block, or that has ancestors in the wallet with inputs spent by\n+        //    the block.\n+        // 3. Longstanding behavior since the sync implementation in\n+        //    https://github.com/bitcoin/bitcoin/pull/9371 and the prior sync\n+        //    implementation before that was to mark these transactions\n+        //    unconfirmed rather than conflicted.\n+        //\n+        // Nothing described above should be seen as an unchangeable requirement\n+        // when improving this code in the future. The wallet's heuristics for\n+        // distinguishing between conflicted and unconfirmed transactions are\n+        // imperfect, and could be improved in general, see\n+        // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429295636",
      "id" : 429295636,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI5NTYzNg==",
      "original_commit_id" : "8242b093d3db52b7e443d650bafd307a03527639",
      "original_line" : 1148,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 416974841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429295636",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429309505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429309505"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: is `ptx` a pointer?\r\n```diff\r\n-const CTransactionRef &ptx\r\n+const CTransactionRef& tx\r\n```\r\n",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-22T15:19:57Z",
      "diff_hunk" : "@@ -208,9 +208,9 @@ void CMainSignals::TransactionAddedToMempool(const CTransactionRef &ptx) {\n                           ptx->GetWitnessHash().ToString());\n }\n \n-void CMainSignals::TransactionRemovedFromMempool(const CTransactionRef &ptx) {\n-    auto event = [ptx, this] {\n-        m_internals->Iterate([&](CValidationInterface& callbacks) { callbacks.TransactionRemovedFromMempool(ptx); });\n+void CMainSignals::TransactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429309505",
      "id" : 429309505,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwOTUwNQ==",
      "original_commit_id" : "8242b093d3db52b7e443d650bafd307a03527639",
      "original_line" : 211,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validationinterface.cpp",
      "position" : null,
      "pull_request_review_id" : 416974841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429309505",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429317905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429317905"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: suggested nicety while touching this code, at lines 1106 and 1178:\r\n```diff\r\n- CWalletTx::Confirmation confirm(CWalletTx::Status::UNCONFIRMED, /* block_height */ 0, {}, /* nIndex */ 0);\r\n+ CWalletTx::Confirmation confirm(CWalletTx::Status::UNCONFIRMED, /* block_height */ 0, /* hashBlock= */ {}, /* nIndex */ 0);\r\n```\r\n",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-22T15:36:07Z",
      "diff_hunk" : "@@ -1129,7 +1160,7 @@ void CWallet::blockConnected(const CBlock& block, int height)\n     for (size_t index = 0; index < block.vtx.size(); index++) {\n         CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, height, block_hash, index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429317905",
      "id" : 429317905,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxNzkwNQ==",
      "original_commit_id" : "8242b093d3db52b7e443d650bafd307a03527639",
      "original_line" : 1161,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 416974841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429317905",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also, AFAICT the added documentation in this PR coherently describes what the code is doing.",
      "created_at" : "2020-05-22T16:25:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#issuecomment-632782318",
      "id" : 632782318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18982",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjc4MjMxOA==",
      "updated_at" : "2020-05-22T16:25:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632782318",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429429300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429429300"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429309505\r\n\r\n> nit: is `ptx` a pointer?\r\n> \r\n> ```diff\r\n> -const CTransactionRef &ptx\r\n> +const CTransactionRef& tx\r\n> ```\r\n\r\nThanks, changed. It is a pointer (shared_ptr), as well: https://github.com/bitcoin/bitcoin/blob/b5c423c48e094bd098e11c3d1f57acae7502a4da/src/primitives/transaction.h#L387",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-22T19:53:52Z",
      "diff_hunk" : "@@ -208,9 +208,9 @@ void CMainSignals::TransactionAddedToMempool(const CTransactionRef &ptx) {\n                           ptx->GetWitnessHash().ToString());\n }\n \n-void CMainSignals::TransactionRemovedFromMempool(const CTransactionRef &ptx) {\n-    auto event = [ptx, this] {\n-        m_internals->Iterate([&](CValidationInterface& callbacks) { callbacks.TransactionRemovedFromMempool(ptx); });\n+void CMainSignals::TransactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429429300",
      "id" : 429429300,
      "in_reply_to_id" : 429309505,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyOTMwMA==",
      "original_commit_id" : "8242b093d3db52b7e443d650bafd307a03527639",
      "original_line" : 211,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validationinterface.cpp",
      "position" : null,
      "pull_request_review_id" : 417154436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:48:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429429300",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429429319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429429319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429295636\r\n\r\n> nit: remove EOL comma, otherwise some people following the link may end up here :)\r\n\r\nThanks! Removed",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-22T19:54:00Z",
      "diff_hunk" : "@@ -1111,12 +1112,42 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& ptx) {\n     }\n }\n \n-void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx) {\n+void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\n     LOCK(cs_wallet);\n     auto it = mapWallet.find(ptx->GetHash());\n     if (it != mapWallet.end()) {\n         it->second.fInMempool = false;\n     }\n+    // Handle transactions that were removed from the mempool because they\n+    // conflict with transactions in a newly connected block.\n+    if (reason == MemPoolRemovalReason::CONFLICT) {\n+        // Call SyncNotifications, so external -walletnotify notifications will\n+        // be triggered for these transactions. Set Status::UNCONFIRMED instead\n+        // of Status::CONFLICTED for a few reasons:\n+        //\n+        // 1. The transactionRemovedFromMempool callback does not currently\n+        //    provide the conflicting block's hash and height, and for backwards\n+        //    compatibility reasons it may not be not safe to store conflicted\n+        //    wallet transactions with a null block hash. See\n+        //    https://github.com/bitcoin/bitcoin/pull/18600#discussion_r420195993.\n+        // 2. For most of these transactions, the wallet's internal conflict\n+        //    detection in the blockConnected handler will subsequently call\n+        //    MarkConflicted and update them with CONFLICTED status anyway. This\n+        //    applies to any wallet transaction that has inputs spent in the\n+        //    block, or that has ancestors in the wallet with inputs spent by\n+        //    the block.\n+        // 3. Longstanding behavior since the sync implementation in\n+        //    https://github.com/bitcoin/bitcoin/pull/9371 and the prior sync\n+        //    implementation before that was to mark these transactions\n+        //    unconfirmed rather than conflicted.\n+        //\n+        // Nothing described above should be seen as an unchangeable requirement\n+        // when improving this code in the future. The wallet's heuristics for\n+        // distinguishing between conflicted and unconfirmed transactions are\n+        // imperfect, and could be improved in general, see\n+        // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429429319",
      "id" : 429429319,
      "in_reply_to_id" : 429295636,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyOTMxOQ==",
      "original_commit_id" : "8242b093d3db52b7e443d650bafd307a03527639",
      "original_line" : 1148,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 417154436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:48:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429429319",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429429367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429429367"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429317905\r\n\r\n> nit: suggested nicety while touching this code, at lines 1106 and 1178:\r\n> \r\n> ```diff\r\n> - CWalletTx::Confirmation confirm(CWalletTx::Status::UNCONFIRMED, /* block_height */ 0, {}, /* nIndex */ 0);\r\n> + CWalletTx::Confirmation confirm(CWalletTx::Status::UNCONFIRMED, /* block_height */ 0, /* hashBlock= */ {}, /* nIndex */ 0);\r\n> ```\r\n\r\nThanks, changed",
      "commit_id" : "7eaf86d3bfc83f2beb3ef449707d5156853126fb",
      "created_at" : "2020-05-22T19:54:09Z",
      "diff_hunk" : "@@ -1129,7 +1160,7 @@ void CWallet::blockConnected(const CBlock& block, int height)\n     for (size_t index = 0; index < block.vtx.size(); index++) {\n         CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, height, block_hash, index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#discussion_r429429367",
      "id" : 429429367,
      "in_reply_to_id" : 429317905,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyOTM2Nw==",
      "original_commit_id" : "8242b093d3db52b7e443d650bafd307a03527639",
      "original_line" : 1161,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 417154436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18982",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-22T20:48:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429429367",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Re-ACK 7eaf86d3bfc83f \r\n\r\n<details><summary>changes since last review</summary><p>\r\n\r\n```diff\r\n((HEAD detached at origin/pr/18982))$ git diff 8242b09 7eaf86d\r\ndiff --git a/doc/release-notes-18982.md b/doc/release-notes-18982.md\r\nindex ee15a1070b..d1b8528d13 100644\r\n--- a/doc/release-notes-18982.md\r\n+++ b/doc/release-notes-18982.md\r\n@@ -3,6 +3,6 @@ Notification changes\r\n \r\n `-walletnotify` notifications are now sent for wallet transactions that are\r\n removed from the mempool because they conflict with a new block. These\r\n-notifications were sent previously before the v0.19 release, but have been\r\n+notifications were sent previously before the v0.19 release, but had been\r\n broken since that release (bug\r\n [#18325](https://github.com/bitcoin/bitcoin/issues/18325)).\r\ndiff --git a/src/validationinterface.cpp b/src/validationinterface.cpp\r\nindex 22d13704fb..3dfbcc581c 100644\r\n--- a/src/validationinterface.cpp\r\n+++ b/src/validationinterface.cpp\r\n@@ -199,22 +199,22 @@ void CMainSignals::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInd\r\n                           fInitialDownload);\r\n }\r\n \r\n-void CMainSignals::TransactionAddedToMempool(const CTransactionRef &ptx) {\r\n-    auto event = [ptx, this] {\r\n-        m_internals->Iterate([&](CValidationInterface& callbacks) { callbacks.TransactionAddedToMempool(ptx); });\r\n+void CMainSignals::TransactionAddedToMempool(const CTransactionRef& tx) {\r\n+    auto event = [tx, this] {\r\n+        m_internals->Iterate([&](CValidationInterface& callbacks) { callbacks.TransactionAddedToMempool(tx); });\r\n     };\r\n     ENQUEUE_AND_LOG_EVENT(event, \"%s: txid=%s wtxid=%s\", __func__,\r\n-                          ptx->GetHash().ToString(),\r\n-                          ptx->GetWitnessHash().ToString());\r\n+                          tx->GetHash().ToString(),\r\n+                          tx->GetWitnessHash().ToString());\r\n }\r\n \r\n-void CMainSignals::TransactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\r\n-    auto event = [ptx, reason, this] {\r\n-        m_internals->Iterate([&](CValidationInterface& callbacks) { callbacks.TransactionRemovedFromMempool(ptx, reason); });\r\n+void CMainSignals::TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason) {\r\n+    auto event = [tx, reason, this] {\r\n+        m_internals->Iterate([&](CValidationInterface& callbacks) { callbacks.TransactionRemovedFromMempool(tx, reason); });\r\n     };\r\n     ENQUEUE_AND_LOG_EVENT(event, \"%s: txid=%s wtxid=%s\", __func__,\r\n-                          ptx->GetHash().ToString(),\r\n-                          ptx->GetWitnessHash().ToString());\r\n+                          tx->GetHash().ToString(),\r\n+                          tx->GetWitnessHash().ToString());\r\n }\r\n \r\n void CMainSignals::BlockConnected(const std::shared_ptr<const CBlock> &pblock, const CBlockIndex *pindex) {\r\ndiff --git a/src/validationinterface.h b/src/validationinterface.h\r\nindex b35f01c4bb..e96f2883fc 100644\r\n--- a/src/validationinterface.h\r\n+++ b/src/validationinterface.h\r\n@@ -97,7 +97,7 @@ protected:\r\n      *\r\n      * Called on a background thread.\r\n      */\r\n-    virtual void TransactionAddedToMempool(const CTransactionRef &ptxn) {}\r\n+    virtual void TransactionAddedToMempool(const CTransactionRef& tx) {}\r\n     /**\r\n      * Notifies listeners of a transaction leaving mempool.\r\n      *\r\n@@ -130,7 +130,7 @@ protected:\r\n      *\r\n      * Called on a background thread.\r\n      */\r\n-    virtual void TransactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {}\r\n+    virtual void TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason) {}\r\n     /**\r\n      * Notifies listeners of a block being connected.\r\n      * Provides a vector of transactions evicted from the mempool as a result.\r\n@@ -197,8 +197,8 @@ public:\r\n \r\n \r\n     void UpdatedBlockTip(const CBlockIndex *, const CBlockIndex *, bool fInitialDownload);\r\n-    void TransactionAddedToMempool(const CTransactionRef &);\r\n-    void TransactionRemovedFromMempool(const CTransactionRef &, MemPoolRemovalReason);\r\n+    void TransactionAddedToMempool(const CTransactionRef&);\r\n+    void TransactionRemovedFromMempool(const CTransactionRef&, MemPoolRemovalReason);\r\n     void BlockConnected(const std::shared_ptr<const CBlock> &, const CBlockIndex *pindex);\r\n     void BlockDisconnected(const std::shared_ptr<const CBlock> &, const CBlockIndex* pindex);\r\n     void ChainStateFlushed(const CBlockLocator &);\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 88a9e62259..862eb9b77f 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -1101,20 +1101,19 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, CWalletTx::Confirmatio\r\n     MarkInputsDirty(ptx);\r\n }\r\n \r\n-void CWallet::transactionAddedToMempool(const CTransactionRef& ptx) {\r\n+void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\r\n     LOCK(cs_wallet);\r\n-    CWalletTx::Confirmation confirm(CWalletTx::Status::UNCONFIRMED, /* block_height */ 0, {}, /* nIndex */ 0);\r\n-    SyncTransaction(ptx, confirm);\r\n+    SyncTransaction(tx, {CWalletTx::Status::UNCONFIRMED, /* block height */ 0, /* block hash */ {}, /* index */ 0});\r\n \r\n-    auto it = mapWallet.find(ptx->GetHash());\r\n+    auto it = mapWallet.find(tx->GetHash());\r\n     if (it != mapWallet.end()) {\r\n         it->second.fInMempool = true;\r\n     }\r\n }\r\n \r\n-void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) {\r\n+void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason) {\r\n     LOCK(cs_wallet);\r\n-    auto it = mapWallet.find(ptx->GetHash());\r\n+    auto it = mapWallet.find(tx->GetHash());\r\n     if (it != mapWallet.end()) {\r\n         it->second.fInMempool = false;\r\n     }\r\n@@ -1145,8 +1144,8 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolR\r\n         // when improving this code in the future. The wallet's heuristics for\r\n         // distinguishing between conflicted and unconfirmed transactions are\r\n         // imperfect, and could be improved in general, see\r\n-        // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking,\r\n-        SyncTransaction(ptx, {CWalletTx::Status::UNCONFIRMED, /* block_height= */ 0, /* hashBlock= */ {}, /* nIndex= */ 0});\r\n+        // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\r\n+        SyncTransaction(tx, {CWalletTx::Status::UNCONFIRMED, /* block height */ 0, /* block hash */ {}, /* index */ 0});\r\n     }\r\n }\r\n \r\n@@ -1158,8 +1157,7 @@ void CWallet::blockConnected(const CBlock& block, int height)\r\n     m_last_block_processed_height = height;\r\n     m_last_block_processed = block_hash;\r\n     for (size_t index = 0; index < block.vtx.size(); index++) {\r\n-        CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, height, block_hash, index);\r\n-        SyncTransaction(block.vtx[index], confirm);\r\n+        SyncTransaction(block.vtx[index], {CWalletTx::Status::CONFIRMED, height, block_hash, (int)index});\r\n         transactionRemovedFromMempool(block.vtx[index], MemPoolRemovalReason::BLOCK);\r\n     }\r\n }\r\n@@ -1175,8 +1173,7 @@ void CWallet::blockDisconnected(const CBlock& block, int height)\r\n     m_last_block_processed_height = height - 1;\r\n     m_last_block_processed = block.hashPrevBlock;\r\n     for (const CTransactionRef& ptx : block.vtx) {\r\n-        CWalletTx::Confirmation confirm(CWalletTx::Status::UNCONFIRMED, /* block_height */ 0, {}, /* nIndex */ 0);\r\n-        SyncTransaction(ptx, confirm);\r\n+        SyncTransaction(ptx, {CWalletTx::Status::UNCONFIRMED, /* block height */ 0, /* block hash */ {}, /* index */ 0});\r\n     }\r\n }\r\n \r\n@@ -1716,8 +1713,7 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\r\n                 break;\r\n             }\r\n             for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\r\n-                CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, block_height, block_hash, posInBlock);\r\n-                SyncTransaction(block.vtx[posInBlock], confirm, fUpdate);\r\n+                SyncTransaction(block.vtx[posInBlock], {CWalletTx::Status::CONFIRMED, block_height, block_hash, (int)posInBlock}, fUpdate);\r\n             }\r\n             // scan succeeded, record block as most recent successfully scanned\r\n             result.last_scanned_block = block_hash;\r\ndiff --git a/src/wallet/wallet.h b/src/wallet/wallet.h\r\nindex 7d605beb78..350d731b83 100644\r\n--- a/src/wallet/wallet.h\r\n+++ b/src/wallet/wallet.h\r\n@@ -923,7 +923,7 @@ public:\r\n         uint256 last_failed_block;\r\n     };\r\n     ScanResult ScanForWalletTransactions(const uint256& start_block, int start_height, Optional<int> max_height, const WalletRescanReserver& reserver, bool fUpdate);\r\n-    void transactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolRemovalReason reason) override;\r\n+    void transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason) override;\r\n     void ReacceptWalletTransactions() EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\r\n```\r\n</p></details>\r\n\r\nReviewed changes, built, ran tests and bitcoind. Thanks, Russ.",
      "created_at" : "2020-05-24T12:13:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#issuecomment-633222090",
      "id" : 633222090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18982",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzIyMjA5MA==",
      "updated_at" : "2020-05-24T12:15:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633222090",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 7eaf86d, reviewed, built and ran tests.\r\n\r\nThanks for stretching my fix to the minimal required !",
      "created_at" : "2020-05-24T23:49:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#issuecomment-633318233",
      "id" : 633318233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18982",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzMxODIzMw==",
      "updated_at" : "2020-05-24T23:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633318233",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Side-note: For backport only the first commit is required\r\n\r\n\r\n\r\nACK 7eaf86d3bfc83f2beb3ef449707d5156853126fb \r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nACK 7eaf86d3bfc83f2beb3ef449707d5156853126fb \r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUgdEgwAmst0UkNcIHGyE+2chyXer0u8xtpS5iFBAbP0JmCdo/ey/SOl7fKQZwkR\r\nCuUvaVT5MK7gCpjTDOgBAME7auWgNIMdckCAvCktHwAzfklsDKfdl9MTyq6RSgWH\r\nunE6zZ6PN7gY/DwgHyOtFh+UtYyfs3TGvuQE2IWLz9gTqUXzvAKnFvmjLLbfjWpT\r\nNmLvh5m2e8LAw4iT/L7Qchjc4ZSkXWx1Eo8RejGcVF+gItKozUG5JL6FFXKEm70A\r\nbpQpqze2gt9qvk+rvEHyeCU43kF5ON7afuh4FfP1tumJjGxuJSJUm7+rWgq3oM5G\r\nru6niN3NK57OEcRevDumkraG7EIMrjVgG4L6r9SsPDzTd3jEYnCjrPwGrm/zokS9\r\nWgRizfSxXoqkGt+4qiuJkkC0iXtvzhcbIk1N/MAQwnRMj+NJ/I7BXG/L9MYf6G82\r\nsJpNFq0i5Ww+W0V0MBIxgWm/ONkmp9GIeZ9+zo+ggHnB1LDIZTCtWJjtiVqbRrC1\r\nB4KFoTs1\r\n=CPHq\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `7bc81c048dd3a3d462e02deb3c82e3c23ceb049acdcd359e6b7b9b2440608e3b  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401087bc81c048dd3a3d462e02deb3c82e3c23ceb049acdcd359e6b7b9b2440608e3bf01004fcdc0cd271914e795c2858a6c0f43b08fff010172cf3b7e62cf252328a428aaaa48c5708f1045ed6ce46f008a4c8f79975e950ad0083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff010297c6d02f73b47fc7b4c5a97a2d2123808f1045ed6ce46f00845ca0e8e8c53e9990083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff0105f727fc5f3fd18564892dc2a870403fc08f1045ed6ce47f008037ddce9ba99f7820083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6df010e63f8777ce1f6488cd0169b5caa6cd8008f1045ed6ce46f0084466a8e61fb1179f0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2020-06-02T22:11:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18982#issuecomment-637832918",
      "id" : 637832918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18982",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzgzMjkxOA==",
      "updated_at" : "2020-06-02T22:11:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637832918",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
