{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Currently we bucket peers (or potential peers)  based on /16 network groups  which directly correlate to the IP-addresses. This is done to diversify connections every node maintains, for example to avoid connecting to the nodes all belonging to the same region/provider.\r\n\r\nCurrently peers.dat (serialized version of addrman) does not store ip->bucket mappings explicitly, and all the known ips from peers.dat are re-hashed and re-bucketed at every restart (although it's very cheap).\r\n\r\n## Idea\r\n\r\nIt was [recently](http://www.erisian.com.au/bitcoin-core-dev/log-2019-06-20.html) suggested by @TheBlueMatt to use ASN-based bucketing instead. This is strictly better because if the goal is to diversify connections: the distribution of IPs among the ASNs is not uniform, and because of that netgroup-based bucketing may result in having 8 peers from just 2 large ASNs. \r\nIf we allow connecting to each ASN at most once, this would increase the security of the network.\r\n\r\nWe have @sipa's script to create a compressed representation of mapping (ip->ASN), which is less than 2 megabytes.\r\n\r\nHowever, there are integration-related design questions.\r\n\r\n### Distribution of the .map file\r\n\r\nDuring the meeting there was a rough consensus (not unanimous though, @jnewbery ) that mapping file should be distributed along with the release, instead of becoming part of the binary. \r\n\r\nIf you want to question these, feel free to comment below.\r\n\r\n### Legacy /16 bucketing\r\nThere was a suggestion of having an old method as well. I think we should do it.\r\n\r\n### ~Loading the map~\r\nMaybe there will be concerns here, I have an understanding for now.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16599/comments",
   "created_at" : "2019-08-13T20:29:21Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16599/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/16599",
   "id" : 480353224,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16599/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU0ODAzNTMyMjQ=",
   "number" : 16599,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "ASN-based bucketing of the network nodes",
   "updated_at" : "2019-08-15T19:46:20Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16599",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
      "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
      "followers_url" : "https://api.github.com/users/naumenkogs/followers",
      "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/naumenkogs",
      "id" : 7975071,
      "login" : "naumenkogs",
      "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
      "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
      "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
      "repos_url" : "https://api.github.com/users/naumenkogs/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/naumenkogs"
   }
}
