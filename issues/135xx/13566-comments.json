[
   {
      "author_association" : "MEMBER",
      "body" : "Feedback to address from @ryanofsky\r\n\r\nSome thoughts looking at code:\r\n\r\n- It seems like it would be good to raise an error if `IsDeprecatedRPCEnabled(\"accounts\")` and the account argument is not null or \"*\". Otherwise the argument would be silently ignored.\r\n- Documentation seems to say default minconf is 1, while implementation uses 0 or 1.\r\n- Maybe could dedup caching code in `GetAvailableCredit` a little with something like\r\n\r\n```\r\nCAmount* cache = filter == ISMINE_SPENDABLE  ? nAvailableCreditCached : \r\n                 filter == ISMINE_WATCH_ONLY ? nAvailableWatchCreditCached :\r\n                 nullptr;\r\n```",
      "created_at" : "2018-06-28T19:06:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401140985",
      "id" : 401140985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTE0MDk4NQ==",
      "updated_at" : "2018-06-28T19:06:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401140985",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I guess that would not work for min dept of 0 (unconfirmed).\r\n\r\nAre you saying that we also need to check `pcoin->InMempool()` for coins with 0 depth?",
      "created_at" : "2018-06-28T21:00:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401171720",
      "id" : 401171720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTE3MTcyMA==",
      "updated_at" : "2018-06-28T21:00:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401171720",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I believe that I've addressed all of @ryanofsky's feedback. Russ - can you rereview and confirm?\r\n\r\nNeed to address @jonasschnelli's comment. Jonas - can you please confirm my question above? Thanks!",
      "created_at" : "2018-06-28T21:59:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401186338",
      "id" : 401186338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTE4NjMzOA==",
      "updated_at" : "2018-06-28T21:59:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401186338",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199161775"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[RPC] [wallet] allow getbalance to use min_conf and watch_only\"\r\n\r\nI think the safest thing here would be to raise an error whenever accounts are deprecated and account is non-null, because previously `getbalance(null)`, `getbalance(\"*\")`, and `getbalance(\"\")` each did different things, and it doesn't seem good to silently ignore a requested behavior. Another slightly less safe but maybe acceptable option would be to change `\"\"` to `\"*\"` on this line, since `getbalance(\"*\")` and `getbalance(null)` at least were more similar than `getbalance(\"*\")` and `getbalance(\"\")`\r\n\r\nPreviously, and currently with the deprecated accounts feature enabled:\r\n\r\n- `getbalance(null)` would return total balance\r\n- `getbalance(\"*\")` would return total balance with legacy accounting method\r\n- `getbalance(\"account\")` would return balance associated with a named account\r\n- `getbalance(\"\")` would return leftover balance not associated with any named accounts",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T13:39:45Z",
      "diff_hunk" : "@@ -895,38 +905,35 @@ static UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (IsDeprecatedRPCEnabled(\"accounts\")) {\n-        const UniValue& account_value = request.params[0];\n-        const UniValue& minconf = request.params[1];\n-        const UniValue& include_watchonly = request.params[2];\n+    const UniValue& account_value = request.params[0];\n \n-        if (account_value.isNull()) {\n-            if (!minconf.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance minconf option is only currently supported if an account is specified\");\n-            }\n-            if (!include_watchonly.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance include_watchonly option is only currently supported if an account is specified\");\n-            }\n-            return ValueFromAmount(pwallet->GetBalance());\n-        }\n+    int min_depth = 0;\n+    if (IsDeprecatedRPCEnabled(\"accounts\") && !account_value.isNull()) {\n+        // Default min_depth to 1 when an account is provided.\n+        min_depth = 1;\n+    }\n+    if (!request.params[1].isNull()) {\n+        min_depth = request.params[1].get_int();\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (!request.params[2].isNull() && request.params[2].get_bool()) {\n+        filter = filter | ISMINE_WATCH_ONLY;\n+    }\n+\n+    if (!account_value.isNull()) {\n \n         const std::string& account_param = account_value.get_str();\n         const std::string* account = account_param != \"*\" ? &account_param : nullptr;\n \n-        int nMinDepth = 1;\n-        if (!minconf.isNull())\n-            nMinDepth = minconf.get_int();\n-        isminefilter filter = ISMINE_SPENDABLE;\n-        if(!include_watchonly.isNull())\n-            if(include_watchonly.get_bool())\n-                filter = filter | ISMINE_WATCH_ONLY;\n-\n-        return ValueFromAmount(pwallet->GetLegacyBalance(filter, nMinDepth, account));\n+        if (!IsDeprecatedRPCEnabled(\"accounts\") && *account != \"\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775",
      "id" : 199161775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTE2MTc3NQ==",
      "original_commit_id" : "c57f2009f65ffedc7531644243d5d7ddd786edde",
      "original_position" : 80,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 133229591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T19:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199161775",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199175544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199175544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775\r\n\r\nAlso want to note that another approach we could take here would not be to deprecate the `account` argument at all, but instead just rename it to `label` and pass it down as an option to the GetBalance() and GetAvailableCredit methods where it could be used to filter txouts there by address label. This would be a simple code change, just adding `if (!label || *label == GetLabelName(txout.scriptPubKey))`.",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T14:23:03Z",
      "diff_hunk" : "@@ -895,38 +905,35 @@ static UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (IsDeprecatedRPCEnabled(\"accounts\")) {\n-        const UniValue& account_value = request.params[0];\n-        const UniValue& minconf = request.params[1];\n-        const UniValue& include_watchonly = request.params[2];\n+    const UniValue& account_value = request.params[0];\n \n-        if (account_value.isNull()) {\n-            if (!minconf.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance minconf option is only currently supported if an account is specified\");\n-            }\n-            if (!include_watchonly.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance include_watchonly option is only currently supported if an account is specified\");\n-            }\n-            return ValueFromAmount(pwallet->GetBalance());\n-        }\n+    int min_depth = 0;\n+    if (IsDeprecatedRPCEnabled(\"accounts\") && !account_value.isNull()) {\n+        // Default min_depth to 1 when an account is provided.\n+        min_depth = 1;\n+    }\n+    if (!request.params[1].isNull()) {\n+        min_depth = request.params[1].get_int();\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (!request.params[2].isNull() && request.params[2].get_bool()) {\n+        filter = filter | ISMINE_WATCH_ONLY;\n+    }\n+\n+    if (!account_value.isNull()) {\n \n         const std::string& account_param = account_value.get_str();\n         const std::string* account = account_param != \"*\" ? &account_param : nullptr;\n \n-        int nMinDepth = 1;\n-        if (!minconf.isNull())\n-            nMinDepth = minconf.get_int();\n-        isminefilter filter = ISMINE_SPENDABLE;\n-        if(!include_watchonly.isNull())\n-            if(include_watchonly.get_bool())\n-                filter = filter | ISMINE_WATCH_ONLY;\n-\n-        return ValueFromAmount(pwallet->GetLegacyBalance(filter, nMinDepth, account));\n+        if (!IsDeprecatedRPCEnabled(\"accounts\") && *account != \"\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199175544",
      "id" : 199175544,
      "in_reply_to_id" : 199161775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTE3NTU0NA==",
      "original_commit_id" : "c57f2009f65ffedc7531644243d5d7ddd786edde",
      "original_position" : 80,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 133246916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T19:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199175544",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @ryanofsky . Updated to treat `*` as an acceptable dummy argument.\r\n\r\nI don't think we want to entirely remove the possibility of calling this method with positional arguments.",
      "created_at" : "2018-06-29T14:25:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401370490",
      "id" : 401370490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTM3MDQ5MA==",
      "updated_at" : "2018-06-29T14:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401370490",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @ryanofsky !",
      "created_at" : "2018-06-29T15:48:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401395313",
      "id" : 401395313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTM5NTMxMw==",
      "updated_at" : "2018-06-29T15:48:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401395313",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This calls for a test, no?",
      "created_at" : "2018-06-29T16:44:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401410116",
      "id" : 401410116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTQxMDExNg==",
      "updated_at" : "2018-06-29T16:44:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401410116",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Empact - test added. Review plz :slightly_smiling_face: ",
      "created_at" : "2018-06-29T19:55:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401457799",
      "id" : 401457799,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTQ1Nzc5OQ==",
      "updated_at" : "2018-06-29T19:55:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401457799",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199270410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199270410"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: comment bool arg?",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T20:19:05Z",
      "diff_hunk" : "@@ -2224,7 +2194,7 @@ CAmount CWallet::GetUnconfirmedWatchOnlyBalance() const\n         {\n             const CWalletTx* pcoin = &entry.second;\n             if (!pcoin->IsTrusted() && pcoin->GetDepthInMainChain() == 0 && pcoin->InMempool())\n-                nTotal += pcoin->GetAvailableWatchOnlyCredit();\n+                nTotal += pcoin->GetAvailableCredit(true, ISMINE_WATCH_ONLY);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199270410",
      "id" : 199270410,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTI3MDQxMA==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 137,
      "path" : "src/wallet/wallet.cpp",
      "position" : 137,
      "pull_request_review_id" : 133365393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T20:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199270410",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Should `CWallet::GetUnconfirmedBalance` use the cache?",
      "created_at" : "2018-06-29T20:24:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401464423",
      "id" : 401464423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTQ2NDQyMw==",
      "updated_at" : "2018-06-29T20:24:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401464423",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199272826"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199272826"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could move this into a `fUseCache` block, connected with 1991 below.",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T20:30:22Z",
      "diff_hunk" : "@@ -1977,8 +1977,20 @@ CAmount CWalletTx::GetAvailableCredit(bool fUseCache) const\n     if (IsCoinBase() && GetBlocksToMaturity() > 0)\n         return 0;\n \n-    if (fUseCache && fAvailableCreditCached)\n-        return nAvailableCreditCached;\n+    CAmount* cache = nullptr;\n+    bool* cache_used = nullptr;\n+\n+    if (filter == ISMINE_SPENDABLE) {\n+        cache = &nAvailableCreditCached;\n+        cache_used = &fAvailableCreditCached;\n+    } else if (filter == ISMINE_WATCH_ONLY) {\n+        cache = &nAvailableWatchCreditCached;\n+        cache_used = &fAvailableWatchCreditCached;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199272826",
      "id" : 199272826,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTI3MjgyNg==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 24,
      "path" : "src/wallet/wallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 133368558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T20:30:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199272826",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199273845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199273845"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `|=`",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T20:34:52Z",
      "diff_hunk" : "@@ -895,38 +905,35 @@ static UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (IsDeprecatedRPCEnabled(\"accounts\")) {\n-        const UniValue& account_value = request.params[0];\n-        const UniValue& minconf = request.params[1];\n-        const UniValue& include_watchonly = request.params[2];\n+    const UniValue& account_value = request.params[0];\n \n-        if (account_value.isNull()) {\n-            if (!minconf.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance minconf option is only currently supported if an account is specified\");\n-            }\n-            if (!include_watchonly.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance include_watchonly option is only currently supported if an account is specified\");\n-            }\n-            return ValueFromAmount(pwallet->GetBalance());\n-        }\n+    int min_depth = 0;\n+    if (IsDeprecatedRPCEnabled(\"accounts\") && !account_value.isNull()) {\n+        // Default min_depth to 1 when an account is provided.\n+        min_depth = 1;\n+    }\n+    if (!request.params[1].isNull()) {\n+        min_depth = request.params[1].get_int();\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (!request.params[2].isNull() && request.params[2].get_bool()) {\n+        filter = filter | ISMINE_WATCH_ONLY;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199273845",
      "id" : 199273845,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTI3Mzg0NQ==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 63,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 63,
      "pull_request_review_id" : 133369833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T20:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199273845",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199274395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199274395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe show `*` here instead of dummy?",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T20:37:38Z",
      "diff_hunk" : "@@ -4416,7 +4423,7 @@ static const CRPCCommand commands[] =\n     { \"wallet\",             \"dumpwallet\",                       &dumpwallet,                    {\"filename\"} },\n     { \"wallet\",             \"encryptwallet\",                    &encryptwallet,                 {\"passphrase\"} },\n     { \"wallet\",             \"getaddressinfo\",                   &getaddressinfo,                {\"address\"} },\n-    { \"wallet\",             \"getbalance\",                       &getbalance,                    {\"account\",\"minconf\",\"include_watchonly\"} },\n+    { \"wallet\",             \"getbalance\",                       &getbalance,                    {\"account|dummy\",\"minconf\",\"include_watchonly\"} },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199274395",
      "id" : 199274395,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTI3NDM5NQ==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 97,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 97,
      "pull_request_review_id" : 133370549,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T20:37:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199274395",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199275856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199275856"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: whitespace",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T20:44:50Z",
      "diff_hunk" : "@@ -895,38 +905,35 @@ static UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (IsDeprecatedRPCEnabled(\"accounts\")) {\n-        const UniValue& account_value = request.params[0];\n-        const UniValue& minconf = request.params[1];\n-        const UniValue& include_watchonly = request.params[2];\n+    const UniValue& account_value = request.params[0];\n \n-        if (account_value.isNull()) {\n-            if (!minconf.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance minconf option is only currently supported if an account is specified\");\n-            }\n-            if (!include_watchonly.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance include_watchonly option is only currently supported if an account is specified\");\n-            }\n-            return ValueFromAmount(pwallet->GetBalance());\n-        }\n+    int min_depth = 0;\n+    if (IsDeprecatedRPCEnabled(\"accounts\") && !account_value.isNull()) {\n+        // Default min_depth to 1 when an account is provided.\n+        min_depth = 1;\n+    }\n+    if (!request.params[1].isNull()) {\n+        min_depth = request.params[1].get_int();\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (!request.params[2].isNull() && request.params[2].get_bool()) {\n+        filter = filter | ISMINE_WATCH_ONLY;\n+    }\n+\n+    if (!account_value.isNull()) {\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199275856",
      "id" : 199275856,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTI3NTg1Ng==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 67,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 67,
      "pull_request_review_id" : 133372379,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T20:44:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199275856",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199276069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199276069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: whitespace",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-06-29T20:45:53Z",
      "diff_hunk" : "@@ -853,8 +853,9 @@ static UniValue getbalance(const JSONRPCRequest& request)\n         return NullUniValue;\n     }\n \n-    if (request.fHelp || (request.params.size() > 3 && IsDeprecatedRPCEnabled(\"accounts\")) || (request.params.size() != 0 && !IsDeprecatedRPCEnabled(\"accounts\")))\n+    if (request.fHelp || (request.params.size() > 3 ))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199276069",
      "id" : 199276069,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTI3NjA2OQ==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 5,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 133372664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T20:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199276069",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 702ae1e",
      "created_at" : "2018-06-29T20:54:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401471423",
      "id" : 401471423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTQ3MTQyMw==",
      "updated_at" : "2018-06-29T20:54:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401471423",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #13637 (wallet: Add GetBalances to calculate all balances by promag)\n* #13631 (Add CMerkleTx::IsImmatureCoinBase method by Empact)\n* #13083 (Add compile time checking for cs_main runtime locking assertions by practicalswift)\n* #11634 (wallet: Add missing cs_wallet/cs_KeyStore locks to wallet by practicalswift)\n* #11020 ([wallet] getbalance: Add option to include non-mempool UTXOs by kallewoof)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-06-30T11:36:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401535534",
      "id" : 401535534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTUzNTUzNA==",
      "updated_at" : "2018-07-14T00:25:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401535534",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-07-04T13:06:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-402473757",
      "id" : 402473757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMjQ3Mzc1Nw==",
      "updated_at" : "2018-07-04T13:06:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/402473757",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200208092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200208092"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What if `filter == ISMINE_ALL`  which can be when `include_watchonly=true` in RPC `getbalance`  could sum both if cached?",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-07-04T22:52:37Z",
      "diff_hunk" : "@@ -1977,8 +1977,20 @@ CAmount CWalletTx::GetAvailableCredit(bool fUseCache) const\n     if (IsCoinBase() && GetBlocksToMaturity() > 0)\n         return 0;\n \n-    if (fUseCache && fAvailableCreditCached)\n-        return nAvailableCreditCached;\n+    CAmount* cache = nullptr;\n+    bool* cache_used = nullptr;\n+\n+    if (filter == ISMINE_SPENDABLE) {\n+        cache = &nAvailableCreditCached;\n+        cache_used = &fAvailableCreditCached;\n+    } else if (filter == ISMINE_WATCH_ONLY) {\n+        cache = &nAvailableWatchCreditCached;\n+        cache_used = &fAvailableWatchCreditCached;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200208092",
      "id" : 200208092,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMDIwODA5Mg==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 24,
      "path" : "src/wallet/wallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 134478252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-07-04T23:17:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200208092",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200208757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200208757"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, drop `&`?",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-07-04T23:06:36Z",
      "diff_hunk" : "@@ -460,9 +460,8 @@ class CWalletTx : public CMerkleTx\n     CAmount GetDebit(const isminefilter& filter) const;\n     CAmount GetCredit(const isminefilter& filter) const;\n     CAmount GetImmatureCredit(bool fUseCache=true) const;\n-    CAmount GetAvailableCredit(bool fUseCache=true) const;\n+    CAmount GetAvailableCredit(bool fUseCache=true, const isminefilter& filter=ISMINE_SPENDABLE) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200208757",
      "id" : 200208757,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMDIwODc1Nw==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 134478252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-07-04T23:17:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200208757",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200209060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200209060"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`IsTrusted()` already computes `GetDepthInMainChain()`. Suggestion:\r\n```cpp\r\nbool IsTrusted(int min_depth = 1)\r\n```",
      "commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-07-04T23:12:05Z",
      "diff_hunk" : "@@ -2154,16 +2139,17 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  */\n \n \n-CAmount CWallet::GetBalance() const\n+CAmount CWallet::GetBalance(const isminefilter& filter, const int min_depth) const\n {\n     CAmount nTotal = 0;\n     {\n         LOCK2(cs_main, cs_wallet);\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx* pcoin = &entry.second;\n-            if (pcoin->IsTrusted())\n-                nTotal += pcoin->GetAvailableCredit();\n+            if (pcoin->IsTrusted() && pcoin->GetDepthInMainChain() >= min_depth) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200209060",
      "id" : 200209060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMDIwOTA2MA==",
      "original_commit_id" : "702ae1e21a09d8c31406839c4ea507c5fa276898",
      "original_position" : 103,
      "path" : "src/wallet/wallet.cpp",
      "position" : 103,
      "pull_request_review_id" : 134478252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-07-04T23:17:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200209060",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 702ae1e21a09d8c31406839c4ea507c5fa276898",
      "created_at" : "2018-07-14T01:27:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-404989086",
      "id" : 404989086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNDk4OTA4Ng==",
      "updated_at" : "2018-07-14T01:27:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404989086",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
