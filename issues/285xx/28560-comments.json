[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28560).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#bitcoin-core/gui/733](https://github.com/bitcoin-core/gui/pull/733) (Deniability - a tool to automatically improve coin ownership privacy by denavila)\n* [#29191](https://github.com/bitcoin/bitcoin/pull/29191) (refactor(tidy): Use C++20 contains method by aureleoules)\n* [#28944](https://github.com/bitcoin/bitcoin/pull/28944) (wallet, rpc: add anti-fee-sniping to `send` and `sendall` by ishaanam)\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n* [#27792](https://github.com/bitcoin/bitcoin/pull/27792) (wallet: Deniability API (Unilateral Transaction Meta-Privacy) by denavila)\n* [#27788](https://github.com/bitcoin/bitcoin/pull/27788) (rpc: Be able to access RPC parameters by name by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-10-02T16:50:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1743382033",
      "id" : 1743382033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585n6eYR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743382033/reactions"
      },
      "updated_at" : "2024-01-06T09:13:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743382033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432392999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432392999"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Let's not pass all the options as we need only one of them.",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:19:55Z",
      "diff_hunk" : "@@ -73,6 +73,38 @@ std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& subtrac\n     return set_sffo;\n }\n \n+std::vector<CRecipient> ParseOutputs(const UniValue& outputs_in, const UniValue& options)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432392999",
      "id" : 1432392999,
      "line" : 87,
      "node_id" : "PRRC_kwDOABII585VYJUn",
      "original_commit_id" : "f0af6e9a0f24b2281515345a5686706e88add854",
      "original_line" : 76,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 72,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432392999/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432392999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432396784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432396784"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`has_data` never set to `true`\r\n\r\nAlso no tests fail, so it seems there is no test coverage for that",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:23:49Z",
      "diff_hunk" : "@@ -29,16 +29,27 @@ std::vector<CRecipient> ParseRecipients(const UniValue& address_amounts, const s\n     std::set<CTxDestination> destinations;\n     std::vector<CRecipient> recipients;\n     int idx{0};\n+    bool has_data{false};\n     for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n+        CTxDestination dest;\n+        CAmount amount{0};\n+        if (address == \"data\") {\n+            if (has_data) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432396784",
      "id" : 1432396784,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII585VYKPw",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 37,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 15,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432396784/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432396784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432411126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432411126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not a huge fan of this change. Now if we pass tx.vout they'll be ignored.\r\n\r\nI'd prefer if we pass `txin` and `recipients` and don't pass `tx` at all. That would be a clearer interface in my opinion.",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:38:03Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432411126",
      "id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585VYNv2",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432411126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432411126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432414337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432414337"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same comment as for other `FundTransaction`. I think we should get rid of ambiguity in input parameters and don't pass `tx`. In this case it's even more confusing, because `tx.vout` is actually still checked.",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:41:12Z",
      "diff_hunk" : "@@ -532,17 +543,14 @@ static std::vector<RPCArg> FundTxDoc(bool solving_data = true)\n     return args;\n }\n \n-CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)\n+CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432414337",
      "id" : 1432414337,
      "line" : 546,
      "node_id" : "PRRC_kwDOABII585VYOiB",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 546,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 41,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432414337/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432414337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We are using either `subtract_fee_from_outputs` or `subtractFeeFromOutputs`, depending on which one is present. I think handling that logic in the `ParseOutputs` function is better. Since the options object is passed by reference there isn't any performance difference in passing a reference to the entire options object vs passing a single key.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:20:08Z",
      "diff_hunk" : "@@ -73,6 +73,38 @@ std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& subtrac\n     return set_sffo;\n }\n \n+std::vector<CRecipient> ParseOutputs(const UniValue& outputs_in, const UniValue& options)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851243",
      "id" : 1432851243,
      "in_reply_to_id" : 1432392999,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585VZ5Mr",
      "original_commit_id" : "f0af6e9a0f24b2281515345a5686706e88add854",
      "original_line" : 76,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1791120595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851243/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:20:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch!",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:20:26Z",
      "diff_hunk" : "@@ -29,16 +29,27 @@ std::vector<CRecipient> ParseRecipients(const UniValue& address_amounts, const s\n     std::set<CTxDestination> destinations;\n     std::vector<CRecipient> recipients;\n     int idx{0};\n+    bool has_data{false};\n     for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n+        CTxDestination dest;\n+        CAmount amount{0};\n+        if (address == \"data\") {\n+            if (has_data) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851596",
      "id" : 1432851596,
      "in_reply_to_id" : 1432396784,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585VZ5SM",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 37,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1791121146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851596/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:20:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432869408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432869408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree, see my comment in the description. Ultimately, I think `FundTransaction` should take a set of inputs and a set of outputs and return a `CreatedTransactionResult`. #25273 and this PR get us incrementally closer to that, but I don't want to fully tackle that in this PR as it's a bit more complicated than it seems, and the primary goal of this PR is to create the `CRecipients` objects in a standard way across all the RPC calls and pass them to `FundTransaction`",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:34:11Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432869408",
      "id" : 1432869408,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585VZ9og",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1791157685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432869408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432869408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432881141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432881141"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also a good catch, we should be using the `recipients` vector to get the size here.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:43:46Z",
      "diff_hunk" : "@@ -532,17 +543,14 @@ static std::vector<RPCArg> FundTxDoc(bool solving_data = true)\n     return args;\n }\n \n-CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)\n+CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432881141",
      "id" : 1432881141,
      "in_reply_to_id" : 1432414337,
      "line" : 512,
      "node_id" : "PRRC_kwDOABII585VaAf1",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 512,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 155,
      "pull_request_review_id" : 1791185730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432881141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:43:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432881141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the `has_data` logic and replaced all references to `tx.vout` with `recipients` in `FundTransaction`, per feedback from @S3RK ",
      "created_at" : "2023-12-20T16:06:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1864748743",
      "id" : 1864748743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585vJc7H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864748743/reactions"
      },
      "updated_at" : "2023-12-20T16:06:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864748743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440697948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440697948"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a9d67ad96e5f4d6dca64df4ac85f0434e17248ab \"test: add tests for fundrawtx and sendmany rpcs\"\r\n\r\nnit: More pythonic to write:\r\n\r\n```suggestion\r\n        tx.vout = [CTxOut(1 * COIN, bytearray(address_to_scriptpubkey(address)))] * 2\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-03T17:17:29Z",
      "diff_hunk" : "@@ -147,6 +150,34 @@ def run_test(self):\n         self.test_22670()\n         self.test_feerate_rounding()\n         self.test_input_confs_control()\n+        self.test_duplicate_outputs()\n+\n+    def test_duplicate_outputs(self):\n+        self.log.info(\"Test deserializing and funding a transaction with duplicate outputs\")\n+        self.nodes[1].createwallet(\"fundtx_duplicate_outputs\")\n+        w = self.nodes[1].get_wallet_rpc(\"fundtx_duplicate_outputs\")\n+\n+        addr = w.getnewaddress(address_type=\"bech32\")\n+        self.nodes[0].sendtoaddress(addr, 5)\n+        self.generate(self.nodes[0], 1)\n+\n+        address = self.nodes[0].getnewaddress(\"bech32\")\n+        tx = CTransaction()\n+        tx.vin = []\n+        tx.vout = [CTxOut(1 * COIN, bytearray(address_to_scriptpubkey(address))) for _ in range(2)]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440697948",
      "id" : 1440697948,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII585V305c",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 167,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/wallet_fundrawtransaction.py",
      "position" : 32,
      "pull_request_review_id" : 1802756922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440697948/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T15:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440697948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440702286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440702286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a9d67ad96e5f4d6dca64df4ac85f0434e17248ab \"test: add tests for fundrawtx and sendmany rpcs\"\r\n\r\nThere are existing tests for `sendmany` in wallet_basic.py. I think these tests could be moved there as well.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-03T17:22:42Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the sendmany RPC command.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+class SendmanyTest(BitcoinTestFramework):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440702286",
      "id" : 1440702286,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII585V319O",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/wallet_sendmany.py",
      "position" : 9,
      "pull_request_review_id" : 1802756922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440702286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-03T19:06:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440702286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441785861"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441785861"
         }
      },
      "author_association" : "MEMBER",
      "body" : "noted! will update",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T14:05:19Z",
      "diff_hunk" : "@@ -147,6 +150,34 @@ def run_test(self):\n         self.test_22670()\n         self.test_feerate_rounding()\n         self.test_input_confs_control()\n+        self.test_duplicate_outputs()\n+\n+    def test_duplicate_outputs(self):\n+        self.log.info(\"Test deserializing and funding a transaction with duplicate outputs\")\n+        self.nodes[1].createwallet(\"fundtx_duplicate_outputs\")\n+        w = self.nodes[1].get_wallet_rpc(\"fundtx_duplicate_outputs\")\n+\n+        addr = w.getnewaddress(address_type=\"bech32\")\n+        self.nodes[0].sendtoaddress(addr, 5)\n+        self.generate(self.nodes[0], 1)\n+\n+        address = self.nodes[0].getnewaddress(\"bech32\")\n+        tx = CTransaction()\n+        tx.vin = []\n+        tx.vout = [CTxOut(1 * COIN, bytearray(address_to_scriptpubkey(address))) for _ in range(2)]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441785861",
      "id" : 1441785861,
      "in_reply_to_id" : 1440697948,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII585V7-gF",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 167,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/wallet_fundrawtransaction.py",
      "position" : 32,
      "pull_request_review_id" : 1804219375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441785861/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T14:05:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441785861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441789986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441789986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I initially started putting these tests in `wallet_basic.py`, but I'd prefer if we have RPC-specific test files and move all of the `sendmany` specific tests into the new `wallet_sendmany.py` file in a follow-up PR.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T14:09:15Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the sendmany RPC command.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+class SendmanyTest(BitcoinTestFramework):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441789986",
      "id" : 1441789986,
      "in_reply_to_id" : 1440702286,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII585V7_gi",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/wallet_sendmany.py",
      "position" : 9,
      "pull_request_review_id" : 1804226609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441789986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T14:09:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441789986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441983854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441983854"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        CRecipient recipient = {destination, amount, subtract_fee_outputs.contains(idx)};\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T16:21:32Z",
      "diff_hunk" : "@@ -24,34 +24,16 @@\n \n \n namespace wallet {\n-static void ParseRecipients(const UniValue& address_amounts, const UniValue& subtract_fee_outputs, std::vector<CRecipient>& recipients)\n+std::vector<CRecipient> CreateRecipients(const std::vector<std::pair<CTxDestination, CAmount>>& outputs, const std::set<int>& subtract_fee_outputs)\n {\n-    std::set<CTxDestination> destinations;\n-    int i = 0;\n-    for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n-        }\n-        destinations.insert(dest);\n-\n-        CAmount amount = AmountFromValue(address_amounts[i++]);\n-\n-        bool subtract_fee = false;\n-        for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n-            const UniValue& addr = subtract_fee_outputs[idx];\n-            if (addr.get_str() == address) {\n-                subtract_fee = true;\n-            }\n-        }\n-\n-        CRecipient recipient = {dest, amount, subtract_fee};\n+    std::vector<CRecipient> recipients;\n+    int idx{0};\n+    for (const auto& [destination, amount] : outputs) {\n+        CRecipient recipient = {destination, amount, subtract_fee_outputs.count(idx) == 1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441983854",
      "id" : 1441983854,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585V8u1u",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 32,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 34,
      "pull_request_review_id" : 1804531120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441983854/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T16:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441983854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            if (sffo_set.contains(pos))\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T16:21:45Z",
      "diff_hunk" : "@@ -76,6 +58,50 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& options, const std::vector<std::string>& destinations)\n+{\n+    int pos{0};\n+    std::set<int> sffo_set;\n+    UniValue subtract_fee_outputs(UniValue::VARR);\n+    if (options.exists(\"subtractfeefromamount\") || options.exists(\"subtractfeefrom\")) {\n+        if (options.exists(\"subtractfeefromamount\")) {\n+            if (options[\"subtractfeefromamount\"].isBool() && options[\"subtractfeefromamount\"].get_bool()) {\n+                subtract_fee_outputs.push_back(destinations.at(0));\n+            }\n+        } else if (options.exists(\"subtractfeefrom\")) {\n+            if (!options[\"subtractfeefrom\"].isNull()) {\n+                subtract_fee_outputs = options[\"subtractfeefrom\"].get_array();\n+            }\n+        }\n+        for (const std::string& address : destinations) {\n+            for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n+                const UniValue& addr = subtract_fee_outputs[idx];\n+                if (addr.get_str() == address) {\n+                    sffo_set.insert(pos);\n+                }\n+            }\n+            pos++;\n+        }\n+        return sffo_set;\n+    }\n+    if (options.exists(\"subtractFeeFromOutputs\") || options.exists(\"subtract_fee_from_outputs\") ) {\n+        subtract_fee_outputs = (options.exists(\"subtract_fee_from_outputs\") ? options[\"subtract_fee_from_outputs\"] : options[\"subtractFeeFromOutputs\"]).get_array();\n+        for (const auto& sffo : subtract_fee_outputs.getValues()) {\n+            pos = sffo.getInt<int>();\n+            if (sffo_set.count(pos))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984071",
      "id" : 1441984071,
      "line" : 91,
      "node_id" : "PRRC_kwDOABII585V8u5H",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 91,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 76,
      "pull_request_review_id" : 1804531120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T16:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984340"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    if (recipients.empty())\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T16:22:00Z",
      "diff_hunk" : "@@ -703,21 +718,10 @@ CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransact\n         }\n     }\n \n-    if (tx.vout.size() == 0)\n+    if (recipients.size() == 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984340",
      "id" : 1441984340,
      "line" : 721,
      "node_id" : "PRRC_kwDOABII585V8u9U",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 721,
      "original_position" : 193,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 193,
      "pull_request_review_id" : 1804531120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984340/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T16:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443117675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443117675"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it would be useful to assert that `tx.vout.empty()` somewhere to make it clear that it is not used. Perhaps this function can do `tx.vout.clear()`, and the `FundTransaction` called by it can do the check. We should make sure that any changes between now and the future PR do not accidentally use `tx.vout`.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T16:54:30Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443117675",
      "id" : 1443117675,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585WBDpr",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1806391978,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443117675/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T16:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443117675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443157721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443157721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point; I'll add a check and a comment.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T17:31:35Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443157721",
      "id" : 1443157721,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585WBNbZ",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1806465049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443157721/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T17:31:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443157721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443173852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443173852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nice! TIL c++20 introduced contains for sets :heart: ",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T17:46:16Z",
      "diff_hunk" : "@@ -24,34 +24,16 @@\n \n \n namespace wallet {\n-static void ParseRecipients(const UniValue& address_amounts, const UniValue& subtract_fee_outputs, std::vector<CRecipient>& recipients)\n+std::vector<CRecipient> CreateRecipients(const std::vector<std::pair<CTxDestination, CAmount>>& outputs, const std::set<int>& subtract_fee_outputs)\n {\n-    std::set<CTxDestination> destinations;\n-    int i = 0;\n-    for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n-        }\n-        destinations.insert(dest);\n-\n-        CAmount amount = AmountFromValue(address_amounts[i++]);\n-\n-        bool subtract_fee = false;\n-        for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n-            const UniValue& addr = subtract_fee_outputs[idx];\n-            if (addr.get_str() == address) {\n-                subtract_fee = true;\n-            }\n-        }\n-\n-        CRecipient recipient = {dest, amount, subtract_fee};\n+    std::vector<CRecipient> recipients;\n+    int idx{0};\n+    for (const auto& [destination, amount] : outputs) {\n+        CRecipient recipient = {destination, amount, subtract_fee_outputs.count(idx) == 1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443173852",
      "id" : 1443173852,
      "in_reply_to_id" : 1441983854,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585WBRXc",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 32,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 34,
      "pull_request_review_id" : 1806505913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443173852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T17:46:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443173852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443207515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443207515"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Rather than clearing tx.vout in the outer RPC function call, I am clearing tx.vout at the call sites of FundTransaction. Otherwise, I would have needed to make `tx` non-const, which seems risky since we are still using it to pass `tx.vins`",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T18:11:20Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443207515",
      "id" : 1443207515,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585WBZlb",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1806567359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443207515/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T18:11:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443207515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`git range-diff  5892014...909c6bb`\r\n\r\nAddresses review comments from @aureleoules and @achow101 , most notable being now clearing `tx.vout` and asserting that it is empty inside both `FundTransaction` functions. This ensures this is no longer used to pass outputs to `FundTransaction`, now and in future code.",
      "created_at" : "2024-01-06T18:45:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1879780205",
      "id" : 1879780205,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585wCytt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879780205/reactions"
      },
      "updated_at" : "2024-01-06T18:45:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879780205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   }
]
