[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28560).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [S3RK](https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1903507665) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#bitcoin-core/gui/733](https://github.com/bitcoin-core/gui/pull/733) (Deniability - a tool to automatically improve coin ownership privacy by denavila)\n* [#29264](https://github.com/bitcoin/bitcoin/pull/29264) (Add max_tx_weight to transaction funding options by instagibbs)\n* [#28944](https://github.com/bitcoin/bitcoin/pull/28944) (wallet, rpc: add anti-fee-sniping to `send` and `sendall` by ishaanam)\n* [#27792](https://github.com/bitcoin/bitcoin/pull/27792) (wallet: Deniability API (Unilateral Transaction Meta-Privacy) by denavila)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-10-02T16:50:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1743382033",
      "id" : 1743382033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585n6eYR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743382033/reactions"
      },
      "updated_at" : "2024-01-22T08:45:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743382033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432392999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432392999"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Let's not pass all the options as we need only one of them.",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:19:55Z",
      "diff_hunk" : "@@ -73,6 +73,38 @@ std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& subtrac\n     return set_sffo;\n }\n \n+std::vector<CRecipient> ParseOutputs(const UniValue& outputs_in, const UniValue& options)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432392999",
      "id" : 1432392999,
      "line" : 87,
      "node_id" : "PRRC_kwDOABII585VYJUn",
      "original_commit_id" : "f0af6e9a0f24b2281515345a5686706e88add854",
      "original_line" : 76,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 72,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432392999/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432392999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432396784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432396784"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`has_data` never set to `true`\r\n\r\nAlso no tests fail, so it seems there is no test coverage for that",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:23:49Z",
      "diff_hunk" : "@@ -29,16 +29,27 @@ std::vector<CRecipient> ParseRecipients(const UniValue& address_amounts, const s\n     std::set<CTxDestination> destinations;\n     std::vector<CRecipient> recipients;\n     int idx{0};\n+    bool has_data{false};\n     for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n+        CTxDestination dest;\n+        CAmount amount{0};\n+        if (address == \"data\") {\n+            if (has_data) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432396784",
      "id" : 1432396784,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII585VYKPw",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 37,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 15,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432396784/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432396784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432411126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432411126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not a huge fan of this change. Now if we pass tx.vout they'll be ignored.\r\n\r\nI'd prefer if we pass `txin` and `recipients` and don't pass `tx` at all. That would be a clearer interface in my opinion.",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:38:03Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432411126",
      "id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585VYNv2",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432411126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432411126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432414337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432414337"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same comment as for other `FundTransaction`. I think we should get rid of ambiguity in input parameters and don't pass `tx`. In this case it's even more confusing, because `tx.vout` is actually still checked.",
      "commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "created_at" : "2023-12-20T08:41:12Z",
      "diff_hunk" : "@@ -532,17 +543,14 @@ static std::vector<RPCArg> FundTxDoc(bool solving_data = true)\n     return args;\n }\n \n-CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)\n+CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432414337",
      "id" : 1432414337,
      "line" : 546,
      "node_id" : "PRRC_kwDOABII585VYOiB",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 546,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 41,
      "pull_request_review_id" : 1790386436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432414337/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T08:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432414337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We are using either `subtract_fee_from_outputs` or `subtractFeeFromOutputs`, depending on which one is present. I think handling that logic in the `ParseOutputs` function is better. Since the options object is passed by reference there isn't any performance difference in passing a reference to the entire options object vs passing a single key.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:20:08Z",
      "diff_hunk" : "@@ -73,6 +73,38 @@ std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& subtrac\n     return set_sffo;\n }\n \n+std::vector<CRecipient> ParseOutputs(const UniValue& outputs_in, const UniValue& options)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851243",
      "id" : 1432851243,
      "in_reply_to_id" : 1432392999,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585VZ5Mr",
      "original_commit_id" : "f0af6e9a0f24b2281515345a5686706e88add854",
      "original_line" : 76,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1791120595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851243/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:20:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch!",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:20:26Z",
      "diff_hunk" : "@@ -29,16 +29,27 @@ std::vector<CRecipient> ParseRecipients(const UniValue& address_amounts, const s\n     std::set<CTxDestination> destinations;\n     std::vector<CRecipient> recipients;\n     int idx{0};\n+    bool has_data{false};\n     for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n+        CTxDestination dest;\n+        CAmount amount{0};\n+        if (address == \"data\") {\n+            if (has_data) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432851596",
      "id" : 1432851596,
      "in_reply_to_id" : 1432396784,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585VZ5SM",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 37,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1791121146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851596/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:20:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432851596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432869408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432869408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree, see my comment in the description. Ultimately, I think `FundTransaction` should take a set of inputs and a set of outputs and return a `CreatedTransactionResult`. #25273 and this PR get us incrementally closer to that, but I don't want to fully tackle that in this PR as it's a bit more complicated than it seems, and the primary goal of this PR is to create the `CRecipients` objects in a standard way across all the RPC calls and pass them to `FundTransaction`",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:34:11Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432869408",
      "id" : 1432869408,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585VZ9og",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1791157685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432869408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432869408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432881141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432881141"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also a good catch, we should be using the `recipients` vector to get the size here.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2023-12-20T15:43:46Z",
      "diff_hunk" : "@@ -532,17 +543,14 @@ static std::vector<RPCArg> FundTxDoc(bool solving_data = true)\n     return args;\n }\n \n-CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)\n+CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, const UniValue& options, CCoinControl& coinControl, bool override_min_fee)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1432881141",
      "id" : 1432881141,
      "in_reply_to_id" : 1432414337,
      "line" : 512,
      "node_id" : "PRRC_kwDOABII585VaAf1",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 512,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 155,
      "pull_request_review_id" : 1791185730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432881141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-20T15:43:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1432881141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the `has_data` logic and replaced all references to `tx.vout` with `recipients` in `FundTransaction`, per feedback from @S3RK ",
      "created_at" : "2023-12-20T16:06:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1864748743",
      "id" : 1864748743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585vJc7H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864748743/reactions"
      },
      "updated_at" : "2023-12-20T16:06:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864748743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440697948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440697948"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a9d67ad96e5f4d6dca64df4ac85f0434e17248ab \"test: add tests for fundrawtx and sendmany rpcs\"\r\n\r\nnit: More pythonic to write:\r\n\r\n```suggestion\r\n        tx.vout = [CTxOut(1 * COIN, bytearray(address_to_scriptpubkey(address)))] * 2\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-03T17:17:29Z",
      "diff_hunk" : "@@ -147,6 +150,34 @@ def run_test(self):\n         self.test_22670()\n         self.test_feerate_rounding()\n         self.test_input_confs_control()\n+        self.test_duplicate_outputs()\n+\n+    def test_duplicate_outputs(self):\n+        self.log.info(\"Test deserializing and funding a transaction with duplicate outputs\")\n+        self.nodes[1].createwallet(\"fundtx_duplicate_outputs\")\n+        w = self.nodes[1].get_wallet_rpc(\"fundtx_duplicate_outputs\")\n+\n+        addr = w.getnewaddress(address_type=\"bech32\")\n+        self.nodes[0].sendtoaddress(addr, 5)\n+        self.generate(self.nodes[0], 1)\n+\n+        address = self.nodes[0].getnewaddress(\"bech32\")\n+        tx = CTransaction()\n+        tx.vin = []\n+        tx.vout = [CTxOut(1 * COIN, bytearray(address_to_scriptpubkey(address))) for _ in range(2)]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440697948",
      "id" : 1440697948,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII585V305c",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 167,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/wallet_fundrawtransaction.py",
      "position" : 32,
      "pull_request_review_id" : 1802756922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440697948/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T15:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440697948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440702286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440702286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a9d67ad96e5f4d6dca64df4ac85f0434e17248ab \"test: add tests for fundrawtx and sendmany rpcs\"\r\n\r\nThere are existing tests for `sendmany` in wallet_basic.py. I think these tests could be moved there as well.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-03T17:22:42Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the sendmany RPC command.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+class SendmanyTest(BitcoinTestFramework):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1440702286",
      "id" : 1440702286,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII585V319O",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/wallet_sendmany.py",
      "position" : 9,
      "pull_request_review_id" : 1802756922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440702286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-03T19:06:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1440702286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441785861"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441785861"
         }
      },
      "author_association" : "MEMBER",
      "body" : "noted! will update",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T14:05:19Z",
      "diff_hunk" : "@@ -147,6 +150,34 @@ def run_test(self):\n         self.test_22670()\n         self.test_feerate_rounding()\n         self.test_input_confs_control()\n+        self.test_duplicate_outputs()\n+\n+    def test_duplicate_outputs(self):\n+        self.log.info(\"Test deserializing and funding a transaction with duplicate outputs\")\n+        self.nodes[1].createwallet(\"fundtx_duplicate_outputs\")\n+        w = self.nodes[1].get_wallet_rpc(\"fundtx_duplicate_outputs\")\n+\n+        addr = w.getnewaddress(address_type=\"bech32\")\n+        self.nodes[0].sendtoaddress(addr, 5)\n+        self.generate(self.nodes[0], 1)\n+\n+        address = self.nodes[0].getnewaddress(\"bech32\")\n+        tx = CTransaction()\n+        tx.vin = []\n+        tx.vout = [CTxOut(1 * COIN, bytearray(address_to_scriptpubkey(address))) for _ in range(2)]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441785861",
      "id" : 1441785861,
      "in_reply_to_id" : 1440697948,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII585V7-gF",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 167,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/wallet_fundrawtransaction.py",
      "position" : 32,
      "pull_request_review_id" : 1804219375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441785861/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T14:05:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441785861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441789986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441789986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I initially started putting these tests in `wallet_basic.py`, but I'd prefer if we have RPC-specific test files and move all of the `sendmany` specific tests into the new `wallet_sendmany.py` file in a follow-up PR.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T14:09:15Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the sendmany RPC command.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+class SendmanyTest(BitcoinTestFramework):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441789986",
      "id" : 1441789986,
      "in_reply_to_id" : 1440702286,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII585V7_gi",
      "original_commit_id" : "a9d67ad96e5f4d6dca64df4ac85f0434e17248ab",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/wallet_sendmany.py",
      "position" : 9,
      "pull_request_review_id" : 1804226609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441789986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T14:09:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441789986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441983854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441983854"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        CRecipient recipient = {destination, amount, subtract_fee_outputs.contains(idx)};\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T16:21:32Z",
      "diff_hunk" : "@@ -24,34 +24,16 @@\n \n \n namespace wallet {\n-static void ParseRecipients(const UniValue& address_amounts, const UniValue& subtract_fee_outputs, std::vector<CRecipient>& recipients)\n+std::vector<CRecipient> CreateRecipients(const std::vector<std::pair<CTxDestination, CAmount>>& outputs, const std::set<int>& subtract_fee_outputs)\n {\n-    std::set<CTxDestination> destinations;\n-    int i = 0;\n-    for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n-        }\n-        destinations.insert(dest);\n-\n-        CAmount amount = AmountFromValue(address_amounts[i++]);\n-\n-        bool subtract_fee = false;\n-        for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n-            const UniValue& addr = subtract_fee_outputs[idx];\n-            if (addr.get_str() == address) {\n-                subtract_fee = true;\n-            }\n-        }\n-\n-        CRecipient recipient = {dest, amount, subtract_fee};\n+    std::vector<CRecipient> recipients;\n+    int idx{0};\n+    for (const auto& [destination, amount] : outputs) {\n+        CRecipient recipient = {destination, amount, subtract_fee_outputs.count(idx) == 1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441983854",
      "id" : 1441983854,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585V8u1u",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 32,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 34,
      "pull_request_review_id" : 1804531120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441983854/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T16:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441983854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            if (sffo_set.contains(pos))\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T16:21:45Z",
      "diff_hunk" : "@@ -76,6 +58,50 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& options, const std::vector<std::string>& destinations)\n+{\n+    int pos{0};\n+    std::set<int> sffo_set;\n+    UniValue subtract_fee_outputs(UniValue::VARR);\n+    if (options.exists(\"subtractfeefromamount\") || options.exists(\"subtractfeefrom\")) {\n+        if (options.exists(\"subtractfeefromamount\")) {\n+            if (options[\"subtractfeefromamount\"].isBool() && options[\"subtractfeefromamount\"].get_bool()) {\n+                subtract_fee_outputs.push_back(destinations.at(0));\n+            }\n+        } else if (options.exists(\"subtractfeefrom\")) {\n+            if (!options[\"subtractfeefrom\"].isNull()) {\n+                subtract_fee_outputs = options[\"subtractfeefrom\"].get_array();\n+            }\n+        }\n+        for (const std::string& address : destinations) {\n+            for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n+                const UniValue& addr = subtract_fee_outputs[idx];\n+                if (addr.get_str() == address) {\n+                    sffo_set.insert(pos);\n+                }\n+            }\n+            pos++;\n+        }\n+        return sffo_set;\n+    }\n+    if (options.exists(\"subtractFeeFromOutputs\") || options.exists(\"subtract_fee_from_outputs\") ) {\n+        subtract_fee_outputs = (options.exists(\"subtract_fee_from_outputs\") ? options[\"subtract_fee_from_outputs\"] : options[\"subtractFeeFromOutputs\"]).get_array();\n+        for (const auto& sffo : subtract_fee_outputs.getValues()) {\n+            pos = sffo.getInt<int>();\n+            if (sffo_set.count(pos))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984071",
      "id" : 1441984071,
      "line" : 91,
      "node_id" : "PRRC_kwDOABII585V8u5H",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 91,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 76,
      "pull_request_review_id" : 1804531120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T16:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984340"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    if (recipients.empty())\r\n```",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-04T16:22:00Z",
      "diff_hunk" : "@@ -703,21 +718,10 @@ CreatedTransactionResult FundTransaction(CWallet& wallet, const CMutableTransact\n         }\n     }\n \n-    if (tx.vout.size() == 0)\n+    if (recipients.size() == 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1441984340",
      "id" : 1441984340,
      "line" : 721,
      "node_id" : "PRRC_kwDOABII585V8u9U",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 721,
      "original_position" : 193,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 193,
      "pull_request_review_id" : 1804531120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984340/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-04T16:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1441984340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443117675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443117675"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it would be useful to assert that `tx.vout.empty()` somewhere to make it clear that it is not used. Perhaps this function can do `tx.vout.clear()`, and the `FundTransaction` called by it can do the check. We should make sure that any changes between now and the future PR do not accidentally use `tx.vout`.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T16:54:30Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443117675",
      "id" : 1443117675,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585WBDpr",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1806391978,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443117675/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T16:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443117675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443157721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443157721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point; I'll add a check and a comment.",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T17:31:35Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443157721",
      "id" : 1443157721,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585WBNbZ",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1806465049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443157721/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T17:31:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443157721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443173852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443173852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nice! TIL c++20 introduced contains for sets :heart: ",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T17:46:16Z",
      "diff_hunk" : "@@ -24,34 +24,16 @@\n \n \n namespace wallet {\n-static void ParseRecipients(const UniValue& address_amounts, const UniValue& subtract_fee_outputs, std::vector<CRecipient>& recipients)\n+std::vector<CRecipient> CreateRecipients(const std::vector<std::pair<CTxDestination, CAmount>>& outputs, const std::set<int>& subtract_fee_outputs)\n {\n-    std::set<CTxDestination> destinations;\n-    int i = 0;\n-    for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n-        }\n-        destinations.insert(dest);\n-\n-        CAmount amount = AmountFromValue(address_amounts[i++]);\n-\n-        bool subtract_fee = false;\n-        for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n-            const UniValue& addr = subtract_fee_outputs[idx];\n-            if (addr.get_str() == address) {\n-                subtract_fee = true;\n-            }\n-        }\n-\n-        CRecipient recipient = {dest, amount, subtract_fee};\n+    std::vector<CRecipient> recipients;\n+    int idx{0};\n+    for (const auto& [destination, amount] : outputs) {\n+        CRecipient recipient = {destination, amount, subtract_fee_outputs.count(idx) == 1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443173852",
      "id" : 1443173852,
      "in_reply_to_id" : 1441983854,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585WBRXc",
      "original_commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "original_line" : 32,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 34,
      "pull_request_review_id" : 1806505913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443173852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T17:46:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443173852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443207515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443207515"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Rather than clearing tx.vout in the outer RPC function call, I am clearing tx.vout at the call sites of FundTransaction. Otherwise, I would have needed to make `tx` non-const, which seems risky since we are still using it to pass `tx.vins`",
      "commit_id" : "589201443afae39025a38be21a64929bb94b85f9",
      "created_at" : "2024-01-05T18:11:20Z",
      "diff_hunk" : "@@ -224,7 +224,7 @@ util::Result<CreatedTransactionResult> CreateTransaction(CWallet& wallet, const\n  * Insert additional inputs into the transaction by\n  * calling CreateTransaction();\n  */\n-util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, std::optional<unsigned int> change_pos, bool lockUnspents, const std::set<int>& setSubtractFeeFromOutputs, CCoinControl);\n+util::Result<CreatedTransactionResult> FundTransaction(CWallet& wallet, const CMutableTransaction& tx, const std::vector<CRecipient>& recipients, std::optional<unsigned int> change_pos, bool lockUnspents, CCoinControl);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1443207515",
      "id" : 1443207515,
      "in_reply_to_id" : 1432411126,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585WBZlb",
      "original_commit_id" : "3dfcb817d8f939df1f46d56e242b18bd604dfb93",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1806567359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443207515/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-05T18:11:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443207515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`git range-diff  5892014...909c6bb`\r\n\r\nAddresses review comments from @aureleoules and @achow101 , most notable being now clearing `tx.vout` and asserting that it is empty inside both `FundTransaction` functions. This ensures this is no longer used to pass outputs to `FundTransaction`, now and in future code.",
      "created_at" : "2024-01-06T18:45:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1879780205",
      "id" : 1879780205,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585wCytt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879780205/reactions"
      },
      "updated_at" : "2024-01-06T18:45:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879780205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445369299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445369299"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 8ab3da31c56d2cc05c4273ec0833109be106ed2b \"refactor: move parsing to new function\"\r\n\r\nI would that these two variables be declared inside of the loop just to avoid things leaking between iterations. I don't see why they need to be outside of the loop.",
      "commit_id" : "909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706",
      "created_at" : "2024-01-08T21:37:35Z",
      "diff_hunk" : "@@ -97,41 +97,50 @@ UniValue NormalizeOutputs(const UniValue& outputs_in)\n     return outputs;\n }\n \n-void AddOutputs(CMutableTransaction& rawTx, const UniValue& outputs_in)\n+std::vector<std::pair<CTxDestination, CAmount>> ParseOutputs(const UniValue& outputs)\n {\n-    UniValue outputs(UniValue::VOBJ);\n-    outputs = NormalizeOutputs(outputs_in);\n-\n     // Duplicate checking\n     std::set<CTxDestination> destinations;\n+    std::vector<std::pair<CTxDestination, CAmount>> parsed_outputs;\n     bool has_data{false};\n-\n+    CTxDestination destination;\n+    CAmount amount;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445369299",
      "id" : 1445369299,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585WJpXT",
      "original_commit_id" : "8ab3da31c56d2cc05c4273ec0833109be106ed2b",
      "original_line" : 107,
      "original_position" : 16,
      "original_start_line" : 106,
      "path" : "src/rpc/rawtransaction_util.cpp",
      "position" : 24,
      "pull_request_review_id" : 1810067354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445369299/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 106,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-08T22:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445369299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445376055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445376055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In d8850285d9ebfbff77b6f04f80f1682a15c8783a \"refactor: simplify `CreateRecipients`\"\r\n\r\nCan be simplified with just a normal for loop:\r\n\r\n```suggestion\r\n    for (size_t i = 0; i < outputs.size(); ++i) {\r\n        const auto& [destination, amount] = outputs.at(i);\r\n        CRecipient recipient = {destination, amount, subtract_fee_outputs.contains(i)};\r\n        recipients.push_back(recipient);\r\n```",
      "commit_id" : "909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706",
      "created_at" : "2024-01-08T21:44:11Z",
      "diff_hunk" : "@@ -24,34 +24,14 @@\n \n \n namespace wallet {\n-std::vector<CRecipient> CreateRecipients(const UniValue& address_amounts, const UniValue& subtract_fee_outputs)\n+std::vector<CRecipient> CreateRecipients(const std::vector<std::pair<CTxDestination, CAmount>>& outputs, const std::set<int>& subtract_fee_outputs)\n {\n     std::vector<CRecipient> recipients;\n-    std::set<CTxDestination> destinations;\n-    int i = 0;\n-    for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n-        }\n-        destinations.insert(dest);\n-\n-        CAmount amount = AmountFromValue(address_amounts[i++]);\n-\n-        bool subtract_fee = false;\n-        for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n-            const UniValue& addr = subtract_fee_outputs[idx];\n-            if (addr.get_str() == address) {\n-                subtract_fee = true;\n-            }\n-        }\n-\n-        CRecipient recipient = {dest, amount, subtract_fee};\n+    int idx{0};\n+    for (const auto& [destination, amount] : outputs) {\n+        CRecipient recipient = {destination, amount, subtract_fee_outputs.contains(idx)};\n         recipients.push_back(recipient);\n+        idx++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445376055",
      "id" : 1445376055,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII585WJrA3",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 34,
      "original_position" : 36,
      "original_start_line" : 30,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 36,
      "pull_request_review_id" : 1810067354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445376055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 30,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-08T22:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445376055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445381354"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445381354"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In d8850285d9ebfbff77b6f04f80f1682a15c8783a \"refactor: simplify `CreateRecipients`\"\r\n\r\nUsing a `UniValue` in this function seems kinda clunky. I would much rather than the parsing be done by the RPCs that need to do the parsing and this function could just take a `std::vector<std::string> sffo_addrs` or something like that. None of these options seems to exist in other RPCs.\r\n\r\nSince all of the different ways that sffo is set by the user, this could do type interpretation to figure it out. If it's a bool, and there's only one destination, then that is the one to sffo, and the only way that happens is with `sendtoaddress`. If it's an array of strings, then it's `sendmany` and we do that one. And if it's an array of ints, it's the `fundraw`/`send`/`walletcreatefunded` type of sffo.",
      "commit_id" : "909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706",
      "created_at" : "2024-01-08T21:49:48Z",
      "diff_hunk" : "@@ -78,6 +58,36 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& options, const std::vector<std::string>& destinations)\n+{\n+    int pos{0};\n+    std::set<int> sffo_set;\n+    UniValue subtract_fee_outputs(UniValue::VARR);\n+    if (options.exists(\"subtractfeefromamount\") || options.exists(\"subtractfeefrom\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445381354",
      "id" : 1445381354,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585WJsTq",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 66,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 51,
      "pull_request_review_id" : 1810067354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445381354/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-08T22:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445381354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445383947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445383947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In d8850285d9ebfbff77b6f04f80f1682a15c8783a \"refactor: simplify `CreateRecipients`\"\r\n\r\nPacking the sffo info into a UniValue just to be parsed again seems to be really unergonomic.",
      "commit_id" : "909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706",
      "created_at" : "2024-01-08T21:52:05Z",
      "diff_hunk" : "@@ -298,12 +303,12 @@ RPCHelpMan sendtoaddress()\n     UniValue address_amounts(UniValue::VOBJ);\n     const std::string address = request.params[0].get_str();\n     address_amounts.pushKV(address, request.params[1]);\n-    UniValue subtractFeeFromAmount(UniValue::VARR);\n-    if (fSubtractFeeFromAmount) {\n-        subtractFeeFromAmount.push_back(address);\n-    }\n-\n-    std::vector<CRecipient> recipients = CreateRecipients(address_amounts, subtractFeeFromAmount);\n+    UniValue subtractFeeFromAmount(UniValue::VOBJ);\n+    subtractFeeFromAmount.pushKV(\"subtractfeefromamount\", request.params[4]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1445383947",
      "id" : 1445383947,
      "line" : 321,
      "node_id" : "PRRC_kwDOABII585WJs8L",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 307,
      "original_position" : 100,
      "original_start_line" : 306,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 117,
      "pull_request_review_id" : 1810067354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445383947/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 320,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-08T22:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1445383947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446405052"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446405052"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Since all of the different ways that sffo is set by the user, this could do type interpretation to figure it out.\r\n\r\nThat makes sense, what do you think about doing the type interpretation on the UniValue passed in, instead of relying on the key names? I'd rather do that than try to have this function take a `std::variant` or something like that",
      "commit_id" : "909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706",
      "created_at" : "2024-01-09T17:34:09Z",
      "diff_hunk" : "@@ -78,6 +58,36 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& options, const std::vector<std::string>& destinations)\n+{\n+    int pos{0};\n+    std::set<int> sffo_set;\n+    UniValue subtract_fee_outputs(UniValue::VARR);\n+    if (options.exists(\"subtractfeefromamount\") || options.exists(\"subtractfeefrom\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446405052",
      "id" : 1446405052,
      "in_reply_to_id" : 1445381354,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585WNmO8",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 66,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 51,
      "pull_request_review_id" : 1811670659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446405052/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-09T17:34:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446405052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446448724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446448724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think UniValue type interpretation would be fine.",
      "commit_id" : "909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706",
      "created_at" : "2024-01-09T18:19:46Z",
      "diff_hunk" : "@@ -78,6 +58,36 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& options, const std::vector<std::string>& destinations)\n+{\n+    int pos{0};\n+    std::set<int> sffo_set;\n+    UniValue subtract_fee_outputs(UniValue::VARR);\n+    if (options.exists(\"subtractfeefromamount\") || options.exists(\"subtractfeefrom\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446448724",
      "id" : 1446448724,
      "in_reply_to_id" : 1445381354,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585WNw5U",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 66,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 51,
      "pull_request_review_id" : 1811742633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446448724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-09T18:19:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446448724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated https://github.com/bitcoin/bitcoin/commit/909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706 -> https://github.com/bitcoin/bitcoin/commit/c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b ([compare](https://github.com/josibake/bitcoin/compare/909c6bb1dbc6f60c5ad3200d83f3fce98f4c3706..c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b))\r\n\r\n* Moved `CTxDestination`, `Amount` into loop\r\n* Simplified the loop inside `CreateRecipients`\r\n* Refactored `InterpretSubtractFeeFromAmountInstructions` to infer parsing logic based on the instruction type (int, bool, str)\r\n\r\nThanks for the suggestion @achow101 , it looks a lot cleaner now.",
      "created_at" : "2024-01-09T19:57:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1883691930",
      "id" : 1883691930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585wRtua",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1883691930/reactions"
      },
      "updated_at" : "2024-01-09T20:03:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1883691930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446538974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446538974"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b",
      "created_at" : "2024-01-09T19:57:46Z",
      "diff_hunk" : "@@ -298,12 +303,12 @@ RPCHelpMan sendtoaddress()\n     UniValue address_amounts(UniValue::VOBJ);\n     const std::string address = request.params[0].get_str();\n     address_amounts.pushKV(address, request.params[1]);\n-    UniValue subtractFeeFromAmount(UniValue::VARR);\n-    if (fSubtractFeeFromAmount) {\n-        subtractFeeFromAmount.push_back(address);\n-    }\n-\n-    std::vector<CRecipient> recipients = CreateRecipients(address_amounts, subtractFeeFromAmount);\n+    UniValue subtractFeeFromAmount(UniValue::VOBJ);\n+    subtractFeeFromAmount.pushKV(\"subtractfeefromamount\", request.params[4]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446538974",
      "id" : 1446538974,
      "in_reply_to_id" : 1445383947,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WOG7e",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 307,
      "original_position" : 100,
      "original_start_line" : 306,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1811890163,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446538974/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-09T19:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446538974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446539102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539102"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b",
      "created_at" : "2024-01-09T19:57:55Z",
      "diff_hunk" : "@@ -78,6 +58,36 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& options, const std::vector<std::string>& destinations)\n+{\n+    int pos{0};\n+    std::set<int> sffo_set;\n+    UniValue subtract_fee_outputs(UniValue::VARR);\n+    if (options.exists(\"subtractfeefromamount\") || options.exists(\"subtractfeefrom\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446539102",
      "id" : 1446539102,
      "in_reply_to_id" : 1445381354,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WOG9e",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 66,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1811890397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539102/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-09T19:57:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446539347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539347"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b",
      "created_at" : "2024-01-09T19:58:10Z",
      "diff_hunk" : "@@ -24,34 +24,14 @@\n \n \n namespace wallet {\n-std::vector<CRecipient> CreateRecipients(const UniValue& address_amounts, const UniValue& subtract_fee_outputs)\n+std::vector<CRecipient> CreateRecipients(const std::vector<std::pair<CTxDestination, CAmount>>& outputs, const std::set<int>& subtract_fee_outputs)\n {\n     std::vector<CRecipient> recipients;\n-    std::set<CTxDestination> destinations;\n-    int i = 0;\n-    for (const std::string& address: address_amounts.getKeys()) {\n-        CTxDestination dest = DecodeDestination(address);\n-        if (!IsValidDestination(dest)) {\n-            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(\"Invalid Bitcoin address: \") + address);\n-        }\n-\n-        if (destinations.count(dest)) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, std::string(\"Invalid parameter, duplicated address: \") + address);\n-        }\n-        destinations.insert(dest);\n-\n-        CAmount amount = AmountFromValue(address_amounts[i++]);\n-\n-        bool subtract_fee = false;\n-        for (unsigned int idx = 0; idx < subtract_fee_outputs.size(); idx++) {\n-            const UniValue& addr = subtract_fee_outputs[idx];\n-            if (addr.get_str() == address) {\n-                subtract_fee = true;\n-            }\n-        }\n-\n-        CRecipient recipient = {dest, amount, subtract_fee};\n+    int idx{0};\n+    for (const auto& [destination, amount] : outputs) {\n+        CRecipient recipient = {destination, amount, subtract_fee_outputs.contains(idx)};\n         recipients.push_back(recipient);\n+        idx++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446539347",
      "id" : 1446539347,
      "in_reply_to_id" : 1445376055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WOHBT",
      "original_commit_id" : "d8850285d9ebfbff77b6f04f80f1682a15c8783a",
      "original_line" : 34,
      "original_position" : 36,
      "original_start_line" : 30,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1811890760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539347/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-09T19:58:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446539625"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539625"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b",
      "created_at" : "2024-01-09T19:58:28Z",
      "diff_hunk" : "@@ -97,41 +97,50 @@ UniValue NormalizeOutputs(const UniValue& outputs_in)\n     return outputs;\n }\n \n-void AddOutputs(CMutableTransaction& rawTx, const UniValue& outputs_in)\n+std::vector<std::pair<CTxDestination, CAmount>> ParseOutputs(const UniValue& outputs)\n {\n-    UniValue outputs(UniValue::VOBJ);\n-    outputs = NormalizeOutputs(outputs_in);\n-\n     // Duplicate checking\n     std::set<CTxDestination> destinations;\n+    std::vector<std::pair<CTxDestination, CAmount>> parsed_outputs;\n     bool has_data{false};\n-\n+    CTxDestination destination;\n+    CAmount amount;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1446539625",
      "id" : 1446539625,
      "in_reply_to_id" : 1445369299,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585WOHFp",
      "original_commit_id" : "8ab3da31c56d2cc05c4273ec0833109be106ed2b",
      "original_line" : 107,
      "original_position" : 16,
      "original_start_line" : 106,
      "path" : "src/rpc/rawtransaction_util.cpp",
      "position" : null,
      "pull_request_review_id" : 1811891217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539625/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-09T19:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1446539625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1447033851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447033851"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 0b0276bb00d3511172d662a94ffd7b55adbbf2d1\r\n\r\nI don't see a reason to extract this function at this point (could be done later in the PR).\r\nThere are two disparate cases covered (`bool` and `vector<string>`). And each case is only used in one and only one place, further commits also don't introduce further usage of this code path as they pass `vector<int>`. \r\n\r\nWouldn't it be better if we keep this logic at the call site? \r\nBenefits of my proposal:\r\n* we don't need second parameter for this function\r\n* we don't need to pass dummy value in `fundrawtransaction` RPC code\r\n* we can combine `NormalizeOutputs` and `ParseOutputs`. they are used always together and the only reason for `NormalizeOutputs` to exist now is too pass second param to `InterpretSubtractFeeFromOutputInstructions` in `send` and `walletfundpsbt` RPC. But there second parameter is useless as `subtract_fee_from_outputs` option of those RPCs can't be of the `vector<string>` type",
      "commit_id" : "c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b",
      "created_at" : "2024-01-10T08:26:09Z",
      "diff_hunk" : "@@ -78,6 +57,27 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& sffo_instructions, const std::vector<std::string>& destinations)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1447033851",
      "id" : 1447033851,
      "line" : 60,
      "node_id" : "PRRC_kwDOABII585WP_v7",
      "original_commit_id" : "0b0276bb00d3511172d662a94ffd7b55adbbf2d1",
      "original_line" : 60,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 45,
      "pull_request_review_id" : 1812652518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447033851/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-10T08:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447033851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1447261373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447261373"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I prefer having a single function (as opposed to keeping the logic at the call site) for the following reasons:\r\n\r\n* We avoid duplicating code at the RPC call sites:\r\n   * The logic for validating SFFO inputs would need to be duplicated at `send`, `fundrawtx` and `walletcreatefundedpsbt`. This is the code that checks that the ints passed are not duplicated and in bounds and previously used to be inside `rpc/FundTransaction`\r\n* We have one place to validate all SFFO inputs:\r\n  * Currently, `sendmany` SFFO inputs are not validated (documented in the added functional tests)\r\n  * Having one function for parsing and validating makes it cleaner to add validation for all inputs in a follow-up PR. The only reason I'm not doing it in this PR is that its a behavior change (it could make calls to `sendmany` invalid that were previously accepted) and I'd like to keep this strictly a refactor\r\n  \r\n> we don't need second parameter for this function\r\n\r\nIn the case of `sendmany`, we do need the array of destinations to lookup their position. In the case of `send`, `walletcreatefundedpsbt`, and `fundrawtransaction`, we need the array of destinations to make sure our ints are in bounds. There are definitely other ways to do it, but it seems fine to use the same vector for lookups and size. More just making the point that the argument is always used.\r\n\r\n> we can combine NormalizeOutputs and ParseOutputs. they are used always together\r\n\r\nActually, the main goal here was to separate the logic in `AddOutputs` to get rid of duplicate validation logic in `AddOutputs` and also the original `ParseRecipients` function. `sendtoaddress` and `sendtoaddress` need the validation logic, but don't need `NormalizeOutputs` since those RPCs already only allow the user to pass a key-value pair for address and amounts.\r\n\r\nThe other RPCs (`send`, `fundrawtransaction`, `walletcreatefundedpsbt`) need the logic for parsing how the univalue is passed (`NormalizeOutputs`) and validating the addresses (`ParseOutputs`).",
      "commit_id" : "c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b",
      "created_at" : "2024-01-10T11:38:33Z",
      "diff_hunk" : "@@ -78,6 +57,27 @@ static void InterpretFeeEstimationInstructions(const UniValue& conf_target, cons\n     }\n }\n \n+std::set<int> InterpretSubtractFeeFromOutputInstructions(const UniValue& sffo_instructions, const std::vector<std::string>& destinations)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1447261373",
      "id" : 1447261373,
      "in_reply_to_id" : 1447033851,
      "line" : 60,
      "node_id" : "PRRC_kwDOABII585WQ3S9",
      "original_commit_id" : "0b0276bb00d3511172d662a94ffd7b55adbbf2d1",
      "original_line" : 60,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 45,
      "pull_request_review_id" : 1813021773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447261373/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-10T11:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1447261373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK c856a1093009c6098c7c9fed5cc3f03fd0c0cf5b\r\n\r\nNice improvements removing duplication between `CreateRecipient` and `AddOutputs`, also embedding SFFO values in `CRecipient` instead of passing as a separate parameter to `FundTransaction`.\r\n\r\nI'd still prefer `InterpretSubtractFeeFromOutputInstructions` to work with one type of SFFO option - `vector<int>` and process others at the call site. SFFO option can be in three different forms and `vector<int>` is the only form that used multiple times, the other forms are only used once. But that's not blocking as `InterpretSubtractFeeFromOutputInstructions` and the RPCs are in the same file.",
      "created_at" : "2024-01-15T09:13:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1891638400",
      "id" : 1891638400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585wwByA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1891638400/reactions"
      },
      "updated_at" : "2024-01-15T09:13:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1891638400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "According to my `range-diff` nothing changed.\r\nreACK 18ad1b9142e91cef2f5c6a693eeb2d0fbb8c517d",
      "created_at" : "2024-01-22T08:45:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#issuecomment-1903507665",
      "id" : 1903507665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28560",
      "node_id" : "IC_kwDOABII585xdTjR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1903507665/reactions"
      },
      "updated_at" : "2024-01-22T08:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1903507665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1464018197"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1464018197"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In f7384b921c3460c7a3cc7827a68b2c613bd98f8e \"refactor: move parsing to new function\"\r\n\r\nnit: Making temp variables  is not necessary.",
      "commit_id" : "18ad1b9142e91cef2f5c6a693eeb2d0fbb8c517d",
      "created_at" : "2024-01-23T21:29:53Z",
      "diff_hunk" : "@@ -97,41 +97,49 @@ UniValue NormalizeOutputs(const UniValue& outputs_in)\n     return outputs;\n }\n \n-void AddOutputs(CMutableTransaction& rawTx, const UniValue& outputs_in)\n+std::vector<std::pair<CTxDestination, CAmount>> ParseOutputs(const UniValue& outputs)\n {\n-    UniValue outputs(UniValue::VOBJ);\n-    outputs = NormalizeOutputs(outputs_in);\n-\n     // Duplicate checking\n     std::set<CTxDestination> destinations;\n+    std::vector<std::pair<CTxDestination, CAmount>> parsed_outputs;\n     bool has_data{false};\n-\n     for (const std::string& name_ : outputs.getKeys()) {\n         if (name_ == \"data\") {\n             if (has_data) {\n                 throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid parameter, duplicate key: data\");\n             }\n             has_data = true;\n             std::vector<unsigned char> data = ParseHexV(outputs[name_].getValStr(), \"Data\");\n-\n-            CTxOut out(0, CScript() << OP_RETURN << data);\n-            rawTx.vout.push_back(out);\n+            CTxDestination destination{CNoDestination{CScript() << OP_RETURN << data}};\n+            CAmount amount{0};\n+            parsed_outputs.emplace_back(destination, amount);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28560#discussion_r1464018197",
      "id" : 1464018197,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII585XQyUV",
      "original_commit_id" : "f7384b921c3460c7a3cc7827a68b2c613bd98f8e",
      "original_line" : 115,
      "original_position" : 27,
      "original_start_line" : 113,
      "path" : "src/rpc/rawtransaction_util.cpp",
      "position" : 35,
      "pull_request_review_id" : 1839971435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1464018197/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 113,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-23T21:31:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1464018197",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
