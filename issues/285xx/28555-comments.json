[
   {
      "author_association" : "NONE",
      "body" : "I have just reproduced the issue. The problem is with destination addresses that were derived from _imported descriptors_. These transaction and addresses behaves correctly as \"mine\" addresses, but `details` section is missing for balance changes in `gettransaction` RPC output.\r\n\r\n### Steps to reproduce\r\n\r\n1. Create new wallet and generate an address from it\r\n    ```bash\r\n    read -rs passphrase\r\n\r\n    bitcoin-cli -named createwallet wallet_name='tmp_to_export' passphrase=\"$passphrase\" load_on_startup=false\r\n    problematic_address=$(bitcoin-cli getnewaddress)\r\n   ```\r\n\r\n2. Export descriptors and unload the wallet\r\n\r\n    _edit_: (private keys included)\r\n\r\n    ```bash\r\n    bitcoin-cli -named walletpassphrase passphrase=\"$passphrase\" timeout=20\r\n    bitcoin-cli -named listdescriptors private=true | jq '.descriptors' > 'descriptors-to-import.json'\r\n    bitcoin-cli unloadwallet 'tmp_to_export'\r\n    ```\r\n\r\n3. Load another wallet and import descriptors\r\n\r\n    ```bash\r\n    read -rs passphrase\r\n\r\n    bitcoin-cli loadwallet default\r\n    bitcoin-cli -named walletpassphrase passphrase=\"$passphrase\" timeout=20\r\n    bitcoin-cli importdescriptors \"$(< 'descriptors-to-import.json')\"\r\n    ```\r\n\r\n4. Send some funds to the address derived from imported descriptors\r\n\r\n    ```bash\r\n    bitcoin-cli -named walletpassphrase passphrase=\"$passphrase\" timeout=20\r\n    bitcoin-cli send \"{\\\"$problematic_address\\\": 0.1}\"\r\n    ```\r\n\r\n5. See missing `details` in `gettransaction` output:\r\n\r\n    ```bash\r\n    bitcoin-cli gettransaction 'dc082c830c05e9600cf32d8c4484c3acffe7d85cd3e578d50b68e1c4fef53750'\r\n    ```\r\n    ```json\r\n    {\r\n      \"amount\": 0.00000000,\r\n      \"fee\": -0.00012425,\r\n      \"confirmations\": 0,\r\n      \"trusted\": false,\r\n      \"txid\": \"dc082c830c05e9600cf32d8c4484c3acffe7d85cd3e578d50b68e1c4fef53750\",\r\n      \"wtxid\": \"1bb51ec89915bf8c3a01144ffa4c2d2d1688ab3a0b59134cbbac73b160b0704a\",\r\n      \"walletconflicts\": [\r\n      ],\r\n      \"time\": 1696251182,\r\n      \"timereceived\": 1696251182,\r\n      \"bip125-replaceable\": \"yes\",\r\n      \"details\": [\r\n      ],\r\n      \"hex\": \"0200000000010387bfd79defdeb70b68cbf09cb03e613053e8aa2963074bdd67e9467672cd76810100000000fdffffff74de2418e3145b0ffbb0dc31878dcca40c158987b47996afea3c6073cc3cc41d0100000000fdffffff87bfd79defdeb70b68cbf09cb03e613053e8aa2963074bdd67e9467672cd76810000000000fdffffff0246179900000000002251206d18596b999dc4781f3de5e9f8e2eb6f1beeff8b5d83be0b3c1322cd863997fd8096980000000000225120460e9f7581f18cd79fccd4c4f86ae86a6e5ca469f1a845a240cd0b7d84f7e63d0140dfd690ed01e7a1f014c49aa750d29ea43f4ddc44a4393b43ba080c24f63787fa2ffaa8cea26f522f0a954fbf04e32edac6ec920f312d3f22cdf8c58d3532b2030140cde1904f21d760c0fb2d2f3bd1fc11e7cca60e24a4f5071fe76a184d71e542577b0d3ba8a1189aec4e31fdbe4bed014f55f12b961fffa9634fdfd6e2d6db8ebd0140716fa018e07bae6ac29bad3803957f5a5cae9cee6c720805c0ed657c59312d460392218d5ea14f99ad7364d8cd99880aa8363289938ec38c554a3c91954eacec00000000\"\r\n    }\r\n    ```\r\n\r\nFYI: this is a real TX on testnet: [mempool.space/testnet](https://mempool.space/testnet/tx/dc082c830c05e9600cf32d8c4484c3acffe7d85cd3e578d50b68e1c4fef53750)",
      "created_at" : "2023-10-02T13:11:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28555#issuecomment-1742990860",
      "id" : 1742990860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28555",
      "node_id" : "IC_kwDOABII585n4-4M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1742990860/reactions"
      },
      "updated_at" : "2023-10-02T20:45:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1742990860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11145995?v=4",
         "events_url" : "https://api.github.com/users/VojtechMyslivec/events{/privacy}",
         "followers_url" : "https://api.github.com/users/VojtechMyslivec/followers",
         "following_url" : "https://api.github.com/users/VojtechMyslivec/following{/other_user}",
         "gists_url" : "https://api.github.com/users/VojtechMyslivec/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/VojtechMyslivec",
         "id" : 11145995,
         "login" : "VojtechMyslivec",
         "node_id" : "MDQ6VXNlcjExMTQ1OTk1",
         "organizations_url" : "https://api.github.com/users/VojtechMyslivec/orgs",
         "received_events_url" : "https://api.github.com/users/VojtechMyslivec/received_events",
         "repos_url" : "https://api.github.com/users/VojtechMyslivec/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/VojtechMyslivec/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/VojtechMyslivec/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/VojtechMyslivec"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the report @VojtechMyslivec.\r\n\r\nCan you try running `gettransaction` with `include_watchonly=true`?\r\n\r\nI guess since you only imported the pubkey descriptor into \"default\" wallet, it might consider this a `watchonly` wallet, and so be (correctly) skipping those outputs from the details field.\r\n\r\nside note: I thought mixing privkey and watchonly wallets was prohibited, so not sure how the import of your descriptors to `default`, which then seems able to send transactions, is currently permitted...",
      "created_at" : "2023-10-02T13:32:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28555#issuecomment-1743024655",
      "id" : 1743024655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28555",
      "node_id" : "IC_kwDOABII585n5HIP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743024655/reactions"
      },
      "updated_at" : "2023-10-02T13:32:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743024655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for your response Will!\r\n\r\nI am really sorry for the confusion. I exported description _including private keys_, so these addresses should not be in `watchonly` mode. I forgot to mention `private=true` parameter in the commands above (which I have just corrected).\r\n\r\nRunning with `include_watchonly=true` does not make any difference.",
      "created_at" : "2023-10-02T13:41:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28555#issuecomment-1743040609",
      "id" : 1743040609,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28555",
      "node_id" : "IC_kwDOABII585n5LBh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743040609/reactions"
      },
      "updated_at" : "2023-10-02T13:41:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743040609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11145995?v=4",
         "events_url" : "https://api.github.com/users/VojtechMyslivec/events{/privacy}",
         "followers_url" : "https://api.github.com/users/VojtechMyslivec/followers",
         "following_url" : "https://api.github.com/users/VojtechMyslivec/following{/other_user}",
         "gists_url" : "https://api.github.com/users/VojtechMyslivec/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/VojtechMyslivec",
         "id" : 11145995,
         "login" : "VojtechMyslivec",
         "node_id" : "MDQ6VXNlcjExMTQ1OTk1",
         "organizations_url" : "https://api.github.com/users/VojtechMyslivec/orgs",
         "received_events_url" : "https://api.github.com/users/VojtechMyslivec/received_events",
         "repos_url" : "https://api.github.com/users/VojtechMyslivec/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/VojtechMyslivec/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/VojtechMyslivec/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/VojtechMyslivec"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`gettransaction` result does not include change outputs. The functionality could be added if needed.\r\nMeanwhile, could use `listsinceblock` setting the `include_change` arg to true.",
      "created_at" : "2023-10-02T13:57:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28555#issuecomment-1743067410",
      "id" : 1743067410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28555",
      "node_id" : "IC_kwDOABII585n5RkS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743067410/reactions"
      },
      "updated_at" : "2023-10-02T13:57:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743067410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thank you for the reply Matias. But I am not talking about change addresses nor outputs. This TX is from my wallet to the receiving addres, that is derived from the imported descriptor. There is of course some change output but I don't bother about that.\r\n\r\nAnother TX, that send funds from my wallet to another address (derived from the original descriptors), includes both `send` and `receive` items in the `details` array of `gettransaction` output. \r\n\r\nAlso, another TX, that transfer funds from the outside to the address of imported descriptor, includes `receive` item in the `details`.\r\n\r\nSo it appears to me as a bug in the \"edge\" case of sending  a TX to myself and using a destination address that is derived from an imported descriptor. ",
      "created_at" : "2023-10-02T14:25:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28555#issuecomment-1743119969",
      "id" : 1743119969,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28555",
      "node_id" : "IC_kwDOABII585n5eZh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743119969/reactions"
      },
      "updated_at" : "2023-10-02T14:25:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743119969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11145995?v=4",
         "events_url" : "https://api.github.com/users/VojtechMyslivec/events{/privacy}",
         "followers_url" : "https://api.github.com/users/VojtechMyslivec/followers",
         "following_url" : "https://api.github.com/users/VojtechMyslivec/following{/other_user}",
         "gists_url" : "https://api.github.com/users/VojtechMyslivec/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/VojtechMyslivec",
         "id" : 11145995,
         "login" : "VojtechMyslivec",
         "node_id" : "MDQ6VXNlcjExMTQ1OTk1",
         "organizations_url" : "https://api.github.com/users/VojtechMyslivec/orgs",
         "received_events_url" : "https://api.github.com/users/VojtechMyslivec/received_events",
         "repos_url" : "https://api.github.com/users/VojtechMyslivec/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/VojtechMyslivec/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/VojtechMyslivec/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/VojtechMyslivec"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Is there anything more I can provide to investigate this problem?\r\n\r\nI would label this with ~bug, ~descriptors and ~wallet\r\n\r\nThanks\r\n",
      "created_at" : "2023-12-20T09:56:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28555#issuecomment-1864179337",
      "id" : 1864179337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28555",
      "node_id" : "IC_kwDOABII585vHR6J",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864179337/reactions"
      },
      "updated_at" : "2023-12-20T09:56:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864179337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11145995?v=4",
         "events_url" : "https://api.github.com/users/VojtechMyslivec/events{/privacy}",
         "followers_url" : "https://api.github.com/users/VojtechMyslivec/followers",
         "following_url" : "https://api.github.com/users/VojtechMyslivec/following{/other_user}",
         "gists_url" : "https://api.github.com/users/VojtechMyslivec/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/VojtechMyslivec",
         "id" : 11145995,
         "login" : "VojtechMyslivec",
         "node_id" : "MDQ6VXNlcjExMTQ1OTk1",
         "organizations_url" : "https://api.github.com/users/VojtechMyslivec/orgs",
         "received_events_url" : "https://api.github.com/users/VojtechMyslivec/received_events",
         "repos_url" : "https://api.github.com/users/VojtechMyslivec/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/VojtechMyslivec/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/VojtechMyslivec/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/VojtechMyslivec"
      }
   }
]
