[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [amitiuttarwar](https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1374936705), [brunoerg](https://github.com/bitcoin/bitcoin/pull/26847#pullrequestreview-1240845960), [sipa](https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1376394341), [vasild](https://github.com/bitcoin/bitcoin/pull/26847#pullrequestreview-1247703211) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26114](https://github.com/bitcoin/bitcoin/pull/26114) (net: Make AddrFetch connections to fixed seeds by mzumsande)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-08T21:45:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1374934695",
      "id" : 1374934695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26847",
      "node_id" : "IC_kwDOABII585R89an",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374934695/reactions"
      },
      "updated_at" : "2023-01-13T15:34:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374934695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "approach ACK. relatively simple patch to ameliorate the issue of address discovery when switching networks",
      "created_at" : "2023-01-08T21:56:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1374936705",
      "id" : 1374936705,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26847",
      "node_id" : "IC_kwDOABII585R896B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374936705/reactions"
      },
      "updated_at" : "2023-01-08T21:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374936705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064365792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064365792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps it's a good opportunity to start using a named variable? :)",
      "commit_id" : "85dc0c97349d3264691cab7419154fabb80bc9c4",
      "created_at" : "2023-01-09T08:11:01Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {\n+        return -20;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064365792",
      "id" : 1064365792,
      "line" : 1109,
      "node_id" : "PRRC_kwDOABII584_cO7g",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1109,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 108,
      "pull_request_review_id" : 1240065749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064365792/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T08:11:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064365792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064367448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064367448"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Here and above, maybe use `return (in_new == true) ? entry.first : entry.second;`?",
      "commit_id" : "85dc0c97349d3264691cab7419154fabb80bc9c4",
      "created_at" : "2023-01-09T08:13:27Z",
      "diff_hunk" : "@@ -962,6 +970,32 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else if (in_new == true) {\n+            return nNew;\n+        } else {\n+            return nTried;\n+        }\n+    }\n+    if (auto it = map_counts.find(*net); it != map_counts.end()) {\n+        auto entry = it->second;\n+        if (!in_new.has_value()) {\n+            return entry.first + entry.second;\n+        } else if (in_new == true) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064367448",
      "id" : 1064367448,
      "line" : 990,
      "node_id" : "PRRC_kwDOABII584_cPVY",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 990,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 85,
      "pull_request_review_id" : 1240068367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064367448/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T08:13:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064367448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064368601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064368601"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Given this dependency, should we drop `nNew` and `nTried` altogether?",
      "commit_id" : "85dc0c97349d3264691cab7419154fabb80bc9c4",
      "created_at" : "2023-01-09T08:15:02Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064368601",
      "id" : 1064368601,
      "line" : 1108,
      "node_id" : "PRRC_kwDOABII584_cPnZ",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1108,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 107,
      "pull_request_review_id" : 1240070044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064368601/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T08:15:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064368601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064372051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064372051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I wish `for which we have no addresses` was captured by the function name somehow. Perhaps `GetRelevantFixedSeedNetworks`?",
      "commit_id" : "85dc0c97349d3264691cab7419154fabb80bc9c4",
      "created_at" : "2023-01-09T08:20:06Z",
      "diff_hunk" : "@@ -969,6 +969,12 @@ class CConnman\n     void RecordBytesRecv(uint64_t bytes);\n     void RecordBytesSent(uint64_t bytes) EXCLUSIVE_LOCKS_REQUIRED(!m_total_bytes_sent_mutex);\n \n+    /**\n+     Return networks for which we have no addresses in addrman and therefore\n+     may require loading fixed seeds.\n+     */\n+    std::vector<Network> GetFixedSeedNetworks() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1064372051",
      "id" : 1064372051,
      "line" : 976,
      "node_id" : "PRRC_kwDOABII584_cQdT",
      "original_commit_id" : "85dc0c97349d3264691cab7419154fabb80bc9c4",
      "original_line" : 976,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 8,
      "pull_request_review_id" : 1240075440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064372051/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T08:20:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064372051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065038961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065038961"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do you mean getting rid of the return codes and return something like error strings instead? \r\nHmm, not sure if this wouldn't better be a separate PR.",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T19:41:18Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {\n+        return -20;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065038961",
      "id" : 1065038961,
      "in_reply_to_id" : 1064365792,
      "line" : 1105,
      "node_id" : "PRRC_kwDOABII584_ezRx",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1105,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 104,
      "pull_request_review_id" : 1241097493,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065038961/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T19:41:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065038961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065039499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065039499"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed it to the ternary operator.",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T19:41:58Z",
      "diff_hunk" : "@@ -962,6 +970,32 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else if (in_new == true) {\n+            return nNew;\n+        } else {\n+            return nTried;\n+        }\n+    }\n+    if (auto it = map_counts.find(*net); it != map_counts.end()) {\n+        auto entry = it->second;\n+        if (!in_new.has_value()) {\n+            return entry.first + entry.second;\n+        } else if (in_new == true) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065039499",
      "id" : 1065039499,
      "in_reply_to_id" : 1064367448,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_ezaL",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 990,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1241098298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065039499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T19:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065039499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065041916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065041916"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : " I think that's not so straightforward - `nNew` and `nTried` are part of the serialization after all. Also, I don't like that then we'd need to build the sum over all networks every time we needed `nNew` or `nTried` (as the check code does).",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T19:45:03Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065041916",
      "id" : 1065041916,
      "in_reply_to_id" : 1064368601,
      "line" : 1104,
      "node_id" : "PRRC_kwDOABII584_ez_8",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1104,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 103,
      "pull_request_review_id" : 1241101888,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065041916/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T19:45:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065041916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065042665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065042665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Renamed it, pretty sure I even used that name in an earlier iteration.",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T19:46:00Z",
      "diff_hunk" : "@@ -969,6 +969,12 @@ class CConnman\n     void RecordBytesRecv(uint64_t bytes);\n     void RecordBytesSent(uint64_t bytes) EXCLUSIVE_LOCKS_REQUIRED(!m_total_bytes_sent_mutex);\n \n+    /**\n+     Return networks for which we have no addresses in addrman and therefore\n+     may require loading fixed seeds.\n+     */\n+    std::vector<Network> GetFixedSeedNetworks() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065042665",
      "id" : 1065042665,
      "in_reply_to_id" : 1064372051,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_e0Lp",
      "original_commit_id" : "85dc0c97349d3264691cab7419154fabb80bc9c4",
      "original_line" : 976,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1241102998,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065042665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T19:46:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065042665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065145002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065145002"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: maybe use `size_t`  for these two variables, as the values being summed are `size_t` as well. I realize you can't actually build an addrman with enough entries to exceed `int`, but I feel it's better to be consistent.",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T21:58:42Z",
      "diff_hunk" : "@@ -1065,6 +1095,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065145002",
      "id" : 1065145002,
      "line" : 1098,
      "node_id" : "PRRC_kwDOABII584_fNKq",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 1098,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 97,
      "pull_request_review_id" : 1241260431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065145002/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T22:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065145002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065148163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065148163"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `return *in_new ? nNew : nTried;` ?",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T22:03:15Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else {\n+            return (in_new == true) ? nNew : nTried;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065148163",
      "id" : 1065148163,
      "line" : 981,
      "node_id" : "PRRC_kwDOABII584_fN8D",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 981,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 76,
      "pull_request_review_id" : 1241260431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065148163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T22:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065148163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065148700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065148700"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `return *in_new ? entry.first : entry.second;`?",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T22:03:54Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else {\n+            return (in_new == true) ? nNew : nTried;\n+        }\n+    }\n+    if (auto it = map_counts.find(*net); it != map_counts.end()) {\n+        auto entry = it->second;\n+        if (!in_new.has_value()) {\n+            return entry.first + entry.second;\n+        } else {\n+            return (in_new == true) ? entry.first : entry.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065148700",
      "id" : 1065148700,
      "line" : 989,
      "node_id" : "PRRC_kwDOABII584_fOEc",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 989,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 84,
      "pull_request_review_id" : 1241260431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065148700/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T22:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065148700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065149504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065149504"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It'd be good if the sanity check here actually recomputed the totals per-network (by iterating over the actual addrman entries).",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T22:05:06Z",
      "diff_hunk" : "@@ -1065,6 +1095,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065149504",
      "id" : 1065149504,
      "line" : 1100,
      "node_id" : "PRRC_kwDOABII584_fORA",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 1100,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 99,
      "pull_request_review_id" : 1241260431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065149504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T22:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065149504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065149908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065149908"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: naming convention? `m_map_counts`",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-09T22:05:44Z",
      "diff_hunk" : "@@ -215,6 +217,9 @@ class AddrManImpl\n     /** Reference to the netgroup manager. netgroupman must be constructed before addrman and destructed after. */\n     const NetGroupManager& m_netgroupman;\n \n+    /** Number of entries in addrman per network and new/tried table. */\n+    std::unordered_map<Network, std::pair<size_t, size_t>> map_counts GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065149908",
      "id" : 1065149908,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII584_fOXU",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 221,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/addrman_impl.h",
      "position" : 14,
      "pull_request_review_id" : 1241260431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065149908/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T22:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065149908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept/approach ACK",
      "created_at" : "2023-01-09T22:07:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1376394341",
      "id" : 1376394341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26847",
      "node_id" : "IC_kwDOABII585SChxl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1376394341/reactions"
      },
      "updated_at" : "2023-01-09T22:07:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1376394341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065468195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065468195"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was thinking not touching the legacy code, but for the newly added `-20` create an enum. And the legacy codes could be replaced later on. This is not very important to me, feel free to resolve if you don't like the idea. ",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-10T08:29:46Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {\n+        return -20;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065468195",
      "id" : 1065468195,
      "in_reply_to_id" : 1064365792,
      "line" : 1105,
      "node_id" : "PRRC_kwDOABII584_gcEj",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1105,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 104,
      "pull_request_review_id" : 1241722435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065468195/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T08:29:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065468195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065477668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065477668"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">Also, I don't like that then we'd need to build the sum over all networks every time we needed nNew or nTried (as the check code does).\r\n\r\nWell, I don't think something being inside the `Check` is a good justification âÂ it's the other way around, `Check` is needed to make sure those values are sane. Furthermore, the sum over all networks is 5 addition operations, right? \r\n\r\nHowever, I agree that dropping these values might be not trivial due to serialization. Not sure I'll find time to prototype that, but maybe someone will :) Otherwise feel free to close this suggestion.",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-10T08:39:15Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065477668",
      "id" : 1065477668,
      "in_reply_to_id" : 1064368601,
      "line" : 1104,
      "node_id" : "PRRC_kwDOABII584_geYk",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1104,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 103,
      "pull_request_review_id" : 1241740573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065477668/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T08:39:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065477668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065478186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065478186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, see [this](https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065149504) :)",
      "commit_id" : "18acfdfe3b6c38f04ddae3b94bb68f0e3531ab19",
      "created_at" : "2023-01-10T08:39:40Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065478186",
      "id" : 1065478186,
      "in_reply_to_id" : 1064368601,
      "line" : 1104,
      "node_id" : "PRRC_kwDOABII584_gegq",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1104,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 103,
      "pull_request_review_id" : 1241741175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065478186/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T08:39:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065478186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1066265014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1066265014"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That would get me a compiler warning `comparison of integer expressions of different signedness`, since `nNew` and `nTried` are `int`. But I'll change the sanity check to compare with the actual totals instead of `nNew` and `nTried`, as suggested by you below.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-10T20:03:42Z",
      "diff_hunk" : "@@ -1065,6 +1095,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1066265014",
      "id" : 1066265014,
      "in_reply_to_id" : 1065145002,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_jem2",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 1098,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1242887023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1066265014/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T20:03:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1066265014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067506204"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506204"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "renamed",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-11T22:11:50Z",
      "diff_hunk" : "@@ -215,6 +217,9 @@ class AddrManImpl\n     /** Reference to the netgroup manager. netgroupman must be constructed before addrman and destructed after. */\n     const NetGroupManager& m_netgroupman;\n \n+    /** Number of entries in addrman per network and new/tried table. */\n+    std::unordered_map<Network, std::pair<size_t, size_t>> map_counts GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067506204",
      "id" : 1067506204,
      "in_reply_to_id" : 1065149908,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_oNoc",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 221,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/addrman_impl.h",
      "position" : null,
      "pull_request_review_id" : 1244685255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506204/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T22:11:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067506371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-11T22:12:05Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else {\n+            return (in_new == true) ? nNew : nTried;\n+        }\n+    }\n+    if (auto it = map_counts.find(*net); it != map_counts.end()) {\n+        auto entry = it->second;\n+        if (!in_new.has_value()) {\n+            return entry.first + entry.second;\n+        } else {\n+            return (in_new == true) ? entry.first : entry.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067506371",
      "id" : 1067506371,
      "in_reply_to_id" : 1065148700,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_oNrD",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 989,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1244685517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506371/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T22:12:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067506439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506439"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-11T22:12:11Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else {\n+            return (in_new == true) ? nNew : nTried;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067506439",
      "id" : 1067506439,
      "in_reply_to_id" : 1065148163,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_oNsH",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 981,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1244685627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506439/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T22:12:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067506439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067509698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067509698"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I changed this to actually recompute the totals - while doing so I noticed that it is possible that it's possible that there are \"empty\" entries  (0 new and 0 tried) in `m_map_counts` if an addr of some network was first added and later removed again from. That's not a problem in my opinion, but it means that the size of the map is not necessarily reliable. The changed check should work with this, potentially also adding an entry empty to `local_counts`.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-11T22:17:16Z",
      "diff_hunk" : "@@ -1065,6 +1095,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067509698",
      "id" : 1067509698,
      "in_reply_to_id" : 1065149504,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_oOfC",
      "original_commit_id" : "4b06a304db36553118756aabf30bad9440909d9a",
      "original_line" : 1100,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1244693417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067509698/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T22:17:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067509698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067510907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067510907"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ok - I think refactoring the codes might make sense, but if so I'd prefer to do this everywhere at once (and in a separate refactoring PR) ",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-11T22:19:13Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {\n+        return -20;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067510907",
      "id" : 1067510907,
      "in_reply_to_id" : 1064365792,
      "line" : 1104,
      "node_id" : "PRRC_kwDOABII584_oOx7",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1104,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 123,
      "pull_request_review_id" : 1244697141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067510907/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T22:19:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067510907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067515092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067515092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've changed the check such that it no longer compares with `nNew` and `nTried` but does a recount, see below for more context (of course the relation is still there...).",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-11T22:23:35Z",
      "diff_hunk" : "@@ -1065,6 +1099,15 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    int cnt_new{0};\n+    int cnt_tried{0};\n+    for (auto net : map_counts) {\n+        cnt_new += net.second.first;\n+        cnt_tried += net.second.second;\n+    }\n+    if (cnt_new != nNew || cnt_tried != nTried) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067515092",
      "id" : 1067515092,
      "in_reply_to_id" : 1064368601,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_oPzU",
      "original_commit_id" : "db92c1bb6c82ce01976745087c961874aaba2880",
      "original_line" : 1104,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1244701304,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067515092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T22:23:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067515092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067812969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067812969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What do you mean by unique here? How they could not be unique?",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-12T08:09:06Z",
      "diff_hunk" : "@@ -102,6 +102,13 @@ class AddrMan\n     //! Return the number of (unique) addresses in all tables.\n     size_t size() const;\n \n+    /**\n+    * Return the number of (unique) addresses, optionally filtered by network",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067812969",
      "id" : 1067812969,
      "line" : 106,
      "node_id" : "PRRC_kwDOABII584_pYhp",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 106,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 5,
      "pull_request_review_id" : 1245128332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067812969/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T08:09:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067812969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067822456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067822456"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is probably too crazy, but I was thinking what if these values overflow (from ++) and are not equal anymore due to UB? I'm actually not sure what's our attitude towards such risks across the code.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-12T08:20:15Z",
      "diff_hunk" : "@@ -1065,6 +1098,17 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    // It's possible that m_map_counts may have all-zero entries that local_counts\n+    // doesn't have if addrs from a network were being added and then removed again in the past.\n+    if (m_map_counts.size() < local_counts.size()) {\n+        return -20;\n+    }\n+    for (const auto& [net, count] : m_map_counts) {\n+        if (local_counts[net].first != count.first || local_counts[net].second != count.second) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1067822456",
      "id" : 1067822456,
      "line" : 1107,
      "node_id" : "PRRC_kwDOABII584_pa14",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 1107,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 126,
      "pull_request_review_id" : 1245142323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067822456/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T08:20:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067822456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1068261380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068261380"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I copied it from the line above - it means that addresses with multiple occurrences (they can be in up to 8 different spots in the new tables) are counted only once.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-12T15:24:37Z",
      "diff_hunk" : "@@ -102,6 +102,13 @@ class AddrMan\n     //! Return the number of (unique) addresses in all tables.\n     size_t size() const;\n \n+    /**\n+    * Return the number of (unique) addresses, optionally filtered by network",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1068261380",
      "id" : 1068261380,
      "in_reply_to_id" : 1067812969,
      "line" : 106,
      "node_id" : "PRRC_kwDOABII584_rGAE",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 106,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 5,
      "pull_request_review_id" : 1245819183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068261380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T15:24:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068261380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1068311766"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068311766"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, It definitely shouldn't be possible and would mean that there is a serious bug in addrman, but I think that within the `Check()` code, we definitely want to abort. After all, `Check()`  doesn't normally run in production (`DEFAULT_ADDRMAN_CONSISTENCY_CHECKS == 0`) and needs to be activated by the user.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-12T16:05:11Z",
      "diff_hunk" : "@@ -1065,6 +1098,17 @@ int AddrManImpl::CheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n+    // It's possible that m_map_counts may have all-zero entries that local_counts\n+    // doesn't have if addrs from a network were being added and then removed again in the past.\n+    if (m_map_counts.size() < local_counts.size()) {\n+        return -20;\n+    }\n+    for (const auto& [net, count] : m_map_counts) {\n+        if (local_counts[net].first != count.first || local_counts[net].second != count.second) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1068311766",
      "id" : 1068311766,
      "in_reply_to_id" : 1067822456,
      "line" : 1107,
      "node_id" : "PRRC_kwDOABII584_rSTW",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 1107,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 126,
      "pull_request_review_id" : 1245903055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068311766/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T16:05:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068311766",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069508106"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069508106"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: should be `Size_()` according to `doc/developer-notes.md` (and the wrapper `Size()`). I know there is already an existent `size()` which you probably wanted to be consistent with. Maybe rename that to match the coding style?",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T14:12:27Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069508106",
      "id" : 1069508106,
      "line" : 973,
      "node_id" : "PRRC_kwDOABII584_v2YK",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 973,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 68,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069508106/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069508106",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069511892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069511892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Feel free to ignore. It is ok as it is, but I find code like the following a bit unreadable:\r\n\r\n```cpp\r\nx = it->second;\r\nx.first = 5;\r\nx.second = 6;\r\n// or it->second.first = 000;\r\n```\r\n\r\nConsider:\r\n\r\n```cpp\r\nstruct NewTriedCount {\r\n    size_t n_new;\r\n    size_t n_tried;\r\n};\r\nstd::unordered_map<Network, NewTriedCount> local_counts;\r\n```\r\n\r\nJust to give more meaningful names to those obscure `first` and `second`.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T14:16:13Z",
      "diff_hunk" : "@@ -986,6 +1016,7 @@ int AddrManImpl::CheckAddrman() const\n \n     std::unordered_set<int> setTried;\n     std::unordered_map<int, int> mapNew;\n+    std::unordered_map<Network, std::pair<size_t, size_t>> local_counts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069511892",
      "id" : 1069511892,
      "line" : 1019,
      "node_id" : "PRRC_kwDOABII584_v3TU",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1019,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 97,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069511892/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069511892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069514507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069514507"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is `Check()` needed before and after, given that `size_()` is a `const` method?",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T14:18:33Z",
      "diff_hunk" : "@@ -1074,6 +1118,15 @@ size_t AddrManImpl::size() const\n     return vRandom.size();\n }\n \n+size_t AddrManImpl::size(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    LOCK(cs);\n+    Check();\n+    auto ret = size_(net, in_new);\n+    Check();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069514507",
      "id" : 1069514507,
      "line" : 1126,
      "node_id" : "PRRC_kwDOABII584_v38L",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1126,
      "original_position" : 143,
      "original_start_line" : 1124,
      "path" : "src/addrman.cpp",
      "position" : 143,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069514507/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1124,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069514507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069525993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069525993"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`addr2` is unused. Probably you meant:\r\n```suggestion\r\n    CAddress addr2{CAddress(ResolveService(\"250.1.1.2\", 8333), NODE_NONE)};\r\n    BOOST_CHECK(addrman->Add({addr2}, source));\r\n```\r\n\r\n`addr1`, `addr2` and `addr3` below can be `const`.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T14:28:53Z",
      "diff_hunk" : "@@ -990,4 +990,42 @@ BOOST_AUTO_TEST_CASE(addrman_update_address)\n     BOOST_CHECK_EQUAL(vAddr2.at(0).nServices, NODE_NETWORK_LIMITED);\n }\n \n+BOOST_AUTO_TEST_CASE(addrman_size)\n+{\n+    auto addrman = std::make_unique<AddrMan>(EMPTY_NETGROUPMAN, DETERMINISTIC, GetCheckRatio(m_node));\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+\n+    // empty addrman\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/std::nullopt, /*in_new=*/std::nullopt), 0U);\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/NET_IPV4, /*in_new=*/std::nullopt), 0U);\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/std::nullopt, /*in_new=*/true), 0U);\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/NET_IPV4, /*in_new=*/false), 0U);\n+\n+    // add two ipv4 addresses, one to tried and new\n+    CAddress addr1{CAddress(ResolveService(\"250.1.1.1\", 8333), NODE_NONE)};\n+    BOOST_CHECK(addrman->Add({addr1}, source));\n+    BOOST_CHECK(addrman->Good(addr1));\n+    CAddress addr2{CAddress(ResolveService(\"250.1.1.1\", 8333), NODE_NONE)};\n+    BOOST_CHECK(addrman->Add({CAddress(ResolveService(\"250.1.1.2\", 8333), NODE_NONE)}, source));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069525993",
      "id" : 1069525993,
      "line" : 1009,
      "node_id" : "PRRC_kwDOABII584_v6vp",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1009,
      "original_position" : 20,
      "original_start_line" : 1008,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 20,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069525993/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1008,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069525993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069531417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069531417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `CAddress addr1{CAddress(...)};` is equivalent to: `CAddress addr1{...};`",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T14:33:55Z",
      "diff_hunk" : "@@ -990,4 +990,42 @@ BOOST_AUTO_TEST_CASE(addrman_update_address)\n     BOOST_CHECK_EQUAL(vAddr2.at(0).nServices, NODE_NETWORK_LIMITED);\n }\n \n+BOOST_AUTO_TEST_CASE(addrman_size)\n+{\n+    auto addrman = std::make_unique<AddrMan>(EMPTY_NETGROUPMAN, DETERMINISTIC, GetCheckRatio(m_node));\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+\n+    // empty addrman\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/std::nullopt, /*in_new=*/std::nullopt), 0U);\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/NET_IPV4, /*in_new=*/std::nullopt), 0U);\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/std::nullopt, /*in_new=*/true), 0U);\n+    BOOST_CHECK_EQUAL(addrman->size(/*net=*/NET_IPV4, /*in_new=*/false), 0U);\n+\n+    // add two ipv4 addresses, one to tried and new\n+    CAddress addr1{CAddress(ResolveService(\"250.1.1.1\", 8333), NODE_NONE)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069531417",
      "id" : 1069531417,
      "line" : 1005,
      "node_id" : "PRRC_kwDOABII584_v8EZ",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1005,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 16,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069531417/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069531417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069566173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069566173"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n                // be loaded only for networks for which we have no addressses.\r\n```",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T15:05:19Z",
      "diff_hunk" : "@@ -1650,14 +1664,12 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 // We will not make outgoing connections to peers that are unreachable\n                 // (e.g. because of -onlynet configuration).\n                 // Therefore, we do not add them to addrman in the first place.\n-                // Note that if you change -onlynet setting from one network to another,\n-                // peers.dat will contain only peers of unreachable networks and\n-                // manual intervention will be needed (either delete peers.dat after\n-                // configuration change or manually add some reachable peer using addnode),\n-                // see <https://github.com/bitcoin/bitcoin/issues/26035> for details.\n+                // In case previously unreachable networks become reachable\n+                // (e.g. in case of -onlynet changes by the user), fixed seeds will\n+                // be loaded only for networks for which no we have no addressses.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069566173",
      "id" : 1069566173,
      "line" : 1669,
      "node_id" : "PRRC_kwDOABII584_wEjd",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1669,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 50,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069566173/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069566173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069571899"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069571899"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A vector is usually not cheap to copy. Better capture it by reference:\r\n```suggestion\r\n                                                [&fixed_seed_networks](const CAddress& addr) { return std::find(fixed_seed_networks.begin(), fixed_seed_networks.end(), addr.GetNetwork()) == fixed_seed_networks.end(); }),\r\n```",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T15:10:37Z",
      "diff_hunk" : "@@ -1650,14 +1664,12 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 // We will not make outgoing connections to peers that are unreachable\n                 // (e.g. because of -onlynet configuration).\n                 // Therefore, we do not add them to addrman in the first place.\n-                // Note that if you change -onlynet setting from one network to another,\n-                // peers.dat will contain only peers of unreachable networks and\n-                // manual intervention will be needed (either delete peers.dat after\n-                // configuration change or manually add some reachable peer using addnode),\n-                // see <https://github.com/bitcoin/bitcoin/issues/26035> for details.\n+                // In case previously unreachable networks become reachable\n+                // (e.g. in case of -onlynet changes by the user), fixed seeds will\n+                // be loaded only for networks for which no we have no addressses.\n                 seed_addrs.erase(std::remove_if(seed_addrs.begin(), seed_addrs.end(),\n-                                               [](const CAddress& addr) { return !IsReachable(addr); }),\n-                                seed_addrs.end());\n+                                                [fixed_seed_networks](const CAddress& addr) { return std::find(fixed_seed_networks.begin(), fixed_seed_networks.end(), addr.GetNetwork()) == fixed_seed_networks.end(); }),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069571899",
      "id" : 1069571899,
      "line" : 1671,
      "node_id" : "PRRC_kwDOABII584_wF87",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1671,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 54,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069571899/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069571899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069576904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069576904"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This will iterate `fixed_seed_networks` for every seed address: `O(num_addresses * num_networks)`. I know the list of networks is tiny and this can probably be ignored wrt performance, but it can easily be made `O(num_addresses)`. Also, if `std::unordered_set` is used, the code will be shorter:\r\n\r\n```cpp\r\nstd::find(fixed_seed_networks.begin(), fixed_seed_networks.end(), addr.GetNetwork()) == fixed_seed_networks.end();\r\n```\r\n\r\nwould become:\r\n\r\n```cpp\r\nfixed_seed_networks.count(addr.GetNetwork()) == 0;\r\n```",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T15:15:05Z",
      "diff_hunk" : "@@ -1650,14 +1664,12 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 // We will not make outgoing connections to peers that are unreachable\n                 // (e.g. because of -onlynet configuration).\n                 // Therefore, we do not add them to addrman in the first place.\n-                // Note that if you change -onlynet setting from one network to another,\n-                // peers.dat will contain only peers of unreachable networks and\n-                // manual intervention will be needed (either delete peers.dat after\n-                // configuration change or manually add some reachable peer using addnode),\n-                // see <https://github.com/bitcoin/bitcoin/issues/26035> for details.\n+                // In case previously unreachable networks become reachable\n+                // (e.g. in case of -onlynet changes by the user), fixed seeds will\n+                // be loaded only for networks for which no we have no addressses.\n                 seed_addrs.erase(std::remove_if(seed_addrs.begin(), seed_addrs.end(),\n-                                               [](const CAddress& addr) { return !IsReachable(addr); }),\n-                                seed_addrs.end());\n+                                                [fixed_seed_networks](const CAddress& addr) { return std::find(fixed_seed_networks.begin(), fixed_seed_networks.end(), addr.GetNetwork()) == fixed_seed_networks.end(); }),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069576904",
      "id" : 1069576904,
      "line" : 1671,
      "node_id" : "PRRC_kwDOABII584_wHLI",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1671,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 54,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069576904/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-13T15:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069576904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069598095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069598095"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This does not need to be a method of `CConnman` because it does not access any of its members (other than `addrman`). Would it be more appropriate to have it as `AddrMan` method? Then the public interface of `AddrMan` need not be changed by this PR. Edit: I mean no need to add this `AddrMan` method `size(std::optional<Network> net, std::optional<bool> in_new)`.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T15:32:59Z",
      "diff_hunk" : "@@ -1575,6 +1575,19 @@ int CConnman::GetExtraBlockRelayCount() const\n     return std::max(block_relay_peers - m_max_outbound_block_relay, 0);\n }\n \n+std::vector<Network> CConnman::GetRelevantFixedSeedNetworks() const\n+{\n+    std::vector<Network> networks{};\n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\n+        if (IsReachable(net) && addrman.size(net, std::nullopt) == 0) {\n+            networks.push_back(net);\n+        }\n+    }\n+    return networks;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1069598095",
      "id" : 1069598095,
      "line" : 1589,
      "node_id" : "PRRC_kwDOABII584_wMWP",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1589,
      "original_position" : 15,
      "original_start_line" : 1578,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 1247703211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069598095/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1578,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-13T15:38:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1069598095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070146333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070146333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "any reason you opted to add this here vs within the `Create` function?\r\n\r\nmy guess is to keep it close to `nNew++`, but to imo it'd be better to move the `nNew` logic into `Create` instead of adding more external dependencies. it's nbd because `Create` is only called from here, but imo would better match expectations / reduce room for accidental divergence in the future",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T22:51:39Z",
      "diff_hunk" : "@@ -592,6 +599,7 @@ bool AddrManImpl::AddSingle(const CAddress& addr, const CNetAddr& source, std::c\n         pinfo = Create(addr, source, &nId);\n         pinfo->nTime = std::max(NodeSeconds{0s}, pinfo->nTime - time_penalty);\n         nNew++;\n+        m_map_counts[pinfo->GetNetwork()].first++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070146333",
      "id" : 1070146333,
      "line" : 602,
      "node_id" : "PRRC_kwDOABII584_ySMd",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 602,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 60,
      "pull_request_review_id" : 1248640279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070146333/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-14T02:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070146333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070155015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070155015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "+1 to named struct, esp since both values are counts. when intending to increment tried count, it's easier to accidentally increment \"x.first\" than it would be \"x.new\". during review I was regularly reminding myself \"first = new & second = tried\", and named vars would completely remove that mental overhead.\r\n\r\nclarification: I realized this comment is referring to the code in `CheckAddrman`, I was suggesting the named struct would be used for the member `m_map_counts`. @vasild were you thinking the same, or just thinking of updating here?",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-13T23:14:47Z",
      "diff_hunk" : "@@ -986,6 +1016,7 @@ int AddrManImpl::CheckAddrman() const\n \n     std::unordered_set<int> setTried;\n     std::unordered_map<int, int> mapNew;\n+    std::unordered_map<Network, std::pair<size_t, size_t>> local_counts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070155015",
      "id" : 1070155015,
      "in_reply_to_id" : 1069511892,
      "line" : 1019,
      "node_id" : "PRRC_kwDOABII584_yUUH",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1019,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 97,
      "pull_request_review_id" : 1248640279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070155015/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-14T02:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070155015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070179900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070179900"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think using doxygen guidelines makes this comment a bit easier to parse\r\n\r\n```suggestion\r\n/**\r\n* Return size information about addrman.\r\n*\r\n* @param[in] net \t \t\tSelect addresses only from specified network (nullopt = all)\r\n* @param[in] in_new \t\tSelect addresses only from one table (true = new, false = tried, nullopt = both)\r\n*\r\n* @return \t\t\t\t\tNumber of unique addresses that match specified options.\r\n*/\r\n```",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-14T00:41:30Z",
      "diff_hunk" : "@@ -102,6 +102,13 @@ class AddrMan\n     //! Return the number of (unique) addresses in all tables.\n     size_t size() const;\n \n+    /**\n+    * Return the number of (unique) addresses, optionally filtered by network\n+    * and/or addrman table (new if true, tried if false).\n+    * If any of the optional args are nullopt, don't filter with respect to it.\n+    */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070179900",
      "id" : 1070179900,
      "line" : 109,
      "node_id" : "PRRC_kwDOABII584_yaY8",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 109,
      "original_position" : 8,
      "original_start_line" : 105,
      "path" : "src/addrman.h",
      "position" : 8,
      "pull_request_review_id" : 1248640279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070179900/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 105,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-14T02:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070179900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070185911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070185911"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style suggestion to consider. mainly, reversing the logic blocks in the if statements to reduce the `!` indirections of nested logic. \r\n\r\n<details>\r\n<summary>code</summary>\r\n\r\n```suggestion\r\n    if (!net) {\r\n        if (in_new.has_value()) {\r\n            return *in_new ? nNew : nTried;\r\n        } else {\r\n            return nNew + nTried;\r\n        }\r\n    }\r\n\r\n    if (auto it = m_map_counts.find(*net); it != m_map_counts.end()) {\r\n        auto entry = it->second;\r\n        if (in_new.has_value()) {\r\n            return *in_new ? entry.first : entry.second;\r\n        } else {\r\n            return entry.first + entry.second;\r\n        }\r\n    }\r\n\r\n```\r\n\r\n</details>\r\n\r\n",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-14T01:08:33Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else {\n+            return *in_new ? nNew : nTried;\n+        }\n+    }\n+    if (auto it = m_map_counts.find(*net); it != m_map_counts.end()) {\n+        auto entry = it->second;\n+        if (!in_new.has_value()) {\n+            return entry.first + entry.second;\n+        } else {\n+            return *in_new ? entry.first : entry.second;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070185911",
      "id" : 1070185911,
      "line" : 991,
      "node_id" : "PRRC_kwDOABII584_yb23",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 991,
      "original_position" : 86,
      "original_start_line" : 977,
      "path" : "src/addrman.cpp",
      "position" : 86,
      "pull_request_review_id" : 1248640279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070185911/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 977,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-14T02:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070185911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070186177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070186177"
         }
      },
      "author_association" : "MEMBER",
      "body" : "also just noting that you use `nNew + nTried` to represent size of unique addresses in addrman. this breaks from the convention of using `vRandom.size()`, but makes sense to me. ",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-14T01:09:56Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else {\n+            return *in_new ? nNew : nTried;\n+        }\n+    }\n+    if (auto it = m_map_counts.find(*net); it != m_map_counts.end()) {\n+        auto entry = it->second;\n+        if (!in_new.has_value()) {\n+            return entry.first + entry.second;\n+        } else {\n+            return *in_new ? entry.first : entry.second;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070186177",
      "id" : 1070186177,
      "in_reply_to_id" : 1070185911,
      "line" : 991,
      "node_id" : "PRRC_kwDOABII584_yb7B",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 991,
      "original_position" : 86,
      "original_start_line" : 977,
      "path" : "src/addrman.cpp",
      "position" : 86,
      "pull_request_review_id" : 1248640279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070186177/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 977,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-14T02:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070186177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070187803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070187803"
         }
      },
      "author_association" : "MEMBER",
      "body" : "naming: including the word `map` in the variable name seems like a hungarian notation thing. I believe we're moving away from this convention in the codebase? what do you think about something like `m_network_counts`?",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-14T01:18:53Z",
      "diff_hunk" : "@@ -215,6 +217,9 @@ class AddrManImpl\n     /** Reference to the netgroup manager. netgroupman must be constructed before addrman and destructed after. */\n     const NetGroupManager& m_netgroupman;\n \n+    /** Number of entries in addrman per network and new/tried table. */\n+    std::unordered_map<Network, std::pair<size_t, size_t>> m_map_counts GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070187803",
      "id" : 1070187803,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII584_ycUb",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 221,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/addrman_impl.h",
      "position" : 14,
      "pull_request_review_id" : 1248640279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070187803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-14T02:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070187803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070199579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070199579"
         }
      },
      "author_association" : "MEMBER",
      "body" : "naming: \"fixed seeds\" seems odd to put in the function name because that's the caller - doesn't really have to do with the logic of the function. I think the functionality would better be captured with something like `GetReachableEmptyNetworks()` ",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-14T02:31:10Z",
      "diff_hunk" : "@@ -969,6 +969,12 @@ class CConnman\n     void RecordBytesRecv(uint64_t bytes);\n     void RecordBytesSent(uint64_t bytes) EXCLUSIVE_LOCKS_REQUIRED(!m_total_bytes_sent_mutex);\n \n+    /**\n+     Return networks for which we have no addresses in addrman and therefore\n+     may require loading fixed seeds.\n+     */\n+    std::vector<Network> GetRelevantFixedSeedNetworks() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070199579",
      "id" : 1070199579,
      "line" : 976,
      "node_id" : "PRRC_kwDOABII584_yfMb",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 976,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 8,
      "pull_request_review_id" : 1248640279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070199579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-14T02:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070199579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code looks good. I went through all the addrman touch points to the new & tried tables to double check nothing was missed. tried my best to think through edge cases of what could go wrong and don't have anything :) \r\n\r\nleft a bunch of review comments that are all style related, no blockers. \r\n\r\nanother style related suggestion: what do you think about consolidating the two `size()` functions? adding default params to the newly introduced function means you can remove the old one & none* of the call sites need to change. I tried it out [here](https://github.com/amitiuttarwar/bitcoin/commit/ab188a62bd18668f5a9174db4dadfc398bc02b76). \r\n[*] none of the bitcoind callers. one test call site failed because of the shift from `vRandom.size` to `nNew + nTried`. the test is checking a corrupted addrman, and I don't think the size is testing anything meaningful there, so I removed that check.",
      "created_at" : "2023-01-14T02:46:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1382641983",
      "id" : 1382641983,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26847",
      "node_id" : "IC_kwDOABII585SaXE_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382641983/reactions"
      },
      "updated_at" : "2023-01-14T02:46:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382641983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070278104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070278104"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`m_map_counts` too. The less first/second the better.",
      "commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "created_at" : "2023-01-14T13:46:31Z",
      "diff_hunk" : "@@ -986,6 +1016,7 @@ int AddrManImpl::CheckAddrman() const\n \n     std::unordered_set<int> setTried;\n     std::unordered_map<int, int> mapNew;\n+    std::unordered_map<Network, std::pair<size_t, size_t>> local_counts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070278104",
      "id" : 1070278104,
      "in_reply_to_id" : 1069511892,
      "line" : 1019,
      "node_id" : "PRRC_kwDOABII584_yyXY",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1019,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 97,
      "pull_request_review_id" : 1248784115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070278104/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-14T13:46:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070278104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> ... of what could go wrong and don't have anything ...\r\n\r\nOh, well.\r\n\r\n> _When nothing can possibly go wrong, it will._\r\n\r\n:)\r\n\r\nI guess `nNew` and `m_map_count[].first` could go out of sync in the future. It is good that now they are always updated next to each other (or within 1-2 lines). Further enforcing of this would be to add a new method that modifies both and only change them through this method. E.g.\r\n\r\n```cpp\r\nvoid IncNew(ssize_t delta, Network net)\r\n{\r\n    nNew += delta;\r\n    m_map_count[net].first += delta;\r\n}\r\n```\r\n\r\nOr ditch `nNew` and sum `m_map_count[].first` whenever we would read `nNew`, via a new method like `size_t CountNew() const`? Performance considerations?",
      "created_at" : "2023-01-14T13:56:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1382746084",
      "id" : 1382746084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26847",
      "node_id" : "IC_kwDOABII585Sawfk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382746084/reactions"
      },
      "updated_at" : "2023-01-14T13:56:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382746084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ah, just to clarify, I meant I couldn't identify anything that could go wrong in the _current_ version of the code. ofc things can always go awry in the future, which is why code style is useful to help reduce the chances of that happening :) \r\n\r\n> I guess nNew and m_map_count[].first could go out of sync in the future. It is good that now they are always updated next to each other (or within 1-2 lines). Further enforcing of this would be to add a new method that modifies both and only change them through this method.\r\n\r\nagreed that the counts of `nNew` (and also `nTried`) could go out of sync with the totals in `m_map_count`. it can also be problematic if these values are in sync with each other, but out of sync with the actual values stored on the new / tried tables & other addrman structures. \r\n\r\nthe code added to `CheckAddrman` are helpful because they offer a programatic testing against this inadvertently changing in the future. I don't think having specific \"accessor\" methods makes the most sense because we already have functions that offer logical coupling of creating & removing addrs on addrman*. also, it would require 4 additional functions (increment & decrement / new & tried).\r\n\r\n[*] for eg. other than unserialization, all additions to the new table go through `Addrman::Add`, which calls `AddSingle` which uses `Create` as a helper to construct the `AddrInfo` object & start persisting to internal data structs. my comment [here](https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1070146333) suggested moving incrementing both counts inside the `Create` function. \r\n\r\n> Or ditch nNew and sum m_map_count[].first whenever we would read nNew, via a new method like size_t CountNew() const? Performance considerations?\r\n\r\nthis one I'm more open to. martin pointed out some difficulties in that approach [here](https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1065041916), and I personally think its nbd either way. ",
      "created_at" : "2023-01-14T20:50:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#issuecomment-1382914789",
      "id" : 1382914789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26847",
      "node_id" : "IC_kwDOABII585SbZrl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382914789/reactions"
      },
      "updated_at" : "2023-01-14T20:50:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382914789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071540474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071540474"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like the suggestion and changed it to use the struct in both spots.",
      "commit_id" : "84dfadc5fdd7c951d974ebe37fc3f0e053483fa6",
      "created_at" : "2023-01-16T19:40:46Z",
      "diff_hunk" : "@@ -986,6 +1016,7 @@ int AddrManImpl::CheckAddrman() const\n \n     std::unordered_set<int> setTried;\n     std::unordered_map<int, int> mapNew;\n+    std::unordered_map<Network, std::pair<size_t, size_t>> local_counts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071540474",
      "id" : 1071540474,
      "in_reply_to_id" : 1069511892,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_3mj6",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1019,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1250608902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071540474/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-16T19:40:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071540474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071541292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071541292"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "84dfadc5fdd7c951d974ebe37fc3f0e053483fa6",
      "created_at" : "2023-01-16T19:42:38Z",
      "diff_hunk" : "@@ -215,6 +217,9 @@ class AddrManImpl\n     /** Reference to the netgroup manager. netgroupman must be constructed before addrman and destructed after. */\n     const NetGroupManager& m_netgroupman;\n \n+    /** Number of entries in addrman per network and new/tried table. */\n+    std::unordered_map<Network, std::pair<size_t, size_t>> m_map_counts GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071541292",
      "id" : 1071541292,
      "in_reply_to_id" : 1070187803,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_3mws",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 221,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/addrman_impl.h",
      "position" : null,
      "pull_request_review_id" : 1250610014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071541292/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-16T19:42:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071541292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071543988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071543988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's not needed, but this pattern is also used for other const methods (`GetAddr()`, `Select()`), plus we have a few mutables in AddrMan - since `Check()` is only run if the user enables it, I guess it's better to invoke it once too often rather than not?",
      "commit_id" : "84dfadc5fdd7c951d974ebe37fc3f0e053483fa6",
      "created_at" : "2023-01-16T19:48:15Z",
      "diff_hunk" : "@@ -1074,6 +1118,15 @@ size_t AddrManImpl::size() const\n     return vRandom.size();\n }\n \n+size_t AddrManImpl::size(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    LOCK(cs);\n+    Check();\n+    auto ret = size_(net, in_new);\n+    Check();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071543988",
      "id" : 1071543988,
      "in_reply_to_id" : 1069514507,
      "line" : 1126,
      "node_id" : "PRRC_kwDOABII584_3na0",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1126,
      "original_position" : 143,
      "original_start_line" : 1124,
      "path" : "src/addrman.cpp",
      "position" : 143,
      "pull_request_review_id" : 1250613703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071543988/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1124,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-16T19:48:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071543988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071545598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071545598"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "renamed, thanks",
      "commit_id" : "84dfadc5fdd7c951d974ebe37fc3f0e053483fa6",
      "created_at" : "2023-01-16T19:51:59Z",
      "diff_hunk" : "@@ -969,6 +969,12 @@ class CConnman\n     void RecordBytesRecv(uint64_t bytes);\n     void RecordBytesSent(uint64_t bytes) EXCLUSIVE_LOCKS_REQUIRED(!m_total_bytes_sent_mutex);\n \n+    /**\n+     Return networks for which we have no addresses in addrman and therefore\n+     may require loading fixed seeds.\n+     */\n+    std::vector<Network> GetRelevantFixedSeedNetworks() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071545598",
      "id" : 1071545598,
      "in_reply_to_id" : 1070199579,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_3nz-",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 976,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1250617541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071545598/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-16T19:52:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071545598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071576725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071576725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "f93ff502e17a30e40992ee8d2bd012d8f6062d53",
      "created_at" : "2023-01-16T21:00:37Z",
      "diff_hunk" : "@@ -102,6 +102,13 @@ class AddrMan\n     //! Return the number of (unique) addresses in all tables.\n     size_t size() const;\n \n+    /**\n+    * Return the number of (unique) addresses, optionally filtered by network\n+    * and/or addrman table (new if true, tried if false).\n+    * If any of the optional args are nullopt, don't filter with respect to it.\n+    */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071576725",
      "id" : 1071576725,
      "in_reply_to_id" : 1070179900,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_3vaV",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 108,
      "original_position" : 8,
      "original_start_line" : 105,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 1250659715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071576725/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-16T21:00:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071576725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071577276"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071577276"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I wanted to keep these together. I will add a commit that moves both of these lines into `Create`.",
      "commit_id" : "f93ff502e17a30e40992ee8d2bd012d8f6062d53",
      "created_at" : "2023-01-16T21:01:58Z",
      "diff_hunk" : "@@ -592,6 +599,7 @@ bool AddrManImpl::AddSingle(const CAddress& addr, const CNetAddr& source, std::c\n         pinfo = Create(addr, source, &nId);\n         pinfo->nTime = std::max(NodeSeconds{0s}, pinfo->nTime - time_penalty);\n         nNew++;\n+        m_map_counts[pinfo->GetNetwork()].first++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071577276",
      "id" : 1071577276,
      "in_reply_to_id" : 1070146333,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_3vi8",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 602,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1250660532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071577276/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-16T21:01:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071577276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071578405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071578405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I took your suggestion wrt to the order.\r\n\r\nYes, these need to be identical, but I actually changed it to use the old `vRandom.size()` used in `size()` so that there isn't a change from the status quo when the two `size()` functions are merged as you suggest below.",
      "commit_id" : "f93ff502e17a30e40992ee8d2bd012d8f6062d53",
      "created_at" : "2023-01-16T21:04:40Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const\n+{\n+    AssertLockHeld(cs);\n+\n+    if (!net.has_value()) {\n+        if (!in_new.has_value()) {\n+            return nNew + nTried;\n+        } else {\n+            return *in_new ? nNew : nTried;\n+        }\n+    }\n+    if (auto it = m_map_counts.find(*net); it != m_map_counts.end()) {\n+        auto entry = it->second;\n+        if (!in_new.has_value()) {\n+            return entry.first + entry.second;\n+        } else {\n+            return *in_new ? entry.first : entry.second;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071578405",
      "id" : 1071578405,
      "in_reply_to_id" : 1070185911,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_3v0l",
      "original_commit_id" : "03a094324a14e3be726152ac5b08e2da1e80d8eb",
      "original_line" : 991,
      "original_position" : 86,
      "original_start_line" : 977,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1250662155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071578405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-16T21:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071578405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071583163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071583163"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure if this belongs into AddrMan because of the `IsReachable` - I think the information which networks are reachable belongs into `net`, and possibly at some later point into `CConnman` (I know `vfLimited` is currently a global, but this might change). I don't think it makes sense that `AddrMan` should know or deal with this information, so I think I prefer leaving this out of `AddrMan` and reducing the change of the public interface by combining the `size` functions as suggested by Amiti below.",
      "commit_id" : "f93ff502e17a30e40992ee8d2bd012d8f6062d53",
      "created_at" : "2023-01-16T21:17:06Z",
      "diff_hunk" : "@@ -1575,6 +1575,19 @@ int CConnman::GetExtraBlockRelayCount() const\n     return std::max(block_relay_peers - m_max_outbound_block_relay, 0);\n }\n \n+std::vector<Network> CConnman::GetRelevantFixedSeedNetworks() const\n+{\n+    std::vector<Network> networks{};\n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\n+        if (IsReachable(net) && addrman.size(net, std::nullopt) == 0) {\n+            networks.push_back(net);\n+        }\n+    }\n+    return networks;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071583163",
      "id" : 1071583163,
      "in_reply_to_id" : 1069598095,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_3w-7",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1589,
      "original_position" : 15,
      "original_start_line" : 1578,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1250669103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071583163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-16T21:17:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071583163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071596618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071596618"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "changed it to `unordered_set` as suggested, thanks!",
      "commit_id" : "f93ff502e17a30e40992ee8d2bd012d8f6062d53",
      "created_at" : "2023-01-16T21:51:34Z",
      "diff_hunk" : "@@ -1650,14 +1664,12 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 // We will not make outgoing connections to peers that are unreachable\n                 // (e.g. because of -onlynet configuration).\n                 // Therefore, we do not add them to addrman in the first place.\n-                // Note that if you change -onlynet setting from one network to another,\n-                // peers.dat will contain only peers of unreachable networks and\n-                // manual intervention will be needed (either delete peers.dat after\n-                // configuration change or manually add some reachable peer using addnode),\n-                // see <https://github.com/bitcoin/bitcoin/issues/26035> for details.\n+                // In case previously unreachable networks become reachable\n+                // (e.g. in case of -onlynet changes by the user), fixed seeds will\n+                // be loaded only for networks for which no we have no addressses.\n                 seed_addrs.erase(std::remove_if(seed_addrs.begin(), seed_addrs.end(),\n-                                               [](const CAddress& addr) { return !IsReachable(addr); }),\n-                                seed_addrs.end());\n+                                                [fixed_seed_networks](const CAddress& addr) { return std::find(fixed_seed_networks.begin(), fixed_seed_networks.end(), addr.GetNetwork()) == fixed_seed_networks.end(); }),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071596618",
      "id" : 1071596618,
      "in_reply_to_id" : 1069576904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_30RK",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 1671,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1250687537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071596618/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-16T21:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071596618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071609326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071609326"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I had used lower case for consistency. I now changed it to upper case, and added a commit that removes the old `size()` to always use the new `Size()` as suggested by Amiti. I made that an extra commit because it involved renaming a lot of existing call sites.",
      "commit_id" : "f93ff502e17a30e40992ee8d2bd012d8f6062d53",
      "created_at" : "2023-01-16T22:26:40Z",
      "diff_hunk" : "@@ -962,6 +970,28 @@ std::optional<AddressPosition> AddrManImpl::FindAddressEntry_(const CAddress& ad\n     }\n }\n \n+size_t AddrManImpl::size_(std::optional<Network> net, std::optional<bool> in_new) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26847#discussion_r1071609326",
      "id" : 1071609326,
      "in_reply_to_id" : 1069508106,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_33Xu",
      "original_commit_id" : "c75ca243386eff78d58effd9cd97c38fcfbc7465",
      "original_line" : 973,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1250704641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26847",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071609326/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-16T22:26:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071609326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
