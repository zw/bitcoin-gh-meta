[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [rserranon](https://github.com/bitcoin/bitcoin/pull/26836#pullrequestreview-1314189504), [hernanmarino](https://github.com/bitcoin/bitcoin/pull/26836#pullrequestreview-1358156350) |\n| Approach ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/26836#pullrequestreview-1240419669) |\n| Stale ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/26836#pullrequestreview-1395963136) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28125](https://github.com/bitcoin/bitcoin/pull/28125) (wallet: bugfix, disallow migration of invalid scripts by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-06T13:05:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1373595807",
      "id" : 1373595807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585R32if",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373595807/reactions"
      },
      "updated_at" : "2023-08-24T13:51:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373595807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1117586765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117586765"
         }
      },
      "author_association" : "NONE",
      "body" : "Nit: Shouldn't be better to use the capital B in `LoadAddrBookEntryLablel` and `LoadAddrBookEntryPurpose` as in `GetAddrBookSize` and `ListAddrBookAddreses` ?",
      "commit_id" : "093203ecc2ebf8cea4ff61e9c9858f723b6f1870",
      "created_at" : "2023-02-24T20:12:34Z",
      "diff_hunk" : "@@ -480,6 +480,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n \n     //! Adds a destination data tuple to the store, without saving it to disk\n     void LoadDestData(const CTxDestination& dest, const std::string& key, const std::string& value) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    //! Adds destination label to the store, without saving it to disk\n+    void LoadAddrbookEntryLabel(const CTxDestination& dest, const std::string& label) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1117586765",
      "id" : 1117586765,
      "line" : 484,
      "node_id" : "PRRC_kwDOABII585CnQVN",
      "original_commit_id" : "093203ecc2ebf8cea4ff61e9c9858f723b6f1870",
      "original_line" : 484,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 1314189504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117586765/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-24T23:38:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117586765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/77761?v=4",
         "events_url" : "https://api.github.com/users/rserranon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rserranon/followers",
         "following_url" : "https://api.github.com/users/rserranon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rserranon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rserranon",
         "id" : 77761,
         "login" : "rserranon",
         "node_id" : "MDQ6VXNlcjc3NzYx",
         "organizations_url" : "https://api.github.com/users/rserranon/orgs",
         "received_events_url" : "https://api.github.com/users/rserranon/received_events",
         "repos_url" : "https://api.github.com/users/rserranon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rserranon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rserranon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rserranon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1117807285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117807285"
         }
      },
      "author_association" : "NONE",
      "body" : "Nice optimization!",
      "commit_id" : "093203ecc2ebf8cea4ff61e9c9858f723b6f1870",
      "created_at" : "2023-02-24T23:38:05Z",
      "diff_hunk" : "@@ -2394,31 +2394,42 @@ bool CWallet::SetAddressBook(const CTxDestination& address, const std::string& s\n \n bool CWallet::DelAddressBook(const CTxDestination& address)\n {\n-    bool is_mine;\n+    isminetype is_mine;\n+    const std::string& dest = EncodeDestination(address);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1117807285",
      "id" : 1117807285,
      "line" : 2407,
      "node_id" : "PRRC_kwDOABII585CoGK1",
      "original_commit_id" : "ea6b17d1ae84ad606a6b5de83ced95626d6a219f",
      "original_line" : 2398,
      "original_position" : 6,
      "original_start_line" : 2397,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 1314189504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117807285/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2406,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-24T23:38:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117807285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/77761?v=4",
         "events_url" : "https://api.github.com/users/rserranon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rserranon/followers",
         "following_url" : "https://api.github.com/users/rserranon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rserranon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rserranon",
         "id" : 77761,
         "login" : "rserranon",
         "node_id" : "MDQ6VXNlcjc3NzYx",
         "organizations_url" : "https://api.github.com/users/rserranon/orgs",
         "received_events_url" : "https://api.github.com/users/rserranon/received_events",
         "repos_url" : "https://api.github.com/users/rserranon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rserranon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rserranon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rserranon"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @rserranon.\r\n\r\n> why not encapsulate the other calls to wallet->m_address_book[addr_pair.first].purpose = purpose ?\r\n\r\nGood catch. I did this changes prior the wallet migration PR merge. Will add those too and make the addressbook member private so we don't keep adding more in the future.",
      "created_at" : "2023-02-27T13:53:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1446361158",
      "id" : 1446361158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585WNbhG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1446361158/reactions"
      },
      "updated_at" : "2023-02-27T13:53:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1446361158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1118780133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118780133"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "00539499194cfd98b1401fa307a7b2e8be4fe8f2",
      "created_at" : "2023-02-27T14:03:03Z",
      "diff_hunk" : "@@ -480,6 +480,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n \n     //! Adds a destination data tuple to the store, without saving it to disk\n     void LoadDestData(const CTxDestination& dest, const std::string& key, const std::string& value) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    //! Adds destination label to the store, without saving it to disk\n+    void LoadAddrbookEntryLabel(const CTxDestination& dest, const std::string& label) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1118780133",
      "id" : 1118780133,
      "in_reply_to_id" : 1117586765,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Crzrl",
      "original_commit_id" : "093203ecc2ebf8cea4ff61e9c9858f723b6f1870",
      "original_line" : 484,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1315652790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118780133/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-27T14:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118780133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated per feedback. Now we no longer access the wallet's addressbook member externally.\r\n\r\nPlus, improvements to the address book migration process:\r\n1) Fixed a bug where we don't copy the \"send\" records to all the wallets.\r\n2) Have re-written the process with no code duplication.\r\n3) Batched db writes so the disk dump is done all at once.",
      "created_at" : "2023-02-27T14:13:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1446395076",
      "id" : 1446395076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585WNjzE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1446395076/reactions"
      },
      "updated_at" : "2023-02-27T14:13:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1446395076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1148773136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148773136"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n        bool require_is_mine{record.purpose == \"receive\" && !IsMine(dest)};\r\n        bool copied{false};\r\n```",
      "commit_id" : "00539499194cfd98b1401fa307a7b2e8be4fe8f2",
      "created_at" : "2023-03-27T04:33:48Z",
      "diff_hunk" : "@@ -3928,95 +3970,63 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n         }\n     }\n \n+    // Batch db handlers\n+    std::unique_ptr<WalletBatch> batch_watch_only;\n+    std::unique_ptr<WalletBatch> batch_solvable;\n+    if (data.watchonly_wallet) {\n+        batch_watch_only = std::make_unique<WalletBatch>(data.watchonly_wallet->GetDatabase());\n+        batch_watch_only->TxnBegin();\n+    }\n+    if (data.solvable_wallet) {\n+        batch_solvable = std::make_unique<WalletBatch>(data.solvable_wallet->GetDatabase());\n+        batch_solvable->TxnBegin();\n+    }\n+\n+    // Helper vector to pair wallet with db handler\n+    std::vector<std::pair<std::shared_ptr<CWallet>, WalletBatch*>> wallets_vec = {\n+            {data.watchonly_wallet, batch_watch_only.get()},\n+            {data.solvable_wallet, batch_solvable.get()}\n+    };\n+\n     // Check the address book data in the same way we did for transactions\n     std::vector<CTxDestination> dests_to_delete;\n-    for (const auto& addr_pair : m_address_book) {\n-        // Labels applied to receiving addresses should go based on IsMine\n-        if (addr_pair.second.purpose == \"receive\") {\n-            if (!IsMine(addr_pair.first)) {\n-                // Check the address book data is the watchonly wallet's\n-                if (data.watchonly_wallet) {\n-                    LOCK(data.watchonly_wallet->cs_wallet);\n-                    if (data.watchonly_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the watchonly. Preserve the labels, purpose, and change-ness\n-                        std::string label = addr_pair.second.GetLabel();\n-                        std::string purpose = addr_pair.second.purpose;\n-                        if (!purpose.empty()) {\n-                            data.watchonly_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                        }\n-                        if (!addr_pair.second.IsChange()) {\n-                            data.watchonly_wallet->m_address_book[addr_pair.first].SetLabel(label);\n-                        }\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n-                if (data.solvable_wallet) {\n-                    LOCK(data.solvable_wallet->cs_wallet);\n-                    if (data.solvable_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the solvable. Preserve the labels, purpose, and change-ness\n-                        std::string label = addr_pair.second.GetLabel();\n-                        std::string purpose = addr_pair.second.purpose;\n-                        if (!purpose.empty()) {\n-                            data.solvable_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                        }\n-                        if (!addr_pair.second.IsChange()) {\n-                            data.solvable_wallet->m_address_book[addr_pair.first].SetLabel(label);\n-                        }\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n-                // Not ours, not in watchonly wallet, and not in solvable\n-                error = _(\"Error: Address book data in wallet cannot be identified to belong to migrated wallets\");\n-                return false;\n-            }\n-        } else {\n-            // Labels for everything else (send) should be cloned to all\n-            if (data.watchonly_wallet) {\n-                LOCK(data.watchonly_wallet->cs_wallet);\n-                // Add to the watchonly. Preserve the labels, purpose, and change-ness\n-                std::string label = addr_pair.second.GetLabel();\n-                std::string purpose = addr_pair.second.purpose;\n-                if (!purpose.empty()) {\n-                    data.watchonly_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                }\n-                if (!addr_pair.second.IsChange()) {\n-                    data.watchonly_wallet->m_address_book[addr_pair.first].SetLabel(label);\n-                }\n-                continue;\n-            }\n-            if (data.solvable_wallet) {\n-                LOCK(data.solvable_wallet->cs_wallet);\n-                // Add to the solvable. Preserve the labels, purpose, and change-ness\n-                std::string label = addr_pair.second.GetLabel();\n-                std::string purpose = addr_pair.second.purpose;\n-                if (!purpose.empty()) {\n-                    data.solvable_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                }\n-                if (!addr_pair.second.IsChange()) {\n-                    data.solvable_wallet->m_address_book[addr_pair.first].SetLabel(label);\n+    for (const auto& [dest, record] : m_address_book) {\n+        // Append \"receive\" data to other wallets only if not mine.\n+        // Labels for everything else (\"send\") should be cloned to all.\n+        bool require_is_mine = record.purpose == \"receive\" && !IsMine(dest);\n+        bool copied = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1148773136",
      "id" : 1148773136,
      "line" : 3997,
      "node_id" : "PRRC_kwDOABII585EeOMQ",
      "original_commit_id" : "00539499194cfd98b1401fa307a7b2e8be4fe8f2",
      "original_line" : 3997,
      "original_position" : 229,
      "original_start_line" : 3996,
      "path" : "src/wallet/wallet.cpp",
      "position" : 229,
      "pull_request_review_id" : 1358310127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148773136/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3996,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-27T04:44:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148773136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1148773578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148773578"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    const std::string& dest{EncodeDestination(address)};\r\n```",
      "commit_id" : "00539499194cfd98b1401fa307a7b2e8be4fe8f2",
      "created_at" : "2023-03-27T04:34:57Z",
      "diff_hunk" : "@@ -2394,31 +2410,42 @@ bool CWallet::SetAddressBook(const CTxDestination& address, const std::string& s\n \n bool CWallet::DelAddressBook(const CTxDestination& address)\n {\n-    bool is_mine;\n+    isminetype is_mine;\n+    const std::string& dest = EncodeDestination(address);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1148773578",
      "id" : 1148773578,
      "line" : 2414,
      "node_id" : "PRRC_kwDOABII585EeOTK",
      "original_commit_id" : "00539499194cfd98b1401fa307a7b2e8be4fe8f2",
      "original_line" : 2414,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 55,
      "pull_request_review_id" : 1358310127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148773578/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-27T04:44:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148773578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1149415708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149415708"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I prefer the current code, it's more readable.\r\nThe curly braces initializer is primarily useful to prevent narrowing (which is the implicit conversion of arithmetic values). Here, there is no loss of accuracy, we are simply initializing a boolean from a logical statement.",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2023-03-27T15:21:22Z",
      "diff_hunk" : "@@ -3928,95 +3970,63 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n         }\n     }\n \n+    // Batch db handlers\n+    std::unique_ptr<WalletBatch> batch_watch_only;\n+    std::unique_ptr<WalletBatch> batch_solvable;\n+    if (data.watchonly_wallet) {\n+        batch_watch_only = std::make_unique<WalletBatch>(data.watchonly_wallet->GetDatabase());\n+        batch_watch_only->TxnBegin();\n+    }\n+    if (data.solvable_wallet) {\n+        batch_solvable = std::make_unique<WalletBatch>(data.solvable_wallet->GetDatabase());\n+        batch_solvable->TxnBegin();\n+    }\n+\n+    // Helper vector to pair wallet with db handler\n+    std::vector<std::pair<std::shared_ptr<CWallet>, WalletBatch*>> wallets_vec = {\n+            {data.watchonly_wallet, batch_watch_only.get()},\n+            {data.solvable_wallet, batch_solvable.get()}\n+    };\n+\n     // Check the address book data in the same way we did for transactions\n     std::vector<CTxDestination> dests_to_delete;\n-    for (const auto& addr_pair : m_address_book) {\n-        // Labels applied to receiving addresses should go based on IsMine\n-        if (addr_pair.second.purpose == \"receive\") {\n-            if (!IsMine(addr_pair.first)) {\n-                // Check the address book data is the watchonly wallet's\n-                if (data.watchonly_wallet) {\n-                    LOCK(data.watchonly_wallet->cs_wallet);\n-                    if (data.watchonly_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the watchonly. Preserve the labels, purpose, and change-ness\n-                        std::string label = addr_pair.second.GetLabel();\n-                        std::string purpose = addr_pair.second.purpose;\n-                        if (!purpose.empty()) {\n-                            data.watchonly_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                        }\n-                        if (!addr_pair.second.IsChange()) {\n-                            data.watchonly_wallet->m_address_book[addr_pair.first].SetLabel(label);\n-                        }\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n-                if (data.solvable_wallet) {\n-                    LOCK(data.solvable_wallet->cs_wallet);\n-                    if (data.solvable_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the solvable. Preserve the labels, purpose, and change-ness\n-                        std::string label = addr_pair.second.GetLabel();\n-                        std::string purpose = addr_pair.second.purpose;\n-                        if (!purpose.empty()) {\n-                            data.solvable_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                        }\n-                        if (!addr_pair.second.IsChange()) {\n-                            data.solvable_wallet->m_address_book[addr_pair.first].SetLabel(label);\n-                        }\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n-                // Not ours, not in watchonly wallet, and not in solvable\n-                error = _(\"Error: Address book data in wallet cannot be identified to belong to migrated wallets\");\n-                return false;\n-            }\n-        } else {\n-            // Labels for everything else (send) should be cloned to all\n-            if (data.watchonly_wallet) {\n-                LOCK(data.watchonly_wallet->cs_wallet);\n-                // Add to the watchonly. Preserve the labels, purpose, and change-ness\n-                std::string label = addr_pair.second.GetLabel();\n-                std::string purpose = addr_pair.second.purpose;\n-                if (!purpose.empty()) {\n-                    data.watchonly_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                }\n-                if (!addr_pair.second.IsChange()) {\n-                    data.watchonly_wallet->m_address_book[addr_pair.first].SetLabel(label);\n-                }\n-                continue;\n-            }\n-            if (data.solvable_wallet) {\n-                LOCK(data.solvable_wallet->cs_wallet);\n-                // Add to the solvable. Preserve the labels, purpose, and change-ness\n-                std::string label = addr_pair.second.GetLabel();\n-                std::string purpose = addr_pair.second.purpose;\n-                if (!purpose.empty()) {\n-                    data.solvable_wallet->m_address_book[addr_pair.first].purpose = purpose;\n-                }\n-                if (!addr_pair.second.IsChange()) {\n-                    data.solvable_wallet->m_address_book[addr_pair.first].SetLabel(label);\n+    for (const auto& [dest, record] : m_address_book) {\n+        // Append \"receive\" data to other wallets only if not mine.\n+        // Labels for everything else (\"send\") should be cloned to all.\n+        bool require_is_mine = record.purpose == \"receive\" && !IsMine(dest);\n+        bool copied = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1149415708",
      "id" : 1149415708,
      "in_reply_to_id" : 1148773136,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EgrEc",
      "original_commit_id" : "00539499194cfd98b1401fa307a7b2e8be4fe8f2",
      "original_line" : 4035,
      "original_position" : 229,
      "original_start_line" : 3996,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1359310691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149415708/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-27T15:21:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149415708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1149436821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149436821"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks but same as above, I prefer current code as it's more readable and there is no possible narrowing issue here.",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2023-03-27T15:36:43Z",
      "diff_hunk" : "@@ -2394,31 +2410,42 @@ bool CWallet::SetAddressBook(const CTxDestination& address, const std::string& s\n \n bool CWallet::DelAddressBook(const CTxDestination& address)\n {\n-    bool is_mine;\n+    isminetype is_mine;\n+    const std::string& dest = EncodeDestination(address);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1149436821",
      "id" : 1149436821,
      "in_reply_to_id" : 1148773578,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EgwOV",
      "original_commit_id" : "00539499194cfd98b1401fa307a7b2e8be4fe8f2",
      "original_line" : 2462,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1359342610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149436821/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-27T15:36:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149436821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, conflicts solved.\r\nPlus, per https://github.com/bitcoin/bitcoin/pull/26761#discussion_r1134636537 request, added coverage for wallet address book migration process.",
      "created_at" : "2023-04-12T16:12:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1505555162",
      "id" : 1505555162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585ZvPLa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505555162/reactions"
      },
      "updated_at" : "2023-04-12T16:12:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505555162",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased post #27224 merge, conflicts solved.",
      "created_at" : "2023-05-01T12:32:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1529669583",
      "id" : 1529669583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585bLOfP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529669583/reactions"
      },
      "updated_at" : "2023-05-01T12:32:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529669583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-27T02:23:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1565165658",
      "id" : 1565165658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585dSoha",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565165658/reactions"
      },
      "updated_at" : "2023-05-27T02:23:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565165658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2023-05-31T15:37:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1570466415",
      "id" : 1570466415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585dm2pv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1570466415/reactions"
      },
      "updated_at" : "2023-05-31T15:37:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1570466415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased, conflicts solved.",
      "created_at" : "2023-06-21T15:19:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1601039679",
      "id" : 1601039679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585fbe0_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601039679/reactions"
      },
      "updated_at" : "2023-06-21T15:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601039679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-28T01:13:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1610435670",
      "id" : 1610435670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585f_UxW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1610435670/reactions"
      },
      "updated_at" : "2023-06-28T01:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1610435670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR ends up doing a lot of different things that are only tangentially related. I think it could be split up into a few smaller PRs, e.g. one for the migration fix, one for the migration refactoring, and one for the other refactors.",
      "created_at" : "2023-07-06T15:42:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1623901650",
      "id" : 1623901650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585gysXS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623901650/reactions"
      },
      "updated_at" : "2023-07-06T15:42:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623901650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-07T17:00:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1625693900",
      "id" : 1625693900,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585g5h7M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625693900/reactions"
      },
      "updated_at" : "2023-07-07T17:00:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625693900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-19T18:17:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1726258444",
      "id" : 1726258444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585m5J0M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726258444/reactions"
      },
      "updated_at" : "2023-09-19T18:17:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726258444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2023-12-19T01:53:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#issuecomment-1861975704",
      "id" : 1861975704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
      "node_id" : "IC_kwDOABII585u-36Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1861975704/reactions"
      },
      "updated_at" : "2023-12-19T01:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1861975704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476616953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476616953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"wallet: clean redundancies in DelAddressBook\" (https://github.com/bitcoin/bitcoin/pull/26836/commits/da3b8f927c2da5b7761e36fe548eb8ade29171d7):\r\n\r\nnit: your commit message mentions \"Call IsMine only once (instead of two)\" but I don't see any IsMine related changes in the commit?",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2024-02-02T19:52:19Z",
      "diff_hunk" : "@@ -2385,6 +2385,7 @@ bool CWallet::SetAddressBook(const CTxDestination& address, const std::string& s\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476616953",
      "id" : 1476616953,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YA2L5",
      "original_commit_id" : "da3b8f927c2da5b7761e36fe548eb8ade29171d7",
      "original_line" : 2385,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1860220702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476616953/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T21:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476616953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476626408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476626408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"refactor: SetAddrBookWithDB, signal only if write succeeded\" (https://github.com/bitcoin/bitcoin/pull/26836/commits/0b83c8691b277d407e61a8ffca807e65866f4ded):\r\n\r\nMaybe do `encoded_dest = EncodeDestination(address)` and then use that to avoid calling `EncodeDestination` twice?",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2024-02-02T19:57:59Z",
      "diff_hunk" : "@@ -2368,13 +2368,21 @@ bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& add\n             purpose = m_address_book[address].purpose;\n         }\n     }\n+\n+    if (new_purpose && !batch.WritePurpose(EncodeDestination(address), PurposeToString(*new_purpose))) {\n+        WalletLogPrintf(\"%s error writing purpose\\n\", __func__);\n+        return false;\n+    }\n+    if (!batch.WriteName(EncodeDestination(address), strName)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476626408",
      "id" : 1476626408,
      "line" : 2377,
      "node_id" : "PRRC_kwDOABII585YA4fo",
      "original_commit_id" : "0b83c8691b277d407e61a8ffca807e65866f4ded",
      "original_line" : 2376,
      "original_position" : 9,
      "original_start_line" : 2372,
      "path" : "src/wallet/wallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 1860220702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476626408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2373,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-02T21:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476626408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476632077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476632077"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"refactor: SetAddressBookWithDB, minimize number of map lookups\" (https://github.com/bitcoin/bitcoin/pull/26836/commits/10f9639fd6332cdd440f540c2202082044aab98c):\r\n\r\nnit: unnecessary formatting change",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2024-02-02T20:02:08Z",
      "diff_hunk" : "@@ -2359,14 +2359,15 @@ bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& add\n     {\n         LOCK(cs_wallet);\n         std::map<CTxDestination, CAddressBookData>::iterator mi = m_address_book.find(address);\n-        fUpdated = (mi != m_address_book.end() && !mi->second.IsChange());\n-        m_address_book[address].SetLabel(strName);\n+        fUpdated = mi != m_address_book.end() && !mi->second.IsChange();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476632077",
      "id" : 1476632077,
      "line" : 2362,
      "node_id" : "PRRC_kwDOABII585YA54N",
      "original_commit_id" : "10f9639fd6332cdd440f540c2202082044aab98c",
      "original_line" : 2362,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 1860220702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476632077/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T21:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476632077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476711835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476711835"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"refactor: wallet, simplify addressbook migration\" (https://github.com/bitcoin/bitcoin/pull/26836/commits/8b331613bf79ab614850e71a603dd444d6bb3a48):\r\n\r\nThis is a pretty thorny block of code with all of the booleans, let me summarize just to make sure I'm following:\r\n\r\n* If the destination requires_transfer but isn't ours, go to the next wallet. If this happens for both wallets, copy will never be set and we will fail\r\n* If it requires transfer and does belong to the current wallet in the loop, continue and set copy = true, and add the destination to `dests_to_delete`. Do not check the next wallet. I'm assuming the assumption here is it can only belong to one of the wallets, and if it *does* end up happening to belong to both wallets this is not an issue?\r\n* If it does not require transfer, we always copy it, and copy is always set to true, so we are fine for the next block\r\n\r\nMight be worth adding a comment explaining why its okay to break early? That's the part that kinda threw me.",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2024-02-02T20:45:04Z",
      "diff_hunk" : "@@ -3999,52 +3999,41 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n \n     // Check the address book data in the same way we did for transactions\n     std::vector<CTxDestination> dests_to_delete;\n-    for (const auto& addr_pair : m_address_book) {\n-        // Labels applied to receiving addresses should go based on IsMine\n-        if (addr_pair.second.purpose == AddressPurpose::RECEIVE) {\n-            if (!IsMine(addr_pair.first)) {\n-                // Check the address book data is the watchonly wallet's\n-                if (data.watchonly_wallet) {\n-                    LOCK(data.watchonly_wallet->cs_wallet);\n-                    if (data.watchonly_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the watchonly. Copy the entire address book entry\n-                        data.watchonly_wallet->m_address_book[addr_pair.first] = addr_pair.second;\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n-                if (data.solvable_wallet) {\n-                    LOCK(data.solvable_wallet->cs_wallet);\n-                    if (data.solvable_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the solvable. Copy the entire address book entry\n-                        data.solvable_wallet->m_address_book[addr_pair.first] = addr_pair.second;\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n+    for (const auto& [dest, record] : m_address_book) {\n+        // Ensure \"receive\" entries that are no longer part of the original wallet are transferred to another wallet\n+        // Entries for everything else (\"send\") will be cloned to all wallets.\n+        bool require_transfer = record.purpose == AddressPurpose::RECEIVE && !IsMine(dest);\n+        bool copied = false;\n+        for (auto& wallet : {data.watchonly_wallet, data.solvable_wallet}) {\n+            if (!wallet) continue;\n+\n+            LOCK(wallet->cs_wallet);\n+            if (require_transfer && !wallet->IsMine(dest)) continue;\n+\n+            // Copy the entire address book entry\n+            wallet->m_address_book[dest] = record;\n+\n+            copied = true;\n+            // Only delete 'receive' records that are no longer part of the original wallet\n+            if (require_transfer) {\n+                dests_to_delete.push_back(dest);\n+                break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476711835",
      "id" : 1476711835,
      "line" : 4048,
      "node_id" : "PRRC_kwDOABII585YBNWb",
      "original_commit_id" : "8b331613bf79ab614850e71a603dd444d6bb3a48",
      "original_line" : 4020,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 147,
      "pull_request_review_id" : 1860220702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476711835/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T21:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476711835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476718674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476718674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"wallet: migration, batch addressbook records removal\" (https://github.com/bitcoin/bitcoin/pull/26836/commits/3aff6d5b4f3fd32ad1285b259db0ef1580518e39):\r\n\r\nnit: most other places in the codebase we use `DB` in functions names (as opposed to `Db`)",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2024-02-02T20:54:59Z",
      "diff_hunk" : "@@ -2394,8 +2394,13 @@ bool CWallet::SetAddressBook(const CTxDestination& address, const std::string& s\n \n bool CWallet::DelAddressBook(const CTxDestination& address)\n {\n-    const std::string& dest = EncodeDestination(address);\n     WalletBatch batch(GetDatabase());\n+    return DelAddressBookWithDb(batch, address);\n+}\n+\n+bool CWallet::DelAddressBookWithDb(WalletBatch& batch, const CTxDestination& address)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476718674",
      "id" : 1476718674,
      "line" : 2401,
      "node_id" : "PRRC_kwDOABII585YBPBS",
      "original_commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "original_line" : 2401,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 1860220702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476718674/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T21:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476718674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476724914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476724914"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"refactor: wallet, simplify addressbook migration\" (https://github.com/bitcoin/bitcoin/pull/26836/commits/8b331613bf79ab614850e71a603dd444d6bb3a48):\r\n\r\nnit: C++20 has `.contains(arg)` for sets (yay!). No performance difference, but semantically I think it makes a lot more sense to use when testing for existence.",
      "commit_id" : "3aff6d5b4f3fd32ad1285b259db0ef1580518e39",
      "created_at" : "2024-02-02T21:00:47Z",
      "diff_hunk" : "@@ -3999,52 +3999,41 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n \n     // Check the address book data in the same way we did for transactions\n     std::vector<CTxDestination> dests_to_delete;\n-    for (const auto& addr_pair : m_address_book) {\n-        // Labels applied to receiving addresses should go based on IsMine\n-        if (addr_pair.second.purpose == AddressPurpose::RECEIVE) {\n-            if (!IsMine(addr_pair.first)) {\n-                // Check the address book data is the watchonly wallet's\n-                if (data.watchonly_wallet) {\n-                    LOCK(data.watchonly_wallet->cs_wallet);\n-                    if (data.watchonly_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the watchonly. Copy the entire address book entry\n-                        data.watchonly_wallet->m_address_book[addr_pair.first] = addr_pair.second;\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n-                if (data.solvable_wallet) {\n-                    LOCK(data.solvable_wallet->cs_wallet);\n-                    if (data.solvable_wallet->IsMine(addr_pair.first)) {\n-                        // Add to the solvable. Copy the entire address book entry\n-                        data.solvable_wallet->m_address_book[addr_pair.first] = addr_pair.second;\n-                        dests_to_delete.push_back(addr_pair.first);\n-                        continue;\n-                    }\n-                }\n+    for (const auto& [dest, record] : m_address_book) {\n+        // Ensure \"receive\" entries that are no longer part of the original wallet are transferred to another wallet\n+        // Entries for everything else (\"send\") will be cloned to all wallets.\n+        bool require_transfer = record.purpose == AddressPurpose::RECEIVE && !IsMine(dest);\n+        bool copied = false;\n+        for (auto& wallet : {data.watchonly_wallet, data.solvable_wallet}) {\n+            if (!wallet) continue;\n+\n+            LOCK(wallet->cs_wallet);\n+            if (require_transfer && !wallet->IsMine(dest)) continue;\n+\n+            // Copy the entire address book entry\n+            wallet->m_address_book[dest] = record;\n+\n+            copied = true;\n+            // Only delete 'receive' records that are no longer part of the original wallet\n+            if (require_transfer) {\n+                dests_to_delete.push_back(dest);\n+                break;\n+            }\n+        }\n \n-                // Skip invalid/non-watched scripts that will not be migrated\n-                if (not_migrated_dests.count(addr_pair.first) > 0) {\n-                    dests_to_delete.push_back(addr_pair.first);\n-                    continue;\n-                }\n+        // Fail immediately if we ever found an entry that was ours and cannot be transferred\n+        // to any of the created wallets (watch-only, solvable).\n+        // Means that no inferred descriptor maps to the stored entry. Which mustn't happen.\n+        if (require_transfer && !copied) {\n \n-                // Not ours, not in watchonly wallet, and not in solvable\n-                error = _(\"Error: Address book data in wallet cannot be identified to belong to migrated wallets\");\n-                return false;\n-            }\n-        } else {\n-            // Labels for everything else (\"send\") should be cloned to all\n-            if (data.watchonly_wallet) {\n-                LOCK(data.watchonly_wallet->cs_wallet);\n-                // Add to the watchonly. Copy the entire address book entry\n-                data.watchonly_wallet->m_address_book[addr_pair.first] = addr_pair.second;\n-            }\n-            if (data.solvable_wallet) {\n-                LOCK(data.solvable_wallet->cs_wallet);\n-                // Add to the solvable. Copy the entire address book entry\n-                data.solvable_wallet->m_address_book[addr_pair.first] = addr_pair.second;\n+            // Skip invalid/non-watched scripts that will not be migrated\n+            if (not_migrated_dests.count(dest) > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26836#discussion_r1476724914",
      "id" : 1476724914,
      "line" : 4058,
      "node_id" : "PRRC_kwDOABII585YBQiy",
      "original_commit_id" : "8b331613bf79ab614850e71a603dd444d6bb3a48",
      "original_line" : 4030,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 177,
      "pull_request_review_id" : 1860220702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476724914/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T21:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476724914",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   }
]
