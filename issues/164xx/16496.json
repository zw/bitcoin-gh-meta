{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "## Overview\r\n\r\nWith initial Guix building support having landed in #15277, we should start thinking about what features are lacking, and which ones are required for a transition of our release process to Guix.\r\n\r\n**ATTN**: I'm actively looking for feedback on this, please don't hesitate to ask for clarification or propose changes!\r\n\r\n## Features\r\n\r\n### Prerequisites for Release Process transition\r\n\r\n- [ ] Non-Linux cross-compilation\r\n  - [ ] OS X\r\n    - [ ] x86_64-apple-darwin14\r\n  - [ ] Windows\r\n    - [ ] x86_64-w64-mingw32\r\n- [ ] Signing and verification\r\n- [ ] Inferiors (reproducibility across time)\r\n  - [ ] Filesystem channels (Guix upstream feature)\r\n- [ ] Guix release process documentation\r\n\r\n### Nice-to-have's\r\n\r\n- [ ] APT repository for Guix itself\r\n- [ ] Finer-grain documentation of compiler/glibc/linux-header versions\r\n- [ ] `guix environment` as a single-command development setup tool\r\n- [ ] Guix importer for depends syntax\r\n\r\n## Details and Notes\r\n\r\n### Non-Linux cross-compilation\r\n\r\n#### OS X\r\n\r\nOur `native_cctools` package in depends assumes that the base system is Ubuntu, and downloads a binary clang. There needs to be a way to use a system-supplied clang. It seems that forks of Bitcoin Core already have that functionality, so it should be back ported: https://github.com/bitcoin/bitcoin/pull/15277#issuecomment-511026840\r\n\r\n#### Windows\r\n\r\nPorting NSIS to Guix was somewhat difficult the last time I attempted it, mostly because I don't know `scons` that well and NSIS doesn't have great compilation documentation.\r\n\r\n### Signing and verification\r\n\r\nI looked briefly into `signify`, but decided that we don't want to put the burden of extra key material on maintainers. Current thought is that a clear signature of the `find output/ -type f -print0 | sort -z | xargs -r0 sha256sum` might be sufficient.\r\n\r\n### Inferiors\r\n\r\nWork has mostly been finished on my branch here: https://github.com/bitcoin/bitcoin/compare/master...dongcarl:2019-06-guix-channels-and-inferiors ([commit-ish permalink](https://github.com/bitcoin/bitcoin/compare/master...dongcarl:8c10542c509b0c67be6bb487ff18ecb53c535c21))\r\n\r\nI did some thorough testing of the inferiors infrastructure with this branch and found a bug, reported here: https://issues.guix.gnu.org/issue/36777\r\n\r\nLuckily we were able to bisect where the error was introduced and lead Guix maintainers are actively helping with this issue.\r\n\r\n#### Filesystem channels\r\n\r\nA Guix channel is like a debian APT repository but more powerful. Right now in my branch, we use my `bitcoin-guix` channel ([seen here](\r\n https://github.com/bitcoin/bitcoin/blob/8c10542c509b0c67be6bb487ff18ecb53c535c21/contrib/guix/manifest.scm#L6)) which supplies all of the bitcoin-specific toolchain packages, as [seen here](https://github.com/dongcarl/bitcoin-guix/blob/9b221d425b000975b2e0d1632658f1558b9d2e05/packages.scm).\r\n\r\nI'd much prefer to embed this channel into the bitcoin repository, but right now Guix channels can only refer to git repositories. After asking on IRC, this seems like a feature that the other Guix maintainers want as well, so it should be implemented and used.\r\n\r\n#### APT repository for Guix itself\r\n\r\nA debian maintainer Vagrant Cascadian has done most of the heavy-lifting here: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=850644, however, he warned me that it might be a while before it gets into debian proper, so we could have an APT repository for Guix to make the installation process for Guix easier.\r\n\r\n### Finer-grain documentation of compiler/glibc/linux-header versions\r\n\r\nRight now we are using:\r\n```\r\ngcc-9\r\nglibc-2.27\r\nlinux-libre-headers-4.19\r\n```\r\n\r\nThis can be verified [here](https://github.com/dongcarl/bitcoin-guix/blob/9b221d425b000975b2e0d1632658f1558b9d2e05/packages.scm#L90). We can now explicitly document this, as it won't change at the whim of Ubuntu developers. ([motivating example](https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306447252))\r\n\r\n### `guix environment` as a single-command development setup tool\r\n\r\nRight now, on any machine with `guix` installed, `guix environment --manifest=contrib/guix/manifest.scm` sets up a native build environment for depends. I would like to extend this to also be able to setup a cross-build environment. And with \"Guix importer for depends syntax\", `guix environment --manifest=contrib/guix/manifest.scm` can even build the dependencies.\r\n\r\n### Guix importer for depends syntax\r\n\r\nAFAIK @nothingmuch has gotten started on this. It will allow for automatic generation of Guix package definitions of our depends packages so that we can maintain a single source of truth but get the caching/inferior/etc. benefits of native Guix packages.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16496/comments",
   "created_at" : "2019-07-30T17:50:25Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16496/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/16496",
   "id" : 474718293,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "id" : 61889416,
         "name" : "Build system",
         "node_id" : "MDU6TGFiZWw2MTg4OTQxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16496/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU0NzQ3MTgyOTM=",
   "number" : 16496,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[Chasing Feedback] guix: Tracking ticket for eventual release build transition",
   "updated_at" : "2019-07-30T17:50:25Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16496",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
      "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dongcarl/followers",
      "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dongcarl",
      "id" : 3445290,
      "login" : "dongcarl",
      "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
      "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
      "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
      "repos_url" : "https://api.github.com/users/dongcarl/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dongcarl"
   }
}
