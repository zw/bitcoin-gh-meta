{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "After updating to bitcoin-0.14.0-x86_64-linux-gnu, bitcoind will no longer shut down cleanly with a bitcoin-cli stop or the kill command. A kill -9 is required to make the process terminate.\r\n\r\nTested on three separate fully updated CentOS 6 installations with kernel 2.6.32-642.15.1.el6.x86_64, all of which were behaving normally with 0.13.2. Two of the nodes have pruning enabled with prune=8192, while the third is a non-pruning node. The configuration is otherwise identical:\r\n\r\nmaxconnections=512\r\ndisablewallet=1\r\ndbcache=1000\r\nupnp=0\r\ndns=0\r\ndnsseed=0\r\n\r\nDebug log with debug=1 ends with:\r\n\r\n2017-03-08 13:51:49 Received a POST request for / from 127.0.0.1:49740\r\n2017-03-08 13:51:49 ThreadRPCServer method=stop\r\n2017-03-08 13:51:50 Interrupting HTTP server\r\n2017-03-08 13:51:50 Interrupting HTTP RPC server\r\n2017-03-08 13:51:50 Exited http event loop\r\n2017-03-08 13:51:50 Interrupting RPC\r\n2017-03-08 13:51:50 tor: Thread interrupt\r\n2017-03-08 13:51:50 torcontrol thread exit\r\n2017-03-08 13:51:50 scheduler thread interrupt\r\n2017-03-08 13:51:50 Shutdown: In progress...\r\n2017-03-08 13:51:50 Stopping HTTP RPC server\r\n2017-03-08 13:51:50 Unregistering HTTP handler for / (exactmatch 1)\r\n2017-03-08 13:51:50 Stopping RPC\r\n2017-03-08 13:51:50 RPC stopped.\r\n2017-03-08 13:51:50 Stopping HTTP server\r\n2017-03-08 13:51:50 Waiting for HTTP worker threads to exit\r\n2017-03-08 13:51:50 Waiting for HTTP event thread to exit\r\n2017-03-08 13:51:50 Stopped HTTP server\r\n2017-03-08 13:51:50 net thread exit\r\n2017-03-08 13:51:50 msghand thread exit\r\n2017-03-08 13:51:53 opencon thread exit\r\n\r\nHalf an hour later, bitcoind is still running, and does not seem to be using any CPU or generating any IO. It does not terminate active connections, and the socket is still listening and accepting new connections, but no data appears to be exchanged. getpeerinfo from another node for a connection established after the shutdown says:\r\n\r\n    \"lastsend\": 1488982201,\r\n    \"lastrecv\": 0,\r\n    \"bytessent\": 126,\r\n    \"bytesrecv\": 0,\r\n    \"conntime\": 1488982201,\r\n\r\nThe issue seems to be ~80% reproducible with the given setup and configuration if bitcoind has been running for a few minutes, otherwise it seems to always shut down normally.",
   "closed_at" : "2017-03-18T08:06:09Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 12,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9950/comments",
   "created_at" : "2017-03-08T14:38:51Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9950/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/9950",
   "id" : 212751800,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9950/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUyMTI3NTE4MDA=",
   "number" : 9950,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "v0.14.0 shutdown hangs",
   "updated_at" : "2017-03-18T08:06:09Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9950",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/17721714?v=4",
      "events_url" : "https://api.github.com/users/Celean/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Celean/followers",
      "following_url" : "https://api.github.com/users/Celean/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Celean/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Celean",
      "id" : 17721714,
      "login" : "Celean",
      "node_id" : "MDQ6VXNlcjE3NzIxNzE0",
      "organizations_url" : "https://api.github.com/users/Celean/orgs",
      "received_events_url" : "https://api.github.com/users/Celean/received_events",
      "repos_url" : "https://api.github.com/users/Celean/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Celean/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Celean/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Celean"
   }
}
