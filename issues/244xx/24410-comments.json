[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-02-21T23:10:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1047287840",
      "id" : 1047287840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII584-bFgg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047287840/reactions"
      },
      "updated_at" : "2022-02-21T23:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047287840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed a7883ac7a4 -> c46aafaf11\r\n- Rebased over master\r\n- Made the scripted-diff actually work",
      "created_at" : "2022-04-28T16:50:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1112436660",
      "id" : 1112436660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CTm-0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112436660/reactions"
      },
      "updated_at" : "2022-04-28T16:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112436660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Would an alternative be to treat assumeutxo as not part of the kernel for now (and completely move it out?)",
      "created_at" : "2022-04-28T18:13:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1112516341",
      "id" : 1112516341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CT6b1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112516341/reactions"
      },
      "updated_at" : "2022-04-28T18:13:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112516341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke \r\n\r\n> Would an alternative be to treat assumeutxo as not part of the kernel for now (and completely move it out?)\r\n\r\nSure, but I don't prefer that alternative. I think it would actually be more work to extract assumeutxo from the kernel, plus if you look at the `GetUTXOStats` function and friends prior to this PR, it needed quite some cleaning up, which is done in this PR.",
      "created_at" : "2022-04-28T19:02:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1112556891",
      "id" : 1112556891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CUEVb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112556891/reactions"
      },
      "updated_at" : "2022-04-28T19:02:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112556891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-04-28T19:11:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1112564268",
      "id" : 1112564268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CUGIs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112564268/reactions"
      },
      "updated_at" : "2022-04-28T19:11:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112564268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25065](https://github.com/bitcoin/bitcoin/pull/25065) ([kernel 2c/n] Extract only what we use of `init/common.cpp` by dongcarl)\n* [#24897](https://github.com/bitcoin/bitcoin/pull/24897) ([Draft / POC] Silent Payments by w0xlt)\n* [#19792](https://github.com/bitcoin/bitcoin/pull/19792) (rpc: Add dumpcoinstats by fjahr)\n* [#13462](https://github.com/bitcoin/bitcoin/pull/13462) (Make SER_GETHASH implicit for CHashWriter and SerializeHash by Empact)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-29T01:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1112789149",
      "id" : 1112789149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CU9Cd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112789149/reactions"
      },
      "updated_at" : "2022-05-05T22:34:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112789149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps it's just my system, but the `feature_coinstatsindex.py` bitcoind does not get terminated after a successful run. This causes my script running tests against each commit to fail. All the other tests terminate just fine, and this happens running all tests and the test individually.\r\n\r\nThe logs appear to show the test and node sutting down, but this does not appear to be the case in practice.\r\n\r\n```log\r\n[I] [11:19] ubuntu:bitcoin (2022-02-libbitcoinkernel-p2-coinstats-minimal) | â¿ test/functional/feature_coinstatsindex.py\r\n2022-04-29T10:20:14.316000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_so5w4sxf\r\n2022-04-29T10:20:15.704000Z TestFramework (INFO): Test that gettxoutsetinfo() output is consistent with or without coinstatsindex option\r\n2022-04-29T10:20:15.758000Z TestFramework (INFO): Test that gettxoutsetinfo() can get fetch data on specific heights with index\r\n2022-04-29T10:20:15.850000Z TestFramework (INFO): Test gettxoutsetinfo() with index and verbose flag\r\n2022-04-29T10:20:15.963000Z TestFramework (INFO): Test that the index is robust across restarts\r\n2022-04-29T10:20:16.419000Z TestFramework (INFO): Test that the index works with -reindex\r\n2022-04-29T10:20:17.198000Z TestFramework (INFO): Test that -reindex-chainstate is disallowed with coinstatsindex\r\n2022-04-29T10:20:17.363000Z TestFramework (INFO): Test use_index option for nodes running the index\r\n2022-04-29T10:20:17.450000Z TestFramework (INFO): Test that index can handle reorgs\r\n> /home/will/src/bitcoin/test/functional/feature_coinstatsindex.py(55)run_test()\r\n-> self._test_index_rejects_hash_serialized()\r\n(Pdb) l\r\n 50             self.wallet = MiniWallet(self.nodes[0])\r\n 51             self._test_coin_stats_index()\r\n 52             self._test_use_index_option()\r\n 53             self._test_reorg_index()\r\n 54             import pdb; pdb.set_trace()\r\n 55  ->         self._test_index_rejects_hash_serialized()\r\n 56\r\n 57         def block_sanity_check(self, block_info):\r\n 58             block_subsidy = 50\r\n 59             assert_equal(\r\n 60                 block_info['prevout_spent'] + block_subsidy,\r\n(Pdb) n\r\n2022-04-29T10:20:38.130000Z TestFramework (INFO): Test that the rpc raises if the legacy hash is passed with the index\r\n--Return--\r\n> /home/will/src/bitcoin/test/functional/feature_coinstatsindex.py(55)run_test()->None\r\n-> self._test_index_rejects_hash_serialized()\r\n(Pdb) n\r\n> /home/will/src/bitcoin/test/functional/test_framework/test_framework.py(156)main()\r\n-> exit_code = self.shutdown()\r\n(Pdb) n\r\n2022-04-29T10:20:43.555000Z TestFramework (INFO): Stopping nodes\r\n2022-04-29T10:20:43.657000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_so5w4sxf on exit\r\n2022-04-29T10:20:43.657000Z TestFramework (INFO): Tests successful\r\n> /home/will/src/bitcoin/test/functional/test_framework/test_framework.py(157)main()\r\n-> sys.exit(exit_code)\r\n(Pdb) n\r\nSystemExit: 0\r\n> /home/will/src/bitcoin/test/functional/test_framework/test_framework.py(157)main()\r\n-> sys.exit(exit_code)\r\n(Pdb) c\r\n[I] [11:20] ubuntu:bitcoin (2022-02-libbitcoinkernel-p2-coinstats-minimal) | â¿ ps -Af | rg bitcoind\r\nwill        6695    3480  0 Apr28 ?        00:14:46 bitcoind\r\nwill      586063    3480  0 11:20 pts/8    00:00:00 /home/will/src/bitcoin/src/bitcoind -datadir=/tmp/bitcoin_func_test_so5w4sxf/node1 -logtimemicros -debug -debugexclude=libevent -debugexclude=leveldb -uacomment=testnode1 -logthreadnames -logsourcelocations -coinstatsindex -reindex\r\n```",
      "created_at" : "2022-04-29T10:28:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113152684",
      "id" : 1113152684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CWVys",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113152684/reactions"
      },
      "updated_at" : "2022-04-29T22:23:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113152684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@willcl-ark Interesting observation but I tested it on master and I see the same behaviour there too! (you should verify!) So this is unrelated to this PR's changes. Perhaps you'd like to open a separate Issue about this?",
      "created_at" : "2022-04-29T18:55:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113628467",
      "id" : 1113628467,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CYJ8z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113628467/reactions"
      },
      "updated_at" : "2022-04-29T22:23:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113628467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @willcl-ark Interesting observation but I tested it on master and I see the same behaviour there too! (you should verify!) So this is unrelated to this PR's changes. Perhaps you'd like to open a separate Issue about this?\r\n\r\nThat was an oversight by me in #24789. I opened #25034 to fix this.",
      "created_at" : "2022-04-29T19:49:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113666128",
      "id" : 1113666128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CYTJQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113666128/reactions"
      },
      "updated_at" : "2022-04-29T22:23:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113666128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > @willcl-ark Interesting observation but I tested it on master and I see the same behaviour there too! (you should verify!) So this is unrelated to this PR's changes. Perhaps you'd like to open a separate Issue about this?\r\n> \r\n> That was an oversight by me in #24789. I opened #25034 to fix this.\r\n\r\nAh thanks Martin, that would explain it. I will cherry-pick that and re-run then :)",
      "created_at" : "2022-04-29T19:52:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113668686",
      "id" : 1113668686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CYTxO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113668686/reactions"
      },
      "updated_at" : "2022-04-29T22:23:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113668686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande cherry-picking https://github.com/bitcoin/bitcoin/commit/5345f752313c6bd7164109bdfd64ca3a55647c22 does indeed fix and allow all tests to pass at each commit in this PR",
      "created_at" : "2022-04-29T22:19:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113811978",
      "id" : 1113811978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CY2wK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113811978/reactions"
      },
      "updated_at" : "2022-04-29T22:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113811978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@willcl-ark Okay for me to hide your comments so as to not confuse future reviewers?",
      "created_at" : "2022-04-29T22:21:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113815501",
      "id" : 1113815501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CY3nN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113815501/reactions"
      },
      "updated_at" : "2022-04-29T22:21:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113815501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @willcl-ark Okay for me to hide your comments so as to not confuse future reviewers?\n\nPlease go ahead!",
      "created_at" : "2022-04-29T22:22:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113817513",
      "id" : 1113817513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CY4Gp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113817513/reactions"
      },
      "updated_at" : "2022-04-29T22:22:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113817513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 756f1a755d138e36a9e50e7e4e46ae0bcd3975ca -> 30503c98a8bc97b582f072c34168b5279d65a492\r\n- Added commit \"fuzz: Remove useless GetUTXOStats fuzz case\", adjusted subsequent commits\r\n- Removed some extraneous whitespace in scripted-diff\r\n\r\n-----\r\n\r\nReviewers: Please let me know if the new \"fuzz: Remove useless GetUTXOStats fuzz case\" commit looks okay.\r\n\r\nPing @practicalswift ",
      "created_at" : "2022-04-29T22:27:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1113826113",
      "id" : 1113826113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CY6NB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113826113/reactions"
      },
      "updated_at" : "2022-04-29T22:27:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113826113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r862389785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862389785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "commit f2f72edaadb03b52271a14906094530e23b3806c:\r\n\r\nWould it make sense to simplify the final interface in coinstatsindex?\r\nI didn't try it out, but if `CoinStatsIndex::LookUpStats()` was refactored to set `index_used = true` internally and return an `std::optional<kernel::CCoinsStats>`, while the `LookupBlockIndex()` path was already done in  `rpc/blockchain.cpp`, we could directly call that and get rid of the two `GetUTXOStatsWithIndex()` functions and have just one public `CoinStatsIndex` member function to return the statistics.",
      "commit_id" : "cfbe8efb08e42d404306c5d59d4a2e0719b2a788",
      "created_at" : "2022-04-30T19:39:02Z",
      "diff_hunk" : "@@ -62,4 +66,7 @@ class CoinStatsIndex final : public BaseIndex\n /// The global UTXO set hash object.\n extern std::unique_ptr<CoinStatsIndex> g_coin_stats_index;\n \n+std::optional<kernel::CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, const CBlockIndex* pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r862389785",
      "id" : 862389785,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zZwYZ",
      "original_commit_id" : "f2f72edaadb03b52271a14906094530e23b3806c",
      "original_line" : 69,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.h",
      "position" : null,
      "pull_request_review_id" : 958515100,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862389785/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-30T20:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862389785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r862390168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862390168"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Commit 55c4a9ddeefdbe7a97bc9d908003693e3ff71968:\r\n\r\nI think the added `JSONRPCError` for the call of `pindex->pprev`  makes this not a pure refactor (but an improvement, seems like an oversight that the result wasn't checked before!). Maybe mention this in the commit message.\r\nAlso, CacheSizes -> CCoinsStats in the commit msg?",
      "commit_id" : "cfbe8efb08e42d404306c5d59d4a2e0719b2a788",
      "created_at" : "2022-04-30T19:45:50Z",
      "diff_hunk" : "@@ -922,9 +924,13 @@ static RPCHelpMan gettxoutsetinfo()\n             ret.pushKV(\"total_unspendable_amount\", ValueFromAmount(stats.total_unspendable_amount));\n \n             CCoinsStats prev_stats{};\n-\n             if (pindex->nHeight > 0) {\n-                GetUTXOStats(coins_view, *blockman, prev_stats, hash_type, node.rpc_interruption_point, pindex->pprev, index_requested);\n+                const std::optional<CCoinsStats> maybe_prev_stats = GetUTXOStats(coins_view, *blockman, hash_type, node.rpc_interruption_point, pindex->pprev, index_requested);\n+                if (maybe_prev_stats.has_value()) {\n+                    prev_stats = maybe_prev_stats.value();\n+                } else {\n+                    throw JSONRPCError(RPC_INTERNAL_ERROR, \"Unable to read UTXO set\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r862390168",
      "id" : 862390168,
      "line" : 954,
      "node_id" : "PRRC_kwDOABII584zZweY",
      "original_commit_id" : "55c4a9ddeefdbe7a97bc9d908003693e3ff71968",
      "original_line" : 954,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 108,
      "pull_request_review_id" : 958515100,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862390168/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-30T20:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862390168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r863090809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863090809"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Great idea! See: 7dbebb3a9c4ea691b11659f2b91e1e4b8e847251",
      "commit_id" : "cfbe8efb08e42d404306c5d59d4a2e0719b2a788",
      "created_at" : "2022-05-02T18:42:21Z",
      "diff_hunk" : "@@ -62,4 +66,7 @@ class CoinStatsIndex final : public BaseIndex\n /// The global UTXO set hash object.\n extern std::unique_ptr<CoinStatsIndex> g_coin_stats_index;\n \n+std::optional<kernel::CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, const CBlockIndex* pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r863090809",
      "id" : 863090809,
      "in_reply_to_id" : 862389785,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zcbh5",
      "original_commit_id" : "f2f72edaadb03b52271a14906094530e23b3806c",
      "original_line" : 69,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.h",
      "position" : null,
      "pull_request_review_id" : 959420815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863090809/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-02T18:42:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863090809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r863091676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863091676"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, I added some info in the commit message. Will be making the commit messages better in the coming days! 2155489fe6d103bdca26c0875058d563a3e8d5c0",
      "commit_id" : "cfbe8efb08e42d404306c5d59d4a2e0719b2a788",
      "created_at" : "2022-05-02T18:43:35Z",
      "diff_hunk" : "@@ -922,9 +924,13 @@ static RPCHelpMan gettxoutsetinfo()\n             ret.pushKV(\"total_unspendable_amount\", ValueFromAmount(stats.total_unspendable_amount));\n \n             CCoinsStats prev_stats{};\n-\n             if (pindex->nHeight > 0) {\n-                GetUTXOStats(coins_view, *blockman, prev_stats, hash_type, node.rpc_interruption_point, pindex->pprev, index_requested);\n+                const std::optional<CCoinsStats> maybe_prev_stats = GetUTXOStats(coins_view, *blockman, hash_type, node.rpc_interruption_point, pindex->pprev, index_requested);\n+                if (maybe_prev_stats.has_value()) {\n+                    prev_stats = maybe_prev_stats.value();\n+                } else {\n+                    throw JSONRPCError(RPC_INTERNAL_ERROR, \"Unable to read UTXO set\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r863091676",
      "id" : 863091676,
      "in_reply_to_id" : 862390168,
      "line" : 954,
      "node_id" : "PRRC_kwDOABII584zcbvc",
      "original_commit_id" : "55c4a9ddeefdbe7a97bc9d908003693e3ff71968",
      "original_line" : 954,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 108,
      "pull_request_review_id" : 959422120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863091676/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-02T18:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863091676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 30503c98a8bc97b582f072c34168b5279d65a492 -> cfbe8efb08e42d404306c5d59d4a2e0719b2a788\r\n- Merged `GetUTXOStatsWithIndex()` logic into `CoinStatsIndex::LookUpStats()` as mentioned here: https://github.com/bitcoin/bitcoin/pull/24410#discussion_r862389785 (Thanks Martin!)",
      "created_at" : "2022-05-03T18:40:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1116436377",
      "id" : 1116436377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585Ci3eZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116436377/reactions"
      },
      "updated_at" : "2022-05-03T18:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116436377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed cfbe8efb08e42d404306c5d59d4a2e0719b2a788 -> 06dea7ea36eb1606cd4255e2875d0e4fe2fdd5a4\r\n- Rebased over master for merge of #25034\r\n- Fleshed out commit messages\r\n- Added previously missing (even before this PR) `BOOST_CHECK`s in \"Move logic from GetUTXOStatsWithIndex to CoinStatsIndex::LookUpStats\" (b3d18d7bfcfeba7ef3ead5de0ee9bd58300609e9)\r\n- Moved more declarations out of the \"public header\" in \"coinstats: Split node/coinstats.h to kernel/**.h\" (c4ab9ff40f1499f4abd2dd1915733c86bc4bccbf)\r\n- Added commit at the beginning: \"kernel: Remove unnecessary index/blockfilterindex.cpp\" to account for merge of #21726\r\n\r\n-----\r\n\r\nThis PR is now \"Very Ready for Review\" ð ",
      "created_at" : "2022-05-03T22:39:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1116726714",
      "id" : 1116726714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585Cj-W6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116726714/reactions"
      },
      "updated_at" : "2022-05-03T22:40:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116726714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864313827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864313827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Commit messages are now complete! ð ",
      "commit_id" : "06dea7ea36eb1606cd4255e2875d0e4fe2fdd5a4",
      "created_at" : "2022-05-03T22:45:51Z",
      "diff_hunk" : "@@ -922,9 +924,13 @@ static RPCHelpMan gettxoutsetinfo()\n             ret.pushKV(\"total_unspendable_amount\", ValueFromAmount(stats.total_unspendable_amount));\n \n             CCoinsStats prev_stats{};\n-\n             if (pindex->nHeight > 0) {\n-                GetUTXOStats(coins_view, *blockman, prev_stats, hash_type, node.rpc_interruption_point, pindex->pprev, index_requested);\n+                const std::optional<CCoinsStats> maybe_prev_stats = GetUTXOStats(coins_view, *blockman, hash_type, node.rpc_interruption_point, pindex->pprev, index_requested);\n+                if (maybe_prev_stats.has_value()) {\n+                    prev_stats = maybe_prev_stats.value();\n+                } else {\n+                    throw JSONRPCError(RPC_INTERNAL_ERROR, \"Unable to read UTXO set\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864313827",
      "id" : 864313827,
      "in_reply_to_id" : 862390168,
      "line" : 955,
      "node_id" : "PRRC_kwDOABII584zhGHj",
      "original_commit_id" : "55c4a9ddeefdbe7a97bc9d908003693e3ff71968",
      "original_line" : 955,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 108,
      "pull_request_review_id" : 961163598,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864313827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-03T22:45:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864313827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864313946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864313946"
         }
      },
      "author_association" : "NONE",
      "body" : "[]()",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-03T22:46:07Z",
      "diff_hunk" : "@@ -12,10 +12,11 @@\n #include <undo.h>\n #include <validation.h>\n \n-using node::CCoinsStats;\n-using node::GetBogoSize;\n+using kernel::CCoinsStats;\n+using kernel::GetBogoSize;\n+using kernel::TxOutSer;\n+\n using node::ReadBlockFromDisk;\n-using node::TxOutSer;\n using node::UndoReadFromDisk;\n \n static constexpr uint8_t DB_BLOCK_HASH{'s'};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864313946",
      "id" : 864313946,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII584zhGJa",
      "original_commit_id" : "06dea7ea36eb1606cd4255e2875d0e4fe2fdd5a4",
      "original_line" : 22,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : 14,
      "pull_request_review_id" : 961163812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864313946/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-04T09:09:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864313946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/103429474?v=4",
         "events_url" : "https://api.github.com/users/Miminlaili/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Miminlaili/followers",
         "following_url" : "https://api.github.com/users/Miminlaili/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Miminlaili/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Miminlaili",
         "id" : 103429474,
         "login" : "Miminlaili",
         "node_id" : "U_kgDOBio1Yg",
         "organizations_url" : "https://api.github.com/users/Miminlaili/orgs",
         "received_events_url" : "https://api.github.com/users/Miminlaili/received_events",
         "repos_url" : "https://api.github.com/users/Miminlaili/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Miminlaili/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Miminlaili/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Miminlaili"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864314103"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314103"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\n     return db.Read(DBHashKey(block_index->GetBlockHash()), result);\n```\n",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-03T22:46:31Z",
      "diff_hunk" : "@@ -316,28 +317,31 @@ static bool LookUpOne(const CDBWrapper& db, const CBlockIndex* block_index, DBVa\n     return db.Read(DBHashKey(block_index->GetBlockHash()), result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864314103",
      "id" : 864314103,
      "line" : 317,
      "node_id" : "PRRC_kwDOABII584zhGL3",
      "original_commit_id" : "06dea7ea36eb1606cd4255e2875d0e4fe2fdd5a4",
      "original_line" : 317,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : 16,
      "pull_request_review_id" : 961163812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314103/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-04T09:09:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/103429474?v=4",
         "events_url" : "https://api.github.com/users/Miminlaili/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Miminlaili/followers",
         "following_url" : "https://api.github.com/users/Miminlaili/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Miminlaili/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Miminlaili",
         "id" : 103429474,
         "login" : "Miminlaili",
         "node_id" : "U_kgDOBio1Yg",
         "organizations_url" : "https://api.github.com/users/Miminlaili/orgs",
         "received_events_url" : "https://api.github.com/users/Miminlaili/received_events",
         "repos_url" : "https://api.github.com/users/Miminlaili/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Miminlaili/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Miminlaili/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Miminlaili"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864314342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314342"
         }
      },
      "author_association" : "NONE",
      "body" : "- [ ] ",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-03T22:47:05Z",
      "diff_hunk" : "@@ -316,28 +317,31 @@ static bool LookUpOne(const CDBWrapper& db, const CBlockIndex* block_index, DBVa\n     return db.Read(DBHashKey(block_index->GetBlockHash()), result);\n }\n \n-bool CoinStatsIndex::LookUpStats(const CBlockIndex* block_index, CCoinsStats& coins_stats) const\n+std::optional<CCoinsStats> CoinStatsIndex::LookUpStats(const CBlockIndex* block_index) const\n {\n+    CCoinsStats stats = kernel::MakeCoinStatsPrefilledWithBlockIndexInfo(block_index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864314342",
      "id" : 864314342,
      "line" : 322,
      "node_id" : "PRRC_kwDOABII584zhGPm",
      "original_commit_id" : "06dea7ea36eb1606cd4255e2875d0e4fe2fdd5a4",
      "original_line" : 322,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : 22,
      "pull_request_review_id" : 961163812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314342/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-04T09:09:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/103429474?v=4",
         "events_url" : "https://api.github.com/users/Miminlaili/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Miminlaili/followers",
         "following_url" : "https://api.github.com/users/Miminlaili/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Miminlaili/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Miminlaili",
         "id" : 103429474,
         "login" : "Miminlaili",
         "node_id" : "U_kgDOBio1Yg",
         "organizations_url" : "https://api.github.com/users/Miminlaili/orgs",
         "received_events_url" : "https://api.github.com/users/Miminlaili/received_events",
         "repos_url" : "https://api.github.com/users/Miminlaili/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Miminlaili/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Miminlaili/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Miminlaili"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864314591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314591"
         }
      },
      "author_association" : "NONE",
      "body" : "- [ ] ",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-03T22:47:37Z",
      "diff_hunk" : "@@ -316,28 +317,31 @@ static bool LookUpOne(const CDBWrapper& db, const CBlockIndex* block_index, DBVa\n     return db.Read(DBHashKey(block_index->GetBlockHash()), result);\n }\n \n-bool CoinStatsIndex::LookUpStats(const CBlockIndex* block_index, CCoinsStats& coins_stats) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r864314591",
      "id" : 864314591,
      "line" : 319,
      "node_id" : "PRRC_kwDOABII584zhGTf",
      "original_commit_id" : "06dea7ea36eb1606cd4255e2875d0e4fe2fdd5a4",
      "original_line" : 319,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : 19,
      "pull_request_review_id" : 961163812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314591/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-04T09:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864314591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/103429474?v=4",
         "events_url" : "https://api.github.com/users/Miminlaili/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Miminlaili/followers",
         "following_url" : "https://api.github.com/users/Miminlaili/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Miminlaili/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Miminlaili",
         "id" : 103429474,
         "login" : "Miminlaili",
         "node_id" : "U_kgDOBio1Yg",
         "organizations_url" : "https://api.github.com/users/Miminlaili/orgs",
         "received_events_url" : "https://api.github.com/users/Miminlaili/received_events",
         "repos_url" : "https://api.github.com/users/Miminlaili/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Miminlaili/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Miminlaili/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Miminlaili"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 06dea7ea36eb1606cd4255e2875d0e4fe2fdd5a4 -> 660bb3066fff29bd2a16ea3adf9748d58f53363c\r\n- Also remove `blockfilter.cpp` from `libbitcoinkernel_la_SOURCES` (Thanks past Carl for leaving a TODO!)",
      "created_at" : "2022-05-04T18:45:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1117683619",
      "id" : 1117683619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585Cnn-j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1117683619/reactions"
      },
      "updated_at" : "2022-05-04T18:45:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1117683619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've gotten the feedback that the distinction between:\r\n\r\n- `src/kernel/coinstats.h`, and\r\n- `src/kernel/include/coinstats.h`\r\n\r\nIs probably not necessary in Phase 1 of the libbitcoinkernel project and potentially confusing and lead to churn since the public one (`src/kernel/include/coinstats.h`) is likely to be drastically changed in Phase 2. I will combine them in this and future libbitcoinkernel Phase 1 PRs if there's not much opposition to that. Shouldn't affect the meat of this PR that much.",
      "created_at" : "2022-05-05T19:48:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1118984576",
      "id" : 1118984576,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CslmA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1118984576/reactions"
      },
      "updated_at" : "2022-05-05T19:48:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1118984576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 660bb3066fff29bd2a16ea3adf9748d58f53363c -> 8f50fe837eaa41b045c69a97617b2346d57bd879\r\n- Addressed: https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1118984576",
      "created_at" : "2022-05-05T22:09:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1119089915",
      "id" : 1119089915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585Cs_T7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119089915/reactions"
      },
      "updated_at" : "2022-05-05T22:09:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119089915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-06T08:50:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1119396359",
      "id" : 1119396359,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585CuKIH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119396359/reactions"
      },
      "updated_at" : "2022-05-06T08:50:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119396359",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r867504665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: unnecessary blank line",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-08T15:07:11Z",
      "diff_hunk" : "@@ -809,6 +808,28 @@ CoinStatsHashType ParseHashType(const std::string& hash_type_input)\n     }\n }\n \n+//! Calculate statistics about the unspent transaction output set\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r867504665",
      "id" : 867504665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ztRIZ",
      "original_commit_id" : "8f50fe837eaa41b045c69a97617b2346d57bd879",
      "original_line" : 812,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 965452018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:32:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868120837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868120837"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As a neat side-effect, I believe this makes `CCoinsStats` moveable, which might actually be a helpful optimization.",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T15:07:30Z",
      "diff_hunk" : "@@ -28,9 +28,6 @@ enum class CoinStatsHashType {\n };\n \n struct CCoinsStats {\n-    //! Which hash type to use\n-    const CoinStatsHashType m_hash_type;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868120837",
      "id" : 868120837,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII584zvnkF",
      "original_commit_id" : "82148cec1c18c41fbc16f1deadf1f576755f9c52",
      "original_line" : 32,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : 5,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868120837/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868120837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868137623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868137623"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to handle this at build-time with a template param instead? I don't feel strongly, but to me `GetUTXOStats<CoinStatsHashType::MUHASH>(...)` more effectively communicates that this is the \"mode\" of the function, as opposed to it being a random parameter.\r\n\r\nThe implementation function is already templated anyway so I don't think it'd be a big change.\r\n\r\nI know this function is going to change more in subsequent commits, so ignore ^^ if something else moots it.",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T15:22:57Z",
      "diff_hunk" : "@@ -69,12 +66,10 @@ struct CCoinsStats {\n     CAmount total_unspendables_scripts{0};\n     //! Total cumulative amount of coins lost due to unclaimed miner rewards up to and including this block\n     CAmount total_unspendables_unclaimed_rewards{0};\n-\n-    CCoinsStats(CoinStatsHashType hash_type) : m_hash_type(hash_type) {}\n };\n \n //! Calculate statistics about the unspent transaction output set\n-bool GetUTXOStats(CCoinsView* view, node::BlockManager& blockman, CCoinsStats& stats, const std::function<void()>& interruption_point = {}, const CBlockIndex* pindex = nullptr);\n+bool GetUTXOStats(CCoinsView* view, node::BlockManager& blockman, CCoinsStats& stats, CoinStatsHashType hash_type, const std::function<void()>& interruption_point = {}, const CBlockIndex* pindex = nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868137623",
      "id" : 868137623,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zvrqX",
      "original_commit_id" : "82148cec1c18c41fbc16f1deadf1f576755f9c52",
      "original_line" : 72,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : 20,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868137623/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868137623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868141603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868141603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So the stats will no longer \"remember\" their hash type, but presumably that's never a problem because the caller always knows?",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T15:26:49Z",
      "diff_hunk" : "@@ -69,12 +66,10 @@ struct CCoinsStats {\n     CAmount total_unspendables_scripts{0};\n     //! Total cumulative amount of coins lost due to unclaimed miner rewards up to and including this block\n     CAmount total_unspendables_unclaimed_rewards{0};\n-\n-    CCoinsStats(CoinStatsHashType hash_type) : m_hash_type(hash_type) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868141603",
      "id" : 868141603,
      "line" : 73,
      "node_id" : "PRRC_kwDOABII584zvsoj",
      "original_commit_id" : "82148cec1c18c41fbc16f1deadf1f576755f9c52",
      "original_line" : 73,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : 15,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868141603/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868141603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868360164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868360164"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there any reason to ever declare a base `UTXOHasher`? Maybe give it a protected constructor?\r\n\r\nEdit: I suppose the pure virtual function takes care of that, but imo a protected constructor is a nice way of communicating that the base class is not for direct use.",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-09T19:25:50Z",
      "diff_hunk" : "@@ -78,6 +78,112 @@ static void ApplyHash(MuHash3072& muhash, const uint256& hash, const std::map<ui\n     }\n }\n \n+class UTXOHasher\n+{\n+public:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868360164",
      "id" : 868360164,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zwh_k",
      "original_commit_id" : "c853e71d4d43a4ed17a35216d0f353a793c29c2d",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868360164/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T15:26:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868360164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868360900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868360900"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to make these subclasses final?",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T19:26:33Z",
      "diff_hunk" : "@@ -78,6 +78,112 @@ static void ApplyHash(MuHash3072& muhash, const uint256& hash, const std::map<ui\n     }\n }\n \n+class UTXOHasher\n+{\n+public:\n+    virtual void Prepare(const uint256& hash_block){};\n+    virtual void Apply(const uint256& hash, const std::map<uint32_t, Coin>& outputs){};\n+    virtual uint256 Finalize() = 0;\n+    virtual ~UTXOHasher();\n+};\n+\n+UTXOHasher::~UTXOHasher() = default;\n+\n+class NullHasher : public UTXOHasher {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868360900",
      "id" : 868360900,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zwiLE",
      "original_commit_id" : "c853e71d4d43a4ed17a35216d0f353a793c29c2d",
      "original_line" : 92,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : 15,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868360900/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868360900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868368343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868368343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, since this is no longer set as a side-effect of finalization, I'm not sure `hashSerialized` still belongs in `CCoinsStats`? IIUC the caller is now essentially responsible for its sanity, no?\r\n\r\nEdit: Or maybe `Finalize()` should take a `CCoinsStats` reference?",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T19:34:02Z",
      "diff_hunk" : "@@ -241,31 +240,19 @@ static bool GetUTXOStats(CCoinsView* view, BlockManager& blockman, CCoinsStats&\n     }\n     if (!outputs.empty()) {\n         ApplyStats(stats, prevkey, outputs);\n-        ApplyHash(hash_obj, prevkey, outputs);\n+        hasher.Apply(prevkey, outputs);\n     }\n \n-    FinalizeHash(hash_obj, stats);\n+    stats.hashSerialized = hasher.Finalize();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868368343",
      "id" : 868368343,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zwj_X",
      "original_commit_id" : "1f37d453ed6a3d5bda82cdff0c861c26b7cf5a1c",
      "original_line" : 246,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : 37,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868368343/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868368343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868406549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868406549"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same comment as with `hashSerialized`. `index_used` does not seem to be a value internal to `CCoinsStats` anymore.",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T20:11:27Z",
      "diff_hunk" : "@@ -206,17 +202,52 @@ static bool GetUTXOStats(CCoinsView* view, BlockManager& blockman, CCoinsStats&\n     stats.hashSerialized = hasher.Finalize();\n \n     stats.nDiskSize = view->EstimateSize();\n+\n     return true;\n }\n \n-std::optional<CCoinsStats> GetUTXOStats(CCoinsView* view, BlockManager& blockman, CoinStatsHashType hash_type, const std::function<void()>& interruption_point, const CBlockIndex* pindex, bool index_requested)\n+std::optional<CCoinsStats> GetUTXOStatsWithHasher(UTXOHasher& hasher, CCoinsView* view, BlockManager& blockman, const std::function<void()>& interruption_point)\n {\n-    CCoinsStats stats{};\n-    auto hasher = MakeUTXOHasher(hash_type);\n+    CBlockIndex* pindex = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    GetUTXOStatsWithHasher(hasher, stats, view, blockman, interruption_point);\n \n-    if (!GetUTXOStats(view, blockman, stats, *hasher, interruption_point, pindex, hash_type, index_requested)) {\n+    return stats;\n+}\n+\n+std::optional<CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, const CBlockIndex* pindex)\n+{\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    stats.index_used = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868406549",
      "id" : 868406549,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zwtUV",
      "original_commit_id" : "8c8d3f186df95b419fba8fddaeaac9b8912646dd",
      "original_line" : 223,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : 60,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868406549/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868406549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868411598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868411598"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not make this a ctor which takes a `CBlockIndex*` and prefills itself?",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T20:16:39Z",
      "diff_hunk" : "@@ -76,6 +76,8 @@ std::optional<CCoinsStats> GetUTXOStats(CCoinsView* view, node::BlockManager& bl\n uint64_t GetBogoSize(const CScript& script_pub_key);\n \n CDataStream TxOutSer(const COutPoint& outpoint, const Coin& coin);\n+\n+CCoinsStats MakeCoinStatsPrefilledWithBlockIndexInfo(const CBlockIndex* pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868411598",
      "id" : 868411598,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII584zwujO",
      "original_commit_id" : "f05882c453d94c6e87f82f2cba9bdf1c0c85143a",
      "original_line" : 80,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : 5,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868411598/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868411598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868420205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868420205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note to other reviewers, the `node/coinstats.h` is deleted in subsequent commits, so the fact that they share a filename isn't really interesting.",
      "commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "created_at" : "2022-05-09T20:24:48Z",
      "diff_hunk" : "@@ -0,0 +1,88 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_KERNEL_COINSTATS_H",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868420205",
      "id" : 868420205,
      "line" : 5,
      "node_id" : "PRRC_kwDOABII584zwwpt",
      "original_commit_id" : "05979e6e63741fab64b743a8da3e8f0a453b52cd",
      "original_line" : 5,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/kernel/coinstats.h",
      "position" : 5,
      "pull_request_review_id" : 966310447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868420205/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T20:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868420205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868450711"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868450711"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: These specific Make functions seem a bit redundant and could be probably be inlined",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-09T20:53:13Z",
      "diff_hunk" : "@@ -78,6 +78,112 @@ static void ApplyHash(MuHash3072& muhash, const uint256& hash, const std::map<ui\n     }\n }\n \n+class UTXOHasher\n+{\n+public:\n+    virtual void Prepare(const uint256& hash_block){};\n+    virtual void Apply(const uint256& hash, const std::map<uint32_t, Coin>& outputs){};\n+    virtual uint256 Finalize() = 0;\n+    virtual ~UTXOHasher();\n+};\n+\n+UTXOHasher::~UTXOHasher() = default;\n+\n+class NullHasher : public UTXOHasher {\n+public:\n+    uint256 Finalize() override {\n+        return {};\n+    }\n+};\n+\n+std::unique_ptr<UTXOHasher> MakeNullHasher() {\n+    return std::make_unique<NullHasher>();\n+}\n+\n+class SHA256DHasher : public UTXOHasher\n+{\n+    CHashWriter ss{SER_GETHASH, PROTOCOL_VERSION};\n+public:\n+    // The legacy hash serializes the hashBlock\n+    void Prepare(const uint256& hash_block) override {\n+        ss << hash_block;\n+    }\n+\n+    //! Warning: be very careful when changing this! assumeutxo and UTXO snapshot\n+    //! validation commitments are reliant on the hash constructed by this\n+    //! function.\n+    //!\n+    //! If the construction of this hash is changed, it will invalidate\n+    //! existing UTXO snapshots. This will not result in any kind of consensus\n+    //! failure, but it will force clients that were expecting to make use of\n+    //! assumeutxo to do traditional IBD instead.\n+    //!\n+    //! It is also possible, though very unlikely, that a change in this\n+    //! construction could cause a previously invalid (and potentially malicious)\n+    //! UTXO snapshot to be considered valid.\n+    void Apply(const uint256& hash, const std::map<uint32_t, Coin>& outputs) override {\n+        for (auto it = outputs.begin(); it != outputs.end(); ++it) {\n+            if (it == outputs.begin()) {\n+                ss << hash;\n+                ss << VARINT(it->second.nHeight * 2 + it->second.fCoinBase ? 1u : 0u);\n+            }\n+\n+            ss << VARINT(it->first + 1);\n+            ss << it->second.out.scriptPubKey;\n+            ss << VARINT_MODE(it->second.out.nValue, VarIntMode::NONNEGATIVE_SIGNED);\n+\n+            if (it == std::prev(outputs.end())) {\n+                ss << VARINT(0u);\n+            }\n+        }\n+    }\n+    uint256 Finalize() override {\n+        return ss.GetHash();\n+    }\n+};\n+\n+std::unique_ptr<UTXOHasher> MakeSHA256DHasher() {\n+    return std::make_unique<SHA256DHasher>();\n+}\n+\n+class MuHashHasher : public UTXOHasher\n+{\n+    MuHash3072 muhash;\n+public:\n+    void Apply(const uint256& hash, const std::map<uint32_t, Coin>& outputs) override {\n+        for (auto it = outputs.begin(); it != outputs.end(); ++it) {\n+            COutPoint outpoint = COutPoint(hash, it->first);\n+            Coin coin = it->second;\n+            muhash.Insert(MakeUCharSpan(TxOutSer(outpoint, coin)));\n+        }\n+    }\n+    uint256 Finalize() override {\n+        uint256 out;\n+        muhash.Finalize(out);\n+        return out;\n+    }\n+};\n+\n+std::unique_ptr<UTXOHasher> MakeMuHashHasher() {\n+    return std::make_unique<MuHashHasher>();\n+}\n+\n+std::unique_ptr<UTXOHasher> MakeUTXOHasher(const CoinStatsHashType& hash_type)\n+{\n+    switch (hash_type) {\n+    case(CoinStatsHashType::HASH_SERIALIZED): {\n+        return MakeSHA256DHasher();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868450711",
      "id" : 868450711,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zw4GX",
      "original_commit_id" : "c853e71d4d43a4ed17a35216d0f353a793c29c2d",
      "original_line" : 175,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 965452018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868450711/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:32:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868450711",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868494388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868494388"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `::cs_main`",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-09T21:40:46Z",
      "diff_hunk" : "@@ -206,17 +202,52 @@ static bool GetUTXOStats(CCoinsView* view, BlockManager& blockman, CCoinsStats&\n     stats.hashSerialized = hasher.Finalize();\n \n     stats.nDiskSize = view->EstimateSize();\n+\n     return true;\n }\n \n-std::optional<CCoinsStats> GetUTXOStats(CCoinsView* view, BlockManager& blockman, CoinStatsHashType hash_type, const std::function<void()>& interruption_point, const CBlockIndex* pindex, bool index_requested)\n+std::optional<CCoinsStats> GetUTXOStatsWithHasher(UTXOHasher& hasher, CCoinsView* view, BlockManager& blockman, const std::function<void()>& interruption_point)\n {\n-    CCoinsStats stats{};\n-    auto hasher = MakeUTXOHasher(hash_type);\n+    CBlockIndex* pindex = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    GetUTXOStatsWithHasher(hasher, stats, view, blockman, interruption_point);\n \n-    if (!GetUTXOStats(view, blockman, stats, *hasher, interruption_point, pindex, hash_type, index_requested)) {\n+    return stats;\n+}\n+\n+std::optional<CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, const CBlockIndex* pindex)\n+{\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    stats.index_used = true;\n+    if (!coin_stats_index.LookUpStats(pindex, stats)) {\n         return std::nullopt;\n     }\n+\n     return stats;\n }\n+\n+std::optional<CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, CCoinsView* view, BlockManager& blockman)\n+{\n+    CBlockIndex* pindex = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868494388",
      "id" : 868494388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zxCw0",
      "original_commit_id" : "8c8d3f186df95b419fba8fddaeaac9b8912646dd",
      "original_line" : 233,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 965452018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868494388/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:32:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868494388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868521835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868521835"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe we could make an even clearer naming distinction here. While we can really only \"get\" the stats from the index the kernel computes them. So the kernel function could be renamed to `ComputeUTXOStatsWithHasher`. But it's fine to leave it as is. I just found it an interesting thought and interested to hear what others think.",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-09T22:11:35Z",
      "diff_hunk" : "@@ -809,6 +808,28 @@ CoinStatsHashType ParseHashType(const std::string& hash_type_input)\n     }\n }\n \n+//! Calculate statistics about the unspent transaction output set\n+\n+std::optional<kernel::CCoinsStats> GetUTXOStats(CCoinsView* view, node::BlockManager& blockman,\n+                                                kernel::CoinStatsHashType hash_type,\n+                                                const std::function<void()>& interruption_point = {},\n+                                                const CBlockIndex* pindex = nullptr,\n+                                                bool index_requested = true)\n+{\n+    // Use CoinStatsIndex if it is requested and available and a hash_type of Muhash or None was requested\n+    if ((hash_type == kernel::CoinStatsHashType::MUHASH || hash_type == kernel::CoinStatsHashType::NONE) && g_coin_stats_index && index_requested) {\n+        if (pindex) {\n+            return g_coin_stats_index->LookUpStats(pindex);\n+        } else {\n+            CBlockIndex* block_index = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));\n+            return g_coin_stats_index->LookUpStats(block_index);\n+        }\n+    }\n+\n+    auto hasher = kernel::MakeUTXOHasher(hash_type);\n+    return kernel::GetUTXOStatsWithHasher(*hasher, view, blockman, interruption_point);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868521835",
      "id" : 868521835,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zxJdr",
      "original_commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "original_line" : 830,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 965452018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868521835/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:40:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868521835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868527557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868527557"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree, I was going to leave a nit that this is a bit verbose for my taste ;)",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-09T22:18:15Z",
      "diff_hunk" : "@@ -76,6 +76,8 @@ std::optional<CCoinsStats> GetUTXOStats(CCoinsView* view, node::BlockManager& bl\n uint64_t GetBogoSize(const CScript& script_pub_key);\n \n CDataStream TxOutSer(const COutPoint& outpoint, const Coin& coin);\n+\n+CCoinsStats MakeCoinStatsPrefilledWithBlockIndexInfo(const CBlockIndex* pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r868527557",
      "id" : 868527557,
      "in_reply_to_id" : 868411598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zxK3F",
      "original_commit_id" : "f05882c453d94c6e87f82f2cba9bdf1c0c85143a",
      "original_line" : 80,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : null,
      "pull_request_review_id" : 965452018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868527557/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:32:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868527557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869644871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869644871"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Maybe give it a protected constructor?\r\n\r\nI'm a bit confused here, is the intent just to convey in code that it's a \"virtual base class\" by protecting the constructor? Would a code comment suffice?\r\n\r\n> Is there any reason to ever declare a base `UTXOHasher`?\r\n\r\nMy initial thought was that leaving the abstract `UTXOHasher` in the header (as done in commits subsequent to the one you're commenting on) could allow users to provide their specific implementation (e.g. they have some hash accelerator that we can't make use of).\r\n\r\nThis was very easily achieved by just leaving the class in the header, but I don't want to waste any time thinking about this at all so if you feel strongly about it, I'll just move it out.",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:16:42Z",
      "diff_hunk" : "@@ -78,6 +78,112 @@ static void ApplyHash(MuHash3072& muhash, const uint256& hash, const std::map<ui\n     }\n }\n \n+class UTXOHasher\n+{\n+public:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869644871",
      "id" : 869644871,
      "in_reply_to_id" : 868360164,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1bpH",
      "original_commit_id" : "c853e71d4d43a4ed17a35216d0f353a793c29c2d",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 968361766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869644871/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:16:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869644871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645350"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed as of push 8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:17:19Z",
      "diff_hunk" : "@@ -809,6 +808,28 @@ CoinStatsHashType ParseHashType(const std::string& hash_type_input)\n     }\n }\n \n+//! Calculate statistics about the unspent transaction output set\n+\n+std::optional<kernel::CCoinsStats> GetUTXOStats(CCoinsView* view, node::BlockManager& blockman,\n+                                                kernel::CoinStatsHashType hash_type,\n+                                                const std::function<void()>& interruption_point = {},\n+                                                const CBlockIndex* pindex = nullptr,\n+                                                bool index_requested = true)\n+{\n+    // Use CoinStatsIndex if it is requested and available and a hash_type of Muhash or None was requested\n+    if ((hash_type == kernel::CoinStatsHashType::MUHASH || hash_type == kernel::CoinStatsHashType::NONE) && g_coin_stats_index && index_requested) {\n+        if (pindex) {\n+            return g_coin_stats_index->LookUpStats(pindex);\n+        } else {\n+            CBlockIndex* block_index = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));\n+            return g_coin_stats_index->LookUpStats(block_index);\n+        }\n+    }\n+\n+    auto hasher = kernel::MakeUTXOHasher(hash_type);\n+    return kernel::GetUTXOStatsWithHasher(*hasher, view, blockman, interruption_point);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645350",
      "id" : 869645350,
      "in_reply_to_id" : 868521835,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1bwm",
      "original_commit_id" : "dda351d7cf708b8d426d26562c64bd9c73b3a18f",
      "original_line" : 830,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 968362447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645350/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:17:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645416"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed as of push 8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:17:24Z",
      "diff_hunk" : "@@ -206,17 +202,52 @@ static bool GetUTXOStats(CCoinsView* view, BlockManager& blockman, CCoinsStats&\n     stats.hashSerialized = hasher.Finalize();\n \n     stats.nDiskSize = view->EstimateSize();\n+\n     return true;\n }\n \n-std::optional<CCoinsStats> GetUTXOStats(CCoinsView* view, BlockManager& blockman, CoinStatsHashType hash_type, const std::function<void()>& interruption_point, const CBlockIndex* pindex, bool index_requested)\n+std::optional<CCoinsStats> GetUTXOStatsWithHasher(UTXOHasher& hasher, CCoinsView* view, BlockManager& blockman, const std::function<void()>& interruption_point)\n {\n-    CCoinsStats stats{};\n-    auto hasher = MakeUTXOHasher(hash_type);\n+    CBlockIndex* pindex = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    GetUTXOStatsWithHasher(hasher, stats, view, blockman, interruption_point);\n \n-    if (!GetUTXOStats(view, blockman, stats, *hasher, interruption_point, pindex, hash_type, index_requested)) {\n+    return stats;\n+}\n+\n+std::optional<CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, const CBlockIndex* pindex)\n+{\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    stats.index_used = true;\n+    if (!coin_stats_index.LookUpStats(pindex, stats)) {\n         return std::nullopt;\n     }\n+\n     return stats;\n }\n+\n+std::optional<CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, CCoinsView* view, BlockManager& blockman)\n+{\n+    CBlockIndex* pindex = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645416",
      "id" : 869645416,
      "in_reply_to_id" : 868494388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1bxo",
      "original_commit_id" : "8c8d3f186df95b419fba8fddaeaac9b8912646dd",
      "original_line" : 233,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 968362539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645416/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645503"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed as of push 8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:17:30Z",
      "diff_hunk" : "@@ -809,6 +808,28 @@ CoinStatsHashType ParseHashType(const std::string& hash_type_input)\n     }\n }\n \n+//! Calculate statistics about the unspent transaction output set\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645503",
      "id" : 869645503,
      "in_reply_to_id" : 867504665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1by_",
      "original_commit_id" : "8f50fe837eaa41b045c69a97617b2346d57bd879",
      "original_line" : 812,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 968362630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:17:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645588"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed as of push 8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:17:37Z",
      "diff_hunk" : "@@ -76,6 +76,8 @@ std::optional<CCoinsStats> GetUTXOStats(CCoinsView* view, node::BlockManager& bl\n uint64_t GetBogoSize(const CScript& script_pub_key);\n \n CDataStream TxOutSer(const COutPoint& outpoint, const Coin& coin);\n+\n+CCoinsStats MakeCoinStatsPrefilledWithBlockIndexInfo(const CBlockIndex* pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645588",
      "id" : 869645588,
      "in_reply_to_id" : 868411598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1b0U",
      "original_commit_id" : "f05882c453d94c6e87f82f2cba9bdf1c0c85143a",
      "original_line" : 80,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : null,
      "pull_request_review_id" : 968362735,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:17:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645667"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed as of push 8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:17:44Z",
      "diff_hunk" : "@@ -78,6 +78,112 @@ static void ApplyHash(MuHash3072& muhash, const uint256& hash, const std::map<ui\n     }\n }\n \n+class UTXOHasher\n+{\n+public:\n+    virtual void Prepare(const uint256& hash_block){};\n+    virtual void Apply(const uint256& hash, const std::map<uint32_t, Coin>& outputs){};\n+    virtual uint256 Finalize() = 0;\n+    virtual ~UTXOHasher();\n+};\n+\n+UTXOHasher::~UTXOHasher() = default;\n+\n+class NullHasher : public UTXOHasher {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869645667",
      "id" : 869645667,
      "in_reply_to_id" : 868360900,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1b1j",
      "original_commit_id" : "c853e71d4d43a4ed17a35216d0f353a793c29c2d",
      "original_line" : 92,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 968362842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645667/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:17:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869645667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869649423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869649423"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is completely changed when we introduce `ComputeUTXOStatsWithHasher(UTXOHasher& hasher, ...)` with `UTXOHasher&` as the first parameter. Does that look alright?\r\n\r\nIf it still looks unclear, I'm happy to add Doxygen comments so that's it's more clear!",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:22:59Z",
      "diff_hunk" : "@@ -69,12 +66,10 @@ struct CCoinsStats {\n     CAmount total_unspendables_scripts{0};\n     //! Total cumulative amount of coins lost due to unclaimed miner rewards up to and including this block\n     CAmount total_unspendables_unclaimed_rewards{0};\n-\n-    CCoinsStats(CoinStatsHashType hash_type) : m_hash_type(hash_type) {}\n };\n \n //! Calculate statistics about the unspent transaction output set\n-bool GetUTXOStats(CCoinsView* view, node::BlockManager& blockman, CCoinsStats& stats, const std::function<void()>& interruption_point = {}, const CBlockIndex* pindex = nullptr);\n+bool GetUTXOStats(CCoinsView* view, node::BlockManager& blockman, CCoinsStats& stats, CoinStatsHashType hash_type, const std::function<void()>& interruption_point = {}, const CBlockIndex* pindex = nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869649423",
      "id" : 869649423,
      "in_reply_to_id" : 868137623,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1cwP",
      "original_commit_id" : "82148cec1c18c41fbc16f1deadf1f576755f9c52",
      "original_line" : 72,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : null,
      "pull_request_review_id" : 968368162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869649423/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:22:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869649423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869653743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869653743"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Although Iâve moved some ***in***-param members out of `CCoinStats`, I think itâs outside the scope of this PR to move ***out***-param members out of `CCoinStats` but would be a worthwhile followup. This is because a proper cleanup of `CCoinStats`' out-params would likely result in a complete split of the struct itself.\r\n\r\nObserve that:\r\n\r\n- The hashing UTXO stats code path only ever sets the CCoinsStats members:\r\n    - CCoinsStats::CCoinsStats\r\n        - nHeight\r\n        - hashBlock\r\n    - ApplyStats\r\n        - nTransactions\r\n        - nTransactionOutputs\r\n        - total_amount\r\n        - nBogoSize\r\n    - ComputeUTXOStatsWithHasher\r\n        - coins_count\r\n        - hashSerialized\r\n        - nDiskSize\r\n- The indexing UTXO stats code path only ever sets the CCoinsStats members:\r\n    - CCoinsStats::CCoinsStats\r\n        - nHeight\r\n        - hashBlock\r\n    - CoinstatsIndex::LookupStats\r\n        - index_used\r\n        - hashSerialized\r\n        - nTransactionOutputs\r\n        - nBogoSize\r\n        - total_amount\r\n        - total_subsidy\r\n        - total_unspendable_amount\r\n        - total_prevout_spent_amount\r\n        - total_new_outputs_ex_coinbase_amount\r\n        - total_coinbase_amount\r\n        - total_unspendables_genesis_block\r\n        - total_unspendables_bip30\r\n        - total_unspendables_scripts\r\n        - total_unspendables_unclaimed_rewards\r\n- The only 6 common fields that are set:\r\n    - nHeight\r\n    - hashBlock\r\n    - nTransactionOutputs\r\n    - total_amount\r\n    - nBogoSize\r\n    - hashSerialized\r\n\r\nSo a proper cleanup would make it so that `CCoinStats` only contains the 6 common fields, and have other structs to contain the fields unique to each codepath. I don't want to do that in this PR.",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:29:08Z",
      "diff_hunk" : "@@ -206,17 +202,52 @@ static bool GetUTXOStats(CCoinsView* view, BlockManager& blockman, CCoinsStats&\n     stats.hashSerialized = hasher.Finalize();\n \n     stats.nDiskSize = view->EstimateSize();\n+\n     return true;\n }\n \n-std::optional<CCoinsStats> GetUTXOStats(CCoinsView* view, BlockManager& blockman, CoinStatsHashType hash_type, const std::function<void()>& interruption_point, const CBlockIndex* pindex, bool index_requested)\n+std::optional<CCoinsStats> GetUTXOStatsWithHasher(UTXOHasher& hasher, CCoinsView* view, BlockManager& blockman, const std::function<void()>& interruption_point)\n {\n-    CCoinsStats stats{};\n-    auto hasher = MakeUTXOHasher(hash_type);\n+    CBlockIndex* pindex = WITH_LOCK(cs_main, return blockman.LookupBlockIndex(view->GetBestBlock()));\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    GetUTXOStatsWithHasher(hasher, stats, view, blockman, interruption_point);\n \n-    if (!GetUTXOStats(view, blockman, stats, *hasher, interruption_point, pindex, hash_type, index_requested)) {\n+    return stats;\n+}\n+\n+std::optional<CCoinsStats> GetUTXOStatsWithIndex(CoinStatsIndex& coin_stats_index, const CBlockIndex* pindex)\n+{\n+    CCoinsStats stats = MakeCoinStatsPrefilledWithBlockIndexInfo(pindex);\n+\n+    stats.index_used = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869653743",
      "id" : 869653743,
      "in_reply_to_id" : 868406549,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1dzv",
      "original_commit_id" : "8c8d3f186df95b419fba8fddaeaac9b8912646dd",
      "original_line" : 223,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 968374347,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869653743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:33:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869653743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869655962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869655962"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not entirely sure what you mean here. Do you mean we should return a `std::pair<std::optional<CCoinsStats>, uint256>` instead?\r\n\r\nRelated: https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869653743\r\n\r\n> maybe `Finalize()` should take a `CCoinsStats` reference?\r\n\r\nI'm not a big fan of that, I'm happier having `UTXOHasher`s not knowing about `CCoinsStats` and only knowing about things that are appropriate to their domain.",
      "commit_id" : "8b853034a13f49b85cdf4168d9d49bd297f5b8ce",
      "created_at" : "2022-05-10T20:32:25Z",
      "diff_hunk" : "@@ -241,31 +240,19 @@ static bool GetUTXOStats(CCoinsView* view, BlockManager& blockman, CCoinsStats&\n     }\n     if (!outputs.empty()) {\n         ApplyStats(stats, prevkey, outputs);\n-        ApplyHash(hash_obj, prevkey, outputs);\n+        hasher.Apply(prevkey, outputs);\n     }\n \n-    FinalizeHash(hash_obj, stats);\n+    stats.hashSerialized = hasher.Finalize();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#discussion_r869655962",
      "id" : 869655962,
      "in_reply_to_id" : 868368343,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1eWa",
      "original_commit_id" : "1f37d453ed6a3d5bda82cdff0c861c26b7cf5a1c",
      "original_line" : 246,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 968377362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24410",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869655962/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T20:32:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869655962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\n+1 on keeping the commits small and focused. I've done a quick read-through but plan to do a more thorough review later",
      "created_at" : "2022-05-11T16:03:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1123968148",
      "id" : 1123968148,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585C_mSU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1123968148/reactions"
      },
      "updated_at" : "2022-05-11T16:03:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1123968148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reviewers: I'm considering squashing 3 commits:\r\n- 3fc97a7e59a96fa0e1901f625bd52b3d8c598805 \"coinstats: Introduce UTXOHasher and implementations\"\r\n- 51c3b93490a05ae37559d5eba981bf8c6107a674 \"coinstats: Use newly-introduced UTXOHashers\"\r\n- 24b613e8135e13f2f81e3849f2a97b2ccd7b317f \"coinstats: Remove old UTXO hashing implementations\"\r\n\r\nHowever, I do not wish to make my commits less reviewable.\r\n\r\nLet me know your opinion with a ð  or ð  reaction to this comment.",
      "created_at" : "2022-05-11T18:05:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1124110498",
      "id" : 1124110498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585DAJCi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 1,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 3,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124110498/reactions"
      },
      "updated_at" : "2022-05-11T18:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124110498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Spent some time trying to understand the direction of the project as a whole in the run up to today's [PR review club](https://bitcoincore.reviews/24410) and to the extent it builds on multiprocess, AssumeUTXO work. Approach ACK on the project roadmap thus far.\r\n\r\nOn this PR specifically Approach ACK, code review (limited familiarity with the coinstats code before this), no testing.\r\n\r\nAs others have said great organization of commits and commit messages (and innovative use of thumbs up/down to get reviewer reaction :) )",
      "created_at" : "2022-05-11T19:39:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24410#issuecomment-1124216881",
      "id" : 1124216881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24410",
      "node_id" : "IC_kwDOABII585DAjAx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 1,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124216881/reactions"
      },
      "updated_at" : "2022-05-11T19:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124216881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   }
]
