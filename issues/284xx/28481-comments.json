[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28686](https://github.com/bitcoin/bitcoin/pull/28686) (refactor: Split per-peer parts of net module into new node/connection module by ajtowns)\n* [#28658](https://github.com/bitcoin/bitcoin/pull/28658) (type-safe(r) GenTxid constructors by instagibbs)\n* [#28107](https://github.com/bitcoin/bitcoin/pull/28107) (util: Type-safe transaction identifiers by dergoegge)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-09-14T13:59:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#issuecomment-1719511734",
      "id" : 1719511734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28481",
      "node_id" : "IC_kwDOABII585mfaq2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719511734/reactions"
      },
      "updated_at" : "2023-10-25T08:44:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719511734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```sh\r\n$ echo \"Af//////Oqf/AP8TAf8AEPr/AQAApZL6/wEA/1sB/wBbAAClkpJ4eP//S0tL/Q==\" | base64 -d > orphanage_crash\r\n$ FUZZ=txorphan ./src/test/fuzz/fuzz orphanage_crash\r\n...\r\ntest/fuzz/txorphan.cpp:98 operator(): Assertion `orphanage.BytesFromPeer(peer_id) >= ref->GetTotalSize()' failed.\r\n...\r\n```",
      "created_at" : "2023-09-14T15:29:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#issuecomment-1719678408",
      "id" : 1719678408,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28481",
      "node_id" : "IC_kwDOABII585mgDXI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719678408/reactions"
      },
      "updated_at" : "2023-09-14T15:39:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719678408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\n28: error: argument name 'max_count' in comment does not match parameter name 'max_orphans' [bugprone-argument-comment,-warnings-as-errors]\r\n    orphanage.LimitOrphans(/*max_count=*/10, DEFAULT_MAX_ORPHAN_TOTAL_SIZE);\r\n                           ^\r\n./txorphanage.h:58:52: note: 'max_orphans' declared here\r\n    std::vector<uint256> LimitOrphans(unsigned int max_orphans, unsigned int max_total_size = DEFAULT_MAX_ORPHAN_TOTAL_SIZE)\r\n                                                   ^",
      "created_at" : "2023-09-15T06:58:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#issuecomment-1720773834",
      "id" : 1720773834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28481",
      "node_id" : "IC_kwDOABII585mkOzK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1720773834/reactions"
      },
      "updated_at" : "2023-09-15T06:58:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1720773834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327162369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327162369"
         }
      },
      "author_association" : "NONE",
      "body" : "use a r-lambda function here to ease things up.\n",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T11:29:48Z",
      "diff_hunk" : "@@ -2982,7 +2982,7 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n                     m_recent_rejects.insert(porphanTx->GetHash());\n                 }\n             }\n-            m_orphanage.EraseTx(orphanHash);\n+            m_orphanage.EraseTx(orphan_wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327162369",
      "id" : 1327162369,
      "line" : 2985,
      "node_id" : "PRRC_kwDOABII585PGuQB",
      "original_commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "original_line" : 2985,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 1628750832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327162369/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-18T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327162369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/145057669?v=4",
         "events_url" : "https://api.github.com/users/Yugthakkar04/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Yugthakkar04/followers",
         "following_url" : "https://api.github.com/users/Yugthakkar04/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Yugthakkar04/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Yugthakkar04",
         "id" : 145057669,
         "login" : "Yugthakkar04",
         "node_id" : "U_kgDOCKVnhQ",
         "organizations_url" : "https://api.github.com/users/Yugthakkar04/orgs",
         "received_events_url" : "https://api.github.com/users/Yugthakkar04/received_events",
         "repos_url" : "https://api.github.com/users/Yugthakkar04/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Yugthakkar04/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Yugthakkar04/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Yugthakkar04"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327559516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327559516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Need to also rename arg for `EraseTxNoLock` to wtxid",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T16:50:49Z",
      "diff_hunk" : "@@ -33,8 +36,8 @@ class TxOrphanage {\n      */\n     CTransactionRef GetTxToReconsider(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase an orphan by txid */\n-    int EraseTx(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327559516",
      "id" : 1327559516,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII585PIPNc",
      "original_commit_id" : "4d6b839616c65b0ca5fefdb50ce0b8b1ffad8947",
      "original_line" : 37,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 41,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327559516/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327559516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327560918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327560918"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4d6b839616c65b0ca5fefdb50ce0b8b1ffad8947\r\n\r\n`txorphan.cpp` fuzzer needs to change for all `EraseTx()` call sites because they're still using txid",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T16:52:16Z",
      "diff_hunk" : "@@ -33,8 +36,8 @@ class TxOrphanage {\n      */\n     CTransactionRef GetTxToReconsider(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase an orphan by txid */\n-    int EraseTx(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327560918",
      "id" : 1327560918,
      "in_reply_to_id" : 1327559516,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII585PIPjW",
      "original_commit_id" : "4d6b839616c65b0ca5fefdb50ce0b8b1ffad8947",
      "original_line" : 37,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 41,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327560918/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327560918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327577864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327577864"
         }
      },
      "author_association" : "MEMBER",
      "body" : "leave a comment that this is belt-and-suspenders only, the condition should fail since the item should have been already erased",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:08:45Z",
      "diff_hunk" : "@@ -118,6 +139,8 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n         }\n     }\n     if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx from peer=%d\\n\", nErased, peer);\n+    if (!Assume(m_peer_bytes_used.count(peer) == 0)) m_peer_bytes_used.erase(peer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327577864",
      "id" : 1327577864,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII585PITsI",
      "original_commit_id" : "ee2063496b1ca846e9584619591bb4410ec0c871",
      "original_line" : 142,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 152,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327577864/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327577864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327596144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327596144"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should describe the new argument as something like \"all unique parent transaction txids\". I kind of wish this was generated inside `AddTx` but realize you're avoiding double the work...",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:28:46Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ class TxOrphanage {\n public:\n     /** Add a new orphan transaction. If the tx already exists, add this peer to its list of announcers.\n       @returns true if the transaction was added as a new orphan. */\n-    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+    bool AddTx(const CTransactionRef& tx, NodeId peer, const std::vector<uint256>& parent_txids) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327596144",
      "id" : 1327596144,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII585PIYJw",
      "original_commit_id" : "05ea6fabe36d728b69a736b6f82a136f4403d7bf",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 26,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327596144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327596144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327599163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327599163"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```Suggestion\r\n    /** Get an orphan's unique parent_txids, or std::nullopt if the orphan is not present. */\r\n```",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:32:12Z",
      "diff_hunk" : "@@ -92,6 +92,9 @@ class TxOrphanage {\n      * remove this peer's entry from the map. */\n     void SubtractOrphanBytes(unsigned int size, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(m_mutex);\n \n+    /** Get an orphan's parent_txids, or std::nullopt if the orphan is not present. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327599163",
      "id" : 1327599163,
      "line" : 100,
      "node_id" : "PRRC_kwDOABII585PIY47",
      "original_commit_id" : "05ea6fabe36d728b69a736b6f82a136f4403d7bf",
      "original_line" : 95,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 101,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327599163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327599163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327599946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327599946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```Suggestion\r\n    /** Limit the orphanage to the given maximum. Returns all expired entries by wtxid. */\r\n```",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:33:07Z",
      "diff_hunk" : "@@ -45,13 +45,13 @@ class TxOrphanage {\n \n     /** Maybe erase all orphans announced by a peer (eg, after that peer disconnects). If an orphan\n      * has been announced by another peer, don't erase, just remove this peer from the list of announcers. */\n-    void EraseForPeer(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+    std::vector<uint256> EraseForPeer(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Erase all orphans included in or invalidated by a new block */\n     void EraseForBlock(const CBlock& block) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Limit the orphanage to the given maximum */\n-    void LimitOrphans(unsigned int max_orphans) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+    /** Limit the orphanage to the given maximum. Returns all expired entries. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327599946",
      "id" : 1327599946,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII585PIZFK",
      "original_commit_id" : "05ea6fabe36d728b69a736b6f82a136f4403d7bf",
      "original_line" : 53,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 58,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327599946/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327599946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327600222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327600222"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/expired/expired_wtxids/",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:33:26Z",
      "diff_hunk" : "@@ -169,10 +171,11 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n     return wtxids;\n }\n \n-void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n+std::vector<uint256> TxOrphanage::LimitOrphans(unsigned int max_orphans)\n {\n     LOCK(m_mutex);\n \n+    std::vector<uint256> expired;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327600222",
      "id" : 1327600222,
      "line" : 178,
      "node_id" : "PRRC_kwDOABII585PIZJe",
      "original_commit_id" : "05ea6fabe36d728b69a736b6f82a136f4403d7bf",
      "original_line" : 178,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 161,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327600222/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327600222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327600963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327600963"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can remove this and use size of `expired(_wtxids)` set isntead",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:34:17Z",
      "diff_hunk" : "@@ -169,10 +171,11 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n     return wtxids;\n }\n \n-void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n+std::vector<uint256> TxOrphanage::LimitOrphans(unsigned int max_orphans)\n {\n     LOCK(m_mutex);\n \n+    std::vector<uint256> expired;\n     unsigned int nEvicted = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327600963",
      "id" : 1327600963,
      "line" : 179,
      "node_id" : "PRRC_kwDOABII585PIZVD",
      "original_commit_id" : "05ea6fabe36d728b69a736b6f82a136f4403d7bf",
      "original_line" : 179,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 162,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327600963/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327600963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327605904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327605904"
         }
      },
      "author_association" : "MEMBER",
      "body" : "please remove this return https://github.com/bitcoin/bitcoin/pull/28031#discussion_r1326094730",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:39:17Z",
      "diff_hunk" : "@@ -33,40 +44,75 @@ class TxOrphanage {\n      */\n     CTransactionRef GetTxToReconsider(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase an orphan by txid */\n-    int EraseTx(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+    /** Erase an orphan by wtxid */\n+    int EraseTx(const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase all orphans announced by a peer (eg, after that peer disconnects) */\n-    void EraseForPeer(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+    /** Maybe erase all orphans announced by a peer (eg, after that peer disconnects). If an orphan\n+     * has been announced by another peer, don't erase, just remove this peer from the list of announcers. */\n+    std::vector<uint256> EraseForPeer(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327605904",
      "id" : 1327605904,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII585PIaiQ",
      "original_commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "original_line" : 52,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 49,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327605904/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327605904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327611365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327611365"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unused in this PR, but is exercised in tests so I'm happy for it to be used later :+1: ",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:45:18Z",
      "diff_hunk" : "@@ -278,7 +278,7 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n     return false;\n }\n \n-void TxOrphanage::EraseForBlock(const CBlock& block)\n+std::vector<uint256> TxOrphanage::EraseForBlock(const CBlock& block)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327611365",
      "id" : 1327611365,
      "line" : 281,
      "node_id" : "PRRC_kwDOABII585PIb3l",
      "original_commit_id" : "1630da019bd57885d5c52095cc76905a3c57dffa",
      "original_line" : 281,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 224,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327611365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327611365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327617380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327617380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could this get mechanically asserted as extra-belt-and-suspender",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:51:57Z",
      "diff_hunk" : "@@ -38,14 +38,66 @@ class TxOrphanageTest : public TxOrphanage\n     }\n };\n \n-static void MakeNewKeyWithFastRandomContext(CKey& key)\n+static void MakeNewKeyWithFastRandomContext(CKey& key, FastRandomContext& rand_ctx = g_insecure_rand_ctx)\n {\n     std::vector<unsigned char> keydata;\n-    keydata = g_insecure_rand_ctx.randbytes(32);\n+    keydata = rand_ctx.randbytes(32);\n     key.Set(keydata.data(), keydata.data() + keydata.size(), /*fCompressedIn=*/true);\n     assert(key.IsValid());\n }\n \n+static CTransactionRef MakeLargeOrphan()\n+{\n+    CKey key;\n+    MakeNewKeyWithFastRandomContext(key);\n+    CMutableTransaction tx;\n+    tx.vout.resize(1);\n+    tx.vout[0].nValue = CENT;\n+    tx.vout[0].scriptPubKey = GetScriptForDestination(PKHash(key.GetPubKey()));\n+    tx.vin.resize(80);\n+    for (unsigned int j = 0; j < tx.vin.size(); j++) {\n+        tx.vin[j].prevout.n = j;\n+        tx.vin[j].prevout.hash = GetRandHash();\n+        tx.vin[j].scriptWitness.stack.reserve(100);\n+        for (int i = 0; i < 100; ++i) {\n+            tx.vin[j].scriptWitness.stack.push_back(std::vector<unsigned char>(j));\n+        }\n+    }\n+    return MakeTransactionRef(tx);\n+}\n+\n+static CTransactionRef MakeTransactionSpending(const std::vector<COutPoint>& outpoints, FastRandomContext& det_rand)\n+{\n+    CKey key;\n+    MakeNewKeyWithFastRandomContext(key, det_rand);\n+    CMutableTransaction tx;\n+    // If no outpoints are given, create a random one.\n+    if (outpoints.empty()) {\n+        tx.vin.emplace_back(CTxIn{COutPoint{det_rand.rand256(), 0}});\n+    } else {\n+        for (const auto& outpoint : outpoints) {\n+            tx.vin.emplace_back(CTxIn(outpoint));\n+        }\n+    }\n+    // Ensure txid != wtxid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327617380",
      "id" : 1327617380,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII585PIdVk",
      "original_commit_id" : "95fcb16ac42bc13c2e7311def77343a026f16380",
      "original_line" : 82,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/test/orphanage_tests.cpp",
      "position" : 55,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327617380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327617380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327618110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327618110"
         }
      },
      "author_association" : "MEMBER",
      "body" : "might as well capture the return and check it here too",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-15T17:52:43Z",
      "diff_hunk" : "@@ -127,14 +136,33 @@ FUZZ_TARGET(txorphan, .init = initialize_orphanage)\n                 },\n                 [&] {\n                     orphanage.EraseForPeer(peer_id);\n+                    Assert(orphanage.BytesFromPeer(peer_id) == 0);\n                 },\n                 [&] {\n                     // test mocktime and expiry\n                     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-                    auto limit = fuzzed_data_provider.ConsumeIntegral<unsigned int>();\n-                    orphanage.LimitOrphans(limit);\n-                    Assert(orphanage.Size() <= limit);\n+                    auto count_limit = fuzzed_data_provider.ConsumeIntegral<unsigned int>();\n+                    auto size_limit = fuzzed_data_provider.ConsumeIntegral<unsigned int>();\n+                    orphanage.LimitOrphans(count_limit, size_limit);\n+                    Assert(orphanage.Size() <= count_limit);\n+                    Assert(orphanage.TotalOrphanBytes() <= size_limit);\n+                },\n+                [&] {\n+                    // check EraseForBlock\n+                    CBlock block;\n+                    block.vtx.emplace_back(tx);\n+                    orphanage.EraseForBlock(block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1327618110",
      "id" : 1327618110,
      "line" : 154,
      "node_id" : "PRRC_kwDOABII585PIdg-",
      "original_commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "original_line" : 154,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/test/fuzz/txorphan.cpp",
      "position" : 57,
      "pull_request_review_id" : 1629373268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327618110/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T17:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327618110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Putting this in draft to focus review attention on the mempool stuff.",
      "created_at" : "2023-09-18T15:54:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#issuecomment-1723790847",
      "id" : 1723790847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28481",
      "node_id" : "IC_kwDOABII585mvvX_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1723790847/reactions"
      },
      "updated_at" : "2023-09-18T15:54:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1723790847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1334605356"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334605356"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Uh, unsure what a r-lambda function is and pretty sure calling something else doesn't make sense so I'm resolving this comment.",
      "commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "created_at" : "2023-09-22T16:35:04Z",
      "diff_hunk" : "@@ -2982,7 +2982,7 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n                     m_recent_rejects.insert(porphanTx->GetHash());\n                 }\n             }\n-            m_orphanage.EraseTx(orphanHash);\n+            m_orphanage.EraseTx(orphan_wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#discussion_r1334605356",
      "id" : 1334605356,
      "in_reply_to_id" : 1327162369,
      "line" : 2985,
      "node_id" : "PRRC_kwDOABII585PjHYs",
      "original_commit_id" : "6101c601f5b4312c6d30cf0f7fc5db87a32b1ea2",
      "original_line" : 2985,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 1640311576,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28481",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334605356/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-22T16:35:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334605356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Going to resolve comments + fuzz failure, and then add a `getorphanagestats` RPC before taking out of draft.",
      "created_at" : "2023-09-22T16:35:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#issuecomment-1731718135",
      "id" : 1731718135,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28481",
      "node_id" : "IC_kwDOABII585nN-v3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1731718135/reactions"
      },
      "updated_at" : "2023-09-22T16:35:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1731718135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-26T18:50:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#issuecomment-1781703650",
      "id" : 1781703650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28481",
      "node_id" : "IC_kwDOABII585qMqPi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1781703650/reactions"
      },
      "updated_at" : "2023-10-26T18:50:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1781703650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nâ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2024-01-24T01:33:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28481#issuecomment-1907201948",
      "id" : 1907201948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28481",
      "node_id" : "IC_kwDOABII585xrZec",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1907201948/reactions"
      },
      "updated_at" : "2024-01-24T01:33:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1907201948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
