[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28463).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1717178516) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28912](https://github.com/bitcoin/bitcoin/pull/28912) (refactor: VectorWriter and SpanReader without nVersion by maflcko)\n* [#28892](https://github.com/bitcoin/bitcoin/pull/28892) (refactor: P2P transport without serialize version and type by maflcko)\n* [#28451](https://github.com/bitcoin/bitcoin/pull/28451) (refactor: Remove unused SER_DISK, SER_NETWORK, SER_GETHASH by maflcko)\n* [#27600](https://github.com/bitcoin/bitcoin/pull/27600) (net: Add new permission `forceinbound` to evict a random unprotected connection if all slots are otherwise full by pinheadmz)\n* [#24748](https://github.com/bitcoin/bitcoin/pull/24748) (test/BIP324: functional tests for v2 P2P encryption by stratospher)\n* [#21515](https://github.com/bitcoin/bitcoin/pull/21515) (Erlay: bandwidth-efficient transaction relay protocol by naumenkogs)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-09-12T20:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1716393130",
      "id" : 1716393130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585mThSq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1716393130/reactions"
      },
      "updated_at" : "2023-11-27T16:17:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1716393130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "### Status Quo\r\nWe have a default maximum of 125 connections (not counting manual ones). Out of these, \r\n11 (8 full outbounds, 2 block-relay-only, 1 feeler) are reserved for outbounds, leaving us with \r\n114 inbound slots. There are currently no limits on how many of the inbounds can support transaction relay.\r\n\r\n### Problem\r\nWe want to increase the number of inbound slots specifically offered to block-relay-only connections, but don't want to significantly change the number of tx-relaying inbound peers, because we donât want to radically change the memory and traffic requirements that come with running a full node with the default configuration.\r\nThis is complicated by a timing issue: When a new peer connects to us, we don't know yet whether it is block-relay-only before we have processed their version message.\r\nInbound peer eviction, however, happens right after a peer connects to us and before processing its version msg. This means that we don't yet know during inbound eviction, if the new peer wants tx relay.\r\n\r\n### Approach\r\nWe propose to introduce a separate maximum of tx-relaying inbound connections, in addition to the existing global maximum.\r\nThe new maximum for tx-relaying inbounds gets chosen such that 60% of the total inbound slots can be utilized by tx-relaying peers. We choose a ratio here instead of a fixed number here so that it scales with users changing their `-maxconnections` value from the default. The ratio of 60% is also made adjustable in the form of a new startup parameter. \r\n\r\n### Changes to the eviction logic\r\nWe don't change the eviction logic for total connections, which happens in `CreateNodeFromAcceptedSocket()`.\r\nWe add a tx-relay-specific eviction check to the version message processing which runs if we don't have capacity for another tx-relaying peer: This check uses the same logic from `AttemptToEvictConnection`, but specifically evicts only tx-relaying peers (by protecting the rest of the peers). Only if we cannot find another peer to evict (e.g. all peers are protected, which should only happen if a low `-maxconnections` is used) we disconnect the new peer. This approach achieves that the number of tx-relaying peers can never exceed the limit.\r\n\r\n### Numbers\r\nSpecifically, we propose to increase the total number of connections from 125 to 200, with a  suggested ratio of 60% tx-relay inbounds. With 11 connection slots reserved for outbound peers, \r\nthis results in (200 - 11) * 0.6 = 113 slots for tx-relaying inbound peers, which closely aligns with the current count of 114.\r\nThese numbers were chosen to be sufficient to raise the number of block-relay-only connections from 2 to 8 once this patch is widely deployed (see Issue #28462 for more details on this).\r\n\r\n### Handling bloom filter peers\r\nThe logic gets a bit complicated if a node supports BIP37 (bloom filters), because then an inbound peer can be switched to tx-relay after sending a `FILTERLOAD` or `FILTERCLEAR` message (but never back!), which could result in an excess of tx-relaying inbounds. We propose to solve this by triggering the eviction logic for a tx-relaying peer from `net_processing` whenever we switch a peer to tx-relay due to a BIP37-related message.\r\n",
      "created_at" : "2023-09-12T20:37:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1716393675",
      "id" : 1716393675,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585mThbL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1716393675/reactions"
      },
      "updated_at" : "2023-10-13T18:55:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1716393675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, specifically on changes to the eviction logic, and handling bloom filters.\r\nNumbers also seem fine I guess.\r\n\r\nI was curious whether there is (or will be) any other good reason to delay eviction after the version (apart from making this logic cleaner), but I haven't identified any.",
      "created_at" : "2023-09-13T08:28:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1717178516",
      "id" : 1717178516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585mWhCU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717178516/reactions"
      },
      "updated_at" : "2023-09-13T08:28:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717178516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I was curious whether there is (or will be) any other good reason to delay eviction after the version (apart from making this logic cleaner), but I haven't identified any.\r\n\r\nDiscussed this with @amitiuttarwar and we think that it would be better to move the tx-related eviction into the version processing logic.\r\nPros:\r\n- It's conceptually simpler to only evict a tx-relaying peer when we are sure that it is one\r\n- We wouldn't have to evict anyone in the situation where all tx inbound slots are full and a new block-relay inbound connects\r\n- We need the logic for this (`EvictTxPeerIfFull()`) anyway when dealing with bloom-filter peers.\r\n\r\nCons:\r\n- The eviction now happens in two different places, after accepting a connection and during version processing.\r\n\r\nI will update the PR with this soon!",
      "created_at" : "2023-09-28T16:16:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1739634723",
      "id" : 1739634723,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585nsLgj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739634723/reactions"
      },
      "updated_at" : "2023-09-28T16:16:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739634723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-03T10:21:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1744669775",
      "id" : 1744669775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585n_YxP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744669775/reactions"
      },
      "updated_at" : "2023-10-03T10:21:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744669775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed the approach to do the eviction of tx-relaying peers within the version message processing, when we can make use of the `fRelay` flag they sent us - this has the advantage that we don't have to evict new peers before being sure if they want tx relay.\r\n\r\nAs a result of theÂ laterÂ eviction, it became necessary to protect the new peer from beingÂ evicted right byÂ `AttemptToEvictConnection()` right after connecting (so that the new peer only gets evicted if no other peer can be found). This isn't done for the existing unconditional inobound eviction in `net` (`CreateNodeFromAcceptedSocket`), because there we would evict a peer before adding the new peer to `m_nodes`.",
      "created_at" : "2023-10-13T18:38:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1762022155",
      "id" : 1762022155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585pBlML",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1762022155/reactions"
      },
      "updated_at" : "2023-10-13T18:38:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1762022155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361355109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361355109"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "spacing nit to line up with the return description\r\n\r\n```suggestion\r\n     * @param[in]   protect_peer      NodeId of a peer we want to protect\r\n```",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-16T23:26:13Z",
      "diff_hunk" : "@@ -1193,6 +1196,16 @@ class CConnman\n     int GetExtraFullOutboundCount() const;\n     // Count the number of block-relay-only peers we have over our limit.\n     int GetExtraBlockRelayCount() const;\n+    /**\n+     * If we are at capacity for inbound tx-relay peers, attempt to evict one.\n+     * @param[in]   protect_peer    NodeId of a peer we want to protect",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361355109",
      "id" : 1361355109,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RJKFl",
      "original_commit_id" : "ab5ad61f67f3bcab503ac3eb012c4f35d733b946",
      "original_line" : 1201,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361355109/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361355109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361359734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361359734"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm guessing you renamed to `protect_peer` to match the function signature of `EvictTxPeerIfFull`, which sounds good to me. but this change should be squashed into [ce8cd83a81ac5da882e8c6862a8d53efafc3ae86](https://github.com/bitcoin/bitcoin/commit/ce8cd83a81ac5da882e8c6862a8d53efafc3ae86) which introduced the param.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-16T23:34:57Z",
      "diff_hunk" : "@@ -1700,7 +1700,7 @@ std::pair<size_t, bool> CConnman::SocketSendData(CNode& node) const\n  *   to forge.  In order to partition a node the attacker must be\n  *   simultaneously better at all of them than honest peers.\n  */\n-bool CConnman::AttemptToEvictConnection(bool evict_tx_relay_peer, std::optional<NodeId> protected_peer)\n+bool CConnman::AttemptToEvictConnection(bool evict_tx_relay_peer, std::optional<NodeId> protect_peer)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361359734",
      "id" : 1361359734,
      "line" : 1703,
      "node_id" : "PRRC_kwDOABII585RJLN2",
      "original_commit_id" : "ab5ad61f67f3bcab503ac3eb012c4f35d733b946",
      "original_line" : 1703,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361359734/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361359734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361374856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361374856"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "current comment feels misleading since we specifically protect this peer \r\n\r\n```suggestion\r\n        // If we have too many tx-relaying inbound peers, attempt to evict an existing one.\r\n```",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-17T00:07:33Z",
      "diff_hunk" : "@@ -3489,6 +3489,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             }\n         }\n \n+        // If we have too many tx-relaying inbound peers, attempt to evict one (not necessarily this one).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361374856",
      "id" : 1361374856,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RJO6I",
      "original_commit_id" : "ab5ad61f67f3bcab503ac3eb012c4f35d733b946",
      "original_line" : 3492,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361374856/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361374856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361396844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361396844"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n     * Attempt to evict an inbound connection. \r\n```\r\n\r\nunlike `EvictTxPeerIfFull`, this function doesn't explicitly check \"full\", right? there's some implicit logic around min number of connections required for there to be unprotected peers, but that's slightly different than max capacity?\r\n\r\nthis comment is also on the function definition in `net.cpp` on master & I think we should remove it from there as well. ",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-17T00:58:47Z",
      "diff_hunk" : "@@ -1351,7 +1360,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Try to find an inbound connection to evict when the node is full.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1361396844",
      "id" : 1361396844,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RJURs",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 1364,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361396844/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361396844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362698683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362698683"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think we can strengthen the check here to prevent a iterating through all the nodes if the incoming peer doesn't want tx relay enabled (and we are not offering `NODE_BLOOM` service) \r\n\r\n```suggestion\r\n        if (pfrom.IsInboundConn() && pfrom.m_relay_txs) {\r\n```",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-17T20:02:57Z",
      "diff_hunk" : "@@ -3489,6 +3489,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             }\n         }\n \n+        // If we have too many tx-relaying inbound peers, attempt to evict one (not necessarily this one).\n+        // Only if this fails, disconnect this peer.\n+        if (pfrom.IsInboundConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362698683",
      "id" : 1362698683,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ROSG7",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 3494,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362698683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362698683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362704232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362704232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    bool AttemptToEvictConnection(bool evict_tx_relay_peer = false, std::optional<NodeId> protect_peer = std::nullopt);\r\n```\r\n\r\nadding default values here would allow us not to have to touch the call site from `CreateNodeFromAcceptedSocket` & make more clear that the existing functionality shouldn't change unless additional info is passed in.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-17T20:09:01Z",
      "diff_hunk" : "@@ -1351,7 +1360,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Try to find an inbound connection to evict when the node is full.\n+     * @param[in] evict_tx_relay_peer Whether to only select full relay peers for eviction\n+     * @param[in] protect_peer        Protect peer with node id\n+     * @return                        True if a node was marked for disconnect\n+     */\n+    bool AttemptToEvictConnection(bool evict_tx_relay_peer, std::optional<NodeId> protect_peer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362704232",
      "id" : 1362704232,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ROTdo",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 1369,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362704232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362704232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362751635"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362751635"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wonder if it could be clearer to call this function something like `TxInboundCapacityAvailable`. imo that seems more useful from the POV of the net processing caller, but either is ok with me.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-17T20:47:34Z",
      "diff_hunk" : "@@ -1198,6 +1197,16 @@ class CConnman\n     int GetExtraFullOutboundCount() const;\n     // Count the number of block-relay-only peers we have over our limit.\n     int GetExtraBlockRelayCount() const;\n+    /**\n+     * If we are at capacity for inbound tx-relay peers, attempt to evict one.\n+     * @param[in]   protect_peer    NodeId of a peer we want to protect\n+     * @return      bool              Returns true if successful (either there is\n+     *                                no need for eviction, or a peer was evicted).\n+     *                                Returns false, if we are full but couldn't find\n+     *                                a peer to evict (all eligible peers are protected)\n+     *                                so that the caller can deal with this.\n+     */\n+    bool EvictTxPeerIfFull(std::optional<NodeId> protect_peer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362751635",
      "id" : 1362751635,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ROfCT",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 1209,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362751635/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362751635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362755114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362755114"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "default param here makes the `FILTERLOAD`/`FILTERCLEAR` callers slightly cleaner\r\n\r\n```suggestion\r\n    bool EvictTxPeerIfFull(std::optional<NodeId> protect_peer) = std::nullopt;\r\n```",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-17T20:51:01Z",
      "diff_hunk" : "@@ -1198,6 +1197,16 @@ class CConnman\n     int GetExtraFullOutboundCount() const;\n     // Count the number of block-relay-only peers we have over our limit.\n     int GetExtraBlockRelayCount() const;\n+    /**\n+     * If we are at capacity for inbound tx-relay peers, attempt to evict one.\n+     * @param[in]   protect_peer    NodeId of a peer we want to protect\n+     * @return      bool              Returns true if successful (either there is\n+     *                                no need for eviction, or a peer was evicted).\n+     *                                Returns false, if we are full but couldn't find\n+     *                                a peer to evict (all eligible peers are protected)\n+     *                                so that the caller can deal with this.\n+     */\n+    bool EvictTxPeerIfFull(std::optional<NodeId> protect_peer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1362755114",
      "id" : 1362755114,
      "in_reply_to_id" : 1362751635,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ROf4q",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 1209,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1681095975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362755114/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-18T00:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362755114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "overall, I like this approach significantly more. although we are introducing another touchpoint for inbound eviction logic, it is more straightforward to reason about. but the biggest improvement is not unnecessarily disconnecting a new or existing connection when tx relay isn't being requested.\r\n\r\nreviewed this in-depth. the fundamental structure & logic looks good to me. left a lot of comments along the way ð\r\n\r\nsome additional thoughts:\r\n- commit message for ab5ad61f67f3bcab503ac3eb012c4f35d733b946 says \"When we receive an inbound connection and don't have space for another full-relay peer, we now attempt to evict specifically a full-relay inbound.\" I think this should mention timing of processing the version message for clarity.\r\n- the order of events when processing the `VERSION` message makes sense, because we want to instantiate `tx_relay` for the before before triggering the new eviction logic (which uses that in the count).\r\n- this code strengthens the distinction between inbound-tx-relay connections from inbound-block-relay connections. ideally, this would be captured in separate connection types, but that would require more invasive changes since we don't know the distinction at the time of accepting the connection. I don't think the benefit would be worth the cost, but is something worth keeping in mind if we continue to build stronger distinctions between the two types of inbounds. ",
      "created_at" : "2023-10-18T00:27:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1767398136",
      "id" : 1767398136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585pWFr4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1767398136/reactions"
      },
      "updated_at" : "2023-10-18T00:27:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1767398136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366156829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366156829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-19T21:42:15Z",
      "diff_hunk" : "@@ -1193,6 +1196,16 @@ class CConnman\n     int GetExtraFullOutboundCount() const;\n     // Count the number of block-relay-only peers we have over our limit.\n     int GetExtraBlockRelayCount() const;\n+    /**\n+     * If we are at capacity for inbound tx-relay peers, attempt to evict one.\n+     * @param[in]   protect_peer    NodeId of a peer we want to protect",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366156829",
      "id" : 1366156829,
      "in_reply_to_id" : 1361355109,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RbeYd",
      "original_commit_id" : "ab5ad61f67f3bcab503ac3eb012c4f35d733b946",
      "original_line" : 1201,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1688718014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366156829/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T21:42:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366156829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366157267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366157267"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, some changes made it into the wrong commit. Fixed now.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-19T21:42:51Z",
      "diff_hunk" : "@@ -1700,7 +1700,7 @@ std::pair<size_t, bool> CConnman::SocketSendData(CNode& node) const\n  *   to forge.  In order to partition a node the attacker must be\n  *   simultaneously better at all of them than honest peers.\n  */\n-bool CConnman::AttemptToEvictConnection(bool evict_tx_relay_peer, std::optional<NodeId> protected_peer)\n+bool CConnman::AttemptToEvictConnection(bool evict_tx_relay_peer, std::optional<NodeId> protect_peer)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366157267",
      "id" : 1366157267,
      "in_reply_to_id" : 1361359734,
      "line" : 1703,
      "node_id" : "PRRC_kwDOABII585RbefT",
      "original_commit_id" : "ab5ad61f67f3bcab503ac3eb012c4f35d733b946",
      "original_line" : 1703,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_review_id" : 1688718629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366157267/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T21:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366157267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366157409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366157409"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, took your suggestion.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-19T21:43:05Z",
      "diff_hunk" : "@@ -3489,6 +3489,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             }\n         }\n \n+        // If we have too many tx-relaying inbound peers, attempt to evict one (not necessarily this one).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366157409",
      "id" : 1366157409,
      "in_reply_to_id" : 1361374856,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Rbehh",
      "original_commit_id" : "ab5ad61f67f3bcab503ac3eb012c4f35d733b946",
      "original_line" : 3492,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1688718861,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366157409/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T21:43:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366157409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366158216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366158216"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "True, that is something the caller has to check. I removed the notion of \"full\" from both `net.h` and `net.cpp`.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-19T21:43:33Z",
      "diff_hunk" : "@@ -1351,7 +1360,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Try to find an inbound connection to evict when the node is full.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366158216",
      "id" : 1366158216,
      "in_reply_to_id" : 1361396844,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RbeuI",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 1364,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1688719906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366158216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T21:43:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366158216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366159427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366159427"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point - done.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-19T21:43:57Z",
      "diff_hunk" : "@@ -3489,6 +3489,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             }\n         }\n \n+        // If we have too many tx-relaying inbound peers, attempt to evict one (not necessarily this one).\n+        // Only if this fails, disconnect this peer.\n+        if (pfrom.IsInboundConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366159427",
      "id" : 1366159427,
      "in_reply_to_id" : 1362698683,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RbfBD",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 3494,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1688721457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366159427/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T21:43:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366159427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366160996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366160996"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "changed to use default values.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-19T21:44:26Z",
      "diff_hunk" : "@@ -1351,7 +1360,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Try to find an inbound connection to evict when the node is full.\n+     * @param[in] evict_tx_relay_peer Whether to only select full relay peers for eviction\n+     * @param[in] protect_peer        Protect peer with node id\n+     * @return                        True if a node was marked for disconnect\n+     */\n+    bool AttemptToEvictConnection(bool evict_tx_relay_peer, std::optional<NodeId> protect_peer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366160996",
      "id" : 1366160996,
      "in_reply_to_id" : 1362704232,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RbfZk",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 1369,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1688723422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366160996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T21:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366160996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366175453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366175453"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "changed to use default values.\r\n\r\nNot sure about the rename suggestion, I think I prefer `EvictTxPeerIfFull`, because I think for naming describing what the function does is more important than describing the return value. Otherwise other spots might call this function in the future with the intention to just perform a check, and then might be surprised about the side effects.",
      "commit_id" : "9555a33b3d5ad9da32402b89b993729895165655",
      "created_at" : "2023-10-19T21:49:26Z",
      "diff_hunk" : "@@ -1198,6 +1197,16 @@ class CConnman\n     int GetExtraFullOutboundCount() const;\n     // Count the number of block-relay-only peers we have over our limit.\n     int GetExtraBlockRelayCount() const;\n+    /**\n+     * If we are at capacity for inbound tx-relay peers, attempt to evict one.\n+     * @param[in]   protect_peer    NodeId of a peer we want to protect\n+     * @return      bool              Returns true if successful (either there is\n+     *                                no need for eviction, or a peer was evicted).\n+     *                                Returns false, if we are full but couldn't find\n+     *                                a peer to evict (all eligible peers are protected)\n+     *                                so that the caller can deal with this.\n+     */\n+    bool EvictTxPeerIfFull(std::optional<NodeId> protect_peer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#discussion_r1366175453",
      "id" : 1366175453,
      "in_reply_to_id" : 1362751635,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Rbi7d",
      "original_commit_id" : "8247eaa09d28469c7d852096bfa4f539d024b1b8",
      "original_line" : 1209,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1688741870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28463",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366175453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T21:49:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1366175453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review @amitiuttarwar! i pushed an update, addressing all feedback.",
      "created_at" : "2023-10-19T21:52:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1771757871",
      "id" : 1771757871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585pmuEv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771757871/reactions"
      },
      "updated_at" : "2023-10-19T21:52:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771757871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "coauthor ack 9555a33b3d5ad9da32402b89b993729895165655\r\n\r\nthe code looks good to me, based on the assumption that our research finds the increase in resource usage reasonable & safe",
      "created_at" : "2023-10-19T22:29:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1771792093",
      "id" : 1771792093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585pm2bd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771792093/reactions"
      },
      "updated_at" : "2023-10-19T22:29:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771792093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-11-08T11:12:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1801677001",
      "id" : 1801677001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585rY2jJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1801677001/reactions"
      },
      "updated_at" : "2023-11-08T11:12:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1801677001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased after #28464 was merged.",
      "created_at" : "2023-11-09T16:24:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1804150092",
      "id" : 1804150092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585riSVM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804150092/reactions"
      },
      "updated_at" : "2023-11-09T16:24:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1804150092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've been running this for about a week now. I currently have 161 inbound connections: 113 (maximum) full-relay connections and 48 block-relay-only connections. \r\n\r\n![image](https://github.com/bitcoin/bitcoin/assets/19157360/eea66aa5-e6ac-40dc-842b-15ca99f49d7f)\r\n",
      "created_at" : "2023-11-14T16:17:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1810590275",
      "id" : 1810590275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585r62pD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1810590275/reactions"
      },
      "updated_at" : "2023-11-14T16:17:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1810590275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "In https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1716393675 you mention that:\r\n\r\n>  [we] don't want to **significantly** change the number of tx-relaying inbound peers, because we donât want to radically change the memory and traffic requirements that come with running a full node with the default configuration.\r\n\r\nOn multiple full-inbound `master` nodes I'm getting roughly an 80%/20% full-relay/block-relay-only inbound split. This makes sense as we currently open 8 full-relay outbound and 2 block-relay outbound connections (ignoring feelers here). That's roughly 91 full-relay  and 23 block-relay inbound connections. With the new maximum of 113 that an increase of 22 full-relay inbound slots being used and nearly an increase of 25%. I'd argue that this is a significant change.",
      "created_at" : "2023-11-14T16:18:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1810591988",
      "id" : 1810591988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585r63D0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1810591988/reactions"
      },
      "updated_at" : "2023-11-14T16:18:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1810591988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'd argue that this is a significant change.\r\n\r\nHmm yes, in that comment I was thinking about the theoretical limit of all inbound slots being filled with tx-relaying peers. You are right, in practice that amount will be lower because some block-relay-only connections are made to us. In that sense, the introduction of block-relay-only peers likely came with a reduction in bandwidth for popular nodes that were already at capacity before.\r\n\r\nOne way to accommodate this would be to reduce the percentage, so that there would only be ~90-100 slots for tx-relaying inbound peers instead of 113.",
      "created_at" : "2023-11-15T16:02:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1812811783",
      "id" : 1812811783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585sDVAH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1812811783/reactions"
      },
      "updated_at" : "2023-11-15T16:02:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1812811783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-11-28T12:42:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28463#issuecomment-1829767423",
      "id" : 1829767423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28463",
      "node_id" : "IC_kwDOABII585tEAj_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829767423/reactions"
      },
      "updated_at" : "2023-11-28T12:42:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1829767423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
