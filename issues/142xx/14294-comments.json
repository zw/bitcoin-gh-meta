[
   {
      "author_association" : "MEMBER",
      "body" : "I guess it returns the max, so that either its own feerate or the feerate with its descandants are considered to allow for fee bumping by spending one (e.g. the change) output and \"attaching\" a high fee?",
      "created_at" : "2018-09-23T00:06:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14294#issuecomment-423781997",
      "id" : 423781997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14294",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzc4MTk5Nw==",
      "updated_at" : "2018-09-23T00:06:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423781997",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I believe it uses the `MAX(transactionFeeRate, transactionAndAllDescendantsFeeRate)` as the `descendant_score`. But I'm still struggling to understand why this is useful. I didn't quite get your comment about allowing for fee bumping",
      "created_at" : "2018-09-23T00:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14294#issuecomment-423782412",
      "id" : 423782412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14294",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzc4MjQxMg==",
      "updated_at" : "2018-09-23T00:21:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423782412",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9326759?v=4",
         "events_url" : "https://api.github.com/users/RHavar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RHavar/followers",
         "following_url" : "https://api.github.com/users/RHavar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RHavar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RHavar",
         "id" : 9326759,
         "login" : "RHavar",
         "node_id" : "MDQ6VXNlcjkzMjY3NTk=",
         "organizations_url" : "https://api.github.com/users/RHavar/orgs",
         "received_events_url" : "https://api.github.com/users/RHavar/received_events",
         "repos_url" : "https://api.github.com/users/RHavar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RHavar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RHavar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RHavar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @sdaftuar ",
      "created_at" : "2018-09-23T03:28:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14294#issuecomment-423789138",
      "id" : 423789138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14294",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzc4OTEzOA==",
      "updated_at" : "2018-09-23T03:28:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423789138",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> which I don't really understand. Wouldn't using `ancestor_score` make a lot more sense?\r\n\r\nI think there are two observations to note here.  First, the ancestor score of a transaction T is the feerate of T along with any unconfirmed transactions that T depends on.\r\n\r\nSecond, if we evict T from the mempool, then to maintain consistency we must also evict all descendants of T as well, so that no transaction in the mempool is missing its unconfirmed parents. \r\n\r\nTaken together, using the ancestor score wouldn't make any sense -- just because a transaction has a low feerate with ancestor does not mean it's unlikely to be included in the next block.  For example, if transaction A is small and has the minimum fee rate of the mempool, but transaction B is a large descendant with a huge feerate, then the ancestor score for A will be small, but it might be selected in the next block, because the ancestor score for B is still very high, causing it to get pulled in when B is selected.  Moreover, if you evicted A for being low feerate, then you must also evict B (which is obviously undesirable -- it might have been the most profitable thing to be included in the next block).\r\n\r\nOne way to think about this is that while the top transactions according to the ancestor score are likely to be good candidates for inclusion in the next block, you have basically no information about whether things at the bottom of the ancestor index are likely to be included or not (since their descendants are relevant to that determination, and the ancestor score tells us nothing about a transaction's descendants).\r\n\r\nOn the other hand, the transaction with the worst descendant score is very unlikely to be a good candidate for inclusion in the next block, as neither the transaction nor its descendants sorts very high -- and again you have basically no information about whether transactions at the top of the descendant index are likely to be included or not (since their ancestors must be included in any block as well, and the descendant score does not include any ancestor information).\r\n\r\nI guess an important point here is that if a low feerate transaction A has two immediate descendants B and C, where B has a high feerate and C has the lowest feerate of the group, then the descendant score of C will be lower than that of A.  This is important because the descendant feerate of A might also be low while C is in the mempool even though A+B may be a good candidate for inclusion in the next block, but C would be evicted first (bumping up A's descendant score) before A would be considered for eviction.\r\n\r\nYou are correct to observe that the descendant score is only used in TrimToSize.  Our mempool limiting algorithm (#6722) works by evicting the least-likely-to-be-mined transactions from the mempool whenever we bump up against our limit, and the descendant score is what we use to measure that.",
      "created_at" : "2018-09-23T09:51:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14294#issuecomment-423804567",
      "id" : 423804567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14294",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzgwNDU2Nw==",
      "updated_at" : "2018-09-23T09:51:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423804567",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
