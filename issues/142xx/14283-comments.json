[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #14284 (build: Add MSVC project files for bitcoin-wallet-tool by ken2812221)\n* #13926 ([Tools] bitcoin-wallet - a tool for creating and managing wallets offline by jnewbery)\n* #13100 (gui: Add dynamic wallets support by promag)\n* #12246 (Bugfix: Only run bitcoin-tx tests when bitcoin-tx is enabled by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-21T03:39:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14283#issuecomment-423403753",
      "id" : 423403753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14283",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzQwMzc1Mw==",
      "updated_at" : "2018-09-27T02:49:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423403753",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @promag - I'll review this later.",
      "created_at" : "2018-09-21T17:50:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14283#issuecomment-423619877",
      "id" : 423619877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14283",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzYxOTg3Nw==",
      "updated_at" : "2018-09-21T17:50:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423619877",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14283#discussion_r219679683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14283"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219679683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-22 20:39:40 cpplint(pr=14283): src/wallet/wallettool.cpp:125:  Should have a space between // and comment  [whitespace/comments] [4]\r\n```",
      "commit_id" : "70fca5181644b1d708e7e71cf844884ef8f34230",
      "created_at" : "2018-09-22T19:01:15Z",
      "diff_hunk" : "@@ -0,0 +1,145 @@\n+// Copyright (c) 2016-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <base58.h>\n+#include <fs.h>\n+#include <util.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletutil.h>\n+\n+namespace WalletTool {\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet-tool. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Flush();\n+    delete wallet;\n+}\n+\n+static std::shared_ptr<CWallet> CreateWallet(const std::string& name, const fs::path& path)\n+{\n+    if (fs::exists(path)) {\n+        fprintf(stderr, \"Error: File exists already\\n\");\n+        return nullptr;\n+    }\n+    std::shared_ptr<CWallet> wallet_instance(new CWallet(name, WalletDatabase::Create(path)), WalletToolReleaseWallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet_instance->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        fprintf(stderr, \"Error creating %s\", name.c_str());\n+        return nullptr;\n+    }\n+\n+    wallet_instance->SetMinVersion(FEATURE_HD_SPLIT);\n+\n+    // generate a new HD seed\n+    CPubKey seed = wallet_instance->GenerateNewSeed();\n+    wallet_instance->SetHDSeed(seed);\n+\n+    fprintf(stdout, \"Topping up keypool...\\n\");\n+    wallet_instance->TopUpKeyPool();\n+    return wallet_instance;\n+}\n+\n+static std::shared_ptr<CWallet> LoadWallet(const std::string& name, const fs::path& path)\n+{\n+    if (!fs::exists(path)) {\n+        fprintf(stderr, \"Error: Wallet files does not exist\\n\");\n+        return nullptr;\n+    }\n+\n+    std::shared_ptr<CWallet> wallet_instance(new CWallet(name, WalletDatabase::Create(path)), WalletToolReleaseWallet);\n+    bool first_run;\n+    DBErrors load_wallet_ret = wallet_instance->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        wallet_instance = nullptr;\n+        if (load_wallet_ret == DBErrors::CORRUPT) {\n+            fprintf(stderr, \"Error loading %s: Wallet corrupted\", name.c_str());\n+            return nullptr;\n+        } else if (load_wallet_ret == DBErrors::NONCRITICAL_ERROR) {\n+            fprintf(stderr, \"Error reading %s! All keys read correctly, but transaction data\"\n+                            \" or address book entries might be missing or incorrect.\",\n+                name.c_str());\n+        } else if (load_wallet_ret == DBErrors::TOO_NEW) {\n+            fprintf(stderr, \"Error loading %s: Wallet requires newer version of %s\",\n+                name.c_str(), PACKAGE_NAME);\n+            return nullptr;\n+        } else if (load_wallet_ret == DBErrors::NEED_REWRITE) {\n+            fprintf(stderr, \"Wallet needed to be rewritten: restart %s to complete\", PACKAGE_NAME);\n+            return nullptr;\n+        } else {\n+            fprintf(stderr, \"Error loading %s\", name.c_str());\n+            return nullptr;\n+        }\n+    }\n+\n+    return wallet_instance;\n+}\n+\n+static void WalletShowInfo(CWallet* wallet_instance)\n+{\n+    // lock required because of some AssertLockHeld()\n+    LOCK(wallet_instance->cs_wallet);\n+\n+    fprintf(stdout, \"Wallet info\\n===========\\n\");\n+    fprintf(stdout, \"Encrypted: %s\\n\", wallet_instance->IsCrypted() ? \"yes\" : \"no\");\n+    fprintf(stdout, \"HD (hd seed available): %s\\n\", wallet_instance->GetHDChain().seed_id.IsNull() ? \"no\" : \"yes\");\n+    fprintf(stdout, \"Keypool Size: %u\\n\", wallet_instance->GetKeyPoolSize());\n+    fprintf(stdout, \"Transactions: %zu\\n\", wallet_instance->mapWallet.size());\n+    fprintf(stdout, \"Address Book: %zu\\n\", wallet_instance->mapAddressBook.size());\n+}\n+\n+bool executeWalletToolFunc(const std::string& method, const std::string& name)\n+{\n+    fs::path path = fs::absolute(name, GetWalletDir());\n+\n+    if (method == \"create\") {\n+        std::shared_ptr<CWallet> wallet_instance = CreateWallet(name, path);\n+        if (wallet_instance) {\n+            WalletShowInfo(wallet_instance.get());\n+            wallet_instance->Flush();\n+        }\n+    } else if (method == \"info\") {\n+        std::shared_ptr<CWallet> wallet_instance = LoadWallet(name, path);\n+        if (!wallet_instance) return false;\n+        WalletShowInfo(wallet_instance.get());\n+        wallet_instance->Flush();\n+    } else if (method == \"salvage\") {\n+        // Recover readable keypairs:\n+        std::string error;\n+        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+            fprintf(stderr, \"WalletBatch::VerifyEnvironment Error: %s\\n\", error.c_str());\n+            return false;\n+        }\n+\n+        CWallet dummyWallet(\"dummy\", WalletDatabase::CreateDummy());\n+        std::string backup_filename;\n+        if (!WalletBatch::Recover(path, (void*)&dummyWallet, WalletBatch::RecoverKeysOnlyFilter, backup_filename)) {\n+            fprintf(stderr, \"Salvage failed\\n\");\n+            return false;\n+        }\n+        //TODO, set wallets best block to genesis to enforce a rescan",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14283#discussion_r219679683",
      "id" : 219679683,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY3OTY4Mw==",
      "original_commit_id" : "70fca5181644b1d708e7e71cf844884ef8f34230",
      "original_position" : 125,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 125,
      "pull_request_review_id" : 157919179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14283",
      "updated_at" : "2018-09-22T19:01:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219679683",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14283#discussion_r220895810"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14283"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220895810"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove this line. It redefines the built-in function `input`. Furthermore it is unused :-)",
      "commit_id" : "70fca5181644b1d708e7e71cf844884ef8f34230",
      "created_at" : "2018-09-27T12:02:58Z",
      "diff_hunk" : "@@ -0,0 +1,102 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoint-wallet-tool.\n+\"\"\"\n+\n+import os\n+import subprocess\n+import textwrap\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+class ToolWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def process(self, *args):\n+        binary = self.config[\"environment\"][\"BUILDDIR\"] + '/src/bitcoin-wallet-tool' + self.config[\"environment\"][\"EXEEXT\"]\n+        input = None",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14283#discussion_r220895810",
      "id" : 220895810,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDg5NTgxMA==",
      "original_commit_id" : "70fca5181644b1d708e7e71cf844884ef8f34230",
      "original_position" : 21,
      "path" : "test/functional/tool_wallet.py",
      "position" : 21,
      "pull_request_review_id" : 159410279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14283",
      "updated_at" : "2018-09-27T12:02:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220895810",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
