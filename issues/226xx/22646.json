{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This PR is a POC for more tightly integrating building Univalue into our build system. This follows the same approach we use for [LevelDB](https://github.com/bitcoin-core/leveldb/), ([`Makefile.leveldb.include`](https://github.com/bitcoin/bitcoin/blob/master/src/Makefile.leveldb.include)), and [CRC32C](https://github.com/bitcoin-core/crc32c) ([Makefile.crc32c.include](https://github.com/bitcoin/bitcoin/blob/master/src/Makefile.crc32c.include)), and will be the same approach we use for [minisketch](https://github.com/sipa/minisketch). See #21859 and the discussion at the end of that PR.\r\n\r\nThis change relies on https://github.com/bitcoin-core/univalue/pull/19 being merged into our upstream Univalue repo. For a POC, I've just cherry-picked the relevant commits into the subtree here.\r\n\r\nAs mentioned in the 3rd commit, this approach yields a number of benefits, including:\r\n* Faster configuration due to one less subconfigure being run during `./configure` i.e 22s with this PR vs 26s\r\n* Faster autoconf i.e 13s with this PR vs 17s\r\n* Improved caching\r\n* No more issues with compiler flags i.e https://github.com/bitcoin/bitcoin/pull/12467\r\n* More direct control means we can build exactly the objects we want\r\n\r\nThere might be one argument against making this change, which is that builders should have the option to use \"proper shared/system libraries\". However, I think that falls down for a few reasons. The first being that we already don't support building with a number of system libraries (secp256k1, leveldb, crc32c); some for good reason. Univalue is really the odd one out at the moment. \r\n\r\nNote that the only fork of Core I'm aware of, that actively patches in support for using system libs, also explicitly marks them as [\"DANGEROUS\"](https://github.com/bitcoinknots/bitcoin/blob/a886811721ce66eb586871706b3f5dd27518ac3e/configure.ac#L1430) and [\"NOT SUPPORTED\"](https://github.com/bitcoinknots/bitcoin/blob/a886811721ce66eb586871706b3f5dd27518ac3e/configure.ac#L1312). So it would seem they exist more to satisfy a distro requirement, as opposed to something that anyone should, or would actually use in practice.\r\n\r\nPRs like #22412 highlight the \"issue\" with us operating with our own Univalue fork, where we actively fix bugs, and make improvements, when upstream (https://github.com/jgarzik/univalue) may not be taking those improvements, and by all accounts, is not currently actively maintained. Bitcoin Core should not be hamstrung into not being able to fix bugs in a library, and/or have to litter our source with \"workarounds\", i.e #22412, for bugs we've already fixed, based on the fact that an upstream project is not actively being maintained. Allowing builders to use system libs is really only exacerbating this problem, with little benefit to our project. Bitcoin Core is not quite like your average piece of distro packaged software.\r\n\r\nThere is the potential for us to give the same treatment to libsecp256k1, however it seems doing that is currently less straightforward. For now, looking for Concept ACKs.\r\n\r\nNote that linter / other failures here are expected for now. If you checkout this branch locally, a `./autogen.sh &&  ./configure &&  make` should work as expected. ",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22646/comments",
   "created_at" : "2021-08-06T03:14:20Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22646/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/22646",
   "id" : 962357650,
   "labels" : [
      {
         "color" : "ebd775",
         "default" : false,
         "description" : null,
         "id" : 64584,
         "name" : "Brainstorming",
         "node_id" : "MDU6TGFiZWw2NDU4NA==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming"
      },
      {
         "color" : "5319e7",
         "default" : false,
         "description" : null,
         "id" : 61889416,
         "name" : "Build system",
         "node_id" : "MDU6TGFiZWw2MTg4OTQxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22646/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NzA1MTU4NTg3",
   "number" : 22646,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/22646.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22646",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/22646.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22646"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[POC] Tighter Univalue integration, remove `--with-system-univalue`",
   "updated_at" : "2021-08-06T03:27:55Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22646",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   }
}
