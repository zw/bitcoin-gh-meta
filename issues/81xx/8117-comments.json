[
   {
      "body" : "The \"Loaded [...] banlist.dat\" is currently hidden in the net debug category: https://github.com/bitcoin/bitcoin/blob/d46b8b50fc3e725df75378db2d81aa48f9a1bd74/src/net.cpp#L1974",
      "created_at" : "2016-06-05T14:27:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-223816108",
      "id" : 223816108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-05T14:27:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223816108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Managed to catch this in the act:\r\n```\r\n#0  __libc_do_syscall ()\r\n    at ../ports/sysdeps/unix/sysv/linux/arm/libc-do-syscall.S:43\r\n#1  0xb6f971c0 in __lll_lock_wait (futex=futex@entry=0x7fad1f04 <cs_main>,\r\n    private=<optimized out>)\r\n    at ../ports/sysdeps/unix/sysv/linux/arm/nptl/lowlevellock.c:46\r\n#2  0xb6f93996 in __GI___pthread_mutex_lock (mutex=0x7fad1f04 <cs_main>)\r\n    at pthread_mutex_lock.c:114\r\n#3  0x7f5b0c80 in lock (this=<optimized out>)\r\n    at /data/src/bitcoin-arm/depends/arm-unknown-linux-gnueabihf/include/boost/thread/pthread/recursive_mutex.hpp:113\r\n#4  lock (this=<optimized out>) at sync.h:60\r\n#5  lock (this=0xbeffdff8)\r\n    at /data/src/bitcoin-arm/depends/arm-unknown-linux-gnueabihf/include/boost/thread/lock_types.hpp:346\r\n#6  Enter (pszName=<optimized out>, pszFile=<optimized out>, nLine=2142496176,\r\n    this=0xbeffdff8) at sync.h:125\r\n#7  CMutexLock<CCriticalSection>::CMutexLock (this=0xbeffdff8, mutexIn=...,\r\n    pszName=<optimized out>, pszFile=<optimized out>, nLine=334, fTry=false)\r\n    at sync.h:146\r\n#8  0x7f5c8b48 in (anonymous namespace)::InitializeNode (nodeid=0,\r\n    pnode=0xbeffe204) at main.cpp:334\r\n#9  0x7f6626e4 in operator() (a1=<optimized out>, a0=<optimized out>,\r\n    this=<optimized out>)\r\n    at /data/src/bitcoin-arm/depends/arm-unknown-linux-gnueabihf/include/boost/function/function_template.hpp:771\r\n#10 m_invoke<boost::function<void(int, const CNode*)>, 0u, 1u, int&, const CNode*&> (args=..., func=..., this=<optimized out>)\r\n    at /data/src/bitcoin-arm/depends/arm-unknown-linux-gnueabihf/include/boost/signals2/detail/variadic_slot_invoker.hpp:95\r\n#11 operator()<boost::function<void(int, const CNode*)>, int&, const CNode*&, 2u> (args=..., func=..., this=<optimized out>)\r\n    at /data/src/bitcoin-arm/depends/arm-unknown-linux-gnueabihf/include/boost/signals2/detail/variadic_slot_invoker.hpp:80\r\n#12 operator()<boost::shared_ptr<boost::signals2::detail::connection_body<std::pair<boost::signals2::detail::slot_meta_group, boost::optional<int> >, boost::signals2::slot<void(int, const CNode*), boost::function<void(int, const CNode*)> >, boost::signals2::mutex> > > (connectionBody=..., this=0xbeffe2c8)\r\n    at /data/src/bitcoin-arm/depends/arm-unknown-linux-gnueabihf/include/boost/signals2/detail/variadic_slot_invoker.hpp:124\r\n#13 dereference (this=0xbeffe1d0)\r\n    at /data/src/bitcoin-arm/depends/arm-unknown-linux-gnueabihf/include/boost/signals2/detail/slot_call_iterator.hpp:109\r\n[snip]\r\n#20 CNode::CNode (this=0x843c6f68, this@entry=0x843c6db8, \r\n    hSocketIn=hSocketIn@entry=4294967295, addrIn=..., addrNameIn=..., \r\n    fInboundIn=fInboundIn@entry=false) at net.cpp:2426\r\n#21 0x7f6475c8 in StartNode (threadGroup=..., scheduler=...) at net.cpp:2004\r\n#22 0x7f5a8c14 in AppInit2 (threadGroup=..., scheduler=...) at init.cpp:1416\r\n#23 0x7f58b4a4 in AppInit (argc=2, argv=<optimized out>) at bitcoind.cpp:161\r\n#24 0x7f583450 in main (argc=2, argv=0xbefff414) at bitcoind.cpp:190\r\n```\r\n\r\nSo what happens is:\r\n\r\n- The call to `StartNode` in init.cpp ends up in `InitializeNode`, through the `CNode` constructor (while creating `pnodeLocalHost`)\r\n- `InitializeNode` attempts to get `cs_main` lock\r\n- However, `ActivateBestChain` is running in the `bitcoin-loadblk` thread. This holds the cs_main lock for a long time\r\n- Only after `ActivateBestChain` finishes, the lock is released, and control flow leaves AppInit2()\r\n\r\nThis behavior was probably introduced in #7917 (@sipa). It was not the intention. The intention was to move this work to a thread so that it doesn't have to block AppInit2. However due to this perverse case of locking, it ends up that way, with a non-enlightening init message.\r\n",
      "created_at" : "2016-06-06T12:21:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-223943102",
      "id" : 223943102,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-06T12:38:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223943102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Not sure how to fix this though. \r\n\r\nJust changing to a better init message (such as \"Activating Best Chain\") is hard as this happens from so deep in the call tree.\r\n\r\nEven though ActivateBestChain is able to release the cs_main since commit 4e0eed8 (#4148), maybe it doesn't do so often enough. It catched up about 16 blocks before initialization could continue.\r\n",
      "created_at" : "2016-06-06T12:35:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-223946112",
      "id" : 223946112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-06T12:35:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223946112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Maybe we should call boost::this_thread::yield when activating best chain releases cs_main?",
      "created_at" : "2016-06-06T12:38:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-223946608",
      "id" : 223946608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-06T12:38:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223946608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Maybe that could help, although I'm not sure how useful a yield still is in multi-core systems. If another thread is waiting on a lock, shouldn't it (at least on average) get it when it is released?\r\n\r\nHow often is it supposed to release the lock?\r\n",
      "created_at" : "2016-06-06T12:41:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-223947304",
      "id" : 223947304,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-06T12:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223947304",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "It releases the lock after every \"strict improvement\" to the chainstate. So\nit won't release during a reorg, or when discovering an invalid block.\nDuring normal reindex it should release after every block.\n",
      "created_at" : "2016-06-06T12:44:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-223948066",
      "id" : 223948066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-06T12:44:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223948066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "After every block is exactly what I'd expect. Will add some debugging to check that.",
      "created_at" : "2016-06-06T13:01:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-223951790",
      "id" : 223951790,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-06T13:01:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223951790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Today I had another case of this, but it paused at \"init message: Done loading\" instead, before showing the main window.\r\nThe Qt initialization that happens after AppInit2 finishes (in `BitcoinApplication::initializeResult`) also requires the `cs_main` lock at some places. Unfortunately this was not on a node with special instrumentation.",
      "created_at" : "2016-06-27T14:38:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-228764875",
      "id" : 228764875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-06-27T14:38:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228764875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Is this a release blocker? If so, some testing of #8392 would be welcome.",
      "created_at" : "2016-07-30T00:50:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8117#issuecomment-236327606",
      "id" : 236327606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8117",
      "updated_at" : "2016-07-30T00:50:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236327606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
