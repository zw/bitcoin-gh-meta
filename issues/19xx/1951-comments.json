[
   {
      "body" : "Seems logical, as before the blk000x.dat files had a hard-coded limit of < 2GiB on Windows. I'm sure @jgarzik or @sipa can clarify this. Are you using NTFS or FAT32 as filesystem?",
      "created_at" : "2012-10-23T20:00:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9715924",
      "id" : 9715924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-23T20:00:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9715924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "NTFS and EXT4. Linux PPA build 0.7.0 exhibits the same behaviour.",
      "created_at" : "2012-10-24T02:09:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9725372",
      "id" : 9725372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T02:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9725372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1425520?v=3",
         "events_url" : "https://api.github.com/users/qubez/events{/privacy}",
         "followers_url" : "https://api.github.com/users/qubez/followers",
         "following_url" : "https://api.github.com/users/qubez/following{/other_user}",
         "gists_url" : "https://api.github.com/users/qubez/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/qubez",
         "id" : 1425520,
         "login" : "qubez",
         "organizations_url" : "https://api.github.com/users/qubez/orgs",
         "received_events_url" : "https://api.github.com/users/qubez/received_events",
         "repos_url" : "https://api.github.com/users/qubez/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/qubez/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/qubez/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/qubez"
      }
   },
   {
      "body" : "Don't blame the file system, modern filesystems can handle huge files (how else would you store your BluRay images :smirk:) \r\nIt's probably some trivial issue using `int` or `unsigned int` as file pointer with `fseek` instead of `off_t`.\r\n\r\nLooking at `CDiskBlockPos` in main.h: \r\n\r\n    ...\r\n    unsigned int nPos\r\n    ....\r\n\r\nAlso line 2502 in `main.cpp` https://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L2502. \r\nAnd in `util.h`:\r\n\r\n    void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) \r\n\r\n",
      "created_at" : "2012-10-24T06:35:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9729271",
      "id" : 9729271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T06:37:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9729271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I suppose a CReadBuffer that wraps around CAutoFile or other reader classes, and has a method for skipping input until a fixed string is found, would be a very neat solution that doesn't require any seeking at all.\r\n\r\nAlso, fixing the byte offsets to use off_t instead of ints in the code would certainly be an improvement, but at least in the current flow, AllocateFileRange should never be called with offset+length > 128 MiB.",
      "created_at" : "2012-10-24T09:21:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9732973",
      "id" : 9732973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T09:23:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9732973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Is off_t a 64 bit unsigned integer? That would allow quite bigfiles ^^.\r\n\r\nWe need to fix this even with ultraprune, because of the bootstrap.dat file mentioned.",
      "created_at" : "2012-10-24T12:40:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9737788",
      "id" : 9737788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T12:40:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9737788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "off_t is whatever the system supports for offsets, but it's not entirely standardized (there's also a off64_t sometimes, with corresponding lseek64 function, defeating the purpose of the origin off_t somewhat). \r\n\r\nWhat I'm saying is that off_t would certainly be an improvement over what we have now, it'd even be better not to need to seek at all, which is certainly possible in LoadExternalBlockFile.",
      "created_at" : "2012-10-24T13:06:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9738470",
      "id" : 9738470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T13:06:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9738470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "As noted in IRC, the specific problem is that LoadExternalBlockFile() calls fseek(), whose file offset is limited to signed 32-bit (long) on 32-bit platforms.  This impacts Windows, Linux and presumably OSX as well.\r\n\r\n1) LoadExternalBlockFile() should be updated to avoid seeking.  Most likely fread() will continue to work beyond even 4GB boundary, if we read linearly and accumulate the file position ourselves.\r\n\r\n2) Most of the code uses 32 bits for file position, which is highly disappointing.  At a minimum, we should make sure that external serialized storage in databases like ultraprune record 64-bit file positions.\r\n",
      "created_at" : "2012-10-24T13:37:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9739447",
      "id" : 9739447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T13:37:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9739447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I wonder if SEEK_CUR would work?",
      "created_at" : "2012-10-24T13:41:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9739607",
      "id" : 9739607,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T13:41:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9739607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "SEEK_CUR would probably work, but why chance it?  A simple linear read works fine too.\r\n\r\n",
      "created_at" : "2012-10-24T13:44:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9739710",
      "id" : 9739710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T13:44:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9739710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "A different solution would be to have blockchain-generating scripts create transaction block files less than 2GB in size, perhaps named bootstrap.001, bootstrap.002, etc, and have Bitcoin look for and import these sequentially instead. One must be concerned about another file - blkindex.dat, it is 1.1GB and must be replaced in all clients with the ultraprune leveldb and/or reviewed for big file support before it approaches 2GB.",
      "created_at" : "2012-10-24T20:55:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9756183",
      "id" : 9756183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-24T20:56:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9756183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1425520?v=3",
         "events_url" : "https://api.github.com/users/qubez/events{/privacy}",
         "followers_url" : "https://api.github.com/users/qubez/followers",
         "following_url" : "https://api.github.com/users/qubez/following{/other_user}",
         "gists_url" : "https://api.github.com/users/qubez/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/qubez",
         "id" : 1425520,
         "login" : "qubez",
         "organizations_url" : "https://api.github.com/users/qubez/orgs",
         "received_events_url" : "https://api.github.com/users/qubez/received_events",
         "repos_url" : "https://api.github.com/users/qubez/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/qubez/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/qubez/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/qubez"
      }
   },
   {
      "body" : "`off_t` is 64 bit if -D_FILE_OFFSET_BITS=64 is defined. I've just verified this with mingw and linux (someone needs to verify on OSX). \r\n\r\nAnother problem is that we use `fseek` takes a `long` for the offset. This depends on the architecture. We could instead use `fseeko` which takes an `off_t` (and `ftello` which returns one).\r\n\r\n@qubez: blkindex.dat is not affected, it is a berkelydb database, which has no problems with large files\r\n\r\n",
      "created_at" : "2012-10-25T05:57:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-9766916",
      "id" : 9766916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2012-10-25T05:59:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/9766916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "This is reported solved by https://bitcointalk.org/index.php?topic=142151.msg1518404#msg1518404",
      "created_at" : "2013-02-11T07:19:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-13370473",
      "id" : 13370473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2013-02-11T07:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/13370473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "Yes, it is solved",
      "created_at" : "2013-02-11T07:46:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1951#issuecomment-13370882",
      "id" : 13370882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1951",
      "updated_at" : "2013-02-11T07:46:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/13370882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   }
]
