[
   {
      "body" : "Please use the number of blocks on top of a block, rather than the height difference with the best known tip. This shouldn't be hard, as ActivateBestChain knows what tip we're working towards, so it could be passed down.\r\n\r\nAlso, I think you need a check to have a reasonable guess that pindexBestHeader is reasonably accurate/recent/valid, so you can't be cheated into skipping validation while being sybilled during IBD.\r\n\r\nFurthermore, just height can probably be skewed by an attacker. I think it's safer to look at difference in nChainWork, and divide that by best difficulty seen.\r\n\r\nAlso, removing the checkpoint verification before accepting a header means you're vulnerable to a memory usage DOS attack during IBD (a peer can give you a arbitrarily long low-difficulty headers).\r\n\r\nI'm generally in favor of reducing the relevance of checkpoints, but I think this patch is a way too large step at once. \r\n\r\nEDIT: fixed wrong code example",
      "created_at" : "2015-03-01T10:49:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-76591709",
      "id" : 76591709,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-02T10:21:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76591709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I think in general we can't get rid of checkpoints at this point. But we can reduce them to a performance/security tradeoff, without being a lock-in to a particular chain.",
      "created_at" : "2015-03-01T10:52:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-76591814",
      "id" : 76591814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-01T10:52:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76591814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@maaku's concern is trivially addressed by making it a one way latch.  E.g. so reorgs are still checked.",
      "created_at" : "2015-03-03T09:56:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-76916873",
      "id" : 76916873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-03T09:56:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76916873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "I was combing through the code recently with this in mind. \r\n\r\nMy idea was to disable checkpoints for accepting blocks once you are done totally catching up with the main chain(IsInitialBlockDownload() ?). You get the security benefits of the checkpoints during spinup, but removes the \"but Bitcoin uses checkpoints!\" idiocy in practice.\r\n\r\nWould anyone be interested in this?",
      "created_at" : "2015-03-09T02:46:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-77792708",
      "id" : 77792708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-09T02:48:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77792708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "@instagibbs with headers first we do not need them during initial sync the benefit there can just be replaced by a work threshold before showing confirmations, or the like.",
      "created_at" : "2015-03-09T02:48:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-77792855",
      "id" : 77792855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-09T02:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77792855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell Just looking for small discrete steps that can be taken that answer 90% of the misconception without too much logic/code change. ",
      "created_at" : "2015-03-09T03:01:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-77793631",
      "id" : 77793631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-09T03:01:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77793631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Agree with @sipa. Going to close this for now. Brainstorming can continue, but we can rule out 'cut out checkpoints completely' for the forseeable future.",
      "created_at" : "2015-03-18T09:19:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-82842522",
      "id" : 82842522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-18T09:19:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/82842522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "What did sipa say? It's not in the pull request. I would be for the patch\nif disabled script was constrained to initial block download only.\nOn Mar 18, 2015 2:20 AM, \"Wladimir J. van der Laan\" <\nnotifications@github.com> wrote:\n\n> Agree with @sipa <https://github.com/sipa>. Going to close this for now.\n> Brainstorming can continue, but we can rule out 'cut out checkpoints\n> completely' for the forseeable future.\n>\n> Ã¢ÂÂ\n> Reply to this email directly or view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-82842522>.\n>\n",
      "created_at" : "2015-03-18T15:53:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-83031425",
      "id" : 83031425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-18T15:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/83031425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69154?v=3",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "body" : "@maaku I never really commented on the whole, but I'm with @laanwj: we need intermediate steps first.",
      "created_at" : "2015-03-18T16:05:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-83036002",
      "id" : 83036002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-18T16:05:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/83036002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Can we get broad agreement about what specific attacks/issues checkpoints solve today in a post-headers first era? As a relative outsider to the codebase I'd make a pull request attempt but don't want to waste my time with inadequate fixes.",
      "created_at" : "2015-03-18T16:36:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-83049565",
      "id" : 83049565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-18T16:36:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/83049565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "@maaku @sipa I was referring to this:\r\n\r\n> I'm generally in favor of reducing the relevance of checkpoints, but I think this patch is a way too large step at once. \r\n\r\nThe way forward would be to split this up up, to remove or replace the individual uses of checkpoints one by one, so the advantages and disadvantages can be discussed on a case by case basis. Just ripping it out completely is an interesting experiment but doesn't pass the risk/benefits test.\r\n",
      "created_at" : "2015-03-18T16:53:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-83055750",
      "id" : 83055750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-18T16:53:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/83055750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Currently checkpoints do two things:\n\nPrincipally they allow for skipping script checks for blocks which are\ncovered by the checkpoint.\n\nThey also prevent a re-org that would change a checkpoint.\n\nThe re-org locking behavior is really a consequence of the first; it is\nnot a useful attack mitigation.\n\nOn 03/18/2015 09:36 AM, instagibbs wrote:\n>\n> Can we get broad agreement about what specific attacks/issues\n> checkpoints solve today in a post-headers first era? As a relative\n> outsider to the codebase I'd make a pull request attempt but don't\n> want to waste my time with inadequate fixes.\n>\n> Ã¢ÂÂ\n> Reply to this email directly or view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-83049565>.\n>\n\n",
      "created_at" : "2015-03-18T17:22:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5842#issuecomment-83066884",
      "id" : 83066884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5842",
      "updated_at" : "2015-03-18T17:22:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/83066884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   }
]
