[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/26289#pullrequestreview-1147194187), [theStack](https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1286211972) |\n| Approach ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/26289#pullrequestreview-1145894331) |\n| Stale ACK | [aureleoules](https://github.com/bitcoin/bitcoin/pull/26289#pullrequestreview-1158290454), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/26289#pullrequestreview-1197759242) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26531](https://github.com/bitcoin/bitcoin/pull/26531) (mempool: Add mempool tracepoints by virtu)\n* [#23962](https://github.com/bitcoin/bitcoin/pull/23962) (Use `int32_t` type for most transaction size/weight values by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-10-10T23:50:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1273919667",
      "id" : 1273919667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585L7niz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273919667/reactions"
      },
      "updated_at" : "2022-12-12T18:24:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273919667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-10-20T22:08:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1286211972",
      "id" : 1286211972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585MqgmE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286211972/reactions"
      },
      "updated_at" : "2022-10-20T22:08:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286211972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1001810274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001810274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Even when this currently cannot fail (because of the no limits and search parents args), I would be more conservative and catch + log any possible result error instead of assert the result.\r\n\r\nIn this way, we keep the current behavior, and use an empty `ancestors` set instead of aborting in production if something gets changed inside `CalculateMemPoolAncestors` and we forget to update this call.",
      "commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "created_at" : "2022-10-21T13:47:08Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1001810274",
      "id" : 1001810274,
      "line" : 398,
      "node_id" : "PRRC_kwDOABII5847tmli",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 15,
      "pull_request_review_id" : 1150991801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001810274/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T13:48:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001810274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003202320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003202320"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Interesting. I see your point re robustness, but generally, I really don't like silent failures - even when logged. I'd much rather they throw so we can more easily detect and fix unexpected behaviour as early on as possible. There are 7 instances in this PR where we do this kind of assertion - would you only want to update it here or also in the other instances? I also understand that the current behaviour is that of silent failure, so I wouldn't want to break anything with this change - but as you mention, I don't think it does, given the `NoLimits()` parameter in all of these instances.\r\n\r\nCc'ing the other reviewers in case anyone else has a view (@w0xlt @glozow @theStack @aureleoules)\r\n\r\n<details>\r\n<summary>git diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/node/miner.cpp b/src/node/miner.cpp\r\nindex 0dc50c75c..c6838aee0 100644\r\n--- a/src/node/miner.cpp\r\n+++ b/src/node/miner.cpp\r\n@@ -395,7 +395,13 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\r\n             continue;\r\n         }\r\n \r\n-        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};\r\n+        auto ancestors_result{Assume(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};\r\n+        if (!ancestors_result) {\r\n+            LogPrintLevel(BCLog::MEMPOOL, BCLog::Level::Error, \r\n+                          \"%s: CalculateMemPoolAncestors failed unexpectedly, continuing with empty ancestor set (%s)\",\r\n+                          __func__, util::ErrorString(ancestors_result));\r\n+        }\r\n+        auto ancestors{ancestors_result.value_or(CTxMemPool::setEntries{})}; // for robustness, continue with empty ancestors if the calculation failed\r\n \r\n         onlyUnconfirmed(ancestors);\r\n         ancestors.insert(iter);\r\n```\r\n</details>\r\n\r\n_edit: now using `Assume()` in the diff as per MarcoFalke's suggestion_",
      "commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "created_at" : "2022-10-24T11:25:08Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003202320",
      "id" : 1003202320,
      "in_reply_to_id" : 1001810274,
      "line" : 398,
      "node_id" : "PRRC_kwDOABII5847y6cQ",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 15,
      "pull_request_review_id" : 1152982732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003202320/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T11:38:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003202320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003208882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003208882"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At least you'll still need to use `Assume` to abort in debug builds",
      "commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "created_at" : "2022-10-24T11:33:48Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003208882",
      "id" : 1003208882,
      "in_reply_to_id" : 1001810274,
      "line" : 398,
      "node_id" : "PRRC_kwDOABII5847y8Cy",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 15,
      "pull_request_review_id" : 1152991981,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003208882/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T11:33:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003208882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003341042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003341042"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Interesting. I see your point re robustness, but generally, I really don't like silent failures - even when logged. I'd much rather they throw so we can more easily detect and fix unexpected behaviour as early on as possible\r\n\r\nWell, at least on the mempool and validation areas, I'm on the totally opposite position.\r\nIf a result can have different meanings, then I would forcibly handle every possible outcome. We want robustness there.\r\n\r\nGenerally speaking: as the node's mempool state is built from the network, if there is a way to trigger something like this from an external source and we overseeing it (which could happen because we are humans), then an attacker could crash nodes remotely. And once that happens, there isn't a quick fix. Core isn't a common piece of software, any new version distribution and update coordination is hard.\r\n\r\nThus why I would rather be more conservative in terms of using assertions there. And instead, I would actually force us to not ignore errors paths (we could extend our result class to work similarly to the [Rust result type](https://doc.rust-lang.org/std/result/), so we are always forced to handle every possible outcome by default) or to rewrite code so it cannot fail in places that we don't expect failures.\r\n\r\nThis all comes from very bad experiences that I had in the past..\r\n\r\n> At least you'll still need to use Assume to abort in debug builds\r\n\r\n@MarcoFalke that wouldn't work, the result class internally asserts that the value exists when the `operator*()` is called (the upper `Assert()` call is actually redundant).",
      "commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "created_at" : "2022-10-24T13:51:33Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003341042",
      "id" : 1003341042,
      "in_reply_to_id" : 1001810274,
      "line" : 398,
      "node_id" : "PRRC_kwDOABII5847zcTy",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 15,
      "pull_request_review_id" : 1153180496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003341042/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T13:51:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003341042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003347640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003347640"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> @MarcoFalke that wouldn't work, the result class internally asserts that the value exists when the operator*() is called (the upper Assert() call is actually redundant).\r\n\r\nSure, but not when `*` is replaced with `value_or`.",
      "commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "created_at" : "2022-10-24T13:56:59Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003347640",
      "id" : 1003347640,
      "in_reply_to_id" : 1001810274,
      "line" : 398,
      "node_id" : "PRRC_kwDOABII5847zd64",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 15,
      "pull_request_review_id" : 1153190071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003347640/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T13:57:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003347640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003360914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003360914"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> > @MarcoFalke that wouldn't work, the result class internally asserts that the value exists when the operator*() is called (the upper Assert() call is actually redundant).\r\n> \r\n> Sure, but not when `*` is replaced with `value_or`.\r\n\r\nYeah, in that way we would retain the current behavior and add the assertion for debug builds only.\r\n\r\nStill, future thing, I'm more inclined to rewrite the code so the function cannot fail or.., at least, add the error handler so it becomes clear what we do if it fails on places that we don't expect failures.",
      "commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "created_at" : "2022-10-24T14:08:21Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1003360914",
      "id" : 1003360914,
      "in_reply_to_id" : 1001810274,
      "line" : 398,
      "node_id" : "PRRC_kwDOABII5847zhKS",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 15,
      "pull_request_review_id" : 1153209729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003360914/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T14:10:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003360914",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If there's an actual bug, it should be fixed before/independently of the refactor (and only that fix backported).",
      "created_at" : "2022-10-25T15:11:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1290725923",
      "id" : 1290725923,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585M7uoj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1290725923/reactions"
      },
      "updated_at" : "2022-10-25T15:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1290725923",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1004882678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004882678"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> (the upper Assert() call is actually redundant)\r\n\r\nI don't think that's true, Assert does a [boolean evaluation](https://github.com/bitcoin/bitcoin/blob/master/src/util/check.h#L66), so Result's `operator*()` [is not called](https://github.com/bitcoin/bitcoin/blob/3db23fd821e0a08e246a60c198676be42de5bcd6/src/util/result.h#L70).\r\n\r\n> ... then an attacker could crash nodes remotely...\r\n\r\nPoint taken. I've reorganized (force pushing soon) the PR so that the first 2 commits keep the current (robust) behaviour but just using `util::Result`. In 2 subsequent commits I introduce and use a helper fn `AssumeCalculateMemPoolAncestors` to call `CalculateMemPoolAncestors` and always get a setEntries back, but for non-debug builds log the error in case of failure, or halt the application for debug builds. I think that strikes a nice balance between robustness in production and increasing visibility (of which currently we have 0 in master, for this issue) in development - hope you agree?",
      "commit_id" : "c7f82366f5bbde62f8cbd2511cf5af99b2e3860d",
      "created_at" : "2022-10-25T19:24:32Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1004882678",
      "id" : 1004882678,
      "in_reply_to_id" : 1001810274,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58475Ur2",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : null,
      "pull_request_review_id" : 1155378189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004882678/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T19:24:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004882678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed to address review comments.\r\n\r\n> If there's an actual bug, it should be fixed before/independently of the refactor (and only that fix backported)\r\n\r\nI added [c25c6a6](https://github.com/bitcoin/bitcoin/pull/26289/commits/c25c6a6dc7843833d60da285d1681bfeb5022723) \r\n\r\n---\r\n\r\nMost of the changes address [furszy's comments](https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1001810274). In summary: ancestors/descendant limits unexpectedly getting hit no longer result in an assertion error (unless on debug builds) but in an error log message instead to avoid the node from crashing in case of a (non-fatal) unexpected error.\r\n",
      "created_at" : "2022-10-25T19:50:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1291059559",
      "id" : 1291059559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585M9AFn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291059559/reactions"
      },
      "updated_at" : "2022-10-25T19:50:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291059559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Marking as draft until I've resolved the CI issues.",
      "created_at" : "2022-10-25T20:48:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1291125096",
      "id" : 1291125096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585M9QFo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291125096/reactions"
      },
      "updated_at" : "2022-10-25T20:48:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291125096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "PR is now ready for re-review - CI issues fixed. Looks like the [argument forwarding](https://github.com/bitcoin/bitcoin/compare/c7f82366f5bbde62f8cbd2511cf5af99b2e3860d..2f832f0c45aae3b51353db72691b4bc6450a7e9a#diff-c065d4cd2398ad0dbcef393c5dfc53f465bf44723348892395fffd2fb3bac522L296-R298) was causing issues on some platforms ([ARM](https://cirrus-ci.com/task/5603870725373952), [Win64](https://cirrus-ci.com/task/6729770632216576)) - so I've just updated it to not use forwarding, since debugging it was going too slow and this approach is clean enough.",
      "created_at" : "2022-10-26T12:36:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1291968235",
      "id" : 1291968235,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585NAd7r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291968235/reactions"
      },
      "updated_at" : "2022-10-26T13:13:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291968235",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007817860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007817860"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can you explain why this is a bugfix? There is currently no code path that doesn't clear the set before calling this function.",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T08:48:46Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007817860",
      "id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848EhSE",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1159700970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007817860/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T08:48:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007817860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007822559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007822559"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, I see it is only in the package acceptance code path?",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T08:53:59Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007822559",
      "id" : 1007822559,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Eibf",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1159707815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007822559/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T08:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007822559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007893339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007893339"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> it is only in the package acceptance code path?\r\n\r\nThat's my understanding, yes. `MemPoolAccept::PreChecks` and `MemPoolAccept::SubmitPackage` are the only functions where `setAncestors` isn't (always) cleared before calling `CalculateMemPoolAncestors`. In `MemPoolAccept::AcceptMultipleTransactions()`, we first call `PreChecks()` and then `SubmitPackage()` with the same `Workspace`. `PreChecks` always seems to be called with a fresh `Workspace`, so I'd say `SubmitPackage` is the only issue. Given that this is currently only used in `testmempoolaccept` and `submitpackage` RPCs, it shouldn't be a particularly impactful bug.\r\n\r\nI'll update the PR description a bit more now, and if I have to retouch, I'll update the bugfix commit message to add some more background.",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T10:06:06Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007893339",
      "id" : 1007893339,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Eztb",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1159809902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007893339/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T10:06:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007893339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007899547"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007899547"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Correct, the only path is in `SubmitPackage`. It's not problematic to pass in `ws.m_ancestors` that is already populated because the set calculated in `SubmitPackage` should be a superset of the set calculated in `PreChecks`. If not, that would be a bug (hence the `Assume(false)` case). I agree CMPA *should* always start with an empty ancestor set. ~Feel free to call it a bug or unexpected behavior etc.~ Maybe I wouldn't call it bug, but brittle code that is worth improving.",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T10:13:22Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007899547",
      "id" : 1007899547,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848E1Ob",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1159818908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007899547/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T11:51:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007899547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007929293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007929293"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 643ea3a2f8c12b538c5a2a3994f383ef0ed372fa:\r\n\r\nis this necessary if it's already included in txmempool.h?",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T10:49:05Z",
      "diff_hunk" : "@@ -17,8 +17,10 @@\n #include <util/check.h>\n #include <util/moneystr.h>\n #include <util/overflow.h>\n+#include <util/result.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007929293",
      "id" : 1007929293,
      "line" : 20,
      "node_id" : "PRRC_kwDOABII5848E8fN",
      "original_commit_id" : "643ea3a2f8c12b538c5a2a3994f383ef0ed372fa",
      "original_line" : 20,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1159854198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007929293/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T12:10:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007929293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007935678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007935678"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wrote a quick check on `master` to verify that ancestors passed into CMPA are indeed always a subset of what is returned at the end of CMPA. At least as far as the scenarios covered in the unit and functional tests, that seems to be the case, since with this patch all tests complete without throwing.\r\n\r\n<details>\r\n<summary>git diff on master (5974c49f9)</summary>\r\n\r\n```diff\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 84ed2e9ef..e024ebe81 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -190,6 +190,8 @@ bool CTxMemPool::CalculateAncestorsAndCheckLimits(size_t entry_size,\r\n                                                   const Limits& limits,\r\n                                                   std::string &errString) const\r\n {\r\n+    setEntries incoming_ancestors{setAncestors.begin(), setAncestors.end()};\r\n+    setAncestors.clear();\r\n     size_t totalSizeWithAncestors = entry_size;\r\n \r\n     while (!staged_ancestors.empty()) {\r\n@@ -226,6 +228,9 @@ bool CTxMemPool::CalculateAncestorsAndCheckLimits(size_t entry_size,\r\n         }\r\n     }\r\n \r\n+    for (auto& ancestor : incoming_ancestors){\r\n+        if (setAncestors.find(ancestor) == setAncestors.end()) throw std::runtime_error(\"incoming ancestor not found\");\r\n+    }\r\n     return true;\r\n }\r\n ```\r\n</details>",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T10:57:34Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007935678",
      "id" : 1007935678,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848E-C-",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1159870723,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007935678/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T10:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007935678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007979531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007979531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thank you for checking!\r\n\r\nSo this is an example of brittle code that hasn't resulted in an actual bug (yet) but is worth improving. See also #23621 which is a similar situation.",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T11:51:40Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007979531",
      "id" : 1007979531,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848FIwL",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1159854198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007979531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T12:10:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007979531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007991920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007991920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Using `value_or` and `Assume()` seems like a good balance between handling every case and avoiding asserts in p2p-reachable codepaths. It's not great that some callsites ignore the return value of CMPA and continue using the ancestor set on master - I was going to comment about it until I saw the last couple commits. Agree adding an `Assume()` to catch in debug mode + logging is a better approach than halting in production.",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T12:07:09Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007991920",
      "id" : 1007991920,
      "in_reply_to_id" : 1001810274,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848FLxw",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : null,
      "pull_request_review_id" : 1159854198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007991920/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T12:10:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007991920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1008052246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008052246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not necessary, but [developer notes](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#source-code-organization) state:\r\n\r\n> Every .cpp and .h file should #include every header file it directly uses classes, functions or other definitions from, even if those headers are already included indirectly through other headers.\r\n\r\nI'm not sure if just listing it as a return type classifies as \"uses\", but either way it seems like a sane thing to do?",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T13:14:16Z",
      "diff_hunk" : "@@ -17,8 +17,10 @@\n #include <util/check.h>\n #include <util/moneystr.h>\n #include <util/overflow.h>\n+#include <util/result.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1008052246",
      "id" : 1008052246,
      "in_reply_to_id" : 1007929293,
      "line" : 20,
      "node_id" : "PRRC_kwDOABII5848FagW",
      "original_commit_id" : "643ea3a2f8c12b538c5a2a3994f383ef0ed372fa",
      "original_line" : 20,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1160045693,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008052246/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T13:14:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008052246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1008056351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008056351"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think everyone's concerns are now addressed so I'll mark this as resolved, thanks for the input everyone.",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T13:18:15Z",
      "diff_hunk" : "@@ -394,9 +395,7 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors{*Assert(mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1008056351",
      "id" : 1008056351,
      "in_reply_to_id" : 1001810274,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Fbgf",
      "original_commit_id" : "a425537fbfc20d87c325b5ae2f06f2597a31cf0e",
      "original_line" : 398,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : null,
      "pull_request_review_id" : 1160051760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008056351/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T13:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008056351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1008197779"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008197779"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, good point :)",
      "commit_id" : "2f832f0c45aae3b51353db72691b4bc6450a7e9a",
      "created_at" : "2022-10-28T15:35:24Z",
      "diff_hunk" : "@@ -17,8 +17,10 @@\n #include <util/check.h>\n #include <util/moneystr.h>\n #include <util/overflow.h>\n+#include <util/result.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1008197779",
      "id" : 1008197779,
      "in_reply_to_id" : 1007929293,
      "line" : 20,
      "node_id" : "PRRC_kwDOABII5848F-CT",
      "original_commit_id" : "643ea3a2f8c12b538c5a2a3994f383ef0ed372fa",
      "original_line" : 20,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1160264021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008197779/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T15:35:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008197779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Would there be any merit to an alternative approach of logging how many current ancestors were passed in, and then subtracting that for the invariant check? That way you allocate less memory in the package code?",
      "created_at" : "2022-10-28T16:00:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1295170873",
      "id" : 1295170873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585NMr05",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1295170873/reactions"
      },
      "updated_at" : "2022-10-28T16:00:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1295170873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Would there be any merit to an alternative approach of logging how many current ancestors were passed in, and then subtracting that for the invariant check? That way you allocate less memory in the package code?\r\n\r\nHaving trouble understanding the question, can you elaborate on where the subtraction would be and which memory allocation you're referring to?",
      "created_at" : "2022-11-01T16:50:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1298824134",
      "id" : 1298824134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585NanvG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298824134/reactions"
      },
      "updated_at" : "2022-11-01T16:50:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298824134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-22T11:03:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1323495771",
      "id" : 1323495771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585O4vFb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1323495771/reactions"
      },
      "updated_at" : "2022-11-22T11:03:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1323495771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased to address the merge conflict from - no other changes:\r\n\r\n```\r\ngit range-diff 85892f77c98c7a08834a06d52af3eb474275afd8 2f832f0 1f89af219a89da155d5302ca4fdc4f8f1f8612aa\r\n```\r\n\r\n@JeremyRubin I'm not sure I understand your question either, would appreciate if you could elaborate a bit? Thanks!",
      "created_at" : "2022-11-22T15:19:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1323841650",
      "id" : 1323841650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585O6Dhy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1323841650/reactions"
      },
      "updated_at" : "2022-11-22T15:19:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1323841650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I was mostly observing that the ancestors tracking is mostly being used for limits checking here, so there is an opportunity to (I think) not actually build a ancestor set and just use epochs to count the number of distinct ancestors directly. You can decrease the limit by another ancestor count if necessary.",
      "created_at" : "2022-11-22T18:05:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1324060159",
      "id" : 1324060159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585O643_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324060159/reactions"
      },
      "updated_at" : "2022-11-22T18:05:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324060159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for clearing it up, you're talking about `CTxMemPoolEntry::Parents staged_ancestors`, right? @glozow suggested me that improvement (offline) earlier as well, I agree that it looks like that can be improved with an epoch approach as you say. I've started working on it but not yet ready for PR. I'd say it's pretty orthogonal to the changes proposed here (we don't really touch `staged_ancestors`, focus is on the returned set of ancestors), so in my view it shouldn't be a hold up for making progress here, if you agree?",
      "created_at" : "2022-11-22T19:14:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1324132293",
      "id" : 1324132293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585O7KfF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324132293/reactions"
      },
      "updated_at" : "2022-11-22T19:14:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324132293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "sort of orthogonal, sort of not. if you do the refactor mentioned, i think you would end up not needing this refactor, so the two overlap.",
      "created_at" : "2022-11-23T18:02:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1325462081",
      "id" : 1325462081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585PAPJB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325462081/reactions"
      },
      "updated_at" : "2022-11-23T18:02:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325462081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> i think you would end up not needing this refactor, so the two overlap.\r\n\r\nI don't think I agree. The epoch refactoring would mostly target/remove `staged_ancestors`, whereas this PR targets the `setAncestors` that is passed into `CalculateMemPoolAncestors` as an `in,out` parameter. I don't see how using epoch affects `CalculateMemPoolAncestors` properly returning the ancestors as opposed adding them to the `setAncestors` reference?",
      "created_at" : "2022-11-23T18:11:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1325472499",
      "id" : 1325472499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585PARrz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325472499/reactions"
      },
      "updated_at" : "2022-11-23T18:11:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325472499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "i'd need to look more detailed into the specifics, but no, the epoch patches could eliminate setAncestors and not the staged ancestors. Staging is still required since it is the work queue.\r\n\r\nThey way to look at it is in terms of where the setAncestors is consumed -- afaict, it's eventually transformed into just a count, so it's possible we can just keep the count directly if we use epochs to serve as a de-facto set. We still require staging to track what to expand next. ",
      "created_at" : "2022-11-23T19:52:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1325584191",
      "id" : 1325584191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585PAs8_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325584191/reactions"
      },
      "updated_at" : "2022-11-23T19:52:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325584191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> where the setAncestors is consumed -- afaict, it's eventually transformed into just a count\r\n\r\nFor example in [`CTxMemPool::PrioritiseTransaction`](https://github.com/bitcoin/bitcoin/blob/master/src/txmempool.cpp#L863-L865) and [`CTxMemPool::UpdateForRemoveFromMempool`](https://github.com/bitcoin/bitcoin/blob/master/src/txmempool.cpp#L345-L348) we actually use the calculated ancestors in a way that doesn't seem trivial to refactor out.",
      "created_at" : "2022-11-23T20:15:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1325609361",
      "id" : 1325609361,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585PAzGR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325609361/reactions"
      },
      "updated_at" : "2022-11-23T20:15:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325609361",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@JeremyRubin\r\n\r\n> I think I was mostly observing that the ancestors tracking is mostly being used for limits checking here, so there is an opportunity to (I think) not actually build a ancestor set and just use epochs to count the number of distinct ancestors directly where the setAncestors is consumed\r\n\r\n> For example in [CTxMemPool::PrioritiseTransaction](https://github.com/bitcoin/bitcoin/blob/master/src/txmempool.cpp#L863-L865) and [CTxMemPool::UpdateForRemoveFromMempool](https://github.com/bitcoin/bitcoin/blob/master/src/txmempool.cpp#L345-L348) we actually use the calculated ancestors in a way that doesn't seem trivial to refactor out.\r\n\r\nAgree with @stickies-v, we definitely require the actual entries themselves at several `CalculateMemPoolAncestors` callsites externally as well, see https://github.com/bitcoin/bitcoin/blob/a035b6a0c418d0b720707df69559028bd662fa70/src/policy/rbf.cpp#L42-L48\r\n\r\nAnd some only require that the limits are checked - we could split those into 2 different functions e.g. `GetAncestorEntries()` and `CheckAncestorDescendantLimits()` in the future, but in any case this refactor makes sense for a `GetAncestorEntries()` interface.",
      "created_at" : "2022-11-29T12:20:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1330544825",
      "id" : 1330544825,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585PToC5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330544825/reactions"
      },
      "updated_at" : "2022-11-29T12:20:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330544825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1034842447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034842447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why is this bugfix added here and then removed later?\r\n\r\nedit: Ah I think I see. Is the idea that this commit will be cherry-picked for backport?",
      "commit_id" : "1f89af219a89da155d5302ca4fdc4f8f1f8612aa",
      "created_at" : "2022-11-29T14:40:08Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1034842447",
      "id" : 1034842447,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849rnFP",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1197689502,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034842447/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T14:40:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034842447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1034861371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034861371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm unsure if we should keep the bugfix commit. As glozow says, the interface was brittle and could have been used in a buggy way, but that currently doesn't appear to be the case (as per my own verification too). With that understanding, we probably don't want to backport this? Alternatively, the separate bugfix commit could make it easier for downstream projects to patch this (potential) issue without having to adopt the full changeset? But I'm not sure that's how we usually do things.\r\n\r\ncc @luke-jr - any further thoughts on this after [your earlier comment](https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1290725923) and [glozow's explanation](https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1007899547)?",
      "commit_id" : "1f89af219a89da155d5302ca4fdc4f8f1f8612aa",
      "created_at" : "2022-11-29T14:53:52Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1034861371",
      "id" : 1034861371,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849rrs7",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1197717242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034861371/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T14:53:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034861371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1039508920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039508920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't care about the name very much before but given it has confused multiple people, maybe rename the commit as a \"making explicit that the interface is changing\" or drop it?",
      "commit_id" : "1f89af219a89da155d5302ca4fdc4f8f1f8612aa",
      "created_at" : "2022-12-05T12:05:11Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1039508920",
      "id" : 1039508920,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58499aW4",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1204406566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039508920/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T15:02:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039508920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1045931222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045931222"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 700bb2e2cdc083777eaea8699935d2e4ebf0d24d:\r\n\r\nHere, by instantiating `invalid_too_long` outside of the if condition, you are mutating `state.m_mode` even if the CPFP carve out succeeds. I don't think this causes the error to be returned when it shouldn't be, but I don't think it's correct to do this. I'd suggest keeping the `state.Invalid()` line *inside* the if condition.",
      "commit_id" : "1f89af219a89da155d5302ca4fdc4f8f1f8612aa",
      "created_at" : "2022-12-12T14:54:35Z",
      "diff_hunk" : "@@ -892,14 +890,15 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n             .descendant_count = m_limits.descendant_count + 1,\n             .descendant_size_vbytes = m_limits.descendant_size_vbytes + EXTRA_DESCENDANT_TX_SIZE_LIMIT,\n         };\n-        if (ws.m_vsize > EXTRA_DESCENDANT_TX_SIZE_LIMIT ||\n-                !m_pool.CalculateMemPoolAncestors(*entry, ws.m_ancestors,\n-                                                  cpfp_carve_out_limits,\n-                                                  dummy_err_string)) {\n-            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"too-long-mempool-chain\", errString);\n-        }\n+\n+        auto invalid_too_long{state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"too-long-mempool-chain\", util::ErrorString(ancestors).original)};\n+        if (ws.m_vsize > EXTRA_DESCENDANT_TX_SIZE_LIMIT) return invalid_too_long;\n+        ancestors = m_pool.CalculateMemPoolAncestors(*entry, cpfp_carve_out_limits);\n+        if (!ancestors) return invalid_too_long;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1045931222",
      "id" : 1045931222,
      "line" : 897,
      "node_id" : "PRRC_kwDOABII584-V6TW",
      "original_commit_id" : "700bb2e2cdc083777eaea8699935d2e4ebf0d24d",
      "original_line" : 897,
      "original_position" : 28,
      "original_start_line" : 894,
      "path" : "src/validation.cpp",
      "position" : 28,
      "pull_request_review_id" : 1204406566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045931222/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 894,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-12T15:02:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045931222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1045940214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045940214"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To reproduce - we probably can't test this since we can't call `PreChecks()` in isolation, but if you add a `Assume(ws.m_state.IsValid())` sanity check right before `addUnchecked()` and run test/functional/mempool_package_onemore.py it will hit.",
      "commit_id" : "1f89af219a89da155d5302ca4fdc4f8f1f8612aa",
      "created_at" : "2022-12-12T15:00:52Z",
      "diff_hunk" : "@@ -892,14 +890,15 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n             .descendant_count = m_limits.descendant_count + 1,\n             .descendant_size_vbytes = m_limits.descendant_size_vbytes + EXTRA_DESCENDANT_TX_SIZE_LIMIT,\n         };\n-        if (ws.m_vsize > EXTRA_DESCENDANT_TX_SIZE_LIMIT ||\n-                !m_pool.CalculateMemPoolAncestors(*entry, ws.m_ancestors,\n-                                                  cpfp_carve_out_limits,\n-                                                  dummy_err_string)) {\n-            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"too-long-mempool-chain\", errString);\n-        }\n+\n+        auto invalid_too_long{state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"too-long-mempool-chain\", util::ErrorString(ancestors).original)};\n+        if (ws.m_vsize > EXTRA_DESCENDANT_TX_SIZE_LIMIT) return invalid_too_long;\n+        ancestors = m_pool.CalculateMemPoolAncestors(*entry, cpfp_carve_out_limits);\n+        if (!ancestors) return invalid_too_long;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1045940214",
      "id" : 1045940214,
      "in_reply_to_id" : 1045931222,
      "line" : 897,
      "node_id" : "PRRC_kwDOABII584-V8f2",
      "original_commit_id" : "700bb2e2cdc083777eaea8699935d2e4ebf0d24d",
      "original_line" : 897,
      "original_position" : 28,
      "original_start_line" : 894,
      "path" : "src/validation.cpp",
      "position" : 28,
      "pull_request_review_id" : 1204406566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045940214/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 894,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-12T15:03:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045940214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1046216817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046216817"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh great catch, thanks! I hadn't considered the side effects. Fixed in 66e028f7399b6511f9b73b1cef54b6a6ac38a024.",
      "commit_id" : "3cbed28e65fdd696c820f6c2c7e23d8bbc77e2bc",
      "created_at" : "2022-12-12T18:19:12Z",
      "diff_hunk" : "@@ -892,14 +890,15 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n             .descendant_count = m_limits.descendant_count + 1,\n             .descendant_size_vbytes = m_limits.descendant_size_vbytes + EXTRA_DESCENDANT_TX_SIZE_LIMIT,\n         };\n-        if (ws.m_vsize > EXTRA_DESCENDANT_TX_SIZE_LIMIT ||\n-                !m_pool.CalculateMemPoolAncestors(*entry, ws.m_ancestors,\n-                                                  cpfp_carve_out_limits,\n-                                                  dummy_err_string)) {\n-            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"too-long-mempool-chain\", errString);\n-        }\n+\n+        auto invalid_too_long{state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"too-long-mempool-chain\", util::ErrorString(ancestors).original)};\n+        if (ws.m_vsize > EXTRA_DESCENDANT_TX_SIZE_LIMIT) return invalid_too_long;\n+        ancestors = m_pool.CalculateMemPoolAncestors(*entry, cpfp_carve_out_limits);\n+        if (!ancestors) return invalid_too_long;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1046216817",
      "id" : 1046216817,
      "in_reply_to_id" : 1045931222,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-XABx",
      "original_commit_id" : "700bb2e2cdc083777eaea8699935d2e4ebf0d24d",
      "original_line" : 897,
      "original_position" : 28,
      "original_start_line" : 894,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1214079749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046216817/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-12T19:26:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046216817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1046217924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046217924"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've dropped the bugfix commit in the latest force push",
      "commit_id" : "4f1e03c9fe024f4c52aa7d15d95fccb7302fef0a",
      "created_at" : "2022-12-12T18:20:23Z",
      "diff_hunk" : "@@ -266,6 +266,7 @@ bool CTxMemPool::CalculateMemPoolAncestors(const CTxMemPoolEntry &entry,\n                                            std::string &errString,\n                                            bool fSearchForParents /* = true */) const\n {\n+    setAncestors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1046217924",
      "id" : 1046217924,
      "in_reply_to_id" : 1007817860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-XATE",
      "original_commit_id" : "c25c6a6dc7843833d60da285d1681bfeb5022723",
      "original_line" : 269,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1214079749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046217924/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:25:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046217924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CI is red @stickies-v ",
      "created_at" : "2022-12-12T18:44:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1347062962",
      "id" : 1347062962,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585QSoyy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1347062962/reactions"
      },
      "updated_at" : "2022-12-12T18:44:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1347062962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> CI is red @stickies-v\r\n\r\nSorry, fixed now by capturing the original error message in a variable, so we don't show the error message from trying the cpfp carve-out.",
      "created_at" : "2022-12-12T19:27:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1347166555",
      "id" : 1347166555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585QTCFb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1347166555/reactions"
      },
      "updated_at" : "2022-12-12T19:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1347166555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1047060888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047060888"
         }
      },
      "author_association" : "MEMBER",
      "body" : "question in 9481b62101a353c085e62e6635a1700685d9f6ca: does this make a copy of the set in `ancestors_result` ?",
      "commit_id" : "3cbed28e65fdd696c820f6c2c7e23d8bbc77e2bc",
      "created_at" : "2022-12-13T11:54:04Z",
      "diff_hunk" : "@@ -394,9 +394,8 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors_result{mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false)};\n+        auto ancestors{ancestors_result.value_or(CTxMemPool::setEntries{})};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1047060888",
      "id" : 1047060888,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-aOGY",
      "original_commit_id" : "9481b62101a353c085e62e6635a1700685d9f6ca",
      "original_line" : 398,
      "original_position" : 8,
      "original_start_line" : 397,
      "path" : "src/node/miner.cpp",
      "position" : 8,
      "pull_request_review_id" : 1215322731,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047060888/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-13T12:23:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047060888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1047365141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047365141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Great question - and it pushed me quite deep down an interesting rabbit hole. I hadn't considered this. I think you're right that (without compiler optimization*) this (and all the other similar instances in this PR) would lead to a copy of the set, because we're calling `value_or()` on an lvalue so the [`const&` qualified `value_or()` method](https://github.com/bitcoin/bitcoin/blob/968f03e65c98a9a36aea6c57a29306839b0ada57/src/util/result.h#L60-L64) is used, which returns by value and doesn't benefit from move semantics.\r\n\r\nBy turning `ancestors_result` into an rvalue ref with `std::move`, we can benefit from the move semantics that `std::set` has implemented since now we'll be using the [`&&` qualified `value_or()` method](https://github.com/bitcoin/bitcoin/blob/968f03e65c98a9a36aea6c57a29306839b0ada57/src/util/result.h#L65-L69).\r\n\r\nI've force pushed a change to replace all instances of `ancestors_result` into `std::move(ancestors_result)` as well as update `AssumeCalculateMemPoolAncestors()` to be explicit about using move semantics. _(note: most of these changes are undone in a later commit where we start using the newly introduced `AssumeCalculateMemPoolAncestors()` function)_\r\n\r\n*I think, in practice, in most of the affected instances in this PR the copy operation actually would have been optimized away by the compiler (because I think `ancestors_result` just would have been inlined anyway, making them rvalues), but at the very least the code is now more explicit about intent, and potentially more performant - and I could be wrong about my optimization assumptions.\r\n\r\nThank you for raising this!",
      "commit_id" : "47c4b1f52ab8d95d7deef83050bad49d1e3e5990",
      "created_at" : "2022-12-13T16:04:00Z",
      "diff_hunk" : "@@ -394,9 +394,8 @@ void BlockAssembler::addPackageTxs(const CTxMemPool& mempool, int& nPackagesSele\n             continue;\n         }\n \n-        CTxMemPool::setEntries ancestors;\n-        std::string dummy;\n-        mempool.CalculateMemPoolAncestors(*iter, ancestors, CTxMemPool::Limits::NoLimits(), dummy, false);\n+        auto ancestors_result{mempool.CalculateMemPoolAncestors(*iter, CTxMemPool::Limits::NoLimits(), /*fSearchForParents=*/false)};\n+        auto ancestors{ancestors_result.value_or(CTxMemPool::setEntries{})};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1047365141",
      "id" : 1047365141,
      "in_reply_to_id" : 1047060888,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-bYYV",
      "original_commit_id" : "9481b62101a353c085e62e6635a1700685d9f6ca",
      "original_line" : 398,
      "original_position" : 8,
      "original_start_line" : 397,
      "path" : "src/node/miner.cpp",
      "position" : null,
      "pull_request_review_id" : 1215804127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047365141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-13T16:04:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047365141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed to avoid set copy operations when calling `value_or()` on results, see [this comment for more background](https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1047365141)",
      "created_at" : "2022-12-13T16:06:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#issuecomment-1348896758",
      "id" : 1348896758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26289",
      "node_id" : "IC_kwDOABII585QZof2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1348896758/reactions"
      },
      "updated_at" : "2022-12-13T16:06:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1348896758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1052101729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052101729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "question in f911bdfff9: why add this scope?",
      "commit_id" : "47c4b1f52ab8d95d7deef83050bad49d1e3e5990",
      "created_at" : "2022-12-19T11:31:46Z",
      "diff_hunk" : "@@ -1114,15 +1115,18 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n \n         // Re-calculate mempool ancestors to call addUnchecked(). They may have changed since the\n         // last calculation done in PreChecks, since package ancestors have already been submitted.\n-        std::string unused_err_string;\n-        if(!m_pool.CalculateMemPoolAncestors(*ws.m_entry, ws.m_ancestors, m_limits, unused_err_string)) {\n-            results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n-            // Since PreChecks() and PackageMempoolChecks() both enforce limits, this should never fail.\n-            Assume(false);\n-            all_submitted = false;\n-            package_state.Invalid(PackageValidationResult::PCKG_MEMPOOL_ERROR,\n-                                  strprintf(\"BUG! Mempool ancestors or descendants were underestimated: %s\",\n-                                            ws.m_ptx->GetHash().ToString()));\n+        {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26289#discussion_r1052101729",
      "id" : 1052101729,
      "line" : 1118,
      "node_id" : "PRRC_kwDOABII584-tcxh",
      "original_commit_id" : "f911bdfff95eba3793fffaf71a31cc8bfc6f80c9",
      "original_line" : 1118,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 57,
      "pull_request_review_id" : 1222734581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26289",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052101729/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T12:02:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052101729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
