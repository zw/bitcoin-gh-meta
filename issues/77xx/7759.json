{
   "assignee" : null,
   "assignees" : [],
   "body" : "This is by no means ready, but anyhow this builds on #7756 and\r\n\r\n- Adds a streaming API to the HTTP server. This allows streaming data to the client chunk by chunk, which is useful when not the entire data is available at once or it is huge and wouldn't fit (efficiently) in memory.\r\n\r\n- Allows downloading the entire UTXO set through `/rest/utxoset`. This is a raw dump of all outputs, the state normally hashed by `gettxoutsetinfo`. The dump is performed in the background by making use of leveldb snapshotting, so without keeping cs_main locked.\r\n    - This can be useful for analysis purposes if you don't want to mess with bitcoin core's database\r\n    - Filename (via content-disposition) is `utxoset-<height>-<bestblockhash>.dat`. Also a custom `X-Best-Block` and `X-Block-Height` header is added.\r\n\r\nIt matches:\r\n```bash\r\n$ src/bitcoin-cli -datadir=/store/tmp/testbtc gettxoutsetinfo\r\n{\r\n...\r\n  \"hash_serialized\": \"5017f82bbb82a8199ae0fbaa9e5881a0c82575db89e6edd5b39414b35299363b\",\r\n...\r\n}\r\n$ wget --content-disposition http://127.0.0.1:8332/rest/utxoset \r\n2016-03-28 22:58:32 (44.3 MB/s) - Ã¢ÂÂutxoset-404681-0000000000000000034854f5a3ab27cfbc220a42c75061dd13d2067cda71191d.datÃ¢ÂÂ saved [1291578967]\r\n$ ~/bin/dsha256 utxoset-404681-0000000000000000034854f5a3ab27cfbc220a42c75061dd13d2067cda71191d.dat\r\n5017f82bbb82a8199ae0fbaa9e5881a0c82575db89e6edd5b39414b35299363b utxoset\r\n```\r\n\r\n## TODO\r\n- ~~Rebase after #7756 merged~~\r\n- Sensibly name and split up commits\r\n- Clean up and split up code\r\n- Actually handle errors (you can crash a worker thread right now by disconnecting while downloading)\r\n- The timeout actually runs *while* downloading, causing it to break off after downloading. I don't understand why this is. You can work around it with `-rpcservertimeout=6000` or such.\r\n- ~~UTXO set dump doesn't contain keys (?) I'm not sure this format is actually useful this way (see #7758)~~ (fixed in #7848)\r\n- Other formats, potentially ^^\r\n\r\nNote that the HTTP streaming API could in principle also be used for other large data (say, wallet backups), or even for websocket-like event notification.\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 5,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7759/comments",
   "created_at" : "2016-03-28T20:55:18Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7759/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/7759",
   "id" : 144080862,
   "labels" : [
      {
         "color" : "0052cc",
         "name" : "RPC/REST/ZMQ",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7759/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 1,
      "created_at" : "2014-07-04T06:53:52Z",
      "creator" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      },
      "description" : "Undefined future version",
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestones/Future",
      "id" : 710147,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/16/labels",
      "number" : 16,
      "open_issues" : 5,
      "state" : "open",
      "title" : "Future",
      "updated_at" : "2016-06-25T14:08:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/16"
   },
   "number" : 7759,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/7759.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7759",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/7759.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7759"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[WIP] rest: Stream entire utxo set",
   "updated_at" : "2016-10-04T16:01:17Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7759",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   }
}
