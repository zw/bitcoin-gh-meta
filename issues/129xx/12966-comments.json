[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12966#discussion_r181027981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181027981"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should make null estimate_mode args more relevant, which would make #12940 or something like it more important to include.",
      "commit_id" : "e1586bca7ed2ea09e23c83861a5af718c350031b",
      "created_at" : "2018-04-12T10:00:07Z",
      "diff_hunk" : "@@ -805,10 +808,11 @@ UniValue estimatesmartfee(const JSONRPCRequest& request)\n             + HelpExampleCli(\"estimatesmartfee\", \"6\")\n             );\n \n-    RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n+    RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR, UniValue::VBOOL});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12966#discussion_r181027981",
      "id" : 181027981,
      "original_commit_id" : "158b0c9b082680fbb8145b6ecdb01ca0309f2f01",
      "original_position" : 27,
      "path" : "src/rpc/mining.cpp",
      "position" : 27,
      "pull_request_review_id" : 111554826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12966",
      "updated_at" : "2018-04-13T09:47:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181027981",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it would be helpful if you could post (or link to a gist) the overall design you're aiming for here, so that reviewers can think about the algorithm's robustness without having to dive into the implementation first.\r\n\r\nI did start to take a look, and I wanted to point out that the first commit looks incorrect -- `GetSortedDepthAndScore()` does not return the mempool sorted in the same way as block creation.  Instead it sorts the mempool by ancestor count first (so all transactions with no ancestors appear before their descendants), and by feerate of the transaction second (not feerate including ancestors).  The mining sort order is based on sorting transactions by their feerate with ancestors (which is done in one of the mempool.mapTx indices), and then updating that feerate-with-ancestors calculation as transactions are selected for inclusion.\r\n\r\nSo a simple approximation of the mining calculation would to walk the mempool in the ancestor-feerate-order, and tally up the weight of transactions as you go.  In order to get it precise, though, you'd probably just want to invoke `CreateNewBlock()` directly.\r\n\r\n",
      "created_at" : "2018-04-17T14:25:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12966#issuecomment-382011897",
      "id" : 382011897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12966",
      "updated_at" : "2018-04-17T14:25:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382011897",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think it would be helpful if you could post (or link to a gist) the overall design you're aiming for here, so that reviewers can think about the algorithm's robustness without having to dive into the implementation first.\r\n\r\nSorry, I should have just finished reading the PR -- I think I understand it now, never mind!",
      "created_at" : "2018-04-17T14:28:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12966#issuecomment-382013176",
      "id" : 382013176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12966",
      "updated_at" : "2018-04-17T14:28:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382013176",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar Thanks for looking!\r\n\r\n> the first commit looks incorrect -- `GetSortedDepthAndScore()` does not return the mempool sorted in the same way as block creation. Instead it sorts the mempool by ancestor count first (so all transactions with no ancestors appear before their descendants), and by feerate of the transaction second (not feerate including ancestors). \r\n\r\nI wanted to ask about that. Thanks for clarifying -- I would like to avoid the block creation code, as I think it results in side effects that are not desirable (I believe early prototypes of `testrawtransaction` had issues due to trying to reuse that functionality). I could be mistaken. Anyway, that's a pity. I was hoping there was a clean way to get the transactions in order. I also found out that the ancestor stuff actually plays a big role in blocks, so I may need to take that into account after all.\r\n\r\nAfter making this PR, I realized I was a bit hasty. I need to do proper profiling before making a serious proposal. I'm considering closing, but I think it's fine since it has `[WIP]` tag...?",
      "created_at" : "2018-04-18T01:14:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12966#issuecomment-382211342",
      "id" : 382211342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12966",
      "updated_at" : "2018-04-18T01:14:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382211342",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CreateNewBlock should be side effect free (the issue you're bringing up with `testrawtransaction` and the like involves mempool acceptance testing, which is not side-effect free).  It's not super-fast (especially because we test block validity after construction), but we could consider just exposing the package selection algorithm if that's helpful here. \r\n\r\nI don't see a problem with keeping this open with [WIP] in order to gather more feedback.  I do think it's worth trying to have a wider discussion about how to best expose data relating to fee estimates, to let advanced users have access to useful data which may still be experimental while ensuring that default usage for typical users is robust.",
      "created_at" : "2018-04-18T14:09:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12966#issuecomment-382399816",
      "id" : 382399816,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12966",
      "updated_at" : "2018-04-18T14:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382399816",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
