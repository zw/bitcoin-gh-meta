{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "<!-- This issue tracker is only for technical issues related to Bitcoin Core.\r\n\r\nGeneral bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.\r\n\r\nFor reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.\r\n\r\nIf the node is \"stuck\" during sync or giving \"block checksum mismatch\" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! -->\r\n\r\n<!-- Describe the issue -->\r\n\r\nWith a binary built at master @ https://github.com/bitcoin/bitcoin/commit/a04440, `bitcoind` crashes with segfault on startup on one of my nodes.\r\n\r\n<!--- What behavior did you expect? -->\r\n\r\nExpected: No segfault.\r\n\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\n\r\nActual: Segfault, with no more info in `debug.log`, even with `-debug` set (see below).\r\n\r\n<!--- How reliably can you reproduce the issue, what are the steps to do so? -->\r\n\r\nCrash seems reproducible, but only on this node. I'm recompiling with `--enable-debug` to see if that gives more info.\r\n\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\nSelf-compiled at https://github.com/bitcoin/bitcoin/commit/a04440. Switching to the version built at https://github.com/bitcoin/bitcoin/commit/6324c6 that the node was running earlier starts up fine.\r\n\r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\nLinux, armv7l, SSD disks.\r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n<!--- This is normally the contents of a `debug.log` or `config.log` file. Raw text or a link to a pastebin type site are preferred. -->\r\n\r\nDebug logs:\r\n```\r\n$ bitcoind -debug\r\n2018-04-11T11:57:14Z \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n2018-04-11T11:57:14Z Bitcoin Core version v0.16.99.0-a04440feb (release build)\r\n2018-04-11T11:57:14Z InitParameterInteraction: parameter interaction: -blocksonly=1 -> setting -whitelistrelay=0                                                                        \r\n2018-04-11T11:57:14Z Assuming ancestors of block 0000000000000000005214481d2d96f898e3d5416e43359c145944a909d242e0 have valid signatures.                                                \r\n2018-04-11T11:57:14Z Setting nMinimumChainWork=000000000000000000000000000000000000000000f91c579d57cad4bc5278cc                                                                         \r\n2018-04-11T11:57:14Z ParameterInteraction: parameter interaction: -blocksonly=1 -> setting -walletbroadcast=0                                                                           \r\n2018-04-11T11:57:14Z Using the 'standard' SHA256 implementation\r\n2018-04-11T11:57:14Z Default data directory /home/bitcoin/.bitcoin                          \r\n2018-04-11T11:57:14Z Using data directory /home/bitcoin/.bitcoin                            \r\n2018-04-11T11:57:14Z Using config file /home/bitcoin/.bitcoin/bitcoin.conf                  \r\n2018-04-11T11:57:14Z Using at most 16 automatic connections (1048576 file descriptors available)                                                                                        \r\n2018-04-11T11:57:14Z Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements                                                                              \r\n2018-04-11T11:57:14Z Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements                                                                       \r\n2018-04-11T11:57:14Z Using 4 threads for script verification                                \r\n2018-04-11T11:57:14Z scheduler thread start\r\n2018-04-11T11:57:14Z Allowing HTTP connections from: 127.0.0.0/8 ::1/128 163.172.184.153/32 10.4.2.0/24                                                                                 \r\n2018-04-11T11:57:14Z Binding RPC on address :: port 8332\r\n2018-04-11T11:57:14Z Binding RPC on address 0.0.0.0 port 8332                               \r\n2018-04-11T11:57:14Z Binding RPC on address 0.0.0.0 port 8332 failed.                       \r\n2018-04-11T11:57:14Z Initialized HTTP server\r\n2018-04-11T11:57:14Z HTTP: creating work queue of depth 16\r\n2018-04-11T11:57:14Z Starting RPC\r\n2018-04-11T11:57:14Z Starting HTTP RPC server\r\n2018-04-11T11:57:14Z No rpcpassword set - using random cookie authentication\r\n2018-04-11T11:57:14Z Generated RPC authentication cookie /home/bitcoin/.bitcoin/.cookie     \r\n2018-04-11T11:57:14Z Registering HTTP handler for / (exactmatch 1)\r\n2018-04-11T11:57:14Z Registering HTTP handler for /wallet/ (exactmatch 0)                   \r\n2018-04-11T11:57:14Z Starting HTTP server\r\n2018-04-11T11:57:14Z HTTP: starting 4 worker threads                                        \r\n2018-04-11T11:57:14Z Using wallet directory /home/bitcoin/.bitcoin                          \r\n2018-04-11T11:57:14Z init message: Verifying wallet(s)...\r\n2018-04-11T11:57:14Z Entering http event loop\r\n2018-04-11T11:57:14Z Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)          \r\n2018-04-11T11:57:14Z Using wallet wallet.dat\r\n2018-04-11T11:57:14Z CDBEnv::Open: LogDir=/home/bitcoin/.bitcoin/database ErrorFile=/home/bitcoin/.bitcoin/db.log                                                                       \r\n2018-04-11T11:57:14Z net: setting try another outbound peer=false\r\n2018-04-11T11:57:14Z Cache configuration:\r\n2018-04-11T11:57:14Z * Using 12.5MiB for block index database\r\n2018-04-11T11:57:14Z * Using 8.0MiB for chain state database\r\n2018-04-11T11:57:14Z * Using 79.5MiB for in-memory UTXO set (plus up to 286.1MiB of unused mempool space)\r\n2018-04-11T11:57:14Z init message: Loading block index...\r\n2018-04-11T11:57:14Z LevelDB using max_open_files=64 (default=1000)\r\n2018-04-11T11:57:14Z Opening LevelDB in /home/bitcoin/.bitcoin/blocks/index\r\n2018-04-11T11:57:14Z leveldb: Recovering log #109195\r\n2018-04-11T11:57:14Z leveldb: Level-0 table #109210: started\r\n2018-04-11T11:57:14Z leveldb: Level-0 table #109210: 179 bytes OK\r\n2018-04-11T11:57:14Z leveldb: Delete type=0 #109195\r\n2018-04-11T11:57:14Z leveldb: Delete type=3 #109193\r\n2018-04-11T11:57:14Z Opened LevelDB successfully\r\n2018-04-11T11:57:14Z Using obfuscation key for /home/bitcoin/.bitcoin/blocks/index: 0000000000000000\r\n2018-04-11T11:57:37Z LoadBlockIndexDB: last block file = 1230\r\n2018-04-11T11:57:37Z leveldb: Compacting 1@3 + 13@4 files\r\n2018-04-11T11:57:37Z LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=196, size=119299357, heights=517496...517691, time=2018-04-10...2018-04-11)\r\n2018-04-11T11:57:37Z Checking all blk files are present...\r\n2018-04-11T11:57:37Z leveldb: Generated table #109212@3: 14790 keys, 2141156 bytes\r\n2018-04-11T11:57:37Z leveldb: Generated table #109213@3: 494 keys, 71674 bytes\r\n2018-04-11T11:57:38Z leveldb: Generated table #109214@3: 14790 keys, 2141044 bytes\r\n2018-04-11T11:57:38Z LoadBlockIndexDB: transaction index enabled\r\n2018-04-11T11:57:38Z LevelDB using max_open_files=64 (default=1000)\r\n2018-04-11T11:57:38Z Opening LevelDB in /home/bitcoin/.bitcoin/chainstate\r\n2018-04-11T11:57:38Z leveldb: Generated table #109215@3: 313 keys, 45397 bytes\r\n2018-04-11T11:57:38Z leveldb: Recovering log #118330\r\n2018-04-11T11:57:38Z leveldb: Level-0 table #118367: started\r\n2018-04-11T11:57:38Z leveldb: Level-0 table #118367: 308 bytes OK\r\n2018-04-11T11:57:38Z leveldb: Delete type=3 #118328\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118175\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118069\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118062\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118068\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118061\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118066\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118064\r\n2018-04-11T11:57:38Z leveldb: Delete type=0 #118330\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118032\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118063\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118060\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118065\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118368\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118366\r\n2018-04-11T11:57:38Z leveldb: Delete type=2 #118067\r\n2018-04-11T11:57:38Z Opened LevelDB successfully\r\n2018-04-11T11:57:38Z Using obfuscation key for /home/bitcoin/.bitcoin/chainstate: 72e7c68d386988b3\r\n2018-04-11T11:57:38Z leveldb: Generated table #109216@3: 42165 keys, 2173766 bytes\r\n2018-04-11T11:57:38Z Loaded best chain: hashBestChain=0000000000000000003f6dfa302cd20c2721555a8004ef8c84864f64e68df67c height=517691 date=2018-04-11T11:45:00Z progress=0.999991\r\n2018-04-11T11:57:38Z init message: Rewinding blocks...\r\n2018-04-11T11:57:38Z leveldb: Generated table #109217@3: 42164 keys, 2173669 bytes\r\n2018-04-11T11:57:39Z leveldb: Generated table #109218@3: 15988 keys, 823981 bytes\r\n2018-04-11T11:57:39Z leveldb: Generated table #109219@3: 42164 keys, 2173673 bytes\r\n2018-04-11T11:57:39Z leveldb: Generated table #109220@3: 42164 keys, 2173039 bytes\r\n2018-04-11T11:57:40Z leveldb: Generated table #109221@3: 42164 keys, 2173419 bytes\r\n2018-04-11T11:57:40Z leveldb: Generated table #109222@3: 26480 keys, 1364917 bytes\r\n2018-04-11T11:57:40Z leveldb: Generated table #109223@3: 42164 keys, 2173787 bytes\r\n2018-04-11T11:57:41Z leveldb: Generated table #109224@3: 37474 keys, 1931396 bytes\r\n2018-04-11T11:57:41Z leveldb: Compacted 1@3 + 13@4 files => 21560918 bytes\r\n2018-04-11T11:57:41Z leveldb: compacted to: files[ 3 7 62 725 5024 2064 0 ]\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109137\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109145\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109144\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109139\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109142\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109143\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109134\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109146\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109136\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109141\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109135\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109140\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #108990\r\n2018-04-11T11:57:41Z leveldb: Delete type=2 #109196\r\n2018-04-11T11:57:45Z WriteBatch memory usage: db=index, before=0.1MiB, after=0.1MiB\r\n2018-04-11T11:57:45Z Writing final batch of 0.00 MiB\r\n2018-04-11T11:57:45Z WriteBatch memory usage: db=chainstate, before=0.0MiB, after=0.0MiB\r\n2018-04-11T11:57:45Z Committed 0 changed transaction outputs (out of 0) to coin database...\r\n2018-04-11T11:57:45Z init message: Verifying blocks...\r\n2018-04-11T11:57:45Z Verifying last 6 blocks at level 3\r\n2018-04-11T11:57:45Z [0%]...leveldb: Moved #118367 to level-1 308 bytes OK: files[ 0 1 24 362 1179 0 0 ]\r\n2018-04-11T11:57:45Z leveldb: Compacting 1@1 + 24@2 files\r\n2018-04-11T11:57:45Z leveldb: Generated table #118369@1: 1 keys, 207 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118370@1: 4217 keys, 210255 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118371@1: 4078 keys, 200014 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118372@1: 4087 keys, 203922 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118373@1: 4531 keys, 216005 bytes\r\n2018-04-11T11:57:45Z [16%]...leveldb: Generated table #118374@1: 4119 keys, 199759 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118375@1: 4318 keys, 216798 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118376@1: 98 keys, 4814 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118377@1: 4387 keys, 209206 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118378@1: 4345 keys, 211747 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118379@1: 4036 keys, 200497 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118380@1: 4146 keys, 202248 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118381@1: 4196 keys, 198305 bytes\r\n2018-04-11T11:57:45Z leveldb: Generated table #118382@1: 3832 keys, 190471 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118383@1: 4051 keys, 201361 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118384@1: 4464 keys, 221466 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118385@1: 4096 keys, 198885 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118386@1: 4382 keys, 217587 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118387@1: 4917 keys, 229917 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118388@1: 4300 keys, 211286 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118389@1: 4003 keys, 196340 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118390@1: 4157 keys, 206832 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118391@1: 4596 keys, 215723 bytes\r\n2018-04-11T11:57:46Z leveldb: Generated table #118392@1: 1466 keys, 71785 bytes\r\n2018-04-11T11:57:46Z leveldb: Compacted 1@1 + 24@2 files => 4435430 bytes\r\n2018-04-11T11:57:46Z leveldb: compacted to: files[ 0 0 24 362 1179 0 0 ]\r\n2018-04-11T11:57:46Z [33%]...[50%]...[66%]...leveldb: Compacting 1@3 + 10@4 files\r\n2018-04-11T11:57:50Z [83%]...leveldb: Generated table #118393@3: 38486 keys, 2174479 bytes\r\n2018-04-11T11:57:51Z leveldb: Generated table #118394@3: 37469 keys, 2173916 bytes\r\n2018-04-11T11:57:51Z leveldb: Generated table #118395@3: 38878 keys, 2175990 bytes\r\n2018-04-11T11:57:51Z leveldb: Generated table #118396@3: 38694 keys, 2174535 bytes\r\n2018-04-11T11:57:52Z leveldb: Generated table #118397@3: 37903 keys, 2174138 bytes\r\n2018-04-11T11:57:52Z leveldb: Generated table #118398@3: 38108 keys, 2174691 bytes\r\n2018-04-11T11:57:52Z leveldb: Generated table #118399@3: 38036 keys, 2173630 bytes\r\n2018-04-11T11:57:53Z [99%]...leveldb: Generated table #118400@3: 38108 keys, 2173306 bytes\r\n2018-04-11T11:57:53Z [DONE].\r\n2018-04-11T11:57:53Z No coin database inconsistencies in last 7 blocks (7607 transactions)\r\n2018-04-11T11:57:53Z  block index           38962ms\r\n2018-04-11T11:57:53Z Reading estimates: 190 buckets counting confirms up to 48 blocks\r\n2018-04-11T11:57:53Z Reading estimates: 190 buckets counting confirms up to 12 blocks\r\n2018-04-11T11:57:53Z Reading estimates: 190 buckets counting confirms up to 1008 blocks\r\n2018-04-11T11:57:53Z init message: Loading wallet...\r\n2018-04-11T11:57:53Z leveldb: Generated table #118401@3: 38342 keys, 2173156 bytes\r\n2018-04-11T11:57:54Z nFileVersion = 169900\r\n2018-04-11T11:57:54Z Keys: 2001 plaintext, 0 encrypted, 2001 w/ metadata, 2001 total\r\n2018-04-11T11:57:54Z leveldb: Generated table #118402@3: 38613 keys, 2173466 bytes\r\n2018-04-11T11:57:54Z  wallet                  374ms\r\n2018-04-11T11:57:54Z setKeyPool.size() = 2000\r\n2018-04-11T11:57:54Z mapWallet.size() = 0\r\n2018-04-11T11:57:54Z mapAddressBook.size() = 0\r\nSegmentation fault (core dumped)\r\n```\r\n\r\nBacktrace with `gdb`:\r\n```\r\n2018-04-11T12:21:29Z Loaded best chain: hashBestChain=0000000000000000003f6dfa302cd20c2721555a8004ef8c84864f64e68df67c height=517691 date=2018-04-11T11:45:00Z progress=0.999975        \r\n2018-04-11T12:21:29Z init message: Rewinding blocks...                                                                                                                                  \r\n2018-04-11T12:21:35Z init message: Verifying blocks...                                                                                                                                  \r\n2018-04-11T12:21:35Z Verifying last 6 blocks at level 3                                     \r\n2018-04-11T12:21:35Z [0%]...[New Thread 0xaf12d450 (LWP 57)]                                \r\n[16%]...[33%]...[50%]...[66%]...[83%]...[99%]...[DONE].                                     \r\n2018-04-11T12:21:46Z No coin database inconsistencies in last 7 blocks (7607 transactions)  \r\n2018-04-11T12:21:46Z  block index           40569ms                                                                                                                                     \r\n2018-04-11T12:21:46Z init message: Loading wallet...                                                                                                                                    \r\n2018-04-11T12:21:46Z nFileVersion = 169900                                                                                                                                              \r\n2018-04-11T12:21:46Z Keys: 2001 plaintext, 0 encrypted, 2001 w/ metadata, 2001 total                                                                                                    \r\n2018-04-11T12:21:46Z  wallet                  351ms                                                                                                                                     \r\n2018-04-11T12:21:46Z setKeyPool.size() = 2000                                                                                                                                           \r\n2018-04-11T12:21:46Z mapWallet.size() = 0                                                                                                                                               \r\n2018-04-11T12:21:46Z mapAddressBook.size() = 0                                              \r\n[New Thread 0xae92c450 (LWP 58)]                                                            \r\n2018-04-11T12:21:46Z mapBlockIndex.size() = 517694                                          \r\n2018-04-11T12:21:46Z nBestHeight = 517691                                                                                                 \r\n[New Thread 0xae12b450 (LWP 59)]                                                                                                                                                        \r\n                                             \r\nThread 12 \"bitcoin-loadblk\" received signal SIGSEGV, Segmentation fault.    \r\n[Switching to Thread 0xae92c450 (LWP 58)]                                              \r\n0xb6f81868 in pthread_setschedparam () from /usr/lib/libpthread.so.0\r\n(gdb) backtrace                 \r\n#0  0xb6f81868 in pthread_setschedparam () from /usr/lib/libpthread.so.0\r\n#1  0x0075b29c in ScheduleBatchPriority() ()\r\n#2  0x0047509c in ThreadImport(std::vector<boost::filesystem::path, std::allocator<boost::filesystem::path> >) ()\r\n#3  0x00494f40 in boost::detail::thread_data<boost::_bi::bind_t<void, void (*)(std::vector<boost::filesystem::path, std::allocator<boost::filesystem::path> >), boost::_bi::list1<boost:\r\n:_bi::value<std::vector<boost::filesystem::path, std::allocator<boost::filesystem::path> > > > > >::run() ()\r\n#4  0x0082aed4 in thread_proxy ()                        \r\n#5  0xb6f7fee4 in start_thread () from /usr/lib/libpthread.so.0                   \r\n#6  0xb6d04328 in ?? () from /usr/lib/libc.so.6\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)                                       \r\n(gdb)\r\n```",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12943/comments",
   "created_at" : "2018-04-11T12:32:28Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12943/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/12943",
   "id" : 313303323,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12943/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 12943,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Segfault on startup at a04440",
   "updated_at" : "2018-04-11T13:00:38Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12943",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/287215?v=4",
      "events_url" : "https://api.github.com/users/hkjn/events{/privacy}",
      "followers_url" : "https://api.github.com/users/hkjn/followers",
      "following_url" : "https://api.github.com/users/hkjn/following{/other_user}",
      "gists_url" : "https://api.github.com/users/hkjn/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/hkjn",
      "id" : 287215,
      "login" : "hkjn",
      "organizations_url" : "https://api.github.com/users/hkjn/orgs",
      "received_events_url" : "https://api.github.com/users/hkjn/received_events",
      "repos_url" : "https://api.github.com/users/hkjn/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/hkjn/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/hkjn/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/hkjn"
   }
}
