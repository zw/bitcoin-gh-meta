[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19107 (p2p: Refactor, move all header verification into the network layer, without changing behavior by troygiorshev)\n* #19053 (refactor: replace CNode pointers by references within net_processing.{h,cpp} by theStack)\n* #18638 (net: Use mockable time for ping/pong, add tests by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-01-18T22:37:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455710529",
      "id" : 455710529,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTcxMDUyOQ==",
      "updated_at" : "2020-06-02T21:50:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455710529",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-01-19T16:29:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455794363",
      "id" : 455794363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTc5NDM2Mw==",
      "updated_at" : "2019-01-19T16:29:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455794363",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't the deferred processing matters-- the checkvalue is protecting against network corruption not malicious input or anything like that, but I also don't think that doing it eagerly is harmful either.\r\n\r\nOne consequence of this is that it moves more processing into the networking thread, rather than leaving it in the message processing thread. As a result it may result in lower performance in cases where hashing was a bottleneck, but I'm doubtful the slowdown will matter much anywhere.",
      "created_at" : "2019-01-19T17:42:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455800025",
      "id" : 455800025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgwMDAyNQ==",
      "updated_at" : "2019-01-19T17:42:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455800025",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell It actually doesn't change much, as the message hash is being computed on the fly as the message packets come in. The `GetMessageHash` call only does the SHA256 finalization.\r\n",
      "created_at" : "2019-01-19T17:46:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455800330",
      "id" : 455800330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgwMDMzMA==",
      "updated_at" : "2019-01-19T17:46:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455800330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa I was aware, but for many messages (e.g. small ones) the finalization is the hashing.",
      "created_at" : "2019-01-19T18:07:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455802157",
      "id" : 455802157,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgwMjE1Nw==",
      "updated_at" : "2019-01-19T18:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455802157",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\"The checksum check happens after deserialising all messages in the current read buffer.\" <-- No, this has not been the case since #9045. We hash as we receive data, only the *finalization* (ie last compression round and second hash) happen after we've received the full message. Don't really have a strong feeling about this, it does move a tiny big of CPU cost over to the net thread from net_processing, which is nice, though.",
      "created_at" : "2019-01-19T21:37:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455817419",
      "id" : 455817419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgxNzQxOQ==",
      "updated_at" : "2019-01-19T21:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455817419",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt: thanks for the clarification.\r\n\r\nThe intention of this PR is mainly to move the transportation protocol out of the message processing... and slowly moves towards a `CNetMessage` that is transport logic agnostic. With something like BIP150, we will have a different checksum (Poly1305 in the case of BIP151) and a different header. \r\n\r\nI think `CNetMessage` should at one point only carry the payload and the command (and eventually the recv. time). The serialisation as well as optional encryption/decryption plus the checksum should happen outside of `CNetMessage`.",
      "created_at" : "2019-01-20T06:11:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455840885",
      "id" : 455840885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTg0MDg4NQ==",
      "updated_at" : "2019-01-20T06:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455840885",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250249824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250249824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggest adding \", disconnecting\" to this message, consistent with the other disconnection scenario in `CNode::ReceiveMsgBytes`.",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2019-01-23T15:43:49Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250249824",
      "id" : 250249824,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDI0OTgyNA==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_line" : 866,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 195590667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250249824",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250250631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250250631"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see that `CNode::ReceiveMsgBytes` returns `false` if `readData` doesn't return `0`, and that in turn `CConnman::SocketHandler()` calls `pnode->CloseSocketDisconnect()` if that returned `false`. This feels a bit brittle though, but maybe that's just because I'm not super familiar with this part of the codebase. ",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2019-01-23T15:45:41Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250250631",
      "id" : 250250631,
      "line" : 686,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDI1MDYzMQ==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_line" : 686,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 195590667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250250631",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250745459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250745459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's the same path of closing a connection then if a remote peer would send an oversize message (or an invalid header that can't be deserialized). I think it's acceptable,",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2019-01-24T19:26:56Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250745459",
      "id" : 250745459,
      "in_reply_to_id" : 250250631,
      "line" : 686,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDc0NTQ1OQ==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_line" : 686,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 196208909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250745459",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250748337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250748337"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2019-01-24T19:34:34Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250748337",
      "id" : 250748337,
      "in_reply_to_id" : 250249824,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDc0ODMzNw==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_line" : 866,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 196212521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250748337",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase (for sanity checking against the merged 36aeb43c01d250d99cfffdfbb70d2420b70054cc)",
      "created_at" : "2019-01-31T15:43:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459392053",
      "id" : 459392053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTM5MjA1Mw==",
      "updated_at" : "2019-01-31T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459392053",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased (required for now merged #15246).\r\nAdapted test.",
      "created_at" : "2019-01-31T19:45:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459479966",
      "id" : 459479966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTQ3OTk2Ng==",
      "updated_at" : "2019-01-31T19:45:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459479966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`p2p_invalid_messages.py` test passes on macOS 10.14.3 for the newly rebased e7ab7d7. It [failed](https://travis-ci.org/bitcoin/bitcoin/jobs/487103354) on one of the Travis machines though.",
      "created_at" : "2019-02-01T10:20:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459675325",
      "id" : 459675325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTY3NTMyNQ==",
      "updated_at" : "2019-02-01T10:20:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459675325",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> p2p_invalid_messages.py test passes on macOS 10.14.3 for the newly rebased e7ab7d7. It failed on one of the Travis machines though.\r\n\r\nIndeed. I think it is because of the immediate termination of the connection which somehow confuses `mininode`'s getdata. I'll investigate.",
      "created_at" : "2019-02-01T23:48:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459907144",
      "id" : 459907144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTkwNzE0NA==",
      "updated_at" : "2019-02-01T23:48:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459907144",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Should we also worry about this breaking networking for nodes behind idiot firewalls that corrupt certain strings?   We know they exist because they occasionally cause nodes to be unable to fetch certain blocks and other such sillyness.  Right now if the stupidity that triggers them is in an ephemeral message (like a ping, inv, or an addr message) it'll just get dropped, logged, and move on.",
      "created_at" : "2019-02-03T04:56:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460023239",
      "id" : 460023239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDAyMzIzOQ==",
      "updated_at" : "2019-02-03T21:11:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460023239",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I always wondered. Would the checksum could just be skipped at all?\r\n\r\nIf I understand what is being said here, the only reason for having the checksum is so people have a clearer message in logs if the message get corrupted by firewall?",
      "created_at" : "2019-02-03T05:37:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460024940",
      "id" : 460024940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDAyNDk0MA==",
      "updated_at" : "2019-02-03T05:37:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460024940",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@NicolasDorier  It could be but it would generally be a bad idea, because then nodes would operate with silent corruption in some cases. In particular, a common failure mode (relatively speaking) is for firewalls rewrite addresses and port numbers, corrupting version handshakes and addr messages.  It was more of a concern before we started relaxing banning behaviour, but even without that, no one should have to waste countless hours troubleshooting a really dumb issue like a non-transparent firewall.  Doubly so because protocol conformance requires encoding it anyways.\r\n\r\n(plus, there is simply no reason to do so, the time they take is essentially negligible compared to other activities, and if we wanted to reduce it the authentication in the encrypted transport is faster (and thoroughly not optional)...)",
      "created_at" : "2019-02-03T19:57:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460082894",
      "id" : 460082894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDA4Mjg5NA==",
      "updated_at" : "2019-02-03T19:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460082894",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-09T15:42:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-540060089",
      "id" : 540060089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDA2MDA4OQ==",
      "updated_at" : "2019-10-09T15:42:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540060089",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2020-05-07T07:15:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-625075555",
      "id" : 625075555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTA3NTU1NQ==",
      "updated_at" : "2020-05-07T07:15:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625075555",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think there have been concerns that a bit flip on the wire will now cause the connection to be dropped instead of the msg that has the bit flip. How was this addressed?",
      "created_at" : "2020-05-07T12:15:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-625218417",
      "id" : 625218417,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTIxODQxNw==",
      "updated_at" : "2020-05-07T12:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625218417",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think there have been concerns that a bit flip on the wire will now cause the connection to be dropped instead of the msg that has the bit flip. How was this addressed?\r\n\r\nNo. That's not addressed. I didn't see that concern. Was there a public discussion?",
      "created_at" : "2020-05-07T12:27:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-625224092",
      "id" : 625224092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTIyNDA5Mg==",
      "updated_at" : "2020-05-07T12:27:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625224092",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oh, that is how I read the previous discussion in this pull request. Maybe I am missing something obvious or read the code wrong.",
      "created_at" : "2020-05-07T13:17:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-625249724",
      "id" : 625249724,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTI0OTcyNA==",
      "updated_at" : "2020-05-07T13:17:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625249724",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > I think there have been concerns that a bit flip on the wire will now cause the connection to be dropped instead of the msg that has the bit flip. How was this addressed?\r\n> \r\n> No. That's not addressed. I didn't see that concern. Was there a public discussion?\r\n\r\nI think @MarcoFalke is referring to https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460023239 above (that is how I'm reading it, at least).",
      "created_at" : "2020-05-10T12:04:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-626317681",
      "id" : 626317681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNjMxNzY4MQ==",
      "updated_at" : "2020-05-10T12:04:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/626317681",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r422639997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422639997"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It may be good to add a comment here, along the lines of\r\n```diff\r\n     if (Complete()) {\r\n+        // Verify message has valid checksum. If invalid, reject and disconnect the peer.\r\n```\r\n",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-10T12:38:33Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r422639997",
      "id" : 422639997,
      "line" : 678,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYzOTk5Nw==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 678,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 408741286,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422639997",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The refactoring part seems like a good option. Though I do not have enough expertise to evaluate the proper context, I will look deeper into further review. \r\n\r\nCurrently Concept ACK apart from the [#15206(comment)](https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460023239). There seems to remain a threat of an honest node being eclipsed from the network if an attacker manages to keep corrupting its incoming data. Or I am missing something.  \r\nI am also curious on the motivation behind such aggressive connection dropping behavior.    ",
      "created_at" : "2020-05-18T07:31:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-629999077",
      "id" : 629999077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTk5OTA3Nw==",
      "updated_at" : "2020-05-18T07:31:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629999077",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> There seems to remain a threat of an honest node being eclipsed from the network if an attacker manages to keep corrupting its incoming data.\r\n\r\nIf an attacker can corrupt incoming data, there are plenty of other ways to force a disconnect.\r\n\r\n> I am also curious on the motivation behind such aggressive connection dropping behavior.\r\n\r\nIt seems to be wasteful to allow other peers to send endless amounts of messages containing an invalid checksum. The operators peer may need to calculate tons of sha256 hashes at almost no cost for the remote peer.\r\n",
      "created_at" : "2020-05-18T11:52:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630130375",
      "id" : 630130375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDEzMDM3NQ==",
      "updated_at" : "2020-05-18T11:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630130375",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Might be interesting for reviewers: https://bitcoincore.reviews/15206.html",
      "created_at" : "2020-05-18T16:13:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630287423",
      "id" : 630287423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDI4NzQyMw==",
      "updated_at" : "2020-05-18T16:13:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630287423",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK after this [comment](https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630130375).",
      "created_at" : "2020-05-18T17:05:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630316285",
      "id" : 630316285,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDMxNjI4NQ==",
      "updated_at" : "2020-05-18T17:05:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630316285",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The operators peer may need to calculate tons of sha256 hashes at almost no cost for the remote peer.\r\n\r\nI am pretty sure the same is true for payloads that have a valid checksum. E.g. an unknown message type. The message is hashed, but then dropped without any adverse effects on the peer that sent it. So I think this should not be used as an argument to justify the change in this pull request.",
      "created_at" : "2020-05-18T17:12:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630319942",
      "id" : 630319942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDMxOTk0Mg==",
      "updated_at" : "2020-05-18T17:12:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630319942",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I am pretty sure the same is true for payloads that have a valid checksum. E.g. an unknown message type.\r\n\r\nUnknown messages require the remote peer to calculate at least a valid sha256 hash.\r\n\r\nWhile random 4byes are enough to trigger a remote dbl-sha256 operation.\r\n\r\nArguing that there are other places where a remote peer can drain endless resources with almost no cost should bring little weight to this discussion. Ideally we look at this isolated wether its worth fixing/changing its behavior.\r\n\r\nI though agree that it is debatable if we drop or tolerate connections sending messages with invalid checksums.",
      "created_at" : "2020-05-18T17:38:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630334125",
      "id" : 630334125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDMzNDEyNQ==",
      "updated_at" : "2020-05-18T17:38:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630334125",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I though agree that it is debatable if we drop or tolerate connections sending messages with invalid checksums.\r\n\r\nI'd be interested to know if it is possible to implement BIP151 without the behaviour change here? If yes, what are the trade-offs?",
      "created_at" : "2020-05-18T17:42:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630335753",
      "id" : 630335753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDMzNTc1Mw==",
      "updated_at" : "2020-05-18T17:42:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630335753",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'd be interested to know if it is possible to implement BIP151 without the behaviour change here? If yes, what are the trade-offs?\r\n\r\nAbsolutely. There is no need to change this behaviour to implement BIP324. In the V2 proposal, we have a MAC (poly1305) instead of a sha256 checksum. There, I'd strongly suggest we drop the connection on an invalid MAC (which is implemented in #18242).",
      "created_at" : "2020-05-18T17:57:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630343373",
      "id" : 630343373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDM0MzM3Mw==",
      "updated_at" : "2020-05-18T17:57:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630343373",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok, so the motivation of this change is to bring the legacy behaviour in line with BIP324? If yes, it could make sense to mention that motivation in the pull request description.",
      "created_at" : "2020-05-18T18:06:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630348082",
      "id" : 630348082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDM0ODA4Mg==",
      "updated_at" : "2020-05-18T18:06:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630348082",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ACK 1d9bc6a.  Reviewed the changes, built, and ran the tests.\r\n\r\nFull agreement on moving the checksum verification to the net layer.\r\n\r\nAgreeing with this [comment](https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460082894) that we should keep verifying the checksum, for the same reasons.  Removing the checksum seems out of scope for this PR.\r\n\r\nI don't think we have consensus on what the purpose of this checksum is.  It was added way back in protocol version 209 but I haven't been able to find the original discussions around it (or any since).  A clearer picture of why the checksum exists should help justify what the behavior should be upon a checksum verification failure.\r\n\r\nWith all of that said, I'm indifferent on the change of behavior.  It will be changed when implementing BIP324, so that seems like reason enough to do it now and see if any unanticipated problems arise.",
      "created_at" : "2020-05-19T17:59:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-630984908",
      "id" : 630984908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDk4NDkwOA==",
      "updated_at" : "2020-05-19T17:59:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630984908",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r427758757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427758757"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If we go forward with disconnecting on an invalid checksum do you think it's worthy to add a release note for this ? We can't evaluate how many nodes may be affected by a tampering firewall, but at least if node operators experience unexpected disconnect they are aware of a possible reason. And we would know what to revert.",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T05:58:53Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, disconnecting\\n\",\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r427758757",
      "id" : 427758757,
      "line" : 686,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc1ODc1Nw==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 686,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 415013214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427758757",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428042604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428042604"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We already disconnect on invalid netmagic (which might also be due to a bit-flip), so disconnecting here is probably fine. However, I think for cleaner code, the two seem related enough to be treated in the same way (either both in net_processing or both in net). No strong opinion where, but for example this is the diff if they are kept in net_processing:\r\n\r\n\r\n```diff\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex 9950b9aea4..9e213547fa 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -597,6 +597,11 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\r\n             vRecvMsg.push_back(std::move(msg));\r\n \r\n             complete = true;\r\n+\r\n+            if (!msg.m_valid_checksum) {\r\n+                // return early and notify net processing\r\n+                return true;\r\n+            }\r\n         }\r\n     }\r\n \r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 6d85b46831..a5606dfe66 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -3499,6 +3499,13 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\r\n     }\r\n     CNetMessage& msg(msgs.front());\r\n \r\n+    if (!msg.m_valid_checksum) {\r\n+        LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR peer=%d\\n\",\r\n+            __func__, SanitizeString(msg.m_command), msg.m_message_size, pfrom->GetId());\r\n+        pfrom->fDisconnect = true;\r\n+        return false;\r\n+    }\r\n+\r\n     msg.SetVersion(pfrom->GetRecvVersion());\r\n     // Check network magic\r\n     if (!msg.m_valid_netmagic) {\r\n@@ -3518,15 +3525,7 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\r\n     // Message size\r\n     unsigned int nMessageSize = msg.m_message_size;\r\n \r\n-    // Checksum\r\n     CDataStream& vRecv = msg.m_recv;\r\n-    if (!msg.m_valid_checksum)\r\n-    {\r\n-        LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR peer=%d\\n\", __func__,\r\n-           SanitizeString(msg_type), nMessageSize, pfrom->GetId());\r\n-        return fMoreWork;\r\n-    }\r\n-\r\n     // Process message\r\n     bool fRet = false;\r\n     try\r\n```\r\n\r\n",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T14:09:05Z",
      "diff_hunk" : "@@ -613,7 +613,6 @@ class CNetMessage {\n     int64_t m_time = 0;                  // time (in microseconds) of message receipt.\n     bool m_valid_netmagic = false;\n     bool m_valid_header = false;\n-    bool m_valid_checksum = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428042604",
      "id" : 428042604,
      "line" : 619,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA0MjYwNA==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 619,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 4,
      "pull_request_review_id" : 415375293,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428042604",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428091965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428091965"
         }
      },
      "author_association" : "NONE",
      "body" : "This should be changed to read something like:\r\n```suggestion\r\n    // store state about valid header and netmagic\r\n```",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T15:11:18Z",
      "diff_hunk" : "@@ -692,23 +704,14 @@ CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageSta\n     // store state about valid header, netmagic and checksum",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428091965",
      "id" : 428091965,
      "line" : 705,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5MTk2NQ==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 705,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 20,
      "pull_request_review_id" : 415439674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428091965",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428146010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428146010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Out of curiousity, I l did some googling on payload tampering firewall & checksum, but I couldn't find anything that seems relevant. Could you please point me to some resource to read more about it? Sounds very interesting :) ",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T16:27:20Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, disconnecting\\n\",\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428146010",
      "id" : 428146010,
      "in_reply_to_id" : 427758757,
      "line" : 686,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE0NjAxMA==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 686,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 415509754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428146010",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428164724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428164724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there a particular reason to check `Complete()` and do this here instead of in the complete check in `ReceiveMsgBytes()`?",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T16:54:08Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428164724",
      "id" : 428164724,
      "line" : 678,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE2NDcyNA==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 678,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 415533627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428164724",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428174976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428174976"
         }
      },
      "author_association" : "MEMBER",
      "body" : "With regards to firewall, rewriting some outgoing messages could be a NAT implementation, you can read more about this topic here : https://tools.ietf.org/html/rfc3022",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T17:11:00Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, disconnecting\\n\",\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428174976",
      "id" : 428174976,
      "in_reply_to_id" : 427758757,
      "line" : 686,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE3NDk3Ng==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 686,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 415546671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428174976",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "For reference #15197 ",
      "created_at" : "2020-05-20T17:45:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-631625484",
      "id" : 631625484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTYyNTQ4NA==",
      "updated_at" : "2020-05-20T17:45:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631625484",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428225994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428225994"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree that message validity checks should all happen in one place. I have a preference to have them in net so that net_processing only sees valid messages.",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T18:35:15Z",
      "diff_hunk" : "@@ -613,7 +613,6 @@ class CNetMessage {\n     int64_t m_time = 0;                  // time (in microseconds) of message receipt.\n     bool m_valid_netmagic = false;\n     bool m_valid_header = false;\n-    bool m_valid_checksum = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428225994",
      "id" : 428225994,
      "in_reply_to_id" : 428042604,
      "line" : 619,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIyNTk5NA==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 619,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 4,
      "pull_request_review_id" : 415612335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428225994",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428245456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428245456"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In the future, I'd like to see `TransportDeserializer` have a stateless interface such that it only produces valid messages or otherwise returns an appropriate error; see https://github.com/bitcoin/bitcoin/pull/16202#issuecomment-535152710. Not sure if @jonasschnelli agrees with me.\r\n\r\nIn that world, all validity checks would remain within the deserializer. Then `CNetMessage` would only need to represent valid messages so all its `m_valid_`* fields could be removed.",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T19:06:31Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428245456",
      "id" : 428245456,
      "in_reply_to_id" : 428164724,
      "line" : 678,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NTQ1Ng==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 678,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 415612335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428245456",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428282630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428282630"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks a lot!!  ",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-20T20:17:00Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, disconnecting\\n\",\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428282630",
      "id" : 428282630,
      "in_reply_to_id" : 427758757,
      "line" : 686,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4MjYzMA==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 686,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 415682242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428282630",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I agree with moving the checksum checking to the net layer. Disconnecting on checksum failure is *probably* ok, but I don't think the refactor and behaviour change need to be in the same PR (and certainly not in the same commit). How about changing this PR to just do the refactor and have a follow-up PR where discussion can be focused on whether to disconnect on checksum failure?\r\n\r\nI also agree with @jkczyz's suggestion here: https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428245456 which would allow all deserialization error-handling to be done in one place.",
      "created_at" : "2020-05-21T15:01:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632135600",
      "id" : 632135600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjEzNTYwMA==",
      "updated_at" : "2020-05-21T15:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632135600",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Do you think it is possible to do the refactor without the behaviour change? I believe it is only possible to do the behaviour change without the refactor (see https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428042604) but not the other way round.\r\n\r\nHappy to be proven wrong",
      "created_at" : "2020-05-21T15:08:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632139425",
      "id" : 632139425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjEzOTQyNQ==",
      "updated_at" : "2020-05-21T15:08:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632139425",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "For reference, I had one checksum error on a google cloud test node for one connection. Haven't tested other networks or NAT. Full history for that connection: [history_peer_id_1849951.txt](https://github.com/bitcoin/bitcoin/files/4663193/history_peer_id_1849951.txt) (2.5 Mb). (The error happened in an inv message after about 15 minutes of being connected. Total connection time was less than a day)\r\n\r\nNote that checksum errors are only logged with `-debug` or `-debug=net`.",
      "created_at" : "2020-05-21T15:20:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632145457",
      "id" : 632145457,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjE0NTQ1Nw==",
      "updated_at" : "2020-05-21T15:20:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632145457",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Do you think it is possible to do the refactor without the behaviour change?\r\n\r\nWhy wouldn't it be possible? The checksum can be checked in `ReceiveMessageBytes()` and the message dropped (with a log) if the checksum is wrong.",
      "created_at" : "2020-05-21T15:24:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632147657",
      "id" : 632147657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjE0NzY1Nw==",
      "updated_at" : "2020-05-21T15:24:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632147657",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK on the refactor. After reading the discussion here and in the PR review club I am still undecided if the disconnect is a good idea. We don't seem to have enough data to be confident that it will not be a problem for some users.\r\n\r\nWould using the banscore be a viable middle ground in this case? Yes, we would ban the peer but only after multiple offenses and we could tweak the number so that we are confident there is a bigger problem (like the actual attack discussed earlier) in which case a ban seems actually more warranted than a disconnect.\r\n\r\nBanscore is generally not considered much these days it seems but I can't see why it would not be a possible solution in this case.",
      "created_at" : "2020-05-21T21:01:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632343583",
      "id" : 632343583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjM0MzU4Mw==",
      "updated_at" : "2020-05-21T21:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632343583",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Banscore is generally not considered much these days it seems but I can't see why it would not be a possible solution in this case.\r\n\r\n@fjahr my view on banscore is that it's not particularly useful. If a peer sends us one bad message it's generally safe to assume that it'll probably send us more bad messages. Why wait until it's sent us 10 or 100 before disconnecting or banning? The ban score is a simple counter (and not some protocol violations/time gauge), so even if a peer sends us one bad message every few days, it'll eventually reach the ban limit.\r\n\r\nMore generally, it's useful to ask why we'd disconnect a peer. I think there are three good reasons:\r\n\r\n1. to protect ourselves from resource-wasting by broken peers. Note that this doesn't really help against adversarial peers if we're accepting incoming connections, since they can always reconnect, and even banning connections from that IP address isn't much protection, since acquiring new IP addresses to connect from is trivial for an adversary.\r\n2. to free up on of our limited connection slots for a better peer (eg one that is more likely to relay blocks or propagate transactions to us)\r\n3 (maybe) in some cases, disconnecting from peers is the only way to signal to them that they're sending us bad data. If all your peers are disconnecting from you, then you can infer that there's probably something wrong with your connection or implementation. If peers were just dropping your messages, you may never find out.\r\n\r\nIn all of those cases, I think that if you're going to disconnect, it's better to disconnect immediately, rather than wait for some arbitrary number of protocol violations. Or put differently, if you can tolerate 9 bad messages from a peer, why should you suddenly disconnect on the 10th?\r\n\r\nFrom an implementation standpoint, ban scores exist only in the net processing layer. net.cpp has no concept of a peer's ban score. If we want to move checksum verification to the net layer, then we either can't use ban scores, or we need to do a big change in the way they're handled.",
      "created_at" : "2020-05-22T00:57:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632420501",
      "id" : 632420501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjQyMDUwMQ==",
      "updated_at" : "2020-05-22T00:57:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632420501",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428999213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428999213"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@jkczyz I don't think that it's possible to have a stateless interface for `TransportDeserializer`. When we call into `Read(pch, nBytes)` the bytes that we've read from the socket and are passing in may not constitute the full message. That's why `TransportDeserializer` is stateful and keeps track of partially received headers/messages in `hdrbuf`/`vRecv`.\r\n\r\nI agree with @narula that the error-handing should be done in `ReceiveMsgBytes()`. That's partially because it's neater: `Read()`, `readHeader()` and `readData()` could all be changed to return an error enum or object, and error-handling can all happen in one place. I also think that logging needs to happen within `CNode` for it to be meaningful. Without logging the node id, this log message is pretty useless.\r\n\r\n",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-22T01:36:01Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428999213",
      "id" : 428999213,
      "in_reply_to_id" : 428164724,
      "line" : 678,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5OTIxMw==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 678,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 416595198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T07:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428999213",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ran all the tests. All unit tests and functional tests passing. Verified the test fails on master. Still haven't been able to decide on connection dropping behavior. \r\n\r\n> Do you think it is possible to do the refactor without the behavior change? \r\n\r\nThis seems like a good idea as the good refactoring part of the change can get merged while we gather up more data to decide on connection dropping behavior.\r\n\r\nAlso I was wondering, in the scenario where a firewall mingles with message data causing checksum to fail, do they do it for all data all the time? or they do it intermittently? \r\n\r\n>    3 (maybe) in some cases, disconnecting from peers is the only way to signal to them that they're sending us bad data. If all your peers are disconnecting from you, then you can infer that there's probably something wrong with your connection or implementation. If peers were just dropping your messages, you may never find out.\r\n\r\nIs it possible that my own firewall is playing foul on me which then results in me disconnecting all the nodes? Can this also give signal that something is wrong with my end of the connection?  \r\n",
      "created_at" : "2020-05-22T11:22:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632641477",
      "id" : 632641477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY0MTQ3Nw==",
      "updated_at" : "2020-05-22T11:22:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632641477",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Just for information. I see this errors at my node (about 400 connections).\r\n\r\n`\r\n2020-05-21T00:22:57Z CHECKSUM ERROR (SMBr, 0 bytes), expected 5df6e0e2 was 00000000\r\n2020-05-21T00:23:44Z CHECKSUM ERROR (, 0 bytes), expected 5df6e0e2 was 00000000\r\n2020-05-21T00:23:55Z CHECKSUM ERROR (, 1 bytes), expected f3035c79 was 01000000\r\n`\r\nAbout 15 on one day.\r\nLogging net is enabled.",
      "created_at" : "2020-05-22T13:15:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632684741",
      "id" : 632684741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY4NDc0MQ==",
      "updated_at" : "2020-05-22T13:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632684741",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1223908?v=4",
         "events_url" : "https://api.github.com/users/Emzy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Emzy/followers",
         "following_url" : "https://api.github.com/users/Emzy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Emzy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Emzy",
         "id" : 1223908,
         "login" : "Emzy",
         "node_id" : "MDQ6VXNlcjEyMjM5MDg=",
         "organizations_url" : "https://api.github.com/users/Emzy/orgs",
         "received_events_url" : "https://api.github.com/users/Emzy/received_events",
         "repos_url" : "https://api.github.com/users/Emzy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Emzy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Emzy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Emzy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Those are clearly malicious nodes and disconnection is the best we can do",
      "created_at" : "2020-05-22T13:32:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632692403",
      "id" : 632692403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY5MjQwMw==",
      "updated_at" : "2020-05-22T13:32:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632692403",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-23T12:07:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-633038950",
      "id" : 633038950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzAzODk1MA==",
      "updated_at" : "2020-05-23T12:07:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633038950",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2020-05-26T07:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-633845888",
      "id" : 633845888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzg0NTg4OA==",
      "updated_at" : "2020-05-26T07:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633845888",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "In acknowledgement of @MarcoFalke's [challenge](https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632139425) and @jnewbery's [suggestion](https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-632147657), this [branch](https://github.com/troygiorshev/bitcoin/tree/p2p-refactor-checksum) holds an example of moving the checksum verification to `GetMessage()` (called by `ReceiveMsgBytes()`), without changing the current disconnect/don't disconnect behavior.  In agreement with this other [comment](https://github.com/bitcoin/bitcoin/pull/15206#discussion_r428042604), a natural continuation could be this [branch](https://github.com/troygiorshev/bitcoin/tree/p2p-refactor-header), which moves all header checks into net, again without changing the current behavior (along the lines of #15197).\r\n\r\nThanks again to @jonasschnelli for being the impetus behind these PRs.  These will pave the way for improvements like BIP324 and #18989.  I hope these branches can clear up some of the worries expressed both here and in the PR Review Club.",
      "created_at" : "2020-05-27T14:40:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-634707439",
      "id" : 634707439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDcwNzQzOQ==",
      "updated_at" : "2020-05-27T14:40:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634707439",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I like the approach in @troygiorshev's branch https://github.com/troygiorshev/bitcoin/tree/p2p-refactor-header, which moves the checks into net.cpp without changing behaviour. @jonasschnelli : can you take a look at that branch and see what you think? Does it interfere with your BIP324 work?",
      "created_at" : "2020-05-27T15:07:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-634726275",
      "id" : 634726275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDcyNjI3NQ==",
      "updated_at" : "2020-05-27T15:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634726275",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't know how to proceed (if) with this PR.\r\nIt seems like that the immediate disconnect on a single checksum is to harsh (by some contributors judgment). I'm personally unsure wether it's too strict or desirable.\r\n\r\nSplitting the PR into a pure refactoring is possible. @troygiorshev  branch https://github.com/troygiorshev/bitcoin/tree/p2p-refactor-header looks not bad.\r\n\r\nIf we are not going to do the disconnect (just a refactor), I suggest do close this PR and start with a fresh one for something like @troygiorshev is suggesting.",
      "created_at" : "2020-05-29T06:03:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-635778140",
      "id" : 635778140,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTc3ODE0MA==",
      "updated_at" : "2020-05-29T06:03:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635778140",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r432635102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432635102"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> @jkczyz I don't think that it's possible to have a stateless interface for `TransportDeserializer`. When we call into `Read(pch, nBytes)` the bytes that we've read from the socket and are passing in may not constitute the full message. That's why `TransportDeserializer` is stateful and keeps track of partially received headers/messages in `hdrbuf`/`vRecv`.\r\n> \r\n\r\nIIRC, my linked comment was alluding to the fact that additional refactoring may be needed to accomplish this. For instance, decoupling reading bytes from the wire from deserializing those read bytes.",
      "commit_id" : "9164e1cc4d1b8a1ae148bad52613aa67d9173a1a",
      "created_at" : "2020-05-29T17:32:10Z",
      "diff_hunk" : "@@ -674,6 +674,18 @@ int V1TransportDeserializer::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (Complete()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r432635102",
      "id" : 432635102,
      "in_reply_to_id" : 428164724,
      "line" : 678,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYzNTEwMg==",
      "original_commit_id" : "1d9bc6a8c52f33bb34c74f34169100e18f8e1784",
      "original_line" : 678,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 421152657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-29T17:32:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432635102",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-04T20:37:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-639103077",
      "id" : 639103077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTEwMzA3Nw==",
      "updated_at" : "2020-06-04T20:37:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639103077",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is obsoleted by #19107 \r\n\r\n@jonasschnelli - if you think that there's anything in here that isn't addressed by 19107, feel free to reopen or open another PR.",
      "created_at" : "2020-09-29T10:39:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-700619288",
      "id" : 700619288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDYxOTI4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T10:39:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700619288",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
