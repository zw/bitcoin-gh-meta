[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2016#discussion_r2146150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2016"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2146150"
         }
      },
      "body" : "vRecvMsg.back();",
      "commit_id" : "8af12a9f5a56de594700abb5b0d9a05adf82d64b",
      "created_at" : "2012-11-15T22:41:16Z",
      "diff_hunk" : "@@ -627,6 +627,78 @@ void CNode::copyStats(CNodeStats &stats)\n }\n #undef X\n \n+// requires LOCK(cs_vRecvMsg)\n+bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes)\n+{\n+    while (nBytes > 0) {\n+\n+        // get current incomplete message, or create a new one\n+        if (vRecvMsg.size() == 0 ||\n+            vRecvMsg[vRecvMsg.size() - 1].complete())\n+            vRecvMsg.push_back(CNetMessage(SER_NETWORK, nRecvVersion));\n+\n+        CNetMessage& msg = vRecvMsg[vRecvMsg.size() - 1];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#discussion_r2146150",
      "id" : 2146150,
      "original_commit_id" : "67c2e23abadb36efb0b31e8618e2382947e14f14",
      "original_position" : 23,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2016",
      "updated_at" : "2012-11-16T00:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2146150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa: ITYM back().  Updated.",
      "created_at" : "2012-11-16T00:42:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-10432231",
      "id" : 10432231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2012-11-16T00:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10432231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2016#discussion_r2161697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2016"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2161697"
         }
      },
      "body" : "I'm not sure this is right. When the receive version is set, it is only applied to new messages. In practice that probably doesn't mean anything, as the version/verack message order is quite strict.",
      "commit_id" : "8af12a9f5a56de594700abb5b0d9a05adf82d64b",
      "created_at" : "2012-11-18T18:56:24Z",
      "diff_hunk" : "@@ -241,6 +283,26 @@ class CNode\n         return std::max(nRefCount, 0) + (GetTime() < nReleaseTime ? 1 : 0);\n     }\n \n+    // requires LOCK(cs_vRecvMsg)\n+    unsigned int GetTotalRecvSize()\n+    {\n+        unsigned int total = 0;\n+        for (unsigned int i = 0; i < vRecvMsg.size(); i++)\n+            total += vRecvMsg[i].vRecv.size();\n+        return total;\n+    }\n+\n+    // requires LOCK(cs_vRecvMsg)\n+    bool ReceiveMsgBytes(const char *pch, unsigned int nBytes);\n+\n+    // requires LOCK(cs_vRecvMsg)\n+    void SetRecvVersion(int nVersionIn)\n+    {\n+        nRecvVersion = nVersionIn;\n+        for (unsigned int i = 0; i < vRecvMsg.size(); i++)\n+            vRecvMsg[i].SetVersion(nVersionIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#discussion_r2161697",
      "id" : 2161697,
      "original_commit_id" : "8af12a9f5a56de594700abb5b0d9a05adf82d64b",
      "original_position" : 103,
      "path" : "src/net.h",
      "position" : 103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2016",
      "updated_at" : "2012-11-18T18:56:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2161697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I like the general design, but this pull mixes an client-side optimization with changing the network protocol policy.\r\n\r\nI'm not against making it more strict and not trying to resync after a partial message or garbage data, but maybe that needs some discussion at least.",
      "created_at" : "2012-11-18T20:01:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-10490659",
      "id" : 10490659,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2012-11-18T20:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10490659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "When I didn't have resync after garbage data in bitcoinj I did see failures due to it, though it was long ago.\r\n\r\nBTW, is it possible now to send huge numbers of messages and cause OOM conditions? Previously if you did that the unread data would stick around in the kernels socket buffers and be discarded automatically. Now I guess the socket thread can read faster than the main thread can process.",
      "created_at" : "2012-11-21T12:12:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-10594689",
      "id" : 10594689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2012-11-21T12:12:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10594689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "The last time I saw garbage occurring frequently was after the feb20 protocol upgrade. I suppose we can start requiring no garbage now...\r\n\r\nThe is still a receive buffer flooding check, by the way.",
      "created_at" : "2012-11-21T14:21:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-10598565",
      "id" : 10598565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2012-11-21T14:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10598565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/8af12a9f5a56de594700abb5b0d9a05adf82d64b for binaries and test log.",
      "created_at" : "2012-11-22T17:40:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-10641183",
      "id" : 10641183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2012-11-22T17:40:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10641183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "I wonder why we even need that flood protection. You could just as well stop polling sockets for read events if their receive buffer is above some threshold.",
      "created_at" : "2012-11-23T20:36:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-10669153",
      "id" : 10669153,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2012-11-23T20:36:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10669153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "For the record: I saw a node segfault with (among others) this patch, in the ~CNetMessage destructor (the CDataStream in it was not allocated, I assume uninitialized memory used as a CNetMessage).",
      "created_at" : "2012-11-27T20:48:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-10776200",
      "id" : 10776200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2012-11-27T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10776200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2016#discussion_r2415213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2016"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2415213"
         }
      },
      "body" : "Perhaps it's better to use an std::deque here instead of a std::vector?",
      "commit_id" : "8af12a9f5a56de594700abb5b0d9a05adf82d64b",
      "created_at" : "2012-12-13T23:11:44Z",
      "diff_hunk" : "@@ -3380,7 +3366,10 @@ bool ProcessMessages(CNode* pfrom)\n             printf(\"ProcessMessage(%s, %u bytes) FAILED\\n\", strCommand.c_str(), nMessageSize);\n     }\n \n-    vRecv.Compact();\n+    // remove processed messages; one incomplete message may remain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#discussion_r2415213",
      "id" : 2415213,
      "original_commit_id" : "8af12a9f5a56de594700abb5b0d9a05adf82d64b",
      "original_position" : 121,
      "path" : "src/main.cpp",
      "position" : 121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2016",
      "updated_at" : "2012-12-13T23:11:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2415213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/8af12a9f5a56de594700abb5b0d9a05adf82d64b for binaries and test log.",
      "created_at" : "2013-01-26T13:21:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-12735236",
      "id" : 12735236,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2013-01-26T13:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12735236",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "Superceded by #2409 ",
      "created_at" : "2013-03-24T16:29:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2016#issuecomment-15362009",
      "id" : 15362009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2016",
      "updated_at" : "2013-03-24T16:29:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/15362009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   }
]
