[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169511450"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169511450"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a great start! I don't think think it is thread safe yet, though, because in parallel with this thread, a block connected notification could be coming in, or another another RPC could be being made that is using one of the `Db*` or `DbEnv*` pointers that this closes.\r\n\r\nI think all you need to do to make this thread safe is wait for the `mapFileUseCount` entries to go to zero. You could do this with a condition variable. For example, if you added a `std::condition_variable m_cv_in_use;` member to `CDBEnv` you could trigger it in `CDB::Close`:\r\n\r\n```c++\r\nm_cv_in_use.notify_all()\r\n```\r\n\r\nand wait for it at the top of `CDBEnv::ReloadDbEnv`:\r\n\r\n```c++\r\nWAIT_LOCK(cs_db, lock);\r\nm_cv_in_use.wait(lock, [this](){\r\n    for (count : mapFileUseCount) {\r\n        if (count.second > 0) return false;\r\n    }\r\n    return true;\r\n});\r\n```\r\n\r\nThis is one possible approach. Other approaches may be simpler or better. One drawback of this approach is that if there are a lot of background writes happening in different wallets, ReloadDbEnv could get starved out waiting for all wallets to be simultaneously not in use.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T01:16:48Z",
      "diff_hunk" : "@@ -509,6 +509,22 @@ void CDBEnv::CloseDb(const std::string& strFile)\n     }\n }\n \n+void CDBEnv::ReloadDbEnv()\n+{\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {\n+        filenames.push_back(it.first);\n+    }\n+    // Close the individual Db's\n+    for (std::string filename : filenames) {\n+        CloseDb(filename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169511450",
      "id" : 169511450,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTUxMTQ1MA==",
      "original_commit_id" : "6b2b3a76980ab0c3418d46a5df8040eaa160f449",
      "original_position" : 12,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 98049174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169511450",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky I've implemented something which is basically what you described. It seems to work, although I'm not sure how to test the thread safe-ness of it. Let me know what you think.",
      "created_at" : "2018-02-21T03:54:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-367205750",
      "id" : 367205750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "updated_at" : "2018-02-21T03:54:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367205750",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169655317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169655317"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Replace cs_db with a recursive mutex use with a conditional_variable_any\"\r\n\r\ncs_db is actually already a recursive mutex (it inherits from std::recursive_mutex). I think you could just leave it unchanged, and continue using the LOCK macro instead of std::lock_guard everywhere. This would make the commit smaller & simpler.\r\n\r\n",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T14:35:40Z",
      "diff_hunk" : "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169655317",
      "id" : 169655317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY1NTMxNw==",
      "original_commit_id" : "de939869f2513d403568fdc8b828300fe54f0639",
      "original_position" : 5,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 98215449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169655317",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169656355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169656355"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Replace cs_db with a recursive mutex use with a conditional_variable_any\"\r\n\r\nWould be good to add an AssertLockNotHeld(cs_db); above this, since it would be a bug if the mutex were held recursively when this was called (wait could hang if the lock wasn't released). ",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T14:39:03Z",
      "diff_hunk" : "@@ -511,6 +512,15 @@ void CDBEnv::CloseDb(const std::string& strFile)\n \n void CDBEnv::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169656355",
      "id" : 169656355,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY1NjM1NQ==",
      "original_commit_id" : "de939869f2513d403568fdc8b828300fe54f0639",
      "original_position" : 51,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 98215449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169656355",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169675054"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169675054"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I tried that, but it kept giving me a compiler error.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T15:32:14Z",
      "diff_hunk" : "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169675054",
      "id" : 169675054,
      "in_reply_to_id" : 169655317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY3NTA1NA==",
      "original_commit_id" : "de939869f2513d403568fdc8b828300fe54f0639",
      "original_position" : 5,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 98239484,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169675054",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169682192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169682192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T15:51:17Z",
      "diff_hunk" : "@@ -511,6 +512,15 @@ void CDBEnv::CloseDb(const std::string& strFile)\n \n void CDBEnv::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169682192",
      "id" : 169682192,
      "in_reply_to_id" : 169656355,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY4MjE5Mg==",
      "original_commit_id" : "de939869f2513d403568fdc8b828300fe54f0639",
      "original_position" : 51,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 98247803,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169682192",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169721029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169721029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169655317\r\n\r\n> I tried that, but it kept giving me a compiler error.\r\n\r\nWhat is the compiler error? The following compiles for me: c271de2d62881c0880bf64b830d72f686967bbfb (fetchable with `git fetch https://github.com/ryanofsky/bitcoin pr/lreload`).\r\n\r\nI didn't do any real testing with it but it passes python & unit tests.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T17:45:49Z",
      "diff_hunk" : "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169721029",
      "id" : 169721029,
      "in_reply_to_id" : 169655317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTcyMTAyOQ==",
      "original_commit_id" : "de939869f2513d403568fdc8b828300fe54f0639",
      "original_position" : 5,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 98293675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169721029",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169730801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169730801"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, I was doing something with the macros and CCriticalSection. It was an error about not having an `unlock` method.\r\n\r\nI'll test this out, but from testing I just did with the current code, it looks like it does work, so this should work too.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T18:19:54Z",
      "diff_hunk" : "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169730801",
      "id" : 169730801,
      "in_reply_to_id" : 169655317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTczMDgwMQ==",
      "original_commit_id" : "de939869f2513d403568fdc8b828300fe54f0639",
      "original_position" : 5,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 98305130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169730801",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169777432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169777432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ryanofsky I've used your commit.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-21T21:06:22Z",
      "diff_hunk" : "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169777432",
      "id" : 169777432,
      "in_reply_to_id" : 169655317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTc3NzQzMg==",
      "original_commit_id" : "de939869f2513d403568fdc8b828300fe54f0639",
      "original_position" : 5,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 98359993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169777432",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169836879"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169836879"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"After encrypting the wallet, reload the database environment\"\r\n\r\nDelayed flushing seems more like a legitimate design tradeoff than a bad habit. Maybe just say something like \"flush and reload the database environment here to clear out any data in memory that might be left behind after the rewrite above.\"",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-22T02:05:04Z",
      "diff_hunk" : "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();\n \n+        // BDB seems to have a bad habit of writing old data into",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169836879",
      "id" : 169836879,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTgzNjg3OQ==",
      "original_commit_id" : "b2a0bb97bb3773adce797724fb937e5bd4294f55",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 98428192,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169836879",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169838060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169838060"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"After encrypting the wallet, reload the database environment\"\r\n\r\nLooking at the CDB::Rewrite implementation I noticed that it already has a while loop that sleeps until mapFileUseCount (for just one wallet) is 0. You could take advantage of this if you wanted by tweaking the while loop there to wait for all use counts in the environment to be 0 and then calling ReloadDbEnv inside CDB::Rewrite. This would be a simplification since it would let you get rid of the new condition variable, and it would also make the new waiting code more consistent with previous code.\r\n\r\nThis is just a suggestion, though. Your current implementation seems fine, too.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-22T02:14:04Z",
      "diff_hunk" : "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169838060",
      "id" : 169838060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTgzODA2MA==",
      "original_commit_id" : "b2a0bb97bb3773adce797724fb937e5bd4294f55",
      "original_position" : 2,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 98428192,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169838060",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842341"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment was just copied over from `rpcwallet.cpp`. ",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-22T02:48:38Z",
      "diff_hunk" : "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();\n \n+        // BDB seems to have a bad habit of writing old data into",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842341",
      "id" : 169842341,
      "in_reply_to_id" : 169836879,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTg0MjM0MQ==",
      "original_commit_id" : "b2a0bb97bb3773adce797724fb937e5bd4294f55",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 98434190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842341",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842400"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't want to do anything to `CDB::Rewrite` since it is used in places other than `encryptwallet`.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-22T02:49:05Z",
      "diff_hunk" : "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842400",
      "id" : 169842400,
      "in_reply_to_id" : 169838060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTg0MjQwMA==",
      "original_commit_id" : "b2a0bb97bb3773adce797724fb937e5bd4294f55",
      "original_position" : 2,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 98434259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842400",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169964768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169964768"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169838060\r\n\r\n> I don't want to do anything to CDB::Rewrite since it is used in places other than encryptwallet\r\n\r\nI didn't realize Rewrite was called other places, and the current approach does seem fine. But if you did want to unify the UseCount waiting logic, I think you could do it in a pretty clean way by adding a `bool reload_env` or similar option to CDB::Rewrite. I think in terms code clarity, having the option would actually be an improvement over always reloading.\r\n",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-22T14:09:28Z",
      "diff_hunk" : "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169964768",
      "id" : 169964768,
      "in_reply_to_id" : 169838060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTk2NDc2OA==",
      "original_commit_id" : "b2a0bb97bb3773adce797724fb937e5bd4294f55",
      "original_position" : 2,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 98575966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169964768",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170101734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170101734"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think I'll leave it as it is now.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-22T21:40:17Z",
      "diff_hunk" : "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170101734",
      "id" : 170101734,
      "in_reply_to_id" : 169838060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDEwMTczNA==",
      "original_commit_id" : "b2a0bb97bb3773adce797724fb937e5bd4294f55",
      "original_position" : 2,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 98738206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170101734",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614391"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove `.arg()` since `%1` was removed.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T14:48:46Z",
      "diff_hunk" : "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),\n                                          \"<qt>\" +\n-                                         tr(\"%1 will close now to finish the encryption process. \"\n+                                         tr(\"Your wallet is now encrypted. \"\n                                          \"Remember that encrypting your wallet cannot fully protect \"\n                                          \"your bitcoins from being stolen by malware infecting your computer.\").arg(tr(PACKAGE_NAME)) +",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614391",
      "id" : 170614391,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNDM5MQ==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 7,
      "path" : "src/qt/askpassphrasedialog.cpp",
      "position" : null,
      "pull_request_review_id" : 99325615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614391",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`QMessageBox::information`?",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T14:49:35Z",
      "diff_hunk" : "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614682",
      "id" : 170614682,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNDY4Mg==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 2,
      "path" : "src/qt/askpassphrasedialog.cpp",
      "position" : 2,
      "pull_request_review_id" : 99325615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614682",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616888"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove `filenames` and just iterate once, something like:\r\n```cpp\r\nwhile (!mapDb.empty()) {\r\n  std::string filename = mapDb.begin().first;\r\n  ...\r\n}\r\n```",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T14:55:36Z",
      "diff_hunk" : "@@ -509,6 +510,32 @@ void CDBEnv::CloseDb(const std::string& strFile)\n     }\n }\n \n+void CDBEnv::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616888",
      "id" : 170616888,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNjg4OA==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : 25,
      "pull_request_review_id" : 99325615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616888",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, space after `if`.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T14:55:57Z",
      "diff_hunk" : "@@ -733,3 +760,10 @@ void CWalletDBWrapper::Flush(bool shutdown)\n         env->Flush(shutdown);\n     }\n }\n+\n+void CWalletDBWrapper::ReloadDbEnv()\n+{\n+    if(!IsDummy()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616987",
      "id" : 170616987,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNjk4Nw==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 48,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 99325615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616987",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695136"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T18:49:13Z",
      "diff_hunk" : "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),\n                                          \"<qt>\" +\n-                                         tr(\"%1 will close now to finish the encryption process. \"\n+                                         tr(\"Your wallet is now encrypted. \"\n                                          \"Remember that encrypting your wallet cannot fully protect \"\n                                          \"your bitcoins from being stolen by malware infecting your computer.\").arg(tr(PACKAGE_NAME)) +",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695136",
      "id" : 170695136,
      "in_reply_to_id" : 170614391,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTEzNg==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 7,
      "path" : "src/qt/askpassphrasedialog.cpp",
      "position" : null,
      "pull_request_review_id" : 99420641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695136",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think it needs to change.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T18:49:21Z",
      "diff_hunk" : "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695186",
      "id" : 170695186,
      "in_reply_to_id" : 170614682,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTE4Ng==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 2,
      "path" : "src/qt/askpassphrasedialog.cpp",
      "position" : 2,
      "pull_request_review_id" : 99420697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695186",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T18:49:43Z",
      "diff_hunk" : "@@ -733,3 +760,10 @@ void CWalletDBWrapper::Flush(bool shutdown)\n         env->Flush(shutdown);\n     }\n }\n+\n+void CWalletDBWrapper::ReloadDbEnv()\n+{\n+    if(!IsDummy()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695325",
      "id" : 170695325,
      "in_reply_to_id" : 170616987,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTMyNQ==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 48,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 99420822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695325",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't work (causes test failures with encryptwallet). I think it's becauese mapDb is modified by CloseDb too.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-02-26T18:50:44Z",
      "diff_hunk" : "@@ -509,6 +510,32 @@ void CDBEnv::CloseDb(const std::string& strFile)\n     }\n }\n \n+void CDBEnv::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695659",
      "id" : 170695659,
      "in_reply_to_id" : 170616888,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTY1OQ==",
      "original_commit_id" : "437d2dd56f81a6258243aca6ed137cbca9255b32",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : 25,
      "pull_request_review_id" : 99421243,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695659",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-03-28T17:56:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-376978070",
      "id" : 376978070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "updated_at" : "2018-03-28T17:56:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376978070",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed travis and rebased again.",
      "created_at" : "2018-03-31T16:16:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-377704231",
      "id" : 377704231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "updated_at" : "2018-03-31T16:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/377704231",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-04-12T21:38:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-380952269",
      "id" : 380952269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "updated_at" : "2018-04-12T21:38:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380952269",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Review beg",
      "created_at" : "2018-05-05T04:36:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-386778518",
      "id" : 386778518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "updated_at" : "2018-05-05T04:36:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386778518",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Review Beg?",
      "created_at" : "2018-06-12T18:17:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-396685450",
      "id" : 396685450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NjY4NTQ1MA==",
      "updated_at" : "2018-06-12T18:17:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396685450",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497267"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be slightly cleaner to use `std::unique_lock<CCriticalSection>` here.\r\n\r\nAlso, please squash this into the first commit - currently your PR introduces a bug and then fixes it later.\r\n\r\nWe should probably also work on making the sync.h primitives more C++11 compatible, but let's leave that for later.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-07-14T00:02:24Z",
      "diff_hunk" : "@@ -570,6 +571,16 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n \n void BerkeleyEnvironment::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497267",
      "id" : 202497267,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5NzI2Nw==",
      "original_commit_id" : "b766d7bb8ff0494ea3961945f15abaa4b13d0830",
      "original_position" : 14,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 137219138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497267",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497467"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-07-14T00:04:47Z",
      "diff_hunk" : "@@ -570,6 +571,16 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n \n void BerkeleyEnvironment::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497467",
      "id" : 202497467,
      "in_reply_to_id" : 202497267,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5NzQ2Nw==",
      "original_commit_id" : "b766d7bb8ff0494ea3961945f15abaa4b13d0830",
      "original_position" : 14,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 137219372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497467",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497854"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Performance nit: notifying while not holding the lock is slightly faster (currently you'll wake the waiting thread, which then immediately needs to sleep again because the lock is still held).",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-07-14T00:09:52Z",
      "diff_hunk" : "@@ -551,6 +551,7 @@ void BerkeleyBatch::Close()\n     {\n         LOCK(cs_db);\n         --env->mapFileUseCount[strFile];\n+        env->m_db_in_use.notify_all();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497854",
      "id" : 202497854,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5Nzg1NA==",
      "original_commit_id" : "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
      "original_position" : 4,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 137219808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497854",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `const std::string& filename`.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-07-14T00:10:31Z",
      "diff_hunk" : "@@ -568,6 +569,32 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n     }\n }\n \n+void BerkeleyEnvironment::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<CCriticalSection> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {\n+        filenames.push_back(it.first);\n+    }\n+    // Close the individual Db's\n+    for (std::string filename : filenames) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497895",
      "id" : 202497895,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5Nzg5NQ==",
      "original_commit_id" : "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
      "original_position" : 29,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 137219808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497895",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-07-14T00:22:29Z",
      "diff_hunk" : "@@ -551,6 +551,7 @@ void BerkeleyBatch::Close()\n     {\n         LOCK(cs_db);\n         --env->mapFileUseCount[strFile];\n+        env->m_db_in_use.notify_all();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498649",
      "id" : 202498649,
      "in_reply_to_id" : 202497854,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5ODY0OQ==",
      "original_commit_id" : "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
      "original_position" : 4,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 137220774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498649",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498656"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498656"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-07-14T00:22:34Z",
      "diff_hunk" : "@@ -568,6 +569,32 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n     }\n }\n \n+void BerkeleyEnvironment::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<CCriticalSection> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {\n+        filenames.push_back(it.first);\n+    }\n+    // Close the individual Db's\n+    for (std::string filename : filenames) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498656",
      "id" : 202498656,
      "in_reply_to_id" : 202497895,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5ODY1Ng==",
      "original_commit_id" : "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
      "original_position" : 29,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 137220779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-09T18:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498656",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 06f17267ddafa089f093cfffc181d8c834d346e7",
      "created_at" : "2018-07-14T00:26:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-404984674",
      "id" : 404984674,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNDk4NDY3NA==",
      "updated_at" : "2018-07-14T00:26:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404984674",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and added a commit to fix the silent merge conflict (test failure).",
      "created_at" : "2018-07-14T02:17:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-404991778",
      "id" : 404991778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNDk5MTc3OA==",
      "updated_at" : "2018-07-14T02:17:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404991778",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK bdad9c40595c1e4959ebce1b55894060b2d7c146",
      "created_at" : "2018-07-14T21:57:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-405052421",
      "id" : 405052421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNTA1MjQyMQ==",
      "updated_at" : "2018-07-14T21:57:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/405052421",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-08-09T18:39:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-411856214",
      "id" : 411856214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMTg1NjIxNA==",
      "updated_at" : "2018-08-09T18:39:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/411856214",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r211096962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211096962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Don't use iterator references?",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-08-19T09:15:15Z",
      "diff_hunk" : "@@ -572,6 +573,32 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n     }\n }\n \n+void BerkeleyEnvironment::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<CCriticalSection> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r211096962",
      "id" : 211096962,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTA5Njk2Mg==",
      "original_commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "original_position" : 18,
      "path" : "src/wallet/db.cpp",
      "position" : 18,
      "pull_request_review_id" : 147452331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-08-19T21:58:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211096962",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested ACK c1dde3a949b36ce9c2155777b3fa1372e7ed97d8, this is a good UX improvement, thanks @achow101 \r\n\r\nI manually tested that there were indeed private keys in the logs after encrypting with the environment reload commented out, tested that reloading the environment does remove the logs with a lightly modified version of @achow101's script https://github.com/PierreRochard/bitcoin/commit/e9cd31c448622cd9030879706661bae5c4c6f3bb\r\n\r\nI manually tested the thread safety when two wallet Dbs are in the same environment using @ryanofsky's approach https://github.com/PierreRochard/bitcoin/commit/154dd6e147986c7ec8cbd005bb6e8e17a2e45ea7\r\n\r\nNB: I think I found a bug when setting the thread safety test up, the default wallet and a loaded wallet which are in the same directory will be in two different environments because the ~~default wallet's BerkeleyEnvironment object's `strPath` member~~ `walletdir` I passed in the config has a trailing slash but `loadwallet regtest2.dat` results in an environment without the trailing slash:\r\nhttps://gist.github.com/PierreRochard/47ae74e5c0bc618a3b1a3f5ae5443196\r\n",
      "created_at" : "2018-08-30T00:08:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-417147646",
      "id" : 417147646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNzE0NzY0Ng==",
      "updated_at" : "2018-09-03T13:32:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417147646",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/6299681?v=4",
         "events_url" : "https://api.github.com/users/PierreRochard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PierreRochard/followers",
         "following_url" : "https://api.github.com/users/PierreRochard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PierreRochard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PierreRochard",
         "id" : 6299681,
         "login" : "PierreRochard",
         "node_id" : "MDQ6VXNlcjYyOTk2ODE=",
         "organizations_url" : "https://api.github.com/users/PierreRochard/orgs",
         "received_events_url" : "https://api.github.com/users/PierreRochard/received_events",
         "repos_url" : "https://api.github.com/users/PierreRochard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PierreRochard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PierreRochard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PierreRochard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@PierreRochard I'll try to reproduce it.",
      "created_at" : "2018-08-30T00:36:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-417152036",
      "id" : 417152036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNzE1MjAzNg==",
      "updated_at" : "2018-08-30T00:36:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417152036",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-08-30T19:30:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-417439664",
      "id" : 417439664,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNzQzOTY2NA==",
      "updated_at" : "2018-08-30T19:30:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417439664",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK c1dde3a",
      "created_at" : "2018-09-04T03:42:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-418232427",
      "id" : 418232427,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxODIzMjQyNw==",
      "updated_at" : "2018-09-04T03:42:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/418232427",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217794290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217794290"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Move BerkeleyEnvironment deletion from internal method to callsite\" (a769461d5e37ddcb771ae836254fdc69177a28c4)\r\n\r\n@achow101 do remember if this change was this done for specific reason? It seems like an odd thing to include here.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-09-14T17:56:48Z",
      "diff_hunk" : "@@ -697,7 +697,6 @@ void BerkeleyEnvironment::Flush(bool fShutdown)\n                 if (!fMockDb) {\n                     fs::remove_all(fs::path(strPath) / \"database\");\n                 }\n-                g_dbenvs.erase(strPath);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217794290",
      "id" : 217794290,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzc5NDI5MA==",
      "original_commit_id" : "a769461d5e37ddcb771ae836254fdc69177a28c4",
      "original_position" : 4,
      "path" : "src/wallet/db.cpp",
      "position" : 45,
      "pull_request_review_id" : 155600307,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-09-14T17:58:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217794290",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217806330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217806330"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIRC there are two reasons for this. The first was that we needed this in the next commit to avoid having a destroyed db environment because we want to reopen it. The second reason that I don't think it is good for an object to destroy its own references as that's what it does here.",
      "commit_id" : "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "created_at" : "2018-09-14T18:38:57Z",
      "diff_hunk" : "@@ -697,7 +697,6 @@ void BerkeleyEnvironment::Flush(bool fShutdown)\n                 if (!fMockDb) {\n                     fs::remove_all(fs::path(strPath) / \"database\");\n                 }\n-                g_dbenvs.erase(strPath);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217806330",
      "id" : 217806330,
      "in_reply_to_id" : 217794290,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzgwNjMzMA==",
      "original_commit_id" : "a769461d5e37ddcb771ae836254fdc69177a28c4",
      "original_position" : 4,
      "path" : "src/wallet/db.cpp",
      "position" : 45,
      "pull_request_review_id" : 155615333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
      "updated_at" : "2018-09-14T18:38:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217806330",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
