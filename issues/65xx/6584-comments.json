[
   {
      "body" : "@laanwj shouldn't this be labeled with \"mempool\" too like #6405 ?\r\n@jgarzik you didn't adapted the python tests, feel free to cherry pick it for #6405 \r\n\r\nBy the way, I'm aware that we talked about merging #6470 first. But if it's takes much longer to merge it for whatever reason, I think we should be blocking other things like this or a dynamic min relay fee (which I would really want to do after #6068 ). ",
      "created_at" : "2015-08-25T22:13:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-134757326",
      "id" : 134757326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-25T22:13:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/134757326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Oversimplifying default policy also makes policy customisation more difficult. So IMO concept NACK unless there's a good reason for this (missing from description).",
      "created_at" : "2015-08-26T00:17:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-134776837",
      "id" : 134776837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-26T00:17:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/134776837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "In my opinion, policy abstraction (ability for customization) is something to plug in after the codebase in which it's plugged into is stable. That is currently not the case, the mempool will very likely significantly change for memory limiting, floating relay fee, indexes for block creation, ... much of that is much harder when trying to maintain a (IMO legacy and mostly broken) hardcoded policy.\r\n\r\nSo, what we should do, IMO, is get rid of the free relay policy and restrict to pure feerate, improve the mempool code to work based on that, and then plug in a sane policy configuration that can tweak what \"cost\" and \"fee\" we associate with transactions.",
      "created_at" : "2015-08-26T00:29:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-134778238",
      "id" : 134778238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-26T00:29:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/134778238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Concept ACK\r\n\r\n> Oversimplifying default policy also makes policy customisation more difficult. So IMO concept NACK unless there's a good reason for this (missing from description).\r\n\r\nIMHO,  it does the opposite,  it makes it easier to customize.  However,  my experience here is probably not as extensive as yours,  as it is based purely on editing the code as it stands not implementing policies specifically.",
      "created_at" : "2015-08-26T01:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-134783945",
      "id" : 134783945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-26T01:20:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/134783945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "I agree with @dcousens. The default policy that is implemented now is very difficult to customize (it relies on 2 different ordering criteria, with associated specific code in block construction, and specific code in mempool acceptance to work). A policy that just introduces a \"generalized cost\" and \"generalized fee\" for transactions would be much more flexible and easier to work with.",
      "created_at" : "2015-08-26T19:34:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-135147926",
      "id" : 135147926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-26T19:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/135147926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@luke-jr the goal is simplifying this special-cased code. Once we have a CPolicy interface and a -policy parameter to select alternative policies we will make it easier for miners to implement their own policies. But changing the default policy is in my opinion mostly neutral to policy modularization.\r\nIf you could point to the parts of the removed code are you worried about concretely, that would be helpful.\r\nIt is also worth noting that it is noncompetitive/irrational for miners to include free transactions in their blocks (there's a block relay costs to them but no gain in exchange).\r\n\r\n",
      "created_at" : "2015-08-26T20:57:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-135168425",
      "id" : 135168425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-26T20:57:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/135168425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "NACK\r\nFree transactions are social aspect of the bitcoin (even 0.00001 is a lot of money somewhere). In the future, they should be made optional. Miner fee can be paid offline, so you can't say it is irrational for them to include such transaction. Maybe it is a miner's own transaction...",
      "created_at" : "2015-08-27T05:57:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-135302676",
      "id" : 135302676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-27T05:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/135302676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@paveljanik this doesn't stop miners from accepting ~~free~~ 0 fee transactions.  This just makes the behaviour rational and based on the incentive,  rather than something that is difficult to reason about in terms of miner priority.",
      "created_at" : "2015-08-27T07:48:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-135325405",
      "id" : 135325405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-27T07:48:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/135325405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "It may be rational for miners to accept free txes if it decreases the UTXO set size.\r\n\r\nE.G. https://www.blocktrail.com/BTC/tx/9b933f6f811dcc920d35bc48876181da4b29282ad452bdeb7563cff7c6c09bf9",
      "created_at" : "2015-08-30T14:50:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-136151551",
      "id" : 136151551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-08-30T14:50:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/136151551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8398185?v=3",
         "events_url" : "https://api.github.com/users/chris-belcher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chris-belcher/followers",
         "following_url" : "https://api.github.com/users/chris-belcher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chris-belcher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chris-belcher",
         "id" : 8398185,
         "login" : "chris-belcher",
         "organizations_url" : "https://api.github.com/users/chris-belcher/orgs",
         "received_events_url" : "https://api.github.com/users/chris-belcher/received_events",
         "repos_url" : "https://api.github.com/users/chris-belcher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chris-belcher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chris-belcher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chris-belcher"
      }
   },
   {
      "body" : "NACK.  NACK.  I agree with @paveljanik et. al.",
      "created_at" : "2015-09-03T06:05:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-137345616",
      "id" : 137345616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-09-03T06:06:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137345616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4469280?v=3",
         "events_url" : "https://api.github.com/users/ABISprotocol/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ABISprotocol/followers",
         "following_url" : "https://api.github.com/users/ABISprotocol/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ABISprotocol/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ABISprotocol",
         "id" : 4469280,
         "login" : "ABISprotocol",
         "organizations_url" : "https://api.github.com/users/ABISprotocol/orgs",
         "received_events_url" : "https://api.github.com/users/ABISprotocol/received_events",
         "repos_url" : "https://api.github.com/users/ABISprotocol/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ABISprotocol/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ABISprotocol/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ABISprotocol"
      }
   },
   {
      "body" : "@paveljanik \r\n> Free transactions are social aspect of the bitcoin (even 0.00001 is a lot of money somewhere).\r\n\r\nFree transactions create the illusion that the system (currently heavily subsidized by seigniorage) is cheap when it is actually very costly. They will eventually disappear when miners start using competitive policies and in the meantime are creating false expectations and confusing users and entrepreneurs. One satoshi is currently 0.000002 usd. I believe that if minimum mined fees rise from 0 to 1 satoshi we're still fine when it comes to attracting adoption (but it would still be a huge step forwards in miners implementing competitive policies).\r\n\r\n> In the future, they should be made optional\r\n\r\nFees are already optional. The policy minimum relay fee is also configurable at run time: you can set it to zero if you want to.\r\n\r\n>  Miner fee can be paid offline, so you can't say it is irrational for them to include such transaction. \r\n\r\nMiner's can still implement their own policy, but offline fees are useless when it comes to DoS network protections (which is what the minimum relay fee is about).\r\nThey could even receive a fee in-chain and give it back offline (on whatever payment method they're using to settle with their customers).\r\n\r\n> Maybe it is a miner's own transaction...\r\n\r\nThey can pay fees to themselves (which is better for their privacy) or, again, implement their own policy.\r\nThe current code is not addressing any of those cases either.\r\n\r\n@chris-belcher That's a benefit for all miners, not just yourself (who are paying the cost). There should be an incentive to reduce/not-increase the utxo size built in the consensus rules (for example ```consensus_size(tx) = real_size(tx) + delta_to_the_utxo_size(tx)```).\r\n\r\nAnyway, since this seems to be controversial, I'm closing it. @jgarzik feel free to cherry pick from here if you still want to keep #6405 open (this one is rebased, passes travis tests and removes a little bit more code).\r\n\r\n@sipa \r\nIf I create a PR that instead of removing the code at least encapsulates it in a function (hopefully a method assuming #6068 gets merged this year) in the policy folder, will it have to wait for #6470 (or its current replacement) too?\r\nWhat if I remove the minRelayTxFee global (make it an attribute in CStandardPolicy) and implement a dynamic minRelayTxFee that uses the fee estimator at the same time?\r\n\r\nI can have the code ready relatively fast if there's interest in reviewing it and it's not going to be blocked by #6470.",
      "created_at" : "2015-09-03T18:56:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-137541896",
      "id" : 137541896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-09-03T18:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137541896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon Heh, I know we were just together, but I've been totally behind on PR's for the last couple weeks so didn't see this.  I just wanted to give my two cents that I'm now happy to rebase any of my existing mempool limiting PR's on top of policy changes.  During the rapid iteration to find a solution I felt like that was going to be a hindrance, but I think the work is far enough along now that it shouldn't hold up anything else.",
      "created_at" : "2015-09-15T02:19:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6584#issuecomment-140257612",
      "id" : 140257612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6584",
      "updated_at" : "2015-09-15T02:19:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/140257612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   }
]
