[
   {
      "body" : "I agree. IMO `UniValue::read` should only read the first top level object/array and if another object opens (`[` or `{`) (or garbage), it should abort the parsing and response with an error. This would be conform with the JSON standard.\r\n\r\nWould be nice if you could try to PR a fix for this (please also provide unit tests).",
      "created_at" : "2015-08-17T15:25:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-131860854",
      "id" : 131860854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-17T15:25:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/131860854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Yes, of course I will write the patch (as promised), including proper testing.\r\n\r\nI personally think that a recursive implementation of `UniValue::read` would be easier to read than the current one with explicit stack.  Is it ok if I try to rewrite it as I think it is best, or should I try to keep the changes to a minimum?  I. e., basically just change the stopping criterion of the loop while keeping the explicit stack?",
      "created_at" : "2015-08-17T16:15:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-131876669",
      "id" : 131876669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-17T16:15:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/131876669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4943644?v=3",
         "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
         "followers_url" : "https://api.github.com/users/domob1812/followers",
         "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
         "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/domob1812",
         "id" : 4943644,
         "login" : "domob1812",
         "organizations_url" : "https://api.github.com/users/domob1812/orgs",
         "received_events_url" : "https://api.github.com/users/domob1812/received_events",
         "repos_url" : "https://api.github.com/users/domob1812/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/domob1812"
      }
   },
   {
      "body" : "Why do we have our own JSON writer/parser anyway?\r\nWhy not just use https://github.com/nlohmann/json,  it is only a header?",
      "created_at" : "2015-08-18T01:03:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132011814",
      "id" : 132011814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-18T13:17:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132011814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "`UniValue` is a very flexible and lightweight JSON parser/encoder. We just moved from JSON Spirit to UniValue because it's more lightweight and reduces compile time.",
      "created_at" : "2015-08-18T07:28:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132101729",
      "id" : 132101729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-18T07:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132101729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@domob1812 I think keeping the changes at a minimum would be good. If you have a bigger changeset in mind, you might open a PR for that at the UniValue upstream (https://github.com/jgarzik/univalue).",
      "created_at" : "2015-08-18T07:32:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132102933",
      "id" : 132102933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-18T07:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132102933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Alright, was just a thought.  I'll submit a minimal PR for Bitcoin and will think about upstream patches later.",
      "created_at" : "2015-08-18T07:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132108848",
      "id" : 132108848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-18T07:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132108848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4943644?v=3",
         "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
         "followers_url" : "https://api.github.com/users/domob1812/followers",
         "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
         "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/domob1812",
         "id" : 4943644,
         "login" : "domob1812",
         "organizations_url" : "https://api.github.com/users/domob1812/orgs",
         "received_events_url" : "https://api.github.com/users/domob1812/received_events",
         "repos_url" : "https://api.github.com/users/domob1812/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/domob1812"
      }
   },
   {
      "body" : "Related:  PRs that sync upstream with latest Bitcoin Core appreciated...\r\n",
      "created_at" : "2015-08-18T13:48:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132213618",
      "id" : 132213618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-18T13:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132213618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@jgarzik: Is there some \"defined procedure\" for merging upstream patches for UniValue down to Bitcoin Core?  E. g., do you do that regularly or should all patches be submitted against both repositories?  If there is some procedure, I can very well submit my work to your repository first and have it \"flow down\" from there.",
      "created_at" : "2015-08-19T09:36:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132511484",
      "id" : 132511484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-19T09:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132511484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4943644?v=3",
         "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
         "followers_url" : "https://api.github.com/users/domob1812/followers",
         "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
         "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/domob1812",
         "id" : 4943644,
         "login" : "domob1812",
         "organizations_url" : "https://api.github.com/users/domob1812/orgs",
         "received_events_url" : "https://api.github.com/users/domob1812/received_events",
         "repos_url" : "https://api.github.com/users/domob1812/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/domob1812"
      }
   },
   {
      "body" : "@domob1812 No defined procedure.  Currently Bitcoin Core is ahead of \"upstream\", which needs to be remedied. ",
      "created_at" : "2015-08-19T12:17:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132570451",
      "id" : 132570451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-19T12:17:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132570451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@domob1812: one way could be to improve/fix in this repository with focus on a small diff. Once merged, open a PR upstream and sync bitcoins univalue with upstream. Then you could make more conceptual changes upstream, once it's stable, open a PR in this repository with the upstream changes.",
      "created_at" : "2015-08-20T07:10:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132914522",
      "id" : 132914522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-20T07:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132914522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Thanks for the input, this is actually what I have been thinking as well.  I'll do that.",
      "created_at" : "2015-08-20T07:13:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-132914898",
      "id" : 132914898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-20T07:13:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/132914898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4943644?v=3",
         "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
         "followers_url" : "https://api.github.com/users/domob1812/followers",
         "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
         "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/domob1812",
         "id" : 4943644,
         "login" : "domob1812",
         "organizations_url" : "https://api.github.com/users/domob1812/orgs",
         "received_events_url" : "https://api.github.com/users/domob1812/received_events",
         "repos_url" : "https://api.github.com/users/domob1812/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/domob1812"
      }
   },
   {
      "body" : "@Jeff after fixing and synchronizing upstream, we can maybe start treating\nunivalue as a subtree like leveldb and secp256k1? There are utility scripts\nnow to verify that the included code matches the specifies commit in the\nupstream repo etc.\n",
      "created_at" : "2015-08-20T15:05:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-133042872",
      "id" : 133042872,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-20T15:05:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/133042872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> I personally think that a recursive implementation of UniValue::read would be easier to read than the current one with explicit stack\r\n\r\nAn explicit stack is preferred here. Easier to keep bounds on memory usage (we could, for example, limit the max depth easily). Also: execution stacks can be shallow on some architectures especially those of threads.\r\n",
      "created_at" : "2015-08-21T09:00:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6558#issuecomment-133340489",
      "id" : 133340489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6558",
      "updated_at" : "2015-08-21T09:00:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/133340489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
