[
   {
      "author_association" : "MEMBER",
      "body" : "Can you explain why this is a \"bugfix\", considering that the API break was done on purpose at that time?",
      "created_at" : "2022-08-25T06:58:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1226855039",
      "id" : 1226855039,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JIFJ_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226855039/reactions"
      },
      "updated_at" : "2022-08-25T06:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226855039",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\n@MarcoFalke, a bug is a bug, even if it was done on purpose. @jnewbery can clarify here, but I do not think this was even purposeful. My guess is that this breakage was unwanted, but acceptable in order to get the refactor from #21160 done. It later required fixup attempts like https://github.com/bitcoin/bitcoin/pull/24691 and https://github.com/bitcoin/bitcoin/pull/25176.\r\n\r\nSo, what happened? The `relaytxes` and `minfeefilter` fields were always present, and documented as such, in the output of the `getpeerinfo` RPC. #21160 changed it so that they could sometimes be missing. I guess the issues (both for GUI and RPC) were neglected during the review with a comment like [will almost always be true, so this isn't a big issue](https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567395). Well, it turned out our own tool `bitcoin-cli` broke due to the missing but expected fields. Some user apps will break too (if we don't fix it in 24.0).\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/24691 documented the fields as optional, but that is not appropriate because in the previous version they were not-optional. When users wrote their apps they assumed the fields will always be present. I think the \"optional\" flag should only be added when a field is initially introduced. Adding it later is the same as dropping the field - it breaks the \"contract\" with the user that the field will be present.\r\n\r\nOn this PR: I think it is ok to display the values `relaytxes=false` and `minfeefilter=0` in those corner cases. This is what the code did before #21160. If this is stripped to the bare minimum needed for the fix, I think it will have higher chance of making it to 24.0",
      "created_at" : "2022-08-25T13:06:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1227233657",
      "id" : 1227233657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JJhl5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227233657/reactions"
      },
      "updated_at" : "2022-08-25T13:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227233657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> So, what happened? The relaytxes and minfeefilter fields were always present, and documented as such, in the output of the getpeerinfo RPC.\r\n\r\nThis isn't true. **None** of the fields in `getpeerinfo` were documented as always present until the 'optional' fields were explicitly documented in #22798. Prior to that PR, there was no explicit guarantee that any of the fields would be present.\r\n\r\nPR 22798 was opened _after_ #21160, then merged, and resulted in the silent conflict where the fields were not marked as optional. That could be caught by better testing of optional fields.\r\n\r\n> with a comment like \"will almost always be true, so this isn't a big issue\"\r\n\r\nStop misrepresenting other people's words. This was in response to a review comment about the GUI, not the RPC. You've also clipped the quote to misrepresent it further. Here's the full sentence: \"will almost always be true, so this isn't a big issue (if it was, then the other stats in nodeStateStats not being available would also be an issue).\" I stand by that - if it's a problem that one of the fields is not visible in the GUI for a very short window during peer connection, then it'd be a problem that the other fields like \"startingheight\" or \"minping\" are not present. It's clearly not a problem, since that's always been the case.\r\n\r\nAt the time of the comment, it was also totally consistent with the other fields that were optional but not marked as such, since #22798 had not yet been opened.\r\n\r\n> in the previous version they were not-optional. When users wrote their apps they assumed the fields will always be present. I think the \"optional\" flag should only be added when a field is initially introduced. Adding it later is the same as dropping the field - it breaks the \"contract\" with the user that the field will be present.\r\n\r\nAgain, this is false. The 'optional' documentation was added in #22798, which was only included in v0.23. Until then, there were many fields could be considered optional but not documented as such. Users writing apps that interacted with the field (including the bitcoin-cli netinfo app) should have made those apps tolerant to the fields not being present.\r\n\r\nAs can be seen in #22798, there were 10s of fields across many different RPCs that were 'optional' before being explicitly documented as such. Both the PR description and @vasild's comment make it sound like this was some nefarious intentional API break, or some egregious bug. It's neither.\r\n\r\nFrankly, it's utterly tedious to have to spend time rebutting false statements and misrepresentations made about PRs that were merged months ago. Unfortunately, this 'gotcha' attitude of trying to shame code authors seems to be becoming more common in this project. It's extremely harmful for productive collaboration, and is certainly not something I'd expect to see from someone putting themselves forward as a potential project maintainer.",
      "created_at" : "2022-08-25T14:49:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1227366243",
      "id" : 1227366243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JKB9j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227366243/reactions"
      },
      "updated_at" : "2022-08-25T14:49:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227366243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "My goodness, that's saddening to read. The only goal should be to improve Bitcoin. Let's please remember to assume good intentions, focus on the code and improving Bitcoin and leave the other stuff behind. Thank you!",
      "created_at" : "2022-08-25T16:15:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1227486023",
      "id" : 1227486023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JKfNH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227486023/reactions"
      },
      "updated_at" : "2022-08-25T16:15:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227486023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > So, what happened? The relaytxes and minfeefilter fields were always present, and documented as such, in the output of the getpeerinfo RPC.\r\n> \r\n> This isn't true. **None** of the fields in `getpeerinfo` were documented as always present until the 'optional' fields were explicitly documented in #22798. Prior to that PR, there was no explicit guarantee that any of the fields would be present.\r\n\r\nAlright, by \"documented\" I meant that since it is not documented as optional, then it must be mandatory, but I was not aware that optional fields were introduced later (#22798). Thanks for bringing it up. This changes the perspective here.\r\n\r\n> This was in response to a review comment about the GUI, not the RPC.\r\n\r\nIn the RPC case you referred to the GUI comment: [As above for the gui peer console](https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567367).\r\n\r\nAnyway, I was just trying to clarify the situation here, not misinterpret, gotcha or shame. I am having coronavirus and should probably not be at the computer today at all, upsetting people. Will be more careful with my wording in the future.\r\n\r\nThank you!",
      "created_at" : "2022-08-25T16:17:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1227488547",
      "id" : 1227488547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JKf0j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227488547/reactions"
      },
      "updated_at" : "2022-08-25T16:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227488547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK ",
      "created_at" : "2022-08-25T16:37:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1227509247",
      "id" : 1227509247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JKk3_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227509247/reactions"
      },
      "updated_at" : "2022-08-25T16:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227509247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(Am considering closing this draft and opening a new one. If there are any helpful, friendly suggestions in the interim to improve the change, that would be great âºï¸)",
      "created_at" : "2022-08-25T16:43:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1227514730",
      "id" : 1227514730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JKmNq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227514730/reactions"
      },
      "updated_at" : "2022-08-25T16:43:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1227514730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24170](https://github.com/bitcoin/bitcoin/pull/24170) (p2p, rpc: Manual block-relay-only connections with addnode by mzumsande)\n* [#10102](https://github.com/bitcoin/bitcoin/pull/10102) (Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-08-26T05:25:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1228067478",
      "id" : 1228067478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JMtKW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1228067478/reactions"
      },
      "updated_at" : "2022-09-09T16:29:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1228067478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r955740987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955740987"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think this change is more accurate. `relaytxes` is false only when either a peer explicitly requests tx relay to be disabled (via setting the `fRelay` flag added in BIP 37 to false), or when we decide that an outgoing connection should be block-relay-only, in which case we ignore any request from it to relay transactions. Saying \"whether we will relay txs with this peer\" might be more accurate though.",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-26T07:25:41Z",
      "diff_hunk" : "@@ -642,7 +642,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         \"  send     Time since last message sent to the peer, in seconds\\n\"\n         \"  recv     Time since last message received from the peer, in seconds\\n\"\n         \"  txn      Time since last novel transaction received from the peer and accepted into our mempool, in minutes\\n\"\n-        \"           \\\"*\\\" - the peer requested we not relay transactions to it (relaytxes is false)\\n\"\n+        \"           \\\"*\\\" - the peer did not request that we relay transactions to it (relaytxes is false)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r955740987",
      "id" : 955740987,
      "line" : 645,
      "node_id" : "PRRC_kwDOABII584493M7",
      "original_commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "original_line" : 645,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 1086526152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955740987/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T07:47:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955740987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r955744792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955744792"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`bitcoin-cli` could be being used with an older version of `bitcoind`, no? I think `get_bool` treats null as `false`, but I think `getInt` will throw. Probably not an issue if only unreleased versions of `bitcoind` treated these values as optional though.",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-26T07:30:00Z",
      "diff_hunk" : "@@ -478,7 +478,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n             const int8_t network_id{NetworkStringToId(network)};\n             if (network_id == UNKNOWN_NETWORK) continue;\n             const bool is_outbound{!peer[\"inbound\"].get_bool()};\n-            const bool is_tx_relay{peer[\"relaytxes\"].isNull() ? true : peer[\"relaytxes\"].get_bool()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r955744792",
      "id" : 955744792,
      "line" : 481,
      "node_id" : "PRRC_kwDOABII584494IY",
      "original_commit_id" : "068cd21e9242f2231a21c2394184207ce2da293a",
      "original_line" : 481,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 4,
      "pull_request_review_id" : 1086526152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955744792/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T07:47:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955744792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r955763613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955763613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think we support arbitrary version combinations of bitcoin-cli and the rpc server? The only official supported combination is the one where both are built from the exact same commit hash.",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-26T07:53:00Z",
      "diff_hunk" : "@@ -478,7 +478,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n             const int8_t network_id{NetworkStringToId(network)};\n             if (network_id == UNKNOWN_NETWORK) continue;\n             const bool is_outbound{!peer[\"inbound\"].get_bool()};\n-            const bool is_tx_relay{peer[\"relaytxes\"].isNull() ? true : peer[\"relaytxes\"].get_bool()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r955763613",
      "id" : 955763613,
      "in_reply_to_id" : 955744792,
      "line" : 481,
      "node_id" : "PRRC_kwDOABII584498ud",
      "original_commit_id" : "068cd21e9242f2231a21c2394184207ce2da293a",
      "original_line" : 481,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 4,
      "pull_request_review_id" : 1086558339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955763613/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T07:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955763613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r956495113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956495113"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Concept ACK to returning partial data rather than none at all.",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-26T23:21:07Z",
      "diff_hunk" : "@@ -1459,50 +1459,52 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.m_sync_height = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.m_common_height = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n-                stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            if (queue.pindex) {\n+                stats.m_height_in_flight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n-    stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        return stats;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r956495113",
      "id" : 956495113,
      "line" : 1485,
      "node_id" : "PRRC_kwDOABII5845AvUJ",
      "original_commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "original_line" : 1485,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 48,
      "pull_request_review_id" : 1087585618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956495113/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T23:22:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956495113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r956495436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956495436"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Concept NACK to displaying incorrect data when data is not available.",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-26T23:22:33Z",
      "diff_hunk" : "@@ -1192,31 +1193,15 @@ void RPCConsole::updateDetailWidget()\n         ui->peerPermissions->setText(permissions.join(\" & \"));\n     }\n     ui->peerMappedAS->setText(stats->nodeStats.m_mapped_as != 0 ? QString::number(stats->nodeStats.m_mapped_as) : ts.na);\n-\n-    // This check fails for example if the lock was busy and\n-    // nodeStateStats couldn't be fetched.\n-    if (stats->fNodeStateStatsAvailable) {\n-        ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.their_services));\n-        // Sync height is init to -1\n-        if (stats->nodeStateStats.nSyncHeight > -1) {\n-            ui->peerSyncHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nSyncHeight));\n-        } else {\n-            ui->peerSyncHeight->setText(ts.unknown);\n-        }\n-        // Common height is init to -1\n-        if (stats->nodeStateStats.nCommonHeight > -1) {\n-            ui->peerCommonHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nCommonHeight));\n-        } else {\n-            ui->peerCommonHeight->setText(ts.unknown);\n-        }\n-        ui->peerHeight->setText(QString::number(stats->nodeStateStats.m_starting_height));\n-        ui->peerPingWait->setText(GUIUtil::formatPingTime(stats->nodeStateStats.m_ping_wait));\n-        ui->peerAddrRelayEnabled->setText(stats->nodeStateStats.m_addr_relay_enabled ? ts.yes : ts.no);\n-        ui->peerAddrProcessed->setText(QString::number(stats->nodeStateStats.m_addr_processed));\n-        ui->peerAddrRateLimited->setText(QString::number(stats->nodeStateStats.m_addr_rate_limited));\n-        ui->peerRelayTxes->setText(stats->nodeStateStats.m_relay_txs ? ts.yes : ts.no);\n-    }\n-\n+    ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.m_services));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r956495436",
      "id" : 956495436,
      "line" : 1196,
      "node_id" : "PRRC_kwDOABII5845AvZM",
      "original_commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "original_line" : 1196,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 37,
      "pull_request_review_id" : 1087585618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956495436/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T23:22:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956495436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-30T16:34:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1231902914",
      "id" : 1231902914,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JbVjC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1231902914/reactions"
      },
      "updated_at" : "2022-08-30T16:34:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1231902914",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r958940815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958940815"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done for the GUI\r\n```diff\r\n--- a/src/qt/guiutil.cpp\r\n+++ b/src/qt/guiutil.cpp\r\n@@ -748,7 +748,7 @@ QString formatServicesStr(quint64 mask)\r\n     if (strList.size())\r\n         return strList.join(\", \");\r\n     else\r\n-        return QObject::tr(\"None\");\r\n+        return QObject::tr(\"Unknown\");\r\n }\r\n```\r\nand left (for now) the RPC getpeerinfo behavior as it is currently, i.e. unchanged\r\n```\r\n    \"services\": \"0000000000000000\",\r\n    \"servicesnames\": [\r\n    ],\r\n```\r\n",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-30T21:22:23Z",
      "diff_hunk" : "@@ -1192,31 +1193,15 @@ void RPCConsole::updateDetailWidget()\n         ui->peerPermissions->setText(permissions.join(\" & \"));\n     }\n     ui->peerMappedAS->setText(stats->nodeStats.m_mapped_as != 0 ? QString::number(stats->nodeStats.m_mapped_as) : ts.na);\n-\n-    // This check fails for example if the lock was busy and\n-    // nodeStateStats couldn't be fetched.\n-    if (stats->fNodeStateStatsAvailable) {\n-        ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.their_services));\n-        // Sync height is init to -1\n-        if (stats->nodeStateStats.nSyncHeight > -1) {\n-            ui->peerSyncHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nSyncHeight));\n-        } else {\n-            ui->peerSyncHeight->setText(ts.unknown);\n-        }\n-        // Common height is init to -1\n-        if (stats->nodeStateStats.nCommonHeight > -1) {\n-            ui->peerCommonHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nCommonHeight));\n-        } else {\n-            ui->peerCommonHeight->setText(ts.unknown);\n-        }\n-        ui->peerHeight->setText(QString::number(stats->nodeStateStats.m_starting_height));\n-        ui->peerPingWait->setText(GUIUtil::formatPingTime(stats->nodeStateStats.m_ping_wait));\n-        ui->peerAddrRelayEnabled->setText(stats->nodeStateStats.m_addr_relay_enabled ? ts.yes : ts.no);\n-        ui->peerAddrProcessed->setText(QString::number(stats->nodeStateStats.m_addr_processed));\n-        ui->peerAddrRateLimited->setText(QString::number(stats->nodeStateStats.m_addr_rate_limited));\n-        ui->peerRelayTxes->setText(stats->nodeStateStats.m_relay_txs ? ts.yes : ts.no);\n-    }\n-\n+    ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.m_services));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r958940815",
      "id" : 958940815,
      "in_reply_to_id" : 956495436,
      "line" : 1196,
      "node_id" : "PRRC_kwDOABII5845KEaP",
      "original_commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "original_line" : 1196,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 37,
      "pull_request_review_id" : 1090982625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958940815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T21:22:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958940815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r958944869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958944869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, for the moment the newly frequently missing fields are not in a release.\r\n\r\n`get_bool` and `getInt` both throw on null with `error: JSON value of type null is not of expected type {bool|number}`, which can be seen with a snippet like this added to a CLI or RPC.\r\n\r\n```cpp\r\nconst UniValue x = UniValue();\r\nassert (x.isNull());\r\n// auto y = x.get_bool();        // uncomment to throw\r\n// auto z = x.getInt<int64_t>(); // uncomment to throw\r\n```\r\n",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-30T21:27:40Z",
      "diff_hunk" : "@@ -478,7 +478,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n             const int8_t network_id{NetworkStringToId(network)};\n             if (network_id == UNKNOWN_NETWORK) continue;\n             const bool is_outbound{!peer[\"inbound\"].get_bool()};\n-            const bool is_tx_relay{peer[\"relaytxes\"].isNull() ? true : peer[\"relaytxes\"].get_bool()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r958944869",
      "id" : 958944869,
      "in_reply_to_id" : 955744792,
      "line" : 481,
      "node_id" : "PRRC_kwDOABII5845KFZl",
      "original_commit_id" : "068cd21e9242f2231a21c2394184207ce2da293a",
      "original_line" : 481,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 4,
      "pull_request_review_id" : 1090988551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958944869/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T21:27:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958944869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r958947015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958947015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, \"whether we relay transactions to this peer\" SGTM.",
      "commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "created_at" : "2022-08-30T21:30:26Z",
      "diff_hunk" : "@@ -642,7 +642,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         \"  send     Time since last message sent to the peer, in seconds\\n\"\n         \"  recv     Time since last message received from the peer, in seconds\\n\"\n         \"  txn      Time since last novel transaction received from the peer and accepted into our mempool, in minutes\\n\"\n-        \"           \\\"*\\\" - the peer requested we not relay transactions to it (relaytxes is false)\\n\"\n+        \"           \\\"*\\\" - the peer did not request that we relay transactions to it (relaytxes is false)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r958947015",
      "id" : 958947015,
      "in_reply_to_id" : 955740987,
      "line" : 645,
      "node_id" : "PRRC_kwDOABII5845KF7H",
      "original_commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "original_line" : 645,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 1090991135,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958947015/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T21:31:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958947015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r959438503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959438503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated both the getpeerinfo and the -netinfo help docs.",
      "commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "created_at" : "2022-08-31T10:48:19Z",
      "diff_hunk" : "@@ -642,7 +642,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         \"  send     Time since last message sent to the peer, in seconds\\n\"\n         \"  recv     Time since last message received from the peer, in seconds\\n\"\n         \"  txn      Time since last novel transaction received from the peer and accepted into our mempool, in minutes\\n\"\n-        \"           \\\"*\\\" - the peer requested we not relay transactions to it (relaytxes is false)\\n\"\n+        \"           \\\"*\\\" - the peer did not request that we relay transactions to it (relaytxes is false)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r959438503",
      "id" : 959438503,
      "in_reply_to_id" : 955740987,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845L96n",
      "original_commit_id" : "7ee6f766530129a79aba2b0738db2c9e4ae64e56",
      "original_line" : 645,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 1091678829,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959438503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-31T10:48:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959438503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and updated to take review feedback by @ajtowns and @luke-jr and for the merge of #25717, maintaining the tristate `presynced_headers` behavior. The Clang-tidy CI errors are unrelated (https://github.com/bitcoin/bitcoin/pull/25963 should fix the Clang tidy one).\r\n\r\nThanks for the input, everyone. I'm agnostic to how we describe this change, as can be seen in the PR title and description history. I've re-updated both.  I agree with evaluating each field on a case-by-case basis and it's what I've tried to do.\r\n\r\nHistory:\r\n- the getpeerinfo rpc was added in 2012 in 1006f0707e34f8903f247195dabd86243ae61f05 by Jeff Garzik\r\n- the `relaytxes` field was added to getpeerinfo in 2015 in 08843ed99843078 by Peter Todd\r\n- the `minfeefilter` field was added to getpeerinfo in 2018 in 5778bf95d94f4d1 by @ajtowns  \r\n\r\nBefore adding the \"optional\" mentions to the RPC help docs, I believe we would often mention that fields were optional in the description, see 5ba829e12e99f11 for an example.\r\n\r\nIIUC the only behavior change here where there may be varying opinions is to keep `relaytxes` always present.\r\n\r\nMy thinking is that this is the 8th year it has always been present, e.g. in a majority of our releases (~15) until now. That long-established behavior is a contract I would prefer to maintain, absent a compelling reason not to do so, in which case it might be good to warn our user space about the change in a release note.\r\n\r\nIt is true that both (a) the `getpeerinfo` fields order fixup and (b) keeping `relaytxes` and `minfeefilter` always present could be done separately for v24 with a small patch in `src/rpc/net.cpp` rather than in this larger change. \r\n\r\nRegarding these last two points, I'll leave it to reviewers to weigh in on which way to go.",
      "created_at" : "2022-08-31T11:42:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1232825663",
      "id" : 1232825663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585Je20_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1232825663/reactions"
      },
      "updated_at" : "2022-08-31T11:42:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1232825663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Before adding the \"optional\" mentions to the RPC help docs, I believe we would often mention that fields were optional in the description, see https://github.com/bitcoin/bitcoin/commit/5ba829e12e99f119df56cab422f827b9be03fe57 for an example.\r\n\r\nYou're linking to documentation that *you* added to a single RPC. By comparison look at #22798, which adds over 120 optional type arguments to existing rpcs. A large majority of \"optional\" type arguments were not documented as such until September 2021/v0.23. The optional type itself was not added until #17809 in 2020, many years after these return fields were included in the RPC (and not documented as optional).\r\n\r\n> That long-established behavior is a contract\r\n\r\nNo. If it's not documented, it's not a contract. Anyone writing clients using the RPC interface would have needed to make the clients accepting of fields being missing, since that's always been possible for a large number of the results fields in a large number of the RPCs.\r\n\r\nI agree with Marco that it makes sense for some fields to be non-optional, so some of the changes here some beneficial, but please stick to the facts in describing this change.",
      "created_at" : "2022-08-31T12:27:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1232871370",
      "id" : 1232871370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JfB_K",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1232871370/reactions"
      },
      "updated_at" : "2022-08-31T12:27:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1232871370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @jnewbery. I'm agnostic to what word is used to describe the 8 years of `relaytxes` behavior. I think the question is whether reflecting that the peer's behavior is still being set up is a sufficient reason to change it for v24. When in doubt I would maintain the long-standing behavior but ok to update depending on consensus.",
      "created_at" : "2022-08-31T12:49:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1232895163",
      "id" : 1232895163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JfHy7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1232895163/reactions"
      },
      "updated_at" : "2022-08-31T12:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1232895163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r959584173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959584173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in cdad951abf73650a9b49dd038ecbcc96ebf9bc0f: I think the doxygen for `m_relay_txs` should also be updated for the same reason. Otherwise it is not clear why you are changing this.",
      "commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "created_at" : "2022-08-31T13:25:56Z",
      "diff_hunk" : "@@ -114,7 +114,7 @@ static RPCHelpMan getpeerinfo()\n                     {\n                         {RPCResult::Type::STR, \"SERVICE_NAME\", \"the service name if it is recognised\"}\n                     }},\n-                    {RPCResult::Type::BOOL, \"relaytxes\", /*optional=*/true, \"Whether peer has asked us to relay transactions to it\"},\n+                    {RPCResult::Type::BOOL, \"relaytxes\", \"Whether we relay transactions to this peer\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r959584173",
      "id" : 959584173,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII5845Mhet",
      "original_commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "original_line" : 117,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1091882985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959584173/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-31T13:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959584173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> * maintain `getpeerinfo` API stability by continuing to provide the `relaytxes` and `minfeefilter` fields that have always been present since 2015 and 2018, respectively, and do so with the same default values\r\n\r\nFWIW, I think you'd be better off justifying this on its own terms regardless of recent/ancient historical behaviour.\r\n\r\nI think `relaytxes: false` meaning \"we currently won't relay txs to/from this peer\" is clear, even if that might change after version negotiation. I could see `-1` or `CAmount::max()` being better defaults for `minfeefilter` if relaying isn't happening though, since that way you could interpret it correctly without needing to also look at `relaytxes`...",
      "created_at" : "2022-08-31T15:12:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1233070570",
      "id" : 1233070570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585Jfynq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1233070570/reactions"
      },
      "updated_at" : "2022-08-31T15:12:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1233070570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r959750704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959750704"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, done.",
      "commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "created_at" : "2022-08-31T15:47:53Z",
      "diff_hunk" : "@@ -114,7 +114,7 @@ static RPCHelpMan getpeerinfo()\n                     {\n                         {RPCResult::Type::STR, \"SERVICE_NAME\", \"the service name if it is recognised\"}\n                     }},\n-                    {RPCResult::Type::BOOL, \"relaytxes\", /*optional=*/true, \"Whether peer has asked us to relay transactions to it\"},\n+                    {RPCResult::Type::BOOL, \"relaytxes\", \"Whether we relay transactions to this peer\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r959750704",
      "id" : 959750704,
      "in_reply_to_id" : 959584173,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII5845NKIw",
      "original_commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "original_line" : 117,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1092120809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959750704/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-31T15:47:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/959750704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960312397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960312397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> done\r\n\r\nNo?",
      "commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "created_at" : "2022-09-01T07:31:11Z",
      "diff_hunk" : "@@ -114,7 +114,7 @@ static RPCHelpMan getpeerinfo()\n                     {\n                         {RPCResult::Type::STR, \"SERVICE_NAME\", \"the service name if it is recognised\"}\n                     }},\n-                    {RPCResult::Type::BOOL, \"relaytxes\", /*optional=*/true, \"Whether peer has asked us to relay transactions to it\"},\n+                    {RPCResult::Type::BOOL, \"relaytxes\", \"Whether we relay transactions to this peer\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960312397",
      "id" : 960312397,
      "in_reply_to_id" : 959584173,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII5845PTRN",
      "original_commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "original_line" : 117,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1092901754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960312397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-01T07:31:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960312397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960457580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960457580"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, pushed",
      "commit_id" : "9cd2fde53d040ad4232cc5458205ad32fb0dae12",
      "created_at" : "2022-09-01T09:59:41Z",
      "diff_hunk" : "@@ -114,7 +114,7 @@ static RPCHelpMan getpeerinfo()\n                     {\n                         {RPCResult::Type::STR, \"SERVICE_NAME\", \"the service name if it is recognised\"}\n                     }},\n-                    {RPCResult::Type::BOOL, \"relaytxes\", /*optional=*/true, \"Whether peer has asked us to relay transactions to it\"},\n+                    {RPCResult::Type::BOOL, \"relaytxes\", \"Whether we relay transactions to this peer\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960457580",
      "id" : 960457580,
      "in_reply_to_id" : 959584173,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845P2ts",
      "original_commit_id" : "cdad951abf73650a9b49dd038ecbcc96ebf9bc0f",
      "original_line" : 117,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1093110069,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960457580/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-01T09:59:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960457580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960463221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960463221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> `bitcoin-cli` could be being used with an older version of `bitcoind`, no?\r\n\r\nCircling back to this, as I have heard in the past from people using a recent -netinfo with nodes that have been up since an earlier release. Updated the minimum server check in -netinfo from v21 to v22, the last version that should be backward compatible (due to bitcoin core adding the addr_* fields in v22 used in -netinfo) and kept the null checks to maintain backward compatibility.",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-01T10:05:53Z",
      "diff_hunk" : "@@ -478,7 +478,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n             const int8_t network_id{NetworkStringToId(network)};\n             if (network_id == UNKNOWN_NETWORK) continue;\n             const bool is_outbound{!peer[\"inbound\"].get_bool()};\n-            const bool is_tx_relay{peer[\"relaytxes\"].isNull() ? true : peer[\"relaytxes\"].get_bool()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960463221",
      "id" : 960463221,
      "in_reply_to_id" : 955744792,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845P4F1",
      "original_commit_id" : "068cd21e9242f2231a21c2394184207ce2da293a",
      "original_line" : 481,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 1093118164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960463221/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-02T22:21:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960463221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased for the CI fixes and updated per @MarcoFalke and @ajtowns feedback (thanks).\r\n\r\n> FWIW, I think you'd be better off justifying this on its own terms regardless of recent/ancient historical behaviour.\r\n\r\nUpdated the pull title/description and the commit messages. \r\n\r\n> I think `relaytxes: false` meaning \"we currently won't relay txs to/from this peer\" is clear, even if that might change after version negotiation. I could see `-1` or `CAmount::max()` being better defaults for `minfeefilter` if relaying isn't happening though, since that way you could interpret it correctly without needing to also look at `relaytxes`...\r\n\r\nMakes sense, could see a -1 minfeefilter default for the reason you gave. Unsure with respect to API stability so deferring for a follow-up unless there is a preference that it be done here.\r\n",
      "created_at" : "2022-09-01T10:16:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1234066766",
      "id" : 1234066766,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585Jjl1O",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1234066766/reactions"
      },
      "updated_at" : "2022-09-01T10:16:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1234066766",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960923852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960923852"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Couldn't we change this function to return `NodeStats` instead of `bool`. Seems odd the first thing we do here is `clear` the `stats`. ",
      "commit_id" : "9cd2fde53d040ad4232cc5458205ad32fb0dae12",
      "created_at" : "2022-09-01T17:27:33Z",
      "diff_hunk" : "@@ -168,29 +168,25 @@ class NodeImpl : public Node\n     bool getNodesStats(NodesStats& stats) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960923852",
      "id" : 960923852,
      "line" : 168,
      "node_id" : "PRRC_kwDOABII5845RojM",
      "original_commit_id" : "f9fb72e07ee53d5148e27bd6503806235e533afe",
      "original_line" : 168,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 1,
      "pull_request_review_id" : 1093800561,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960923852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-01T17:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960923852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960972970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960972970"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good observation! Done.",
      "commit_id" : "9117a56f9b2b60cbcb4f378117574ae4ffbb8179",
      "created_at" : "2022-09-01T18:19:47Z",
      "diff_hunk" : "@@ -168,29 +168,25 @@ class NodeImpl : public Node\n     bool getNodesStats(NodesStats& stats) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r960972970",
      "id" : 960972970,
      "in_reply_to_id" : 960923852,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845R0iq",
      "original_commit_id" : "f9fb72e07ee53d5148e27bd6503806235e533afe",
      "original_line" : 168,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 1093866236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960972970/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-01T18:19:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/960972970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-09-02T09:51:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1235300878",
      "id" : 1235300878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JoTIO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235300878/reactions"
      },
      "updated_at" : "2022-09-02T09:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235300878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and ready for review.",
      "created_at" : "2022-09-02T11:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1235376689",
      "id" : 1235376689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585Jolox",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235376689/reactions"
      },
      "updated_at" : "2022-09-02T11:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235376689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I will halt a thorough code review for now while it seems like there is a non-trivial high-level (\"concept\") discussion of the subject.\r\nThis probably also means we should not rush it into the immediate release. There is certainly a risk of breaking some software, but the risks of merging something poor now could be worse (the amount of code here is non-trivial too).\r\n\r\nAs for my personal high-level opinion, I'm not yet convinced following the former behavior (\"bugfix\") is preferential (especially while not everyone argees it is a bugfix).\r\n\r\nPlease consider this my humble opinion as I haven't reviewed the history of these changes as close as other devs in the PR.",
      "created_at" : "2022-09-06T09:42:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1237916164",
      "id" : 1237916164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585JyRoE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1237916164/reactions"
      },
      "updated_at" : "2022-09-06T09:42:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1237916164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963649209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963649209"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`m_presync_height` is `std::optional` but here we unconditionally assign a value to it and also use the dummy `-1`. Maybe revert this hunk?",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-06T12:33:21Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.m_sync_height = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.m_common_height = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n-                stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            if (queue.pindex) {\n+                stats.m_height_in_flight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n-    stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        return stats;\n+    }\n+    stats.m_services = peer->m_their_services;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }\n-\n     if (auto tx_relay = peer->GetTxRelay(); tx_relay != nullptr) {\n         stats.m_relay_txs = WITH_LOCK(tx_relay->m_bloom_filter_mutex, return tx_relay->m_relay_txs);\n         stats.m_fee_filter_received = tx_relay->m_fee_filter_received.load();\n-    } else {\n-        stats.m_relay_txs = false;\n-        stats.m_fee_filter_received = 0;\n     }\n-\n-    stats.m_ping_wait = ping_wait;\n     stats.m_addr_processed = peer->m_addr_processed.load();\n     stats.m_addr_rate_limited = peer->m_addr_rate_limited.load();\n     stats.m_addr_relay_enabled = peer->m_addr_relay_enabled.load();\n     {\n         LOCK(peer->m_headers_sync_mutex);\n-        if (peer->m_headers_sync) {\n-            stats.presync_height = peer->m_headers_sync->GetPresyncHeight();\n-        }\n+        stats.m_presync_height = peer->m_headers_sync ? peer->m_headers_sync->GetPresyncHeight() : -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963649209",
      "id" : 963649209,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII5845cB65",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1599,
      "original_position" : 104,
      "original_start_line" : 1593,
      "path" : "src/net_processing.cpp",
      "position" : 104,
      "pull_request_review_id" : 1097503013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963649209/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1593,
      "start_side" : "LEFT",
      "updated_at" : "2022-09-06T13:41:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963649209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963656857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963656857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If we don't assign to `m_ping_wait` here it would remain the default-constructed `0Âµs`. Is it not better to change it to be `std::optional` and avoid the dummy default? That is, if we never sent a ping, the ping wait metric is meaningless. Also, the dummy value of `0` could in theory, I guess, overlap with a real value.",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-06T12:40:50Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.m_sync_height = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.m_common_height = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n-                stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            if (queue.pindex) {\n+                stats.m_height_in_flight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n-    stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        return stats;\n+    }\n+    stats.m_services = peer->m_their_services;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963656857",
      "id" : 963656857,
      "line" : 1589,
      "node_id" : "PRRC_kwDOABII5845cDyZ",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1589,
      "original_position" : 85,
      "original_start_line" : 1587,
      "path" : "src/net_processing.cpp",
      "position" : 85,
      "pull_request_review_id" : 1097503013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963656857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1587,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-06T13:41:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963656857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963680465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963680465"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am not sure about this change. If we are here, then `mask` is `0` aka `ServiceFlags::NODE_NONE`. Does not \"None\" describe it better?",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-06T13:02:35Z",
      "diff_hunk" : "@@ -748,7 +748,7 @@ QString formatServicesStr(quint64 mask)\n     if (strList.size())\n         return strList.join(\", \");\n     else\n-        return QObject::tr(\"None\");\n+        return QObject::tr(\"Unknown\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963680465",
      "id" : 963680465,
      "line" : 751,
      "node_id" : "PRRC_kwDOABII5845cJjR",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 751,
      "original_position" : 5,
      "original_start_line" : 751,
      "path" : "src/qt/guiutil.cpp",
      "position" : 5,
      "pull_request_review_id" : 1097503013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963680465/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 751,
      "start_side" : "LEFT",
      "updated_at" : "2022-09-06T13:41:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963680465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963695601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963695601"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What about making `stats->nodeStateStats.m_services` `std::optional` and here do `x.has_value() ? ... : \"Unknown\")`? Otherwise we seem to be abusing a real value `NODE_NONE` (no services) as a dummy \"we don't know/has no value\".",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-06T13:16:18Z",
      "diff_hunk" : "@@ -1192,31 +1193,15 @@ void RPCConsole::updateDetailWidget()\n         ui->peerPermissions->setText(permissions.join(\" & \"));\n     }\n     ui->peerMappedAS->setText(stats->nodeStats.m_mapped_as != 0 ? QString::number(stats->nodeStats.m_mapped_as) : ts.na);\n-\n-    // This check fails for example if the lock was busy and\n-    // nodeStateStats couldn't be fetched.\n-    if (stats->fNodeStateStatsAvailable) {\n-        ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.their_services));\n-        // Sync height is init to -1\n-        if (stats->nodeStateStats.nSyncHeight > -1) {\n-            ui->peerSyncHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nSyncHeight));\n-        } else {\n-            ui->peerSyncHeight->setText(ts.unknown);\n-        }\n-        // Common height is init to -1\n-        if (stats->nodeStateStats.nCommonHeight > -1) {\n-            ui->peerCommonHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nCommonHeight));\n-        } else {\n-            ui->peerCommonHeight->setText(ts.unknown);\n-        }\n-        ui->peerHeight->setText(QString::number(stats->nodeStateStats.m_starting_height));\n-        ui->peerPingWait->setText(GUIUtil::formatPingTime(stats->nodeStateStats.m_ping_wait));\n-        ui->peerAddrRelayEnabled->setText(stats->nodeStateStats.m_addr_relay_enabled ? ts.yes : ts.no);\n-        ui->peerAddrProcessed->setText(QString::number(stats->nodeStateStats.m_addr_processed));\n-        ui->peerAddrRateLimited->setText(QString::number(stats->nodeStateStats.m_addr_rate_limited));\n-        ui->peerRelayTxes->setText(stats->nodeStateStats.m_relay_txs ? ts.yes : ts.no);\n-    }\n-\n+    ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.m_services));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963695601",
      "id" : 963695601,
      "line" : 1196,
      "node_id" : "PRRC_kwDOABII5845cNPx",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1196,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 37,
      "pull_request_review_id" : 1097503013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963695601/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-06T13:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963695601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963722500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963722500"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe this is ok, but somehow this feels wrong - in this case we have no stats at all. We return a `CNodeStateStats` object that has some fields `std::optional` without a value which is ok, but the other fields are not optional and have actual value, implying they are actual real stats, not dummies aka \"no value/we don't know\".\r\n\r\nMaybe change all fields to `std::optional` or return `std::optional<CNodeStateStats>` from here? ~~Same in `getNodeStats()` if connman is missing.~~ Edit: then it would return empty vector which is ok.",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-06T13:39:46Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963722500",
      "id" : 963722500,
      "line" : 1559,
      "node_id" : "PRRC_kwDOABII5845cT0E",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1559,
      "original_position" : 46,
      "original_start_line" : 1554,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 1097503013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963722500/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1554,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-06T15:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963722500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968143646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968143646"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this branch maintains the current behavior for this field (correct me if I'm wrong), as it was member-initialized to -1 in the CNodeStateStats struct but only returned in the RPC if the peer was set up.",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-12T08:43:51Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.m_sync_height = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.m_common_height = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n-                stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            if (queue.pindex) {\n+                stats.m_height_in_flight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n-    stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        return stats;\n+    }\n+    stats.m_services = peer->m_their_services;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }\n-\n     if (auto tx_relay = peer->GetTxRelay(); tx_relay != nullptr) {\n         stats.m_relay_txs = WITH_LOCK(tx_relay->m_bloom_filter_mutex, return tx_relay->m_relay_txs);\n         stats.m_fee_filter_received = tx_relay->m_fee_filter_received.load();\n-    } else {\n-        stats.m_relay_txs = false;\n-        stats.m_fee_filter_received = 0;\n     }\n-\n-    stats.m_ping_wait = ping_wait;\n     stats.m_addr_processed = peer->m_addr_processed.load();\n     stats.m_addr_rate_limited = peer->m_addr_rate_limited.load();\n     stats.m_addr_relay_enabled = peer->m_addr_relay_enabled.load();\n     {\n         LOCK(peer->m_headers_sync_mutex);\n-        if (peer->m_headers_sync) {\n-            stats.presync_height = peer->m_headers_sync->GetPresyncHeight();\n-        }\n+        stats.m_presync_height = peer->m_headers_sync ? peer->m_headers_sync->GetPresyncHeight() : -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968143646",
      "id" : 968143646,
      "in_reply_to_id" : 963649209,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII5845tLMe",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1599,
      "original_position" : 104,
      "original_start_line" : 1593,
      "path" : "src/net_processing.cpp",
      "position" : 104,
      "pull_request_review_id" : 1103703357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968143646/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1593,
      "start_side" : "LEFT",
      "updated_at" : "2022-09-12T08:43:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968143646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968150669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968150669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "SGTM, done",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-12T08:50:44Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.m_sync_height = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.m_common_height = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n-                stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            if (queue.pindex) {\n+                stats.m_height_in_flight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n-    stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        return stats;\n+    }\n+    stats.m_services = peer->m_their_services;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968150669",
      "id" : 968150669,
      "in_reply_to_id" : 963656857,
      "line" : 1589,
      "node_id" : "PRRC_kwDOABII5845tM6N",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1589,
      "original_position" : 85,
      "original_start_line" : 1587,
      "path" : "src/net_processing.cpp",
      "position" : 85,
      "pull_request_review_id" : 1103713165,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968150669/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1587,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-12T10:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968150669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968283971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968283971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-12T11:10:39Z",
      "diff_hunk" : "@@ -1192,31 +1193,15 @@ void RPCConsole::updateDetailWidget()\n         ui->peerPermissions->setText(permissions.join(\" & \"));\n     }\n     ui->peerMappedAS->setText(stats->nodeStats.m_mapped_as != 0 ? QString::number(stats->nodeStats.m_mapped_as) : ts.na);\n-\n-    // This check fails for example if the lock was busy and\n-    // nodeStateStats couldn't be fetched.\n-    if (stats->fNodeStateStatsAvailable) {\n-        ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.their_services));\n-        // Sync height is init to -1\n-        if (stats->nodeStateStats.nSyncHeight > -1) {\n-            ui->peerSyncHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nSyncHeight));\n-        } else {\n-            ui->peerSyncHeight->setText(ts.unknown);\n-        }\n-        // Common height is init to -1\n-        if (stats->nodeStateStats.nCommonHeight > -1) {\n-            ui->peerCommonHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nCommonHeight));\n-        } else {\n-            ui->peerCommonHeight->setText(ts.unknown);\n-        }\n-        ui->peerHeight->setText(QString::number(stats->nodeStateStats.m_starting_height));\n-        ui->peerPingWait->setText(GUIUtil::formatPingTime(stats->nodeStateStats.m_ping_wait));\n-        ui->peerAddrRelayEnabled->setText(stats->nodeStateStats.m_addr_relay_enabled ? ts.yes : ts.no);\n-        ui->peerAddrProcessed->setText(QString::number(stats->nodeStateStats.m_addr_processed));\n-        ui->peerAddrRateLimited->setText(QString::number(stats->nodeStateStats.m_addr_rate_limited));\n-        ui->peerRelayTxes->setText(stats->nodeStateStats.m_relay_txs ? ts.yes : ts.no);\n-    }\n-\n+    ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.m_services));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968283971",
      "id" : 968283971,
      "in_reply_to_id" : 963695601,
      "line" : 1196,
      "node_id" : "PRRC_kwDOABII5845ttdD",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1196,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 37,
      "pull_request_review_id" : 1103902495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968283971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-12T11:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968283971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968286218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968286218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, back to \"None\" here and using \"Unknown\" in `src/qt/rpcconsole.cpp` per https://github.com/bitcoin/bitcoin/pull/25923#discussion_r963695601, and which continues to satisfy https://github.com/bitcoin/bitcoin/pull/25923#discussion_r956495436.",
      "commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "created_at" : "2022-09-12T11:12:58Z",
      "diff_hunk" : "@@ -748,7 +748,7 @@ QString formatServicesStr(quint64 mask)\n     if (strList.size())\n         return strList.join(\", \");\n     else\n-        return QObject::tr(\"None\");\n+        return QObject::tr(\"Unknown\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r968286218",
      "id" : 968286218,
      "in_reply_to_id" : 963680465,
      "line" : 751,
      "node_id" : "PRRC_kwDOABII5845tuAK",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 751,
      "original_position" : 5,
      "original_start_line" : 751,
      "path" : "src/qt/guiutil.cpp",
      "position" : 5,
      "pull_request_review_id" : 1103905674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968286218/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 751,
      "start_side" : "LEFT",
      "updated_at" : "2022-09-12T11:12:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968286218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r970561581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970561581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added an explanatory comment. The idea is to return sensible defaults where it makes sense and simplifies the code (both ours and that of API clients). For instance, the \"addr_processed\" and \"addr_rate_limited\" fields are member-initialized to 0 and may as well be returned during set up, as the peer has processed and limited no addresses yet. Likewise, returning an \"inflight\" field with an empty array seems just as logical and makes life simpler for us and for clients, than sometimes not returning the field in the RPC response. For \"pingwait\" we are only interested in non-zero values so a default of zero makes sense, and so on. Can update if reviewers disagree.",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-14T09:34:21Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r970561581",
      "id" : 970561581,
      "in_reply_to_id" : 963722500,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58452Zgt",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1561,
      "original_position" : 46,
      "original_start_line" : 1554,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1107131456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970561581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-14T15:56:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970561581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you for the review @vasild! I've hopefully addressed your feedback.\r\n\r\n> I find it confusing to have `NodesStats`, `CNodeStats`, `CNodeStateStats` and `CNodeCombinedStats` ... would alleviate it a bit?\r\n\r\nRemoved `NodesStats`.",
      "created_at" : "2022-09-14T09:42:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1246507210",
      "id" : 1246507210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585KTDDK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246507210/reactions"
      },
      "updated_at" : "2022-09-14T09:50:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246507210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "p2p_ping is now failing:\r\n```bash\r\n222/251 - p2p_ping.py failed, Duration: 1 s\r\nstdout:\r\n2022-09-14T10:06:23.895000Z TestFramework (INFO): Initializing test directory /tmp/cirrus-ci-build/ci/scratch/test_runner/test_runner_â¿_ð_20220914_095106/p2p_ping_26\r\n2022-09-14T10:06:24.156000Z TestFramework (INFO): Check that ping is sent after connection is established\r\n2022-09-14T10:06:24.262000Z TestFramework (INFO): Reply without nonce cancels ping\r\n2022-09-14T10:06:24.315000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 133, in main\r\n    self.run_test()\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/p2p_ping.py\", line 67, in run_test\r\n    self.check_peer_info(pingtime=None, minping=None, pingwait=None)\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/p2p_ping.py\", line 48, in check_peer_info\r\n    assert_equal(stats.pop('pingwait', None), pingwait)\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/util.py\", line 56, in assert_equal\r\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\nAssertionError: not(0 == None)\r\n```",
      "created_at" : "2022-09-14T10:08:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1246537226",
      "id" : 1246537226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585KTKYK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246537226/reactions"
      },
      "updated_at" : "2022-09-14T10:08:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246537226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you for reviewing @brunoerg and @vasild! Diff since your reviews: `git diff 4b10c63 b5255ca`\r\n\r\n> p2p_ping is now failing\r\n\r\nIndeed, fixed.",
      "created_at" : "2022-09-14T11:24:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1246623917",
      "id" : 1246623917,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585KTfit",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246623917/reactions"
      },
      "updated_at" : "2022-09-14T15:50:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246623917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r970806206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970806206"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, we are only interested in non-zero values for pingwait, so it would be simpler not to do this. What do you think?",
      "commit_id" : "c5a3587e3c9e36ae30f59f2651e64ec8d0e5d540",
      "created_at" : "2022-09-14T13:26:17Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.m_sync_height = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.m_common_height = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n-                stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            if (queue.pindex) {\n+                stats.m_height_in_flight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n-    stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        return stats;\n+    }\n+    stats.m_services = peer->m_their_services;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r970806206",
      "id" : 970806206,
      "in_reply_to_id" : 963656857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58453VO-",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1592,
      "original_position" : 85,
      "original_start_line" : 1587,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1107481421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970806206/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-14T13:26:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970806206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r971005481"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971005481"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reverted this change in the latest push at b5255ca75f.",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-14T15:49:01Z",
      "diff_hunk" : "@@ -1546,56 +1549,57 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.m_sync_height = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.m_common_height = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n-                stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            if (queue.pindex) {\n+                stats.m_height_in_flight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n-    stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        return stats;\n+    }\n+    stats.m_services = peer->m_their_services;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r971005481",
      "id" : 971005481,
      "in_reply_to_id" : 963656857,
      "line" : 1592,
      "node_id" : "PRRC_kwDOABII58454F4p",
      "original_commit_id" : "4b10c63dc2f5c894c07adc12926862783cda99b1",
      "original_line" : 1592,
      "original_position" : 85,
      "original_start_line" : 1587,
      "path" : "src/net_processing.cpp",
      "position" : 88,
      "pull_request_review_id" : 1107784432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971005481/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1590,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-14T15:49:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971005481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If this is stripped to the bare minimum needed, I think it will have higher chance of making it to 24.0\r\n\r\nDone in a separate PR without the refactoring here; the latter can indeed be done later.",
      "created_at" : "2022-09-16T14:01:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#issuecomment-1249403568",
      "id" : 1249403568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25923",
      "node_id" : "IC_kwDOABII585KeGKw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249403568/reactions"
      },
      "updated_at" : "2022-09-16T14:01:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249403568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r974967125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974967125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe I'm missing the context, but when would we expect to trigger this?\r\nIf this is called directly by user, why does it make sense to return defaults, rather than explicitly state the node is not found.",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-20T07:11:26Z",
      "diff_hunk" : "@@ -1546,56 +1546,60 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r974967125",
      "id" : 974967125,
      "line" : 1558,
      "node_id" : "PRRC_kwDOABII5846HNFV",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 1555,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 24,
      "pull_request_review_id" : 1113257240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974967125/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T07:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974967125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r974971583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974971583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is handling the two ways our code looks at `starting_height` unknown or something, which we create in b4bf7611d718e361dc7dea849550b3728da79136. Why not having one way? Switch to a new default if you wish, but having two different ones seems suboptimal.",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-20T07:16:50Z",
      "diff_hunk" : "@@ -1546,56 +1546,60 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            // Return member-initialized sensible defaults for the fields where\n+            // it makes sense and simplifies the code.\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.nSyncHeight = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.nCommonHeight = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n+            if (queue.pindex) {\n                 stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        // Peer is still being set up; return the stats that we do have.\n+        return stats;\n+    }\n     stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    if (peer->m_starting_height != -1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r974971583",
      "id" : 974971583,
      "line" : 1581,
      "node_id" : "PRRC_kwDOABII5846HOK_",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 1578,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 52,
      "pull_request_review_id" : 1113263940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974971583/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T07:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974971583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r974974193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974974193"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in b4bf7611d718e361dc7dea849550b3728da79136\r\n\r\nThis looks like a legacy (w.r.t this PR) approach where we don't rely on defaults. Why not?",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-20T07:19:52Z",
      "diff_hunk" : "@@ -1546,56 +1546,60 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            // Return member-initialized sensible defaults for the fields where\n+            // it makes sense and simplifies the code.\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.nSyncHeight = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.nCommonHeight = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n+            if (queue.pindex) {\n                 stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        // Peer is still being set up; return the stats that we do have.\n+        return stats;\n+    }\n     stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }\n-\n     if (auto tx_relay = peer->GetTxRelay(); tx_relay != nullptr) {\n         stats.m_relay_txs = WITH_LOCK(tx_relay->m_bloom_filter_mutex, return tx_relay->m_relay_txs);\n         stats.m_fee_filter_received = tx_relay->m_fee_filter_received.load();\n-    } else {\n-        stats.m_relay_txs = false;\n-        stats.m_fee_filter_received = 0;\n     }\n-\n-    stats.m_ping_wait = ping_wait;\n     stats.m_addr_processed = peer->m_addr_processed.load();\n     stats.m_addr_rate_limited = peer->m_addr_rate_limited.load();\n     stats.m_addr_relay_enabled = peer->m_addr_relay_enabled.load();\n     {\n         LOCK(peer->m_headers_sync_mutex);\n-        if (peer->m_headers_sync) {\n-            stats.presync_height = peer->m_headers_sync->GetPresyncHeight();\n-        }\n+        stats.presync_height = peer->m_headers_sync ? peer->m_headers_sync->GetPresyncHeight() : -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r974974193",
      "id" : 974974193,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846HOzx",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 1599,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1113267738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974974193/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T07:19:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974974193",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r975070386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975070386"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks for having a look.  This can be seen e.g. in the GUI Peers tab details area when the next three blocks fields display \"Unknown\" during the peer setup phase.\r\n\r\nThe idea is to return sensible defaults where it makes sense and potentially simplifies the code (both ours and that of API clients). For instance, the \"addr_processed\" and \"addr_rate_limited\" fields are member-initialized to 0 and may as well be returned during set up, as the peer has processed and limited no addresses yet. Likewise, returning an \"inflight\" field with an empty array seems just as logical and makes life simpler for us and for clients, than sometimes not returning the field in the RPC response. For \"pingwait\" we are only interested in non-zero values so a default of zero makes sense. For \"minfeefilter\" we need a default, and so on. \r\n\r\nWill update the documentation here as follows:\r\n```diff\r\n         if (state == nullptr) {\r\n-            // Return member-initialized sensible defaults for the fields where\r\n-            // it makes sense and simplifies the code.\r\n+            // Peer is still being set up; return member-initialized sensible defaults\r\n+            // for the node state fields where it makes sense and simplifies the code.\r\n             return stats;\r\n```",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-20T08:52:45Z",
      "diff_hunk" : "@@ -1546,56 +1546,60 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r975070386",
      "id" : 975070386,
      "in_reply_to_id" : 974967125,
      "line" : 1558,
      "node_id" : "PRRC_kwDOABII5846HmSy",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 1555,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 24,
      "pull_request_review_id" : 1113404103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975070386/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T08:52:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975070386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r975114060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975114060"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't do that yet as it would extend the refactoring from `CNodeStateStats` into the `Peer` class to change `m_starting_height` from `std::atomic` to `std::optional` with a mutex, but might still do it once this PR becomes refactoring-only (the other changes have been unbundled).",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-20T09:32:10Z",
      "diff_hunk" : "@@ -1546,56 +1546,60 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            // Return member-initialized sensible defaults for the fields where\n+            // it makes sense and simplifies the code.\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.nSyncHeight = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.nCommonHeight = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n+            if (queue.pindex) {\n                 stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        // Peer is still being set up; return the stats that we do have.\n+        return stats;\n+    }\n     stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    if (peer->m_starting_height != -1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r975114060",
      "id" : 975114060,
      "in_reply_to_id" : 974971583,
      "line" : 1581,
      "node_id" : "PRRC_kwDOABII5846Hw9M",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 1578,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 52,
      "pull_request_review_id" : 1113466638,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975114060/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T09:32:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975114060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r980912222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980912222"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So the new behavior is the following:\r\n- `nullptr` if peer==nullptr\r\n- `-1` if peer->m_headers_sync == nullptr\r\n- a real value otherwise\r\n\r\nIs this supposed to be straightforward to the user?",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-27T08:15:45Z",
      "diff_hunk" : "@@ -1546,56 +1546,60 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            // Return member-initialized sensible defaults for the fields where\n+            // it makes sense and simplifies the code.\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.nSyncHeight = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.nCommonHeight = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n+            if (queue.pindex) {\n                 stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        // Peer is still being set up; return the stats that we do have.\n+        return stats;\n+    }\n     stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }\n-\n     if (auto tx_relay = peer->GetTxRelay(); tx_relay != nullptr) {\n         stats.m_relay_txs = WITH_LOCK(tx_relay->m_bloom_filter_mutex, return tx_relay->m_relay_txs);\n         stats.m_fee_filter_received = tx_relay->m_fee_filter_received.load();\n-    } else {\n-        stats.m_relay_txs = false;\n-        stats.m_fee_filter_received = 0;\n     }\n-\n-    stats.m_ping_wait = ping_wait;\n     stats.m_addr_processed = peer->m_addr_processed.load();\n     stats.m_addr_rate_limited = peer->m_addr_rate_limited.load();\n     stats.m_addr_relay_enabled = peer->m_addr_relay_enabled.load();\n     {\n         LOCK(peer->m_headers_sync_mutex);\n-        if (peer->m_headers_sync) {\n-            stats.presync_height = peer->m_headers_sync->GetPresyncHeight();\n-        }\n+        stats.presync_height = peer->m_headers_sync ? peer->m_headers_sync->GetPresyncHeight() : -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r980912222",
      "id" : 980912222,
      "in_reply_to_id" : 974974193,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846d4he",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 1599,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1121502022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980912222/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-27T08:15:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980912222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r980927164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980927164"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why don't we make this optional? Seeing the peer is *not* relaying txs (although it just hasn't claimed it did) yet might be confusing.",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-27T08:28:10Z",
      "diff_hunk" : "@@ -24,18 +26,18 @@ static const bool DEFAULT_PEERBLOCKFILTERS = false;\n static const int DISCOURAGEMENT_THRESHOLD{100};\n \n struct CNodeStateStats {\n-    int nSyncHeight = -1;\n-    int nCommonHeight = -1;\n-    int m_starting_height = -1;\n-    std::chrono::microseconds m_ping_wait;\n+    std::optional<int> nSyncHeight;\n+    std::optional<int> nCommonHeight;\n+    std::optional<int> m_starting_height;\n+    std::chrono::microseconds m_ping_wait{0us};\n     std::vector<int> vHeightInFlight;\n-    bool m_relay_txs;\n-    CAmount m_fee_filter_received;\n+    bool m_relay_txs{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r980927164",
      "id" : 980927164,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII5846d8K8",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 34,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 24,
      "pull_request_review_id" : 1121523675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980927164/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-27T08:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980927164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r980939988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980939988"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I know you adjust the definition of this flag in later commits. I kinda still think `optional` before we know for sure would be better.",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-27T08:38:12Z",
      "diff_hunk" : "@@ -24,18 +26,18 @@ static const bool DEFAULT_PEERBLOCKFILTERS = false;\n static const int DISCOURAGEMENT_THRESHOLD{100};\n \n struct CNodeStateStats {\n-    int nSyncHeight = -1;\n-    int nCommonHeight = -1;\n-    int m_starting_height = -1;\n-    std::chrono::microseconds m_ping_wait;\n+    std::optional<int> nSyncHeight;\n+    std::optional<int> nCommonHeight;\n+    std::optional<int> m_starting_height;\n+    std::chrono::microseconds m_ping_wait{0us};\n     std::vector<int> vHeightInFlight;\n-    bool m_relay_txs;\n-    CAmount m_fee_filter_received;\n+    bool m_relay_txs{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r980939988",
      "id" : 980939988,
      "in_reply_to_id" : 980927164,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII5846d_TU",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 34,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 24,
      "pull_request_review_id" : 1121542451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980939988/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-27T08:38:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/980939988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r984462499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984462499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's not intended to be new behavior; will re-examine :)",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-30T10:44:06Z",
      "diff_hunk" : "@@ -1546,56 +1546,60 @@ PeerRef PeerManagerImpl::RemovePeer(NodeId id)\n     return ret;\n }\n \n-bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const\n+CNodeStateStats PeerManagerImpl::GetNodeStateStats(NodeId nodeid) const\n {\n+    CNodeStateStats stats;\n     {\n         LOCK(cs_main);\n         const CNodeState* state = State(nodeid);\n-        if (state == nullptr)\n-            return false;\n-        stats.nSyncHeight = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n-        stats.nCommonHeight = state->pindexLastCommonBlock ? state->pindexLastCommonBlock->nHeight : -1;\n+        if (state == nullptr) {\n+            // Return member-initialized sensible defaults for the fields where\n+            // it makes sense and simplifies the code.\n+            return stats;\n+        }\n+        if (state->pindexBestKnownBlock) {\n+            stats.nSyncHeight = state->pindexBestKnownBlock->nHeight;\n+        }\n+        if (state->pindexLastCommonBlock) {\n+            stats.nCommonHeight = state->pindexLastCommonBlock->nHeight;\n+        }\n         for (const QueuedBlock& queue : state->vBlocksInFlight) {\n-            if (queue.pindex)\n+            if (queue.pindex) {\n                 stats.vHeightInFlight.push_back(queue.pindex->nHeight);\n+            }\n         }\n     }\n-\n-    PeerRef peer = GetPeerRef(nodeid);\n-    if (peer == nullptr) return false;\n+    const PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) {\n+        // Peer is still being set up; return the stats that we do have.\n+        return stats;\n+    }\n     stats.their_services = peer->m_their_services;\n-    stats.m_starting_height = peer->m_starting_height;\n+    if (peer->m_starting_height != -1) {\n+        stats.m_starting_height = peer->m_starting_height;\n+    }\n     // It is common for nodes with good ping times to suddenly become lagged,\n     // due to a new block arriving or other large transfer.\n     // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n     // since pingtime does not update until the ping is complete, which might take a while.\n     // So, if a ping is taking an unusually long time in flight,\n     // the caller can immediately detect that this is happening.\n-    auto ping_wait{0us};\n     if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n+        stats.m_ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }\n-\n     if (auto tx_relay = peer->GetTxRelay(); tx_relay != nullptr) {\n         stats.m_relay_txs = WITH_LOCK(tx_relay->m_bloom_filter_mutex, return tx_relay->m_relay_txs);\n         stats.m_fee_filter_received = tx_relay->m_fee_filter_received.load();\n-    } else {\n-        stats.m_relay_txs = false;\n-        stats.m_fee_filter_received = 0;\n     }\n-\n-    stats.m_ping_wait = ping_wait;\n     stats.m_addr_processed = peer->m_addr_processed.load();\n     stats.m_addr_rate_limited = peer->m_addr_rate_limited.load();\n     stats.m_addr_relay_enabled = peer->m_addr_relay_enabled.load();\n     {\n         LOCK(peer->m_headers_sync_mutex);\n-        if (peer->m_headers_sync) {\n-            stats.presync_height = peer->m_headers_sync->GetPresyncHeight();\n-        }\n+        stats.presync_height = peer->m_headers_sync ? peer->m_headers_sync->GetPresyncHeight() : -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r984462499",
      "id" : 984462499,
      "in_reply_to_id" : 974974193,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846rbSj",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 1599,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 1126630285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984462499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-30T10:44:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984462499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r984462926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984462926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There seems to be agree on making it optional; will do.",
      "commit_id" : "b5255ca75f0fbf03c2dfa7c64b13b43ceb299995",
      "created_at" : "2022-09-30T10:44:46Z",
      "diff_hunk" : "@@ -24,18 +26,18 @@ static const bool DEFAULT_PEERBLOCKFILTERS = false;\n static const int DISCOURAGEMENT_THRESHOLD{100};\n \n struct CNodeStateStats {\n-    int nSyncHeight = -1;\n-    int nCommonHeight = -1;\n-    int m_starting_height = -1;\n-    std::chrono::microseconds m_ping_wait;\n+    std::optional<int> nSyncHeight;\n+    std::optional<int> nCommonHeight;\n+    std::optional<int> m_starting_height;\n+    std::chrono::microseconds m_ping_wait{0us};\n     std::vector<int> vHeightInFlight;\n-    bool m_relay_txs;\n-    CAmount m_fee_filter_received;\n+    bool m_relay_txs{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25923#discussion_r984462926",
      "id" : 984462926,
      "in_reply_to_id" : 980927164,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII5846rbZO",
      "original_commit_id" : "b4bf7611d718e361dc7dea849550b3728da79136",
      "original_line" : 34,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 24,
      "pull_request_review_id" : 1126630988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25923",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984462926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-30T10:44:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984462926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
