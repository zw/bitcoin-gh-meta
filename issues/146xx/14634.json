{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "<!-- This issue tracker is only for technical issues related to Bitcoin Core.\r\n\r\nGeneral bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.\r\n\r\nFor reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.\r\n\r\nIf the node is \"stuck\" during sync or giving \"block checksum mismatch\" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! -->\r\n\r\n<!-- Describe the issue -->\r\n\r\nI've updated from 0.16 to 0.17 and I'm trying to create a raw transaction to be signed on an offline wallet. This used to work fine, but now it doesn't.\r\n\r\nI'm creating a raw transaction with `createrawtransaction` with no inputs and the desired output. I'm using the hex generated in `fundrawtransaction` to match inputs.\r\n\r\nSince the online wallet is watch only I need to pass `includeWatching` in params. Also I want to send the change amount to a different address, so I added `changeAddress` to the options hash. This command kills the entire bitcoind process with no warnings and no log messages\r\n\r\nThis is the commands I've tried and their output:\r\n\r\n```\r\n$ bitcoin-cli createrawtransaction '[]' '{\"14XbnUUvc2Kt8TrnnEG9zjF1XM2jYD1h8x\":0.001}'\r\n020000000001a0860100000000001976a91426b1e477be0f7bc5e2cf12dd5b973e57e7fab5bf88ac00000000\r\n\r\n$ bitcoin-cli fundrawtransaction 020000000001a0860100000000001976a91426b1e477be0f7bc5e2cf12dd5b973e57e7fab5bf88ac00000000\r\nerror code: -4\r\nerror message:\r\nInsufficient funds\r\n\r\n$ bitcoin-cli fundrawtransaction 020000000001a0860100000000001976a91426b1e477be0f7bc5e2cf12dd5b973e57e7fab5bf88ac00000000 '{\"includeWatching\":true}'\r\n{\r\n  \"hex\": \"02000000016c4262fe490eb44becac4d4aa37f86b4433327ffa40a00a5498006c6ec5b0b240100000000feffffff02089a03000000000017a914ab7dd53603b6b64d3851569b90eeae8f39fd9f0087a0860100000000001976a91426b1e477be0f7bc5e2cf12dd5b973e57e7fab5bf88ac00000000\",\r\n  \"fee\": 0.00000675,\r\n  \"changepos\": 0\r\n}\r\n\r\n$ bitcoin-cli fundrawtransaction 020000000001a0860100000000001976a91426b1e477be0f7bc5e2cf12dd5b973e57e7fab5bf88ac00000000 '{\"includeWatching\":true,\"changeAddress\":\"185pJS3yVizdE3RtXKALtVbGRv9gzzypT1\"}'\r\nerror: Could not connect to the server 127.0.0.1:8332 (error code 1 - \"EOF reached\")\r\n\r\nMake sure the bitcoind server is running and that you are connecting to the correct RPC port.\r\n```\r\n\r\nAfter the last command the bitcoind is no longer running. This error happens every time if I add the `changeAddress` param.\r\n\r\nAfter looking for a solution in here I've found about gdb. After running `gdb --args  bitcoind -conf=/home/user/.bitcoin/bitcoin.conf` I've got this error:\r\n\r\n```\r\nbitcoind: policy/feerate.cpp:25: CAmount CFeeRate::GetFee(size_t) const: Assertion `nBytes_ <= uint64_t(std::numeric_limits<int64_t>::max())' failed.\r\n\r\nThread 7 \"bitcoin-httpwor\" received signal SIGABRT, Aborted.\r\n[Switching to Thread 0x7fffebfff700 (LWP 22448)]\r\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n51\t../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\r\n```\r\n\r\n---\r\n\r\nI will not append `debug.log` because it has no error. The process simply crashes. At first I was thinking this could be an out of memory. But after some digging I can safely say the problem is caused by [policy/feerate.cpp#L14](https://github.com/bitcoin/bitcoin/blob/master/src/policy/feerate.cpp#L14)\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 9,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14634/comments",
   "created_at" : "2018-11-01T18:53:45Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14634/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/14634",
   "id" : 376523584,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14634/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUzNzY1MjM1ODQ=",
   "number" : 14634,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "bitcoin-cli fundrawtransaction crashes bitcoind",
   "updated_at" : "2018-11-01T20:52:57Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14634",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/627404?v=4",
      "events_url" : "https://api.github.com/users/NicosKaralis/events{/privacy}",
      "followers_url" : "https://api.github.com/users/NicosKaralis/followers",
      "following_url" : "https://api.github.com/users/NicosKaralis/following{/other_user}",
      "gists_url" : "https://api.github.com/users/NicosKaralis/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/NicosKaralis",
      "id" : 627404,
      "login" : "NicosKaralis",
      "node_id" : "MDQ6VXNlcjYyNzQwNA==",
      "organizations_url" : "https://api.github.com/users/NicosKaralis/orgs",
      "received_events_url" : "https://api.github.com/users/NicosKaralis/received_events",
      "repos_url" : "https://api.github.com/users/NicosKaralis/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/NicosKaralis/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/NicosKaralis/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/NicosKaralis"
   }
}
