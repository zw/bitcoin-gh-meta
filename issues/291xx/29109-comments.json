[
   {
      "author_association" : "MEMBER",
      "body" : "The specific thing causing this error would be the lines:\r\n\r\n```\r\n2023-12-18T13:24:06Z [default wallet] Error reading wallet database: keymeta found with unexpected path\r\n2023-12-18T13:24:06Z [default wallet] Error reading wallet database: keymeta found with unexpected path\r\n```\r\n\r\nThis means that the stored metadata entries for a 2 keys has derivation paths of an unexpected length (`!= 3`). This error should be benign, although I think it's also erroneous since I'm pretty sure it is possible to import keys with derivation path information that would not match the standard pattern the loading code is checking for. \r\n\r\nEdit: Actually, such imports would not reach this code. Rather the only way that it is possible to get these errors is if that wallet got corrupted.",
      "created_at" : "2023-12-18T16:48:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1861029919",
      "id" : 1861029919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585u7RAf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1861029919/reactions"
      },
      "updated_at" : "2023-12-18T19:42:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1861029919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ok, thank you very much. This is a dedicated test machine and the error did not occur on production machines.\r\n\r\nI'll try dumping the wallet.dat file and importing the keys into a new wallet.",
      "created_at" : "2023-12-19T13:04:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1862723349",
      "id" : 1862723349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vBucV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1862723349/reactions"
      },
      "updated_at" : "2023-12-19T13:39:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1862723349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I did `dumpwallet` and the file created looks like this:\r\n\r\n```\r\n# Wallet dump created by Bitcoin Core v26.0.0\r\n# * Created on 2023-12-19T13:47:56Z\r\n# * Best block at time of backup was 821931 (00000000000000000003241b21de4d2d4d3505c2941fba3cccec82f1dbdbce4b),\r\n#   mined on 2023-12-19T13:46:59Z\r\n\r\n# extended private masterkey: xprv***********************************************************************************************************\r\n\r\nL**************************************************n 1970-01-01T00:00:01Z label= # addr=1E*******************************,3H********************************,bc1***************************************\r\nK**************************************************E 1970-01-01T00:00:01Z label= # addr=1K*******************************,31********************************,bc1***************************************\r\nL**************************************************U 1970-01-01T00:00:01Z label= # addr=1U*******************************,35********************************,bc1***************************************\r\nL**************************************************3 1970-01-01T00:00:01Z label= # addr=12********************************,3D********************************,bc1***************************************\r\nL**************************************************7 1970-01-01T00:00:01Z label= # addr=13********************************,3G********************************,bc1***************************************\r\n5*************************************************6 1970-01-01T00:00:01Z label= # addr=13********************************\r\nK*************************************************Rf 1970-01-01T00:00:01Z label= # addr=13********************************,3P********************************,bc1***************************************\r\nL*************************************************YD 1970-01-01T00:00:01Z label= # addr=15********************************,38********************************,bc1***************************************\r\nK*************************************************87 1970-01-01T00:00:01Z label= # addr=16********************************,3M********************************,bc1***************************************\r\nK*************************************************ib 1970-01-01T00:00:01Z label= # addr=17********************************,3Q********************************,bc1***************************************\r\nK*************************************************x5 1970-01-01T00:00:01Z label= # addr=17********************************,37********************************,bc1***************************************\r\n[..]\r\nL*************************************************1y 2019-12-18T14:06:33Z reserve=1 # addr=3A******************************** hdkeypath=m/0'/0'/66'\r\nL*************************************************1k 2019-12-18T14:06:33Z reserve=1 # addr=3C******************************** hdkeypath=m/0'/0'/60'\r\nL*************************************************nz 2019-12-18T14:06:33Z reserve=1 # addr=3J******************************** hdkeypath=m/0'/0'/190'\r\nK*************************************************Lb 2019-12-18T14:06:33Z inactivehdseed=1 # addr=39********************************\r\nK*************************************************pJ 2019-12-18T14:06:33Z reserve=1 # addr=3E******************************** hdkeypath=m/0'/0'/54'\r\nL*************************************************m5 2019-12-18T14:06:33Z label= # addr=3N******************************** hdkeypath=m/0'/0'/5'\r\nL*************************************************jk 2019-12-18T14:06:33Z reserve=1 # addr=3Q******************************** hdkeypath=m/0'/0'/33'\r\nK*************************************************Ty 2019-12-18T14:06:33Z reserve=1 # addr=3N******************************** hdkeypath=m/0'/0'/201'\r\nK*************************************************D1 2019-12-18T14:06:33Z reserve=1 # addr=3K******************************** hdkeypath=m/0'/0'/64'\r\nK*************************************************o5 2019-12-18T14:06:33Z reserve=1 # addr=3A******************************** hdkeypath=m/0'/0'/108'\r\n[..]\r\n```\r\n\r\nThe 6th key looks odd with it being one character short.\r\nOne key with has tag `inactivehdseed=1`.\r\n\r\nMight this be the cause of the error messages?\r\n\r\nThe rest looks good, being `change=1`, `reserve=1` and one being `hdseed=1`",
      "created_at" : "2023-12-19T14:01:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1862813350",
      "id" : 1862813350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vCEam",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1862813350/reactions"
      },
      "updated_at" : "2023-12-19T14:03:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1862813350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Do you see any `hdkeypath` that doesn't follow the pattern `m/a'/b'/c'`?",
      "created_at" : "2023-12-19T16:51:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863129994",
      "id" : 1863129994,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vDRuK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863129994/reactions"
      },
      "updated_at" : "2023-12-19T16:51:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863129994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Oh, now that you told me where to look ... there are indeed two strange looking key paths.\r\n\r\nAll but two are in the format `m/a'/b'/c'`, e.g. `m/0'/1'/289'` or `m/0'/1'/4'`. Most are distinct but eleven key paths are found twice in the dump. And then there are two with a very odd path: `m/0'/1'/299'/0'/1'/300'` and `m/0'/0'/299'/0'/0'/300'`.\r\n\r\nI'm sure our devs never tested with `derivation paths` but it is possible that on that particular machine some keys from bitcoin forks were imported, e.g. BTG, BSV or BCH. I will talk to our devs after the holidays to get some feedback as to where these two keys originated so it's documented here in case someone has the same warnings pop up and ends up here.\r\n\r\nThanks very much, @achow101.",
      "created_at" : "2023-12-19T17:58:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863241394",
      "id" : 1863241394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vDs6y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863241394/reactions"
      },
      "updated_at" : "2023-12-19T18:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863241394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Most are distinct but eleven key paths are found twice in the dump\r\n\r\nSince there is an `inactivehdseed`, that means that the seed has been rotated, probably by encrypting the wallet. So these duplicated paths are expected. One of the keys is derived from the inactive seed, and the other from the current active seed.\r\n\r\n> And then there are two with a very odd path: `m/0'/1'/299'/0'/1'/300'` and `m/0'/0'/299'/0'/0'/300'`.\r\n\r\nThis lines up with the errors in the debug.log.\r\n\r\nThese derivation paths look like the paths for a key got combined with the derivation path for the next key to be derived. I've seen this before, but I think only in PR branches, not after being merged. I suspect that these keys were automatically generated and the weird derivation path is the result of a bug in key metadata upgrading code.\r\n\r\nAre there any keys with any of the derivation paths `m/0'/1'/299'`, `m/0'/1'/300'`, `m/0'/0'/299'`, or `m/0'/0'/300'`?\r\n\r\nIf you are able to, try loading the wallet in 0.17 or earlier and then doing `dumpwallet`. If you lookup these two addresses (with the weird derivation paths) in the dump, what derivation paths do they have?\r\n\r\nIt would also be useful to see the actual keymeta records themselves. You can get a dump of raw data stored in the wallet file by using the `bitcoin-wallet` tool's `dump` command (e.g. `bitcoin-wallet -dumpfile=dump.txt -wallet=mywallet dump`). This will dump all of the records in the database as hex bytes to a text file. Within that file, search for the strings `00000080000000802b01008000000080000000802c010080` and `00000080010000802b01008000000080010000802c010080`. These are the derivation paths as they would be stored in the wallet file. Then you can copy the lines with those strings and paste them here. Those lines will be the entire metadata records for these two keys. These are safe to share as they will only contain the public key, a version number, the time the key was created, the seed's id (hash of the seed), and the derivation path.",
      "created_at" : "2023-12-19T20:14:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863413296",
      "id" : 1863413296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vEW4w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863413296/reactions"
      },
      "updated_at" : "2023-12-19T20:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863413296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Since there is an `inactivehdseed`, that means that the seed has been rotated, probably by encrypting the wallet. So these duplicated paths are expected. One of the keys is derived from the inactive seed, and the other from the current active seed.\r\n\r\nNot encrypted but a `dumpwallet` dump from a different wallet.dat (might be from a fork) was imported with`importwallet` into the already existing `wallet.dat` which most likely made the old hdseed inactive and the imported one active (or vice versa).\r\n\r\n> Are there any keys with any of the derivation paths `m/0'/1'/299'`, `m/0'/1'/300'`, `m/0'/0'/299'`, or `m/0'/0'/300'`?\r\n\r\nOnly these two:\r\n\r\n```\r\nreserve=1 [..] hdkeypath=m/0'/0'/299'\r\nreserve=1 [..] hdkeypath=m/0'/0'/300'\r\n```\r\n\r\n> If you are able to, try loading the wallet in 0.17 or earlier and then doing `dumpwallet`. If you lookup these two addresses (with the weird derivation paths) in the dump, what derivation paths do they have?\r\n\r\nI did as you described and `dumpwallet` with 0.17.0 gives\r\n\r\n* `hdkeypath=m/0'/1'/300'` for the address with `hdkeypath=m/0'/1'/299'/0'/1'/300'` in v26.0\r\n* `hdkeypath=m/0'/0'/300'` for the address with `hdkeypath=m/0'/0'/299'/0'/0'/300'` in v26.0\r\n\r\nBoth addresses/keys were created on `2021-10-28` according to the `dumpwallet` file and are of type `change=1`",
      "created_at" : "2023-12-19T20:31:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863432854",
      "id" : 1863432854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vEbqW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863432854/reactions"
      },
      "updated_at" : "2023-12-19T20:36:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863432854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "`bitcoin-wallet` doesn't create any file:\r\n\r\n```\r\n% bitcoin-wallet -datadir=. -dumpfile=026.dump -wallet=wallet.dat dump\r\nError reading wallet.dat! All keys read correctly, but transaction data or address book entries might be missing or incorrect.\r\n```",
      "created_at" : "2023-12-19T20:46:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863449058",
      "id" : 1863449058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vEfni",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863449058/reactions"
      },
      "updated_at" : "2023-12-19T20:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863449058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> `bitcoin-wallet` doesn't create any file:\r\n\r\nOh, that's a bug, Should be simple to fix. In any case, I don't think that dump will be needed since the `dumpwallet` output should be enough to have an idea of what was stored.\r\n\r\n***\r\n\r\nThe `dumpwallet` file has a xprv at the top. Can you try deriving the 4 keys at the derivation paths I mentioned above and see which match the lines with the weird derivation paths? I'm pretty sure the wallet just stored the wrong derivation paths somehow.\r\n\r\n> Both addresses/keys were created on `2021-10-28`\r\n\r\nAny idea what version was running on that date?",
      "created_at" : "2023-12-19T21:23:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863491818",
      "id" : 1863491818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vEqDq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863491818/reactions"
      },
      "updated_at" : "2023-12-19T21:48:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863491818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Will try tomorrow using https://github.com/dan-da/hd-wallet-derive",
      "created_at" : "2023-12-19T22:00:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863531177",
      "id" : 1863531177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vEzqp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863531177/reactions"
      },
      "updated_at" : "2023-12-19T22:00:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863531177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "# derived keys\r\n\r\nI used https://github.com/dan-da/hd-wallet-derive to derive\r\n\r\n* 301 keys in path `m/0'/0'/0'` to `m/0'/0'/300'`\r\n* 301 keys in path `m/0'/1'/0'` to `m/0'/1'/300'`\r\n\r\nfrom the **xprv** like so:\r\n```\r\nphp hd-wallet-derive.php -g --cols=path,privkey --key=xprv... --path=\"m/0'/0'/x'\" --numderive 301 > xprv-0.txt\r\nphp hd-wallet-derive.php -g --cols=path,privkey --key=xprv... --path=\"m/0'/1'/x'\" --numderive 301 > xprv-1.txt\r\n```\r\n\r\nThen I took all the private keys from the `walletdump` output and grepped for the keys in the 2 `.txt` files and only found 11 matches for the following paths:\r\n\r\n* `m/0'/0'/0'` to `m/0'/0'/5'` in `xprv-0.txt`\r\n* `m/0'/1'/0'` to `m/0'/1'/4'` in `xprv-1.txt`\r\n\r\nThere are 623 keys in the `walletdump` output with a `hdkeypath` info but only 11 can be derived from the `xprv`? That's odd to me.\r\n\r\n# Edit\r\n\r\n>> Both addresses/keys were created on 2021-10-28\r\n\r\n> Any idea what version was running on that date?\r\n\r\n## Timeline according to company communication history\r\n\r\n### 2021-10-28T09:48Z\r\n\r\nWe upgraded from `v0.19.1` to `v22.0` on that dedicated test server.\r\n\r\n### 2021-10-28T11:42Z\r\n\r\n`getwalletinfo`\r\n\r\n```json\r\n{\r\n  \"walletname\": \"\",\r\n  \"walletversion\": 169900,\r\n  \"format\": \"bdb\",\r\n  \"balance\": 0.00032451,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  \"immature_balance\": 0.00000000,\r\n  \"txcount\": 50,\r\n  \"keypoololdest\": 1576677994,\r\n  \"keypoolsize\": 300,\r\n  \"hdseedid\": \"8136................................49b9\",\r\n  \"keypoolsize_hd_internal\": 300,\r\n  \"paytxfee\": 0.00000000,\r\n  \"private_keys_enabled\": true,\r\n  \"avoid_reuse\": false,\r\n  \"scanning\": false,\r\n  \"descriptors\": false\r\n}\r\n```\r\n\r\n### 2021-10-28T13:33Z\r\n\r\nOne key is generated/imported:\r\n\r\n```\r\nL**************************************************G 2021-10-28T13:33:14Z reserve=1 # addr=3********************************x hdkeypath=m/0'/0'/2'\r\n```\r\n\r\n### 2021-10-28T14:05Z\r\n\r\n15 keys are generated/imported, among them two with the bogus keypath:\r\n\r\n```\r\nK**************************************************G 2021-10-28T14:05:29Z change=1 # addr=32*******************************T hdkeypath=m/0'/0'/302'\r\nK**************************************************7 2021-10-28T14:05:29Z change=1 # addr=3E*******************************7 hdkeypath=m/0'/1'/305'\r\nL**************************************************K 2021-10-28T14:05:29Z change=1 # addr=3A*******************************n hdkeypath=m/0'/0'/305'\r\nL**************************************************i 2021-10-28T14:05:29Z reserve=1 # addr=32*******************************x hdkeypath=m/0'/1'/3'\r\nK**************************************************c 2021-10-28T14:05:29Z change=1 # addr=3D******************************MN hdkeypath=m/0'/0'/301'\r\nL**************************************************3 2021-10-28T14:05:29Z change=1 # addr=3F******************************n7 hdkeypath=m/0'/1'/302'\r\nL**************************************************C 2021-10-28T14:05:29Z change=1 # addr=3Q******************************5F hdkeypath=m/0'/1'/304'\r\nK**************************************************i 2021-10-28T14:05:29Z reserve=1 # addr=38******************************Sg hdkeypath=m/0'/0'/3'\r\nK**************************************************N 2021-10-28T14:05:29Z change=1 # addr=3M******************************HV hdkeypath=m/0'/1'/303'\r\nK**************************************************3 2021-10-28T14:05:29Z change=1 # addr=3D******************************8C hdkeypath=m/0'/0'/304'\r\nK**************************************************t 2021-10-28T14:05:29Z change=1 # addr=38******************************8w hdkeypath=m/0'/1'/299'/0'/1'/300'\r\nK**************************************************t 2021-10-28T14:05:29Z change=1 # addr=3A******************************xU hdkeypath=m/0'/1'/301'\r\nK**************************************************x 2021-10-28T14:05:29Z change=1 # addr=3D******************************fD hdkeypath=m/0'/0'/299'/0'/0'/300'\r\nL**************************************************T 2021-10-28T14:05:29Z reserve=1 # addr=3M******************************du hdkeypath=m/0'/0'/4'\r\nL**************************************************z 2021-10-28T14:05:29Z change=1 # addr=3F******************************yC hdkeypath=m/0'/0'/303'\r\n\r\n```\r\n\r\n# bitcoin-wallet\r\n\r\nI compiled `v26.0` with patch from #29117 and used `bitcoin-wallet` to dump the `wallet.dat` into `bitcoin-wallet.dump`\r\n\r\n```\r\n% grep 00000080000000802b01008000000080000000802c010080 bitcoin-wallet.dump | xxd -r -p | hd\r\n00000000  07 6b 65 79 6d 65 74 61  21 03 5c 24 01 45 a6 43  |.keymeta!.\\$.E.C|\r\n00000010  29 a2 d6 f9 75 38 69 b2  a2 a3 ff 08 bb df 37 7d  |)...u8i.......7}|\r\n00000020  50 4d 36 82 83 c3 fb e9  bd 0b 0c 00 00 00 29 ae  |PM6...........).|\r\n00000030  7a 61 00 00 00 00 0c 6d  2f 30 27 2f 30 27 2f 33  |za.....m/0'/0'/3|\r\n00000040  30 30 27 1a f5 3c d5 83  ec fc ff 41 e8 2b a8 8e  |00'..<.....A.+..|\r\n00000050  4e 85 6e 04 46 b9 58 1b  e3 33 09 06 00 00 00 80  |N.n.F.X..3......|\r\n00000060  00 00 00 80 2b 01 00 80  00 00 00 80 00 00 00 80  |....+...........|\r\n00000070  2c 01 00 80 01                                    |,....|\r\n00000075\r\n```\r\n\r\n```\r\n% grep 00000080010000802b01008000000080010000802c010080 bitcoin-wallet.dump | xxd -r -p | hd\r\n00000000  07 6b 65 79 6d 65 74 61  21 02 21 03 73 d4 c0 a2  |.keymeta!.!.s...|\r\n00000010  2a d0 49 f1 22 85 9a 90  36 8c 86 e5 35 8e 43 bc  |*.I.\"...6...5.C.|\r\n00000020  ea 84 08 60 4c 8c a5 f8  98 50 0c 00 00 00 29 ae  |...`L....P....).|\r\n00000030  7a 61 00 00 00 00 0c 6d  2f 30 27 2f 31 27 2f 33  |za.....m/0'/1'/3|\r\n00000040  30 30 27 1a f5 3c d5 83  ec fc ff 41 e8 2b a8 8e  |00'..<.....A.+..|\r\n00000050  4e 85 6e 04 46 b9 58 1b  e3 33 09 06 00 00 00 80  |N.n.F.X..3......|\r\n00000060  01 00 00 80 2b 01 00 80  00 00 00 80 01 00 00 80  |....+...........|\r\n00000070  2c 01 00 80 01                                    |,....|\r\n00000075\r\n```",
      "created_at" : "2023-12-20T11:58:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1864352916",
      "id" : 1864352916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vH8SU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864352916/reactions"
      },
      "updated_at" : "2023-12-20T14:56:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864352916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Let me know if I can help with debugging this any further.",
      "created_at" : "2023-12-20T14:57:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1864618020",
      "id" : 1864618020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vI9Ak",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864618020/reactions"
      },
      "updated_at" : "2023-12-20T14:57:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864618020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20477825?v=4",
         "events_url" : "https://api.github.com/users/c0deright/events{/privacy}",
         "followers_url" : "https://api.github.com/users/c0deright/followers",
         "following_url" : "https://api.github.com/users/c0deright/following{/other_user}",
         "gists_url" : "https://api.github.com/users/c0deright/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/c0deright",
         "id" : 20477825,
         "login" : "c0deright",
         "node_id" : "MDQ6VXNlcjIwNDc3ODI1",
         "organizations_url" : "https://api.github.com/users/c0deright/orgs",
         "received_events_url" : "https://api.github.com/users/c0deright/received_events",
         "repos_url" : "https://api.github.com/users/c0deright/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/c0deright/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/c0deright/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/c0deright"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I was able to replicate the bug. I believe this is only an issue with 0.21.x and 22.x as the bug was fixed by #23304 which was first released in 23.0.\r\n\r\nThe issue occurs when inactive key chains are topped up. There was an off-by-one where loading would erroneously find the last index derived rather than the next index to be derived (last index + 1), and so it would end up re-deriving that last index, which I think is what causes the weird derivation path. Specifically, `DeriveNewChildKey` takes a metadata object and overwrites the `hdKeypath` string but appends to `key_origin.path`, so if it gets the same object twice, then it would overwrite `hdKeypath` with the path it just derived, but append that path to `key_origin.path`. This results in the derivation path that looks like it's two derivation paths concatenated, because that's what it is.\r\n\r\nThe exact mechanism is not entirely clear to me though since `DeriveNewChildKey` is always called by `GenerateNewKey` which always provides it with a new metadata object. However, empirically, I can replicate the issue on 22.x, but the same procedure does not have the issue on 23.x.\r\n\r\nIt should be possible for the wallet to detect when this error had occurred previously and be able to fix it automatically. I'll see if I can put together a fix.\r\n\r\n***\r\n\r\n> There are 623 keys in the `walletdump` output with a `hdkeypath` info but only 11 can be derived from the `xprv`? That's odd to me.\r\n\r\nThis is expected as the hd seed has been rotated (most commonly by encrypting the wallet). The one shown at the top will be for the current seed, while the wallet will still store and have metadata for all of the keys generated with the previous seed. We can further see that the keys with the odd derivation paths are generated from a seed whose id does not match the active one, which is consistent with the way that I replicated the issue.",
      "created_at" : "2023-12-20T17:39:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1864879265",
      "id" : 1864879265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
      "node_id" : "IC_kwDOABII585vJ8yh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864879265/reactions"
      },
      "updated_at" : "2023-12-20T17:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864879265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
