{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "We don't have a fuzzing harness for our main consensus engine [0]. This PR introduces two new targets which respectively fuzz the `BlockManager`Â and `ChainstateManager` (process headers, blocks, reorgs and assert some invariants in doing so).\r\n\r\nThere is two main obstacles to achieving this: PoW and io. The blocks and chainstate databases can be stored in memory but blocks still need a valid proof of work and to be stored on disk. Niklas solved the first issue in #28043 by simply introducing a global which makes it possible to mock the PoW check (his commit is cherry-picked here). After considering other approaches, i also used globals to mock disk io.\r\n\r\nI'm interested with this PR in getting feedback on the concept and the approach, but also in suggestions of more invariants to be asserting in the `chainstate`Â fuzz target.\r\n\r\nRegarding other approaches i tried the most potentially promising was to leverage `ld`'s `--wrap` option to mock the syscalls without having to modify non-test code. But i didn't try too hard to make it work: better to have a demo of what can be achieved first with a more trivial way of mocking filesystem calls. If there is interest in these fuzz targets, i can give this approach another look.\r\n\r\nRegarding efficiency, the chainstate fuzz target is quite slow at the moment but i've at least 2x its performance by rebasing on #28960 and making `CheckBlockIndex` callable externally even if `!ShouldCheckBlockIndex()`. Suggestions for performance improvements welcome too.\r\n\r\n---\r\n\r\n[0] Well there is `utxo_total_supply` but it's very specialized toward exercising a specific past bug.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29158/comments",
   "created_at" : "2023-12-30T10:05:20Z",
   "draft" : true,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29158/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/29158",
   "id" : 2060700929,
   "labels" : [
      {
         "color" : "cccccc",
         "default" : false,
         "description" : "",
         "id" : 5334691551,
         "name" : "CI failed",
         "node_id" : "LA_kwDOABII588AAAABPfju3w",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29158/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585i93k7",
   "number" : 29158,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/29158.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29158",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/29158.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29158"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29158/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29158/timeline",
   "title" : "PoC: fuzz chainstate and block managers",
   "updated_at" : "2023-12-30T10:53:38Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29158",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
      "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
      "followers_url" : "https://api.github.com/users/darosior/followers",
      "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
      "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/darosior",
      "id" : 22457751,
      "login" : "darosior",
      "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
      "organizations_url" : "https://api.github.com/users/darosior/orgs",
      "received_events_url" : "https://api.github.com/users/darosior/received_events",
      "repos_url" : "https://api.github.com/users/darosior/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/darosior"
   }
}
