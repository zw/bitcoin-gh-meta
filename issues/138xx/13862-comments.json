[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #13878 (utils: Add fstream wrapper to allow to pass unicode filename on Windows by ken2812221)\n* #13866 (utils: Use _wfopen and _wfreopen on Windows by ken2812221)\n* #13746 (-masterdatadir for datadir bootstrapping by kallewoof)\n* #13743 (refactor: Replace std/boost::bind with lambda by ken2812221)\n* #13159 (Don't close old debug log file handle prematurely when trying to re-open (on SIGHUP) by practicalswift)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-08-03T10:40:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410215803",
      "id" : 410215803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDIxNTgwMw==",
      "updated_at" : "2018-08-25T18:27:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410215803",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seems like a good opportunity to drop `boost::interprocess::file_lock` altogether, no?",
      "created_at" : "2018-08-03T13:16:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410249864",
      "id" : 410249864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDI0OTg2NA==",
      "updated_at" : "2018-08-03T13:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410249864",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207589776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207589776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could delete default and copy constructor",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T15:52:34Z",
      "diff_hunk" : "@@ -19,6 +21,21 @@ namespace fs = boost::filesystem;\n namespace fsbridge {\n     FILE *fopen(const fs::path& p, const char *mode);\n     FILE *freopen(const fs::path& p, const char *mode, FILE *stream);\n+\n+    class FileLock\n+    {\n+    public:\n+        FileLock(const fs::path& file);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207589776",
      "id" : 207589776,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzU4OTc3Ng==",
      "original_commit_id" : "3b72520dbf0b45d5ac281f319e4b4e88d7ef39ad",
      "original_position" : 21,
      "path" : "src/fs.h",
      "position" : null,
      "pull_request_review_id" : 143237870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207589776",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207591824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207591824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The relevant boost implementation, for reference:\r\n```C++\r\ninline bool try_acquire_file_lock(file_handle_t hnd, bool &acquired)\r\n{\r\n   struct ::flock lock;\r\n   lock.l_type    = F_WRLCK;\r\n   lock.l_whence  = SEEK_SET;\r\n   lock.l_start   = 0;\r\n   lock.l_len     = 0;\r\n   int ret = ::fcntl(hnd, F_SETLK, &lock);\r\n   if(ret == -1){\r\n      return (errno == EAGAIN || errno == EACCES) ?\r\n               acquired = false, true : false;\r\n   }\r\n   return (acquired = true);\r\n}\r\n```\r\nhttps://www.boost.org/doc/libs/1_67_0/boost/interprocess/detail/os_file_functions.hpp\r\n\r\nShould we distinguish between hard (e.g. EINVAL) and soft (EAGAIN, EACCES) failures, as they do? We could throw in the former case?\r\nhttps://www.gnu.org/software/libc/manual/html_node/File-Locks.html",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T15:59:50Z",
      "diff_hunk" : "@@ -12,4 +18,54 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    return -1 != fcntl(fd, F_SETLK, &lock);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207591824",
      "id" : 207591824,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzU5MTgyNA==",
      "original_commit_id" : "3b72520dbf0b45d5ac281f319e4b4e88d7ef39ad",
      "original_position" : 41,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143240445,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207591824",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207593056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207593056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The relevant boost implementation, for reference:\r\n```C++\r\ninline bool try_acquire_file_lock(file_handle_t hnd, bool &acquired)\r\n{\r\n   const unsigned long len = ((unsigned long)-1);\r\n   winapi::interprocess_overlapped overlapped;\r\n   std::memset(&overlapped, 0, sizeof(overlapped));\r\n   if(!winapi::lock_file_ex\r\n      (hnd, winapi::lockfile_exclusive_lock | winapi::lockfile_fail_immediately,\r\n       0, len, len, &overlapped)){\r\n      return winapi::get_last_error() == winapi::error_lock_violation ?\r\n               acquired = false, true : false;\r\n\r\n   }\r\n   return (acquired = true);\r\n}\r\n```\r\nhttps://www.boost.org/doc/libs/1_67_0/boost/interprocess/detail/os_file_functions.hpp\r\n\r\nSimilar question re. `GetLastError`?",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T16:03:30Z",
      "diff_hunk" : "@@ -12,4 +18,54 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    return -1 != fcntl(fd, F_SETLK, &lock);\n+}\n+#else\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    hFile = CreateFileW(file.wstring().c_str(), GENERIC_READ | GENERIC_WRITE, 0, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, nullptr);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (hFile != INVALID_HANDLE_VALUE) {\n+        CloseHandle(hFile);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (hFile == INVALID_HANDLE_VALUE) {\n+        return false;\n+    }\n+    _OVERLAPPED overlapped = {0};\n+    return LockFileEx((HANDLE)hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207593056",
      "id" : 207593056,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzU5MzA1Ng==",
      "original_commit_id" : "3b72520dbf0b45d5ac281f319e4b4e88d7ef39ad",
      "original_position" : 63,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143241714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207593056",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207593509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207593509"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also is the `(HANDLE)` cast necessary?",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T16:05:15Z",
      "diff_hunk" : "@@ -12,4 +18,54 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    return -1 != fcntl(fd, F_SETLK, &lock);\n+}\n+#else\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    hFile = CreateFileW(file.wstring().c_str(), GENERIC_READ | GENERIC_WRITE, 0, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, nullptr);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (hFile != INVALID_HANDLE_VALUE) {\n+        CloseHandle(hFile);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (hFile == INVALID_HANDLE_VALUE) {\n+        return false;\n+    }\n+    _OVERLAPPED overlapped = {0};\n+    return LockFileEx((HANDLE)hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207593509",
      "id" : 207593509,
      "in_reply_to_id" : 207593056,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzU5MzUwOQ==",
      "original_commit_id" : "3b72520dbf0b45d5ac281f319e4b4e88d7ef39ad",
      "original_position" : 63,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143242280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207593509",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207597096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207597096"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T16:18:50Z",
      "diff_hunk" : "@@ -12,4 +18,54 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    return -1 != fcntl(fd, F_SETLK, &lock);\n+}\n+#else\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    hFile = CreateFileW(file.wstring().c_str(), GENERIC_READ | GENERIC_WRITE, 0, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, nullptr);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (hFile != INVALID_HANDLE_VALUE) {\n+        CloseHandle(hFile);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (hFile == INVALID_HANDLE_VALUE) {\n+        return false;\n+    }\n+    _OVERLAPPED overlapped = {0};\n+    return LockFileEx((HANDLE)hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207597096",
      "id" : 207597096,
      "in_reply_to_id" : 207593056,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzU5NzA5Ng==",
      "original_commit_id" : "3b72520dbf0b45d5ac281f319e4b4e88d7ef39ad",
      "original_position" : 63,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143246791,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207597096",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Empact  In my opinion, we deal catching exception and try_lock fail much the same when we use boost, so no need to handle the extra exception for now.",
      "created_at" : "2018-08-03T16:22:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410304855",
      "id" : 410304855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDMwNDg1NQ==",
      "updated_at" : "2018-08-03T16:36:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410304855",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207601154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207601154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T16:35:07Z",
      "diff_hunk" : "@@ -19,6 +21,21 @@ namespace fs = boost::filesystem;\n namespace fsbridge {\n     FILE *fopen(const fs::path& p, const char *mode);\n     FILE *freopen(const fs::path& p, const char *mode, FILE *stream);\n+\n+    class FileLock\n+    {\n+    public:\n+        FileLock(const fs::path& file);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207601154",
      "id" : 207601154,
      "in_reply_to_id" : 207589776,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzYwMTE1NA==",
      "original_commit_id" : "3b72520dbf0b45d5ac281f319e4b4e88d7ef39ad",
      "original_position" : 21,
      "path" : "src/fs.h",
      "position" : null,
      "pull_request_review_id" : 143251900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207601154",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ken2812221 FYI boost does throw on the failures noted above:\r\n\r\n```C++\r\ninline bool file_lock::try_lock()\r\n{\r\n   bool result;\r\n   if(!ipcdetail::try_acquire_file_lock(m_file_hnd, result)){\r\n      error_info err(system_error_code());\r\n      throw interprocess_exception(err);\r\n   }\r\n   return result;\r\n}\r\n\r\nnamespace boost {\r\nnamespace interprocess {\r\ninline int system_error_code() // artifact of POSIX and WINDOWS error reporting\r\n{\r\n   #if (defined BOOST_INTERPROCESS_WINDOWS)\r\n   return winapi::get_last_error();\r\n   #else\r\n   return errno; // GCC 3.1 won't accept ::errno\r\n   #endif\r\n}\r\n```\r\nhttps://www.boost.org/doc/libs/1_67_0/boost/interprocess/sync/file_lock.hpp\r\nhttps://www.boost.org/doc/libs/1_46_1/boost/interprocess/errors.hpp",
      "created_at" : "2018-08-03T17:25:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410321834",
      "id" : 410321834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDMyMTgzNA==",
      "updated_at" : "2018-08-03T17:25:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410321834",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Empact I simply return false in my code at those conditions.",
      "created_at" : "2018-08-03T17:35:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410324307",
      "id" : 410324307,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDMyNDMwNw==",
      "updated_at" : "2018-08-03T17:35:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410324307",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yeah so the net effect is the loss of this message:\r\n`return error(\"Error while attempting to lock directory %s: %s\", directory.string(), e.what());`\r\n\r\nCertainly not a big deal but breadcrumbs can mean the difference between an easy fix and a maddening mystery.",
      "created_at" : "2018-08-03T17:42:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410326299",
      "id" : 410326299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDMyNjI5OQ==",
      "updated_at" : "2018-08-03T17:42:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410326299",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Empact Updated to get error messages.",
      "created_at" : "2018-08-03T18:32:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410339465",
      "id" : 410339465,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDMzOTQ2NQ==",
      "updated_at" : "2018-08-03T18:32:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410339465",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207672720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207672720"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The CreateFileW with 0 sharing effectively opens the file as exclusive (locking it). It feels the TryLock() here is redundant because we don't require locking of specific bytes.\r\n\r\nPerhaps the TryLock() should be the one doing the CreateFileW.\r\nApologies if I've misunderstood something here :-)",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T21:30:54Z",
      "diff_hunk" : "@@ -12,4 +18,54 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    return -1 != fcntl(fd, F_SETLK, &lock);\n+}\n+#else\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    hFile = CreateFileW(file.wstring().c_str(), GENERIC_READ | GENERIC_WRITE, 0, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, nullptr);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (hFile != INVALID_HANDLE_VALUE) {\n+        CloseHandle(hFile);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (hFile == INVALID_HANDLE_VALUE) {\n+        return false;\n+    }\n+    _OVERLAPPED overlapped = {0};\n+    return LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207672720",
      "id" : 207672720,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzY3MjcyMA==",
      "original_commit_id" : "574c4b721636fc6861c31dab60404acdfa3f2b04",
      "original_position" : 62,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143341148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207672720",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "node_id" : "MDQ6VXNlcjYzOTQwMzM=",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207686115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207686115"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-03T23:03:36Z",
      "diff_hunk" : "@@ -12,4 +18,54 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    return -1 != fcntl(fd, F_SETLK, &lock);\n+}\n+#else\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    hFile = CreateFileW(file.wstring().c_str(), GENERIC_READ | GENERIC_WRITE, 0, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, nullptr);\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (hFile != INVALID_HANDLE_VALUE) {\n+        CloseHandle(hFile);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (hFile == INVALID_HANDLE_VALUE) {\n+        return false;\n+    }\n+    _OVERLAPPED overlapped = {0};\n+    return LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207686115",
      "id" : 207686115,
      "in_reply_to_id" : 207672720,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzY4NjExNQ==",
      "original_commit_id" : "574c4b721636fc6861c31dab60404acdfa3f2b04",
      "original_position" : 62,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143357264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207686115",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207711453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207711453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `static`",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-04T15:28:52Z",
      "diff_hunk" : "@@ -12,4 +21,82 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+std::string GetErrorReason() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207711453",
      "id" : 207711453,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzcxMTQ1Mw==",
      "original_commit_id" : "3b8ced6a4dca93015054688d862a9fd9fb2bf2f0",
      "original_position" : 20,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143385683,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207711453",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207711458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207711458"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `static`",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-04T15:29:03Z",
      "diff_hunk" : "@@ -12,4 +21,82 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+std::string GetErrorReason() {\n+    return std::strerror(errno);\n+}\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+    if (fd == -1) {\n+        reason = GetErrorReason();\n+    }\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    if (-1 == fcntl(fd, F_SETLK, &lock)) {\n+        reason = GetErrorReason();\n+        return false;\n+    }\n+    return true;\n+}\n+#else\n+\n+std::string GetErrorReason() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207711458",
      "id" : 207711458,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzcxMTQ1OA==",
      "original_commit_id" : "3b8ced6a4dca93015054688d862a9fd9fb2bf2f0",
      "original_position" : 57,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 143385692,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207711458",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207711930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207711930"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For reference, how these are logged by the callers:\r\nhttps://github.com/bitcoin/bitcoin/blob/2b67354aa584c4aabae049a67767ac7b70e2d01a/src/init.cpp#L1183-L1185\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/2b67354aa584c4aabae049a67767ac7b70e2d01a/src/wallet/db.cpp#L136-L139\r\n",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-04T15:44:45Z",
      "diff_hunk" : "@@ -158,18 +157,13 @@ bool LockDirectory(const fs::path& directory, const std::string lockfile_name, b\n     // Create empty lock file if it doesn't exist.\n     FILE* file = fsbridge::fopen(pathLockFile, \"a\");\n     if (file) fclose(file);\n-\n-    try {\n-        auto lock = MakeUnique<boost::interprocess::file_lock>(pathLockFile.string().c_str());\n-        if (!lock->try_lock()) {\n-            return false;\n-        }\n-        if (!probe_only) {\n-            // Lock successful and we're not just probing, put it into the map\n-            dir_locks.emplace(pathLockFile.string(), std::move(lock));\n-        }\n-    } catch (const boost::interprocess::interprocess_exception& e) {\n-        return error(\"Error while attempting to lock directory %s: %s\", directory.string(), e.what());\n+    auto lock = MakeUnique<fsbridge::FileLock>(pathLockFile);\n+    if (!lock->TryLock()) {\n+        return error(\"Error while attempting to lock directory %s: %s\", directory.string(), lock->GetReason());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r207711930",
      "id" : 207711930,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNzcxMTkzMA==",
      "original_commit_id" : "3b8ced6a4dca93015054688d862a9fd9fb2bf2f0",
      "original_position" : 35,
      "path" : "src/util.cpp",
      "position" : 35,
      "pull_request_review_id" : 143386243,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/207711930",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Update: use std codecvt instead of custom converter.",
      "created_at" : "2018-08-05T15:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-410527735",
      "id" : 410527735,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxMDUyNzczNQ==",
      "updated_at" : "2018-08-05T15:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410527735",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "lightly tested ACK 80119487840db0c3944a89f92772660ee594c4c3\r\n\r\ntested on-\r\n- Linux Ubuntu 18.04 ()\r\n- OpenBSD 6.3 ()\r\n- FreeBSD 11.2 ( )\r\n",
      "created_at" : "2018-08-27T12:33:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#issuecomment-416211421",
      "id" : 416211421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13862",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNjIxMTQyMQ==",
      "updated_at" : "2018-08-29T12:17:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/416211421",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r212958280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212958280"
         }
      },
      "author_association" : "MEMBER",
      "body" : "would prefer simply `fcntl(fd, F_SETLK, &lock) == -1` (more consistent with the other if statements in the code)",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-27T12:35:27Z",
      "diff_hunk" : "@@ -12,4 +19,82 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+static std::string GetErrorReason() {\n+    return std::strerror(errno);\n+}\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+    if (fd == -1) {\n+        reason = GetErrorReason();\n+    }\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    if (-1 == fcntl(fd, F_SETLK, &lock)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r212958280",
      "id" : 212958280,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjk1ODI4MA==",
      "original_commit_id" : "80119487840db0c3944a89f92772660ee594c4c3",
      "original_position" : 48,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 149691313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:55:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212958280",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r213042311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213042311"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "1661a472b8245eb4588fedbf19c9ed07a41e7602",
      "created_at" : "2018-08-27T16:56:07Z",
      "diff_hunk" : "@@ -12,4 +19,82 @@ FILE *freopen(const fs::path& p, const char *mode, FILE *stream)\n     return ::freopen(p.string().c_str(), mode, stream);\n }\n \n+#ifndef WIN32\n+\n+static std::string GetErrorReason() {\n+    return std::strerror(errno);\n+}\n+\n+FileLock::FileLock(const fs::path& file)\n+{\n+    fd = open(file.string().c_str(), O_RDWR);\n+    if (fd == -1) {\n+        reason = GetErrorReason();\n+    }\n+}\n+\n+FileLock::~FileLock()\n+{\n+    if (fd != -1) {\n+        close(fd);\n+    }\n+}\n+\n+bool FileLock::TryLock()\n+{\n+    if (fd == -1) {\n+        return false;\n+    }\n+    struct flock lock;\n+    lock.l_type = F_WRLCK;\n+    lock.l_whence = SEEK_SET;\n+    lock.l_start = 0;\n+    lock.l_len = 0;\n+    if (-1 == fcntl(fd, F_SETLK, &lock)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13862#discussion_r213042311",
      "id" : 213042311,
      "in_reply_to_id" : 212958280,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzA0MjMxMQ==",
      "original_commit_id" : "80119487840db0c3944a89f92772660ee594c4c3",
      "original_position" : 48,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 149794033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13862",
      "updated_at" : "2018-08-27T16:56:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213042311",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   }
]
