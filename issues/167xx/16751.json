{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "<!-- Describe the issue -->\r\n\r\nBitcoind seems to run ok, but anything that communicates with it via rpc such as lnd or bitcoin-cli is very slow/blocking for a long time. bitcoin-cli is blocking while waiting for bitcoind to answer. shutting down via bitcoin-cli stop (or even ctrl-c) doesn't terminate. bitcoind can only be finally shut down via kill -9.\r\n\r\n<!--- What behavior did you expect? -->\r\n\r\nbitcoind behaves normally when run on the same machine using ubuntu running in proot (with standard libraries like glibc) instead of pure termux with bionic.\r\n\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\n\r\nhere's a piece of debug log when doing bitcoin-cli stop:\r\n\r\n`2019-08-29T08:49:20Z libevent: epoll_dispatch: epoll_wait reports 1\r\n2019-08-29T08:49:20Z libevent: event_active: 0xb83355fc (fd 10), res 2, callback 0xb6a01141\r\n2019-08-29T08:49:20Z libevent: event_process_active: event: 0xb83355fc, EV_READ   call 0xb6a01141\r\n2019-08-29T08:49:20Z libevent: evhttp_get_request_connection: new request from 127.0.0.1:59610 on 77\r\n\r\n2019-08-29T08:49:20Z libevent: Attempting connection to 127.0.0.1:59610\r\n\r\n2019-08-29T08:49:20Z libevent: event_del: 0xafcea858 (fd -1), callback 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_del: 0xafcea898 (fd -1), callback 0xb69f99b5\r\n2019-08-29T08:49:20Z libevent: event_add: event: 0xafcea898 (fd 77),  EV_WRITE   call 0xb69f99b5\r\n2019-08-29T08:49:20Z libevent: Epoll ADD(4) on fd 77 okay. Old events were 0; read change was 0 (none); write change was 1 (add); close change was 0 (none)\r\n2019-08-29T08:49:20Z libevent: event_add: event: 0xafcea858 (fd 77), EV_READ    call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: Epoll MOD(5) on fd 77 okay. Old events were 4; read change was 1 (add); write change was 0 (none); close change was 0 (none)\r\n2019-08-29T08:49:20Z libevent: event_del: 0xafcea898 (fd 77), callback 0xb69f99b5\r\n2019-08-29T08:49:20Z libevent: Epoll MOD(1) on fd 77 okay. Old events were 6; read change was 0 (none); write change was 2 (del); close change was 0 (none)\r\n2019-08-29T08:49:20Z libevent: event_add: event: 0xafcea858 (fd 77), EV_READ   EV_TIMEOUT call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_add: event 0xafcea858, timeout in 30 seconds 0 useconds, call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_del: 0xafcea898 (fd 77), callback 0xb69f99b5\r\n2019-08-29T08:49:20Z libevent: event_add: event: 0xafcea858 (fd 77), EV_READ   EV_TIMEOUT call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_add: event 0xafcea858, timeout in 30 seconds 0 useconds, call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: timeout_next: event: 0xafcea858, in 30 seconds, 0 useconds\r\n2019-08-29T08:49:20Z libevent: epoll_dispatch: epoll_wait reports 1\r\n2019-08-29T08:49:20Z libevent: event_active: 0xafcea858 (fd 77), res 2, callback 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_process_active: event: 0xafcea858, EV_READ   call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_add: event: 0xafcea858 (fd 77), EV_READ   EV_TIMEOUT call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_add: event 0xafcea858, timeout in 279493 seconds 881162 useconds, call 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: evhttp_add_header: key: Host val: 127.0.0.1\r\n\r\n2019-08-29T08:49:20Z libevent: evhttp_add_header: key: Connection val: close\r\n\r\n2019-08-29T08:49:20Z libevent: evhttp_add_header: key: Authorization val: Basic XX...\r\n\r\n2019-08-29T08:49:20Z libevent: evhttp_add_header: key: Content-Length val: 37\r\n2019-08-29T08:49:20Z libevent: evhttp_read_header: checking for post data on 77\r\n\r\n2019-08-29T08:49:20Z libevent: evhttp_get_body_length: bytes to read: 37 (in buffer 37)\r\n\r\n2019-08-29T08:49:20Z libevent: event_del: 0xafcea858 (fd 77), callback 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: Epoll DEL(1) on fd 77 okay. Old events were 2; read change was 2 (del); write change was 0 (none); close change was 0 (none)\r\n2019-08-29T08:49:20Z libevent: event_del: 0xafcea858 (fd 77), callback 0xb69f98c5\r\n2019-08-29T08:49:20Z libevent: event_del: 0xafcea858 (fd 77), callback 0xb69f98c5\r\n2019-08-29T08:49:20Z Received a POST request for / from 127.0.0.1:59610\r\n2019-08-29T08:49:20Z ThreadRPCServer method=stop user=__cookie__\r\n2019-08-29T08:49:20Z libevent: evhttp_add_header: key: Content-Type val: application/json\r\n\r\n2019-08-29T08:49:20Z libevent: evhttp_add_header: key: Connection val: close\r\n\r\n2019-08-29T08:49:20Z libevent: event_active: 0xafe37410 (fd -1), res 0, callback 0xb6d05e4d\r\n2019-08-29T08:49:20Z Interrupting HTTP server\r\n2019-08-29T08:49:20Z Interrupting HTTP RPC server\r\n2019-08-29T08:49:20Z Interrupting RPC\r\n2019-08-29T08:49:20Z tor: Thread interrupt\r\n2019-08-29T08:49:20Z libevent: event_active: 0xafe376e0 (fd -1), res 1, callback 0xb69fc735\r\n2019-08-29T08:49:20Z Shutdown: In progress...\r\n2019-08-29T08:49:20Z Stopping HTTP RPC server\r\n2019-08-29T08:49:20Z Unregistering HTTP handler for / (exactmatch 1)\r\n2019-08-29T08:49:20Z Unregistering HTTP handler for /wallet/ (exactmatch 0)\r\n2019-08-29T08:49:20Z addcon thread exit\r\n2019-08-29T08:49:20Z net thread exit\r\n2019-08-29T08:49:20Z Stopping RPC\r\n2019-08-29T08:49:20Z msghand thread exit\r\n2019-08-29T08:49:20Z RPC stopped.\r\n2019-08-29T08:49:20Z Stopping HTTP server\r\n2019-08-29T08:49:20Z Waiting for HTTP worker threads to exit\r\n2019-08-29T08:49:20Z libevent: event_del: 0xb8335494 (fd 9), callback 0xb6a01141\r\n2019-08-29T08:49:20Z libevent: Epoll DEL(1) on fd 9 okay. Old events were 2; read change was 2 (del); write change was 0 (none); close change was 0 (none)\r\n2019-08-29T08:49:20Z libevent: event_del: 0xb83355fc (fd 10), callback 0xb6a01141\r\n2019-08-29T08:49:20Z libevent: Epoll DEL(1) on fd 10 okay. Old events were 2; read change was 2 (del); write change was 0 (none); close change was 0 (none)\r\n2019-08-29T08:49:20Z Waiting for HTTP event thread to exit\r\n2019-08-29T08:49:21Z ERROR: Error while reading proxy response\r\n2019-08-29T08:49:21Z opencon thread exit\r\n`\r\nand this is where both bitcoind and bitcoin-cli hang.\r\n\r\n<!--- How reliably can you reproduce the issue, what are the steps to do so? -->\r\n\r\nThis can be reproduced every time: start bitcoind. do anything with bitcoin-cli.\r\n\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\nthis is a self-compiled version of v0.18.1 for termux, the same happens on v0.18.0.\r\n \r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\nThe machine is a Sony Xperia Z android 5 smartphone running termux on flash media. \r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n\r\nI suspect it might be because of the bionic libs or libevent(_pthread), which is also modified because the native termux package doesn't contain the pthread-library. I can provide details on the compilation process if that's helpful. Maybe @esotericnonsense has any ideas, since he seems to have run bitcoind on termux before, though seemingly in a chroot. \r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751/comments",
   "created_at" : "2019-08-29T09:10:55Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751",
   "id" : 486834858,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU0ODY4MzQ4NTg=",
   "number" : 16751,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "strange behavior on termux",
   "updated_at" : "2019-08-29T09:10:55Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
      "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
      "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
      "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
      "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/stefanwouldgo",
      "id" : 722576,
      "login" : "stefanwouldgo",
      "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
      "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
      "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
      "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/stefanwouldgo"
   }
}
