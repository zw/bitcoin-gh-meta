[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I haven't used bitcoin on termux, but I do use termux, and you may want to experiment with termux-wake-lock: https://wiki.termux.com/wiki/Termux-wake-lock because by default android is very keen to put background processes to sleep, and also to turn of the wifi radio to conserve battery, and termux-wake-lock prevents this.",
      "created_at" : "2019-08-29T11:50:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-526150699",
      "id" : 526150699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjE1MDY5OQ==",
      "updated_at" : "2019-08-29T11:50:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526150699",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks, @ryanofsky, for pointing out the command line tool. I wasn't aware of it, always activating the wake-lock in the Android UI. That said, this is not the problem here. \r\n\r\nBitcoind works fine when I run it in a proot ubuntu jail within termux. Only when compiling it for natively running in termux are there these (very deterministic) issues.",
      "created_at" : "2019-08-29T12:41:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-526166917",
      "id" : 526166917,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjE2NjkxNw==",
      "updated_at" : "2019-08-29T12:41:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526166917",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, I didn't realize you were running with proot inside termux, not instead of termux. It sounds like there are two possibly related problems here: 1) RPC commands being slow and 2) bitcoin hanging on shutdown.\r\n\r\nThe hang on shutdown might be easy to debug with a stack trace. You could compile bitcoin with `--enable-debug` and run it in a debugger (`gdb -ex run --args /path/to/bitcoind -your-args-here`). Then when the hang happens you could ctrl-c to the GDB prompt and run `thread apply all bt` to get a trace with the state of all threads.\r\n\r\nIt also seems likely the shutdown hang is related to the `ERROR: Error while reading proxy response`, and maybe worth trying without the socks5 proxy, if possible.\r\n\r\nRPC commands responding slowly might be harder to debug. Though from the timestamps in the posted log, it at least seems like the stop RPC is being dispatched pretty quickly.\r\n\r\n\r\n\r\n",
      "created_at" : "2019-08-29T17:27:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-526283902",
      "id" : 526283902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjI4MzkwMg==",
      "updated_at" : "2019-08-29T17:27:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526283902",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Interesting: The debugger immediately tells me this directly at program start: \r\n`Program received signal SIGILL, Illegal instruction.                                                                                                                          âÂ·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·\r\n0xb6e753c0 in ?? () from /data/data/com.termux/files/usr/lib/libcrypto.so.1.1 `",
      "created_at" : "2019-08-30T09:57:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-526542165",
      "id" : 526542165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjU0MjE2NQ==",
      "updated_at" : "2019-08-30T09:57:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526542165",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Interesting: The debugger immediately tells me this directly at program start:\r\n> `Program received signal SIGILL, Illegal instruction. âÂ·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· 0xb6e753c0 in ?? () from /data/data/com.termux/files/usr/lib/libcrypto.so.1.1 `\r\n\r\nThat happens because libcrypto probes for hardware capabilities. You can run `handle SIGILL pass nostop noprint` in gdb to make gdb ignore it, see this stackexchange question: https://stackoverflow.com/questions/15071625/gdb-ddd-program-received-signal-sigill#15126760",
      "created_at" : "2019-09-13T14:11:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-531252517",
      "id" : 531252517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMTI1MjUxNw==",
      "updated_at" : "2019-09-13T14:11:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/531252517",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/18900601?v=4",
         "events_url" : "https://api.github.com/users/Grimler91/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Grimler91/followers",
         "following_url" : "https://api.github.com/users/Grimler91/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Grimler91/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Grimler91",
         "id" : 18900601,
         "login" : "Grimler91",
         "node_id" : "MDQ6VXNlcjE4OTAwNjAx",
         "organizations_url" : "https://api.github.com/users/Grimler91/orgs",
         "received_events_url" : "https://api.github.com/users/Grimler91/received_events",
         "repos_url" : "https://api.github.com/users/Grimler91/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Grimler91/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Grimler91/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Grimler91"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Issue unreproducible for latest bitcoin build from termux-packages [master](https://github.com/termux/termux-packages/tree/master/packages/bitcoin) branch.",
      "created_at" : "2019-09-18T11:06:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-532636016",
      "id" : 532636016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjYzNjAxNg==",
      "updated_at" : "2019-09-18T11:06:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532636016",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25881154?v=4",
         "events_url" : "https://api.github.com/users/xeffyr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/xeffyr/followers",
         "following_url" : "https://api.github.com/users/xeffyr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/xeffyr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/xeffyr",
         "id" : 25881154,
         "login" : "xeffyr",
         "node_id" : "MDQ6VXNlcjI1ODgxMTU0",
         "organizations_url" : "https://api.github.com/users/xeffyr/orgs",
         "received_events_url" : "https://api.github.com/users/xeffyr/received_events",
         "repos_url" : "https://api.github.com/users/xeffyr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/xeffyr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/xeffyr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/xeffyr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "confirmed. issue doesn't arise in master-branch (build on android API 24), but does persist in the same build with API 20. \r\n\r\nEasy test: start bitcoind, terminate (CTRL-C) after startup. In the Android 5 (API 20) version, this doesn't stop the process, but logs\r\n```\r\n2019-09-18T13:19:40Z tor: Thread interrupt\r\n2019-09-18T13:19:40Z addcon thread exit\r\n2019-09-18T13:19:40Z Shutdown: In progress...\r\n2019-09-18T13:19:40Z net thread exit\r\n2019-09-18T13:19:41Z ERROR: Error while reading proxy response\r\n2019-09-18T13:19:41Z opencon thread exit\r\n2019-09-18T13:19:50Z UpdateTip: new best=000000000000000000079c43fb770154f8d5783a78017532491a6787d6282a24 height=595445 version=0x20000000 log2_work=91.102336 tx=456382083 date='2019-09-18T13:14:36Z' progress=0.\r\n999997 cache=0.5MiB(4736txo) warning='51 of last 100 blocks have unexpected version'\r\n2019-09-18T13:19:50Z msghand thread exit\r\n2019-09-18T13:59:38Z Potential stale tip detected, will try using extra outbound peer (last tip update: 2388 seconds ago)\r\n2019-09-18T14:10:08Z Potential stale tip detected, will try using extra outbound peer (last tip update: 3018 seconds ago)\r\n2019-09-18T14:20:38Z Potential stale tip detected, will try using extra outbound peer (last tip update: 3648 seconds ago)\r\n2019-09-18T14:31:08Z Potential stale tip detected, will try using extra outbound peer (last tip update: 4278 seconds ago)\r\n2019-09-18T14:41:38Z Potential stale tip detected, will try using extra outbound peer (last tip update: 4908 seconds ago)\r\n2019-09-18T14:52:08Z Potential stale tip detected, will try using extra outbound peer (last tip update: 5538 seconds ago)\r\n2019-09-18T15:02:38Z Potential stale tip detected, will try using extra outbound peer (last tip update: 6168 seconds ago)\r\n2019-09-18T15:13:08Z Potential stale tip detected, will try using extra outbound peer (last tip update: 6798 seconds ago)\r\n2019-09-18T15:23:38Z Potential stale tip detected, will try using extra outbound peer (last tip update: 7428 seconds ago)\r\n```\r\nThis might give some insight into what thread stays alive.",
      "created_at" : "2019-09-18T15:33:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-532740102",
      "id" : 532740102,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjc0MDEwMg==",
      "updated_at" : "2019-09-18T15:33:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532740102",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "the logs suggest that `scheduler thread interrupt` doesn't happen in the faulty builds.",
      "created_at" : "2019-09-18T16:26:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-532761761",
      "id" : 532761761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjc2MTc2MQ==",
      "updated_at" : "2019-09-18T16:26:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532761761",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> The hang on shutdown might be easy to debug with a stack trace. You could compile bitcoin with `--enable-debug` and run it in a debugger (`gdb -ex run --args /path/to/bitcoind -your-args-here`). Then when the hang happens you could ctrl-c to the GDB prompt and run `thread apply all bt` to get a trace with the state of all threads.\r\n\r\nRunning in gdb (and skipping the illegal instruction) is interesting, because after sending signal 2 once, bitcoind hangs, but after sending a second signal 2 (from gdb), it actually terminates (unlike without gdb). Here's the state of all threads after hanging: \r\n\r\n\r\n```\r\nThread 13 (LWP 15955):\r\n#0  0xb6cada88 in syscall () from /system/lib/libc.so\r\n#1  0xb6cb14bc in __pthread_cond_timedwait_relative(pthread_cond_t*, pthread_mutex_t*, timespec const*) () from /system/lib/libc.so\r\n#2  0x2a2f33d4 in leveldb::(anonymous namespace)::PosixEnv::BGThread (this=<optimized out>) at leveldb/util/env_posix.cc:649\r\n#3  0x2a2f32bc in leveldb::(anonymous namespace)::PosixEnv::BGThreadWrapper (arg=0x0) at leveldb/util/env_posix.cc:564\r\n#4  0xb6cb15e8 in __pthread_start(void*) () from /system/lib/libc.so\r\n#5  0xb6caf514 in __start_thread () from /system/lib/libc.so\r\n#6  0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\nThread 12 (LWP 15954):\r\n#0  0xb6cd7634 in __epoll_pwait () from /system/lib/libc.so\r\n#1  0xb6caf7b2 in epoll_pwait () from /system/lib/libc.so\r\n#2  0xb6caf7c0 in epoll_wait () from /system/lib/libc.so\r\n#3  0xb6db3e9e in ?? () from /data/data/com.termux/files/usr/lib/libzmq.so\r\n#4  0xb6dd28e4 in ?? () from /data/data/com.termux/files/usr/lib/libzmq.so\r\n#5  0xb6cb15e8 in __pthread_start(void*) () from /system/lib/libc.so\r\n#6  0xb6caf514 in __start_thread () from /system/lib/libc.so\r\n#7  0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\nThread 11 (LWP 15953):\r\n#0  0xb6cd7634 in __epoll_pwait () from /system/lib/libc.so\r\n#1  0xb6caf7b2 in epoll_pwait () from /system/lib/libc.so\r\n#2  0xb6caf7c0 in epoll_wait () from /system/lib/libc.so\r\n#3  0xb6db3e9e in ?? () from /data/data/com.termux/files/usr/lib/libzmq.so\r\n#4  0xb6dd28e4 in ?? () from /data/data/com.termux/files/usr/lib/libzmq.so\r\n#5  0xb6cb15e8 in __pthread_start(void*) () from /system/lib/libc.so\r\n#6  0xb6caf514 in __start_thread () from /system/lib/libc.so\r\n#7  0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\nThread 6 (LWP 15942):\r\n#0  0xb6cd7634 in __epoll_pwait () from /system/lib/libc.so\r\n#1  0xb6caf7b2 in epoll_pwait () from /system/lib/libc.so\r\n#2  0xb6caf7c0 in epoll_wait () from /system/lib/libc.so\r\n#3  0xb6e0bdc4 in ?? () from /data/data/com.termux/files/usr/lib/libevent-2.1.so\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\nThread 5 (LWP 15941):\r\n--Type <RET> for more, q to quit, c to continue without paging--\r\n#0  0xb6cada88 in syscall () from /system/lib/libc.so\r\n#1  0xb6cb14bc in __pthread_cond_timedwait_relative(pthread_cond_t*, pthread_mutex_t*, timespec const*) () from /system/lib/libc.so\r\n#2  0xb6cb1500 in __pthread_cond_timedwait(pthread_cond_t*, pthread_mutex_t*, timespec const*, int) () from /system/lib/libc.so\r\n#3  0x2a292770 in boost::condition_variable::do_wait_until (this=0x2a527bfc <scheduler+12>, m=..., timeout=...) at /data/data/com.termux/files/usr/include/boost/thread/pthread/condition_variable.hpp:122\r\n#4  0x2a291210 in boost::condition_variable::wait_until<boost::chrono::system_clock, boost::chrono::duration<long long, boost::ratio<1ll, 1000000000ll> > > (this=0x2c, lock=..., t=...) at /data/data/com.termux/files/usr/include/boost/thread/pthread/condition_variable_fwd.hpp:271\r\n#5  0x2a2908da in CScheduler::serviceQueue (this=0x2a527bf0 <scheduler>) at scheduler.cpp:66\r\n#6  0x2a048602 in std::__ndk1::__bind<void (CScheduler::*)(), CScheduler*>::operator()<> (this=0xb4790d3c) at /home/builder/.termux-build/_cache/android5-r20-api-21-v1/bin/../sysroot/usr/include/c++/v1/functional:2677\r\n#7  0x2a035d84 in TraceThread<std::__ndk1::function<void ()> >(char const*, std::__ndk1::function<void ()>) (name=0x2a468145 \"scheduler\", func=...) at ./util/system.h:332\r\n#8  0x2a048a46 in std::__ndk1::__invoke<void (*&)(char const*, std::__ndk1::function<void ()>), char const*&, std::__ndk1::function<void ()>&> (__f=<optimized out>, __args=..., __args=...) at /home/builder/.termux-build/_cache/android5-r20-api-21-v1/bin/../sysroot/usr/include/c++/v1/type_traits:4353\r\n#9  0x2a0489b2 in std::__ndk1::__bind<void (*)(char const*, std::__ndk1::function<void ()>), char const (&) [10], std::__ndk1::function<void ()>&>::operator()<> (this=0x2a6492c0) at /home/builder/.termux-build/_cache/android5-r20-api-21-v1/bin/../sysroot/usr/include/c++/v1/functional:2677\r\n#10 0xb6fc0d48 in ?? () from /data/data/com.termux/files/usr/lib/libboost_thread.so.1.70.0\r\n#11 0xb6cb15e8 in __pthread_start(void*) () from /system/lib/libc.so\r\n#12 0xb6caf514 in __start_thread () from /system/lib/libc.so\r\n#13 0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\n\r\nThread 4 (LWP 15940):\r\n#0  0xb6cada88 in syscall () from /system/lib/libc.so\r\n#1  0xb6cb14bc in __pthread_cond_timedwait_relative(pthread_cond_t*, pthread_mutex_t*, timespec const*) () from /system/lib/libc.so\r\n#2  0x2a038486 in boost::condition_variable::wait (this=0x2a529200 <scriptcheckqueue+4>, m=...) at /data/data/com.termux/files/usr/include/boost/thread/pthread/condition_variable.hpp:79\r\n#3  0x2a18116e in CCheckQueue<CScriptCheck>::Loop (this=0x2a5291fc <scriptcheckqueue>, fMaster=false) at ./checkqueue.h:99\r\n#4  0xb6fc0d48 in ?? () from /data/data/com.termux/files/usr/lib/libboost_thread.so.1.70.0\r\n#5  0xb6cb15e8 in __pthread_start(void*) () from /system/lib/libc.so\r\n#6  0xb6caf514 in __start_thread () from /system/lib/libc.so\r\n#7  0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\nThread 3 (LWP 15939):\r\n#0  0xb6cada88 in syscall () from /system/lib/libc.so\r\n#1  0xb6cb14bc in __pthread_cond_timedwait_relative(pthread_cond_t*, pthread_mutex_t*, timespec const*) () from /system/lib/libc.so\r\n#2  0x2a038486 in boost::condition_variable::wait (this=0x2a529200 <scriptcheckqueue+4>, m=...) at /data/data/com.termux/files/usr/include/boost/thread/pthread/condition_variable.hpp:79\r\n#3  0x2a18116e in CCheckQueue<CScriptCheck>::Loop (this=0x2a5291fc <scriptcheckqueue>, fMaster=false) at ./checkqueue.h:99\r\n#4  0xb6fc0d48 in ?? () from /data/data/com.termux/files/usr/lib/libboost_thread.so.1.70.0\r\n#5  0xb6cb15e8 in __pthread_start(void*) () from /system/lib/libc.so\r\n--Type <RET> for more, q to quit, c to continue without paging--\r\n#6  0xb6caf514 in __start_thread () from /system/lib/libc.so\r\n#7  0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\nThread 2 (LWP 15938):\r\n#0  0xb6cada88 in syscall () from /system/lib/libc.so\r\n#1  0xb6cb14bc in __pthread_cond_timedwait_relative(pthread_cond_t*, pthread_mutex_t*, timespec const*) () from /system/lib/libc.so\r\n#2  0x2a038486 in boost::condition_variable::wait (this=0x2a529200 <scriptcheckqueue+4>, m=...) at /data/data/com.termux/files/usr/include/boost/thread/pthread/condition_variable.hpp:79\r\n#3  0x2a18116e in CCheckQueue<CScriptCheck>::Loop (this=0x2a5291fc <scriptcheckqueue>, fMaster=false) at ./checkqueue.h:99\r\n#4  0xb6fc0d48 in ?? () from /data/data/com.termux/files/usr/lib/libboost_thread.so.1.70.0\r\n#5  0xb6cb15e8 in __pthread_start(void*) () from /system/lib/libc.so\r\n#6  0xb6caf514 in __start_thread () from /system/lib/libc.so\r\n#7  0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n\r\nThread 1 (LWP 15885):\r\n#0  0xb6cada88 in syscall () from /system/lib/libc.so\r\n#1  0xb6cb1bca in pthread_join () from /system/lib/libc.so\r\n#2  0xb6d7a82c in ?? () from /data/data/com.termux/files/usr/lib/libc++_shared.so\r\n#3  0x2a1c5834 in StopHTTPServer () at httpserver.cpp:468\r\n#4  0x2a02ace6 in Shutdown (interfaces=...) at init.cpp:211\r\n#5  0x2a0259e4 in AppInit (argc=<optimized out>, argv=<optimized out>) at bitcoind.cpp:185\r\n#6  0x2a02558c in main (argc=-1268195320, argv=0x0) at bitcoind.cpp:201\r\n`",
      "created_at" : "2019-09-23T09:42:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-534028733",
      "id" : 534028733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDAyODczMw==",
      "updated_at" : "2019-09-23T11:38:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534028733",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Btw, these are the logs around the shutdown. Looks to me as if the http event thread is the culprit.\r\n\r\n```\r\n2019-09-23T09:32:48Z Shutdown requested. Exiting.                                                        \r\n2019-09-23T09:32:48Z Interrupting HTTP server                                                            \r\n[LWP 15943 exited]                                                                                                                                                                                                 \r\n[LWP 15950 exited]                                                                                                                                                                                                 \r\n[LWP 15944 exited]                                                                                                                                                                                                 \r\n[LWP 15949 exited]                                                                                                                                                                                                 \r\n2019-09-23T09:32:48Z Interrupting HTTP RPC server                                                        \r\n2019-09-23T09:32:48Z Interrupting RPC                                                                    \r\n2019-09-23T09:32:48Z Shutdown: In progress...                                                            \r\n2019-09-23T09:32:48Z Stopping HTTP RPC server                                                            \r\n2019-09-23T09:32:48Z Unregistering HTTP handler for / (exactmatch 1)                                     \r\n2019-09-23T09:32:48Z Unregistering HTTP handler for /wallet/ (exactmatch 0)                              \r\n2019-09-23T09:32:48Z Stopping RPC                                                                        \r\n2019-09-23T09:32:48Z RPC stopped.                                                                                                                                                                                  \r\n2019-09-23T09:32:48Z Stopping HTTP server                                                                                                                                                                          \r\n2019-09-23T09:32:48Z Waiting for HTTP worker threads to exit                                                                                                                                                       \r\n2019-09-23T09:32:48Z libevent: event_del: 0x2a67d83c (fd 9), callback 0xb6e0a699                                                                                                                                   \r\n2019-09-23T09:32:48Z libevent: Epoll DEL(1) on fd 9 okay. Old events were 2; read change was 2 (del); write change was 0 (none); close change was 0 (none)                                                         \r\n2019-09-23T09:32:48Z libevent: event_del: 0x2a67d9b4 (fd 10), callback 0xb6e0a699                        \r\n2019-09-23T09:32:48Z libevent: Epoll DEL(1) on fd 10 okay. Old events were 2; read change was 2 (del); write change was 0 (none); close change was 0 (none)                                                        \r\n2019-09-23T09:32:48Z Waiting for HTTP event thread to exit        \r\n\r\n(gdb) signal 2\r\nContinuing with signal SIGINT.\r\n2019-09-23T09:45:03Z libevent: event_base_loop: no events registered.\r\n2019-09-23T09:45:03Z Exited http event loop\r\n2019-09-23T09:45:03Z libevent: event_base_free_: 0 events freed\r\n2019-09-23T09:45:03Z Stopped HTTP server\r\n[LWP 15942 exited]\r\n2019-09-23T09:45:04Z scheduler thread interrupt\r\n[LWP 15941 exited]\r\n[LWP 15939 exited]\r\n[LWP 15938 exited]\r\n[LWP 15940 exited]\r\n2019-09-23T09:45:04Z WriteBatch memory usage: db=index, before=0.1MiB, after=0.1MiB\r\n2019-09-23T09:45:04Z Writing final batch of 0.00 MiB\r\n2019-09-23T09:45:04Z WriteBatch memory usage: db=chainstate, before=4.0MiB, after=4.0MiB\r\n2019-09-23T09:45:04Z Committed 0 changed transaction outputs (out of 0) to coin database...\r\n2019-09-23T09:45:04Z WriteBatch memory usage: db=index, before=0.1MiB, after=0.1MiB\r\n2019-09-23T09:45:04Z Writing final batch of 0.00 MiB\r\n2019-09-23T09:45:04Z WriteBatch memory usage: db=chainstate, before=4.0MiB, after=4.0MiB\r\n2019-09-23T09:45:04Z Committed 0 changed transaction outputs (out of 0) to coin database...\r\n2019-09-23T09:45:04Z zmq: Shutdown notification interface\r\n2019-09-23T09:45:04Z zmq: Shutdown notifier pubrawblock at tcp://127.0.0.1:28332\r\n2019-09-23T09:45:04Z zmq: Close socket at address tcp://127.0.0.1:28332\r\n2019-09-23T09:45:04Z zmq: Shutdown notifier pubrawtx at tcp://127.0.0.1:28333\r\n2019-09-23T09:45:04Z zmq: Close socket at address tcp://127.0.0.1:28333\r\n[LWP 15953 exited]\r\n[LWP 15954 exited]\r\n2019-09-23T09:45:04Z Shutdown: done\r\n[LWP 15885 exited]\r\n[Inferior 1 (process 15885) exited with code 01]\r\n",
      "created_at" : "2019-09-23T09:49:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-534031117",
      "id" : 534031117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDAzMTExNw==",
      "updated_at" : "2019-09-23T11:38:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534031117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "\r\n> Issue unreproducible for latest bitcoin build from termux-packages [master](https://github.com/termux/termux-packages/tree/master/packages/bitcoin) branch.\r\n\r\nThe only noticeable difference between the master (ndk 24) and android-5 (ndk-21) builds that I have found so far is that ldd on android-5 gives\r\n`libboost_system.so.1.70.0 ` as an additional needed lib that doesn't seem to be needed in master. I don't know why that is, since the build recipes seem to be the same.\r\n\r\n\r\n",
      "created_at" : "2019-09-24T09:47:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-534482327",
      "id" : 534482327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDQ4MjMyNw==",
      "updated_at" : "2019-09-24T09:47:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534482327",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@stefanwouldgo There noticeable differences in used libc on Android 5 and Android 7+ devices.",
      "created_at" : "2019-09-24T11:49:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-534522299",
      "id" : 534522299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDUyMjI5OQ==",
      "updated_at" : "2019-09-24T11:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534522299",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25881154?v=4",
         "events_url" : "https://api.github.com/users/xeffyr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/xeffyr/followers",
         "following_url" : "https://api.github.com/users/xeffyr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/xeffyr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/xeffyr",
         "id" : 25881154,
         "login" : "xeffyr",
         "node_id" : "MDQ6VXNlcjI1ODgxMTU0",
         "organizations_url" : "https://api.github.com/users/xeffyr/orgs",
         "received_events_url" : "https://api.github.com/users/xeffyr/received_events",
         "repos_url" : "https://api.github.com/users/xeffyr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/xeffyr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/xeffyr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/xeffyr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @stefanwouldgo There noticeable differences in used libc on Android 5 and Android 7+ devices.\r\n\r\nI don't think libc should be the culprit, because the working builds for Android 5 (with all dependencies included from the bitcoin repo) still dynamically link to libc.",
      "created_at" : "2019-09-25T09:24:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-534934617",
      "id" : 534934617,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDkzNDYxNw==",
      "updated_at" : "2019-09-25T09:24:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534934617",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I've now tried to replace every dependency except openssl with the one in depends, with no apparent effect. So my current theory is that the problem is in openssl. Unfortunately, the earliest existing termux version of this is already beyond 1.0.1k from depends (and all versions are heavily patched), and I haven't been able to use only openssl from depends (but not the other dependencies).",
      "created_at" : "2019-10-01T09:05:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-536942892",
      "id" : 536942892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNjk0Mjg5Mg==",
      "updated_at" : "2019-10-01T09:05:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/536942892",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/722576?v=4",
         "events_url" : "https://api.github.com/users/stefanwouldgo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stefanwouldgo/followers",
         "following_url" : "https://api.github.com/users/stefanwouldgo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stefanwouldgo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stefanwouldgo",
         "id" : 722576,
         "login" : "stefanwouldgo",
         "node_id" : "MDQ6VXNlcjcyMjU3Ng==",
         "organizations_url" : "https://api.github.com/users/stefanwouldgo/orgs",
         "received_events_url" : "https://api.github.com/users/stefanwouldgo/received_events",
         "repos_url" : "https://api.github.com/users/stefanwouldgo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stefanwouldgo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stefanwouldgo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stefanwouldgo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "FWIW: OpenSSL is not a dependency of recent versions of Bitcoin Core, definitely not without the GUI, and recently not even with the GU unless `--enable-bip70` is provided.\r\n\r\nSo I strongly doubt it can cause this behavior.",
      "created_at" : "2019-10-02T09:37:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16751#issuecomment-537416760",
      "id" : 537416760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16751",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNzQxNjc2MA==",
      "updated_at" : "2019-10-02T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/537416760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
