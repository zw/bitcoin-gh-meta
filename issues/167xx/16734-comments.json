[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "So should we avoid `make dist` in the gitian builds, or put a `git archive` step in the `dist-hook`? The latter would make two tarballs & have issues with gitignore, which is undesirable. But at the same time, not using `make dist` goes against autotools principles.\r\n\r\nAlso, the generated build files are automatically added to the tarball in `make dist`. If we plan to `git archive` the original source, they'd still have to be generated and appended. `EXTRA_DIST` directories might just be easier for standard `make` targets.\r\n\r\nGenerated files that we want to include (I think):\r\n```\r\naclocal.m4\r\nMakefile.in\r\nconfigure\r\nconfig.guess\r\nconfig.sub\r\n(recursive)\r\n\r\nltmain.sh\r\ninstall-sh\r\ndepcomp\r\n(recursive)\r\n\r\nsrc/config/bitcoin-config.h.in\r\nsrc/secp2561/src/libsecp256k1-config.h.in\r\n```\r\n\r\nRelated info:\r\nhttps://www.gnu.org/software/automake/faq/autotools-faq.html#Which-files-are-hand_002dwritten-and-which-generated-_0028and-how_0029_003f\r\n",
      "created_at" : "2019-09-17T12:17:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16734#issuecomment-532194865",
      "id" : 532194865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16734",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjE5NDg2NQ==",
      "updated_at" : "2019-09-24T22:00:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532194865",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2287825?v=4",
         "events_url" : "https://api.github.com/users/ch4ot1c/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ch4ot1c/followers",
         "following_url" : "https://api.github.com/users/ch4ot1c/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ch4ot1c/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ch4ot1c",
         "id" : 2287825,
         "login" : "ch4ot1c",
         "node_id" : "MDQ6VXNlcjIyODc4MjU=",
         "organizations_url" : "https://api.github.com/users/ch4ot1c/orgs",
         "received_events_url" : "https://api.github.com/users/ch4ot1c/received_events",
         "repos_url" : "https://api.github.com/users/ch4ot1c/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ch4ot1c/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ch4ot1c/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ch4ot1c"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The autotools faq just say that `configure` (et al.) are \"Generated on the developer system\", but don't give a reason for it. I think it is fine and not too much to ask of a user that wishes to compile from source to call `./autogen.sh && ./configure && make` instead of `./configure && make`.",
      "created_at" : "2019-09-23T13:45:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16734#issuecomment-534105551",
      "id" : 534105551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16734",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDEwNTU1MQ==",
      "updated_at" : "2019-09-23T13:45:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534105551",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> but don't give a reason for it\r\n\r\nIt's probably ok to require autogen. I think historically configure scripts were supposed to work on obscure unix systems that would just have a generic shell + make tool + c compiler, and not necessarily need gnu packages like m4 which are needed for autogen.",
      "created_at" : "2019-09-23T15:01:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16734#issuecomment-534139356",
      "id" : 534139356,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16734",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDEzOTM1Ng==",
      "updated_at" : "2019-09-23T15:01:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534139356",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "comment by @laanwj \r\n\r\n> I agree, I've never been a fan of it. I don't think we have any files in the git repository we don't want to ship in the source tarball.\r\n\r\nfrom https://github.com/bitcoin/bitcoin/pull/17097#issuecomment-540706025",
      "created_at" : "2019-10-10T18:21:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16734#issuecomment-540710663",
      "id" : 540710663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16734",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDcxMDY2Mw==",
      "updated_at" : "2019-10-10T18:21:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540710663",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, concept ACK, I think. I also think it's fine to require autogen. What is one dependency more, if you're building from source.\r\n\r\nI suppose the practical issue is: is `git archive` output deterministic?\r\n",
      "created_at" : "2019-10-10T19:01:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16734#issuecomment-540729483",
      "id" : 540729483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16734",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDcyOTQ4Mw==",
      "updated_at" : "2019-10-10T19:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540729483",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj I think we'll still have to use `faketime`, even though the archive doesn't include the `.git` directory. Nearly deterministic.\r\n\r\nHere's what I've come up with so far, based on above discussion:\r\n\r\n```\r\ndist-hook:\r\n\t- $(GIT) archive --format=tar HEAD -- src/clientversion.cpp | $(AMTAR) -C $(top_distdir) -xf -\r\n\t- $(GIT) rm \".gitignore\"; $(GIT) add \".gitignore\"; $(GIT) stash --all;\r\n\t- $(GIT) archive --prefix=\"$(PACKAGE)-$(VERSION)/\" stash@{0} -- . >\"$(PACKAGE)-$(VERSION)-archive.tar.gz\r\n\t- $(GIT) stash pop\r\n\t- $(GIT) checkout -- \".gitignore\"\r\n```\r\n\r\nRemaining problems:\r\n\r\n1. Creates two archives, since `make dist` creates one automatically (swallow somehow?). Therefore, for now the `git archive` output has `-archive` as a suffix.\r\n2. Not deterministic\r\n3. Compatibility with existing gitian descriptors\r\n\r\nI'm less familiar with the Gitian system, so I'll read up on it, but feel free to run with this example.",
      "created_at" : "2019-10-10T20:35:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16734#issuecomment-540779593",
      "id" : 540779593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16734",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDc3OTU5Mw==",
      "updated_at" : "2019-10-10T20:35:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540779593",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2287825?v=4",
         "events_url" : "https://api.github.com/users/ch4ot1c/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ch4ot1c/followers",
         "following_url" : "https://api.github.com/users/ch4ot1c/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ch4ot1c/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ch4ot1c",
         "id" : 2287825,
         "login" : "ch4ot1c",
         "node_id" : "MDQ6VXNlcjIyODc4MjU=",
         "organizations_url" : "https://api.github.com/users/ch4ot1c/orgs",
         "received_events_url" : "https://api.github.com/users/ch4ot1c/received_events",
         "repos_url" : "https://api.github.com/users/ch4ot1c/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ch4ot1c/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ch4ot1c/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ch4ot1c"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The hook is run after dist, so you could just overwrite the previous archive?",
      "created_at" : "2019-10-10T20:42:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16734#issuecomment-540783764",
      "id" : 540783764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16734",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDc4Mzc2NA==",
      "updated_at" : "2019-10-10T20:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540783764",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
