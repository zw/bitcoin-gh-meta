{
   "assignee" : null,
   "body" : "We are currently flushing the wallet after every operation.\r\nThis is very slow. In case of syncing txs, we need performance, rather than\r\ndurability. Our SetBestChain-mechanism ensures, that txs from a block are always synced,\r\neven on a crash, as we rescan the necessary blocks on startup.\r\nThe FlushWalletThread only flushes, if there is no wallet-update for 2 seconds.\r\n\r\nI tested replacing the txn_checkpoint(..) call with\r\nlog_flush, but this does not help.\r\n\r\nCurrently I can only add about 10 txs per second to the wallet on my machine.\r\nAfter this patch its more than 1000 txs per second.\r\n\r\nFor example importaddress mvqaxopu9Uef2qjXSV3fGrp6DcEYnCoYWK\r\nadds about 20000 txs to the wallet.\r\nTogether with these optimizations #4702  #4712 you hardly notice the difference between a normal\r\nrescan and adding 20000 txs to the wallet.\r\nCurrently this takes hours, I had to let my client running over night, in order to finish.\r\nThe overall performance increase is like factor 500 or so on a larger wallet.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 6,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4805/comments",
   "created_at" : "2014-08-31T23:19:24Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4805/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/4805",
   "id" : 41598627,
   "labels" : [
      {
         "color" : "02d7e1",
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4805/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 4805,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/4805.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4805",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/4805.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4805"
   },
   "state" : "open",
   "title" : "[Wallet] Do not flush the wallet in AddToWalletIfInvolvingMe(..)",
   "updated_at" : "2014-12-31T11:57:24Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4805",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=3",
      "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
      "followers_url" : "https://api.github.com/users/cozz/followers",
      "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
      "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/cozz",
      "id" : 2814559,
      "login" : "cozz",
      "organizations_url" : "https://api.github.com/users/cozz/orgs",
      "received_events_url" : "https://api.github.com/users/cozz/received_events",
      "repos_url" : "https://api.github.com/users/cozz/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/cozz"
   }
}
