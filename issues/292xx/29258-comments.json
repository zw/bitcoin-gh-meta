[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Background: https://github.com/bitcoin/bitcoin/pull/13875 and https://github.com/bitcoin/bitcoin/pull/1677",
      "created_at" : "2024-01-17T07:51:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1895271451",
      "id" : 1895271451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585w94wb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1895271451/reactions"
      },
      "updated_at" : "2024-01-17T07:51:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1895271451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Would this be a hard fork because it would be loosening the conditions for validation?",
      "created_at" : "2024-01-27T16:24:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1913242734",
      "id" : 1913242734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585yCcRu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1913242734/reactions"
      },
      "updated_at" : "2024-01-27T16:24:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1913242734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3104223?v=4",
         "events_url" : "https://api.github.com/users/russeree/events{/privacy}",
         "followers_url" : "https://api.github.com/users/russeree/followers",
         "following_url" : "https://api.github.com/users/russeree/following{/other_user}",
         "gists_url" : "https://api.github.com/users/russeree/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/russeree",
         "id" : 3104223,
         "login" : "russeree",
         "node_id" : "MDQ6VXNlcjMxMDQyMjM=",
         "organizations_url" : "https://api.github.com/users/russeree/orgs",
         "received_events_url" : "https://api.github.com/users/russeree/received_events",
         "repos_url" : "https://api.github.com/users/russeree/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/russeree/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/russeree/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/russeree"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Would this be a hard fork because it would be loosening the conditions for validation?\r\n\r\nI don't think so, since I don't think the value of `nChainTx` is used in validation (or do you see a spot where it is?). It's used for logging (progress estimation), and whether it is 0 is used in `HaveNumChainTxs`. The latter could become problematic in case of an overflow, since if the `unsigned int` would overflow exactly to zero (which is a bit unlikely given that there are a few thousand txns in each block but ceratainly possible) the node would crash in https://github.com/bitcoin/bitcoin/blob/478ac185be49feffd1231366c07e06068683f941/src/validation.cpp#L3017.",
      "created_at" : "2024-01-29T16:29:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1915076242",
      "id" : 1915076242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585yJb6S",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915076242/reactions"
      },
      "updated_at" : "2024-01-29T16:29:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915076242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "^^^ The above was the line that I was referencing. Thank you. ",
      "created_at" : "2024-01-29T16:44:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1915126021",
      "id" : 1915126021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585yJoEF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915126021/reactions"
      },
      "updated_at" : "2024-01-29T16:44:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915126021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3104223?v=4",
         "events_url" : "https://api.github.com/users/russeree/events{/privacy}",
         "followers_url" : "https://api.github.com/users/russeree/followers",
         "following_url" : "https://api.github.com/users/russeree/following{/other_user}",
         "gists_url" : "https://api.github.com/users/russeree/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/russeree",
         "id" : 3104223,
         "login" : "russeree",
         "node_id" : "MDQ6VXNlcjMxMDQyMjM=",
         "organizations_url" : "https://api.github.com/users/russeree/orgs",
         "received_events_url" : "https://api.github.com/users/russeree/received_events",
         "repos_url" : "https://api.github.com/users/russeree/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/russeree/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/russeree/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/russeree"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There was also the idea of dropping this number entirely: https://github.com/bitcoin/bitcoin/pull/13875#issuecomment-410472259\r\n\r\nThough see also https://github.com/bitcoin/bitcoin/pull/13875#issuecomment-750715082",
      "created_at" : "2024-02-06T11:26:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1929320537",
      "id" : 1929320537,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585y_xhZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1929320537/reactions"
      },
      "updated_at" : "2024-02-06T11:28:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1929320537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Though see also https://github.com/bitcoin/bitcoin/pull/13875#issuecomment-750715082\r\n\r\nThis is `nTx`, not `nChainTx`.",
      "created_at" : "2024-02-06T11:44:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1929346759",
      "id" : 1929346759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585y_37H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1929346759/reactions"
      },
      "updated_at" : "2024-02-06T11:44:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1929346759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "For reference, I removed `nChainTx` from consensus in https://github.com/bitcoin/bitcoin/pull/29349. The next steps would be to add a member to `CChain` to account for the sum of `nTx`, and update it when `SetTip` is called. Then, update the RPC, wallet and estimate functions to derive the `nChainTx` they need from the `nChainTx` at the tip, walking the relevant portion of the chain.\r\n\r\nThis is possible, but I am not sure if it is worth it, because:\r\n\r\n* It is more code overall.\r\n* The RPC, wallet, and logging code is slower when it has to walk the chain.\r\n\r\nThe benefit mainly seems to be to reduce the memory footprint? On 64-bit platforms, `sizeof(CBlockIndex)` is 144. Adding 4 bytes or removing 4 bytes is less than 10% of cost or savings. Ref: https://godbolt.org/z/rKEPYTh4j\r\n\r\nRemoving `nTx` is even harder, so less worth it. Especially, given that it could be reduced to 16 bits in the memory layout, if needed.\r\n\r\nThis leads to an alternative solution to not increase the memory footprint: Move the 32+32 bits used for nTx and nChainTx into a single 64-bit blob, where the 16 bit are for nTx and the remaining for nChainTx. But, again, the overall heap memory usage shouldn't change much, either way.",
      "created_at" : "2024-02-06T12:09:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1929388354",
      "id" : 1929388354,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585zACFC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1929388354/reactions"
      },
      "updated_at" : "2024-02-06T12:35:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1929388354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This leads to an alternative solution to not increase the memory footprint: Move the 32+32 bits used for nTx and nChainTx into a single 64-bit blob, where the 16 bit are for nTx and the remaining for nChainTx. But, again, the overall heap memory usage shouldn't change much, either way.\r\n\r\nThis does seem like an nice and easy solution. Would be good to incorporate in #29331\r\n\r\nAs a tangent, I was thinking along the same lines last week before implementing #29370 and came up with worse solution, taking advantage of the fact that when `nChainTx` is set, you can derive `nTx` by subtracting `nChainTx - pprev->nChainTx`. In case it's interesting:\r\n\r\n<details><summary>nChainTx hack</summary>\r\n<p>\r\n\r\n```c++\r\nclass CBlockIndex\r\n{\r\npublic:\r\n    CBlockIndex* pprev{nullptr};\r\n\r\n    // Indicate whether num_tx_value contains total number of transactions in\r\n    // this block, or total number of transactions in the chain up and including\r\n    // this block.\r\n    enum NumTxType { UNSET = 0, BLOCK_TX = 1, CHAIN_TX = 2 };\r\n    NumTxType num_tx_type : 4 {UNSET};\r\n    uint64_t num_tx_value : 60;\r\n\r\n    uint64_t NumBlockTx()\r\n    {\r\n        if (num_tx_type == BLOCK_TX) return num_tx_value;\r\n        if (num_tx_type == CHAIN_TX) {\r\n            assert(pprev && pprev->num_tx_type == CHAIN_TX);\r\n            return num_tx_value - pprev->num_tx_value;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    uint64_t NumChainTx()\r\n    {\r\n        return num_tx_type == CHAIN_TX ? num_tx_value : 0;\r\n    }\r\n};\r\n```\r\n\r\n",
      "created_at" : "2024-02-06T20:08:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1930671864",
      "id" : 1930671864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585zE7b4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1930671864/reactions"
      },
      "updated_at" : "2024-02-06T20:08:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1930671864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This does seem like an nice and easy solution. Would be good to incorporate in #29331\r\n\r\nNot sure if it so easy. On 32-bit platforms, `nTx` currently starts at byte 60, so making it 16-bit will still eat 32-bit with padding. So forcing a 64-bit blob of both values is needed, but that requires changing all code that uses either field. Not sure if worth it for a +-5% memory difference?",
      "created_at" : "2024-02-07T12:32:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1931952848",
      "id" : 1931952848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585zJ0LQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1931952848/reactions"
      },
      "updated_at" : "2024-02-07T12:32:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1931952848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Not sure if it so easy. On 32-bit platforms, `nTx` currently starts at byte 60, so making it 16-bit will still eat 32-bit with padding.\r\n\r\nI didn't test on a 32-bit platform, but aren't bitfields a good solution to this? The following seems to work for me, increasing `nChainTx` range without increasing `CBlockIndex` size on x86_64 (144 bytes):\r\n\r\n\r\n<details><summary>diff</summary>\r\n<p>\r\n\r\n```diff\r\n--- a/src/chain.h\r\n+++ b/src/chain.h\r\n@@ -178,7 +178,7 @@ public:\r\n     //! Note: this value is faked during UTXO snapshot load to ensure that\r\n     //! LoadBlockIndex() will load index entries for blocks that we lack data for.\r\n     //! @sa ActivateSnapshot\r\n-    unsigned int nTx{0};\r\n+    uint16_t nTx : 16 {0};\r\n \r\n     //! (memory only) Number of transactions in the chain up to and including this block.\r\n     //! This value will be non-zero only if and only if transactions for this block and all its parents are available.\r\n@@ -188,7 +188,7 @@ public:\r\n     //! have the underlying block data available during snapshot load.\r\n     //! @sa AssumeutxoData\r\n     //! @sa ActivateSnapshot\r\n-    unsigned int nChainTx{0};\r\n+    uint64_t nChainTx : 48 {0};\r\n \r\n     //! Verification status of this block. See enum BlockStatus\r\n     //!\r\n@@ -412,7 +412,12 @@ public:\r\n \r\n         READWRITE(VARINT_MODE(obj.nHeight, VarIntMode::NONNEGATIVE_SIGNED));\r\n         READWRITE(VARINT(obj.nStatus));\r\n-        READWRITE(VARINT(obj.nTx));\r\n+\r\n+        unsigned int num_tx;\r\n+        SER_WRITE(obj, num_tx = obj.nTx);\r\n+        READWRITE(VARINT(num_tx));\r\n+        SER_READ(obj, obj.nTx = num_tx);\r\n+\r\n         if (obj.nStatus & (BLOCK_HAVE_DATA | BLOCK_HAVE_UNDO)) READWRITE(VARINT_MODE(obj.nFile, VarIntMode::NONNEGATIVE_SIGNED));\r\n         if (obj.nStatus & BLOCK_HAVE_DATA) READWRITE(VARINT(obj.nDataPos));\r\n         if (obj.nStatus & BLOCK_HAVE_UNDO) READWRITE(VARINT(obj.nUndoPos));\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -5119,7 +5119,7 @@ double GuessVerificationProgress(const ChainTxData& data, const CBlockIndex *pin\r\n \r\n     double fTxTotal;\r\n \r\n-    if (pindex->nChainTx <= data.nTxCount) {\r\n+    if (static_cast<int64_t>(pindex->nChainTx) <= data.nTxCount) {\r\n         fTxTotal = data.nTxCount + (nNow - data.nTime) * data.dTxRate;\r\n     } else {\r\n         fTxTotal = pindex->nChainTx + (nNow - pindex->GetBlockTime()) * data.dTxRate;\r\n```\r\n\r\n",
      "created_at" : "2024-02-08T15:59:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1934434005",
      "id" : 1934434005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585zTR7V",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934434005/reactions"
      },
      "updated_at" : "2024-02-08T16:01:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934434005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> bitfields\r\n\r\nJup, that didn't work for me. Or maybe I did something wrong. See https://godbolt.org/z/z6EoWKbjY\r\n\r\n```\r\n   60:0-15 |   int16_t nTx\r\n   64:0-47 |   int64_t nChainTx\r\n```\r\n\r\n(nTx eats byte 60-64, even though it is only a two byte bitfield)",
      "created_at" : "2024-02-08T16:42:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1934519682",
      "id" : 1934519682,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585zTm2C",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934519682/reactions"
      },
      "updated_at" : "2024-02-08T16:42:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934519682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Jup, that didn't work for me. Or maybe I did something wrong. See https://godbolt.org/z/z6EoWKbjY\r\n\r\nIt's not that surprising that the compiler adds padding so the struct member with uint64_t type is inside a field aligned to 8 bytes. But if you move the two bitfield members to begin on an 8 byte boundary (like between the nDataPos and nUndoPos fields, or to the beginning of the struct, it does get packed without extra padding). So I think the diff above is an easy way to avoid consuming extra memory on 64 bit platforms, even though we could go further with more changes to get the same optimization on 32 bit.",
      "created_at" : "2024-02-08T17:13:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1934575281",
      "id" : 1934575281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585zT0ax",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934575281/reactions"
      },
      "updated_at" : "2024-02-08T17:13:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934575281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > bitfields\r\n> \r\n> Jup, that didn't work for me. Or maybe I did something wrong. See https://godbolt.org/z/z6EoWKbjY\r\n> \r\n> ```\r\n>    60:0-15 |   int16_t nTx\r\n>    64:0-47 |   int64_t nChainTx\r\n> ```\r\n> \r\n> (nTx eats byte 60-64, even though it is only a two byte bitfield)\r\n\r\nI think the problem here is you have an odd number of 32-bit pointers prior to `nTx`, so it's misaligned to be combined with `nChainTx`. So you end up with `nTx [4B-6B padding] nChainTx nStatus [4B padding]`. Moving `nStatus` prior to `nTx` gives an even number of 32-bit objects prior to `nTx`, so drops the size back down.",
      "created_at" : "2024-02-08T17:33:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29258#issuecomment-1934619640",
      "id" : 1934619640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
      "node_id" : "IC_kwDOABII585zT_P4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934619640/reactions"
      },
      "updated_at" : "2024-02-08T17:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934619640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
