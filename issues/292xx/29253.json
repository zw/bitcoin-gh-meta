{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Discovered while was reviewing #29112, specifically https://github.com/bitcoin/bitcoin/pull/29112#pullrequestreview-1821862931.\r\n\r\nIf the db handler that initiated the database transaction is destroyed,\r\nthe ongoing transaction cannot be left dangling when the db txn fails\r\nto abort. It must be forcefully reversed; otherwise, any subsequent\r\ndb handler executing a write operation will dump the dangling,\r\nto-be-reverted transaction data to disk.\r\n\r\nThis not only breaks the database isolation property but also results\r\nin the improper storage of incomplete information on disk, impacting\r\nthe wallet consistency.\r\n\r\nThis PR fixes the issue by resetting the db connection, automatically\r\nrolling back the transaction (per https://www.sqlite.org/c3ref/close.html)\r\nwhen the handler object is being destroyed and the txn abortion failed.\r\n\r\nTesting Notes\r\nCan verify the failure by reverting the fix e5217fea and running the test.\r\nIt will fail without e5217fea and pass with it.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29253/comments",
   "created_at" : "2024-01-16T00:41:40Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29253/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/29253",
   "id" : 2082845985,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29253/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585kIl7Z",
   "number" : 29253,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/29253.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29253",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/29253.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29253/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29253/timeline",
   "title" : "wallet: guard against dangling to-be-reverted db transactions",
   "updated_at" : "2024-01-16T00:41:45Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29253",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
      "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
      "followers_url" : "https://api.github.com/users/furszy/followers",
      "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
      "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/furszy",
      "id" : 5377650,
      "login" : "furszy",
      "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
      "organizations_url" : "https://api.github.com/users/furszy/orgs",
      "received_events_url" : "https://api.github.com/users/furszy/received_events",
      "repos_url" : "https://api.github.com/users/furszy/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/furszy"
   }
}
