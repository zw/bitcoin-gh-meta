[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29213).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [furszy](https://github.com/bitcoin/bitcoin/pull/29213#pullrequestreview-1822266935), [brunoerg](https://github.com/bitcoin/bitcoin/pull/29213#pullrequestreview-1823365366), [achow101](https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1894299113) |\n| Stale ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1884850577), [jonatack](https://github.com/bitcoin/bitcoin/pull/29213#pullrequestreview-1819009947) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2024-01-09T21:52:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1883856451",
      "id" : 1883856451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29213",
      "node_id" : "IC_kwDOABII585wSV5D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1883856451/reactions"
      },
      "updated_at" : "2024-01-16T18:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1883856451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2024-01-09T22:00:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1883866390",
      "id" : 1883866390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29213",
      "node_id" : "IC_kwDOABII585wSYUW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1883866390/reactions"
      },
      "updated_at" : "2024-01-09T22:00:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1883866390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2024-01-10T13:07:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1884820312",
      "id" : 1884820312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29213",
      "node_id" : "IC_kwDOABII585wWBNY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1884820312/reactions"
      },
      "updated_at" : "2024-01-10T13:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1884820312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK d536e5a6325d1885224f36debdcc5245b94efe8a",
      "created_at" : "2024-01-10T13:27:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1884850577",
      "id" : 1884850577,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29213",
      "node_id" : "IC_kwDOABII585wWImR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1884850577/reactions"
      },
      "updated_at" : "2024-01-10T13:27:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1884850577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1450905336"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450905336"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps add a \"see `AddSingle()`\" mention somewhere in here, as the logic referred to here is in that method called from this one (`Add/Add_`).",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-12T20:40:31Z",
      "diff_hunk" : "@@ -111,6 +111,9 @@ class AddrMan\n \n     /**\n      * Attempt to add one or more addresses to addrman's new table.\n+     * If an address already exists in addrman, the existing entry may be updated\n+     * (e.g. adding additional service flags). If the existing entry is in the new table,\n+     * it may be added to more buckets, improving the probability of selection.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1450905336",
      "id" : 1450905336,
      "line" : 116,
      "node_id" : "PRRC_kwDOABII585Wew74",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 116,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 6,
      "pull_request_review_id" : 1819009947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450905336/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-12T21:45:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450905336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1450936649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450936649"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems to me this might be helpful and the message names are unlikely to change.\r\n\r\n```diff\r\n             // Overwrites potentially existing services. In contrast to this,\r\n-            // unvalidated services received via gossip relay are only\r\n-            // ever added but cannot replace existing ones.\r\n+            // unvalidated services received via gossip relay in ADDR/ADDRV2\r\n+            // messages are only ever added but do not replace existing ones.\r\n```\r\n",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-12T21:23:32Z",
      "diff_hunk" : "@@ -3376,6 +3376,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         vRecv >> CNetAddr::V1(addrMe);\n         if (!pfrom.IsInboundConn())\n         {\n+            // Overwrites potentially existing services. In contrast to this,\n+            // unvalidated services received via gossip relay are only\n+            // ever added but cannot replace existing ones.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1450936649",
      "id" : 1450936649,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585We4lJ",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 3381,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1819009947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450936649/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-12T21:45:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450936649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1450951378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450951378"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    // Adding service flags even works when the addr is in Tried; see `AddSingle()`\r\n```",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-12T21:43:16Z",
      "diff_hunk" : "@@ -1095,6 +1095,32 @@ BOOST_AUTO_TEST_CASE(addrman_update_address)\n     BOOST_CHECK_EQUAL(vAddr2.size(), 1U);\n     BOOST_CHECK(vAddr2.at(0).nTime >= start_time + 10000s);\n     BOOST_CHECK_EQUAL(vAddr2.at(0).nServices, NODE_NETWORK_LIMITED);\n+\n+    // Updating an existing addr through Add() (used in gossip relay) can add additional services but can't remove existing ones.\n+    CAddress addr_v2{CAddress(ResolveService(\"250.1.1.1\", 8333), NODE_P2P_V2)};\n+    addr_v2.nTime = start_time;\n+    BOOST_CHECK(!addrman->Add({addr_v2}, source));\n+    std::vector<CAddress> vAddr3{addrman->GetAddr(/*max_addresses=*/0, /*max_pct=*/0, /*network=*/std::nullopt)};\n+    BOOST_CHECK_EQUAL(vAddr3.size(), 1U);\n+    BOOST_CHECK_EQUAL(vAddr3.at(0).nServices, NODE_P2P_V2 | NODE_NETWORK_LIMITED);\n+\n+    // SetServices() (used when we connected to them) overwrites existing service flags\n+    addrman->SetServices(addr, NODE_NETWORK);\n+    std::vector<CAddress> vAddr4{addrman->GetAddr(/*max_addresses=*/0, /*max_pct=*/0, /*network=*/std::nullopt)};\n+    BOOST_CHECK_EQUAL(vAddr4.size(), 1U);\n+    BOOST_CHECK_EQUAL(vAddr4.at(0).nServices, NODE_NETWORK);\n+\n+    // Promoting to Tried does not affect the service flags\n+    BOOST_CHECK(addrman->Good(addr)); // addr has NODE_NONE\n+    std::vector<CAddress> vAddr5{addrman->GetAddr(/*max_addresses=*/0, /*max_pct=*/0, /*network=*/std::nullopt)};\n+    BOOST_CHECK_EQUAL(vAddr5.size(), 1U);\n+    BOOST_CHECK_EQUAL(vAddr5.at(0).nServices, NODE_NETWORK);\n+\n+    // Adding service flags even works when the addr is in Tried",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1450951378",
      "id" : 1450951378,
      "line" : 1119,
      "node_id" : "PRRC_kwDOABII585We8LS",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 1119,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 34,
      "pull_request_review_id" : 1819009947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450951378/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-12T21:45:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1450951378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452346405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452346405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is not immediately clear that additional services flags may be added, but the return value could still be false. And the same seems to happen for the `AddrInfo` timestamp. It can also be updated while the return value remains false.",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-15T12:57:32Z",
      "diff_hunk" : "@@ -111,6 +111,9 @@ class AddrMan\n \n     /**\n      * Attempt to add one or more addresses to addrman's new table.\n+     * If an address already exists in addrman, the existing entry may be updated\n+     * (e.g. adding additional service flags). If the existing entry is in the new table,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452346405",
      "id" : 1452346405,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII585WkQwl",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 115,
      "original_position" : 5,
      "original_start_line" : 113,
      "path" : "src/addrman.h",
      "position" : 5,
      "pull_request_review_id" : 1821638281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452346405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 113,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-15T13:04:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452346405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452746812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452746812"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that followed from the `@return` doc, but it wasn't so obvious that adding an existing addr to another new bucket also affects the return value; Changed the `@return` description to `true if at least one address is successfully added, or added to an additional bucket. Unaffected by updates.`",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-15T21:13:54Z",
      "diff_hunk" : "@@ -111,6 +111,9 @@ class AddrMan\n \n     /**\n      * Attempt to add one or more addresses to addrman's new table.\n+     * If an address already exists in addrman, the existing entry may be updated\n+     * (e.g. adding additional service flags). If the existing entry is in the new table,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452746812",
      "id" : 1452746812,
      "in_reply_to_id" : 1452346405,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII585Wlyg8",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 115,
      "original_position" : 5,
      "original_start_line" : 113,
      "path" : "src/addrman.h",
      "position" : 5,
      "pull_request_review_id" : 1822259719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452746812/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 113,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-15T21:13:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452746812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452746873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452746873"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-15T21:14:06Z",
      "diff_hunk" : "@@ -3376,6 +3376,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         vRecv >> CNetAddr::V1(addrMe);\n         if (!pfrom.IsInboundConn())\n         {\n+            // Overwrites potentially existing services. In contrast to this,\n+            // unvalidated services received via gossip relay are only\n+            // ever added but cannot replace existing ones.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452746873",
      "id" : 1452746873,
      "in_reply_to_id" : 1450936649,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Wlyh5",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 3381,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1822259826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452746873/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-15T21:14:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452746873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452747951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452747951"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's better if the header doesn't refer to implementation details. If I remember correctly, this logic used to be in `Add()`, then `Add_()`, now `AddSingle()`, and I don't think it's nice if we have to update `addrman.h` for refactors like that.",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-15T21:16:36Z",
      "diff_hunk" : "@@ -111,6 +111,9 @@ class AddrMan\n \n     /**\n      * Attempt to add one or more addresses to addrman's new table.\n+     * If an address already exists in addrman, the existing entry may be updated\n+     * (e.g. adding additional service flags). If the existing entry is in the new table,\n+     * it may be added to more buckets, improving the probability of selection.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452747951",
      "id" : 1452747951,
      "in_reply_to_id" : 1450905336,
      "line" : 116,
      "node_id" : "PRRC_kwDOABII585Wlyyv",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 116,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 6,
      "pull_request_review_id" : 1822261502,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452747951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-15T21:21:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452747951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452749219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452749219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "similar to above, I don't like referring to implementation details in comments unless really necessary.",
      "commit_id" : "74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-15T21:19:17Z",
      "diff_hunk" : "@@ -1095,6 +1095,32 @@ BOOST_AUTO_TEST_CASE(addrman_update_address)\n     BOOST_CHECK_EQUAL(vAddr2.size(), 1U);\n     BOOST_CHECK(vAddr2.at(0).nTime >= start_time + 10000s);\n     BOOST_CHECK_EQUAL(vAddr2.at(0).nServices, NODE_NETWORK_LIMITED);\n+\n+    // Updating an existing addr through Add() (used in gossip relay) can add additional services but can't remove existing ones.\n+    CAddress addr_v2{CAddress(ResolveService(\"250.1.1.1\", 8333), NODE_P2P_V2)};\n+    addr_v2.nTime = start_time;\n+    BOOST_CHECK(!addrman->Add({addr_v2}, source));\n+    std::vector<CAddress> vAddr3{addrman->GetAddr(/*max_addresses=*/0, /*max_pct=*/0, /*network=*/std::nullopt)};\n+    BOOST_CHECK_EQUAL(vAddr3.size(), 1U);\n+    BOOST_CHECK_EQUAL(vAddr3.at(0).nServices, NODE_P2P_V2 | NODE_NETWORK_LIMITED);\n+\n+    // SetServices() (used when we connected to them) overwrites existing service flags\n+    addrman->SetServices(addr, NODE_NETWORK);\n+    std::vector<CAddress> vAddr4{addrman->GetAddr(/*max_addresses=*/0, /*max_pct=*/0, /*network=*/std::nullopt)};\n+    BOOST_CHECK_EQUAL(vAddr4.size(), 1U);\n+    BOOST_CHECK_EQUAL(vAddr4.at(0).nServices, NODE_NETWORK);\n+\n+    // Promoting to Tried does not affect the service flags\n+    BOOST_CHECK(addrman->Good(addr)); // addr has NODE_NONE\n+    std::vector<CAddress> vAddr5{addrman->GetAddr(/*max_addresses=*/0, /*max_pct=*/0, /*network=*/std::nullopt)};\n+    BOOST_CHECK_EQUAL(vAddr5.size(), 1U);\n+    BOOST_CHECK_EQUAL(vAddr5.at(0).nServices, NODE_NETWORK);\n+\n+    // Adding service flags even works when the addr is in Tried",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#discussion_r1452749219",
      "id" : 1452749219,
      "in_reply_to_id" : 1450951378,
      "line" : 1119,
      "node_id" : "PRRC_kwDOABII585WlzGj",
      "original_commit_id" : "d536e5a6325d1885224f36debdcc5245b94efe8a",
      "original_line" : 1119,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 34,
      "pull_request_review_id" : 1822263298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452749219/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-15T21:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1452749219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "[d536e5a ](https://github.com/bitcoin/bitcoin/commit/d536e5a6325d1885224f36debdcc5245b94efe8a)to [74ebd4d](https://github.com/bitcoin/bitcoin/commit/74ebd4d1359edce82a134dfcd3da9840f8d206e2): Addressed feedback",
      "created_at" : "2024-01-15T21:21:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1892777051",
      "id" : 1892777051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29213",
      "node_id" : "IC_kwDOABII585w0Xxb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1892777051/reactions"
      },
      "updated_at" : "2024-01-15T21:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1892777051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-16T18:29:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1894299113",
      "id" : 1894299113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29213",
      "node_id" : "IC_kwDOABII585w6LXp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1894299113/reactions"
      },
      "updated_at" : "2024-01-16T18:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1894299113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Post-merge ACK 74ebd4d1359edce82a134dfcd3da9840f8d206e2",
      "created_at" : "2024-01-16T18:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29213#issuecomment-1894340133",
      "id" : 1894340133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29213",
      "node_id" : "IC_kwDOABII585w6VYl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1894340133/reactions"
      },
      "updated_at" : "2024-01-16T18:59:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1894340133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
