[
   {
      "author_association" : "MEMBER",
      "body" : "@promag Do you have any IBD measurements before vs after this change to share?",
      "created_at" : "2019-05-21T14:57:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494427995",
      "id" : 494427995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDQyNzk5NQ==",
      "updated_at" : "2019-05-21T14:57:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494427995",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift updated OP.",
      "created_at" : "2019-05-21T15:16:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494435844",
      "id" : 494435844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDQzNTg0NA==",
      "updated_at" : "2019-05-21T15:16:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494435844",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286105254"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286105254"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We shouldn't use a function that is only used to print debug statements in validation. Couldn't you replace this with a check `if (this_block_height < .9*total_header_height)`?",
      "commit_id" : "e6343d866d46edf296f41e6c4d1038c0f9a00c5f",
      "created_at" : "2019-05-21T16:02:50Z",
      "diff_hunk" : "@@ -2459,7 +2459,7 @@ bool CChainState::ConnectTip(CValidationState& state, const CChainParams& chainp\n     int64_t nTime5 = GetTimeMicros(); nTimeChainState += nTime5 - nTime4;\n     LogPrint(BCLog::BENCH, \"  - Writing chainstate: %.2fms [%.2fs (%.2fms/blk)]\\n\", (nTime5 - nTime4) * MILLI, nTimeChainState * MICRO, nTimeChainState * MILLI / nBlocksTotal);\n     // Remove conflicting transactions from the mempool.;\n-    mempool.removeForBlock(blockConnecting.vtx, pindexNew->nHeight);\n+    mempool.removeForBlock(blockConnecting.vtx, pindexNew->nHeight, GuessVerificationProgress(chainparams.TxData(), pindexNew) > 0.9);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286105254",
      "id" : 286105254,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NjEwNTI1NA==",
      "original_commit_id" : "8854ebbec6ca12ce03c02ee31625e78886b1a48d",
      "original_position" : 5,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 240148423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066",
      "updated_at" : "2019-05-21T22:11:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286105254",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke updated to take into account block age instead.",
      "created_at" : "2019-05-21T17:00:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494474538",
      "id" : 494474538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDQ3NDUzOA==",
      "updated_at" : "2019-05-21T17:00:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494474538",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14193](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14193.html) (validation: Add missing mempool locks by MarcoFalke)\n* [#13949](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13949.html) (Introduce MempoolObserver interface to break \"policy/fees -> txmempool -> policy/fees\" circular dependency by Empact)\n* [#10443](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10443.html) (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-05-21T17:00:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494474560",
      "id" : 494474560,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDQ3NDU2MA==",
      "updated_at" : "2019-06-20T19:24:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494474560",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286161109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286161109"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should explain where this magic number comes from and why it is a safe choice considering the other constants in policy/fees.h. Ideally you'd express it using existing constants",
      "commit_id" : "e6343d866d46edf296f41e6c4d1038c0f9a00c5f",
      "created_at" : "2019-05-21T18:19:12Z",
      "diff_hunk" : "@@ -107,6 +107,8 @@ static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n static const int64_t DEFAULT_MAX_TIP_AGE = 24 * 60 * 60;\n /** Maximum age of our tip in seconds for us to be considered current for fee estimation */\n static const int64_t MAX_FEE_ESTIMATION_TIP_AGE = 3 * 60 * 60;\n+/** Maximum block age in seconds for us to be considered suitable for fee estimator */\n+static const int64_t MAX_FEE_ESTIMATOR_BLOCK_AGE = 48 * 60 * 60;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286161109",
      "id" : 286161109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NjE2MTEwOQ==",
      "original_commit_id" : "d9d41f210ef1f8504f755e05a22d767b9e7cbead",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : 5,
      "pull_request_review_id" : 240219416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066",
      "updated_at" : "2019-05-21T22:11:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286161109",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286188245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286188245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No magic here, just picked 2 days .. I think it should be a value that would produce similar fee rates right?",
      "commit_id" : "e6343d866d46edf296f41e6c4d1038c0f9a00c5f",
      "created_at" : "2019-05-21T19:29:08Z",
      "diff_hunk" : "@@ -107,6 +107,8 @@ static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n static const int64_t DEFAULT_MAX_TIP_AGE = 24 * 60 * 60;\n /** Maximum age of our tip in seconds for us to be considered current for fee estimation */\n static const int64_t MAX_FEE_ESTIMATION_TIP_AGE = 3 * 60 * 60;\n+/** Maximum block age in seconds for us to be considered suitable for fee estimator */\n+static const int64_t MAX_FEE_ESTIMATOR_BLOCK_AGE = 48 * 60 * 60;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286188245",
      "id" : 286188245,
      "in_reply_to_id" : 286161109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NjE4ODI0NQ==",
      "original_commit_id" : "d9d41f210ef1f8504f755e05a22d767b9e7cbead",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : 5,
      "pull_request_review_id" : 240253780,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066",
      "updated_at" : "2019-05-21T22:11:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286188245",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286269421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286269421"
         }
      },
      "author_association" : "NONE",
      "body" : "2 days is still magic ;) \"for us to be considered suitable\" also sounds confusing to me, could you rephrase this?",
      "commit_id" : "e6343d866d46edf296f41e6c4d1038c0f9a00c5f",
      "created_at" : "2019-05-22T00:05:05Z",
      "diff_hunk" : "@@ -107,6 +107,8 @@ static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n static const int64_t DEFAULT_MAX_TIP_AGE = 24 * 60 * 60;\n /** Maximum age of our tip in seconds for us to be considered current for fee estimation */\n static const int64_t MAX_FEE_ESTIMATION_TIP_AGE = 3 * 60 * 60;\n+/** Maximum block age in seconds for us to be considered suitable for fee estimator */\n+static const int64_t MAX_FEE_ESTIMATOR_BLOCK_AGE = 48 * 60 * 60;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286269421",
      "id" : 286269421,
      "in_reply_to_id" : 286161109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NjI2OTQyMQ==",
      "original_commit_id" : "d9d41f210ef1f8504f755e05a22d767b9e7cbead",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : 5,
      "pull_request_review_id" : 240356140,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066",
      "updated_at" : "2019-05-22T00:05:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286269421",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/305679?v=4",
         "events_url" : "https://api.github.com/users/thijstriemstra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/thijstriemstra/followers",
         "following_url" : "https://api.github.com/users/thijstriemstra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/thijstriemstra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/thijstriemstra",
         "id" : 305679,
         "login" : "thijstriemstra",
         "node_id" : "MDQ6VXNlcjMwNTY3OQ==",
         "organizations_url" : "https://api.github.com/users/thijstriemstra/orgs",
         "received_events_url" : "https://api.github.com/users/thijstriemstra/received_events",
         "repos_url" : "https://api.github.com/users/thijstriemstra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/thijstriemstra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/thijstriemstra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/thijstriemstra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286271315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286271315"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'll change to a reasonable value, meanwhile I'm waiting for concept ACK.",
      "commit_id" : "e6343d866d46edf296f41e6c4d1038c0f9a00c5f",
      "created_at" : "2019-05-22T00:15:33Z",
      "diff_hunk" : "@@ -107,6 +107,8 @@ static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n static const int64_t DEFAULT_MAX_TIP_AGE = 24 * 60 * 60;\n /** Maximum age of our tip in seconds for us to be considered current for fee estimation */\n static const int64_t MAX_FEE_ESTIMATION_TIP_AGE = 3 * 60 * 60;\n+/** Maximum block age in seconds for us to be considered suitable for fee estimator */\n+static const int64_t MAX_FEE_ESTIMATOR_BLOCK_AGE = 48 * 60 * 60;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#discussion_r286271315",
      "id" : 286271315,
      "in_reply_to_id" : 286161109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NjI3MTMxNQ==",
      "original_commit_id" : "d9d41f210ef1f8504f755e05a22d767b9e7cbead",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : 5,
      "pull_request_review_id" : 240358407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16066",
      "updated_at" : "2019-05-22T00:15:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286271315",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I give this idea a concept ACK, but I think it requires more complicated changes to work correctly.  After a cursory review, I think basic functionality would have to be something like this:\r\n\r\nWe should not completely skip `CBlockPolicyEstimator::processBlock` but instead pass into that function some notion of whether the individual block transactions need to be processed.   Call this `track_block_transactions`.\r\n\r\nIf `track_block_transactions` is false, then `processBlock` can just do the quick initial work of decaying existing estimates and skip the time consuming processing of the transactions within the block.  Presumably this will give us almost all of the speedup hoped for, if not, maybe we can look for further optimizations.\r\n\r\nThere is already an existing function used for determining whether incoming transactions should be tracked, `IsCurrentForFeeEstimation`.  I think that the notion we want for `track_block_transactions` is that it starts false (assuming `IsCurrentForFeeEstimation` starts false) and then latches to true the first time `IsCurrentForFeeEstimation` goes true.  `IsCurrentForFeeEstimation` can go back to false again, but its important that once mempool transactions have started being tracked that we never go back to false for `track_block_transactions`.\r\n\r\nI seem to remember someone else working on this exact improvement in the past, maybe @theuni?\r\n\r\n(EDIT: It may be even easier than suggested.  The CBlockPolicyEstimator can probably just internally use `!mapMemPoolTxs.empty()` as a proxy for `track_block_transactions`)",
      "created_at" : "2019-05-22T19:23:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494934107",
      "id" : 494934107,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDkzNDEwNw==",
      "updated_at" : "2019-05-22T19:35:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494934107",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "node_id" : "MDQ6VXNlcjQzNjAzNDk=",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@morcos thanks! Actually IIRC decaying does cost and I think it's a bottleneck in reindex. Later I'll update profile results to see what I mean.",
      "created_at" : "2019-05-22T19:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494936524",
      "id" : 494936524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDkzNjUyNA==",
      "updated_at" : "2019-05-22T19:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494936524",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "See also\r\n\r\n* fees: optimize decay #11194 ",
      "created_at" : "2019-05-22T19:39:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494939954",
      "id" : 494939954,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDkzOTk1NA==",
      "updated_at" : "2019-05-22T19:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494939954",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So maybe this is all you need to do the trick?\r\nhttps://github.com/morcos/bitcoin/commit/5903ac2b57560815294319be3b01a6c466b103fc",
      "created_at" : "2019-05-22T19:50:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494944571",
      "id" : 494944571,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDk0NDU3MQ==",
      "updated_at" : "2019-05-22T19:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494944571",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "node_id" : "MDQ6VXNlcjQzNjAzNDk=",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ahh thanks Marco, so perhaps combining the two changes",
      "created_at" : "2019-05-22T19:51:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16066#issuecomment-494945100",
      "id" : 494945100,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16066",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDk0NTEwMA==",
      "updated_at" : "2019-05-22T19:51:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494945100",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "node_id" : "MDQ6VXNlcjQzNjAzNDk=",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   }
]
