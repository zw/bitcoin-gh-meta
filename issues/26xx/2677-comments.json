[
   {
      "body" : "test conditions: on my VPS, a bitcoind patched to ignore the dust filtering and free relay limiting, and sending a \"mempool\" to every peer at connect time, waited until poolsz >5000, then measure getblocktemplate RPC latency. Result: 10-20s without this patch, 0.5-0.7s with this patch.\r\n\r\nEDIT: up to 1.0-1.5s after running for several hours (poolsz still ~5000).",
      "created_at" : "2013-05-21T02:18:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18185364",
      "id" : 18185364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T17:17:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18185364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/2ec349bc420d7f4541bf91acf8b830377a1421f3 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2013-05-21T02:30:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18185669",
      "id" : 18185669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T02:30:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18185669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "I'm not familiar enough with the code and the template structure to know what is possible so please bear with my uneducated suggestion.\r\n\r\nWould it make sense to have part of the template being computed asynchronously?\r\nHave a thread wake up regularly and build a base structure with a snapshot of the tx available. When a call to getblocktemplate or other RPC functions scaling in o(nb_tx) or worse is done, use the precomputed structure instead of the available tx. When a new block is known update the structure right away and/or swap with a temporary \"quick to compute/0 tx\" one until the thread can catch up and build one with available tx.\r\nI see params of getblocktemplate that obviously won't allow using this optimization (passing the transactions for the most obvious) but my lack of knowledge of the actual template format and build process makes me wonder what other params could prevent this kind of optimization to be useful. At least it seems to me that with no params the optimization should work and allow for o(1) scaling for getblocktemplate. In the end my suggestion only makes sense if most pools could benefit from it and aren't forced to use params that prevent it from being useful.",
      "created_at" : "2013-05-21T21:26:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18242132",
      "id" : 18242132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T21:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18242132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19892?v=3",
         "events_url" : "https://api.github.com/users/gyver/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gyver/followers",
         "following_url" : "https://api.github.com/users/gyver/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gyver/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gyver",
         "id" : 19892,
         "login" : "gyver",
         "organizations_url" : "https://api.github.com/users/gyver/orgs",
         "received_events_url" : "https://api.github.com/users/gyver/received_events",
         "repos_url" : "https://api.github.com/users/gyver/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gyver/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gyver/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gyver"
      }
   },
   {
      "body" : "@gyver Thats what miner software should and (some) does do.  .. but at some point you need to compute the data... and it's good if it's not a slow and expensive operation.\r\n",
      "created_at" : "2013-05-21T21:29:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18242271",
      "id" : 18242271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T21:29:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18242271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "ACK\r\n",
      "created_at" : "2013-05-21T21:42:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18243098",
      "id" : 18243098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18243098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@gmaxwell of course I agree speeding up the actual computation is desirable.\r\n\r\nI was wondering if it wouldn't make sense to implement this async technique in bitcoind itself. For example I suspect (again: uninformed guess) that slow calls to getmininginfo and getblocktemplate use the same access pattern to an internal tx structure and could benefit from the same optimization (at least they became slow on my node when the number of tx started to grow). At some point when multiple tools all implement the same algorithm on top of another tool the question of integrating this algorithm in the common tool becomes valid (the answer isn't always obvious though).\r\nIt could become more obvious when the heavy client only makes sense for pool owners/miners (and most end-users have migrated to lightweight clients).\r\n\r\nIt's just an idea to test the waters (mainly to avoid wasting time with it if the template build process intrinsically can't benefit from this approach), it's far from a feature request.\r\n\r\nI'm more and more interested by the node's source code and how I could play with it but I just scraped the surface...",
      "created_at" : "2013-05-21T21:43:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18243282",
      "id" : 18243282,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T21:49:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18243282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19892?v=3",
         "events_url" : "https://api.github.com/users/gyver/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gyver/followers",
         "following_url" : "https://api.github.com/users/gyver/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gyver/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gyver",
         "id" : 19892,
         "login" : "gyver",
         "organizations_url" : "https://api.github.com/users/gyver/orgs",
         "received_events_url" : "https://api.github.com/users/gyver/received_events",
         "repos_url" : "https://api.github.com/users/gyver/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gyver/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gyver/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gyver"
      }
   },
   {
      "body" : "@gmaxwell still thinking about your suggestion and focusing on how miner software can optimize their latency when a new block is accepted by the local node. The miner doesn't want to use an old cached template to avoid wasting work but can't simply call getblocktemplate naively if it wants a fast reply (event after a new block there can be and often is a lot of transactions to include in a template).\r\nIt can receive a notification from the node (there are already interfaces for that). I assume that to minimize latency it can call getblocktemplate with an emplty tx list to get a fast reply and immediately call it again without specifying the list to include txs as soon as possible.\r\nAs many pools have closed source software I'm not sure if they really implement this kind of behaviour. Latency issues may be solved by simply publishing recommendations for miner software instead of modifying bitcoind itself. As p2pool is probably the most likely to benefit from this, I'll link this post in the p2pool bitcointalk.org thread and continue there to avoid deviating even more from the subject here.",
      "created_at" : "2013-05-21T22:11:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18245264",
      "id" : 18245264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T22:11:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18245264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19892?v=3",
         "events_url" : "https://api.github.com/users/gyver/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gyver/followers",
         "following_url" : "https://api.github.com/users/gyver/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gyver/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gyver",
         "id" : 19892,
         "login" : "gyver",
         "organizations_url" : "https://api.github.com/users/gyver/orgs",
         "received_events_url" : "https://api.github.com/users/gyver/received_events",
         "repos_url" : "https://api.github.com/users/gyver/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gyver/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gyver/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gyver"
      }
   },
   {
      "body" : "@gyver Eloipool is free software an implements the optimizations you appear to be describing there. (precomputed empty templates and such).\r\n\r\n",
      "created_at" : "2013-05-21T22:18:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18245577",
      "id" : 18245577,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T22:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18245577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell thanks for the pointer. Was already in my large bag of source code to read but moved near the top of the pile :)",
      "created_at" : "2013-05-21T22:26:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2677#issuecomment-18245961",
      "id" : 18245961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2677",
      "updated_at" : "2013-05-21T22:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18245961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19892?v=3",
         "events_url" : "https://api.github.com/users/gyver/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gyver/followers",
         "following_url" : "https://api.github.com/users/gyver/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gyver/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gyver",
         "id" : 19892,
         "login" : "gyver",
         "organizations_url" : "https://api.github.com/users/gyver/orgs",
         "received_events_url" : "https://api.github.com/users/gyver/received_events",
         "repos_url" : "https://api.github.com/users/gyver/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gyver/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gyver/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gyver"
      }
   }
]
