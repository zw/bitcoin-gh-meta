[
   {
      "author_association" : "MEMBER",
      "body" : "cc @ajtowns @theuni @martinus @jonatack",
      "created_at" : "2021-10-30T17:30:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-955533025",
      "id" : 955533025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII58449Ebh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/955533025/reactions"
      },
      "updated_at" : "2021-10-30T17:30:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/955533025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@hebasto do you expect there are significant performance implications for this change? Should I benchmark?",
      "created_at" : "2021-11-01T14:11:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-956267838",
      "id" : 956267838,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII5844_30-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956267838/reactions"
      },
      "updated_at" : "2021-11-01T14:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956267838",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jamesob\r\n> @hebasto do you expect there are significant performance implications for this change?\r\n\r\nNot sure about \"significant\" :)\r\n\r\n> Should I benchmark?\r\n\r\nI'll appreciate it! Also I have a plan to improve `CCheckQueue` performance further (not here, of course).\r\n\r\n",
      "created_at" : "2021-11-01T14:25:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-956280061",
      "id" : 956280061,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII5844_6z9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956280061/reactions"
      },
      "updated_at" : "2021-11-01T14:25:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956280061",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740305376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740305376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`unsigned int` is typically smaller than the size of a vector. Use `size_t` or `std::vector<T>::size_type` perhaps?\r\n\r\nI very much doubt we'll ever have more than 4 billion checks queued up, but it also seems simpler to make the type can just account for everything.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T15:31:42Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740305376",
      "id" : 740305376,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII584sICng",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 170,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 14,
      "pull_request_review_id" : 794342805,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740305376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T15:32:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740305376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740306424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740306424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you're touching this code, make it follow style? (no indentation without brances).",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T15:32:51Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();\n+            nTodo += num_of_new_checks;\n         }\n-        nTodo += vChecks.size();\n-        if (vChecks.size() == 1)\n+\n+        if (num_of_new_checks == 1)\n             m_worker_cv.notify_one();\n-        else if (vChecks.size() > 1)\n+        else if (num_of_new_checks > 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740306424",
      "id" : 740306424,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sIC34",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 183,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : null,
      "pull_request_review_id" : 794344135,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740306424/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T15:32:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740306424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, but left some nits.",
      "created_at" : "2021-11-01T15:33:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-956337186",
      "id" : 956337186,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII5845AIwi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956337186/reactions"
      },
      "updated_at" : "2021-11-01T15:33:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956337186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740321362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740321362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Style is fixed in the second commit. Or do you want me to follow style here?",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T15:51:09Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();\n+            nTodo += num_of_new_checks;\n         }\n-        nTodo += vChecks.size();\n-        if (vChecks.size() == 1)\n+\n+        if (num_of_new_checks == 1)\n             m_worker_cv.notify_one();\n-        else if (vChecks.size() > 1)\n+        else if (num_of_new_checks > 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740321362",
      "id" : 740321362,
      "in_reply_to_id" : 740306424,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sIGhS",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 183,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : null,
      "pull_request_review_id" : 794364748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740321362/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T15:51:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740321362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740325089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740325089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've chosen `unsinged int` due to https://github.com/bitcoin/bitcoin/blob/5adc5c02800f00d1e6e8812a2b0559b1800e82e9/src/checkqueue.h#L60\r\n\r\nMaybe use `size_t` for `nTodo` as well?",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T15:54:56Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740325089",
      "id" : 740325089,
      "in_reply_to_id" : 740305376,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII584sIHbh",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 170,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 14,
      "pull_request_review_id" : 794369884,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740325089/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T15:54:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740325089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740366532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740366532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, I see, that makes sense. I think changing to size_t everywhere can be done in a separate PR, if desires.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T16:49:01Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740366532",
      "id" : 740366532,
      "in_reply_to_id" : 740305376,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII584sIRjE",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 170,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 14,
      "pull_request_review_id" : 794426408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740366532/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T16:49:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740366532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740407348"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740407348"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, that's fine.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T17:45:56Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();\n+            nTodo += num_of_new_checks;\n         }\n-        nTodo += vChecks.size();\n-        if (vChecks.size() == 1)\n+\n+        if (num_of_new_checks == 1)\n             m_worker_cv.notify_one();\n-        else if (vChecks.size() > 1)\n+        else if (num_of_new_checks > 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740407348",
      "id" : 740407348,
      "in_reply_to_id" : 740306424,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sIbg0",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 183,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : null,
      "pull_request_review_id" : 794481514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740407348/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T17:45:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740407348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740433358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740433358"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think you could also write `const auto num_of_new_checks = vChecks.size();` above, saves one line of code in the lock and doesn't keep an uninitialized variable around for a few lines.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T18:24:45Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740433358",
      "id" : 740433358,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII584sIh3O",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 177,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 21,
      "pull_request_review_id" : 794516634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740433358/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T18:34:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740433358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740433985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740433985"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: maybe not part of this PR, but using `queue.emplace_back()` instead `queue.push_back(T())` would save one move/copy constructor and one destructor because the object could be directly constructed in the queue",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T18:25:42Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740433985",
      "id" : 740433985,
      "line" : 178,
      "node_id" : "PRRC_kwDOABII584sIiBB",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 174,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 18,
      "pull_request_review_id" : 794516634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740433985/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T18:34:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740433985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740454221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740454221"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "the max number of checks is IIRC something slightly above 100k",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T18:56:23Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740454221",
      "id" : 740454221,
      "in_reply_to_id" : 740305376,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII584sIm9N",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 170,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 14,
      "pull_request_review_id" : 794545507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740454221/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T18:56:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740454221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "would love to see some thorough testing on this. I could be misremembering, but check cross platform that there's no reason to continue to hold the lock. IIRC there was some sort of edge condition (maybe in window?) around a notify being able to be missed or something, but the details are like 5-6 years out of my cache :)",
      "created_at" : "2021-11-01T18:59:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-956502379",
      "id" : 956502379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII5845AxFr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956502379/reactions"
      },
      "updated_at" : "2021-11-01T18:59:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956502379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740461509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740461509"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually none of that is necessary. `vChecks` doesn't change size during the adding loop. The old `vChecks.size()` based checks can be kept.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T19:09:07Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740461509",
      "id" : 740461509,
      "in_reply_to_id" : 740433358,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII584sIovF",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 177,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 21,
      "pull_request_review_id" : 794555829,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740461509/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T19:09:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740461509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740519896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740519896"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">  `vChecks` doesn't change size during the adding loop.\r\n\r\nCorrect. But `vChecks` is passed in `CCheckQueue::Add` by a non-const reference, and that makes possible its modification by a concurrent thread between leaving a critical section and checking `num_of_new_checks == 1`.\r\n\r\nAlthough, the only caller is located in `CChainState::ConnectBlock` which is guarded by the `cs_main` mutex. Therefore,  you are right.\r\n\r\n> The old `vChecks.size()` based checks can be kept.\r\n\r\nYes, it will work. But while looking into `CCheckQueue::Add` code, it is not obvious that `vChecks.size()` is constant in multi-threading environment. I think that adding a local variable makes code more readable and robust considering any possible changes at the caller site(s) in the future.\r\n\r\nOTOH, it seems all could look clearer if we pass `vChecks` as an rvalue reference using move semantics. What do you think?",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-01T20:48:06Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r740519896",
      "id" : 740519896,
      "in_reply_to_id" : 740433358,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII584sI2_Y",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 177,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 21,
      "pull_request_review_id" : 794634686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740519896/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T20:48:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740519896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741207782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741207782"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What about `queue.push_back(std::move(check))`?",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-02T15:36:41Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741207782",
      "id" : 741207782,
      "in_reply_to_id" : 740433985,
      "line" : 178,
      "node_id" : "PRRC_kwDOABII584sLe7m",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 174,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 18,
      "pull_request_review_id" : 795583134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741207782/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T15:36:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741207782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741224832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741224832"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I would never think that a reference argument could be changed by another thread while the function is executing. I hope we don't do that anywhere in the code. Because how would the function avoid races? Which mutex protects the argument? That would require something like (it does not compile, of course):\r\n\r\n```cpp\r\nvoid func(T& arg GUARDED_BY(some_mutex), ...)\r\n{\r\n    ...\r\n    LOCK(some_mutex);\r\n    access arg;\r\n    ...\r\n```\r\n\r\nSo, I think it is safe to assume that `vChecks` will not change while `Add()` is executing. Indeed the only caller passes in a local variable that is not visible by other threads (and then throws it away, so the \"swap\" is actually a \"move\").\r\n\r\n> ... it seems all could look clearer if we pass vChecks as an rvalue reference using move semantics ...\r\n\r\nYes :) and `std::move()` each element from `vChecks` into `queue`. It is unnecessary to first create a default-constructed object only to swap it with another and throw it away. This is what `std::move()` is for.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-02T15:50:10Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741224832",
      "id" : 741224832,
      "in_reply_to_id" : 740433358,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII584sLjGA",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 177,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 21,
      "pull_request_review_id" : 795601161,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741224832/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T15:50:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741224832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741232993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741232993"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The code below assumes `vChecks` may be modified by another thread while this is executing (it cannot actually). I guess either remove that assumption or move this access to `vChecks` under `m_mutex` (if that mutex it supposed to protect `vChecks`!?).\r\n\r\nIt is a race to call `std::vector::empty()` while modifying it concurrently.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-02T15:56:17Z",
      "diff_hunk" : "@@ -167,16 +167,26 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        if (vChecks.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741232993",
      "id" : 741232993,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII584sLlFh",
      "original_commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "original_line" : 170,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 8,
      "pull_request_review_id" : 795609528,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741232993/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T15:56:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741232993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741247135"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741247135"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@hebasto That's not how `const` works in C++. The lack thereof means *you* (the called function in this case) are allowed to modify the argument; it says nothing at all about whether another thread might be modifying the same variable. Even if the argument was `const`, nothing prevents another thread from holding a mutable reference to the same object.\r\n\r\nThat said, passing an argument (const or not) to a function while it is being modified by other threads would be completely non-idiomatic, dangerous code. It is possible, and sometimes necessary of course, but at least you'd expect the passed object to have internal mutexes or other synchronization mechanisms to protect its state in that case; not something the callee should deal with. Virtually every STL function will exhibit undefined behavior if you pass it references to arguments that are being modified concurrently. Outside of very exceptional cases that should raise big red flags, you can very much assume that arguments passed to a function are under exclusive control of that function for the duration of its execution.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-02T16:06:47Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741247135",
      "id" : 741247135,
      "in_reply_to_id" : 740433358,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII584sLoif",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 177,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 21,
      "pull_request_review_id" : 795623542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741247135/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T16:06:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741247135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741260491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741260491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I tried that once but then tests fail, I think for the types used here `std::swap` is implemented but a move constructor isn't. I didn't have a closer look why that fails.\r\n\r\nI think the nicest c++ solution would be to replace the whole loop with\r\n\r\n```cpp\r\nqueue.insert(queue.end(), std::make_move_iterator(vChecks.begin()), std::make_move_iterator(vChecks.end()));\r\n```\r\n\r\nBut this too requires properly implementing move constructor.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-02T16:21:05Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741260491",
      "id" : 741260491,
      "in_reply_to_id" : 740433985,
      "line" : 178,
      "node_id" : "PRRC_kwDOABII584sLrzL",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 174,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 18,
      "pull_request_review_id" : 795641874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741260491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T16:21:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741260491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741274241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741274241"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@sipa Thanks for your detailed explanation.\r\n\r\nGoing to address all of the comments.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-02T16:36:19Z",
      "diff_hunk" : "@@ -167,15 +167,20 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        unsigned int num_of_new_checks;\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.push_back(T());\n+                check.swap(queue.back());\n+            }\n+            num_of_new_checks = vChecks.size();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741274241",
      "id" : 741274241,
      "in_reply_to_id" : 740433358,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII584sLvKB",
      "original_commit_id" : "0e4169972203d9cde0f1c86cb6084ab9c2db41e2",
      "original_line" : 177,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 21,
      "pull_request_review_id" : 795660911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741274241/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T16:36:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741274241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741276311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741276311"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You are right.\r\n\r\n> I guess either remove that assumption or move this access to `vChecks` under `m_mutex` (if that mutex it supposed to protect `vChecks`!?).\r\n\r\nThe former will go.",
      "commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "created_at" : "2021-11-02T16:38:42Z",
      "diff_hunk" : "@@ -167,16 +167,26 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        if (vChecks.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#discussion_r741276311",
      "id" : 741276311,
      "in_reply_to_id" : 741232993,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII584sLvqX",
      "original_commit_id" : "5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66",
      "original_line" : 170,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/checkqueue.h",
      "position" : 8,
      "pull_request_review_id" : 795663889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23397",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741276311/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T16:38:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741276311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa @martinus @vasild\r\n\r\nThank you for your reviews and your suggestions!\r\n\r\nUpdated 5bcfd70a3b0e008d7a80e37a29fe90887a0f8c66 -> 459e208276a4d1457d37bf41c977e62caf05456d ([pr23397.01](https://github.com/hebasto/bitcoin/commits/pr23397.01) -> [pr23397.02](https://github.com/hebasto/bitcoin/commits/pr23397.02), [diff](https://github.com/hebasto/bitcoin/compare/pr23397.01..pr23397.02)):\r\n\r\n- addressed all of the comments",
      "created_at" : "2021-11-03T09:36:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-958782982",
      "id" : 958782982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII5845Jd4G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/958782982/reactions"
      },
      "updated_at" : "2021-11-03T09:36:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/958782982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACKish - I haven't reviewed the code, but it works for the benchmarks and so I guess in some sense I've tested it. As expected, no big diff in performance.\r\n\r\n\r\n\r\n### #23397 vs. $mergebase (absolute)\r\n|                  bench name                   |  x  |           #23397           |         $mergebase         |\r\n|-----------------------------------------------|----:|----------------------------|----------------------------|\r\n| ibd.local.range.500000.540000.total_secs      |   2 | 4826.3510 ( 0.4951)       | 4831.4970 ( 6.8399)       |\r\n| ibd.local.range.500000.540000.peak_rss_KiB    |   2 | 6410470.0000 ( 1750.0000) | 6406678.0000 ( 2714.0000) |\r\n| ibd.local.range.500000.540000.cpu_kernel_secs |   2 | 345.3800 ( 3.1200)        | 348.2850 ( 0.8050)        |\r\n| ibd.local.range.500000.540000.cpu_user_secs   |   2 | 30102.6800 ( 5.2600)      | 30086.9150 ( 24.1150)     |\r\n\r\n\r\n### #23397 vs. $mergebase (relative)\r\n|                  bench name                   |  x  | #23397 | $mergebase |\r\n|-----------------------------------------------|----:|-------:|-----------:|\r\n| ibd.local.range.500000.540000.total_secs      |   2 |  1.000 |      1.001 |\r\n| ibd.local.range.500000.540000.peak_rss_KiB    |   2 |  1.001 |      1.000 |\r\n| ibd.local.range.500000.540000.cpu_kernel_secs |   2 |  1.000 |      1.008 |\r\n| ibd.local.range.500000.540000.cpu_user_secs   |   2 |  1.001 |      1.000 |",
      "created_at" : "2021-11-03T12:44:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-958997095",
      "id" : 958997095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII5845KSJn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/958997095/reactions"
      },
      "updated_at" : "2021-11-03T12:44:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/958997095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 459e208, codereview and tested. I first thought this introduced a segfault in `psbt_wallet_tests/psbt_updater_test` because that test failed for me, but thats a different issue fixed in #23403.",
      "created_at" : "2021-11-03T17:23:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23397#issuecomment-959754739",
      "id" : 959754739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23397",
      "node_id" : "IC_kwDOABII5845NLHz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/959754739/reactions"
      },
      "updated_at" : "2021-11-03T17:23:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/959754739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   }
]
