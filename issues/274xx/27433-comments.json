[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27433).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept NACK | [luke-jr](https://github.com/bitcoin/bitcoin/pull/27433#pullrequestreview-1494088880) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29039](https://github.com/bitcoin/bitcoin/pull/29039) (versionbits refactoring by ajtowns)\n* [#28890](https://github.com/bitcoin/bitcoin/pull/28890) (rpc: Remove deprecated -rpcserialversion by maflcko)\n* [#28550](https://github.com/bitcoin/bitcoin/pull/28550) (Covenant tools softfork by jamesob)\n* [#27427](https://github.com/bitcoin/bitcoin/pull/27427) (validation: Replace MinBIP9WarningHeight with MinBIP9WarningStartTime by dimitaracev)\n* [#26201](https://github.com/bitcoin/bitcoin/pull/26201) (Remove Taproot activation height by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-06T18:18:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27433#issuecomment-1499447828",
      "id" : 1499447828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27433",
      "node_id" : "IC_kwDOABII585ZX8IU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1499447828/reactions"
      },
      "updated_at" : "2023-12-19T01:01:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1499447828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The \"rules\" field was introduced in #7935. It's not specified in [BIP 22](https://github.com/bitcoin/bips/blob/master/bip-0022.mediawiki) and [BIP 23](https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki) which describe the expected behaviour of `getblocktemplate`. But then in [BIP 145](https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki) for segwit it's assumed to be there. I'm guessing something in between is documented in Stratum software?\r\n\r\nHere's [an example](https://bitbucket.org/ckolivas/ckpool/src/73f560cf3144f824823077c1b9e1663d89823ed7/src/bitcoin.c#lines-127:135) of how it's used by pool software. There's also some documentation through bug reports, e.g. #17946. My understanding is that `!` means that it's unsafe to mine without understanding the rule.\r\n\r\nIt's unclear to me how it is intented to be used, both as an argument and in the results. I'm also not sure how to interpret this wording in BIP 145:\r\n\r\n> The '!' rule prefix MUST be enabled on the \"segwit\" rule for templates including transactions with witness data.\r\n\r\nFor 6ab119d4c1c8cf3d9c0994c22d75d016a30cdd6a I have assumed that the consumer of this RPC may care about it, so we keep `!segwit` in the result. I've the read the above sentence as referring only to the result of the RPC. With this commit it doesn't matter if you set it or not.\r\n\r\n\r\n\r\ncc @luke-jr",
      "created_at" : "2023-04-06T19:18:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27433#issuecomment-1499509064",
      "id" : 1499509064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27433",
      "node_id" : "IC_kwDOABII585ZYLFI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1499509064/reactions"
      },
      "updated_at" : "2023-04-06T19:32:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1499509064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> changes the BIP 145 semantics of \"sigops\".\r\n\r\nHow so?\r\n\r\nFrom [BIP 145](https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki#user-content-Sigops):\r\n\r\n> Sigops\r\n\r\n> For templates with \"segwit\" enabled as a rule, the \"sigoplimit\" and \"sigops\" keys must use the new values as calculated in [BIP 141](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#Sigops).\r\n\r\nThis PR leaves the \"segwit\" rule enabled. You just don't have to specify it: https://github.com/bitcoin/bitcoin/pull/27433/commits/edd00677dbddd5b40fa3d2954e8cb04fcd8359f4#diff-ccc24453c13307f815879738d3bf00eec351417537fbf10dde1468180cacd2f1R821-R822\r\n\r\nWe do the same thing with `csv`.\r\n\r\n>> Two recent F2Pool blocks violated the sigops limit. Both by 3. I suspect they were not using getblocktemplate.\r\n\r\n> This PR is unlikely to have avoided it, then.\r\n\r\nI've since learned that they do use it, but with patches.\r\n\r\n> These are non-standard\r\n\r\nDo you mean BIP 22/23? It says:\r\n\r\n> getblocktemplate MUST return a JSON Object containing the following keys\r\n\r\nIt doesn't say there can't be extra fields, though I can see how people can screw up by not implementing from the spec, but rather from the JSON RPC. I can add a comment to the help pointing out they're not BIP 22/23 fields. Or hide them behind a debug option. It's useful to know these totals with resorting to `jq` magic.",
      "created_at" : "2023-06-26T15:20:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27433#issuecomment-1607709381",
      "id" : 1607709381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27433",
      "node_id" : "IC_kwDOABII585f07LF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1607709381/reactions"
      },
      "updated_at" : "2023-06-26T15:20:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1607709381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-08-17T13:50:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27433#issuecomment-1682325492",
      "id" : 1682325492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27433",
      "node_id" : "IC_kwDOABII585kRj_0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1682325492/reactions"
      },
      "updated_at" : "2023-08-17T13:50:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1682325492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Marked as draft because I'm now building on top of #26201, which touches and adds a relevant test to `getblocktemplate`. I'll unrebase and pick the test if that PR doesn't make it.\r\n\r\nI dropped 6ab119d4c1c8cf3d9c0994c22d75d016a30cdd6a: it's still necessary for the (mining software) client to tell us it supports SegWit. This is merely a checkbox now.\r\n\r\nIn the context of dropping `segwit` as a required rule I wrote:\r\n\r\n> We do the same thing with `csv`.\r\n\r\nI guess the argument here is that, unlike `segwit`, the `csv` (and `taproot`) soft fork is safe to use by a miner if they simply use the response from `getblocktemplate` without modifying it.\r\n\r\n\r\nThe extra `sigops`, `coinbase_reserved_sigops` and `coinbase_reserved_weight` field in the result is now tucked behind a `debug` argument.\r\n\r\nHope that addresses @luke-jr's concerns.\r\n\r\n\r\nAlthough the debug-only `coinbase_reserved_` arguments are just repeating a constant`*`, and the `sigops` field is straight-forward to calculate by iterating over all transactions, we can use the `debug` argument in the future to add additional stuff. Things that aid in anticipating what the next block should look like, e.g. for the [Mempool.Space](https://mempool.space) audit feature and @0xB10C's [miningpool.observer](https://miningpool.observer). For example we could expand the `transactions` result with a timestamp of when our mempool first saw it.\r\n\r\nI could however still drop the fields from 09fbc4cbfa7b7d86e6da00a737317151088b4b6c and ac3fcb240af8ef96d4e348548995ec1a536ff531, but keep the `Assume`.\r\n\r\n`*` = given that F2pool shot itself in the foot with custom patches, trying to squeeze out a few more sigops in their blocks, maybe we should make this configurable.",
      "created_at" : "2023-08-18T13:30:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27433#issuecomment-1683925822",
      "id" : 1683925822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27433",
      "node_id" : "IC_kwDOABII585kXqs-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1683925822/reactions"
      },
      "updated_at" : "2023-08-18T13:34:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1683925822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-12T14:47:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27433#issuecomment-1715871932",
      "id" : 1715871932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27433",
      "node_id" : "IC_kwDOABII585mRiC8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715871932/reactions"
      },
      "updated_at" : "2023-09-12T14:47:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715871932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-05T11:44:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27433#issuecomment-1878539995",
      "id" : 1878539995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27433",
      "node_id" : "IC_kwDOABII585v-D7b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1878539995/reactions"
      },
      "updated_at" : "2024-01-05T11:44:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1878539995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
