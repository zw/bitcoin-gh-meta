[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828016527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828016527"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This assumes that `OUTPUT_TYPES` is sorted by age? Maybe add a comment there to ensure this doesn't break?\r\n\r\nAlso, this is the wrong indentation? Maybe run clang-format?",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T13:35:04Z",
      "diff_hunk" : "@@ -767,10 +783,32 @@ static bool CreateTransactionInternal(\n \n     // Get available coins\n     std::vector<COutput> vAvailableCoins;\n-    AvailableCoins(wallet, vAvailableCoins, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n \n-    // Choose coins to use\n-    std::optional<SelectionResult> result = SelectCoins(wallet, vAvailableCoins, /* nTargetValue */ selection_target, coin_control, coin_selection_params);\n+    // First, do coin selection on a filtered subset of coins, filtered by OutputType\n+    // Attempt with older output types first (LEGACY > P2SH > BECH32 > BECH32M)\n+    std::optional<SelectionResult> result = [&] {\n+\tfor (const OutputType& type : OUTPUT_TYPES) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828016527",
      "id" : 828016527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xWoeP",
      "original_commit_id" : "312d9347b3e5e611ab28c1307d73345576dc4d7d",
      "original_line" : 790,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 911639998,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828016527/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-16T13:41:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828016527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think an argument against this change is that any privacy leaking tx could very well be a coin-join between two wallets that use different output types. Though, I don't think any such coin-join software exists today, so until then it probably makes sense to use inputs of a single type. \r\n\r\nI agree, until mixed inputs in transactions are more common, this change should improve user privacy.\r\n\r\n> https://github.com/bitcoin/bitcoin/pull/24362#pullrequestreview-909069657 mentions that legacy inputs could preferably be used during low-fee periods to reduce the fees paid by the user. Though, if https://github.com/bitcoin/bitcoin/pull/24362 is merged, then it would probably not be worth it to optimize for fees.\r\n\r\nI prefer this approach over #24362 in order to keep the privacy benefits of matching change output addresses for all address types. I also see this as a small first step, where we can optimize for fees in a later PR if it is deemed useful/worth it. ",
      "created_at" : "2022-03-16T13:59:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#issuecomment-1069161907",
      "id" : 1069161907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24584",
      "node_id" : "IC_kwDOABII584_uh2z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069161907/reactions"
      },
      "updated_at" : "2022-03-16T13:59:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069161907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828065439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828065439"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good catch, fixed the formatting! also added a comment re: output_types",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T14:19:48Z",
      "diff_hunk" : "@@ -767,10 +783,32 @@ static bool CreateTransactionInternal(\n \n     // Get available coins\n     std::vector<COutput> vAvailableCoins;\n-    AvailableCoins(wallet, vAvailableCoins, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n \n-    // Choose coins to use\n-    std::optional<SelectionResult> result = SelectCoins(wallet, vAvailableCoins, /* nTargetValue */ selection_target, coin_control, coin_selection_params);\n+    // First, do coin selection on a filtered subset of coins, filtered by OutputType\n+    // Attempt with older output types first (LEGACY > P2SH > BECH32 > BECH32M)\n+    std::optional<SelectionResult> result = [&] {\n+\tfor (const OutputType& type : OUTPUT_TYPES) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828065439",
      "id" : 828065439,
      "in_reply_to_id" : 828016527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xW0af",
      "original_commit_id" : "312d9347b3e5e611ab28c1307d73345576dc4d7d",
      "original_line" : 790,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 911711048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828065439/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-16T14:19:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828065439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Very exciting, I'm glad you're working on this. I was just discussing this idea with people yesterday.\r\n\r\nA couple comments on the approach described in the OP:\r\n- I noticed that you suggest preferring the spending of older types and compare it to spending newer types preferentially. While I do agree that the old types are the ones we'd want to get rid off rather, I am not sure this would lead to the optimal outcome. I would suggest running coin selection for each of the OutputGroup sets in parallel and then choosing the input set per the waste metric. Due to how the waste metric works, I'd expect this to lead to the older larger output types getting preferentially spent at lower feerates (and in the current feerate environment, usually first). What are your thoughts on that?\r\n- Regarding splitting the OutputGroups: since each OutputGroup will only have one type, you could just get the available set once and subdivide it from there to run the coin selection in parallel. Would that perhaps be easier?\r\n- CoinSelection is pretty fast, with the exception of Knapsack, so running it on subsets of the UTXO pool shouldn't be a huge issue, running it on all subsets in parallel may be even faster than running it on the whole UTXO pool once since the complexity of each subset would be much smaller.\r\n\r\nCeterum censeo Knapsackinem esse delendam.",
      "created_at" : "2022-03-16T14:20:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#issuecomment-1069182464",
      "id" : 1069182464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24584",
      "node_id" : "IC_kwDOABII584_um4A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069182464/reactions"
      },
      "updated_at" : "2022-03-16T14:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069182464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "force pushed to fix clang-formatting and add comments per @MarcoFalke 's suggestion. can be verified with `git range-diff master f900010 fdf1fa5`",
      "created_at" : "2022-03-16T14:20:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#issuecomment-1069183242",
      "id" : 1069183242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24584",
      "node_id" : "IC_kwDOABII584_unEK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069183242/reactions"
      },
      "updated_at" : "2022-03-16T14:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069183242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828078777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828078777"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe also mention the places that require it (CreateTransactionInternal), so that when those go away, the comment can go away, too?",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T14:31:27Z",
      "diff_hunk" : "@@ -22,6 +22,7 @@ enum class OutputType {\n     BECH32M,\n };\n \n+// Keep output types sorted by age, with older types first",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828078777",
      "id" : 828078777,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584xW3q5",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 25,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/outputtype.h",
      "position" : 4,
      "pull_request_review_id" : 911730230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828078777/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-16T18:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828078777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828302619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828302619"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In b32b52c3e7360ecb30e1a46dfa06669bc4fcd4b3 \"wallet: avoid mixing ouput types in coin selection\"\r\n\r\nThis is not guaranteed to be true. We could have a P2SH multisig and that would be `LEGACY`.",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T18:00:35Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828302619",
      "id" : 828302619,
      "line" : 197,
      "node_id" : "PRRC_kwDOABII584xXuUb",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 912059789,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828302619/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 196,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-16T18:07:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828302619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828330729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828330729"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "is there a cleaner way to go map a `COutput` to an `OutputType`? adding lots of if/else checks to go from a `TxoutType` to an `OutputType` seems clunky to me",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T18:36:10Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828330729",
      "id" : 828330729,
      "in_reply_to_id" : 828302619,
      "line" : 197,
      "node_id" : "PRRC_kwDOABII584xX1Lp",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 912098744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828330729/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 196,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-16T18:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828330729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828335217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828335217"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there any need to map to output type? Why not use `TxoutType` directly?",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T18:41:36Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828335217",
      "id" : 828335217,
      "in_reply_to_id" : 828302619,
      "line" : 197,
      "node_id" : "PRRC_kwDOABII584xX2Rx",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 911730230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828335217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 196,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-16T18:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828335217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828337242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828337242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Is there any need to map to output type? Why not use `TxoutType` directly?\r\n\r\nYes, `P2SH_SEGWIT` is distinct from other P2SH which would be legacy.\r\n\r\n> is there a cleaner way to go map a `COutput` to an `OutputType`? adding lots of if/else checks to go from a `TxoutType` to an `OutputType` seems clunky to me\r\n\r\nI don't think there exists one yet.",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T18:44:03Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828337242",
      "id" : 828337242,
      "in_reply_to_id" : 828302619,
      "line" : 197,
      "node_id" : "PRRC_kwDOABII584xX2xa",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 912107577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828337242/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 196,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-16T18:44:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828337242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828343513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828343513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I mean multisig P2SH should not be mixed with legacy either? Mapping to `OutputType` can't fix this. In fact it will probably break anyway when the wallet can spend segwit v2 outputs.",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T18:51:46Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828343513",
      "id" : 828343513,
      "in_reply_to_id" : 828302619,
      "line" : 197,
      "node_id" : "PRRC_kwDOABII584xX4TZ",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 912116249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828343513/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 196,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-16T18:51:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828343513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I would suggest running coin selection for each of the OutputGroup sets in parallel and then choosing the input set per the waste metric. Due to how the waste metric works, I'd expect this to lead to the older larger output types getting preferentially spent at lower feerates (and in the current feerate environment, usually first). What are your thoughts on that?\r\n\r\nThis makes a lot of sense. By running coin selection on each OutputGroup set you are preserving privacy by avoiding mixing the inputs, but also still choosing the best spend w.r.t to fees. Running them in parallel (as opposed to sequentially) also helps speed things up (which you also mentioned).\r\n\r\nI'll work on refactoring to implement this.\r\n\r\n",
      "created_at" : "2022-03-16T18:52:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#issuecomment-1069474564",
      "id" : 1069474564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24584",
      "node_id" : "IC_kwDOABII584_vuME",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069474564/reactions"
      },
      "updated_at" : "2022-03-16T18:52:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069474564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828357408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828357408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We could perhaps amend `availableCoins` to just return the outputs grouped by type already. E.g. `availableCoins` could be a struct with a vector for each an output type, and a member `all` that returns the four vectors concatenated.",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T19:08:56Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;\n+            } else if (type == TxoutType::PUBKEYHASH) {\n+                output_type = OutputType::LEGACY;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828357408",
      "id" : 828357408,
      "line" : 200,
      "node_id" : "PRRC_kwDOABII584xX7sg",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 200,
      "original_position" : 24,
      "original_start_line" : 189,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 912136611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828357408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 189,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-16T20:28:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828357408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828409065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828409065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's unlikely that multisig things would actually be mixed with single key things, but I think it would be incorrect to group P2SH with p2sh-segwit. Conceivably, the same multisig could have been p2sh, then upgraded to p2sh-segwit, and then to bech32. In that case, it would still be legacy, p2sh-segwit, and bech32.",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-16T20:16:34Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r828409065",
      "id" : 828409065,
      "in_reply_to_id" : 828302619,
      "line" : 197,
      "node_id" : "PRRC_kwDOABII584xYITp",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 912209235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828409065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 196,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-16T20:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828409065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24605](https://github.com/bitcoin/bitcoin/pull/24605) (test: Use MiniWallet in feature_coinstatsindex by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-03-17T19:22:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#issuecomment-1071243869",
      "id" : 1071243869,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24584",
      "node_id" : "IC_kwDOABII584_2eJd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1071243869/reactions"
      },
      "updated_at" : "2022-03-19T14:02:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1071243869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r830424080"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/830424080"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This assumes there is a strict preference for newer UTXO types. Rather, it should try to prefer using UTXOs that are not the user's preferred address type(s).",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-19T01:44:05Z",
      "diff_hunk" : "@@ -767,10 +783,32 @@ static bool CreateTransactionInternal(\n \n     // Get available coins\n     std::vector<COutput> vAvailableCoins;\n-    AvailableCoins(wallet, vAvailableCoins, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n \n-    // Choose coins to use\n-    std::optional<SelectionResult> result = SelectCoins(wallet, vAvailableCoins, /* nTargetValue */ selection_target, coin_control, coin_selection_params);\n+    // First, do coin selection on a filtered subset of coins, filtered by OutputType\n+    // Attempt with older output types first (LEGACY > P2SH > BECH32 > BECH32M)\n+    std::optional<SelectionResult> result = [&] {\n+        // This takes advantange of the fact that OUTPUT_TYPES is already sorted by age (LEGACY, P2SH, BECH32, BECH32M)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r830424080",
      "id" : 830424080,
      "line" : 790,
      "node_id" : "PRRC_kwDOABII584xf0QQ",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 790,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 52,
      "pull_request_review_id" : 914956407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/830424080/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-19T01:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/830424080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-22T07:05:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#issuecomment-1074807912",
      "id" : 1074807912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24584",
      "node_id" : "IC_kwDOABII585AEERo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1074807912/reactions"
      },
      "updated_at" : "2022-03-22T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1074807912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r832436604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832436604"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the amended approach is now that it would pick the input set with the best waste metric score from all SelectionResults of running coin selection on the separate output types.",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-22T17:22:43Z",
      "diff_hunk" : "@@ -767,10 +783,32 @@ static bool CreateTransactionInternal(\n \n     // Get available coins\n     std::vector<COutput> vAvailableCoins;\n-    AvailableCoins(wallet, vAvailableCoins, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n \n-    // Choose coins to use\n-    std::optional<SelectionResult> result = SelectCoins(wallet, vAvailableCoins, /* nTargetValue */ selection_target, coin_control, coin_selection_params);\n+    // First, do coin selection on a filtered subset of coins, filtered by OutputType\n+    // Attempt with older output types first (LEGACY > P2SH > BECH32 > BECH32M)\n+    std::optional<SelectionResult> result = [&] {\n+        // This takes advantange of the fact that OUTPUT_TYPES is already sorted by age (LEGACY, P2SH, BECH32, BECH32M)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r832436604",
      "id" : 832436604,
      "in_reply_to_id" : 830424080,
      "line" : 790,
      "node_id" : "PRRC_kwDOABII584xnfl8",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 790,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 52,
      "pull_request_review_id" : 917608420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832436604/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T17:22:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832436604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r832440386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832440386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "sorry, forgot to respond to this! yes, rather than rely on a forced ordering of old to new, I'm implementing @Xekyo 's suggestion of running coin selection on each output group and then picking the solution with the best waste metric. If no solution is found, then run coin selection over all coins (current behavior).",
      "commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "created_at" : "2022-03-22T17:26:32Z",
      "diff_hunk" : "@@ -767,10 +783,32 @@ static bool CreateTransactionInternal(\n \n     // Get available coins\n     std::vector<COutput> vAvailableCoins;\n-    AvailableCoins(wallet, vAvailableCoins, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n \n-    // Choose coins to use\n-    std::optional<SelectionResult> result = SelectCoins(wallet, vAvailableCoins, /* nTargetValue */ selection_target, coin_control, coin_selection_params);\n+    // First, do coin selection on a filtered subset of coins, filtered by OutputType\n+    // Attempt with older output types first (LEGACY > P2SH > BECH32 > BECH32M)\n+    std::optional<SelectionResult> result = [&] {\n+        // This takes advantange of the fact that OUTPUT_TYPES is already sorted by age (LEGACY, P2SH, BECH32, BECH32M)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r832440386",
      "id" : 832440386,
      "in_reply_to_id" : 830424080,
      "line" : 790,
      "node_id" : "PRRC_kwDOABII584xnghC",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 790,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 52,
      "pull_request_review_id" : 917613804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832440386/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T17:26:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832440386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836366695"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836366695"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done! ",
      "commit_id" : "072e755e553d3502572d7db1cbe04d73e31b6b2e",
      "created_at" : "2022-03-28T12:20:24Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;\n+            } else if (type == TxoutType::PUBKEYHASH) {\n+                output_type = OutputType::LEGACY;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836366695",
      "id" : 836366695,
      "in_reply_to_id" : 828357408,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x2fFn",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 200,
      "original_position" : 24,
      "original_start_line" : 189,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 923057173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836366695/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-28T12:20:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836366695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836367260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836367260"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've updated it now to not force an ordering on OutputType.",
      "commit_id" : "072e755e553d3502572d7db1cbe04d73e31b6b2e",
      "created_at" : "2022-03-28T12:21:08Z",
      "diff_hunk" : "@@ -767,10 +783,32 @@ static bool CreateTransactionInternal(\n \n     // Get available coins\n     std::vector<COutput> vAvailableCoins;\n-    AvailableCoins(wallet, vAvailableCoins, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n \n-    // Choose coins to use\n-    std::optional<SelectionResult> result = SelectCoins(wallet, vAvailableCoins, /* nTargetValue */ selection_target, coin_control, coin_selection_params);\n+    // First, do coin selection on a filtered subset of coins, filtered by OutputType\n+    // Attempt with older output types first (LEGACY > P2SH > BECH32 > BECH32M)\n+    std::optional<SelectionResult> result = [&] {\n+        // This takes advantange of the fact that OUTPUT_TYPES is already sorted by age (LEGACY, P2SH, BECH32, BECH32M)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836367260",
      "id" : 836367260,
      "in_reply_to_id" : 830424080,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x2fOc",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 790,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 923058023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836367260/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-28T12:21:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836367260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836371561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836371561"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "removed, now that it is not dependent on ordering",
      "commit_id" : "072e755e553d3502572d7db1cbe04d73e31b6b2e",
      "created_at" : "2022-03-28T12:25:59Z",
      "diff_hunk" : "@@ -22,6 +22,7 @@ enum class OutputType {\n     BECH32M,\n };\n \n+// Keep output types sorted by age, with older types first",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836371561",
      "id" : 836371561,
      "in_reply_to_id" : 828078777,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x2gRp",
      "original_commit_id" : "fdf1fa5e6c35564f33d874b86a45b7b0731f434d",
      "original_line" : 25,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/outputtype.h",
      "position" : null,
      "pull_request_review_id" : 923064239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836371561/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-28T12:25:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836371561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836394171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836394171"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is not guaranteed to be true. We could have a P2SH multisig and that would be `LEGACY`.\r\n\r\nso if a `P2SH_SEWGIT` and a `P2SH` multisig were spent together, when the UTXO is later spent it would reveal that some inputs were legacy multisig and others p2sh-segwit? \r\n\r\nAs an alternative, would it be better to map `WITNESS_V0_SCRIPTHASH` to `P2SH` and map `SCRIPTHASH` and `PUBKEYHASH` to `LEGACY`?",
      "commit_id" : "072e755e553d3502572d7db1cbe04d73e31b6b2e",
      "created_at" : "2022-03-28T12:50:53Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836394171",
      "id" : 836394171,
      "in_reply_to_id" : 828302619,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x2ly7",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 923096287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836394171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-28T12:50:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836394171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836525661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836525661"
         }
      },
      "author_association" : "MEMBER",
      "body" : "By the time we get determining the output type, we already know that the output either belongs to the wallet, or is watch only. Thus we can do additional solver invocations for scripthash with the redeemScript in order to figure out the true type.\r\n\r\nFor watch only outputs, we may not be able to do that because not all of the scripts will necessarily be available. However we could still use solving data provided in `coinControl` to try to determine that.",
      "commit_id" : "072e755e553d3502572d7db1cbe04d73e31b6b2e",
      "created_at" : "2022-03-28T14:55:26Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836525661",
      "id" : 836525661,
      "in_reply_to_id" : 828302619,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x3F5d",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 923287227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836525661/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-28T14:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836525661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836535681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836535681"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for pointing me in the right direction! I'll take a stab at implementing this",
      "commit_id" : "072e755e553d3502572d7db1cbe04d73e31b6b2e",
      "created_at" : "2022-03-28T15:04:39Z",
      "diff_hunk" : "@@ -186,6 +186,23 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n                 continue;\n             }\n \n+            OutputType output_type{wallet.m_default_address_type};\n+            std::vector<std::vector<uint8_t>> dummy;\n+            TxoutType type{Solver(wtx.tx->vout[i].scriptPubKey, dummy)};\n+            if (type == TxoutType::WITNESS_V1_TAPROOT) {\n+                output_type = OutputType::BECH32M;\n+            } else if (type == TxoutType::WITNESS_V0_KEYHASH) {\n+                output_type = OutputType::BECH32;\n+            } else if (type == TxoutType::SCRIPTHASH) {\n+                output_type = OutputType::P2SH_SEGWIT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24584#discussion_r836535681",
      "id" : 836535681,
      "in_reply_to_id" : 828302619,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584x3IWB",
      "original_commit_id" : "e27943dd91afbad679212d61b7b891f9f53818a0",
      "original_line" : 197,
      "original_position" : 21,
      "original_start_line" : 196,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 923301676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24584",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836535681/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-28T15:04:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/836535681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   }
]
