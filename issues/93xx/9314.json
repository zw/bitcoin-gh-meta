{
   "assignee" : null,
   "assignees" : [],
   "body" : "During IBD when many blocks are being UpdateTip()ed it can be very common for many new connections to be made but most of them timeout due to no messages being sent or received during the first 60 seconds. This was made worse recently by 902768099cb92b39f5ff509cd91fdd8970759b8a as now the version message is now sent from the messaging processing thread (and no longer the network connection thread) so the timeouts can occur from the remove peer also.\r\n\r\nPossible fixes are 1) to ensure the version message is sent upon connection from the network handling thread instead of the message processing thread which freezes during UpdateTip(), and 2) to change the disconnection logic for the 60s timeout so that it uses a timestamp set within the message processing thread (rather than a timestamp set possibly more than 60 seconds before it even gets a chance to process any messages).",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9314/comments",
   "created_at" : "2016-12-10T06:56:12Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9314/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/9314",
   "id" : 194749714,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9314/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 9314,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "60s timeouts during IBD",
   "updated_at" : "2016-12-10T08:11:36Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9314",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
      "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
      "followers_url" : "https://api.github.com/users/rebroad/followers",
      "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/rebroad",
      "id" : 1530283,
      "login" : "rebroad",
      "organizations_url" : "https://api.github.com/users/rebroad/orgs",
      "received_events_url" : "https://api.github.com/users/rebroad/received_events",
      "repos_url" : "https://api.github.com/users/rebroad/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/rebroad"
   }
}
