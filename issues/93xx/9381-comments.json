[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased ed457a39ebaa672cce21622d3af422fe50730580 -> b1ac3cff00a51c0b8965b7a85fa489c98409ddff to resolve merge conflicts with bumpfee (#8456).",
      "created_at" : "2017-01-25T18:30:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275191822",
      "id" : 275191822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTE5MTgyMg==",
      "updated_at" : "2017-01-25T18:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275191822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm thinking of splitting this up into two commits to make it easier to review. First commit would change CreateTransaction to return a CTransactionRef instead of CWalletTx. Second commit would change AddToWallet to accept a CTransactionRef instead of a CWalletTx.\r\n\r\nIf any reviewers would prefer this you can let me know.",
      "created_at" : "2017-01-25T18:48:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275196684",
      "id" : 275196684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTE5NjY4NA==",
      "updated_at" : "2017-01-25T18:48:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275196684",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Splitting commits into logical breaks is always appreciated.\n\nOn 01/25/17 18:48, Russell Yanofsky wrote:\n> I'm thinking of splitting this up into two commits to make it easier to\n> review. First commit would change CreateTransaction to return a\n> CTransactionRef instead of CWalletTx. Second commit would change\n> AddToWallet to accept a CTransactionRef instead of a CWalletTx.\n> \n> If any reviewers would prefer this you can let me know.\n> \n> Ã¢ÂÂ\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275196684>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAnoHu0xZqwtESQp3_rXWoR3OurDnNzgks5rV5kPgaJpZM4LRR4W>.\n> \n",
      "created_at" : "2017-01-25T19:26:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275207263",
      "id" : 275207263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTIwNzI2Mw==",
      "updated_at" : "2017-01-25T19:26:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275207263",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hum, reading this (finally) now, I'm not sure if I'm a big fan of this approach. The call-function-which-callsback-to-let-you-fill-in-things-that-really-should-have-been-arguments pattern really sucks. On the flip side, passing in CWalletTxes, and copying those into mapWallet can also lead to issues if you try to do anything to the object you just passed in thinking it is what got stored in the wallet (a mistake I made recently).\r\n\r\nMaybe we should adapt some of these functions (AddToWallet/CommitTransaction/whatever) to just always take an rvalue to a CWalletTx. This leaves only AddToWalletIfInvolvingMe (I think) which has to update-or-add, and that can just use an internal version of AddToWallet which takes the CWalletDB as an argument instead of creating its own.",
      "created_at" : "2017-01-25T22:17:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275250693",
      "id" : 275250693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTI1MDY5Mw==",
      "updated_at" : "2017-01-25T22:17:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275250693",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The call-function-which-callsback-to-let-you-fill-in-things-that-really-should-have-been-arguments pattern really sucks.\r\n\r\nIf you are adamant about this, could you say more about why it sucks? I think a callback is exactly the thing you want when you are doing an in-place update to a data structure.\r\n\r\nIn any case, I agree that CommitTransaction shouldn't take a callback, so I changed it to just take a transaction ref. So now there are way fewer callbacks (I think only 3 left in non-test code).\r\n\r\n\r\n",
      "created_at" : "2017-02-02T23:51:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-277122702",
      "id" : 277122702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NzEyMjcwMg==",
      "updated_at" : "2017-02-02T23:51:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277122702",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm just generally not a fan of callbacks making ownership models inconsistent. eg this kind of thing is where people always fuck up lockordering (though admittedly less so in this particular case, more the general case of callbacks going in both directions between modules).\r\n\r\nSo I do like this version much better, but still not sure the call back is required to be publicly exposed...Can we just leave MarkReplaced and add a similar function for importpruned funds to use (I dont believe the double-disk-sync in importprunedfunds will make for inconsistent/bad on-disk state?). Then we can make AddToWallet(..., callback) private and use AddToWalletIfInvolvingMe (which should probably also take a CTransactionRef, not a CTransaction, though maybe thats for a separate PR) publicly.",
      "created_at" : "2017-02-03T18:46:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-277328482",
      "id" : 277328482,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NzMyODQ4Mg==",
      "updated_at" : "2017-02-03T18:46:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277328482",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can we just leave MarkReplaced and add a similar function for importpruned funds to use\r\n\r\nWill try that. In the meantime I moved the non-AddToWallet cleanup to #9680 so it can be considered separately. By the way #9369 is another PR which significantly simplifies AddToWallet.",
      "created_at" : "2017-02-03T19:10:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-277335035",
      "id" : 277335035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NzMzNTAzNQ==",
      "updated_at" : "2017-02-03T19:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277335035",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can we just leave MarkReplaced and add a similar function for importpruned funds to use\r\n\r\nImplemented this suggestion. (New function is `CWallet::AddTransaction`). I also went ahead and disabled the CWalletTx copy constructor. Interestingly this uncovered a bunch of cases where we were unwittingly copying wallet transactions in loops due to writing:\r\n```c++\r\nfor (const std::pair<uint256, CWalletTx>& pairWtx : pwallet->mapWallet)\r\n```\r\n\r\ninstead of:\r\n```c++\r\nfor (const std::pair<const uint256, CWalletTx>& pairWtx : pwallet->mapWallet)\r\n```",
      "created_at" : "2017-12-01T22:31:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-348631717",
      "id" : 348631717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM0ODYzMTcxNw==",
      "updated_at" : "2017-12-01T22:31:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348631717",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r169884033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169884033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`CTransactionRef` is itself a pointer, so unless you intend for the caller to be able to modify what it points to, I think simply returning a `CTransactionRef` is better here. Every use case also seems to `*`-dereference it.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-02-22T08:33:12Z",
      "diff_hunk" : "@@ -12,27 +12,21 @@ WalletModelTransaction::WalletModelTransaction(const QList<SendCoinsRecipient> &\n     walletTransaction(0),\n     fee(0)\n {\n-    walletTransaction = new CWalletTx();\n-}\n-\n-WalletModelTransaction::~WalletModelTransaction()\n-{\n-    delete walletTransaction;\n }\n \n QList<SendCoinsRecipient> WalletModelTransaction::getRecipients() const\n {\n     return recipients;\n }\n \n-CWalletTx *WalletModelTransaction::getTransaction() const\n+CTransactionRef* WalletModelTransaction::getTransaction()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r169884033",
      "id" : 169884033,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTg4NDAzMw==",
      "original_commit_id" : "8e3dd3be1af06646a65cf2c22384dd156eced1a9",
      "original_position" : 18,
      "path" : "src/qt/walletmodeltransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 98480176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169884033",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase to fix travis (sorry)",
      "created_at" : "2018-03-08T15:21:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-371519076",
      "id" : 371519076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MTUxOTA3Ng==",
      "updated_at" : "2018-03-08T15:21:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371519076",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Needs rebase to fix travis (sorry)\r\n\r\nRebased 71bce6b0f4aee487026afd31ada41a4e6028abd3 -> 31297f007b2424ab5036258ed782aacc70237a7f ([pr/atw-nomerge.33](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.33) -> [pr/atw-nomerge.34](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.34)) for #12607.",
      "created_at" : "2018-03-12T18:55:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-372424339",
      "id" : 372424339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MjQyNDMzOQ==",
      "updated_at" : "2018-03-12T22:12:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372424339",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174259437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174259437"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r169884033\r\n\r\n> CTransactionRef is itself a pointer, so unless you intend for the caller to be able to modify what it points to, I think simply returning a CTransactionRef is better here. Every use case also seems to *-dereference it.\r\n\r\nGood idea, done in 64f182fa587f35081ed8026b44e2a36010364153.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-03-13T19:39:49Z",
      "diff_hunk" : "@@ -12,27 +12,21 @@ WalletModelTransaction::WalletModelTransaction(const QList<SendCoinsRecipient> &\n     walletTransaction(0),\n     fee(0)\n {\n-    walletTransaction = new CWalletTx();\n-}\n-\n-WalletModelTransaction::~WalletModelTransaction()\n-{\n-    delete walletTransaction;\n }\n \n QList<SendCoinsRecipient> WalletModelTransaction::getRecipients() const\n {\n     return recipients;\n }\n \n-CWalletTx *WalletModelTransaction::getTransaction() const\n+CTransactionRef* WalletModelTransaction::getTransaction()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174259437",
      "id" : 174259437,
      "in_reply_to_id" : 169884033,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDI1OTQzNw==",
      "original_commit_id" : "8e3dd3be1af06646a65cf2c22384dd156eced1a9",
      "original_position" : 18,
      "path" : "src/qt/walletmodeltransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 103583241,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174259437",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Re-slight-utACK 8a6ec70",
      "created_at" : "2018-03-13T23:27:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-372853226",
      "id" : 372853226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3Mjg1MzIyNg==",
      "updated_at" : "2018-03-13T23:27:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372853226",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased e15246fc310599770332021d14b96ce3f213a82b -> d62357a7c7c8c34a55580a31ddbfd04a9fa72591 ([pr/atw-nomerge.37](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.37) -> [pr/atw-nomerge.38](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.38)) due to conflict with #12681 and after merge of base PR #9680.",
      "created_at" : "2018-03-15T19:41:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-373499190",
      "id" : 373499190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MzQ5OTE5MA==",
      "updated_at" : "2018-03-15T19:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373499190",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174957667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174957667"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"Disable CWalletTx copy constructor\",\r\n\r\nCould add an empty constructor (or add default values)? I believe that would allow keeping `vWtx` as vector?",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-03-15T22:59:45Z",
      "diff_hunk" : "@@ -668,12 +668,9 @@ DBErrors CWalletDB::FindWalletTx(std::vector<uint256>& vTxHash, std::vector<CWal\n             if (strType == \"tx\") {\n                 uint256 hash;\n                 ssKey >> hash;\n-\n-                CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-                ssValue >> wtx;\n-\n                 vTxHash.push_back(hash);\n-                vWtx.push_back(wtx);\n+                vWtx.emplace_back(nullptr /* wallet */, nullptr /* tx */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174957667",
      "id" : 174957667,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDk1NzY2Nw==",
      "original_commit_id" : "bf59f2135d93bc175f7a1f630285d6479580e291",
      "original_position" : 19,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 87,
      "pull_request_review_id" : 104409901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174957667",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174958125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174958125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"Avoid copying CWalletTx in LoadToWallet\",\r\n\r\nThis and the `Init()` change could be in a different (trivial) commit.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-03-15T23:02:38Z",
      "diff_hunk" : "@@ -348,14 +348,13 @@ class CWalletTx : public CMerkleTx\n     mutable CAmount nAvailableWatchCreditCached;\n     mutable CAmount nChangeCached;\n \n-    CWalletTx(const CWallet* pwalletIn, CTransactionRef arg) : CMerkleTx(std::move(arg))\n+    CWalletTx(const CWallet* wallet, CTransactionRef arg) : CMerkleTx(std::move(arg)), pwallet(wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174958125",
      "id" : 174958125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDk1ODEyNQ==",
      "original_commit_id" : "62afca0ac31ee6db6beab800cc349157809e87da",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 104409901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174958125",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174960713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174960713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"Remove CWalletTx merging logic from AddToWallet\",\r\n\r\nShould stay? Related to #12681.\r\n\r\nLooks like [this code](https://github.com/bitcoin/bitcoin/pull/12681/files#diff-b2bb174788c7409b671c46ccc86034bdR3816) is not hit, otherwise the lock held assertion in `LookupBlockIndex` would cause travis failure here?",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-03-15T23:18:14Z",
      "diff_hunk" : "@@ -547,18 +547,11 @@ static int64_t AddTx(CWallet& wallet, uint32_t lockTime, int64_t mockTime, int64\n         block = inserted.first->second;\n         block->nTime = blockTime;\n         block->phashBlock = &hash;\n+        wallet.AddTransaction(MakeTransactionRef(tx), hash, 0);\n+    } else {\n+        wallet.AddTransaction(MakeTransactionRef(tx));\n     }\n-\n-    CWalletTx wtx(&wallet, MakeTransactionRef(tx));\n-    if (block) {\n-        wtx.SetMerkleBranch(block, 0);\n-    }\n-    {\n-        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174960713",
      "id" : 174960713,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDk2MDcxMw==",
      "original_commit_id" : "98ff78d5a272f9fef0057ebd8a4553cd2bead5ee",
      "original_position" : 14,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 14,
      "pull_request_review_id" : 104409901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174960713",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151138"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174957667\r\n\r\nIn commit \"Disable CWalletTx copy constructor\",\r\n\r\n> Could add an empty constructor (or add default values)? I believe that would allow keeping vWtx as vector?\r\n\r\nIt isn't enough because a vector needs its elements to be copyable or movable (otherwise it couldn't reallocate during expansion).",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-03-16T16:49:17Z",
      "diff_hunk" : "@@ -668,12 +668,9 @@ DBErrors CWalletDB::FindWalletTx(std::vector<uint256>& vTxHash, std::vector<CWal\n             if (strType == \"tx\") {\n                 uint256 hash;\n                 ssKey >> hash;\n-\n-                CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-                ssValue >> wtx;\n-\n                 vTxHash.push_back(hash);\n-                vWtx.push_back(wtx);\n+                vWtx.emplace_back(nullptr /* wallet */, nullptr /* tx */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151138",
      "id" : 175151138,
      "in_reply_to_id" : 174957667,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTE1MTEzOA==",
      "original_commit_id" : "bf59f2135d93bc175f7a1f630285d6479580e291",
      "original_position" : 19,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 87,
      "pull_request_review_id" : 104640583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151138",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174958125\r\n\r\nIn commit \"Avoid copying CWalletTx in LoadToWallet\",\r\n\r\n> This and the Init() change could be in a different (trivial) commit.\r\n\r\nGood catch, split 62afca0ac31ee6db6beab800cc349157809e87da into 5f10dfceef542ec19030e02d4954295bc0fa0428 and 9b178932e532bc507bc4e825a404e42deab726f9",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-03-16T16:49:52Z",
      "diff_hunk" : "@@ -348,14 +348,13 @@ class CWalletTx : public CMerkleTx\n     mutable CAmount nAvailableWatchCreditCached;\n     mutable CAmount nChangeCached;\n \n-    CWalletTx(const CWallet* pwalletIn, CTransactionRef arg) : CMerkleTx(std::move(arg))\n+    CWalletTx(const CWallet* wallet, CTransactionRef arg) : CMerkleTx(std::move(arg)), pwallet(wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151371",
      "id" : 175151371,
      "in_reply_to_id" : 174958125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTE1MTM3MQ==",
      "original_commit_id" : "62afca0ac31ee6db6beab800cc349157809e87da",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 104640583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151371",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151774"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174960713\r\n\r\nIn commit \"Remove CWalletTx merging logic from AddToWallet\",\r\n\r\n> Should stay? Related to #12681.\r\n\r\nIt's not needed because of the lock above:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/98ff78d5a272f9fef0057ebd8a4553cd2bead5ee/src/wallet/test/wallet_tests.cpp#L543\r\n\r\nThis is the reason there's no assert failure on travis.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-03-16T16:51:09Z",
      "diff_hunk" : "@@ -547,18 +547,11 @@ static int64_t AddTx(CWallet& wallet, uint32_t lockTime, int64_t mockTime, int64\n         block = inserted.first->second;\n         block->nTime = blockTime;\n         block->phashBlock = &hash;\n+        wallet.AddTransaction(MakeTransactionRef(tx), hash, 0);\n+    } else {\n+        wallet.AddTransaction(MakeTransactionRef(tx));\n     }\n-\n-    CWalletTx wtx(&wallet, MakeTransactionRef(tx));\n-    if (block) {\n-        wtx.SetMerkleBranch(block, 0);\n-    }\n-    {\n-        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151774",
      "id" : 175151774,
      "in_reply_to_id" : 174960713,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTE1MTc3NA==",
      "original_commit_id" : "98ff78d5a272f9fef0057ebd8a4553cd2bead5ee",
      "original_position" : 14,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 14,
      "pull_request_review_id" : 104640583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151774",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-06-15T20:09:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-397729081",
      "id" : 397729081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NzcyOTA4MQ==",
      "updated_at" : "2018-06-15T20:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/397729081",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Needs rebase \r\n\r\nRebased cad8b14857d8e310ebad8a850c9e6450e13360fc -> a494d2a4472ea63620b1f6cce20cb726590eb75b ([pr/atw-nomerge.42](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.42) -> [pr/atw-nomerge.43](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.43)) due to minor conflict with #13437.\r\nRebased a494d2a4472ea63620b1f6cce20cb726590eb75b -> 497f8a035ca2788564266f426033f52f982075ed ([pr/atw-nomerge.43](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.43) -> [pr/atw-nomerge.44](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.44)) due to conflict with #13622\r\nRebased 497f8a035ca2788564266f426033f52f982075ed -> ba8ade94a4291b761f6a0395a9d6345782388c91 ([pr/atw-nomerge.44](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.44) -> [pr/atw-nomerge.45](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.45)) due to conflict with #13774\r\nRebased ba8ade94a4291b761f6a0395a9d6345782388c91 -> 876d885730e8572e4616b0067595c91f0545dd55 ([pr/atw-nomerge.45](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.45) -> [pr/atw-nomerge.46](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.46)) due to conflict with #12992\r\nRebased 876d885730e8572e4616b0067595c91f0545dd55 -> 9274458aedb68919618b13568432998b35430e6f ([pr/atw-nomerge.46](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.46) -> [pr/atw-nomerge.47](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.47)) due to conflict with #14023\r\nRebased 9274458aedb68919618b13568432998b35430e6f -> a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5 ([pr/atw-nomerge.47](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.47) -> [pr/atw-nomerge.48](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.48)) due to conflict with #13825\r\nRebased a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5 -> 4b077293cec57f0b5f3bc010beb5ce1a9820a9ef ([pr/atw-nomerge.48](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.48) -> [pr/atw-nomerge.49](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.49)) due to conflict with #14287\r\nUpdated 4b077293cec57f0b5f3bc010beb5ce1a9820a9ef -> 15adcd19e49399590b5224a6a5e0a11e003eac53 ([pr/atw-nomerge.49](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.49) -> [pr/atw-nomerge.50](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.50)) with suggested lint fixes\r\nUpdated 15adcd19e49399590b5224a6a5e0a11e003eac53 -> ca7b4e24324464f04053145e58c25bfa5e0c5a51 ([pr/atw-nomerge.50](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.50) -> [pr/atw-nomerge.51](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.51)) with suggested lint fixes\r\nRebased ca7b4e24324464f04053145e58c25bfa5e0c5a51 -> 8cbc44f92f0932c87abadbd7c85e246d5b37b707 ([pr/atw-nomerge.51](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.51) -> [pr/atw-nomerge.52](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.52)) due to conflict with #11634\r\nAdded 1 commits 8cbc44f92f0932c87abadbd7c85e246d5b37b707 -> 845345c70c42411373a480406686b67870a235ad ([pr/atw-nomerge.52](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.52) -> [pr/atw-nomerge.53](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.53), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.52...pr/atw-nomerge.53)) with MeshCollider suggestions.\r\nRebased 845345c70c42411373a480406686b67870a235ad -> b35d6cd39f383af5c8d07312e7c7b8d2d3c12641 ([pr/atw-nomerge.53](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.53) -> [pr/atw-nomerge.54](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.54)) due to conflict with #14437\r\nRebased b35d6cd39f383af5c8d07312e7c7b8d2d3c12641 -> da86f39d50de1ca559c96c87e17228f73ee1afef ([pr/atw-nomerge.54](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.54) -> [pr/atw-nomerge.55](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.55)) due to conflict with #14711\r\nRebased da86f39d50de1ca559c96c87e17228f73ee1afef -> 596f85075d21c474f4ae5a98ad5c89da7ace1484 ([pr/atw-nomerge.55](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.55) -> [pr/atw-nomerge.56](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.56)) due to conflict with #15288\r\nRebased 596f85075d21c474f4ae5a98ad5c89da7ace1484 -> ab2bd422f77c37d232467c45cdfa57a581c8008b ([pr/atw-nomerge.56](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.56) -> [pr/atw-nomerge.57](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.57)) due to conflict with #15948",
      "created_at" : "2018-06-19T21:22:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-398550587",
      "id" : 398550587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5ODU1MDU4Nw==",
      "updated_at" : "2019-05-15T15:35:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/398550587",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK a494d2a4472ea63620b1f6cce20cb726590eb75b. I think the \"callback\" approach is perfectly fine here; they're not actual callbacks (in that they're not invoked at a different time or from a different thread); they're just functions to fill in values at the time the object is created.",
      "created_at" : "2018-06-27T01:24:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-400513131",
      "id" : 400513131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMDUxMzEzMQ==",
      "updated_at" : "2018-06-27T01:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/400513131",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-07-11T15:07:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-404204207",
      "id" : 404204207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNDIwNDIwNw==",
      "updated_at" : "2018-07-11T15:07:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404204207",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r214549286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Typo found by `codespell`: tranaction",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-09-02T18:36:06Z",
      "diff_hunk" : "@@ -985,13 +963,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the tranaction abandoned (see TODO above).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r214549286",
      "id" : 214549286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDU0OTI4Ng==",
      "original_commit_id" : "a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5",
      "original_position" : 128,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 151629344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549286",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424559"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-20 06:04:29 clang-tidy(pr=9381): src/wallet/wallet.cpp:843:64: warning: the parameter 'update_wtx' is copied for each invocation but only used as a const reference; consider making it a const reference [performance-unnecessary-value-param]\r\n2018-09-20 06:04:29 clang-tidy(pr=9381): src/wallet/wallet.cpp:903:66: warning: the parameter 'update_wtx' is copied for each invocation but only used as a const reference; consider making it a const reference [performance-unnecessary-value-param]\r\n```",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-09-21T08:45:08Z",
      "diff_hunk" : "@@ -833,65 +833,41 @@ bool CWallet::MarkReplaced(const uint256& originalHash, const uint256& newHash)\n     return success;\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n+bool CWallet::AddToWallet(CTransactionRef tx, UpdateWalletTxFn update_wtx, bool fFlushOnClose)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424559",
      "id" : 219424559,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyNDU1OQ==",
      "original_commit_id" : "a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 157596935,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424559",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424779"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424779"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems like `SetMerkleBranch` can be removed.\r\n\r\n```\r\n2018-09-20 06:29:02 cppcheck(pr=9381): [src/wallet/wallet.cpp:4237]: (style) The function 'SetMerkleBranch' is never used.\r\n```",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-09-21T08:45:57Z",
      "diff_hunk" : "@@ -211,18 +211,11 @@ static int64_t AddTx(CWallet& wallet, uint32_t lockTime, int64_t mockTime, int64\n         block = inserted.first->second;\n         block->nTime = blockTime;\n         block->phashBlock = &hash;\n+        wallet.AddTransaction(MakeTransactionRef(tx), hash, 0);\n+    } else {\n+        wallet.AddTransaction(MakeTransactionRef(tx));\n     }\n-\n-    CWalletTx wtx(&wallet, MakeTransactionRef(tx));\n-    if (block) {\n-        wtx.SetMerkleBranch(block, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424779",
      "id" : 219424779,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyNDc3OQ==",
      "original_commit_id" : "a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5",
      "original_position" : 11,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 157597199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424779",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17331](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17331.html) (Use effective values throughout coin selection by achow101)\n* [#17290](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17290.html) (Enable BnB coin selection for preset inputs and subtract fee from outputs by achow101)\n* [#16910](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16910.html) (wallet: reduce loading time by using unordered maps by achow101)\n* [#15931](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15931.html) (Remove GetDepthInMainChain dependency on locked chain interface by ariard)\n* [#13339](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13339.html) (wallet: Replace %w by wallet name in -walletnotify script by promag)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-21T13:34:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-423532570",
      "id" : 423532570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzUzMjU3MA==",
      "updated_at" : "2019-11-06T02:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423532570",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`new_tx` not used?",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-09-26T05:47:44Z",
      "diff_hunk" : "@@ -196,37 +196,41 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         {\n             uint256 hash;\n             ssKey >> hash;\n-            CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-            ssValue >> wtx;\n-            CValidationState state;\n-            if (!(CheckTransaction(*wtx.tx, state) && (wtx.GetHash() == hash) && state.IsValid()))\n-                return false;\n+            auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432539",
      "id" : 220432539,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMjUzOQ==",
      "original_commit_id" : "15adcd19e49399590b5224a6a5e0a11e003eac53",
      "original_position" : 9,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 158838614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432539",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432586"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`new_tx` not used?",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-09-26T05:48:07Z",
      "diff_hunk" : "@@ -992,13 +970,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432586",
      "id" : 220432586,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMjU4Ng==",
      "original_commit_id" : "15adcd19e49399590b5224a6a5e0a11e003eac53",
      "original_position" : 119,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 158838675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432586",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432616"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432616"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`new_tx` not used?",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-09-26T05:48:23Z",
      "diff_hunk" : "@@ -1076,6 +1064,20 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n     return true;\n }\n \n+bool CWallet::AddTransaction(CTransactionRef tx, const uint256& block_hash, int block_position)\n+{\n+    auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432616",
      "id" : 220432616,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMjYxNg==",
      "original_commit_id" : "15adcd19e49399590b5224a6a5e0a11e003eac53",
      "original_position" : 145,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 158838717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432616",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-10-24T09:41:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-432587989",
      "id" : 432587989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjU4Nzk4OQ==",
      "updated_at" : "2018-10-24T09:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432587989",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-11-09T15:17:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-437390474",
      "id" : 437390474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzM5MDQ3NA==",
      "updated_at" : "2018-11-09T15:17:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437390474",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Which TODO is this referring to?",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-11-12T01:47:00Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517780",
      "id" : 232517780,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjUxNzc4MA==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_position" : 102,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 173730418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517780",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517928"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this flush on close? Default is true but previously it didn't",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-11-12T01:48:54Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).\n+                if (wtx.isAbandoned()) {\n+                    wtx.hashBlock.SetNull();\n+                    updated = true;\n+                }\n+                return updated;\n+            };\n+            return AddToWallet(MakeTransactionRef(tx), update_wtx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517928",
      "id" : 232517928,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjUxNzkyOA==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_position" : 109,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 173730418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517928",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232743997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232743997"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517780\r\n\r\n> Which TODO is this referring to?\r\n\r\nThis is referring to the abandoned transaction TODO in AddToWalletIfInvolvingMe:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/wallet/wallet.h#L654-L658\r\n\r\nThe TODO was moved in #13651 to where it doesn't really make a lot of sense, so I'm moving it back here in 845345c70c42411373a480406686b67870a235ad.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-11-12T17:17:35Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232743997",
      "id" : 232743997,
      "in_reply_to_id" : 232517780,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjc0Mzk5Nw==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_position" : 102,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 174008578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232743997",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232744206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232744206"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517928\r\n\r\n> Should this flush on close? Default is true but previously it didn't\r\n\r\nGood catch. It should be safe to flush on close, but this change was not intentional. It's now set back to false in 845345c70c42411373a480406686b67870a235ad.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2018-11-12T17:18:17Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).\n+                if (wtx.isAbandoned()) {\n+                    wtx.hashBlock.SetNull();\n+                    updated = true;\n+                }\n+                return updated;\n+            };\n+            return AddToWallet(MakeTransactionRef(tx), update_wtx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232744206",
      "id" : 232744206,
      "in_reply_to_id" : 232517928,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjc0NDIwNg==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_position" : 109,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 174008578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232744206",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-05-07T16:08:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-490145363",
      "id" : 490145363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDE0NTM2Mw==",
      "updated_at" : "2019-05-07T16:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490145363",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-07-30T05:13:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-516264717",
      "id" : 516264717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjI2NDcxNw==",
      "updated_at" : "2019-07-30T05:13:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516264717",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-02T13:22:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-517698608",
      "id" : 517698608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzY5ODYwOA==",
      "updated_at" : "2019-08-02T13:22:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517698608",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-12T18:48:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-520548729",
      "id" : 520548729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDU0ODcyOQ==",
      "updated_at" : "2019-08-12T18:48:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520548729",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314299889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314299889"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe make `AddToWallet(` private to avoid exposing the `update_wtx` callback stuff?",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2019-08-15T13:10:34Z",
      "diff_hunk" : "@@ -1041,7 +1036,8 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     DBErrors ReorderTransactions();\n \n     void MarkDirty();\n-    bool AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose=true);\n+    typedef std::function<bool(CWalletTx& wtx, bool new_tx)> UpdateWalletTxFn;\n+    bool AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose=true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314299889",
      "id" : 314299889,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDI5OTg4OQ==",
      "original_commit_id" : "ea715a26257aa669d7e9577023dbec36dcb64936",
      "original_position" : 18,
      "path" : "src/wallet/wallet.h",
      "position" : 94,
      "pull_request_review_id" : 275417709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314299889",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314376966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314376966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314299889\r\n\r\n> Maybe make `AddToWallet(` private to avoid exposing the `update_wtx` callback stuff?\r\n\r\nI [added a doxygen comment](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.61..pr/atw-nomerge.62) to avoid confusion around the update_wtx callback (which is also used in a later commit by LoadToWallet, not just AddWallet).\r\n\r\nI would change AddToWallet from public to private here too, but this is awkward because AddToWallet is called from a static test function which can't be declared as a friend:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b8f3870c6a46052a80c694c0744a3eb56a9116ac/src/wallet/test/coinselector_tests.cpp#L68\r\n\r\nIn general I think trying to have better encapsulation in the wallet with a CWallet public / private boundary is probably never going to work out too well. Really CWallet needs to get broken up into smaller classes which can't access each others internal state, not just have a single big boundary.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2019-08-15T15:52:55Z",
      "diff_hunk" : "@@ -1041,7 +1036,8 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     DBErrors ReorderTransactions();\n \n     void MarkDirty();\n-    bool AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose=true);\n+    typedef std::function<bool(CWalletTx& wtx, bool new_tx)> UpdateWalletTxFn;\n+    bool AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose=true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314376966",
      "id" : 314376966,
      "in_reply_to_id" : 314299889,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM3Njk2Ng==",
      "original_commit_id" : "ea715a26257aa669d7e9577023dbec36dcb64936",
      "original_position" : 18,
      "path" : "src/wallet/wallet.h",
      "position" : 94,
      "pull_request_review_id" : 275515359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-15T16:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314376966",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @achow101 how does this jive with wallet boxes #16341?\r\n\r\nAFAICT They don't interact at all. The only part of #16341 that touches transactions is a small section in `AddToWalletIfInvolvingMe` which this PR does not touch.",
      "created_at" : "2019-08-15T18:15:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-521741857",
      "id" : 521741857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTc0MTg1Nw==",
      "updated_at" : "2019-08-15T18:15:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521741857",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 825a514481dd69dc7038c7f4c974a76cb2becd87, but Travis is in a state of despair, perhaps due to #16582 (@MarcoFalke?)",
      "created_at" : "2019-08-15T18:44:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-521751666",
      "id" : 521751666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTc1MTY2Ng==",
      "updated_at" : "2019-08-15T18:44:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521751666",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314803066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314803066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If tx isn't already in mapWallet, it's going to be a fInsertedNew one, if it's already there we surely want to get them fUpdated on disk, and I think both callback return true, excepts for a transaction being disconnected ? Maybe all this flags could be simplified in a further work.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2019-08-16T16:49:49Z",
      "diff_hunk" : "@@ -1086,73 +1086,50 @@ bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n     return srctx && ExtractDestination(srctx->tx->vout[n].scriptPubKey, dst) && IsUsedDestination(dst);\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n+bool CWallet::AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose)\n {\n     LOCK(cs_wallet);\n \n     WalletBatch batch(*database, \"r+\", fFlushOnClose);\n \n-    uint256 hash = wtxIn.GetHash();\n+    uint256 hash = tx->GetHash();\n \n     if (IsWalletFlagSet(WALLET_FLAG_AVOID_REUSE)) {\n         // Mark used destinations\n-        for (const CTxIn& txin : wtxIn.tx->vin) {\n+        for (const CTxIn& txin : tx->vin) {\n             const COutPoint& op = txin.prevout;\n             SetUsedDestinationState(op.hash, op.n, true);\n         }\n     }\n \n     // Inserts only if not already there, returns tx inserted or tx found\n-    std::pair<std::map<uint256, CWalletTx>::iterator, bool> ret = mapWallet.insert(std::make_pair(hash, wtxIn));\n+    auto ret = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(this, tx));\n     CWalletTx& wtx = (*ret.first).second;\n     wtx.BindWallet(this);\n     bool fInsertedNew = ret.second;\n+    bool fUpdated = update_wtx(wtx, fInsertedNew);\n     if (fInsertedNew) {\n         wtx.nTimeReceived = chain().getAdjustedTime();\n         wtx.nOrderPos = IncOrderPosNext(&batch);\n         wtx.m_it_wtxOrdered = wtxOrdered.insert(std::make_pair(wtx.nOrderPos, &wtx));\n         wtx.nTimeSmart = ComputeTimeSmart(wtx);\n         AddToSpends(hash);\n     }\n-\n-    bool fUpdated = false;\n     if (!fInsertedNew)\n     {\n-        // Merge\n-        if (!wtxIn.hashUnset() && wtxIn.hashBlock != wtx.hashBlock)\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        // If no longer abandoned, update\n-        if (wtxIn.hashBlock.IsNull() && wtx.isAbandoned())\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        if (wtxIn.nIndex != -1 && (wtxIn.nIndex != wtx.nIndex))\n-        {\n-            wtx.nIndex = wtxIn.nIndex;\n-            fUpdated = true;\n-        }\n-        if (wtxIn.fFromMe && wtxIn.fFromMe != wtx.fFromMe)\n-        {\n-            wtx.fFromMe = wtxIn.fFromMe;\n-            fUpdated = true;\n-        }\n         // If we have a witness-stripped version of this transaction, and we\n         // see a new version with a witness, then we must be upgrading a pre-segwit\n         // wallet.  Store the new version of the transaction with the witness,\n         // as the stripped-version must be invalid.\n         // TODO: Store all versions of the transaction, instead of just one.\n-        if (wtxIn.tx->HasWitness() && !wtx.tx->HasWitness()) {\n-            wtx.SetTx(wtxIn.tx);\n+        if (tx->HasWitness() && !wtx.tx->HasWitness()) {\n+            wtx.SetTx(tx);\n             fUpdated = true;\n         }\n     }\n \n     //// debug print\n-    WalletLogPrintf(\"AddToWallet %s  %s%s\\n\", wtxIn.GetHash().ToString(), (fInsertedNew ? \"new\" : \"\"), (fUpdated ? \"update\" : \"\"));\n+    WalletLogPrintf(\"AddToWallet %s  %s%s\\n\", hash.ToString(), (fInsertedNew ? \"new\" : \"\"), (fUpdated ? \"update\" : \"\"));\n \n     // Write to disk\n     if (fInsertedNew || fUpdated)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314803066",
      "id" : 314803066,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDgwMzA2Ng==",
      "original_commit_id" : "6731aac44784a4be3f195989549defd0d04d695b",
      "original_position" : 81,
      "path" : "src/wallet/wallet.cpp",
      "position" : 81,
      "pull_request_review_id" : 276057005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-16T17:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314803066",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314813155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314813155"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmm new execution flow doesn't make it easier to understand. Maybe mapWallet should be access directly in `ReadKeyValue`, when as you said in another comment wallet components are broken up in smaller classes. I think, but need to test, that `MarkConflicted` and its loop is useless here.",
      "commit_id" : "825a514481dd69dc7038c7f4c974a76cb2becd87",
      "created_at" : "2019-08-16T17:18:04Z",
      "diff_hunk" : "@@ -1157,12 +1157,13 @@ bool CWallet::AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx\n     return true;\n }\n \n-void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n+bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& update_wtx)\n {\n-    uint256 hash = wtxIn.GetHash();\n-    const auto& ins = mapWallet.emplace(hash, wtxIn);\n+    auto ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(this, nullptr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314813155",
      "id" : 314813155,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDgxMzE1NQ==",
      "original_commit_id" : "8c4c8cc53896f01ea1fd4a09ba0e01052b4fbad4",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 100,
      "pull_request_review_id" : 276057005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "updated_at" : "2019-08-16T17:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314813155",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-09-05T14:11:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-528383439",
      "id" : 528383439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODM4MzQzOQ==",
      "updated_at" : "2019-09-05T14:11:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528383439",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-23T10:50:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-545385662",
      "id" : 545385662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTM4NTY2Mg==",
      "updated_at" : "2019-10-23T10:50:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545385662",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-24T11:41:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-545878919",
      "id" : 545878919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTg3ODkxOQ==",
      "updated_at" : "2019-10-24T11:41:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545878919",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-08T11:06:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-551591602",
      "id" : 551591602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTU5MTYwMg==",
      "updated_at" : "2019-11-08T11:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551591602",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
