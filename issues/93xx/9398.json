{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "`bitcoin-qt` shutdown systematically takes about 5 minutes on my new `debian stretch` system. A typical debug file looks as follows:\r\n\r\n    2016-12-20 19:58:55 AcceptToMemoryPool: peer=3: accepted 2b8c3...5c14 (poolsz ...\r\n    2016-12-20 19:58:56 AcceptToMemoryPool: peer=3: accepted 4a3d1...7e0e (poolsz ...\r\n    2016-12-20 19:58:56 tor: Thread interrupt\r\n    2016-12-20 19:58:56 scheduler thread interrupt\r\n    2016-12-20 19:58:56 torcontrol thread exit\r\n    2016-12-20 19:58:56 opencon thread interrupt\r\n    2016-12-20 19:58:56 addcon thread interrupt\r\n    2016-12-20 19:58:56 msghand thread interrupt\r\n    2016-12-20 19:58:56 net thread interrupt\r\n\r\nThis is where it hangs for a few minutes, then:\r\n\r\n    2016-12-20 20:05:58 Imported mempool transactions from disk: 10932 successes, 476 failed, 0 expired\r\n    2016-12-20 20:05:58 Shutdown: In progress...\r\n    2016-12-20 20:05:58 Stop\r\n    2016-12-20 20:05:59 Erased 1 orphan tx from peer 5 \r\n    2016-12-20 20:06:01 Dumped mempool: 0.063746s to copy, 1.55051s to dump\r\n    2016-12-20 20:06:01 Shutdown: done\r\n \r\nI have never experienced this behavior before. However, I am dealing with a pre-release test build (v0.13.99.0-8c7947e) on a new version of `debian` (`stretch`) on new hardware which is very cheap and very slow. (**EDIT:** I initially thought this behavior was specific to `bitcoin-qt` and that `bitcoind` would shutdown immediately, but I have just had a case of `bitcoind` taking 5 minutes to shutdown.)\r\n \r\n    $ uname -a \r\n    Linux front 4.8.0-1-amd64 #1 SMP Debian 4.8.7-1 (2016-11-13) x86_64 GNU/Linux\r\n    \r\n    $ lscpu\r\n    CPU op-mode(s):        32-bit, 64-bit\r\n    Byte Order:            Little Endian\r\n    CPU(s):                2\r\n    On-line CPU(s) list:   0,1\r\n    Thread(s) per core:    1\r\n    Core(s) per socket:    2\r\n    Socket(s):             1\r\n    NUMA node(s):          1\r\n    Vendor ID:             GenuineIntel\r\n    CPU family:            6\r\n    Model:                 76\r\n    Model name:            Intel(R) Celeron(R) CPU  N3050  @ 1.60GHz\r\n    Stepping:              3\r\n    CPU MHz:               479.980\r\n    CPU max MHz:           2160.0000\r\n    CPU min MHz:           480.0000\r\n    BogoMIPS:              3200.00\r\n    Virtualization:        VT-x\r\n    L1d cache:             24K\r\n    L1i cache:             32K\r\n    L2 cache:              1024K\r\n    NUMA node0 CPU(s):     0,1\r\n    Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 \r\n    clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon \r\n    pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor\r\n    ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes\r\n    rdrand lahf_lm 3dnowprefetch epb tpr_shadow vnmi flexpriority ept vpid tsc_adjust smep erms\r\n    dtherm ida arat\r\n\r\n    $ df -h\r\n    Filesystem                  Size  Used Avail Use% Mounted on\r\n    udev                        3.9G     0  3.9G   0% /dev\r\n    tmpfs                       790M   18M  772M   3% /run\r\n    /dev/mapper/front--vg-root   23G  8.5G   14G  40% /\r\n    tmpfs                       3.9G  428K  3.9G   1% /dev/shm\r\n    tmpfs                       5.0M     0  5.0M   0% /run/lock\r\n    tmpfs                       3.9G     0  3.9G   0% /sys/fs/cgroup\r\n    /dev/mapper/front--vg-var   9.2G  2.2G  6.5G  26% /var\r\n    /dev/mapper/front--vg-tmp   1.8G  8.0M  1.7G   1% /tmp\r\n    /dev/sda2                   237M   38M  187M  17% /boot\r\n    /dev/sda1                   511M  132K  511M   1% /boot/efi\r\n    /dev/mapper/front--vg-home  874G  131G  699G  16% /home\r\n    tmpfs                       790M   16K  790M   1% /run/user/117\r\n    tmpfs                       790M   24K  790M   1% /run/user/1000\r\n \r\n    $ free\r\n                  total        used        free      shared  buff/cache   available\r\n    Mem:        8083768     1237252     2104880      267092     4741636     6273948\r\n    Swap:       8290300           0     8290300\r\n",
   "closed_at" : "2017-01-09T06:43:42Z",
   "closed_by" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 8,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9398/comments",
   "created_at" : "2016-12-21T06:46:19Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9398/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/9398",
   "id" : 196859192,
   "labels" : [
      {
         "color" : "fef2c0",
         "default" : false,
         "id" : 164208572,
         "name" : "Mempool",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Mempool"
      },
      {
         "color" : "981023",
         "default" : false,
         "id" : 326918230,
         "name" : "Resource usage",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Resource%20usage"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9398/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 9398,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "bitcoin-qt (and possibly bitcoind) shutdown delay on debian stretch",
   "updated_at" : "2017-01-09T06:43:42Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9398",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/12125789?v=4",
      "events_url" : "https://api.github.com/users/possientis/events{/privacy}",
      "followers_url" : "https://api.github.com/users/possientis/followers",
      "following_url" : "https://api.github.com/users/possientis/following{/other_user}",
      "gists_url" : "https://api.github.com/users/possientis/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/possientis",
      "id" : 12125789,
      "login" : "possientis",
      "organizations_url" : "https://api.github.com/users/possientis/orgs",
      "received_events_url" : "https://api.github.com/users/possientis/received_events",
      "repos_url" : "https://api.github.com/users/possientis/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/possientis/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/possientis/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/possientis"
   }
}
