{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "I am using fourth chair adjustment logic to calculate miner reward for a given block. If miner can insert additional inputs in coinbase transaction and transaction outputs do not cover input value, it may be possible to generate negative mining reward and decrease bitcoin supply.\n\nRevelant part of logic expressed in python 3 goes below. Variables `data2jsonobject`, `requestrpcjobqueue`, `rpcsocketqueue`, `ipportpair`, `rpcauthpair` are defined outside from this part of code. Last parameter pushed in `requestrpcjobqueue` returns a pair with status and raw data returned from bitcoin client.\n\n```\ntransactioncountstatus = b'not processed'\ntransactioncount = b''\nminerrewardstatus = b'not processed'\nminerreward = b''\ntry:\n    coinbasetransactionid = data2jsonobject['result']['tx'][0].encode()\n    transactioncount = str(len(data2jsonobject['result']['tx'])).encode()\n    transactioncountstatus = b'ok'\n    coinbasetransactionhandle = queue.Queue()\n    requestrpcjobqueue.put((rpcsocketqueue, ipportpair, rpcauthpair, b'{\"jsonrpc\": \"1.0\", \"method\": \"getrawtransaction\", \"params\": [\"' + coinbasetransactionid + b'\", 1]}', coinbasetransactionhandle))\n    rpcstatus3, data3 = coinbasetransactionhandle.get()\n    if rpcstatus3 = b'received':\n        try:\n            data3jsonobject = json.loads(data3.decode())\n            txinput = data3jsonobject['result']['vin'][0]\n            txinputcount = len(data3jsonobject['result']['vin'])\n            k = 0\n            coinbaseinputstatus = b'not found'\n            coinbaseoutputvalue = 0\n            txoutput = data3jsonobject['result']['vout'][0]\n            txoutputcount = len(data3jsonobject['result']['vin'])\n            while k < txoutputcount:\n                coinbaseoutputvalue += data3jsonobject['result']['vin'][k]['value']\n                k += 1\n            k = 0\n            noncoinbaseinputvalue = 0\n            while k < txinputcount:\n                txinput = data3jsonobject['result']['vin'][k]\n                col84status = b'no failures'\n                try:\n                    col88x = txinput['coinbase']\n                    coinbaseinputstatus = b'found'\n                except KeyError:\n                    col88txid = txinput['txid'].encode()\n                    col88vout = str(txinput['vout']).encode()\n                    col88handle = queue.Queue()\n                    requestrpcjobqueue.put((rpcsocketqueue, ipportpair, rpcauthpair, b'{\"jsonrpc\": \"1.0\", \"method\": \"getrawtransaction\", \"params\": [\"' + col88txid + b'\", 1]}', col88handle))\n                    col88rpcstatus, col88data = col88handle.get()\n                    col88status = b'not processed'\n                    if col88rpcstatus == b'received':\n                        col92jsonobject = json.loads(col88data.decode())\n                        col92count = len(col92jsonobject['result']['vout'])\n                        col92i = 0\n                        while col92i < col92count:\n                            if str(col92jsonobject['result']['vout'][col92i]['n']).encode() == col88vout:\n                                noncoinbaseinputvalue += col92jsonobject['result']['vout'][col92i]['value']\n                                col88status = b'ok'\n                            col92i += 1\n                    if col88status != b'ok':\n                        col84status = b'could not find transaction ' + col88txid + b' with output ' + col88vout\n                if col84status != b'no failures':\n                    coinbaseinputstatus = col84status\n                    break\n                k += 1\n            if coinbaseinputstatus == b'found':\n                minerreward = str(coinbaseoutputvalue - noncoinbaseinputvalue).encode()\n                minerrewardstatus = b'ok'\n        except json.decoder.JSONDecodeError:\n            minerrewardstatus = b'could not interpret rpc json response'\n        except KeyError:\n            minerrewardstatus = b'unexpected rpc json response structure'\n            try:\n                minerrewardstatus = b'rpc json error message: ' + json.loads(data3.decode())['error']['message'].encode()\n            except KeyError:\n                pass\nexcept KeyError:\n    transactioncountstatus = b'unexpected rpc json response structure'\n    try:\n        transactioncountstatus = b'rpc json error message: ' + data2jsonobject['error']['message'].encode()\n    except KeyError:\n        pass\n```\n",
   "closed_at" : "2016-08-16T10:50:00Z",
   "closed_by" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8480/comments",
   "created_at" : "2016-08-07T10:20:48Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8480/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/8480",
   "id" : 169789920,
   "labels" : [
      {
         "color" : "009800",
         "default" : false,
         "id" : 192202000,
         "name" : "Consensus",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Consensus"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8480/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 8480,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Negative mining reward may not be disallowed",
   "updated_at" : "2016-08-16T10:50:00Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8480",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/17480000?v=4",
      "events_url" : "https://api.github.com/users/johnjacksonbtc/events{/privacy}",
      "followers_url" : "https://api.github.com/users/johnjacksonbtc/followers",
      "following_url" : "https://api.github.com/users/johnjacksonbtc/following{/other_user}",
      "gists_url" : "https://api.github.com/users/johnjacksonbtc/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/johnjacksonbtc",
      "id" : 17480000,
      "login" : "johnjacksonbtc",
      "organizations_url" : "https://api.github.com/users/johnjacksonbtc/orgs",
      "received_events_url" : "https://api.github.com/users/johnjacksonbtc/received_events",
      "repos_url" : "https://api.github.com/users/johnjacksonbtc/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/johnjacksonbtc/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/johnjacksonbtc/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/johnjacksonbtc"
   }
}
