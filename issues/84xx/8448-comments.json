[
   {
      "body" : "We'll need to add `mempool.dat` to doc/files.md",
      "created_at" : "2016-08-03T04:53:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237138396",
      "id" : 237138396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T04:53:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237138396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "Why not behind a command line flag?",
      "created_at" : "2016-08-03T06:43:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237155942",
      "id" : 237155942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237155942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Concept ACK. \r\n\r\n> Why not behind a command line flag?\r\n\r\nAgreed. It can be enabled by default.\r\nBut people may want to disable this functionality, the per-10 minute dump could interfere with benchmarks and such for example.\r\n",
      "created_at" : "2016-08-03T06:55:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237157818",
      "id" : 237157818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T06:55:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237157818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289150"
         }
      },
      "body" : "`.string().c_str()`",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T06:58:29Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289150",
      "id" : 73289150,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T06:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289274"
         }
      },
      "body" : "I don't think missing this file should be an error. I remember users being confused by errors about other files missing (peers.dat), which are simply generated by the application anyhow.",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T06:59:40Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        return error(\"Failed to open mempool file from disk\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289274",
      "id" : 73289274,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 84,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T06:59:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289367"
         }
      },
      "body" : "Please use a constant `MEMPOOL_DUMP_VERSION` or so",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:00:59Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        return error(\"Failed to open mempool file from disk\");\n+    }\n+\n+    int64_t count = 0;\n+\n+    try {\n+        uint64_t version;\n+        file >> version;\n+        if (version != 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289367",
      "id" : 73289367,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 92,
      "path" : "src/main.cpp",
      "position" : 92,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:00:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289502"
         }
      },
      "body" : "Good point.",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:02:42Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        return error(\"Failed to open mempool file from disk\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289502",
      "id" : 73289502,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 84,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:02:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289509"
         }
      },
      "body" : "Seems to work fine?",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:02:48Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289509",
      "id" : 73289509,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289794"
         }
      },
      "body" : "Nono, travis failed because of this (https://travis-ci.org/bitcoin/bitcoin/jobs/149377465#L2149).",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:06:24Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289794",
      "id" : 73289794,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:13:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Concept ACK\r\n\r\n```\r\n000000e0  7a 8e 6e 84 83 ab c4 ca  20 fb 9b 88 ac 00 00 00  |z.n..... .......|\r\n000000f0  00 00 00 00 00 0f 6a 0d  48 61 6c 6c 6f 55 62 69  |......j.HalloUbi|\r\n00000100  72 63 68 74 21 00 00 00  00 0d 9a a1 57 00 00 00  |rcht!.......W...|\r\n```\r\n\r\nAs we dump raw txes from the mempool, this will conflict with current status of \"antivirus-compliant\" storage and dumping `mempool.dat` can stop the `bitcoind` from running, ie. new DoS vector.\r\n",
      "created_at" : "2016-08-03T07:30:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237163938",
      "id" : 237163938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T07:30:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237163938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "2016-08-03 07:29:00 Dumped mempool: 1.9e-05s to copy, 0.005925s to dump\r\n",
      "created_at" : "2016-08-03T07:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237164001",
      "id" : 237164001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T07:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237164001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73295279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73295279"
         }
      },
      "body" : "~~IIRC the `fopen` parameters are `restrict` (or often are in the impl),  and assumed to be there for the lifetime of the file pointer... I don't think this temporary holds those variants and might cause UB?~~\r\n\r\n~~I could be wrong.~~\r\n**edit**: that may only be in the C standard, not C++\r\n\r\nI suspect it is completely irrelevant,  seeing how prevalent this pattern is throughout the code.",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:57:53Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73295279",
      "id" : 73295279,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T08:07:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73295279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "> As we dump raw txes from the mempool, this will conflict with current status of \"antivirus-compliant\" storage and dumping mempool.dat can stop the bitcoind from running, ie. new DoS vector.\r\n\r\nA fair point. Though a missing, or corrupted mempool.dat should never cause bitcoind to stop running. At most this will lose the mempool contents (at next start) due to the file being quarantined.\r\n",
      "created_at" : "2016-08-03T08:35:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237177243",
      "id" : 237177243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T08:35:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237177243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "More XOR?",
      "created_at" : "2016-08-03T08:44:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237179183",
      "id" : 237179183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T08:44:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237179183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Indeed this probably should be XOR'd with a random key.",
      "created_at" : "2016-08-03T08:57:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237181848",
      "id" : 237181848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T08:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237181848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "> At most this will lose the mempool contents (at next start) due to the file being quarantined.\r\n\r\nYes, but this is something different. AV can stop `bitcoind` with a dialog: Ã¢ÂÂThis app is writing a virus to your disk. OK | ErrorÃ¢ÂÂ.",
      "created_at" : "2016-08-03T09:31:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237189718",
      "id" : 237189718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T09:31:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237189718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "> At most this will lose the mempool contents due to the file being quarantined.\n\nAV can be configured to stop `bitcoind` with a dialog: Ã¢ÂÂThis app is writing a virus to your disk. OK | ErrorÃ¢ÂÂ. This is outside of `bitcoind`Ã¢ÂÂ¦",
      "created_at" : "2016-08-03T10:05:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237197059",
      "id" : 237197059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T10:05:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237197059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Concept ACK and the code size is surprisingly small!\r\n\r\nThe only thing that I miss (not directly related to this PR) is an opportunity to keep a history of some major mempool data (feerate, size, tx rate, etc.). Another option would be keeping ~24*6 dumps per day that would could be stored in file-diff-deltas to allow generating any types of statistics.",
      "created_at" : "2016-08-03T14:16:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237249305",
      "id" : 237249305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T14:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237249305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I don't really see a huge benefit in doing this.  It seems like unless you are immediately restarting, you'll be wasting a lot of time trying to load already confirmed transactions or low fee spam.  That said I don't object to making it a command line argument, but I would suggest it default to off.\r\n\r\nWhat's the rationale for running it every 10 minutes?  You can copy it from one running node to start another or to handle crashes?",
      "created_at" : "2016-08-03T16:23:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237288245",
      "id" : 237288245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T16:23:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237288245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "I think it should be off by default. And when it is, we can even skip XORing it, I think as it is expert level feature anyway.\r\n\r\nOr the other way: create a RPC to dump mempool and that's all. But this way we loose the save-on-restart feature which is nice (which can be worked around by `dumpmempool` and restart).",
      "created_at" : "2016-08-03T16:45:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237294249",
      "id" : 237294249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T16:45:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237294249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@morcos The reason for dumping every 10 minutes is so that prioritization data is not lost in case of a crash.\r\n\r\nBut perhaps we should have separate files for that. prioritization.dat which is continuously dumped (maybe only after mapDeltas changed?), and mempool.dat which is only saved at shutdown?",
      "created_at" : "2016-08-03T17:36:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237309685",
      "id" : 237309685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T17:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237309685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> wasting a lot of time trying to load already confirmed transactions or low fee spam\r\n\r\nCould it help to save the current block height to the mempool.dat and then discard mempool.dat on start when current height > 3 + height when mempool was saved?",
      "created_at" : "2016-08-03T17:44:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237312227",
      "id" : 237312227,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T17:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237312227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "This has split into two threads, really:\r\n1) mempool persistence across restarts\r\n2) persisting prio deltas across restarts & crashes\r\n2.1) side note - other state such as wallet locked coins (lockunspent) should be persisted also\r\n\r\nPersisting bits of state like prio deltas is useful, and seems applicable to a continuous-log or database solution, that can be restored at startup.\r\n\r\nAs for mempool restore...\r\n\r\nStandard rhetorical questions:  Who will really use mempool restore, and how often?\r\n\r\n* Historically, users really do not like features that pause shutdown for a long time.  We spent time optimizing bitcoind shutdown in the past.\r\n* Dump on shutdown does not provide crash protection (as @sipa noted)\r\n* Alternatives to dump-on-shutdown involve a lot of disk traffic (logging or db soln) at runtime, and introduce additional I/O stress points for remote attackers to exploit.\r\n* Therefore, the only use case for dump-on-shutdown is a rapid node restart -- if restart is not rapid, much of the data will be stale, only reloading slow-confirming transactions uninteresting to miners.\r\n* Someone restarting their node tends to be an expert-only or dev-only operation; normal field operation - unattended operation or standard user session - will never see this feature.\r\n\r\nmempool restore seems likely to be a little used, expert-only feature.",
      "created_at" : "2016-08-03T19:20:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237343082",
      "id" : 237343082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T21:48:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237343082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "> mempool restore seems likely to be a little used, expert-only feature.\r\n\r\nSomewhat agreed,  and as a regular 'power' user of bitcoind,  I personally already have my own RPC calls equivalent to `dumpmempool` for this.",
      "created_at" : "2016-08-03T21:36:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237382261",
      "id" : 237382261,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T21:36:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237382261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "@jgarzik  This is functionality directly requested by miners, the absence of it creates an operational burden because nodes then end up making small blocks after being restarted.\r\n\r\n>  persisting prio deltas across restarts & crashes\r\n\r\nThis isn't useful without the transactions themselves-- peers will not re-relay transactions they previously sent. So you could save priorities, but all of them would be almost completely useless.\r\n\r\n> users really do not like features that pause shutdown for a long time. \r\n\r\nIndeed, if it takes a long time that is an issue. But this should be writing no more than about 150 MB of data, which should take under a second.  If it's taking a long time then that needs to be addressed.\r\n\r\nOne solution if that is an issue is to simply not write it at shutdown, but to only use the regular snapshots.\r\n\r\n>  and introduce additional I/O stress points for remote attackers to exploit\r\n\r\nI don't follow how remote attackers interact here; it wouldn't make sense to have any of this behavior be remotely triggerable.\r\n\r\n> if restart is not rapid, much of the data will be stale,\r\n\r\nIt takes several hours for a full mempool to lose its utility.\r\n\r\nI suppose it would be reasonable to not even bother trying to load it if it's more than three days old.\r\n\r\nMempool sync is also a bandwidth concern for future mempool sync efforts-- if it's lost on restart, than every quick restart would waste bandwidth.\r\n\r\nSimilarly for block transmission-- latency and bandwidth usage will be adversely effected if mempool is lost on restart. It takes about 12 hours in my tests for a node to recover its compact block reconstruction performance after restart, and it can take several seconds to accept a block due to the empty signature cache.\r\n\r\nThese pressures against restart are an operational burden, because then you're pressured to try to find ways to avoid restarting-- e.g. running extra nodes, or avoiding changing settings.\r\n\r\nSeparately, the cold mempool means that users and developers spend time in a non-representative state after they try changing settings; which makes it much harder to iterate around settings changes.\r\n\r\n( Sorry if some of these points are redundant with #8433 )",
      "created_at" : "2016-08-04T01:32:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237425522",
      "id" : 237425522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T01:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237425522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Concept ACK, and a very useful feature!\r\n\r\nThough I'd suggest making it off by default for now so that nodes that don't need this don't have the risk of a bug creating a restart loop - less risk if we start in a clean state by default.",
      "created_at" : "2016-08-04T02:25:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237434755",
      "id" : 237434755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T02:25:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237434755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "@petertodd With the exception of the priority deltas the transactions are going through normal mempool accept logic.\r\n\r\nI can't see this causing a restart loop unless there's a bug in the priority handling logic or a remotely exploitable DoS issue anyways.",
      "created_at" : "2016-08-04T02:58:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237439295",
      "id" : 237439295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T02:58:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237439295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "> I can't see this causing a restart loop unless there's a bug in the priority handling logic or a remotely exploitable DoS issue anyways.\r\n\r\nWhich may only be trigger-able under particular circumstance,  of which may be captured in the current mempool state?",
      "created_at" : "2016-08-04T03:00:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237439517",
      "id" : 237439517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T03:00:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237439517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "@pstratem Hmm, that's a good point. Also, as long as we're only saving the mempool in a normal, user-triggered, shutdown all transactions in the saved mempool should be fine.\r\n\r\nI'll take back my objection.",
      "created_at" : "2016-08-04T03:12:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237441004",
      "id" : 237441004,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T03:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237441004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "> It seems like unless you are immediately restarting, you'll be wasting a lot of time trying to load already confirmed transactions or low fee spam.\r\n\r\nEloipool does a save/restore state when it restarts, and one thing it does is write a timestamp early on in the dump. This way, when loading from the dump, it can see if the data is irrelevant and ignore the file. Perhaps that would make sense here too?\r\n\r\nAny reason to write out the entire thing every interval, rather than just having another LevelDB database?",
      "created_at" : "2016-08-04T03:13:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237441154",
      "id" : 237441154,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T03:13:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237441154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@gmaxwell Those concerns seem to be met by remote mempool download also, which @morcos suggested elsewhere in the thread -- and indeed was one original purpose of BIP 35 mempool message -- maintaining miner's mempools and not losing lucrative miner fees due to restart.  \r\n\r\nRemote download over LAN is also potentially faster, something Google noticed when seeing increased performance through remote page caches: http://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43886.pdf\r\n\r\nRemote download also gets you fresh transactions which the db/log will not have - fuller blocks, more miners fees.\r\n\r\n>> and introduce additional I/O stress points for remote attackers to exploit\r\n\r\n> I don't follow how remote attackers interact here; it wouldn't make sense to have any of this\r\n> behavior be remotely triggerable.\r\n\r\nThe relevant portion that answers your confusion was elided:  \"Alternatives to dump-on-shutdown [...]\"   This refers to, e.g. periodic dumps, streaming transactions to a leveldb or WAL log, which occur at runtime not shutdown.",
      "created_at" : "2016-08-04T04:03:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237446846",
      "id" : 237446846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T04:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237446846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "> Those concerns seem to be met by remote mempool download also, which @morcos suggested elsewhere in the thread -- and indeed was one original purpose of BIP 35 mempool message -- maintaining miner's mempools and not losing lucrative miner fees due to restart. \r\n\r\nPreservation of the mempool is a prerequisite for mempool sync. Otherwise you'd have 150 MB of transfer (burning resources of remote nodes) each time someone restarts to twiddle some configure. I think the mempool message is unsuitable for synchronization generally, due to overhead.\r\n\r\n[and while the latency concerns related to compact blocks would be addressed by a bulk download, the bandwidth savings would be lost]\r\n\r\n> Remote download over LAN is also potentially faster, something Google \r\n\r\nIn Google datacenters not on our P2P network; in any case I believe the load is bottlenecked on any ordinary host. (and were it faster, it wouldn't matter-- resource usage needs to be heavily weighed).\r\n\r\n>>> and introduce additional I/O stress points for remote attackers to exploit\r\n\r\n>> I don't follow how remote attackers interact here; it wouldn't make sense to have any of this behavior be remotely triggerable.\r\n\r\n> The relevant portion that answers your confusion was elided: \"Alternatives to dump-on-shutdown [...]\" This refers to, e.g. periodic dumps, streaming transactions to a leveldb or WAL log, which occur at runtime not shutdown.\r\n\r\nThere isn't any leveldb involved here; but regardless-- I still don't see where the \"remote attackers\" part that I was asking about comes in.",
      "created_at" : "2016-08-04T04:55:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237452555",
      "id" : 237452555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T04:56:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237452555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Notable how remote mempool load on startup could be increase the effects of a DoS attack due to all the extra bandwidth wasted as nodes restart after crashing; it'd be especially harmful if a remote crash exploit could be found if people ever setup nodes to restart automatically.\n\nOn 3 August 2016 21:56:34 GMT-07:00, Gregory Maxwell <notifications@github.com> wrote:\n>> Those concerns seem to be met by remote mempool download also, which\n>@morcos suggested elsewhere in the thread -- and indeed was one\n>original purpose of BIP 35 mempool message -- maintaining miner's\n>mempools and not losing lucrative miner fees due to restart. \n>\n>Preservation of the mempool is a prerequisite for mempool sync.\n>Otherwise you'd have 150 MB of transfer (burning resources of remote\n>nodes) each time someone restarts to twiddle some configure. I think\n>the mempool message is unsuitable for synchronization generally, due to\n>overhead.\n>\n>> Remote download over LAN is also potentially faster, something Google\n>\n>\n>In Google datacenters not on our P2P network; in any case I believe the\n>load is bottlenecked on any ordinary host. (and were it faster, it\n>wouldn't matter-- resource usage needs to be heavily weighed).\n>\n>>>> and introduce additional I/O stress points for remote attackers to\n>exploit\n>\n>>> I don't follow how remote attackers interact here; it wouldn't make\n>sense to have any of this behavior be remotely triggerable.\n>\n>> The relevant portion that answers your confusion was elided:\n>\"Alternatives to dump-on-shutdown [...]\" This refers to, e.g. periodic\n>dumps, streaming transactions to a leveldb or WAL log, which occur at\n>runtime not shutdown.\n>\n>There isn't any leveldb involved here; but regardless-- I still don't\n>see where the \"remote attackers\" part that I was asking about comes in.\n>\n>---\n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237452555\n",
      "created_at" : "2016-08-04T05:05:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237453698",
      "id" : 237453698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:05:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237453698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "* Make it off by default: seems reasonable; not every node has a requirement to have a well-calibrated mempool immediately at startup. It does help for BIP152 block relay, but many nodes also likely won't restart sufficiently fast to benefit.\r\n* XORing a key: sigh, ok\r\n* Checking how old the mempool is: height won't work, as at the time you restart, you won't have learned about blocks that have been found in the mean time. Using time would work, but meh... loading is fast and in the background\r\n* Using BIP35 instead: inefficient and unpredictable for resources (you don't know the size of a remote mempool, and can't tell them to not send 20 gigabytes worth of txids), and won't work for prioritized transactions. I do think we should explore network-based mempool syncing independently, though.\r\n* Separating dumping priority data and mempool data: the problem is that for prioritized transactions, we need both, and there is no guaranteed way to load these from anywhere else. What about periodically dumping but only for prioritized transactions, and dumping the full mempool at shutdown (when configured).\r\n* Keeping historical record: much more complicated and can better be done in other ways (separate statistics module that persists to disk).",
      "created_at" : "2016-08-04T05:28:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237456221",
      "id" : 237456221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:28:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237456221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Could be off for now-- though sad to lose the BIP152 improvement but as you say I guess most users aren't going up and down that often and I suppose it could be defaulted on after mempool sync. Though I have a little concern that defaulting off would be another point of divergence between what virtually every developer runs and most users run.\r\n\r\n> only for prioritized transactions,\r\n\r\nAnd their unconfirmed parents? meh.",
      "created_at" : "2016-08-04T05:35:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237457091",
      "id" : 237457091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:37:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237457091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Idea: instead of not loading the mempool file when it's too old, just skip loading entries that have expired by the time we load them. That has the same effect, and is a pure optimization.",
      "created_at" : "2016-08-04T05:37:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237457307",
      "id" : 237457307,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:37:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237457307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "sipa: sounds fine to me.",
      "created_at" : "2016-08-04T05:38:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237457358",
      "id" : 237457358,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:38:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237457358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : ">> Remote download over LAN is also potentially faster, something Google\r\n\r\n> In Google datacenters not on our P2P network\r\n\r\nThe P2P network is not a LAN.  It was not suggested that miners download the mempool over a WAN.  The referenced, driving use case is miners who requested this feature, with almost everyone else defaulting this feature 'off'   In that context for that user subset, LAN environments are the norm.\r\n\r\nFurthermore, miners will inevitably want the _fastest_ solution to node restart - thus the doc reference.   Based on current LAN technology and research, all network with no additional disk I/O - either periodic (leveldb/log) or at startup/shutdown - is likely to be the performant solution.\r\n\r\n> There isn't any leveldb involved here\r\n\r\nPlease re-read this thread.   Several alternatives to dump-on-shutdown are discussed.  Specifically, leveldb was suggested as an alternative solution, mostly recently a few comments back by @luke-jr   My comment referenced these alternate solutions.\r\n\r\nThis matches history, where the idea of storing the mempool in leveldb has been suggested many times over the years.  It is a relevant discussion in the current thread context.\r\n\r\n\r\n\r\n",
      "created_at" : "2016-08-04T05:42:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237457855",
      "id" : 237457855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:42:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237457855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "> XORing a key: sigh, ok\r\n\r\nI think this could be done in a follow up PR.\r\n\r\n> [...] Those concerns seem to be met by remote mempool download also, which @morcos suggested elsewhere in the thread -- and indeed was one original purpose of BIP 35 mempool message -- maintaining miner's mempools and not losing lucrative miner fees due to restart.\r\n\r\nIMO BIP35's mempool command is a fingerprinting and DOS attack vector. Its extremely resource hungry (some SPV nodes call the filtered mempool command over and over again).\r\n\r\nAlso, since 0.13, we do disable the `mempool` p2p command when `NODE_BLOOM` is disabled.\r\nSee https://github.com/bitcoin/bitcoin/pull/8078",
      "created_at" : "2016-08-04T05:42:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237457857",
      "id" : 237457857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:42:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237457857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> Furthermore, miners will inevitably want the fastest solution to node restart\r\n\r\nThis PR does not slow down startup. The mempool file is loaded in the background, while the node is already running. Dumping takes a second on my VPS with pretty slow I/O.",
      "created_at" : "2016-08-04T05:44:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237458166",
      "id" : 237458166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T05:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237458166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> Idea: instead of not loading the mempool file when it's too old, just skip loading entries that have expired by the time we load them. That has the same effect, and is a pure optimization.\r\n\r\nAssuming that skipping entries is extremely cheap, I no longer see a benefit in turning the feature off by default.",
      "created_at" : "2016-08-04T09:30:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237502096",
      "id" : 237502096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T09:30:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237502096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "The benefit of turning it off by default is still slightly faster shutdown\n(~1s in my own benchmarks on a slow system with large mempool), and lower\ndisk usage (150 Mbyte by default is not much, but may matter for a pruning\nnode).\n",
      "created_at" : "2016-08-04T09:34:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237502972",
      "id" : 237502972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T09:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237502972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73550951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73550951"
         }
      },
      "body" : "Seems to require holding `cs_main`.\r\n`AcceptToMemoryPoolWorker` has a `AssertLockHeld(cs_main);`",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-04T15:59:30Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        return error(\"Failed to open mempool file from disk\");\n+    }\n+\n+    int64_t count = 0;\n+\n+    try {\n+        uint64_t version;\n+        file >> version;\n+        if (version != 1) {\n+            return false;\n+        }\n+        uint64_t num;\n+        file >> num;\n+        double prioritydummy = 0;\n+        while (num--) {\n+            CTransaction tx;\n+            int64_t nTime;\n+            int64_t nFeeDelta;\n+            file >> tx;\n+            file >> nTime;\n+            file >> nFeeDelta;\n+\n+            CAmount amountdelta = nFeeDelta;\n+            if (amountdelta) {\n+                mempool.PrioritiseTransaction(tx.GetHash(), tx.GetHash().ToString(), prioritydummy, amountdelta);\n+            }\n+            CValidationState state;\n+            AcceptToMemoryPool(mempool, state, tx, true, NULL, nTime, 0, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73550951",
      "id" : 73550951,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 111,
      "path" : "src/main.cpp",
      "position" : 111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-04T15:59:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73550951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I feel very strongly this feature must be on by default. Not only is it extremely useful with practically no cost; it will have an impact in reducing overall p2p bandwidth consumption. There are a few hundred of nodes that regularly power on and off throughout the day. You could make the flush interval configurable but I don't think that is necessary.",
      "created_at" : "2016-08-04T18:26:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237640559",
      "id" : 237640559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-04T18:26:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237640559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   }
]
