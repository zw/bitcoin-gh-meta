[
   {
      "body" : "Could you also add the line where the assertion failed (from the python\ntraceback, which should be in the stderr)\n\nOn Fri, Jul 29, 2016 at 10:23 AM, Wladimir J. van der Laan <\nnotifications@github.com> wrote:\n\n> I had this problem once while I was running the walletbackup.py test on\n> 0.13:\n>\n> walletbackup.py:\n> Initializing test directory /tmp/testo3khmc00/37\n> INFO: Generating initial blockchain\n> Assertion failed: 76.69962300 != 50\n> Stopping nodes\n> Not cleaning up dir /tmp/testo3khmc00/37\n> Failed\n>\n> I'm unfortunately unable to reproduce it again, looks like a race\n> condition.\n>\n> Ã¢ÂÂ\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/issues/8425>, or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AGGmv60NSH-svLHtS9wi2s23c_U3ZQlBks5qabiRgaJpZM4JX-fm>\n> .\n>\n",
      "created_at" : "2016-07-29T08:51:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8425#issuecomment-236128606",
      "id" : 236128606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8425",
      "updated_at" : "2016-07-29T08:51:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236128606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@MarcoFalke done",
      "created_at" : "2016-07-29T08:57:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8425#issuecomment-236129647",
      "id" : 236129647,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8425",
      "updated_at" : "2016-07-29T08:57:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236129647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I've also seen walletbackup.py fail, but it's a different error.\r\n```\r\n...Traceback (most recent call last):\r\n  File \"qa/pull-tester/rpc-tests.py\", line 342, in <module>\r\n    runtests()\r\n  File \"qa/pull-tester/rpc-tests.py\", line 211, in runtests\r\n    (name, stdout, stderr, passed, duration) = job_queue.get_next()\r\n  File \"qa/pull-tester/rpc-tests.py\", line 266, in get_next\r\n    (stdout, stderr) = proc.communicate(timeout=3)\r\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py\", line 1072, in communicate\r\n    stdout, stderr = self._communicate(input, endtime, timeout)\r\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py\", line 1716, in _communicate\r\n    self._check_timeout(endtime, orig_timeout)\r\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py\", line 1098, in _check_timeout\r\n    raise TimeoutExpired(self.args, orig_timeout)\r\nsubprocess.TimeoutExpired: Command '['/Users/xxx/github/bitcoin/qa/rpc-tests/walletbackup.py', '--srcdir=/Users/xxx/github/bitcoin/src', '--portseed=39']' timed out after 3 seconds\r\n```\r\n```\r\nTraceback (most recent call last):\r\n  File \"qa/pull-tester/rpc-tests.py\", line 342, in <module>\r\n    runtests()\r\n  File \"qa/pull-tester/rpc-tests.py\", line 211, in runtests\r\n    (name, stdout, stderr, passed, duration) = job_queue.get_next()\r\n  File \"qa/pull-tester/rpc-tests.py\", line 266, in get_next\r\n    (stdout, stderr) = proc.communicate(timeout=3)\r\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py\", line 1072, in communicate\r\n    stdout, stderr = self._communicate(input, endtime, timeout)\r\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py\", line 1716, in _communicate\r\n    self._check_timeout(endtime, orig_timeout)\r\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py\", line 1098, in _check_timeout\r\n    raise TimeoutExpired(self.args, orig_timeout)\r\nsubprocess.TimeoutExpired: Command '['/Users/xxx/github/bitcoin/qa/rpc-tests/wallet-dump.py', '--srcdir=/Users/xxx/github/bitcoin/src', '--portseed=35']' timed out after 3 seconds\r\n```",
      "created_at" : "2016-08-01T02:09:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8425#issuecomment-236474246",
      "id" : 236474246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8425",
      "updated_at" : "2016-08-01T02:09:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236474246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "```\r\nwalletbackup.py:\r\nInitializing test directory /var/folders/rb/jqqd25w926s5429rf58_zsv00000gn/T/test34w8is11/39\r\nUnexpected exception caught during testing: Exception('bitcoind exited with status -6 during initialization',)\r\nStopping nodes\r\n\r\nstderr:\r\n Error: Unable to start HTTP server. See debug log for details.\r\nAssertion failed: (nThreadsServicingQueue == 0), function ~CScheduler, file scheduler.cpp, line 19.\r\nError: Unable to start HTTP server. See debug log for details.\r\n  File \"/Users/xxx/Github/bitcoin/qa/rpc-tests/test_framework/test_framework.py\", line 146, in main\r\n    self.setup_network()\r\n  File \"/Users/xxx/github/bitcoin/qa/rpc-tests/walletbackup.py\", line 53, in setup_network\r\n    self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, extra_args)\r\n  File \"/Users/xxx/Github/bitcoin/qa/rpc-tests/test_framework/util.py\", line 340, in start_nodes\r\n    rpcs.append(start_node(i, dirname, extra_args[i], rpchost, binary=binary[i]))\r\n  File \"/Users/xxx/Github/bitcoin/qa/rpc-tests/test_framework/util.py\", line 321, in start_node\r\n    wait_for_bitcoind_start(bitcoind_processes[i], url, i)\r\n  File \"/Users/xxx/Github/bitcoin/qa/rpc-tests/test_framework/util.py\", line 191, in wait_for_bitcoind_start\r\n    raise Exception('bitcoind exited with status %i during initialization' % process.returncode)\r\nTraceback (most recent call last):\r\n  File \"/Users/xxx/github/bitcoin/qa/rpc-tests/walletbackup.py\", line 201, in <module>\r\n    WalletBackupTest().main()\r\n  File \"/Users/xxx/Github/bitcoin/qa/rpc-tests/test_framework/test_framework.py\", line 169, in main\r\n    stop_nodes(self.nodes)\r\n  File \"/Users/xxx/Github/bitcoin/qa/rpc-tests/test_framework/util.py\", line 358, in stop_nodes\r\n    for node in nodes:\r\nTypeError: 'NoneType' object is not iterable\r\n\r\nPass: False, Duration: 11 s\r\n```",
      "created_at" : "2016-08-01T02:14:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8425#issuecomment-236474724",
      "id" : 236474724,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8425",
      "updated_at" : "2016-08-01T02:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236474724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "I'm seeing this pretty frequently, seems to be part of why https://github.com/bitcoin/bitcoin/pull/8464 is failing.",
      "created_at" : "2016-08-07T18:16:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8425#issuecomment-238098597",
      "id" : 238098597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8425",
      "updated_at" : "2016-08-07T18:16:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238098597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "I think you're right it is a race condition. To test the hypothesis, we can try running with a lot of workers, which should hopefully increase the probability of failure.\r\n\r\nRunning `./rpc_tests.py -parallel=40` on master gives me:\r\n```\r\nTEST                           | PASSED | DURATION\r\n\r\np2p-fullblocktest.py           | True   | 174 s\r\nwalletbackup.py                | False  | 9 s\r\nbip68-112-113-p2p.py           | True   | 34 s\r\nwallet.py                      | False  | 1 s\r\nwallet-hd.py                   | False  | 33 s\r\nwallet-dump.py                 | True   | 7 s\r\nlisttransactions.py            | True   | 38 s\r\nreceivedby.py                  | True   | 18 s\r\nmempool_resurrect_test.py      | True   | 1 s\r\ntxn_doublespend.py --mineblock | True   | 4 s\r\ntxn_clone.py                   | True   | 3 s\r\ngetchaintips.py                | True   | 10 s\r\nrawtransactions.py             | False  | 15 s\r\nrest.py                        | False  | 62 s\r\nmempool_spendcoinbase.py       | True   | 1 s\r\nmempool_reorg.py               | True   | 6 s\r\nmempool_limit.py               | False  | 4 s\r\nhttpbasics.py                  | True   | 1 s\r\nmulti_rpc.py                   | True   | 3 s\r\nzapwallettxes.py               | False  | 13 s\r\nproxy_test.py                  | True   | 2 s\r\nmerkle_blocks.py               | False  | 5 s\r\nfundrawtransaction.py          | False  | 23 s\r\nsignrawtransactions.py         | True   | 2 s\r\nnodehandling.py                | True   | 14 s\r\nreindex.py                     | True   | 12 s\r\ndecodescript.py                | True   | 0 s\r\nblockchain.py                  | False  | 1 s\r\ndisablewallet.py               | True   | 3 s\r\nsendheaders.py                 | True   | 29 s\r\nkeypool.py                     | True   | 5 s\r\nprioritise_transaction.py      | False  | 4 s\r\ninvalidblockrequest.py         | True   | 5 s\r\ninvalidtxrequest.py            | True   | 4 s\r\nabandonconflict.py             | False  | 14 s\r\np2p-versionbits-warning.py     | False  | 7 s\r\np2p-segwit.py                  | False  | 10 s\r\nsegwit.py                      | False  | 4 s\r\nimportprunedfunds.py           | False  | 3 s\r\nsignmessages.py                | True   | 2 s\r\np2p-compactblocks.py           | False  | 13 s\r\nzmq_test.py                    | False  | 0 s\r\n\r\nALL                            | False  | 599 s (accumulated)\r\n```\r\n\r\nEach one of these failures logs an `Error: Unable to start HTTP server. See debug log for details.`.\r\n\r\n\r\nThis supports the hypothesis that it's a race condition.\r\n\r\nWhen I ran with `-parallel=1` on my branch, I still observed a (`Error: Unable to start HTTP server. See debug log for details.`) on rawtransaction (see https://github.com/bitcoin/bitcoin/pull/8464).\r\nSo this means that it's likely not a race condition in the main test code (which should run in serial as per @MarcoFalke's suggestion), but perhaps in some cleanup code which locks the bitcoind starting.\r\n\r\nHope that helps track this down, still not sure exactly where it is.",
      "created_at" : "2016-08-08T02:17:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8425#issuecomment-238127542",
      "id" : 238127542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8425",
      "updated_at" : "2016-08-08T02:17:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238127542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   }
]
