{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "bitcoind is crashing on startup\r\n\r\n**Expected behavior**\r\n\r\nIt worked fine on this same hardware for years\r\n\r\n**Actual behavior**\r\n```\r\n2019-09-18T12:43:58Z LevelDB using max_open_files=1000 (default=1000)\r\n2019-09-18T12:43:58Z Opening LevelDB in /home/bitcoin/.bitcoin/blocks/index\r\n2019-09-18T12:43:58Z leveldb: Recovering log #1159\r\n2019-09-18T12:44:00Z leveldb: Delete type=0 #1159\r\n2019-09-18T12:44:00Z leveldb: Delete type=3 #1158\r\n2019-09-18T12:44:00Z Opened LevelDB successfully\r\n2019-09-18T12:44:00Z Using obfuscation key for /home/bitcoin/.bitcoin/blocks/index: 0000000000000000\r\nBus error (core dumped)\r\n```\r\n\r\n**System information**\r\n\r\nself-compiled from this github repo from b3067f4338d901394fb0237567cb5e19ccee5f8a\r\n\r\n2019-09-18T02:44:13Z Bitcoin Core version v0.18.99.0-b3067f4 (release build)\r\n\r\nLinux 4.15.0-42-generic #45~16.04.1+8.0trisquel3 SMP Tue Dec 4 11:28:55 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nI have bitcoind and the data on BTRFS mirrored across two drives. BTFS Scrub found errors yet all were correctable. When re-running BTRFS scrub 0 errors are reported.\r\n\r\n```\r\ngdb bitcoind\r\n...\r\nReading symbols from bitcoind...done.\r\n(gdb) r\r\nStarting program: /mnt/btrfs/bitcoin/bin/bin/bitcoind\r\n[Thread debugging using libthread_db enabled]\r\n...\r\n2019-09-18T03:28:55Z Opened LevelDB successfully\r\n2019-09-18T12:43:58Z Opening LevelDB in /home/bitcoin/.bitcoin/blocks/index\r\n2019-09-18T12:43:58Z leveldb: Recovering log #1159\r\n2019-09-18T12:44:00Z leveldb: Delete type=0 #1159\r\n2019-09-18T12:44:00Z leveldb: Delete type=3 #1158\r\n\r\n2019-09-18T03:28:55Z Using obfuscation key for /home/bitcoin/.bitcoin/blocks/index: 0000000000000000\r\n\r\nThread 1 \"bitcoin-init\" received signal SIGBUS, Bus error.\r\nleveldb::ReadBlock (file=0x55555dadb740, options=..., handle=..., result=result@entry=0x7fffffffa100) at leveldb/table/format.cc:91\r\n91          const uint32_t crc = crc32c::Unmask(DecodeFixed32(data + n + 1));\r\n\r\n(gdb) bt\r\n#0  leveldb::crc32c::Unmask (masked_crc=<optimized out>) at ./leveldb/util/crc32c.h:39\r\n#1  leveldb::ReadBlock (file=0x55555dadb740, options=..., handle=..., result=result@entry=0x7fffffffa100) at leveldb/table/format.cc:91\r\n#2  0x000055555590854c in leveldb::Table::BlockReader (arg=0x55555a0ef0d0, options=..., index_value=...) at leveldb/table/table.cc:189\r\n#3  0x000055555590b2c6 in leveldb::(anonymous namespace)::TwoLevelIterator::InitDataBlock (this=this@entry=0x55555dadb930)\r\n    at leveldb/table/two_level_iterator.cc:165\r\n#4  0x000055555590b370 in leveldb::(anonymous namespace)::TwoLevelIterator::SkipEmptyDataBlocksForward (this=0x55555dadb930)\r\n    at leveldb/table/two_level_iterator.cc:133\r\n#5  0x000055555590b545 in leveldb::IteratorWrapper::Next (this=0x555555e15b30) at ./leveldb/table/iterator_wrapper.h:45\r\n#6  leveldb::(anonymous namespace)::TwoLevelIterator::Next (this=0x555555e15ac0) at leveldb/table/two_level_iterator.cc:114\r\n#7  0x0000555555905d47 in leveldb::IteratorWrapper::Next (this=<optimized out>) at ./leveldb/table/iterator_wrapper.h:45\r\n#8  leveldb::(anonymous namespace)::MergingIterator::Next (this=0x555555e15b80) at leveldb/table/merger.cc:81\r\n#9  0x00005555558f2540 in leveldb::(anonymous namespace)::DBIter::FindNextUserEntry (this=0x555555e15c70, skipping=true, skip=0x555555e15cc0)\r\n    at leveldb/db/db_iter.cc:199\r\n#10 0x00005555556dc32b in CBlockTreeDB::LoadBlockIndexGuts(Consensus::Params const&, std::function<CBlockIndex* (uint256 const&)>) (this=<optimized out>,\r\n    consensusParams=..., insertBlockIndex=...) at txdb.cpp:280\r\n#11 0x000055555572f3ee in BlockManager::LoadBlockIndex (this=this@entry=0x555555c77ee0 <(anonymous namespace)::g_blockman>, consensus_params=...,\r\n    blocktree=..., block_index_candidates=std::set with 0 elements) at validation.cpp:3820\r\n#12 0x000055555572fa71 in LoadBlockIndexDB (chainparams=...) at validation.cpp:3883\r\n#13 0x0000555555730445 in LoadBlockIndex (chainparams=...) at validation.cpp:4344\r\n#14 0x00005555555a6ca9 in AppInitMain (interfaces=...) at init.cpp:1497\r\n#15 0x000055555558c1e9 in AppInit (argc=<optimized out>, argv=<optimized out>) at bitcoind.cpp:164\r\n#16 0x000055555558436f in main (argc=1, argv=0x7fffffffe648) at bitcoind.cpp:194\r\n````\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16904/comments",
   "created_at" : "2019-09-18T12:47:56Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16904/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/16904",
   "id" : 495204138,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "770000",
         "default" : false,
         "id" : 234878,
         "name" : "Linux/Unix",
         "node_id" : "MDU6TGFiZWwyMzQ4Nzg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Linux/Unix"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16904/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU0OTUyMDQxMzg=",
   "number" : 16904,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Bus error (core dumped) after \"Using obfuscation key for\" log line",
   "updated_at" : "2019-09-18T14:10:44Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16904",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/64738?v=4",
      "events_url" : "https://api.github.com/users/alevchuk/events{/privacy}",
      "followers_url" : "https://api.github.com/users/alevchuk/followers",
      "following_url" : "https://api.github.com/users/alevchuk/following{/other_user}",
      "gists_url" : "https://api.github.com/users/alevchuk/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/alevchuk",
      "id" : 64738,
      "login" : "alevchuk",
      "node_id" : "MDQ6VXNlcjY0NzM4",
      "organizations_url" : "https://api.github.com/users/alevchuk/orgs",
      "received_events_url" : "https://api.github.com/users/alevchuk/received_events",
      "repos_url" : "https://api.github.com/users/alevchuk/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/alevchuk/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/alevchuk/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/alevchuk"
   }
}
