[
   {
      "author_association" : "MEMBER",
      "body" : "I think this is wrong, localhost is not special here.",
      "created_at" : "2019-09-23T13:58:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16940#issuecomment-534111250",
      "id" : 534111250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16940",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDExMTI1MA==",
      "updated_at" : "2019-09-23T13:58:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534111250",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16901](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16901.html) (test: Add markdownlint rules by ch4ot1c)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-09-23T16:23:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16940#issuecomment-534175145",
      "id" : 534175145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16940",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDE3NTE0NQ==",
      "updated_at" : "2019-09-23T16:23:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534175145",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for the prompt feedback. I realize my pull request may be lacking some background information, which I'll correct here after.\r\n\r\n# Details\r\nThe present documentation mentions that the `onion` option doesn't need to be setup (to set the proxy server to use for Tor hidden services) if its `ip:port` is equal to the one set in `proxy`.\r\nThat considered, I did originally setup torrc and bitcoin.conf as follows. Note that both service are running in their own docker container, within the same user-defined docker network.\r\n\r\n#### torrc\r\n```\r\nRunAsDaemon 0\r\nSocksPort 192.168.247.2:9050\r\nControlPort 192.168.247.2:9051\r\nHashedControlPassword 16:HASHEDBLABLA...\r\nBridgeRelay 1\r\nLog notice file /var/log/tor/log\r\nServerTransportPlugin obfs4 exec /usr/bin/obfs4proxy\r\nExtORPort auto\r\nORPort 54321\r\nServerTransportListenAddr obfs4 0.0.0.0:45321\r\n```\r\n\r\n#### bitcoin.conf\r\n```\r\nproxy=192.168.247.2:9050\r\ntxindex=1\r\ndisablewallet=1\r\nprinttoconsole=1\r\nrpcuser=user\r\nrpcpassword=password\r\nrpcbind=192.168.247.3\r\nserver=1\r\nlisten=1\r\ntorcontrol=192.168.247.2:9051\r\ntorpassword=blabla\r\n```\r\n\r\n# What I get\r\n\r\nbitcoind tries to connect to the tor hidden service proxy at 127.0.0.1:9050 (for the record, it is 127.0.0.1 that I did \"translate\" to localhost).  \r\nSee relevant log here after.\r\n\r\n\r\ndate | stream | content\r\n-- | -- | --\r\n2019-09-23 12:03:54\t| stdout |\t2019-09-23T12:03:54Z connect() to 127.0.0.1:9050 failed after select(): Connection refused (111)\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z AddLocal(xyz.onion:8333,4)\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: Cached service private key to /bitcoin/.bitcoin/onion_private_key\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: Got service ID xyz, advertising service xyz.onion:8333\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: ADD_ONION successful\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: Authentication successful\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: Using HASHEDPASSWORD authentication\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: Supported authentication method: HASHEDPASSWORD\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: Connected to Tor version 0.3.5.8\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z tor: Successfully connected!\r\n2019-09-23 12:03:53\t| stdout |\t2019-09-23T12:03:53Z torcontrol thread start\r\n\r\n# What I expect\r\n\r\nFollowing `onion` option description, I expect bitcoind to connect to the very same `ip:host` set in `proxy`, i.e. `192.168.247.2:9050` in the above example.\r\n\r\n# Fix\r\n\r\nAdding `onion=192.168.247.2:9050` to `bitcoin.conf` does resolve the issue and result in the very same log *without* the following error line.\r\n\r\n`connect() to 127.0.0.1:9050 failed after select(): Connection refused (111)`\r\n\r\n\r\n# Conclusion\r\n\r\n\r\nObviously, it is not working as described. And so either the description isn't correct - which my little contribution should fix, either the implementation should be corrected to reflect wanted behaviour.\r\n\r\n\r\nI hope this clarifies the reason of my pull request.\r\nLooking forward at your comments.\r\n",
      "created_at" : "2019-09-23T20:32:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16940#issuecomment-534272324",
      "id" : 534272324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16940",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDI3MjMyNA==",
      "updated_at" : "2019-09-23T20:32:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534272324",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6266997?v=4",
         "events_url" : "https://api.github.com/users/roshii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/roshii/followers",
         "following_url" : "https://api.github.com/users/roshii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/roshii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/roshii",
         "id" : 6266997,
         "login" : "roshii",
         "node_id" : "MDQ6VXNlcjYyNjY5OTc=",
         "organizations_url" : "https://api.github.com/users/roshii/orgs",
         "received_events_url" : "https://api.github.com/users/roshii/received_events",
         "repos_url" : "https://api.github.com/users/roshii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/roshii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/roshii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/roshii"
      }
   }
]
