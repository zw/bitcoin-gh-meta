{
   "assignee" : null,
   "body" : "**Problem:** When running in testnet, a node can get stuck in IsInitialBlockDownload mode which will prevent it from responding to any GETHEADERS requests. This can make testing difficult! This problem does not happen on mainnet.\r\n\r\n**Theory:** Testnet is a little wonky with the 20-minute difficulty reset condition. The nChainWork calculation can cause pindexBestHeader to be set with an old block that has more work than chainActive.Tip(). If that block is more than nMaxTipAge old, IsInitialBlockDownload will always return true.\r\n\r\n**Suggested solution:** The current code works fine for mainnet, so I added a check to see if we are using testnet, and if so use chainActive.Tip() instead of pindexBestHeader when checking to see how far along we are with the block download. It's my thought that if the current tip is less than one day old (the nMaxTipAge default), it's probably safe to release IsInitialBlockDownload regardless of the age of pindexBestHeader.\r\n\r\n_[Edit: As per the comments below, I removed the check for testnet and instead used the greater of chainActive or BestHeader.]_",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 16,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7514/comments",
   "created_at" : "2016-02-11T09:07:23Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7514/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/7514",
   "id" : 132921890,
   "labels" : [
      {
         "color" : "006b75",
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7514/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 7514,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/7514.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7514",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/7514.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7514"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[WIP] Fix IsInitialBlockDownload for testnet",
   "updated_at" : "2016-03-11T00:14:21Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7514",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/5316685?v=3",
      "events_url" : "https://api.github.com/users/jmacwhyte/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jmacwhyte/followers",
      "following_url" : "https://api.github.com/users/jmacwhyte/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jmacwhyte/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jmacwhyte",
      "id" : 5316685,
      "login" : "jmacwhyte",
      "organizations_url" : "https://api.github.com/users/jmacwhyte/orgs",
      "received_events_url" : "https://api.github.com/users/jmacwhyte/received_events",
      "repos_url" : "https://api.github.com/users/jmacwhyte/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jmacwhyte/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jmacwhyte/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jmacwhyte"
   }
}
