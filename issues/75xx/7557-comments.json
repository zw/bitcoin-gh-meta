[
   {
      "body" : "This fails Travis because `checkdoc.py` doesn't recognize the way I'm adding the help messages now.  I used @jtimon's code that builds a vector of string pairs.  I'll wait for some direction on whether that is a refactor thats wanted and we need to change the check script or whether I should just hack in the help messages the old fashioned way.\r\n\r\nAs a side note, it wasn't clear to me how to easily find what had failed Travis.\r\n",
      "created_at" : "2016-02-18T19:49:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7557#issuecomment-185887938",
      "id" : 185887938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7557",
      "updated_at" : "2016-02-18T19:49:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/185887938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos I am sorry for the inconvenience and I am happy to fix the travis issue after you explain why the `AppendMessagesOpt()` wrapper is useful here.\r\n\r\n(It should be easier to identify the travis issue after #7455)",
      "created_at" : "2016-02-26T10:02:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7557#issuecomment-189201796",
      "id" : 189201796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7557",
      "updated_at" : "2016-02-26T10:02:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189201796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@MarcoFalke I don't have a strong opinion on `AppendMessagesOpt`.  I do really like moving some of the policy configuration out of main and into policy code.  I think there could be a lot of other command line options moved afterwards if we like this idea.  I tried to follow the style @jtimon had used since he seems to be most involved in refactoring work.  I'm happy to rewrite that part of this pull to be whatever is most preferred.\r\n",
      "created_at" : "2016-02-26T16:29:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7557#issuecomment-189358338",
      "id" : 189358338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7557",
      "updated_at" : "2016-02-26T16:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189358338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Would you consider using https://github.com/jtimon/bitcoin/commit/6de4f556884a4e362b20baae165271ce8ce7893f ?\r\n\r\nAlthought this has many similarities with #6423 and some with https://github.com/jtimon/bitcoin/commits/policy-minrelayfee-0.12.99 , I'm having a hard time undesrtanding the differences.\r\n\r\nThe reason for InitFromArgs and AppendMessagesOpt (apart from code encapsulation) is a feature that @luke-jr requested in #6068, #5595 or some other of the multiple failed attempts at creating a policy class, and it is exlained on the widely-ignored #6423:\r\n\r\n\"Also (although I'm not going to continue that GUI part), making policy options GUI-configurable (and hopefully, in the future all new existing and new options \"for free\") would be very nice too.\r\nThe way I've understood this from @luke-jr, with Policy::AppendHelpMessages() and CPolicy::InitFromArgs() it is relatively easy to create a generic GUI that doesn't require any more work outside those methods to introduce new policy attributes.\"\r\n\r\nSince here the methods are modified to not allow such feature, it is indeed somewhat surprising that the methods have been maintained very similar nonetheless.\r\n\r\nOther things I don't understand are the elimination of the CPolicy abstract class from #6068 (I thought the whole point of encapsulating the policy code under an interface was to make it easier for people to maintain multiple implementations of that interface in parallel), and the rename to MempoolPolicy.\r\n\r\nYou say\r\n> It wasn't clear to me if those should all go together.\r\n\r\nWhat do you have in mind instead? Is there any longer branch using this that I can see so that I can see \"the big picture\" of how you intent to use this in the future?\r\nIf #6423 was rebased, reviewed and merged before this PR, what would be the relationship between MempoolPolicy and CPolicy? Is the goal to have 2 different interfaces for policy, or that MempoolPolicy simply extends the implementation CStandardPolicy (I meant to rename that to CDefaultPolicy)?\r\n\r\nWhat will be the relationship between MempoolPolicy, CBlockPolicyEstimator and CTxMemPool ?\r\n\r\n\r\n\r\n",
      "created_at" : "2016-02-26T17:49:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7557#issuecomment-189390444",
      "id" : 189390444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7557",
      "updated_at" : "2016-02-26T17:49:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189390444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon I need to do some work around minRelayTxFee because it is broken now in CTxMemPool (supposed to respect the command line option but is hard coded) and I was having same problem in the fee filter code.  So I'd like to get something merged to do this policy encapsulation so we can fix that properly and probably add a second variable for the incremental relay rate.\r\n\r\nI have no strong opinions about the way to do this encapsulation. I spent a little bit of time looking for updated versions of your encapsulation code and wasn't sure where your latest thinking was. The reason I broke off mempool policy separately is I thought it was smaller, touched less thnigs and might be easier to get merged.  I'm more than happy to follow your lead if you want to do this differently.\r\n\r\nEdit: To answer your last question I was assuming both CTxMemPool and CBlockPolicyEstimator would depend on MempoolPolicy which would not depend on either of them.\r\n\r\n",
      "created_at" : "2016-02-26T18:13:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7557#issuecomment-189404904",
      "id" : 189404904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7557",
      "updated_at" : "2016-02-26T18:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189404904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "> The reason I broke off mempool policy separately...\r\n\r\nAnother option would be to start CPolicy and CDefaultPolicy like in #6423 , but just with the GetMinRelayFeeRate() method instead of ApproveTx [ from IsStandardTx ] and ApproveTxInputs [from  AreInputsStandard ]. And doing it in policy/policy, no need to have two separate files and classes.\r\n\r\nI'm assuming this minRelayFee will remain static for use in CDefaultPolicy::ApproveTx() and dust checks (/me remembers #5114, https://github.com/jtimon/bitcoin/commit/dc1b96d368d471ea5242ca021148f9f900f69661 , https://github.com/jtimon/bitcoin/commit/5f519c281c353b0bba8ed06421bf4b5b39b5ebbb and a long, etc, and sighs...).\r\n\r\nIf it's something planned to be dynamic I believe the estimator would be a better place.\r\n\r\nI would also maintain the previously mentioned feature of making it easy for the GUI layer to dynamically create forms to configure all the policy options. I assume you removed the parameter in InitFromArgs() because you didn't knew what was about.\r\n\r\n> To answer your last question I was assuming both CTxMemPool and CBlockPolicyEstimator would depend on MempoolPolicy which would not depend on either of them.\r\n\r\nIIRC you previously wanted the policy to depend on CTxMemPool. Great, this is much closer to what I want.\r\nIt is important to make clear that this is completely a choice, nothing strictly needs to depend on anything else.\r\n\r\nMy ideal choice would be:\r\n\r\nMy preference is that CDefaultPolicy extends CBlockPolicyEstimator (see https://github.com/jtimon/bitcoin/commit/f64df9fcb210f43302c0d1242bf2fa221a77bd32 ), that is between the 2 they fully implement the CPolicy interface, but CBlockPolicyEstimator is, in principle, an abstract class as it doesn't implement all the pure virtual methods in CPolicy.\r\n\r\nNeither CBlockPolicyEstimator nor CDefaultPolicy would depend on CTxMempool, but CTxMempool would initially depend on the CPolicy interface.\r\n\r\nThen decouple  CTxMempool from CPolicy (see #7145 ).\r\n\r\nThat way implementors of alternatives to CDefaultPolicy don't need to know or touch CTxMempool's internals to implement their own policies.\r\nIf I remember correctly, you were very skeptical of this even being possible or being compatible with clean, readable and extensible code, but that's what I'll do for Bitcoin JT (taking things from https://github.com/jtimon/bitcoin/commits/policy-tip-0.12.99 #7145 and https://github.com/jtimon/bitcoin/commits/policy-minrelayfee-0.12.99 which are the least-outdated most-complete branches I have on policy) anyway.\r\n\r\nWe really don't need to decide that now, my fear was that you wanted to separate  MempoolPolicy from CPolicy and CDefaultPolicy because you knew I didn't want CDefaultPolicy to depend on CTxMemPool, but maybe I was ok with a separate MempoolPolicy depending on CTxMemPool.\r\nI prefer a single policy interface which takes CTxMemPool as a param to some of its methods (as said this is not necessary and I don't like it), than 2 separated policy interfaces, even if one of them is fully decoupled from CTxMemPool.\r\nAnyway, that question has been answered.\r\nSummary of nits.\r\n\r\n- Maintain param in InitFromArgs()\r\n- Consider using https://github.com/jtimon/bitcoin/commit/6de4f556884a4e362b20baae165271ce8ce7893f\r\n- Use CPolicy and CDefaultPolicy instead of MempoolPolicy and do it in policy/policy.o and policy/interface.h like in #6068\r\n- There's no need for setters beyond InitFromArgs(). CPolicy should be passed as a const ref to most functions that need it anyway (analogous to ```const CChainParams& chainparams```).\r\n ",
      "created_at" : "2016-02-26T20:54:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7557#issuecomment-189479930",
      "id" : 189479930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7557",
      "updated_at" : "2016-02-26T20:54:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189479930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
