[
   {
      "body" : "Looks good to me... utACK.",
      "created_at" : "2016-02-22T20:50:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-187377293",
      "id" : 187377293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-02-22T20:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/187377293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=3",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "body" : "Does this need a bump to get travis to check it @jonasschnelli ?",
      "created_at" : "2016-02-24T03:40:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-188047847",
      "id" : 188047847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-02-24T03:40:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/188047847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=3",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "body" : "Force pushed (no changes), this should give Travis a kick.",
      "created_at" : "2016-02-24T06:49:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-188107601",
      "id" : 188107601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-02-24T06:49:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/188107601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Concept ACK, this is a nice step toward factoring out the wallet code (as well as a step towards being able to load multiple wallets).\r\n \r\nI do think the return condition is a bit messy, e.g. using both a NULL return value as well as a non-empty errorString as an error condition:\r\n```patch\r\n +        if (!pwalletMain)\r\n +            return false;\r\n...\r\n +        if (!errorString.empty())\r\n +            return InitError(errorString);\r\n```\r\nIdeally, InitLoadWallet would always return NULL if an error happened, and always fill errorString.\r\nI understand that this is a change with more impact, though: e.g. make `walletInstance` a scoped pointer, which is released only on success.\r\n",
      "created_at" : "2016-03-01T15:39:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-190775473",
      "id" : 190775473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-01T15:47:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/190775473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "From the initial work I've done on updating some of Jonas's other wallet patches, this is familiar and I agree it can be confusing, especially in some of the more complicated changes where wallet code calls some other wallet code with its own error handling. The intention is to end up with at least one (and preferably only one) error message in the log if something goes wrong. Worst case scenario if we screw up is that the program just shuts down without an error being reported.",
      "created_at" : "2016-03-01T21:24:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-190911699",
      "id" : 190911699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-01T21:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/190911699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=3",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "body" : "Agree with @laanwj. I wanted to keep the changes at a minimum because this is not the first try to get this into master.\r\n\r\nWill adapt a better return code handling.",
      "created_at" : "2016-03-05T18:33:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-192704088",
      "id" : 192704088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-05T18:33:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192704088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Sweet, utACK 32ffefc12ba5a5956d64a7c207f0070a11041339. Sorry, no dev machine at present so can't test...",
      "created_at" : "2016-03-05T23:02:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-192756511",
      "id" : 192756511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-05T23:02:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192756511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=3",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "body" : "> Agree with @laanwj. I wanted to keep the changes at a minimum because this is not the first try to get this into master.\r\n\r\nYes, changing this may be too risky right now, at least this is straightforward and easy to review.\r\n\r\nutACK",
      "created_at" : "2016-03-06T20:32:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-192983561",
      "id" : 192983561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-06T20:32:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192983561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Needs rebase after #7576",
      "created_at" : "2016-03-11T07:41:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-195235979",
      "id" : 195235979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-11T07:41:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/195235979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Rebased.",
      "created_at" : "2016-03-11T13:41:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-195365945",
      "id" : 195365945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-11T13:41:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/195365945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55940542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55940542"
         }
      },
      "body" : "Nit: Please don't mix concatenations (`+=`)and assignments (`=`). You refactored this such that there can only be one error in the `errorString`, so an assignment would be sufficient.",
      "commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "created_at" : "2016-03-13T17:32:09Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55940542",
      "id" : 55940542,
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_position" : 33,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "updated_at" : "2016-03-13T17:32:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55940542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55941026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55941026"
         }
      },
      "body" : "You'd have to move this above the `return NULL`. (or remove it, as it is dead code)",
      "commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "created_at" : "2016-03-13T17:59:28Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";\n+        else if (nLoadWalletRet == DB_NONCRITICAL_ERROR)\n+        {\n+            warningString += _(\"Error reading wallet.dat! All keys read correctly, but transaction data\"\n+                          \" or address book entries might be missing or incorrect.\");\n+        }\n+        else if (nLoadWalletRet == DB_TOO_NEW)\n+            errorString += strprintf(_(\"Error loading wallet.dat: Wallet requires newer version of %s\"), _(PACKAGE_NAME)) + \"\\n\";\n+        else if (nLoadWalletRet == DB_NEED_REWRITE)\n+        {\n+            errorString += strprintf(_(\"Wallet needed to be rewritten: restart %s to complete\"), _(PACKAGE_NAME)) + \"\\n\";\n+            LogPrintf(\"%s\", errorString);\n+        }\n+        else\n+            errorString += _(\"Error loading wallet.dat\") + \"\\n\";\n+\n+        if (!errorString.empty())\n+            return NULL;\n+    }\n+\n+    if (GetBoolArg(\"-upgradewallet\", fFirstRun))\n+    {\n+        int nMaxVersion = GetArg(\"-upgradewallet\", 0);\n+        if (nMaxVersion == 0) // the -upgradewallet without argument case\n+        {\n+            LogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n+            nMaxVersion = CLIENT_VERSION;\n+            walletInstance->SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n+        }\n+        else\n+            LogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        if (nMaxVersion < walletInstance->GetVersion())\n+        {\n+            errorString += _(\"Cannot downgrade wallet\") + \"\\n\";\n+            return NULL;\n+        }\n+        walletInstance->SetMaxVersion(nMaxVersion);\n+    }\n+\n+    if (fFirstRun)\n+    {\n+        // Create new keyUser and set as default key\n+        RandAddSeedPerfmon();\n+\n+        CPubKey newDefaultKey;\n+        if (walletInstance->GetKeyFromPool(newDefaultKey)) {\n+            walletInstance->SetDefaultKey(newDefaultKey);\n+            if (!walletInstance->SetAddressBook(walletInstance->vchDefaultKey.GetID(), \"\", \"receive\"))\n+            {\n+                errorString += _(\"Cannot write default address\") += \"\\n\";\n+                return NULL;\n+            }\n+        }\n+\n+        walletInstance->SetBestChain(chainActive.GetLocator());\n+    }\n+\n+    LogPrintf(\"%s\", errorString);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55941026",
      "id" : 55941026,
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_position" : 90,
      "path" : "src/wallet/wallet.cpp",
      "position" : 90,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "updated_at" : "2016-03-13T17:59:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55941026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Concept ACK  4841d7d",
      "created_at" : "2016-03-13T18:09:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-196014847",
      "id" : 196014847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "updated_at" : "2016-03-13T18:09:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/196014847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
