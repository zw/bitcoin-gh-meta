{
   "assignee" : null,
   "body" : "The length of vectors, maps, sets, etc are serialized using\r\nWrite/ReadCompactSize -- which, unfortunately, do not use a\r\nunique encoding.\r\n\r\nSo deserializing and then re-serializing a transaction (for example)\r\ncan give you different bits than you started with. That doesn't\r\ncause any problems that we are aware of, but it is exactly the type\r\nof subtle mismatch that can lead to exploits.\r\n\r\nWith this pull, reading a non-canonical CompactSize throws an\r\nexception, which means nodes will ignore 'tx' or 'block' or\r\nother messages that are not properly encoded.\r\n\r\nPlease check my logic... but this change is safe with respect to\r\ncausing a network split. Old clients that receive\r\nnon-canonically-encoded transactions or blocks deserialize\r\nthem into CTransaction/CBlock structures in memory, and then\r\nre-serialize them before relaying them to peers.\r\n\r\nAnd please check my logic with respect to causing a blockchain\r\nsplit: there are no CompactSize fields in the block header, so\r\nthe block hash is always canonical. The merkle root in the block\r\nheader is computed on a vector&lt;CTransaction&gt;, so\r\nany non-canonical encoding of the transactions in 'tx' or 'block'\r\nmessages is erased as they are read into memory by old clients,\r\nand does not affect the block hash. And, as noted above, old\r\nclients re-serialize (with canonical encoding) 'tx' and 'block'\r\nmessages before relaying to peers.",
   "closed_at" : "2013-10-20T06:03:04Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
      "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
      "followers_url" : "https://api.github.com/users/gavinandresen/followers",
      "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/gavinandresen",
      "id" : 331997,
      "login" : "gavinandresen",
      "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
      "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
      "repos_url" : "https://api.github.com/users/gavinandresen/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/gavinandresen"
   },
   "comments" : 14,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2884/comments",
   "created_at" : "2013-08-07T05:16:30Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2884/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/2884",
   "id" : 17730325,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2884/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 2884,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/2884.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2884",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/2884.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2884"
   },
   "state" : "closed",
   "title" : "Reject non-canonically-encoded CompactSize",
   "updated_at" : "2013-10-20T06:03:04Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2884",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
      "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
      "followers_url" : "https://api.github.com/users/gavinandresen/followers",
      "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/gavinandresen",
      "id" : 331997,
      "login" : "gavinandresen",
      "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
      "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
      "repos_url" : "https://api.github.com/users/gavinandresen/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/gavinandresen"
   }
}
