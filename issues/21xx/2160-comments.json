[
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/635c3829c6a4ebae311d43881ea88265e444a4c7 for binaries and test log.",
      "created_at" : "2013-01-09T10:32:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12038819",
      "id" : 12038819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-09T10:32:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12038819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "Whats the motivation here? (I have no real objection to itÃ¢ÂÂ it's probably a good idea.. though our whole adjustedtime handling needs some loveÃ¢ÂÂ I'm just curious what motivated it)\r\n\r\n(As far as love goes: we should probably forget adjustments from peers which we are no longer connected toÃ¢ÂÂ and we should probably do something(???) to address the attack where we accept inbound and a hostile party makes 100 connections to us to push our adjusted time to the edge of the accepted window)",
      "created_at" : "2013-01-09T18:10:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12058473",
      "id" : 12058473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-09T18:12:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12058473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Here are the issues I think about for this seemingly trivial one-line change:\r\n\r\nIs adjusted time valid before you're connected to any peers?  Check code:  yes, will be current time.\r\n\r\nAre there any issues with calling GetAdjustedTime from multiple threads? Check code: nTimeOffSet in util is not protected by a mutex, so there could be an issue, although worst-case would just be an incorrect time reported fleetingly.\r\n\r\nMaybe we should protect nTimeOffset with a mutex; the assumption right now is probably that the only code that cares about adjusted time holds either the cs_main or a network mutex.  I'd have to spend a lot longer than I'm willing to right now to figure out if that is true.\r\n\r\nOther than all that... seems like a good idea.\r\n",
      "created_at" : "2013-01-09T21:09:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12066773",
      "id" : 12066773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-09T21:09:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12066773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Is the adjusted time that interesting? I think that the measured adjustment itself is more useful.",
      "created_at" : "2013-01-09T21:33:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12067823",
      "id" : 12067823,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-09T21:33:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12067823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "gmaxwell: I was just experimenting with nLockTime and noticed that there currently isn't any way to get the network adjusted time over RPC. (or even at all?) In theory a nLockTime-using application might care, but 1) none exist yet and 2) mining is too unpredictable for it to matter much and 3) what's more interesting is to know if your clock is probably way off. I added the data to getinfo simply because that seems to be the \"general state overview\" call, and it is in wallet.cpp so it's at least vagely related to the end-user use-case.\r\n\r\ngavin: Whether or not the time is valid is irrelevant: the purpose is to know the value of GetAdjustedTime(). Regarding thread safety nTimeOffset is only ever set in two places in AddTimeData and in both cases it's the correct value. On some 32-bit archs the two halves can be written separately, however the maximum range of nTimeOffset fits within 32-bits so it wouldn't be an issue except when transitioning from -1 to 0. (twos complement) Of course it could still be wrong, but with RPC latency you'd still be wrong anyway. That said, it's the kind of thing that could break in the future if the code changes. And yes, I should have thought about all of those issues first. :)\r\n\r\nsipa: That's a good point and because it doesn't look like a time value people would be more likely to understand what the value actually meant before using it for something. I could just call it \"timeoffset\" and return nTimeOffset directly.",
      "created_at" : "2013-01-09T22:30:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12070411",
      "id" : 12070411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-10T09:57:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12070411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "gmaxwell: Forgetting sounds reasonable. Regarding pushing: well, what's the big deal? The acceptance window is two hours, and AddTimeData doesn't allow nTimeOffset to be larger than +-70minutes. Lets suppose it gets pushed back as far as possible: on reception we reject a block with a time > 2 hours from now, thus so long as our clock is less than 50mins behind we're ok. (the mining simply ensures the timestamp will be valid regardless) If the clock is pushed forward and we're not mining nTimeOffset is irrelevant as the condition is for the block time to be simply > GetMedianTimePast(). If we are mining our blocks will be valid if our clocks are no more than 50mins ahead. Similarly that problem can be easily fixed by changing UpdateTime to never set the block time more than, say, an hour or something newer than the last block. (this assumes there isn't a large contingent of hashing power actually trying to increase the difficulty)\r\n\r\nGetting a bit off topic here, but I only just realized it... there isn't actually anything in Bitcoin preventing block timestamps from being too early other than collective miner self-interest... and while it's a theoretical problem now, it's conceivable that as the block reward drops to nothing the incentives to push the block timestamps backwards in time could get miners to do exactly that. Of course you just need one person to put a correct timestamp in, but it could make the trustworthiness of the timestamps more like within a day or two. It also could really throw a wrench in some of the niftier \"item renting via the blockchain\" schemes, although of course in that case you might see mining pools getting paid to put correct timestamps in the chain as well.",
      "created_at" : "2013-01-09T22:52:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12071381",
      "id" : 12071381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-09T23:05:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12071381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "The timestamps must go forward eventually as they must be greater than the median of the last ten, and stacking them all up would make the difficulty skyrocket. Sadly, they can't really be /forced/ more tightly than that without endangering convergence. If it were ever an issue one could implement a soft (non-forking) that says nodes will delay forward a block from more than X minutes in the past for at least Y minutes or until buried by Z more blocks, causing delayed blocks to get orphaned.\r\n\r\n> what's the big deal? The acceptance window is two hours, and AddTimeData doesn't allow nTimeOffset to be larger than +-70minutes.\r\n\r\nBecause abs(-70) + abs(70) = 140 which is greater than 120. This is a vulnerability. You can push a miner one way, and a merchant another way and make a merchant reject the longest chain to put them on a fork, a fork you can create by pushing a miner the same direction as the merchant (thus also rejecting the opposite sign miner).  It's sort of a far out attack that isn't much worth worrying about, but it ought to be fixed.\r\n\r\n",
      "created_at" : "2013-01-10T02:35:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12078086",
      "id" : 12078086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-10T02:35:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12078086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@sipa: Modified to return the offset itself.",
      "created_at" : "2013-01-11T12:07:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12141641",
      "id" : 12141641,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-27T07:51:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12141641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/8686f6467c9db2606706baca33842c97ff7621f8 for binaries and test log.",
      "created_at" : "2013-01-24T04:23:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2160#issuecomment-12636612",
      "id" : 12636612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2160",
      "updated_at" : "2013-01-24T04:23:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/12636612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   }
]
