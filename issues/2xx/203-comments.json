[
   {
      "body" : "I see you took into consideration the issue of the password/key being swapped out but didn't actually write any code to prevent it. You should use mlock (unix) or VirtualLock (windows) to prevent memory from being swapped (the correct way of doing this is: allocate, mlock/VirtualLock, use the memory, when done overwrite it (random data is better than 0s), deallocate). Note: this still won't protect from other processes peeking at your memory, at least on windows.",
      "created_at" : "2011-05-08T20:00:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1120096",
      "id" : 1120096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-08T20:00:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/408018?v=3",
         "events_url" : "https://api.github.com/users/CAFxX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/CAFxX/followers",
         "following_url" : "https://api.github.com/users/CAFxX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/CAFxX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/CAFxX",
         "id" : 408018,
         "login" : "CAFxX",
         "organizations_url" : "https://api.github.com/users/CAFxX/orgs",
         "received_events_url" : "https://api.github.com/users/CAFxX/received_events",
         "repos_url" : "https://api.github.com/users/CAFxX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/CAFxX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/CAFxX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/CAFxX"
      }
   },
   {
      "body" : "Yea the whole ramdump to see password/key is pretty much impossible to prevent no matter what you do, so I'm really not going to try to fight it.  Though, I'm planning to add more security to the encryption later, but having it now really isn't worth it for several reasons (see the original forum thread by jgarzik linked by the one about this pull).",
      "created_at" : "2011-05-08T20:05:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1120108",
      "id" : 1120108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-08T20:05:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "As a side note, preventing any kind of key leakage is pretty much impossible in C++ when the user is entering the key in wx.  If nothing else, the current value of the password dialog might end up in swap.  I'll try to add a bunch of memlock's and memset/fills tomorrow but I don't think its possible for it to be 100%.",
      "created_at" : "2011-05-08T20:36:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1120196",
      "id" : 1120196,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-08T20:36:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I guess so, unless we also patch wx in the process.",
      "created_at" : "2011-05-09T05:51:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1121346",
      "id" : 1121346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-09T05:51:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/408018?v=3",
         "events_url" : "https://api.github.com/users/CAFxX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/CAFxX/followers",
         "following_url" : "https://api.github.com/users/CAFxX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/CAFxX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/CAFxX",
         "id" : 408018,
         "login" : "CAFxX",
         "organizations_url" : "https://api.github.com/users/CAFxX/orgs",
         "received_events_url" : "https://api.github.com/users/CAFxX/received_events",
         "repos_url" : "https://api.github.com/users/CAFxX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/CAFxX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/CAFxX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/CAFxX"
      }
   },
   {
      "body" : "Now with more mlock().  Note I made a conscious decision here that I only bother to keep the actual password entered by the user out of memory/swap as much as possible, not the derived key or the private keys themselves.  I have a separate branch which encrypts private keys in memory (much easier than not loading until needed in the current architecture) but still keeps the key to decrypt them in memory.  Hopefully someone has the time to patch bitcoin to be a bit more careful about when it generates private keys and make it possible for password entry only at decrypt-time.",
      "created_at" : "2011-05-09T10:23:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1122111",
      "id" : 1122111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-09T10:23:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Note that any password longer than 100 characters will only have the first 100 mlock()d, but if you can't derive the key without all of the password, so I'm not concerned.",
      "created_at" : "2011-05-09T10:24:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1122114",
      "id" : 1122114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-09T10:24:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "maybe adding some comments about this might help (eventually also mentioning that currently there's no way to stop another process from peeking and that we don't deal with hibernate-to-disk)",
      "created_at" : "2011-05-09T10:33:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1122137",
      "id" : 1122137,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-09T10:33:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/408018?v=3",
         "events_url" : "https://api.github.com/users/CAFxX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/CAFxX/followers",
         "following_url" : "https://api.github.com/users/CAFxX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/CAFxX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/CAFxX",
         "id" : 408018,
         "login" : "CAFxX",
         "organizations_url" : "https://api.github.com/users/CAFxX/orgs",
         "received_events_url" : "https://api.github.com/users/CAFxX/received_events",
         "repos_url" : "https://api.github.com/users/CAFxX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/CAFxX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/CAFxX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/CAFxX"
      }
   },
   {
      "body" : "Now with more comments to clarify the purpose of mlock()s and such.  \r\nNow the question: I have a WIP branch which decrypts private keys only at spend-time (or it will in a couple days).  Still a couple things to tighten down, but the question is which would rather be seen in bitcoin?\r\nhttps://github.com/TheBlueMatt/bitcoin/tree/encprivkeys",
      "created_at" : "2011-05-10T08:32:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1129745",
      "id" : 1129745,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-10T08:32:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1129745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "well, keeping the keys encrypted in ram as a method to prevent other processes from reading it is pretty useless unless we manage to lock out all other processes from accessing our memory. reasking the password at spending-time is a good opt-in setting, but doesn't require keeping the keys encrypted in ram.\nso If I had to choose I'd definitely say wallet encryption over privkey encryption in ram.\nit would probably make more sense to have an hardware token (something like one of these http://www.hacker10.com/tag/hardware-security-token/ ) storing the privkey and doing the actual signing (so that the privkey never leaves it).",
      "created_at" : "2011-05-10T16:17:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1131896",
      "id" : 1131896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-10T16:17:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1131896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/408018?v=3",
         "events_url" : "https://api.github.com/users/CAFxX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/CAFxX/followers",
         "following_url" : "https://api.github.com/users/CAFxX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/CAFxX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/CAFxX",
         "id" : 408018,
         "login" : "CAFxX",
         "organizations_url" : "https://api.github.com/users/CAFxX/orgs",
         "received_events_url" : "https://api.github.com/users/CAFxX/received_events",
         "repos_url" : "https://api.github.com/users/CAFxX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/CAFxX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/CAFxX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/CAFxX"
      }
   },
   {
      "body" : "Superseded by #232 closed.",
      "created_at" : "2011-05-18T13:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/203#issuecomment-1197019",
      "id" : 1197019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/203",
      "updated_at" : "2011-05-18T13:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1197019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
