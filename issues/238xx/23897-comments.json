[
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 154307c10b0d3c0e7dfbe463de7d040b2eb97c74 -> c4476a5ea787e3722d8c1e5fed5f0c6e2a554327 ([pr23897.01](https://github.com/hebasto/bitcoin/commits/pr23897.01) -> [pr23897.02](https://github.com/hebasto/bitcoin/commits/pr23897.02)) on top of the merged #23683.",
      "created_at" : "2022-01-03T14:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1004142158",
      "id" : 1004142158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII58472f5O",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004142158/reactions"
      },
      "updated_at" : "2022-01-03T14:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004142158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1191321712), [aureleoules](https://github.com/bitcoin/bitcoin/pull/23897#pullrequestreview-1142387544), [stickies-v](https://github.com/bitcoin/bitcoin/pull/23897#pullrequestreview-1251989292) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "created_at" : "2022-01-03T15:03:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1004152066",
      "id" : 1004152066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII58472iUC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004152066/reactions"
      },
      "updated_at" : "2023-01-31T13:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004152066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-19T15:01:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1016552290",
      "id" : 1016552290,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII5848l1ti",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016552290/reactions"
      },
      "updated_at" : "2022-01-19T15:01:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016552290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased c4476a5ea787e3722d8c1e5fed5f0c6e2a554327 -> 220475bdbca0598c6f5158e870b89ff9503a7258 ([pr23897.02](https://github.com/hebasto/bitcoin/commits/pr23897.02) -> [pr23897.03](https://github.com/hebasto/bitcoin/commits/pr23897.03)) on top of the merged #23976.",
      "created_at" : "2022-01-19T21:53:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1016901169",
      "id" : 1016901169,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII5848nK4x",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016901169/reactions"
      },
      "updated_at" : "2022-01-19T21:53:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016901169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be nice to remove the raw pointers while we're changing the interface anyway. I think a better interface is to have `CalculateLockPoints()` return a `std::optional<LockPoints>` which encodes the same information as the bool.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:08:36Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573355",
      "id" : 792573355,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII584vPbWr",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573355/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573702"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can be replaced with a `LogPrintf` and `return std::nullopt`. Also seems like this log could be improved by adding the transaction id and/or prevout that is missing.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:09:03Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573702",
      "id" : 792573702,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584vPbcG",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 240,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 30,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573702/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792574579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574579"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here, would be nice to remove the raw pointer and make this parameter a `const LockPoints& lp`. It doesn't make sense to allow a nullptr `lp` to be passed in anymore, since we can't check sequence locks on empty lockpoints anyway.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:10:21Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const std::pair<int, int64_t> lock_pair{CalculateSequenceLocks(tx, flags, prevheights, index)};\n+    lp->height = lock_pair.first;\n+    lp->time = lock_pair.second;\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // lock_pair from CalculateSequenceLocks against tip+1.  We know\n+    // EvaluateSequenceLocks will fail if there was a non-zero sequence\n+    // lock on a mempool input, so we can use the return value of\n+    // CheckSequenceLocks to indicate the LockPoints validity\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != tip->nHeight + 1) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }\n+    lp->maxInputBlock = tip->GetAncestor(max_input_height);\n+\n+    return true;\n+}\n+\n bool CheckSequenceLocks(CBlockIndex* tip,\n-                        const CCoinsView& coins_view,\n-                        const CTransaction& tx,\n-                        int flags,\n-                        LockPoints* lp,\n-                        bool useExistingLockPoints)\n+                        const LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792574579",
      "id" : 792574579,
      "line" : 279,
      "node_id" : "PRRC_kwDOABII584vPbpz",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 279,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 74,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792578100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792578100"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that we do have a bit of a behavior change here: we now update the mempool entry LockPoints even if we're going to remove the entry later. I'm not sure if this is desirable.\r\n\r\nI suggest adding documentation as well, e.g. \"If the cached LockPoints are now invalid, recalculate them and update the mempool entry before calling `CheckSequenceLocks()`.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:15:23Z",
      "diff_hunk" : "@@ -365,18 +377,13 @@ void CChainState::MaybeUpdateMempoolForReorg(\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        // CheckSequenceLocks checks if the transaction will be final in the next block to be\n-        // created on top of the new chain. We use useExistingLockPoints=false so that, instead of\n-        // using the information in lp (which might now refer to a block that no longer exists in\n-        // the chain), it will update lp to contain LockPoints relevant to the new chain.\n-        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // If CheckSequenceLocks fails, remove the tx and don't depend on the LockPoints.\n-            return true;\n-        } else if (!validLP) {\n-            // If CheckSequenceLocks succeeded, it also updated the LockPoints.\n-            // Now update the mempool entry lockpoints as well.\n+        if (!validLP) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792578100",
      "id" : 792578100,
      "line" : 380,
      "node_id" : "PRRC_kwDOABII584vPcg0",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 380,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 153,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792578100/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792578100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-14T16:37:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1067041024",
      "id" : 1067041024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII584_mcEA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067041024/reactions"
      },
      "updated_at" : "2022-03-14T16:37:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067041024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 220475bdbca0598c6f5158e870b89ff9503a7258 -> aa8f68b2352dd37cae59867276b38127d7041685 ([pr23897.03](https://github.com/hebasto/bitcoin/commits/pr23897.03) -> [pr23897.04](https://github.com/hebasto/bitcoin/commits/pr23897.04)):\r\n- rebased\r\n- addressed @glozow's comments\r\n\r\n\r\nAlso the PR description has been updated.",
      "created_at" : "2022-04-19T16:06:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191",
      "id" : 1102831191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585Bu95X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102831191/reactions"
      },
      "updated_at" : "2022-04-19T16:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102831191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248533"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248533"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:06:53Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248533",
      "id" : 853248533,
      "in_reply_to_id" : 792573355,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y24oV",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945961661,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248533/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:06:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:07:12Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248890",
      "id" : 853248890,
      "in_reply_to_id" : 792573702,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y24t6",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 240,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945962159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:07:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853249200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853249200"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:07:30Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const std::pair<int, int64_t> lock_pair{CalculateSequenceLocks(tx, flags, prevheights, index)};\n+    lp->height = lock_pair.first;\n+    lp->time = lock_pair.second;\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // lock_pair from CalculateSequenceLocks against tip+1.  We know\n+    // EvaluateSequenceLocks will fail if there was a non-zero sequence\n+    // lock on a mempool input, so we can use the return value of\n+    // CheckSequenceLocks to indicate the LockPoints validity\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != tip->nHeight + 1) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }\n+    lp->maxInputBlock = tip->GetAncestor(max_input_height);\n+\n+    return true;\n+}\n+\n bool CheckSequenceLocks(CBlockIndex* tip,\n-                        const CCoinsView& coins_view,\n-                        const CTransaction& tx,\n-                        int flags,\n-                        LockPoints* lp,\n-                        bool useExistingLockPoints)\n+                        const LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853249200",
      "id" : 853249200,
      "in_reply_to_id" : 792574579,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y24yw",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 279,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945962568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853249200/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:07:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853249200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853250889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853250889"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Note that we do have a bit of a behavior change here...\r\n\r\nThank you!\r\n\r\nThe current behavior has been preserved in the recent [update](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:09:21Z",
      "diff_hunk" : "@@ -365,18 +377,13 @@ void CChainState::MaybeUpdateMempoolForReorg(\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        // CheckSequenceLocks checks if the transaction will be final in the next block to be\n-        // created on top of the new chain. We use useExistingLockPoints=false so that, instead of\n-        // using the information in lp (which might now refer to a block that no longer exists in\n-        // the chain), it will update lp to contain LockPoints relevant to the new chain.\n-        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // If CheckSequenceLocks fails, remove the tx and don't depend on the LockPoints.\n-            return true;\n-        } else if (!validLP) {\n-            // If CheckSequenceLocks succeeded, it also updated the LockPoints.\n-            // Now update the mempool entry lockpoints as well.\n+        if (!validLP) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853250889",
      "id" : 853250889,
      "in_reply_to_id" : 792578100,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y25NJ",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 380,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945965000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853250889/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853250889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-06T10:56:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1119493952",
      "id" : 1119493952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585Cuh9A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119493952/reactions"
      },
      "updated_at" : "2022-05-06T10:56:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119493952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased aa8f68b2352dd37cae59867276b38127d7041685 -> 5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479 ([pr23897.04](https://github.com/hebasto/bitcoin/commits/pr23897.04) -> [pr23897.05](https://github.com/hebasto/bitcoin/commits/pr23897.05)) due to conflict with #24804.",
      "created_at" : "2022-05-28T12:35:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1140252600",
      "id" : 1140252600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585D9t-4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1140252600/reactions"
      },
      "updated_at" : "2022-05-28T12:35:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1140252600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926451573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926451573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in fc31aa12b9599f3a23c22fd65b3eaa73dbb05d81:\r\n\r\nShould document that this returns std::nullopt if there is an error, i.e., if inputs cannot be found in the `coins_view`",
      "commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "created_at" : "2022-07-21T09:18:35Z",
      "diff_hunk" : "@@ -289,6 +289,24 @@ PackageMempoolAcceptResult ProcessNewPackage(CChainState& active_chainstate, CTx\n  */\n bool CheckFinalTxAtTip(const CBlockIndex* active_chain_tip, const CTransaction& tx) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+/**\n+ * Calculate LockPoints required to check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * @param[in]   tip             Chain tip to check tx sequence locks against. For example,\n+ *                              the tip of the current active chain.\n+ * @param[in]   coins_view      Any CCoinsView that provides access to the relevant coins for\n+ *                              checking sequence locks. For example, it can be a CCoinsViewCache\n+ *                              that isn't connected to anything but contains all the relevant\n+ *                              coins, or a CCoinsViewMemPool that is connected to the\n+ *                              mempool and chainstate UTXO set. In the latter case, the caller is\n+ *                              responsible for holding the appropriate locks to ensure that\n+ *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for calculation.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926451573",
      "id" : 926451573,
      "line" : 304,
      "node_id" : "PRRC_kwDOABII5843OId1",
      "original_commit_id" : "fc31aa12b9599f3a23c22fd65b3eaa73dbb05d81",
      "original_line" : 304,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 16,
      "pull_request_review_id" : 1046211677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926451573/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T09:56:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926451573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926480577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926480577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To me, this suggests `tip` should be a reference instead of a pointer?",
      "commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "created_at" : "2022-07-21T09:48:56Z",
      "diff_hunk" : "@@ -185,11 +185,67 @@ bool CheckFinalTxAtTip(const CBlockIndex* active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926480577",
      "id" : 926480577,
      "line" : 192,
      "node_id" : "PRRC_kwDOABII5843OPjB",
      "original_commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "original_line" : 192,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 8,
      "pull_request_review_id" : 1046211677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926480577/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T09:56:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926480577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926486212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926486212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479\r\n\r\n```suggestion\r\n * @param[in]   lp              LockPoints containing the height and time at which this transaction is final.\r\n```",
      "commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "created_at" : "2022-07-21T09:54:51Z",
      "diff_hunk" : "@@ -300,17 +300,26 @@ bool CheckFinalTxAtTip(const CBlockIndex* active_chain_tip, const CTransaction&\n  *                              mempool and chainstate UTXO set. In the latter case, the caller is\n  *                              responsible for holding the appropriate locks to ensure that\n  *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for calculation.\n+ */\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx);\n+\n+/**\n+ * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * @param[in]   tip             Chain tip to check tx sequence locks against. For example,\n+ *                              the tip of the current active chain.\n+ * @param[in]   lp              Relative locktime constraints (BIP68).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926486212",
      "id" : 926486212,
      "line" : 314,
      "node_id" : "PRRC_kwDOABII5843OQ7E",
      "original_commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "original_line" : 314,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 24,
      "pull_request_review_id" : 1046211677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926486212/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T09:56:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926486212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926505198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926505198"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`CChain::Tip()` is been passed as an argument, and it could be a `nullptr`.",
      "commit_id" : "803869954e0e3bc32279dac71cf40a0614b79566",
      "created_at" : "2022-07-21T10:15:37Z",
      "diff_hunk" : "@@ -185,11 +185,67 @@ bool CheckFinalTxAtTip(const CBlockIndex* active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926505198",
      "id" : 926505198,
      "in_reply_to_id" : 926480577,
      "line" : 192,
      "node_id" : "PRRC_kwDOABII5843OVju",
      "original_commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "original_line" : 192,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 8,
      "pull_request_review_id" : 1046287279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926505198/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T10:15:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926505198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479 -> 803869954e0e3bc32279dac71cf40a0614b79566 ([pr23897.05](https://github.com/hebasto/bitcoin/commits/pr23897.05) -> [pr23897.06](https://github.com/hebasto/bitcoin/commits/pr23897.06), [diff](https://github.com/hebasto/bitcoin/compare/pr23897.05..pr23897.06)):\r\n\r\n- addressed @glozow's comments",
      "created_at" : "2022-07-21T10:20:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1191310762",
      "id" : 1191310762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585HAfWq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191310762/reactions"
      },
      "updated_at" : "2022-07-21T10:20:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191310762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926510270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926510270"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1191310762).",
      "commit_id" : "803869954e0e3bc32279dac71cf40a0614b79566",
      "created_at" : "2022-07-21T10:21:25Z",
      "diff_hunk" : "@@ -289,6 +289,24 @@ PackageMempoolAcceptResult ProcessNewPackage(CChainState& active_chainstate, CTx\n  */\n bool CheckFinalTxAtTip(const CBlockIndex* active_chain_tip, const CTransaction& tx) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+/**\n+ * Calculate LockPoints required to check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * @param[in]   tip             Chain tip to check tx sequence locks against. For example,\n+ *                              the tip of the current active chain.\n+ * @param[in]   coins_view      Any CCoinsView that provides access to the relevant coins for\n+ *                              checking sequence locks. For example, it can be a CCoinsViewCache\n+ *                              that isn't connected to anything but contains all the relevant\n+ *                              coins, or a CCoinsViewMemPool that is connected to the\n+ *                              mempool and chainstate UTXO set. In the latter case, the caller is\n+ *                              responsible for holding the appropriate locks to ensure that\n+ *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for calculation.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926510270",
      "id" : 926510270,
      "in_reply_to_id" : 926451573,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843OWy-",
      "original_commit_id" : "fc31aa12b9599f3a23c22fd65b3eaa73dbb05d81",
      "original_line" : 304,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1046294369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926510270/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T10:21:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926510270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926510401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926510401"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1191310762).",
      "commit_id" : "803869954e0e3bc32279dac71cf40a0614b79566",
      "created_at" : "2022-07-21T10:21:34Z",
      "diff_hunk" : "@@ -300,17 +300,26 @@ bool CheckFinalTxAtTip(const CBlockIndex* active_chain_tip, const CTransaction&\n  *                              mempool and chainstate UTXO set. In the latter case, the caller is\n  *                              responsible for holding the appropriate locks to ensure that\n  *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for calculation.\n+ */\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx);\n+\n+/**\n+ * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * @param[in]   tip             Chain tip to check tx sequence locks against. For example,\n+ *                              the tip of the current active chain.\n+ * @param[in]   lp              Relative locktime constraints (BIP68).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926510401",
      "id" : 926510401,
      "in_reply_to_id" : 926486212,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843OW1B",
      "original_commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "original_line" : 314,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1046294555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926510401/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T10:21:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926510401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926516947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926516947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry I should have said the *parameter* `tip`, as in, if a function expects a non-nullptr tip, then perhaps it should take a reference instead of a pointer. But I think I get what you mean, that `CChain::Tip()` returns a pointer and that's passed around pretty frequently in the codebase.",
      "commit_id" : "803869954e0e3bc32279dac71cf40a0614b79566",
      "created_at" : "2022-07-21T10:29:16Z",
      "diff_hunk" : "@@ -185,11 +185,67 @@ bool CheckFinalTxAtTip(const CBlockIndex* active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926516947",
      "id" : 926516947,
      "in_reply_to_id" : 926480577,
      "line" : 192,
      "node_id" : "PRRC_kwDOABII5843OYbT",
      "original_commit_id" : "5a6ce8cca31b3105cb8e96cd3e5e6c0da0fb3479",
      "original_line" : 192,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 8,
      "pull_request_review_id" : 1046303744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926516947/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-21T10:29:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926516947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK 803869954e0e3bc32279dac71cf40a0614b79566\r\n\r\nOnly changes are doc updates, for https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926451573 and https://github.com/bitcoin/bitcoin/pull/23897#discussion_r926486212",
      "created_at" : "2022-07-21T10:32:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1191321712",
      "id" : 1191321712,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585HAiBw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191321712/reactions"
      },
      "updated_at" : "2022-07-21T10:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191321712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> No objection if you want to move-only some stuff out of a function and then call the newly created function in place.\r\n\r\nfwiw this is >50% move-only.",
      "created_at" : "2022-07-21T10:52:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1191339115",
      "id" : 1191339115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585HAmRr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191339115/reactions"
      },
      "updated_at" : "2022-07-21T10:52:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191339115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-12T07:27:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1212811635",
      "id" : 1212811635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585ISglz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1212811635/reactions"
      },
      "updated_at" : "2022-08-12T07:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1212811635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 803869954e0e3bc32279dac71cf40a0614b79566 -> 32e3fc173410641569bc4df805d5431cf0013d74 ([pr23897.06](https://github.com/hebasto/bitcoin/commits/pr23897.06) -> [pr23897.07](https://github.com/hebasto/bitcoin/commits/pr23897.07)) due to the conflict with #25677.",
      "created_at" : "2022-08-16T12:21:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1216562147",
      "id" : 1216562147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585Ig0Pj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1216562147/reactions"
      },
      "updated_at" : "2022-08-16T12:21:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1216562147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-10T12:29:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1273241329",
      "id" : 1273241329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585L5B7x",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273241329/reactions"
      },
      "updated_at" : "2022-10-10T12:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273241329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 32e3fc173410641569bc4df805d5431cf0013d74 -> bebaddb0767b9c52507e8d50a18510b592c14778 ([pr23897.07](https://github.com/hebasto/bitcoin/commits/pr23897.07) -> [pr23897.08](https://github.com/hebasto/bitcoin/commits/pr23897.08)) due to the conflict with #25073.",
      "created_at" : "2022-10-10T12:40:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1273255219",
      "id" : 1273255219,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585L5FUz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273255219/reactions"
      },
      "updated_at" : "2022-10-10T12:40:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273255219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r992398059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992398059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in ed9db580c764cf26fb534be54684c46e79300a38\r\n```suggestion\r\n    const auto [minHeight, minTime] = CalculateSequenceLocks(tx, STANDARD_LOCKTIME_VERIFY_FLAGS, prevheights, index);\r\n```",
      "commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "created_at" : "2022-10-11T14:24:11Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const std::pair<int, int64_t> lock_pair{CalculateSequenceLocks(tx, STANDARD_LOCKTIME_VERIFY_FLAGS, prevheights, index)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r992398059",
      "id" : 992398059,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847Jsrr",
      "original_commit_id" : "bebaddb0767b9c52507e8d50a18510b592c14778",
      "original_line" : 210,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1137604257,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992398059/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-11T16:20:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992398059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r992464332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992464332"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in ed9db580c764cf26fb534be54684c46e79300a38: Avoids dereferencing multiple times:\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex a25e817a5..0fa8dc30c 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -201,7 +201,7 @@ std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\r\n         }\r\n         if (coin.nHeight == MEMPOOL_HEIGHT) {\r\n             // Assume all mempool transaction confirm in the next block\r\n-            prevheights[txinIndex] = tip->nHeight + 1;\r\n+            prevheights[txinIndex] = index.nHeight;\r\n         } else {\r\n             prevheights[txinIndex] = coin.nHeight;\r\n         }\r\n@@ -222,7 +222,7 @@ std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\r\n     int max_input_height{0};\r\n     for (const int height : prevheights) {\r\n         // Can ignore mempool inputs since we'll fail if they had non-zero locks\r\n-        if (height != tip->nHeight + 1) {\r\n+        if (height != index.nHeight) {\r\n             max_input_height = std::max(max_input_height, height);\r\n         }\r\n     }\r\n```",
      "commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "created_at" : "2022-10-11T15:17:11Z",
      "diff_hunk" : "@@ -176,6 +176,65 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r992464332",
      "id" : 992464332,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847J83M",
      "original_commit_id" : "ed9db580c764cf26fb534be54684c46e79300a38",
      "original_line" : 204,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1137604257,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992464332/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-11T16:20:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992464332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated bebaddb0767b9c52507e8d50a18510b592c14778 -> ed2d714bd1130291a2f781e644f787d421cdf26e ([pr23897.08](https://github.com/hebasto/bitcoin/commits/pr23897.08) -> [pr23897.09](https://github.com/hebasto/bitcoin/commits/pr23897.09), [diff](https://github.com/hebasto/bitcoin/compare/pr23897.08..pr23897.09)):\r\n\r\n- addressed @aureleoules's comments",
      "created_at" : "2022-10-14T12:06:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1278917666",
      "id" : 1278917666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585MOrwi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1278917666/reactions"
      },
      "updated_at" : "2022-10-14T12:06:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1278917666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r995686733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995686733"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!.[Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1278917666).",
      "commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "created_at" : "2022-10-14T12:06:32Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const std::pair<int, int64_t> lock_pair{CalculateSequenceLocks(tx, STANDARD_LOCKTIME_VERIFY_FLAGS, prevheights, index)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r995686733",
      "id" : 995686733,
      "in_reply_to_id" : 992398059,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847WPlN",
      "original_commit_id" : "bebaddb0767b9c52507e8d50a18510b592c14778",
      "original_line" : 210,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1142314989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995686733/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-14T12:06:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995686733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r995686835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995686835"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!.[Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1278917666).",
      "commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "created_at" : "2022-10-14T12:06:42Z",
      "diff_hunk" : "@@ -176,6 +176,65 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r995686835",
      "id" : 995686835,
      "in_reply_to_id" : 992464332,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847WPmz",
      "original_commit_id" : "ed9db580c764cf26fb534be54684c46e79300a38",
      "original_line" : 204,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1142315167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995686835/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-14T12:06:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995686835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1003352551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003352551"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd avoid using `resize()` since there's no need to default-initialize everything. `reserve()` seems more appropriate:\r\n```suggestion\r\n    std::vector<int> prevheights;\r\n    prevheights.reserve(tx.vin.size());\r\n```",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-10-24T14:00:59Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1003352551",
      "id" : 1003352551,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847zfHn",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 194,
      "original_position" : 19,
      "original_start_line" : 193,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1153197071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003352551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-04T16:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003352551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1013262598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013262598"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: would this be a more helpful name?\r\n```suggestion\r\n    CBlockIndex next_tip;\r\n```",
      "commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "created_at" : "2022-11-03T18:22:23Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1013262598",
      "id" : 1013262598,
      "line" : 185,
      "node_id" : "PRRC_kwDOABII5848ZSkG",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 185,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 10,
      "pull_request_review_id" : 1153197071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013262598/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-04T10:15:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013262598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1013832021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013832021"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it make sense to pass a `CBlockIndex&` instead and avoid checking for nullptr here? If this fn requires a non-nullptr `CBlockIndex`, I think the fn signature should reflect that and the callsite to take responsibility.",
      "commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "created_at" : "2022-11-04T10:08:06Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1013832021",
      "id" : 1013832021,
      "line" : 183,
      "node_id" : "PRRC_kwDOABII5848bdlV",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 183,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 8,
      "pull_request_review_id" : 1153197071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013832021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-04T10:14:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013832021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1013836315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013836315"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: missing doxygen for `tx` param",
      "commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "created_at" : "2022-11-04T10:12:46Z",
      "diff_hunk" : "@@ -271,17 +271,28 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n  *                              mempool and chainstate UTXO set. In the latter case, the caller is\n  *                              responsible for holding the appropriate locks to ensure that\n  *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for\n+ *          calculation, or std::nullopt if there is an error.\n+ */\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1013836315",
      "id" : 1013836315,
      "line" : 280,
      "node_id" : "PRRC_kwDOABII5848beob",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 280,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 19,
      "pull_request_review_id" : 1153197071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013836315/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-04T10:14:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013836315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1014172199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014172199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This documentation seems out of date now",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-04T15:29:53Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1014172199",
      "id" : 1014172199,
      "line" : 214,
      "node_id" : "PRRC_kwDOABII5848cwon",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 214,
      "original_position" : 13,
      "original_start_line" : 187,
      "path" : "src/validation.cpp",
      "position" : 39,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014172199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 213,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014172199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1014250449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014250449"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For readability, I think this chunk of code could be separated out into a `CalculatePrevHeights` function?",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-04T16:42:47Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = index.nHeight;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1014250449",
      "id" : 1014250449,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848dDvR",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 207,
      "original_position" : 32,
      "original_start_line" : 193,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014250449/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014250449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1014254885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014254885"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think overly abbreviated variable names should be avoided for readability\r\n```suggestion\r\n                             const LockPoints& lock_points)\r\n```",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-04T16:47:26Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = index.nHeight;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const auto [min_height, min_time] = CalculateSequenceLocks(tx, STANDARD_LOCKTIME_VERIFY_FLAGS, prevheights, index);\n+\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // min_height and min_time from CalculateSequenceLocks against tip+1.\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != index.nHeight) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }\n+\n+    // tip->GetAncestor(max_input_height) should never return a nullptr\n+    // because max_input_height is always less than the tip height.\n+    // It would, however, be a bad bug to continue execution, since a\n+    // LockPoints object with the maxInputBlock member set to nullptr\n+    // signifies no relative lock time.\n+    return LockPoints{min_height, min_time, Assert(tip->GetAncestor(max_input_height))};\n+}\n+\n bool CheckSequenceLocksAtTip(CBlockIndex* tip,\n-                        const CCoinsView& coins_view,\n-                        const CTransaction& tx,\n-                        LockPoints* lp,\n-                        bool useExistingLockPoints)\n+                             const LockPoints& lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1014254885",
      "id" : 1014254885,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848dE0l",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 239,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014254885/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014254885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019009977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019009977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps you could `Assume(false)` here to ensure this is visible in debug builds? I don't think we ever expect this path to be reached?",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-10T11:55:15Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019009977",
      "id" : 1019009977,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848vNu5",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 199,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019009977/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019009977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019055149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019055149"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "While refactoring this function, would it be appropriate to eliminate this behemoth `filter_final_and_mature` lambda and turn it into a member function? It's a very straightforward carve-out and I think that massively helps with readability. Example very quick diff below (some lock warnings but compiles otherwise). In addition to carve-out, it also flips the true/false behaviour for an (imo) more intuitive behaviour and naming and thus readability.\r\n\r\n<details>\r\n<summary>git diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 0986147b7..1657323bd 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -323,60 +323,60 @@ void Chainstate::MaybeUpdateMempoolForReorg(\r\n     // the disconnectpool that were added back and cleans up the mempool state.\r\n     m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\r\n \r\n-    // Predicate to use for filtering transactions in removeForReorg.\r\n-    // Checks whether the transaction is still final and, if it spends a coinbase output, mature.\r\n-    // Also updates valid entries' cached LockPoints if needed.\r\n-    // If false, the tx is still valid and its lockpoints are updated.\r\n-    // If true, the tx would be invalid in the next block; remove this entry and all of its descendants.\r\n-    const auto filter_final_and_mature = [this](CTxMemPool::txiter it)\r\n-        EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main) {\r\n-        AssertLockHeld(m_mempool->cs);\r\n-        AssertLockHeld(::cs_main);\r\n-        const CTransaction& tx = it->GetTx();\r\n+    // We also need to remove any now-immature transactions\r\n+    m_mempool->removeForReorg(m_chain, [this](CTxMemPool::txiter it){ return !this->IsTxFinalAndMature(it); });\r\n+    // Re-limit mempool size, in case we added any transactions\r\n+    LimitMempoolSize(*m_mempool, this->CoinsTip());\r\n+}\r\n \r\n-        // The transaction must be final.\r\n-        if (!CheckFinalTxAtTip(*Assert(m_chain.Tip()), tx)) return true;\r\n+// Predicate to use for filtering transactions in removeForReorg.\r\n+// Checks whether the transaction is still final and, if it spends a coinbase output, mature.\r\n+// Also updates valid entries' cached LockPoints if needed.\r\n+// If true, the tx is still valid and its lockpoints are updated.\r\n+// If false, the tx would be invalid in the next block; remove this entry and all of its descendants.\r\n+bool Chainstate::IsTxFinalAndMature(CTxMemPool::txiter it) EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main)\r\n+{\r\n+    AssertLockHeld(m_mempool->cs);\r\n+    AssertLockHeld(::cs_main);\r\n+    const CTransaction& tx = it->GetTx();\r\n \r\n-        const LockPoints& lp = it->GetLockPoints();\r\n-        // CheckSequenceLocksAtTip checks if the transaction will be final in the next block to be\r\n-        // created on top of the new chain.\r\n-        if (TestLockPointValidity(m_chain, lp)) {\r\n-            if (!CheckSequenceLocksAtTip(m_chain.Tip(), lp)) {\r\n-                return true;\r\n-            }\r\n+    // The transaction must be final.\r\n+    if (!CheckFinalTxAtTip(*Assert(m_chain.Tip()), tx)) return true;\r\n+\r\n+    const LockPoints& lp = it->GetLockPoints();\r\n+    // CheckSequenceLocksAtTip checks if the transaction will be final in the next block to be\r\n+    // created on top of the new chain.\r\n+    if (TestLockPointValidity(m_chain, lp)) {\r\n+        if (!CheckSequenceLocksAtTip(m_chain.Tip(), lp)) {\r\n+            return false;\r\n+        }\r\n+    } else {\r\n+        const CCoinsViewMemPool view_mempool{&CoinsTip(), *m_mempool};\r\n+        const std::optional<LockPoints> new_lock_points{CalculateLockPointsAtTip(m_chain.Tip(), view_mempool, tx)};\r\n+        if (new_lock_points.has_value() && CheckSequenceLocksAtTip(m_chain.Tip(), *new_lock_points)) {\r\n+            // Now update the mempool entry lockpoints as well.\r\n+            m_mempool->mapTx.modify(it, [&new_lock_points](CTxMemPoolEntry& e) { e.UpdateLockPoints(*new_lock_points); });\r\n         } else {\r\n-            const CCoinsViewMemPool view_mempool{&CoinsTip(), *m_mempool};\r\n-            const std::optional<LockPoints> new_lock_points{CalculateLockPointsAtTip(m_chain.Tip(), view_mempool, tx)};\r\n-            if (new_lock_points.has_value() && CheckSequenceLocksAtTip(m_chain.Tip(), *new_lock_points)) {\r\n-                // Now update the mempool entry lockpoints as well.\r\n-                m_mempool->mapTx.modify(it, [&new_lock_points](CTxMemPoolEntry& e) { e.UpdateLockPoints(*new_lock_points); });\r\n-            } else {\r\n-                return true;\r\n-            }\r\n+            return false;\r\n         }\r\n+    }\r\n \r\n-        // If the transaction spends any coinbase outputs, it must be mature.\r\n-        if (it->GetSpendsCoinbase()) {\r\n-            for (const CTxIn& txin : tx.vin) {\r\n-                auto it2 = m_mempool->mapTx.find(txin.prevout.hash);\r\n-                if (it2 != m_mempool->mapTx.end())\r\n-                    continue;\r\n-                const Coin& coin{CoinsTip().AccessCoin(txin.prevout)};\r\n-                assert(!coin.IsSpent());\r\n-                const auto mempool_spend_height{m_chain.Tip()->nHeight + 1};\r\n-                if (coin.IsCoinBase() && mempool_spend_height - coin.nHeight < COINBASE_MATURITY) {\r\n-                    return true;\r\n-                }\r\n+    // If the transaction spends any coinbase outputs, it must be mature.\r\n+    if (it->GetSpendsCoinbase()) {\r\n+        for (const CTxIn& txin : tx.vin) {\r\n+            auto it2 = m_mempool->mapTx.find(txin.prevout.hash);\r\n+            if (it2 != m_mempool->mapTx.end())\r\n+                continue;\r\n+            const Coin& coin{CoinsTip().AccessCoin(txin.prevout)};\r\n+            assert(!coin.IsSpent());\r\n+            const auto mempool_spend_height{m_chain.Tip()->nHeight + 1};\r\n+            if (coin.IsCoinBase() && mempool_spend_height - coin.nHeight < COINBASE_MATURITY) {\r\n+                return false;\r\n             }\r\n         }\r\n-        // Transaction is still valid and cached LockPoints are updated.\r\n-        return false;\r\n-    };\r\n-\r\n-    // We also need to remove any now-immature transactions\r\n-    m_mempool->removeForReorg(m_chain, filter_final_and_mature);\r\n-    // Re-limit mempool size, in case we added any transactions\r\n-    LimitMempoolSize(*m_mempool, this->CoinsTip());\r\n+    }\r\n+    // Transaction is still valid and cached LockPoints are updated.\r\n+    return true;\r\n }\r\n \r\n /**\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex bd6f710d1..52f1ee66f 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -291,6 +291,7 @@ std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\r\n  * passed in for evaluation.\r\n  * The LockPoints should not be considered valid if CheckSequenceLocksAtTip returns false.\r\n  */\r\n+\r\n bool CheckSequenceLocksAtTip(CBlockIndex* tip,\r\n                              const LockPoints& lp);\r\n \r\n@@ -770,6 +771,8 @@ private:\r\n         DisconnectedBlockTransactions& disconnectpool,\r\n         bool fAddToMempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, m_mempool->cs);\r\n \r\n+    bool IsTxFinalAndMature(CTxMemPool::txiter it) EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main);\r\n+\r\n     /** Check warning conditions and do some notifications on new chain tip set. */\r\n     void UpdateTip(const CBlockIndex* pindexNew)\r\n         EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n```\r\n</details>",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-10T12:44:42Z",
      "diff_hunk" : "@@ -334,20 +336,23 @@ void Chainstate::MaybeUpdateMempoolForReorg(\n \n         // The transaction must be final.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019055149",
      "id" : 1019055149,
      "line" : 349,
      "node_id" : "PRRC_kwDOABII5848vYwt",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 349,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 149,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019055149/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019055149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019316926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019316926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since we're doing the `.has_value()` check at quite a distance from here, I think it's safer to use `.value()` for robustness with future refactoring.\r\n\r\n```suggestion\r\n            fSpendsCoinbase, nSigOpsCost, lock_points.value()));\r\n```",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-10T15:50:36Z",
      "diff_hunk" : "@@ -827,7 +832,7 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     }\n \n     entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n-            fSpendsCoinbase, nSigOpsCost, lp));\n+            fSpendsCoinbase, nSigOpsCost, *lock_points));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019316926",
      "id" : 1019316926,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848wYq-",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 835,
      "original_position" : 195,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019316926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019316926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019330546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019330546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This documentation now seems out of date",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-10T16:01:45Z",
      "diff_hunk" : "@@ -271,17 +271,28 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n  *                              mempool and chainstate UTXO set. In the latter case, the caller is\n  *                              responsible for holding the appropriate locks to ensure that\n  *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for\n+ *          calculation, or std::nullopt if there is an error.\n+ */\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx);\n+\n+/**\n+ * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * @param[in]   tip             Chain tip to check tx sequence locks against. For example,\n+ *                              the tip of the current active chain.\n+ * @param[in]   lp              LockPoints containing the height and time at which this\n+ *                              transaction is final.\n  * Simulates calling SequenceLocks() with data from the tip passed in.\n  * Optionally stores in LockPoints the resulting height and time calculated and the hash\n  * of the block needed for calculation or skips the calculation and uses the LockPoints\n  * passed in for evaluation.\n  * The LockPoints should not be considered valid if CheckSequenceLocksAtTip returns false.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019330546",
      "id" : 1019330546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848wb_y",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 290,
      "original_position" : 31,
      "original_start_line" : 288,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019330546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019330546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019387478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019387478"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Alternative approach using `replace_if` and `max_element`\r\n```suggestion\r\n    // Set heights of mempool inputs to 0 since we'll fail if they had non-zero locks\r\n    std::replace_if(prevheights.begin(), prevheights.end(), [&index](const int height){ return height == index.nHeight; }, 0);\r\n    const auto max_input_height{*std::max_element(prevheights.begin(), prevheights.end())};\r\n```",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-10T16:51:24Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = index.nHeight;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const auto [min_height, min_time] = CalculateSequenceLocks(tx, STANDARD_LOCKTIME_VERIFY_FLAGS, prevheights, index);\n+\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // min_height and min_time from CalculateSequenceLocks against tip+1.\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != index.nHeight) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1019387478",
      "id" : 1019387478,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848wp5W",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 240,
      "original_position" : 53,
      "original_start_line" : 222,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1168761942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019387478/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-10T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019387478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1034988814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034988814"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@hebasto I think we don't modify LockPoints anymore?\r\n\r\n```\r\n * Optionally stores in LockPoints the resulting height and time calculated and the hash\r\n * of the block needed for calculation or skips the calculation and uses the LockPoints\r\n * passed in for evaluation.\r\n```",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T16:34:30Z",
      "diff_hunk" : "@@ -271,17 +271,28 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n  *                              mempool and chainstate UTXO set. In the latter case, the caller is\n  *                              responsible for holding the appropriate locks to ensure that\n  *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for\n+ *          calculation, or std::nullopt if there is an error.\n+ */\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx);\n+\n+/**\n+ * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * @param[in]   tip             Chain tip to check tx sequence locks against. For example,\n+ *                              the tip of the current active chain.\n+ * @param[in]   lp              LockPoints containing the height and time at which this\n+ *                              transaction is final.\n  * Simulates calling SequenceLocks() with data from the tip passed in.\n  * Optionally stores in LockPoints the resulting height and time calculated and the hash\n  * of the block needed for calculation or skips the calculation and uses the LockPoints\n  * passed in for evaluation.\n  * The LockPoints should not be considered valid if CheckSequenceLocksAtTip returns false.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1034988814",
      "id" : 1034988814,
      "in_reply_to_id" : 1019330546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sK0O",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 290,
      "original_position" : 31,
      "original_start_line" : 288,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1197903628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034988814/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-29T16:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034988814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035006479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035006479"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@hebasto I believe my comment was aimed at that I couldn't find any connection between `SequenceLocks()` and `ConnectBlock()` and this function - but maybe I just missed it? I also don't really understand what the documentation means, but maybe that's just my lack of context.",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T16:48:37Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035006479",
      "id" : 1035006479,
      "in_reply_to_id" : 1014172199,
      "line" : 214,
      "node_id" : "PRRC_kwDOABII5849sPIP",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 214,
      "original_position" : 13,
      "original_start_line" : 187,
      "path" : "src/validation.cpp",
      "position" : 39,
      "pull_request_review_id" : 1197935072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035006479/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 213,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-29T16:48:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035006479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated ed2d714bd1130291a2f781e644f787d421cdf26e -> 1636bc465fd96b9561de3dd21bed7f989f409de1 ([pr23897.09](https://github.com/hebasto/bitcoin/commits/pr23897.09) -> [pr23897.10](https://github.com/hebasto/bitcoin/commits/pr23897.10), [diff](https://github.com/hebasto/bitcoin/compare/pr23897.09..pr23897.10)):\r\n\r\n- addressed some of @stickies-v's comments",
      "created_at" : "2022-11-29T16:55:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1330960296",
      "id" : 1330960296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585PVNeo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330960296/reactions"
      },
      "updated_at" : "2022-11-29T16:55:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330960296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035019041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035019041"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Going to leave it as this to keep this PR in more reviewable state.",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T16:57:04Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = index.nHeight;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const auto [min_height, min_time] = CalculateSequenceLocks(tx, STANDARD_LOCKTIME_VERIFY_FLAGS, prevheights, index);\n+\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // min_height and min_time from CalculateSequenceLocks against tip+1.\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != index.nHeight) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035019041",
      "id" : 1035019041,
      "in_reply_to_id" : 1019387478,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sSMh",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 240,
      "original_position" : 53,
      "original_start_line" : 222,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197950219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035019041/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-29T16:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035019041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035019932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035019932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1330960296).",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T16:57:40Z",
      "diff_hunk" : "@@ -271,17 +271,28 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n  *                              mempool and chainstate UTXO set. In the latter case, the caller is\n  *                              responsible for holding the appropriate locks to ensure that\n  *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for\n+ *          calculation, or std::nullopt if there is an error.\n+ */\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx);\n+\n+/**\n+ * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * @param[in]   tip             Chain tip to check tx sequence locks against. For example,\n+ *                              the tip of the current active chain.\n+ * @param[in]   lp              LockPoints containing the height and time at which this\n+ *                              transaction is final.\n  * Simulates calling SequenceLocks() with data from the tip passed in.\n  * Optionally stores in LockPoints the resulting height and time calculated and the hash\n  * of the block needed for calculation or skips the calculation and uses the LockPoints\n  * passed in for evaluation.\n  * The LockPoints should not be considered valid if CheckSequenceLocksAtTip returns false.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035019932",
      "id" : 1035019932,
      "in_reply_to_id" : 1019330546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sSac",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 290,
      "original_position" : 31,
      "original_start_line" : 288,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1197951214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035019932/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-29T16:57:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035019932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035020407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035020407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1330960296).",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T16:58:00Z",
      "diff_hunk" : "@@ -827,7 +832,7 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     }\n \n     entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n-            fSpendsCoinbase, nSigOpsCost, lp));\n+            fSpendsCoinbase, nSigOpsCost, *lock_points));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035020407",
      "id" : 1035020407,
      "in_reply_to_id" : 1019316926,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sSh3",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 835,
      "original_position" : 195,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197951746,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035020407/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035020407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035023874"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035023874"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Going to leave it as this to keep this PR in more reviewable state.",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T17:00:27Z",
      "diff_hunk" : "@@ -334,20 +336,23 @@ void Chainstate::MaybeUpdateMempoolForReorg(\n \n         // The transaction must be final.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035023874",
      "id" : 1035023874,
      "in_reply_to_id" : 1019055149,
      "line" : 349,
      "node_id" : "PRRC_kwDOABII5849sTYC",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 349,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 149,
      "pull_request_review_id" : 1197956080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035023874/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T17:00:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035023874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035025491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035025491"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This change could be considered as a behavior change, so leaving it for now.",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T17:01:49Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035025491",
      "id" : 1035025491,
      "in_reply_to_id" : 1019009977,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sTxT",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 199,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197958354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035025491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T17:01:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035025491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035026097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035026097"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1330960296).",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T17:02:14Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = index.nHeight;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const auto [min_height, min_time] = CalculateSequenceLocks(tx, STANDARD_LOCKTIME_VERIFY_FLAGS, prevheights, index);\n+\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // min_height and min_time from CalculateSequenceLocks against tip+1.\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != index.nHeight) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }\n+\n+    // tip->GetAncestor(max_input_height) should never return a nullptr\n+    // because max_input_height is always less than the tip height.\n+    // It would, however, be a bad bug to continue execution, since a\n+    // LockPoints object with the maxInputBlock member set to nullptr\n+    // signifies no relative lock time.\n+    return LockPoints{min_height, min_time, Assert(tip->GetAncestor(max_input_height))};\n+}\n+\n bool CheckSequenceLocksAtTip(CBlockIndex* tip,\n-                        const CCoinsView& coins_view,\n-                        const CTransaction& tx,\n-                        LockPoints* lp,\n-                        bool useExistingLockPoints)\n+                             const LockPoints& lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035026097",
      "id" : 1035026097,
      "in_reply_to_id" : 1014254885,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sT6x",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 239,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197959153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035026097/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T17:02:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035026097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035026291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035026291"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1330960296).",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-29T17:02:24Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, txinIndex, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = index.nHeight;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035026291",
      "id" : 1035026291,
      "in_reply_to_id" : 1014250449,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sT9z",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 207,
      "original_position" : 32,
      "original_start_line" : 193,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197959451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035026291/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-29T17:02:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035026291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035746310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035746310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1330960296).",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-30T09:45:29Z",
      "diff_hunk" : "@@ -271,17 +271,28 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n  *                              mempool and chainstate UTXO set. In the latter case, the caller is\n  *                              responsible for holding the appropriate locks to ensure that\n  *                              calls to GetCoin() return correct coins.\n+ *\n+ * @returns The resulting height and time calculated and the hash of the block needed for\n+ *          calculation, or std::nullopt if there is an error.\n+ */\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035746310",
      "id" : 1035746310,
      "in_reply_to_id" : 1013836315,
      "line" : 281,
      "node_id" : "PRRC_kwDOABII5849vDwG",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 281,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 20,
      "pull_request_review_id" : 1198999325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035746310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T09:45:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035746310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035747169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035747169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Going to leave it as this to keep this PR in more reviewable state.",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-30T09:46:19Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035747169",
      "id" : 1035747169,
      "in_reply_to_id" : 1013832021,
      "line" : 209,
      "node_id" : "PRRC_kwDOABII5849vD9h",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 209,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 34,
      "pull_request_review_id" : 1199000641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035747169/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T09:46:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035747169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035747731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035747731"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1330960296).",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-30T09:46:49Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035747731",
      "id" : 1035747731,
      "in_reply_to_id" : 1013262598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849vEGT",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 185,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1199001465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035747731/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T09:46:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035747731",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035749500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035749500"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Going to leave it as this because the suggested diff won't work.",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-11-30T09:48:23Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1035749500",
      "id" : 1035749500,
      "in_reply_to_id" : 1003352551,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849vEh8",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 194,
      "original_position" : 19,
      "original_start_line" : 193,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1199003964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035749500/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-30T09:48:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035749500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038110013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038110013"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this function would benefit from a docstring",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-12-02T12:46:40Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038110013",
      "id" : 1038110013,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII58494E09",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 180,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 1202450255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038110013/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:16:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038110013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038112302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038112302"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "any reason not to pass a reference here?\r\n```suggestion\r\n    const CBlockIndex& next_tip,\r\n```",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-12-02T12:49:40Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038112302",
      "id" : 1038112302,
      "line" : 181,
      "node_id" : "PRRC_kwDOABII58494FYu",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 181,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 1202450255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038112302/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:16:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038112302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038113556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038113556"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n    auto prev_heights{CalculatePrevHeights(next_tip, coins_view, tx)};\r\n```",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-12-02T12:51:19Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,\n+    const CCoinsView& coins,\n+    const CTransaction& tx)\n+{\n+    std::vector<int> prev_heights;\n+    prev_heights.resize(tx.vin.size());\n+    for (size_t i = 0; i < tx.vin.size(); ++i) {\n+        const CTxIn& txin = tx.vin[i];\n+        Coin coin;\n+        if (!coins.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, i, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prev_heights[i] = next_tip.nHeight;\n+        } else {\n+            prev_heights[i] = coin.nHeight;\n+        }\n+    }\n+    return prev_heights;\n+}\n+} // namespace\n+\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex next_tip;\n+    next_tip.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    next_tip.nHeight = tip->nHeight + 1;\n+\n+    auto prev_heights = CalculatePrevHeights(next_tip, coins_view, tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038113556",
      "id" : 1038113556,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII58494FsU",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 219,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 44,
      "pull_request_review_id" : 1202450255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038113556/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:16:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038113556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038118675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038118675"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`util::Result` would be a good candidate here too, so you can propagate the error message back",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-12-02T12:57:50Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,\n+    const CCoinsView& coins,\n+    const CTransaction& tx)\n+{\n+    std::vector<int> prev_heights;\n+    prev_heights.resize(tx.vin.size());\n+    for (size_t i = 0; i < tx.vin.size(); ++i) {\n+        const CTxIn& txin = tx.vin[i];\n+        Coin coin;\n+        if (!coins.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, i, tx.GetHash().GetHex());\n+            return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038118675",
      "id" : 1038118675,
      "line" : 192,
      "node_id" : "PRRC_kwDOABII58494G8T",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 192,
      "original_position" : 17,
      "original_start_line" : 191,
      "path" : "src/validation.cpp",
      "position" : 17,
      "pull_request_review_id" : 1202450255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038118675/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 191,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-02T16:16:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038118675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038787782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038787782"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-auto:\r\n\r\n> **Exception** Avoid `auto` for initializer lists and in cases where you know exactly which type you want and where an initializer might require conversion.",
      "commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "created_at" : "2022-12-03T14:52:40Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,\n+    const CCoinsView& coins,\n+    const CTransaction& tx)\n+{\n+    std::vector<int> prev_heights;\n+    prev_heights.resize(tx.vin.size());\n+    for (size_t i = 0; i < tx.vin.size(); ++i) {\n+        const CTxIn& txin = tx.vin[i];\n+        Coin coin;\n+        if (!coins.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, i, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prev_heights[i] = next_tip.nHeight;\n+        } else {\n+            prev_heights[i] = coin.nHeight;\n+        }\n+    }\n+    return prev_heights;\n+}\n+} // namespace\n+\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex next_tip;\n+    next_tip.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    next_tip.nHeight = tip->nHeight + 1;\n+\n+    auto prev_heights = CalculatePrevHeights(next_tip, coins_view, tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038787782",
      "id" : 1038787782,
      "in_reply_to_id" : 1038113556,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII58496qTG",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 219,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 44,
      "pull_request_review_id" : 1203475251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038787782/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-03T14:52:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038787782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038798137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038798137"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why? The error message is being logged, and it is not exposed to a user in any other way.\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/cac29f5cd66f005ce65edd697990d495a904a1f1/src/util/result.h#L22-L26\r\n\r\nIf I missed your point, what are benefits of propagating the error message back?",
      "commit_id" : "63d6b9a9f067b81fed6029099a4643996e8d274b",
      "created_at" : "2022-12-03T15:32:35Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,\n+    const CCoinsView& coins,\n+    const CTransaction& tx)\n+{\n+    std::vector<int> prev_heights;\n+    prev_heights.resize(tx.vin.size());\n+    for (size_t i = 0; i < tx.vin.size(); ++i) {\n+        const CTxIn& txin = tx.vin[i];\n+        Coin coin;\n+        if (!coins.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, i, tx.GetHash().GetHex());\n+            return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038798137",
      "id" : 1038798137,
      "in_reply_to_id" : 1038118675,
      "line" : 196,
      "node_id" : "PRRC_kwDOABII58496s05",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 196,
      "original_position" : 17,
      "original_start_line" : 191,
      "path" : "src/validation.cpp",
      "position" : 27,
      "pull_request_review_id" : 1203492408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038798137/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 195,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-03T15:32:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038798137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 1636bc465fd96b9561de3dd21bed7f989f409de1 -> 63d6b9a9f067b81fed6029099a4643996e8d274b ([pr23897.10](https://github.com/hebasto/bitcoin/commits/pr23897.10) -> [pr23897.11](https://github.com/hebasto/bitcoin/commits/pr23897.11)):\r\n\r\n- rebased to include #17786.\r\n- addressed more @stickies-v's comments",
      "created_at" : "2022-12-03T16:16:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1336191549",
      "id" : 1336191549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585PpKo9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336191549/reactions"
      },
      "updated_at" : "2022-12-03T16:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336191549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038804170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038804170"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1336191549).",
      "commit_id" : "63d6b9a9f067b81fed6029099a4643996e8d274b",
      "created_at" : "2022-12-03T16:17:04Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038804170",
      "id" : 1038804170,
      "in_reply_to_id" : 1038110013,
      "line" : 184,
      "node_id" : "PRRC_kwDOABII58496uTK",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 184,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 1203499316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038804170/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-03T16:17:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038804170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038804177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038804177"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1336191549).",
      "commit_id" : "63d6b9a9f067b81fed6029099a4643996e8d274b",
      "created_at" : "2022-12-03T16:17:16Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038804177",
      "id" : 1038804177,
      "in_reply_to_id" : 1038112302,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58496uTR",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 181,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1203499330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038804177/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-03T16:17:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038804177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1072415053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072415053"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Correct me if I'm wrong, but I don't think this applies here. The recommendation you reference is if the type is not specified, e.g. `auto i{1}`. In this case, `CalculatePrevHeights()` has a well defined return type, so list initialization seems appropriate.",
      "commit_id" : "68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2",
      "created_at" : "2023-01-17T16:16:16Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,\n+    const CCoinsView& coins,\n+    const CTransaction& tx)\n+{\n+    std::vector<int> prev_heights;\n+    prev_heights.resize(tx.vin.size());\n+    for (size_t i = 0; i < tx.vin.size(); ++i) {\n+        const CTxIn& txin = tx.vin[i];\n+        Coin coin;\n+        if (!coins.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, i, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prev_heights[i] = next_tip.nHeight;\n+        } else {\n+            prev_heights[i] = coin.nHeight;\n+        }\n+    }\n+    return prev_heights;\n+}\n+} // namespace\n+\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex next_tip;\n+    next_tip.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    next_tip.nHeight = tip->nHeight + 1;\n+\n+    auto prev_heights = CalculatePrevHeights(next_tip, coins_view, tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1072415053",
      "id" : 1072415053,
      "in_reply_to_id" : 1038113556,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_68FN",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 224,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1251894944,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072415053/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T16:16:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072415053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1072423517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072423517"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same reason we want to let the callsite decide how to handle what to do when the calculation failed: with `util::Result`, the callsite can also decide if they want to log the error or not. In this case, there is only one callsite so it doesn't matter much. Can always refactor later on if necessary. Happy to mark as resolved, just a thought i had.",
      "commit_id" : "68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2",
      "created_at" : "2023-01-17T16:22:42Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,\n+    const CCoinsView& coins,\n+    const CTransaction& tx)\n+{\n+    std::vector<int> prev_heights;\n+    prev_heights.resize(tx.vin.size());\n+    for (size_t i = 0; i < tx.vin.size(); ++i) {\n+        const CTxIn& txin = tx.vin[i];\n+        Coin coin;\n+        if (!coins.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, i, tx.GetHash().GetHex());\n+            return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1072423517",
      "id" : 1072423517,
      "in_reply_to_id" : 1038118675,
      "line" : 196,
      "node_id" : "PRRC_kwDOABII584_6-Jd",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 196,
      "original_position" : 17,
      "original_start_line" : 191,
      "path" : "src/validation.cpp",
      "position" : 27,
      "pull_request_review_id" : 1251914867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072423517/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 195,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-17T16:22:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072423517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1072450279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072450279"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: \"check tx sequence locks\" I think should be updated to reflect that this is a pure calculation function, not a checking function?",
      "commit_id" : "68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2",
      "created_at" : "2023-01-17T16:44:51Z",
      "diff_hunk" : "@@ -245,7 +245,9 @@ PackageMempoolAcceptResult ProcessNewPackage(Chainstate& active_chainstate, CTxM\n bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction& tx) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n /**\n- * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * Calculate LockPoints required to check if transaction will be BIP68 final in the next block\n+ * to be created on top of tip.\n+ *\n  * @param[in]   tip             Chain tip to check tx sequence locks against. For example,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1072450279",
      "id" : 1072450279,
      "line" : 251,
      "node_id" : "PRRC_kwDOABII584_7Ern",
      "original_commit_id" : "68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2",
      "original_line" : 251,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 8,
      "pull_request_review_id" : 1251989292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072450279/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T18:22:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072450279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1090515974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1090515974"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "E.g. \"Chain tip to check tx sequence locks against.\" -> \"Chain tip for which tx sequence locks are calculated.\"",
      "commit_id" : "68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2",
      "created_at" : "2023-01-30T11:42:20Z",
      "diff_hunk" : "@@ -245,7 +245,9 @@ PackageMempoolAcceptResult ProcessNewPackage(Chainstate& active_chainstate, CTxM\n bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction& tx) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n /**\n- * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * Calculate LockPoints required to check if transaction will be BIP68 final in the next block\n+ * to be created on top of tip.\n+ *\n  * @param[in]   tip             Chain tip to check tx sequence locks against. For example,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1090515974",
      "id" : 1090515974,
      "in_reply_to_id" : 1072450279,
      "line" : 251,
      "node_id" : "PRRC_kwDOABII585A__QG",
      "original_commit_id" : "68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2",
      "original_line" : 251,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 8,
      "pull_request_review_id" : 1274998823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1090515974/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-30T11:42:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1090515974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1091927969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091927969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I couldn't find any connection between `SequenceLocks()` and `ConnectBlock()` and this function - but maybe I just missed it?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/357d750cab5221695d718e6d3e8ce63fa2b5ab3a/src/validation.cpp#L2257",
      "commit_id" : "75db62ba4cae048e742ca02dc6a52b3b3d6727de",
      "created_at" : "2023-01-31T13:30:04Z",
      "diff_hunk" : "@@ -176,11 +176,67 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1091927969",
      "id" : 1091927969,
      "in_reply_to_id" : 1014172199,
      "line" : 222,
      "node_id" : "PRRC_kwDOABII585BFX-h",
      "original_commit_id" : "ed2d714bd1130291a2f781e644f787d421cdf26e",
      "original_line" : 222,
      "original_position" : 13,
      "original_start_line" : 187,
      "path" : "src/validation.cpp",
      "position" : 53,
      "pull_request_review_id" : 1277183174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091927969/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 221,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-31T13:30:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091927969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2 -> 75db62ba4cae048e742ca02dc6a52b3b3d6727de ([pr23897.12](https://github.com/hebasto/bitcoin/commits/pr23897.12) -> [pr23897.13](https://github.com/hebasto/bitcoin/commits/pr23897.13), [diff](https://github.com/hebasto/bitcoin/compare/pr23897.12..pr23897.13)).\r\n\r\nAddressed some of @stickies-v's comments:\r\n- https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1038113556\r\n- https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1072450279",
      "created_at" : "2023-01-31T13:35:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1410369444",
      "id" : 1410369444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585UEIek",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410369444/reactions"
      },
      "updated_at" : "2023-01-31T13:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410369444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1091935249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091935249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1410369444).",
      "commit_id" : "75db62ba4cae048e742ca02dc6a52b3b3d6727de",
      "created_at" : "2023-01-31T13:36:32Z",
      "diff_hunk" : "@@ -245,7 +245,9 @@ PackageMempoolAcceptResult ProcessNewPackage(Chainstate& active_chainstate, CTxM\n bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction& tx) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n /**\n- * Check if transaction will be BIP68 final in the next block to be created on top of tip.\n+ * Calculate LockPoints required to check if transaction will be BIP68 final in the next block\n+ * to be created on top of tip.\n+ *\n  * @param[in]   tip             Chain tip to check tx sequence locks against. For example,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1091935249",
      "id" : 1091935249,
      "in_reply_to_id" : 1072450279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BFZwR",
      "original_commit_id" : "68c0f16fa2a41d6a25361f0bfa0b74ac5c8c43e2",
      "original_line" : 251,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1277194344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091935249/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-31T13:36:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091935249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1091935665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091935665"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1410369444).",
      "commit_id" : "75db62ba4cae048e742ca02dc6a52b3b3d6727de",
      "created_at" : "2023-01-31T13:36:52Z",
      "diff_hunk" : "@@ -176,11 +176,79 @@ bool CheckFinalTxAtTip(const CBlockIndex& active_chain_tip, const CTransaction&\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+namespace {\n+std::optional<std::vector<int>> CalculatePrevHeights(\n+    const CBlockIndex next_tip,\n+    const CCoinsView& coins,\n+    const CTransaction& tx)\n+{\n+    std::vector<int> prev_heights;\n+    prev_heights.resize(tx.vin.size());\n+    for (size_t i = 0; i < tx.vin.size(); ++i) {\n+        const CTxIn& txin = tx.vin[i];\n+        Coin coin;\n+        if (!coins.GetCoin(txin.prevout, coin)) {\n+            LogPrintf(\"ERROR: %s: Missing input %d in transaction \\'%s\\'\\n\", __func__, i, tx.GetHash().GetHex());\n+            return std::nullopt;\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prev_heights[i] = next_tip.nHeight;\n+        } else {\n+            prev_heights[i] = coin.nHeight;\n+        }\n+    }\n+    return prev_heights;\n+}\n+} // namespace\n+\n+std::optional<LockPoints> CalculateLockPointsAtTip(CBlockIndex* tip,\n+                                                   const CCoinsView& coins_view,\n+                                                   const CTransaction& tx)\n+{\n+    assert(tip);\n+\n+    CBlockIndex next_tip;\n+    next_tip.pprev = tip;\n+    // When SequenceLocks() is called within ConnectBlock(), the height\n+    // of the block *being* evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    next_tip.nHeight = tip->nHeight + 1;\n+\n+    auto prev_heights = CalculatePrevHeights(next_tip, coins_view, tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r1091935665",
      "id" : 1091935665,
      "in_reply_to_id" : 1038113556,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BFZ2x",
      "original_commit_id" : "1636bc465fd96b9561de3dd21bed7f989f409de1",
      "original_line" : 224,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1277194969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091935665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-31T13:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091935665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
