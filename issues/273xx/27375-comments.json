[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27375).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1976336383), [vasild](https://github.com/bitcoin/bitcoin/pull/27375#pullrequestreview-1921794085), [tdb3](https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1986390436), [achow101](https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1992240831) |\n| Stale ACK | [willcl-ark](https://github.com/bitcoin/bitcoin/pull/27375#pullrequestreview-1716369031) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint by maflcko)\n* [#29015](https://github.com/bitcoin/bitcoin/pull/29015) (kernel: Streamline util library by ryanofsky)\n* [#28834](https://github.com/bitcoin/bitcoin/pull/28834) (net: attempts to connect to all resolved addresses when connecting to a node by sr-gi)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-03-30T19:29:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1490826098",
      "id" : 1490826098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585Y3DNy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1490826098/reactions"
      },
      "updated_at" : "2024-03-13T13:56:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1490826098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154121825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154121825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I'd go for `unix` here (but only because it's shorter).",
      "commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "created_at" : "2023-03-31T07:36:46Z",
      "diff_hunk" : "@@ -112,6 +112,7 @@ std::string GetNetworkName(enum Network net)\n     case NET_I2P: return \"i2p\";\n     case NET_CJDNS: return \"cjdns\";\n     case NET_INTERNAL: return \"internal\";\n+    case NET_UNIX: return \"unix_domain_socket\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154121825",
      "id" : 1154121825,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII585EyoBh",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 115,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 4,
      "pull_request_review_id" : 1366408214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154121825/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T09:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154121825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154147617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154147617"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This needs to be shorter (< 92 chars?). From `man 7 unix`:\r\n\r\n```\r\n   Pathname sockets\r\n       When binding a socket to a pathname, a few rules should be observed for maximum portability and ease of coding:\r\n\r\n       *  The pathname in sun_path should be null-terminated.\r\n\r\n       *  The length of the pathname, including the terminating null byte, should not exceed the size of sun_path.\r\n\r\n       *  The addrlen argument that describes the enclosing sockaddr_un structure should have a value of at least:\r\n\r\n              offsetof(struct sockaddr_un, sun_path)+strlen(addr.sun_path)+1\r\n\r\n          or, more simply, addrlen can be specified as sizeof(struct sockaddr_un).\r\n\r\n       There is some variation in how implementations handle UNIX domain socket addresses that do not follow the above rules.  For example, some (but not all) implementations append a null terminator if none is present in the supplied\r\n       sun_path.\r\n\r\n       When coding portable applications, keep in mind that some implementations have sun_path as short as 92 bytes.\r\n```\r\n\r\nIt probably makes most sense to check this early on in _init.cpp_?",
      "commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "created_at" : "2023-03-31T07:59:36Z",
      "diff_hunk" : "@@ -89,13 +90,22 @@ def setup_nodes(self):\n         else:\n             self.log.warning(\"Testing without local IPv6 support\")\n \n+        socket_path = os.path.join(self.options.tmpdir, \"socket_path\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154147617",
      "id" : 1154147617,
      "line" : 93,
      "node_id" : "PRRC_kwDOABII585EyuUh",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 93,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/feature_proxy.py",
      "position" : 21,
      "pull_request_review_id" : 1366408214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154147617/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T09:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154147617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154148265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154148265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "On the test this is trying to use a path `/private/var/folders/v7/fs2b0v3s0lz1n57gj9y4xb5m0000gn/T/cirrus-ci-build/ci/scratch/test_runner/test_runner_â¿_ð_20230331_010828/feature_proxy_156`...",
      "commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "created_at" : "2023-03-31T08:00:15Z",
      "diff_hunk" : "@@ -89,13 +90,22 @@ def setup_nodes(self):\n         else:\n             self.log.warning(\"Testing without local IPv6 support\")\n \n+        socket_path = os.path.join(self.options.tmpdir, \"socket_path\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154148265",
      "id" : 1154148265,
      "in_reply_to_id" : 1154147617,
      "line" : 93,
      "node_id" : "PRRC_kwDOABII585Eyuep",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 93,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/feature_proxy.py",
      "position" : 21,
      "pull_request_review_id" : 1366408214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154148265/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T09:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154148265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154156655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154156655"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wonder if this should be a `Warning` or at least an `Info` level message?",
      "commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "created_at" : "2023-03-31T08:08:57Z",
      "diff_hunk" : "@@ -524,8 +524,10 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n         } else if (use_proxy) {\n             sock = CreateSock(proxy.proxy);\n             if (!sock) {\n+                LogPrintLevel(BCLog::PROXY, BCLog::Level::Debug, \"Failed to create socket to proxy: %s\\n\", proxy.proxy.ToStringAddr());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154156655",
      "id" : 1154156655,
      "line" : 527,
      "node_id" : "PRRC_kwDOABII585Eywhv",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 527,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 1366408214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154156655/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T09:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154156655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154205583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154205583"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Im curious why you didn't enable it for `-onion` here, as it seems a compartiviely small addtion:\r\n\r\n```diff\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex c0a320136..53b6b2a4b 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -1283,8 +1283,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n             std::string host_out;\r\n             uint16_t port_out{0};\r\n             if (!SplitHostPort(socket_addr, port_out, host_out)) {\r\n-                // Allow unix domain sockets for proxy e.g. unix:/some/file/path\r\n-                if (port_option != \"-proxy\" || socket_addr.find(ADDR_PREFIX_UNIX) != 0) {\r\n+                // Allow unix domain sockets for -proxy and -onion e.g. unix:/some/file/path\r\n+                if ((port_option != \"-proxy\" || port_option != \"-onion\") || socket_addr.find(ADDR_PREFIX_UNIX) != 0) {\r\n                     return InitError(InvalidPortErrMsg(port_option, socket_addr));\r\n                 }\r\n             }\r\n```",
      "commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "created_at" : "2023-03-31T08:48:07Z",
      "diff_hunk" : "@@ -1283,7 +1283,10 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             std::string host_out;\n             uint16_t port_out{0};\n             if (!SplitHostPort(socket_addr, port_out, host_out)) {\n-                return InitError(InvalidPortErrMsg(port_option, socket_addr));\n+                // Allow unix domain sockets for proxy e.g. unix:/some/file/path\n+                if (port_option != \"-proxy\" || socket_addr.find(ADDR_PREFIX_UNIX) != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154205583",
      "id" : 1154205583,
      "line" : 1287,
      "node_id" : "PRRC_kwDOABII585Ey8eP",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 1287,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 1366408214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154205583/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T09:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154205583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154738130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154738130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To literally answer your question: I was not clear on what `-onion` actually does! Now I do, adding this in next update.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-03-31T17:41:21Z",
      "diff_hunk" : "@@ -1283,7 +1283,10 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             std::string host_out;\n             uint16_t port_out{0};\n             if (!SplitHostPort(socket_addr, port_out, host_out)) {\n-                return InitError(InvalidPortErrMsg(port_option, socket_addr));\n+                // Allow unix domain sockets for proxy e.g. unix:/some/file/path\n+                if (port_option != \"-proxy\" || socket_addr.find(ADDR_PREFIX_UNIX) != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154738130",
      "id" : 1154738130,
      "in_reply_to_id" : 1154205583,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585E0-fS",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 1287,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1367343663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154738130/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T18:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154738130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154739487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154739487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I only added this for my own debugging, we could even just take it out. There is also a \"proxy failed to initialize\" error message in `Socks5()` which will get thrown by `ConnectThroughProxy()` below.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-03-31T17:43:05Z",
      "diff_hunk" : "@@ -524,8 +524,10 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n         } else if (use_proxy) {\n             sock = CreateSock(proxy.proxy);\n             if (!sock) {\n+                LogPrintLevel(BCLog::PROXY, BCLog::Level::Debug, \"Failed to create socket to proxy: %s\\n\", proxy.proxy.ToStringAddr());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154739487",
      "id" : 1154739487,
      "in_reply_to_id" : 1154156655,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585E0-0f",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 527,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1367343663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154739487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T18:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154739487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154739870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154739870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "agreed, updated.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-03-31T17:43:37Z",
      "diff_hunk" : "@@ -112,6 +112,7 @@ std::string GetNetworkName(enum Network net)\n     case NET_I2P: return \"i2p\";\n     case NET_CJDNS: return \"cjdns\";\n     case NET_INTERNAL: return \"internal\";\n+    case NET_UNIX: return \"unix_domain_socket\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154739870",
      "id" : 1154739870,
      "in_reply_to_id" : 1154121825,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585E0-6e",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 115,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1367343663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154739870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T18:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154739870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154783411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154783411"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah this one may be tricky to work around. Some of the CI temp dir paths are crazy long like that. I'm going to add an init check & test to throw on socket paths longer than 92 characters. For the sake of passing the tests, I'll try using a temp path that is in the parent of `test_runner_...` and we'll see if that is short enough to pass on the CI VMs.\r\n\r\n",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-03-31T18:36:39Z",
      "diff_hunk" : "@@ -89,13 +90,22 @@ def setup_nodes(self):\n         else:\n             self.log.warning(\"Testing without local IPv6 support\")\n \n+        socket_path = os.path.join(self.options.tmpdir, \"socket_path\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1154783411",
      "id" : 1154783411,
      "in_reply_to_id" : 1154147617,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585E1Jiz",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 93,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/feature_proxy.py",
      "position" : null,
      "pull_request_review_id" : 1367343663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154783411/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-31T18:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1154783411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-04-01T23:05:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1493164967",
      "id" : 1493164967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585Y_-On",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1493164967/reactions"
      },
      "updated_at" : "2023-04-01T23:05:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1493164967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165103364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165103364"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`CreateSock()` already logs a detailed message if it returns `nullptr`. This `LogPrintLevel()` call here is redundant.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T07:16:48Z",
      "diff_hunk" : "@@ -524,8 +524,10 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n         } else if (use_proxy) {\n             sock = CreateSock(proxy.proxy);\n             if (!sock) {\n+                LogPrintLevel(BCLog::PROXY, BCLog::Level::Debug, \"Failed to create socket to proxy: %s\\n\", proxy.proxy.ToStringAddr());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165103364",
      "id" : 1165103364,
      "in_reply_to_id" : 1154156655,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FchEE",
      "original_commit_id" : "7785e4d1796f3deb746916e6fc89f00990fb28cd",
      "original_line" : 527,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165103364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165103364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165186109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165186109"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is dangerous. Better check the size before copying (untested):\r\n\r\n```suggestion\r\n        const std::string path{fs::PathToString(m_path)};\r\n        if (sizeof(paddrun->sun_path) < path.length() + 1) {\r\n            return false;\r\n        }\r\n        memcpy(paddrun->sun_path, path.c_str(), path.length() + 1);\r\n```\r\n",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T08:28:20Z",
      "diff_hunk" : "@@ -897,6 +919,17 @@ bool CService::GetSockAddr(struct sockaddr* paddr, socklen_t *addrlen) const\n         paddrin6->sin6_port = htons(port);\n         return true;\n     }\n+#if HAVE_SOCKADDR_UN\n+    if (IsUnix()) {\n+        if (*addrlen < (socklen_t)sizeof(struct sockaddr_un))\n+            return false;\n+        struct sockaddr_un* paddrun = (struct sockaddr_un*)paddr;\n+        paddrun->sun_family = AF_UNIX;\n+        strcpy(paddrun->sun_path, fs::PathToString(m_path).c_str());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165186109",
      "id" : 1165186109,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fc1Q9",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 928,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "src/netaddress.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165186109/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165186109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165198178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165198178"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This looks wrong as `paddrun` is a pointer (`sizeof(paddrun)` will be always 8 bytes on 64 bit computers). According to https://www.man7.org/linux/man-pages/man7/unix.7.html it should be:\r\n\r\n```cpp\r\noffsetof(struct sockaddr_un, sun_path)+strlen(addr.sun_path)+1\r\n```\r\n\r\nFreeBSD has this, defined in `sys/un.h`:\r\n\r\n```cpp\r\n#define SUN_LEN(su) \\\r\n        (sizeof(*(su)) - sizeof((su)->sun_path) + strlen((su)->sun_path))\r\n```\r\n\r\nand Linux has:\r\n\r\n```cpp\r\n/* Evaluate to actual length of the `sockaddr_un' structure.  */\r\n# define SUN_LEN(ptr) ((size_t) (((struct sockaddr_un *) 0)->sun_path)        \\\r\n                      + strlen ((ptr)->sun_path))\r\n```",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T08:37:59Z",
      "diff_hunk" : "@@ -897,6 +919,17 @@ bool CService::GetSockAddr(struct sockaddr* paddr, socklen_t *addrlen) const\n         paddrin6->sin6_port = htons(port);\n         return true;\n     }\n+#if HAVE_SOCKADDR_UN\n+    if (IsUnix()) {\n+        if (*addrlen < (socklen_t)sizeof(struct sockaddr_un))\n+            return false;\n+        struct sockaddr_un* paddrun = (struct sockaddr_un*)paddr;\n+        paddrun->sun_family = AF_UNIX;\n+        strcpy(paddrun->sun_path, fs::PathToString(m_path).c_str());\n+        *addrlen = strlen(paddrun->sun_path) + sizeof(paddrun);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165198178",
      "id" : 1165198178,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fc4Ni",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 929,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/netaddress.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165198178/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165198178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165249878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165249878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Better check the actual `sun_path` on the system, and also `sun_path` is supposed to contain the terminating `'\\0'`:\r\n\r\n```suggestion\r\n        if (str.size() + 1 > sizeof(sockaddr_un::sun_path)) {\r\n            return false;\r\n        }\r\n```",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T09:16:07Z",
      "diff_hunk" : "@@ -219,6 +220,26 @@ bool Lookup(const std::string& name, CService& addr, uint16_t portDefault, bool\n     if (!ContainsNoNUL(name)) {\n         return false;\n     }\n+\n+    // unix domain socket\n+    if (name.find(ADDR_PREFIX_UNIX) == 0) {\n+        // split off \"unix:\" prefix\n+        std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+        // https://www.man7.org/linux/man-pages/man7/unix.7.html\n+        //   \"When coding portable applications, keep in mind that some\n+        //   implementations have sun_path as short as 92 bytes.\"\n+        if (str.size() > 92)\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165249878",
      "id" : 1165249878,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FdE1W",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 233,
      "original_position" : 31,
      "original_start_line" : 229,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165249878/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165249878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165255786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165255786"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "style: from `doc/developer-notes.md`:\r\n\r\n  - If an `if` only has a single-statement `then`-clause, it can appear\r\n    on the same line as the `if`, without braces. In every other case,\r\n    braces are required, and the `then` and `else` clauses must appear\r\n    correctly indented on a new line.\r\n",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T09:20:46Z",
      "diff_hunk" : "@@ -219,6 +220,26 @@ bool Lookup(const std::string& name, CService& addr, uint16_t portDefault, bool\n     if (!ContainsNoNUL(name)) {\n         return false;\n     }\n+\n+    // unix domain socket\n+    if (name.find(ADDR_PREFIX_UNIX) == 0) {\n+        // split off \"unix:\" prefix\n+        std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+        // https://www.man7.org/linux/man-pages/man7/unix.7.html\n+        //   \"When coding portable applications, keep in mind that some\n+        //   implementations have sun_path as short as 92 bytes.\"\n+        if (str.size() > 92)\n+            return false;\n+\n+        fs::path path = fs::PathFromString(str);\n+        if (!fs::exists(path))\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165255786",
      "id" : 1165255786,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FdGRq",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 237,
      "original_position" : 35,
      "original_start_line" : 236,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165255786/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165255786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165266423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165266423"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It is a bit odd to support `unix:/path/to/socket` in `Lookup()` because there is nothing to lookup in that and it is not like the other inputs supported by `Lookup()` begin with the socket type, e.g. `ipv4://1.2.3.4`.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T09:29:34Z",
      "diff_hunk" : "@@ -219,6 +220,26 @@ bool Lookup(const std::string& name, CService& addr, uint16_t portDefault, bool\n     if (!ContainsNoNUL(name)) {\n         return false;\n     }\n+\n+    // unix domain socket",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165266423",
      "id" : 1165266423,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FdI33",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 224,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165266423/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165266423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165267691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165267691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unrelated change.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T09:30:38Z",
      "diff_hunk" : "@@ -391,7 +412,7 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\n         return false;\n     }\n     if (pchRet1[0] != SOCKSVersion::SOCKS5) {\n-        return error(\"Proxy failed to initialize\");\n+        return error(\"Proxy failed to initialize.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165267691",
      "id" : 1165267691,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FdJLr",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 415,
      "original_position" : 49,
      "original_start_line" : 394,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165267691/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165267691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165281204"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165281204"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It is odd to have `CreateSockTCP()` create a non-TCP socket.\r\n\r\nAlso, the code below sets `TCP_NODELAY` on the socket which does not apply to UNIX sockets.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T09:40:58Z",
      "diff_hunk" : "@@ -493,8 +514,10 @@ std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n     }\n \n     // Create a TCP socket in the address family of the specified service.\n-    SOCKET hSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\n+    int protocol = address_family.IsUnix() ? 0 : IPPROTO_TCP;\n+    SOCKET hSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, protocol);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165281204",
      "id" : 1165281204,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FdMe0",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 518,
      "original_position" : 59,
      "original_start_line" : 516,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165281204/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165281204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165311055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165311055"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It is better to stay inside the individual test directory. This allows running multiple tests in parallel. With the above code multiple tests will collide on the common `/tmp/sockpath`.\r\n\r\n`/tmp/bitcoin_func_test_99opr6sq/socks5_proxy` is just 44 chars, should be below the limit on any platform, even if TMPDIR expands to something longer than `/tmp`.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T10:07:34Z",
      "diff_hunk" : "@@ -60,14 +63,17 @@\n # Networks returned by RPC getnetworkinfo, defined in src/rpc/net.cpp::GetNetworksInfo()\n NETWORKS = frozenset({NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS})\n \n+# Use the shortest temp path possible since socket paths have a 92-char limit\n+socket_path = os.path.join(tempfile.gettempdir(), \"sockpath\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165311055",
      "id" : 1165311055,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585FdTxP",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 67,
      "original_position" : 32,
      "original_start_line" : 66,
      "path" : "test/functional/feature_proxy.py",
      "position" : 32,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165311055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165311055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165314489"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165314489"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Given that the actual limit is platform-dependent, I would suggest to pass something really longer here, e.g. 1000 or 5000 chars.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T10:10:50Z",
      "diff_hunk" : "@@ -383,6 +437,18 @@ def networks_dict(d):\n         msg = \"Error: Unknown network specified in -onlynet: 'abc'\"\n         self.nodes[1].assert_start_raises_init_error(expected_msg=msg)\n \n+        self.log.info(\"Test passing too-long unix path to -proxy raises init error\")\n+        self.nodes[1].extra_args = [f\"-proxy=unix:{'x' * 93}\"]\n+        if self.have_unix_sockets:\n+            msg = f\"Error: Invalid -proxy address or hostname: 'unix:{'x' * 93}'\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165314489",
      "id" : 1165314489,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FdUm5",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 443,
      "original_position" : 134,
      "original_start_line" : 440,
      "path" : "test/functional/feature_proxy.py",
      "position" : null,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165314489/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165314489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165330624"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165330624"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The include is introduced in the first commit and surrounded by `#if HAVE_SOCKADDR_UN` in the second commit. This means that the first commit is not self-contained (would not compile on some platforms). Better introduce the configure check first.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T10:26:47Z",
      "diff_hunk" : "@@ -20,6 +20,10 @@\n #include <iterator>\n #include <tuple>\n \n+#if HAVE_SOCKADDR_UN\n+#include <sys/un.h>\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165330624",
      "id" : 1165330624,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII585FdYjA",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 25,
      "original_position" : 6,
      "original_start_line" : 23,
      "path" : "src/netaddress.cpp",
      "position" : 6,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165330624/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 23,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165330624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165338076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165338076"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If this approach is chosen (to extend `CNetAddr` to support unix file addresses), then it would be better to store the path in the `m_addr` member instead of introducing a new one. `m_addr` is a vector of `uint8_t` - that is generic enough to store anything in it.\r\n\r\n`sizeof(CNetAddr)` on `master` is 32 and `sizeof(fs::path)` is 24 bytes, so `CNetAddr` would become almost twice as big.",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T10:34:32Z",
      "diff_hunk" : "@@ -136,9 +143,16 @@ class CNetAddr\n      */\n     uint32_t m_scope_id{0};\n \n+    /**\n+     * Filesystem path for unix domain socket (NET_UNIX)\n+     */\n+    fs::path m_path;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165338076",
      "id" : 1165338076,
      "line" : 149,
      "node_id" : "PRRC_kwDOABII585FdaXc",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 149,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 35,
      "pull_request_review_id" : 1382786000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165338076/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T15:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165338076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165801803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165801803"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See this ci failure: https://cirrus-ci.com/task/5039125594636288?logs=ci#L2638-L2640\r\n\r\nThis is why I used a shorter path, sometimes TMPDIR is > 50 characters! You have a good point about getting max `sun_path` from the system though, maybe it will balance out\r\n\r\n```\r\nFile \"/private/var/folders/v7/fs2b0v3s0lz1n57gj9y4xb5m0000gn/T/cirrus-ci-build/ci/scratch/build/bitcoin-arm64-apple-darwin/test/functional/test_framework/socks5.py\", line 131, in __init__\r\nself.s.bind(conf.addr)\r\nOSError: AF_UNIX path too long\r\n```",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T16:55:14Z",
      "diff_hunk" : "@@ -60,14 +63,17 @@\n # Networks returned by RPC getnetworkinfo, defined in src/rpc/net.cpp::GetNetworksInfo()\n NETWORKS = frozenset({NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS})\n \n+# Use the shortest temp path possible since socket paths have a 92-char limit\n+socket_path = os.path.join(tempfile.gettempdir(), \"sockpath\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1165801803",
      "id" : 1165801803,
      "in_reply_to_id" : 1165311055,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585FfLlL",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 67,
      "original_position" : 32,
      "original_start_line" : 66,
      "path" : "test/functional/feature_proxy.py",
      "position" : 32,
      "pull_request_review_id" : 1383845487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165801803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-13T16:55:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165801803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks so much for the great review @vasild I think I addressed all your feedback up to the adding UNIX to CNetAddr. I understand your concerns there and we can chat about it, I'll look at alternatives as well. What I did do in this last push was mostly separate unix sockets from regular sockets, and adding `Proxy.GetSocket()` to decide which socket factory to call.",
      "created_at" : "2023-04-13T20:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1507577994",
      "id" : 1507577994,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585Z29CK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1507577994/reactions"
      },
      "updated_at" : "2023-04-13T20:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1507577994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166002075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166002075"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm a bit intimidated by the syntax `prevector<ADDR_IPV6_SIZE, uint8_t> m_addr{ADDR_IPV6_SIZE, 0x0};` -- is that only 16 bytes?",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-13T20:38:00Z",
      "diff_hunk" : "@@ -136,9 +143,16 @@ class CNetAddr\n      */\n     uint32_t m_scope_id{0};\n \n+    /**\n+     * Filesystem path for unix domain socket (NET_UNIX)\n+     */\n+    fs::path m_path;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166002075",
      "id" : 1166002075,
      "in_reply_to_id" : 1165338076,
      "line" : 149,
      "node_id" : "PRRC_kwDOABII585Ff8eb",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 149,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 35,
      "pull_request_review_id" : 1384170843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166002075/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T20:38:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166002075",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166712133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166712133"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I see. Then, to avoid multiple tests colliding on `/tmp/socket`, maybe this:\r\n\r\n```python\r\nsocket_path = os.path.join(tempfile.TemporaryDirectory(), \"s\")\r\n```",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-14T11:19:57Z",
      "diff_hunk" : "@@ -60,14 +63,17 @@\n # Networks returned by RPC getnetworkinfo, defined in src/rpc/net.cpp::GetNetworksInfo()\n NETWORKS = frozenset({NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS})\n \n+# Use the shortest temp path possible since socket paths have a 92-char limit\n+socket_path = os.path.join(tempfile.gettempdir(), \"sockpath\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166712133",
      "id" : 1166712133,
      "in_reply_to_id" : 1165311055,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585Fip1F",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 67,
      "original_position" : 32,
      "original_start_line" : 66,
      "path" : "test/functional/feature_proxy.py",
      "position" : 32,
      "pull_request_review_id" : 1385270065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166712133/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-14T11:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166712133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166722759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166722759"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It begins its life with 16 bytes pre-allocated (without using `new` or `malloc()`), but this is just an optimization which can be ignored. It is supposed to behave like `std::vector`.\r\n\r\nSomething like this should work to store `std::string` in it (untested):\r\n\r\n```cpp\r\nstd::string path = ...;\r\nm_addr.assign(path.begin(), path.end());\r\n```",
      "commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "created_at" : "2023-04-14T11:33:02Z",
      "diff_hunk" : "@@ -136,9 +143,16 @@ class CNetAddr\n      */\n     uint32_t m_scope_id{0};\n \n+    /**\n+     * Filesystem path for unix domain socket (NET_UNIX)\n+     */\n+    fs::path m_path;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166722759",
      "id" : 1166722759,
      "in_reply_to_id" : 1165338076,
      "line" : 149,
      "node_id" : "PRRC_kwDOABII585FisbH",
      "original_commit_id" : "44dd4cb505a4e1e7258997a9b687be59760dcdbb",
      "original_line" : 149,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 35,
      "pull_request_review_id" : 1385287222,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166722759/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-14T11:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166722759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166806386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166806386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unrelated change, I am not sure I fully understand. Is it the case that before the message was `Define this symbol to build code that uses getauxval)` and this change just fixes the message to not have a trailing `)`?",
      "commit_id" : "77c02efdf551bce0d0a1ab462dd5c5da6a2a948c",
      "created_at" : "2023-04-14T12:59:10Z",
      "diff_hunk" : "@@ -1260,10 +1260,23 @@ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n   ]], [[\n     getauxval(AT_HWCAP);\n   ]])],\n- [ AC_MSG_RESULT([yes]); HAVE_STRONG_GETAUXVAL=1; AC_DEFINE([HAVE_STRONG_GETAUXVAL], [1], [Define this symbol to build code that uses getauxval)]) ],\n+ [ AC_MSG_RESULT([yes]); HAVE_STRONG_GETAUXVAL=1; AC_DEFINE([HAVE_STRONG_GETAUXVAL], [1], [Define this symbol to build code that uses getauxval]) ],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1166806386",
      "id" : 1166806386,
      "line" : 1263,
      "node_id" : "PRRC_kwDOABII585FjA1y",
      "original_commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "original_line" : 1263,
      "original_position" : 5,
      "original_start_line" : 1263,
      "path" : "configure.ac",
      "position" : 5,
      "pull_request_review_id" : 1385416057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166806386/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1263,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-05-16T06:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166806386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1194955775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194955775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah",
      "commit_id" : "77c02efdf551bce0d0a1ab462dd5c5da6a2a948c",
      "created_at" : "2023-05-16T10:28:26Z",
      "diff_hunk" : "@@ -1260,10 +1260,23 @@ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n   ]], [[\n     getauxval(AT_HWCAP);\n   ]])],\n- [ AC_MSG_RESULT([yes]); HAVE_STRONG_GETAUXVAL=1; AC_DEFINE([HAVE_STRONG_GETAUXVAL], [1], [Define this symbol to build code that uses getauxval)]) ],\n+ [ AC_MSG_RESULT([yes]); HAVE_STRONG_GETAUXVAL=1; AC_DEFINE([HAVE_STRONG_GETAUXVAL], [1], [Define this symbol to build code that uses getauxval]) ],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1194955775",
      "id" : 1194955775,
      "in_reply_to_id" : 1166806386,
      "line" : 1263,
      "node_id" : "PRRC_kwDOABII585HOZP_",
      "original_commit_id" : "2c19dd7c1a6aaf5cf7f879ae5aa51683de2ced13",
      "original_line" : 1263,
      "original_position" : 5,
      "original_start_line" : 1263,
      "path" : "configure.ac",
      "position" : 5,
      "pull_request_review_id" : 1428254173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194955775/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1263,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-05-16T10:28:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194955775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild did an overhaul of this PR and implemented more how we discussed on IRC. Edited the description to explain. I ended up not using `std::variant` because I felt it added uneeded complexity. Current approach is `Proxy` just has a `is_unix` flag and abstracts away the `CService` methods like `IsValid()` etc to support TCP or UNIX sockets",
      "created_at" : "2023-05-26T18:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1564803705",
      "id" : 1564803705,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585dRQJ5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564803705/reactions"
      },
      "updated_at" : "2023-05-26T18:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564803705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-30T15:53:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1568681579",
      "id" : 1568681579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585dgC5r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1568681579/reactions"
      },
      "updated_at" : "2023-05-30T15:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1568681579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> ð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\r\n\r\nðº ",
      "created_at" : "2023-05-30T20:30:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1569053476",
      "id" : 1569053476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585dhdsk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1569053476/reactions"
      },
      "updated_at" : "2023-05-30T20:30:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1569053476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217480535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217480535"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The comment gives the impression that `sa_family_t` is defined on Windows (as `u_short`), but it is not defined at all (otherwise this `typedef u_short sa_family_t;` would not compile because it redefines it, right?). Maybe reword the comment to something like:\r\n\r\n```cpp\r\n// Windows does not have `sa_family_t` - it defines `sockaddr::sa_family` as `u_short`.\r\n// Thus define `sa_family_t` on Windows too so that the rest of the code can use `sa_family_t`.\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T04:55:31Z",
      "diff_hunk" : "@@ -37,6 +37,12 @@\n #include <unistd.h>\n #endif\n \n+// Linux defines sa_family_t as `unsigned short` but on Windows it's `u_short`\n+// See https://learn.microsoft.com/en-us/windows/win32/api/winsock/ns-winsock-sockaddr#syntax\n+#ifdef WIN32\n+typedef u_short sa_family_t;\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217480535",
      "id" : 1217480535,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585IkUdX",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 44,
      "original_position" : 8,
      "original_start_line" : 40,
      "path" : "src/compat/compat.h",
      "position" : 8,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217480535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 40,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217480535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217685437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217685437"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "TCP is a specific protocol ([at layer 4 in the OSI model](https://en.wikipedia.org/wiki/OSI_model)) while this refers to layer 3. Maybe rename it to something like `GetProtocolFamily()`, `GetAddressFamily()`, `GetFamily()` or `GetSAFamily()`.",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:05:08Z",
      "diff_hunk" : "@@ -529,6 +529,7 @@ class CService : public CNetAddr\n     uint16_t GetPort() const;\n     bool GetSockAddr(struct sockaddr* paddr, socklen_t* addrlen) const;\n     bool SetSockAddr(const struct sockaddr* paddr);\n+    [[nodiscard]] sa_family_t GetTCPFamily() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217685437",
      "id" : 1217685437,
      "line" : 532,
      "node_id" : "PRRC_kwDOABII585IlGe9",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 532,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 4,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217685437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217685437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217688663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217688663"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        return AF_UNSPEC;\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:07:51Z",
      "diff_hunk" : "@@ -843,6 +843,19 @@ bool CService::SetSockAddr(const struct sockaddr *paddr)\n     }\n }\n \n+sa_family_t CService::GetTCPFamily() const\n+{\n+    switch (m_net) {\n+    case NET_IPV4:\n+        return AF_INET;\n+    case NET_IPV6:\n+        return AF_INET6;\n+    default:\n+        return AF_UNSPEC; // Not TCP",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217688663",
      "id" : 1217688663,
      "line" : 854,
      "node_id" : "PRRC_kwDOABII585IlHRX",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 854,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/netaddress.cpp",
      "position" : 12,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217688663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217688663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217689114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217689114"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unnecessary empty line.",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:08:14Z",
      "diff_hunk" : "@@ -843,6 +843,19 @@ bool CService::SetSockAddr(const struct sockaddr *paddr)\n     }\n }\n \n+sa_family_t CService::GetTCPFamily() const\n+{\n+    switch (m_net) {\n+    case NET_IPV4:\n+        return AF_INET;\n+    case NET_IPV6:\n+        return AF_INET6;\n+    default:\n+        return AF_UNSPEC; // Not TCP\n+    }\n+\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217689114",
      "id" : 1217689114,
      "line" : 857,
      "node_id" : "PRRC_kwDOABII585IlHYa",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 857,
      "original_position" : 15,
      "original_start_line" : 855,
      "path" : "src/netaddress.cpp",
      "position" : 15,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217689114/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 855,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217689114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217692250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217692250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`CService::GetSockAddr()` treats CJDNS as IPv6. So:\r\n```suggestion\r\n    case NET_IPV6:\r\n    case NET_CJDNS:\r\n        return AF_INET6;\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:10:57Z",
      "diff_hunk" : "@@ -843,6 +843,19 @@ bool CService::SetSockAddr(const struct sockaddr *paddr)\n     }\n }\n \n+sa_family_t CService::GetTCPFamily() const\n+{\n+    switch (m_net) {\n+    case NET_IPV4:\n+        return AF_INET;\n+    case NET_IPV6:\n+        return AF_INET6;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217692250",
      "id" : 1217692250,
      "line" : 852,
      "node_id" : "PRRC_kwDOABII585IlIJa",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 852,
      "original_position" : 10,
      "original_start_line" : 851,
      "path" : "src/netaddress.cpp",
      "position" : 10,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217692250/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 851,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217692250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217700884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217700884"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`sa_family_t` is cheap to copy. No need to pass it as a const reference:\r\n\r\n```cpp\r\nstd::unique_ptr<Sock> CreateSockOS(sa_family_t address_family);\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:17:13Z",
      "diff_hunk" : "@@ -178,16 +209,16 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault = 0, DNSLoo\n bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out);\n \n /**\n- * Create a TCP socket in the given address family.\n+ * Create a TCP or UNIX socket in the given address family.\n  * @param[in] address_family The socket is created in the same address family as this address.\n  * @return pointer to the created Sock object or unique_ptr that owns nothing in case of failure\n  */\n-std::unique_ptr<Sock> CreateSockTCP(const CService& address_family);\n+std::unique_ptr<Sock> CreateSockOS(const sa_family_t& address_family);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217700884",
      "id" : 1217700884,
      "line" : 216,
      "node_id" : "PRRC_kwDOABII585IlKQU",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 216,
      "original_position" : 69,
      "original_start_line" : 185,
      "path" : "src/netbase.h",
      "position" : 69,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217700884/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 185,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217700884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217719465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217719465"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "All tuning that happens to the socket below in this function seems relevant to UNIX sockets too, except `TCP_NODELAY`.\r\n\r\n```diff\r\n--- i/src/netbase.cpp\r\n+++ w/src/netbase.cpp\r\n@@ -484,23 +484,21 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\r\n \r\n std::unique_ptr<Sock> CreateSockOS(const sa_family_t& address_family)\r\n {\r\n     // Not IPv4, IPv6 or UNIX\r\n     if (address_family == AF_UNSPEC) return nullptr;\r\n \r\n+    int protocol{IPPROTO_TCP};\r\n #if HAVE_SOCKADDR_UN\r\n-    // Create a UNIX socket.\r\n     if (address_family == AF_UNIX) {\r\n-        SOCKET hSocket = socket(AF_UNIX, SOCK_STREAM, 0);\r\n-        if (hSocket == INVALID_SOCKET) return nullptr;\r\n-        return std::make_unique<Sock>(hSocket);\r\n+        protocol = 0;\r\n     }\r\n #endif\r\n \r\n-    // Create a TCP socket in the address family of the specified service.\r\n-    SOCKET hSocket = socket(address_family, SOCK_STREAM, IPPROTO_TCP);\r\n+    // Create a socket in the specified address family.\r\n+    SOCKET hSocket = socket(address_family, SOCK_STREAM, protocol);\r\n     if (hSocket == INVALID_SOCKET) {\r\n         return nullptr;\r\n     }\r\n \r\n     auto sock = std::make_unique<Sock>(hSocket);\r\n \r\n@@ -518,23 +516,30 @@ std::unique_ptr<Sock> CreateSockOS(const sa_family_t& address_family)\r\n     if (sock->SetSockOpt(SOL_SOCKET, SO_NOSIGPIPE, (void*)&set, sizeof(int)) == SOCKET_ERROR) {\r\n         LogPrintf(\"Error setting SO_NOSIGPIPE on socket: %s, continuing anyway\\n\",\r\n                   NetworkErrorString(WSAGetLastError()));\r\n     }\r\n #endif\r\n \r\n+    // Set the non-blocking option on the socket.\r\n+    if (!sock->SetNonBlocking()) {\r\n+        LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\r\n+        return nullptr;\r\n+    }\r\n+\r\n+#if HAVE_SOCKADDR_UN\r\n+    if (address_family == AF_UNIX) {\r\n+        return sock;\r\n+    }\r\n+#endif\r\n+\r\n     // Set the no-delay option (disable Nagle's algorithm) on the TCP socket.\r\n     const int on{1};\r\n     if (sock->SetSockOpt(IPPROTO_TCP, TCP_NODELAY, &on, sizeof(on)) == SOCKET_ERROR) {\r\n         LogPrint(BCLog::NET, \"Unable to set TCP_NODELAY on a newly created socket, continuing anyway\\n\");\r\n     }\r\n \r\n-    // Set the non-blocking option on the socket.\r\n-    if (!sock->SetNonBlocking()) {\r\n-        LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\r\n-        return nullptr;\r\n-    }\r\n     return sock;\r\n }\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:31:32Z",
      "diff_hunk" : "@@ -456,18 +482,22 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\n     return true;\n }\n \n-std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n+std::unique_ptr<Sock> CreateSockOS(const sa_family_t& address_family)\n {\n-    // Create a sockaddr from the specified service.\n-    struct sockaddr_storage sockaddr;\n-    socklen_t len = sizeof(sockaddr);\n-    if (!address_family.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n-        LogPrintf(\"Cannot create socket for %s: unsupported network\\n\", address_family.ToStringAddrPort());\n-        return nullptr;\n+    // Not IPv4, IPv6 or UNIX\n+    if (address_family == AF_UNSPEC) return nullptr;\n+\n+#if HAVE_SOCKADDR_UN\n+    // Create a UNIX socket.\n+    if (address_family == AF_UNIX) {\n+        SOCKET hSocket = socket(AF_UNIX, SOCK_STREAM, 0);\n+        if (hSocket == INVALID_SOCKET) return nullptr;\n+        return std::make_unique<Sock>(hSocket);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217719465",
      "id" : 1217719465,
      "line" : 495,
      "node_id" : "PRRC_kwDOABII585IlOyp",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 495,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 61,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217719465/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217719465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217741453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217741453"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Pass `path` by const reference, strings are expensive to copy.\r\n\r\n```suggestion\r\n    explicit Proxy(const std::string& path, bool _randomize_credentials=false): unix_socket_path(path), is_unix_socket(true), randomize_credentials(_randomize_credentials) {}\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:48:51Z",
      "diff_hunk" : "@@ -45,16 +48,44 @@ static inline bool operator&(ConnectionDirection a, ConnectionDirection b) {\n     return (underlying(a) & underlying(b));\n }\n \n+/**\n+ * Check if a string is a valid UNIX domain socket path\n+ *\n+ * @param      name     The string provided by the user representing a local path\n+ *\n+ * @returns Whether the string has proper format, length, and points to an existing file path\n+ */\n+bool IsUnixSocketPath(const std::string& name);\n+\n class Proxy\n {\n public:\n-    Proxy(): randomize_credentials(false) {}\n-    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), randomize_credentials(_randomize_credentials) {}\n-\n-    bool IsValid() const { return proxy.IsValid(); }\n+    Proxy(): is_unix_socket(false), randomize_credentials(false) {}\n+    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), is_unix_socket(false), randomize_credentials(_randomize_credentials) {}\n+    explicit Proxy(const std::string path, bool _randomize_credentials=false): unix_socket_path(path), is_unix_socket(true), randomize_credentials(_randomize_credentials) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217741453",
      "id" : 1217741453,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII585IlUKN",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 65,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 32,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217741453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217741453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217743952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217743952"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Members should start with `m_`. Maybe also rename the existent `randomize_credentials` to `m_randomize_credentials` (in a separate commit).",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:50:50Z",
      "diff_hunk" : "@@ -45,16 +48,44 @@ static inline bool operator&(ConnectionDirection a, ConnectionDirection b) {\n     return (underlying(a) & underlying(b));\n }\n \n+/**\n+ * Check if a string is a valid UNIX domain socket path\n+ *\n+ * @param      name     The string provided by the user representing a local path\n+ *\n+ * @returns Whether the string has proper format, length, and points to an existing file path\n+ */\n+bool IsUnixSocketPath(const std::string& name);\n+\n class Proxy\n {\n public:\n-    Proxy(): randomize_credentials(false) {}\n-    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), randomize_credentials(_randomize_credentials) {}\n-\n-    bool IsValid() const { return proxy.IsValid(); }\n+    Proxy(): is_unix_socket(false), randomize_credentials(false) {}\n+    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), is_unix_socket(false), randomize_credentials(_randomize_credentials) {}\n+    explicit Proxy(const std::string path, bool _randomize_credentials=false): unix_socket_path(path), is_unix_socket(true), randomize_credentials(_randomize_credentials) {}\n \n     CService proxy;\n+    std::string unix_socket_path;\n+    bool is_unix_socket;\n     bool randomize_credentials;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217743952",
      "id" : 1217743952,
      "line" : 70,
      "node_id" : "PRRC_kwDOABII585IlUxQ",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 70,
      "original_position" : 37,
      "original_start_line" : 68,
      "path" : "src/netbase.h",
      "position" : 37,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217743952/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 68,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217743952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217747937"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217747937"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Better omit `AddrPort` from the name of this method because it does not apply to UNIX sockets. Just `ToString()` seems fine (but still call `proxy.ToStringAddrPort()` for non-UNIX sockets).",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T08:53:55Z",
      "diff_hunk" : "@@ -45,16 +48,44 @@ static inline bool operator&(ConnectionDirection a, ConnectionDirection b) {\n     return (underlying(a) & underlying(b));\n }\n \n+/**\n+ * Check if a string is a valid UNIX domain socket path\n+ *\n+ * @param      name     The string provided by the user representing a local path\n+ *\n+ * @returns Whether the string has proper format, length, and points to an existing file path\n+ */\n+bool IsUnixSocketPath(const std::string& name);\n+\n class Proxy\n {\n public:\n-    Proxy(): randomize_credentials(false) {}\n-    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), randomize_credentials(_randomize_credentials) {}\n-\n-    bool IsValid() const { return proxy.IsValid(); }\n+    Proxy(): is_unix_socket(false), randomize_credentials(false) {}\n+    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), is_unix_socket(false), randomize_credentials(_randomize_credentials) {}\n+    explicit Proxy(const std::string path, bool _randomize_credentials=false): unix_socket_path(path), is_unix_socket(true), randomize_credentials(_randomize_credentials) {}\n \n     CService proxy;\n+    std::string unix_socket_path;\n+    bool is_unix_socket;\n     bool randomize_credentials;\n+\n+    bool IsValid() const\n+    {\n+        if (is_unix_socket) return IsUnixSocketPath(unix_socket_path);\n+        return proxy.IsValid();\n+    }\n+\n+    sa_family_t GetFamily() const\n+    {\n+        if (is_unix_socket) return AF_UNIX;\n+        return proxy.GetTCPFamily();\n+    }\n+\n+    std::string ToStringAddrPort() const\n+    {\n+        if (is_unix_socket) return unix_socket_path;\n+        return proxy.ToStringAddrPort();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217747937",
      "id" : 1217747937,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII585IlVvh",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 88,
      "original_position" : 55,
      "original_start_line" : 84,
      "path" : "src/netbase.h",
      "position" : 55,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217747937/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 84,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217747937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217775186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217775186"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wonder if this check is desirable. It makes `IsUnixSocketPath()` volatile - for example if the Tor server is not yet started it will be false and the moment it is started it will become true, or if the Tor server is restarted it will flip from true to false and back.\r\n\r\nWith this check `bitcoind` will refuse to start if the Tor server is not started yet. This differs from the TCP case where the Tor server can start later.\r\n\r\nWith TCP we only check if the given address is something we can _try_ to connect to. Like \"ok, it is 4 digits separated by 3 dots, maybe I can connect to this later when needed\". `CService::IsValid()` does not check whether somebody is listening on that address and port and that we can connect to it. An equivalent check for UNIX sockets would be \"ok, if it starts with unix: and is short enough maybe I can connect to this later when needed\".",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T09:15:19Z",
      "diff_hunk" : "@@ -214,6 +218,28 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault, DNSLookupF\n     return Lookup(name, portDefault, /*fAllowLookup=*/false, dns_lookup_function).value_or(CService{});\n }\n \n+bool IsUnixSocketPath(const std::string& name)\n+{\n+#if HAVE_SOCKADDR_UN\n+    if (name.find(ADDR_PREFIX_UNIX) != 0) return false;\n+\n+    // Split off \"unix:\" prefix\n+    std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    // Path size limit is platform-dependent\n+    // see https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html\n+    if (str.size() + 1 > sizeof(((sockaddr_un*)nullptr)->sun_path)) return false;\n+\n+    // Path must exist\n+    fs::path path = fs::PathFromString(str);\n+    if (!fs::exists(path)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217775186",
      "id" : 1217775186,
      "line" : 235,
      "node_id" : "PRRC_kwDOABII585IlcZS",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 235,
      "original_position" : 29,
      "original_start_line" : 233,
      "path" : "src/netbase.cpp",
      "position" : 29,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217775186/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 233,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:52:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217775186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217785125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217785125"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should use `IsUnixSocketPath()`?\r\n\r\n```suggestion\r\n                if ((port_option != \"-proxy\" && port_option != \"-onion\") || !IsUnixSocketPath(socket_addr)) {\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T09:21:43Z",
      "diff_hunk" : "@@ -1286,7 +1286,14 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             std::string host_out;\n             uint16_t port_out{0};\n             if (!SplitHostPort(socket_addr, port_out, host_out)) {\n+#if HAVE_SOCKADDR_UN\n+                // Allow unix domain sockets for -proxy and -onion e.g. unix:/some/file/path\n+                if ((port_option != \"-proxy\" && port_option != \"-onion\") || socket_addr.find(ADDR_PREFIX_UNIX) != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217785125",
      "id" : 1217785125,
      "line" : 1291,
      "node_id" : "PRRC_kwDOABII585Ile0l",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 1291,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217785125/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217785125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217795272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217795272"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n\r\n```suggestion\r\n# Use the shortest temp path possible since UNIX sockets may have as little as 92-char limit\r\n```",
      "commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "created_at" : "2023-06-05T09:28:53Z",
      "diff_hunk" : "@@ -60,14 +63,17 @@\n # Networks returned by RPC getnetworkinfo, defined in src/rpc/net.cpp::GetNetworksInfo()\n NETWORKS = frozenset({NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS})\n \n+# Use the shortest temp path possible since paths may have as little as 92-char limit",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217795272",
      "id" : 1217795272,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585IlhTI",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 66,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/feature_proxy.py",
      "position" : 31,
      "pull_request_review_id" : 1461645134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217795272/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T09:48:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1217795272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1218382890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218382890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This change would make `feature_proxy.py` test fail because the error would be `\"Invalid port...\"` which is misleading if the real problem is (for example) a too-long file path, which will get caught by `IsUnixSocketPath()` on L1370 and described as `\"Invalid -proxy address or hostname...\"`. So I think it makes more sense to keep this line as-is: if we think the user is trying to set a UNIX socket path, we just ignore the invalid port check.",
      "commit_id" : "64d0f234e9aac490b03a5c019e86f1da56e62e01",
      "created_at" : "2023-06-05T17:32:29Z",
      "diff_hunk" : "@@ -1286,7 +1286,14 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             std::string host_out;\n             uint16_t port_out{0};\n             if (!SplitHostPort(socket_addr, port_out, host_out)) {\n+#if HAVE_SOCKADDR_UN\n+                // Allow unix domain sockets for -proxy and -onion e.g. unix:/some/file/path\n+                if ((port_option != \"-proxy\" && port_option != \"-onion\") || socket_addr.find(ADDR_PREFIX_UNIX) != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1218382890",
      "id" : 1218382890,
      "in_reply_to_id" : 1217785125,
      "line" : 1306,
      "node_id" : "PRRC_kwDOABII585Inwwq",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 1306,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 1463052208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218382890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T17:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218382890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild thanks for the excellent detailed review! All comments addressed except where noted.",
      "created_at" : "2023-06-05T17:35:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1577201958",
      "id" : 1577201958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585eAjEm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577201958/reactions"
      },
      "updated_at" : "2023-06-05T17:35:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577201958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master to pass CI (â ). @vasild and @willcl-ark would really love re-review from you handsome chaps when convenient!",
      "created_at" : "2023-06-22T14:43:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1602766905",
      "id" : 1602766905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585fiEg5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602766905/reactions"
      },
      "updated_at" : "2023-06-22T17:10:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602766905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1239079790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239079790"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's possible this could pass, but the necessary configure check fail, in theory. But maybe we want the test(s) to fail in that scenario anyway.",
      "commit_id" : "64d0f234e9aac490b03a5c019e86f1da56e62e01",
      "created_at" : "2023-06-22T22:14:29Z",
      "diff_hunk" : "@@ -153,3 +153,12 @@ def test_ipv6_local():\n     except socket.error:\n         have_ipv6 = False\n     return have_ipv6\n+\n+def test_unix_socket():\n+    '''Return True if UNIX sockets are available on this platform.'''\n+    try:\n+        socket.AF_UNIX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1239079790",
      "id" : 1239079790,
      "line" : 160,
      "node_id" : "PRRC_kwDOABII585J2ttu",
      "original_commit_id" : "64d0f234e9aac490b03a5c019e86f1da56e62e01",
      "original_line" : 160,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/netutil.py",
      "position" : 8,
      "pull_request_review_id" : 1494066986,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239079790/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-22T22:14:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239079790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-29T11:25:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1612946443",
      "id" : 1612946443,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585gI5wL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1612946443/reactions"
      },
      "updated_at" : "2023-06-29T11:25:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1612946443",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1246758964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246758964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: it does not have to be `const` when passing by value - there is no way to for the function to modify the variable that is being passed (and have effects visible outside of the function).\r\n\r\n```suggestion\r\nstd::unique_ptr<Sock> CreateSockOS(sa_family_t address_family);\r\n```\r\n\r\nSee f3() in http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-in",
      "commit_id" : "64d0f234e9aac490b03a5c019e86f1da56e62e01",
      "created_at" : "2023-06-29T15:10:35Z",
      "diff_hunk" : "@@ -178,16 +209,16 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault = 0, DNSLoo\n bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out);\n \n /**\n- * Create a TCP socket in the given address family.\n+ * Create a TCP or UNIX socket in the given address family.\n  * @param[in] address_family The socket is created in the same address family as this address.\n  * @return pointer to the created Sock object or unique_ptr that owns nothing in case of failure\n  */\n-std::unique_ptr<Sock> CreateSockTCP(const CService& address_family);\n+std::unique_ptr<Sock> CreateSockOS(const sa_family_t address_family);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1246758964",
      "id" : 1246758964,
      "line" : 216,
      "node_id" : "PRRC_kwDOABII585KUAg0",
      "original_commit_id" : "64d0f234e9aac490b03a5c019e86f1da56e62e01",
      "original_line" : 216,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 70,
      "pull_request_review_id" : 1505515197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246758964/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-29T16:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246758964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1246856004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246856004"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The new member `unix_socket_path` is still without `m_` prefix. Only `is_unix_socket` was renamed to `m_is_unix_socket`.",
      "commit_id" : "64d0f234e9aac490b03a5c019e86f1da56e62e01",
      "created_at" : "2023-06-29T16:13:34Z",
      "diff_hunk" : "@@ -45,16 +48,44 @@ static inline bool operator&(ConnectionDirection a, ConnectionDirection b) {\n     return (underlying(a) & underlying(b));\n }\n \n+/**\n+ * Check if a string is a valid UNIX domain socket path\n+ *\n+ * @param      name     The string provided by the user representing a local path\n+ *\n+ * @returns Whether the string has proper format, length, and points to an existing file path\n+ */\n+bool IsUnixSocketPath(const std::string& name);\n+\n class Proxy\n {\n public:\n-    Proxy(): randomize_credentials(false) {}\n-    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), randomize_credentials(_randomize_credentials) {}\n-\n-    bool IsValid() const { return proxy.IsValid(); }\n+    Proxy(): is_unix_socket(false), randomize_credentials(false) {}\n+    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), is_unix_socket(false), randomize_credentials(_randomize_credentials) {}\n+    explicit Proxy(const std::string path, bool _randomize_credentials=false): unix_socket_path(path), is_unix_socket(true), randomize_credentials(_randomize_credentials) {}\n \n     CService proxy;\n+    std::string unix_socket_path;\n+    bool is_unix_socket;\n     bool randomize_credentials;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1246856004",
      "id" : 1246856004,
      "in_reply_to_id" : 1217743952,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KUYNE",
      "original_commit_id" : "1a2095baf12b8f8995bed513a23d5faf16917fba",
      "original_line" : 70,
      "original_position" : 37,
      "original_start_line" : 68,
      "path" : "src/netbase.h",
      "position" : null,
      "pull_request_review_id" : 1505662729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246856004/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-29T16:13:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246856004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1251211129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1251211129"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah great tip thanks ;-)",
      "commit_id" : "c3b0f137a9ccd894f2f1d287ccdab26310b3aaf2",
      "created_at" : "2023-07-03T19:14:56Z",
      "diff_hunk" : "@@ -178,16 +209,16 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault = 0, DNSLoo\n bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out);\n \n /**\n- * Create a TCP socket in the given address family.\n+ * Create a TCP or UNIX socket in the given address family.\n  * @param[in] address_family The socket is created in the same address family as this address.\n  * @return pointer to the created Sock object or unique_ptr that owns nothing in case of failure\n  */\n-std::unique_ptr<Sock> CreateSockTCP(const CService& address_family);\n+std::unique_ptr<Sock> CreateSockOS(const sa_family_t address_family);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1251211129",
      "id" : 1251211129,
      "in_reply_to_id" : 1246758964,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Kk_d5",
      "original_commit_id" : "64d0f234e9aac490b03a5c019e86f1da56e62e01",
      "original_line" : 216,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : null,
      "pull_request_review_id" : 1511673742,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1251211129/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-03T19:14:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1251211129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> [64d0f23](https://github.com/bitcoin/bitcoin/commit/64d0f234e9aac490b03a5c019e86f1da56e62e01) looks good, except there is some messup in the contents of these two commits:\r\n\r\nThanks @vasild sorry about the messy rebase there. I cleaned up the commits and fixed the `const` and `m_...` nits. Rebased on master for merge conflicts.",
      "created_at" : "2023-07-03T19:17:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1619034666",
      "id" : 1619034666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585ggIIq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1619034666/reactions"
      },
      "updated_at" : "2023-07-03T19:32:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1619034666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It's a tNACK from me currently @ c3b0f137a9 as I can no longer get this functionality to work in practice on Ubuntu 23.04 with Tor 0.4.7.13.\r\n\r\nThe send of the data in `vSocks5Init` seems to be failing, meaning the proxy cannot be used: https://github.com/pinheadmz/bitcoin/blob/c3b0f137a9ccd894f2f1d287ccdab26310b3aaf2/src/netbase.cpp#L372-L375\r\n\r\nI haven't yet totally ruled out issues with Tor, but I do get responses from the unix socket about it not being an HTTP proxy if I try to send an HTTP request over it, so I conclude that the Tor daemon is listening on the socket correctly waiting for SOCKS requests, and the issue may lie with Bitcoin Core.\r\n\r\nWill continue investigating and report back.\r\n\r\n<details>\r\n<summary>bitcoin.conf options set</summary>\r\n\r\n```log\r\n2023-07-11T11:12:35Z Config file: /home/will/.bitcoin/bitcoin.conf\r\n2023-07-11T11:12:35Z Config file arg: [main] addnode=\"xx.xx.xx.xx:8333\"\r\n2023-07-11T11:12:35Z Config file arg: [main] blockfilterindex=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] blocksdir=\"/media/will/crucial1/bitcoin\"\r\n2023-07-11T11:12:35Z Config file arg: [main] daemon=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] debug=\"net\"\r\n2023-07-11T11:12:35Z Config file arg: [main] debug=\"proxy\"\r\n2023-07-11T11:12:35Z Config file arg: [main] debug=\"tor\"\r\n2023-07-11T11:12:35Z Config file arg: [main] discover=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] externalip=\"xx.xx.xx.xx\"\r\n2023-07-11T11:12:35Z Config file arg: [main] i2pacceptincoming=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] i2psam=\"127.0.0.1:7656\"\r\n2023-07-11T11:12:35Z Config file arg: [main] listen=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] listenonion=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] maxconnections=\"125\"\r\n2023-07-11T11:12:35Z Config file arg: [main] mempoolfullrbf=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] onion=\"unix:/run/tor/socks\"\r\n2023-07-11T11:12:35Z Config file arg: [main] onlynet=\"onion\"\r\n2023-07-11T11:12:35Z Config file arg: [main] port=\"8833\"\r\n2023-07-11T11:12:35Z Config file arg: [main] rpcauth=****\r\n2023-07-11T11:12:35Z Config file arg: [main] rpcthreads=\"16\"\r\n2023-07-11T11:12:35Z Config file arg: [main] rpcworkqueue=\"64\"\r\n2023-07-11T11:12:35Z Config file arg: [main] server=\"1\"\r\n2023-07-11T11:12:35Z Config file arg: [main] txindex=\"1\"\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>torrc</summary>\r\n\r\n```\r\nSocksPort unix:/run/tor/socks WorldWritable\r\nControlPort 9051\r\nCookieAuthentication 1\r\nCookieAuthFileGroupReadable 1\r\nDataDirectoryGroupReadable 1\r\n```\r\n\r\n</details>",
      "created_at" : "2023-07-11T11:37:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1630664257",
      "id" : 1630664257,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585hMfZB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1630664257/reactions"
      },
      "updated_at" : "2023-07-11T11:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1630664257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@willcl-ark wow thank you so much for catching that. After all the refactoring, we had forgotten to actually *connect to the unix socket!* I added a functional test to ensure that the proxy works now and I have also tested in production with Tor locally.\r\n\r\nThis required a fairly intense refactor that included inserting 2 new commits and rebasing several others:\r\n\r\n`git range-diff 32a5a20225 c3b0f137a9 b1199bce0f`\r\n\r\n",
      "created_at" : "2023-07-12T20:51:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1633198398",
      "id" : 1633198398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585hWKE-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1633198398/reactions"
      },
      "updated_at" : "2023-07-12T20:51:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1633198398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild Thanks for your work on this :-) I reorganized the extra commit you sent me. For now, still going without `variant` for `Proxy` just to keep the refator more simple, so leaving the i2p stuff mostly alone as well.",
      "created_at" : "2023-07-12T20:52:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1633199594",
      "id" : 1633199594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585hWKXq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1633199594/reactions"
      },
      "updated_at" : "2023-07-12T20:52:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1633199594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262178924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262178924"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This check can be omitted from commit dc2361401c `net: move CreateSock() calls from ConnectNode() to netbase methods` since the code checks `if (!sock)` earlier. `CreateSock()` will never return a non-empty `unique_ptr` that contains a `Sock` object with a bogus internal file descriptor (`INVALID_SOCKED`).",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T08:05:52Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262178924",
      "id" : 1262178924,
      "line" : 608,
      "node_id" : "PRRC_kwDOABII585LO1Js",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 608,
      "original_position" : 195,
      "original_start_line" : 605,
      "path" : "src/netbase.cpp",
      "position" : 195,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262178924/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 605,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262178924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262322061"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262322061"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The interface of taking `unique_ptr` as an argument and returning the same is a bit weird. Usually functions take `unique_ptr` when the ownership of the object is transferred from the caller to the function. But in this case it is transferred to the function which then returns it back to the caller. It would be better to have an interface like:\r\n\r\n```cpp\r\nbool ConnectToSocket(const Sock& sock, ...);\r\n\r\n// and call it like:\r\n\r\nsock = ... // is unique_ptr<Sock>\r\nif (!ConnectToSocket(*sock, ...)) {\r\n    handle the error\r\n    return {}; // empty unique_ptr\r\n}\r\n\r\nreturn sock;\r\n```",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T09:54:49Z",
      "diff_hunk" : "@@ -509,22 +536,10 @@ static void LogConnectFailure(bool manual_connection, const char* fmt, const Arg\n     }\n }\n \n-bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nTimeout, bool manual_connection)\n+std::unique_ptr<Sock> ConnectToSocket(std::unique_ptr<Sock> sock, struct sockaddr* sockaddr, socklen_t len, std::string dest_str, bool manual_connection)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262322061",
      "id" : 1262322061,
      "line" : 539,
      "node_id" : "PRRC_kwDOABII585LPYGN",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 539,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 103,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262322061/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262322061",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262327319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262327319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Make the string argument const reference and the function `static` since it is used only in `netbase.cpp`:\r\n\r\n```suggestion\r\nstatic std::unique_ptr<Sock> ConnectToSocket(std::unique_ptr<Sock> sock, struct sockaddr* sockaddr, socklen_t len, const std::string& dest_str, bool manual_connection)\r\n```",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T09:59:07Z",
      "diff_hunk" : "@@ -509,22 +536,10 @@ static void LogConnectFailure(bool manual_connection, const char* fmt, const Arg\n     }\n }\n \n-bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nTimeout, bool manual_connection)\n+std::unique_ptr<Sock> ConnectToSocket(std::unique_ptr<Sock> sock, struct sockaddr* sockaddr, socklen_t len, std::string dest_str, bool manual_connection)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262327319",
      "id" : 1262327319,
      "line" : 539,
      "node_id" : "PRRC_kwDOABII585LPZYX",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 539,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 103,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262327319/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262327319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262362898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262362898"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Calling this on an invalid `Proxy` (e.g. default-constructed) will cause weird results. Better check `if (!IsValid()) { log; return {}; }` at the start of this function.",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T10:30:44Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262362898",
      "id" : 1262362898,
      "line" : 619,
      "node_id" : "PRRC_kwDOABII585LPiES",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 619,
      "original_position" : 206,
      "original_start_line" : 617,
      "path" : "src/netbase.cpp",
      "position" : 206,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262362898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 617,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262362898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262368024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262368024"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There is no need to use the generic `sockaddr_storage` since we know it is going to be `sockaddr_un`. Also, clear it for compatibility, see the example in https://www.man7.org/linux/man-pages/man7/unix.7.html\r\n\r\n```suggestion\r\n    struct sockaddr_un addrun;\r\n    memset(&addrun, 0, sizeof(addrun));\r\n```",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T10:35:29Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_storage sockaddr;\n+    struct sockaddr_un* paddrun = (struct sockaddr_un*)&sockaddr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262368024",
      "id" : 1262368024,
      "line" : 630,
      "node_id" : "PRRC_kwDOABII585LPjUY",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 630,
      "original_position" : 217,
      "original_start_line" : 629,
      "path" : "src/netbase.cpp",
      "position" : 217,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262368024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 629,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262368024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262371026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262371026"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This and below I guess have to be inside `#if HAVE_SOCKADDR_UN`, otherwise it does not compile on Windows (CI has choked on it).\r\n\r\nhttps://devblogs.microsoft.com/commandline/af_unix-comes-to-windows/ is relevant. Would it compile on Windows if we just `#include <afunix.h>`?",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T10:37:49Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262371026",
      "id" : 1262371026,
      "line" : 621,
      "node_id" : "PRRC_kwDOABII585LPkDS",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 621,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 208,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262371026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:29:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262371026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262372825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262372825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`strcpy()` is a dangerous function because it can be easily misused in a way that leads to security flaws. There is not a single usage of it in Bitcoin Core. In this particular case if `path` is longer it will buffer overflow the fixed size array `sun_path[]`.\r\n\r\nI would suggest to do something like this:\r\n\r\n```cpp\r\n// leave the last char in addrun.sun_path[] to be always '\\0'\r\nmemcpy(addrun.sun_path, path.c_str(), std::min(sizeof(addrun.sun_path) - 1, path.length()));\r\n```",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T10:39:21Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_storage sockaddr;\n+    struct sockaddr_un* paddrun = (struct sockaddr_un*)&sockaddr;\n+    paddrun->sun_family = AF_UNIX;\n+    strcpy(paddrun->sun_path, path.c_str());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262372825",
      "id" : 1262372825,
      "line" : 632,
      "node_id" : "PRRC_kwDOABII585LPkfZ",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 632,
      "original_position" : 219,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 219,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262372825/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262372825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262417198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262417198"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `len` calculation seems to be wrong since `sizeof(paddrun)` is just 8 bytes (it is a pointer). Anyway, you can use just `sizeof(sockaddr)` (not the pointer) or `sizeof(addrun)` if you change it to `sockaddr_un addrun;`\r\n\r\n```suggestion\r\n    return ConnectToSocket(std::move(sock), (struct sockaddr*)&addrun, sizeof(addrun), path, /*manual_connection=*/true);\r\n```",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T11:21:24Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_storage sockaddr;\n+    struct sockaddr_un* paddrun = (struct sockaddr_un*)&sockaddr;\n+    paddrun->sun_family = AF_UNIX;\n+    strcpy(paddrun->sun_path, path.c_str());\n+    socklen_t len = strlen(paddrun->sun_path) + sizeof(paddrun);\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, path, /*manual_connection=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262417198",
      "id" : 1262417198,
      "line" : 635,
      "node_id" : "PRRC_kwDOABII585LPvUu",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 635,
      "original_position" : 222,
      "original_start_line" : 633,
      "path" : "src/netbase.cpp",
      "position" : 222,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262417198/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 633,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262417198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262421705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262421705"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What is the meaning of this comment here?",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T11:26:03Z",
      "diff_hunk" : "@@ -230,6 +253,13 @@ def run_test(self):\n             proxies=[self.serv1, self.serv1, self.serv1, self.serv1],\n             auth=False, test_onion=True, test_cjdns=True)\n \n+        # -proxyrandomize=0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262421705",
      "id" : 1262421705,
      "line" : 256,
      "node_id" : "PRRC_kwDOABII585LPwbJ",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 256,
      "original_position" : 138,
      "original_start_line" : null,
      "path" : "test/functional/feature_proxy.py",
      "position" : 138,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262421705/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262421705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262422280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262422280"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why use `-proxyrandomize=0` is it not irrelevant for this test?",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T11:26:38Z",
      "diff_hunk" : "@@ -109,10 +127,15 @@ def setup_nodes(self):\n             ['-listen', f'-proxy={self.conf2.addr[0]}:{self.conf2.addr[1]}','-proxyrandomize=1'],\n             [],\n             ['-listen', f'-proxy={self.conf1.addr[0]}:{self.conf1.addr[1]}','-proxyrandomize=1',\n-                '-cjdnsreachable']\n+                '-cjdnsreachable'],\n+            [],\n+            []\n         ]\n         if self.have_ipv6:\n             args[3] = ['-listen', f'-proxy=[{self.conf3.addr[0]}]:{self.conf3.addr[1]}','-proxyrandomize=0', '-noonion']\n+        if self.have_unix_sockets:\n+            args[5] = ['-listen', f'-proxy=unix:{socket_path}', '-proxyrandomize=0']\n+            args[6] = ['-listen', f'-onion=unix:{socket_path}', '-proxyrandomize=0']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262422280",
      "id" : 1262422280,
      "line" : 138,
      "node_id" : "PRRC_kwDOABII585LPwkI",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 138,
      "original_position" : 85,
      "original_start_line" : 136,
      "path" : "test/functional/feature_proxy.py",
      "position" : 85,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262422280/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 136,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262422280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262436716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262436716"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `Proxy::proxy` member is still accessed directly from some high level code:\r\n\r\n```\r\nsrc/net.cpp:494:                            std::make_unique<i2p::sam::Session>(proxy.proxy, &interruptNet);\r\nsrc/qt/optionsdialog.cpp:416:    ui->proxyReachIPv4->setChecked(has_proxy && proxy.proxy == ui_proxy);\r\nsrc/qt/optionsdialog.cpp:419:    ui->proxyReachIPv6->setChecked(has_proxy && proxy.proxy == ui_proxy);\r\nsrc/qt/optionsdialog.cpp:422:    ui->proxyReachTor->setChecked(has_proxy && proxy.proxy == ui_proxy);\r\n```\r\n\r\neven though it may not be set if it is a UNIX socket proxy.\r\n\r\nFor the I2P case we can kind of assume it is a TCP proxy, but then better add `assert(!proxy.m_is_unix_socket);` to ensure that (eh, that's ugly). Or you can pass the `Proxy` object to the `Session()` constructor, change `m_control_host` from `CService` to `Proxy` and use `m_control_host.Connect()` in `Session::Hello()` to create the socket. This will transparently add support for UNIX sockets also for the I2P proxy.\r\n\r\nFor the GUI case, this function has to be changed:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b4794740f82e1a08294c8a5f5d586bc1925412f3/src/qt/optionsdialog.cpp#L407-L423\r\n\r\nFirst it has to check if `ui->proxyIp->text().toStdString()` starts with `unix:` and if yes, avoid `LookupHost()`. Then create `Proxy ui_proxy` instead of `CService ui_proxy`.\r\n\r\nWhen this is done, then `Proxy::proxy` can be made private inside the `Proxy` class, together with the `m_unix_socket_path` and `m_is_unix_socket` members.",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T11:41:14Z",
      "diff_hunk" : "@@ -45,16 +48,46 @@ static inline bool operator&(ConnectionDirection a, ConnectionDirection b) {\n     return (underlying(a) & underlying(b));\n }\n \n+/**\n+ * Check if a string is a valid UNIX domain socket path\n+ *\n+ * @param      name     The string provided by the user representing a local path\n+ *\n+ * @returns Whether the string has proper format, length, and points to an existing file path\n+ */\n+bool IsUnixSocketPath(const std::string& name);\n+\n class Proxy\n {\n public:\n-    Proxy(): randomize_credentials(false) {}\n-    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), randomize_credentials(_randomize_credentials) {}\n-\n-    bool IsValid() const { return proxy.IsValid(); }\n+    Proxy() : m_is_unix_socket(false), m_randomize_credentials(false) {}\n+    explicit Proxy(const CService& _proxy, bool _randomize_credentials = false) : proxy(_proxy), m_is_unix_socket(false), m_randomize_credentials(_randomize_credentials) {}\n+    explicit Proxy(const std::string path, bool _randomize_credentials = false) : m_unix_socket_path(path), m_is_unix_socket(true), m_randomize_credentials(_randomize_credentials) {}\n \n     CService proxy;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262436716",
      "id" : 1262436716,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585LP0Fs",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 67,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 34,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262436716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:33:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262436716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262486665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262486665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This will leave the socket in a blocking mode. I think the rest of the P2P code expects and assumes non-blocking sockets. Better set this also to non-blocking and make the `Socks5()` more robust:\r\n\r\n<details>\r\n<summary>[patch] netbase: use reliable send() during SOCKS5 handshake</summary>\r\n\r\n```diff\r\ncommit 4c8d08ca2b495da609d5586247dbd2b306e90e61 (HEAD -> tor-unix-domain-socket)\r\nParent: af4eb52ff611342dbd285f218474649f16badbaf\r\nAuthor:     Vasil Dimov <vd@FreeBSD.org>\r\nAuthorDate: Thu Jul 13 14:17:30 2023 +0200\r\nCommit:     Vasil Dimov <vd@FreeBSD.org>\r\nCommitDate: Thu Jul 13 14:17:30 2023 +0200\r\ngpg: Signature made Thu Jul 13 14:23:03 2023 CEST\r\ngpg:                using RSA key E64D8D45614DB07545D9CCC154DF06F64B55CBBF\r\ngpg: Good signature from \"Vasil Dimov <vd@myforest.net>\" [ultimate]\r\ngpg:                 aka \"Vasil Dimov <vd@FreeBSD.org>\" [ultimate]\r\ngpg:                 aka \"Vasil Dimov <vasild@gmail.com>\" [ultimate]\r\n\r\n\r\n    netbase: use reliable send() during SOCKS5 handshake\r\n    \r\n    `send(2)` can be interrupted or for another reason it may not fully\r\n    complete sending all the bytes. We should be ready to retry the send\r\n    with the remaining bytes. This is what `Sock::SendComplete()` does,\r\n    thus use it in `Socks5()`.\r\n    \r\n    Since `Sock::SendComplete()` takes a `CThreadInterrupt` argument,\r\n    change also the recv part of `Socks5()` to use `CThreadInterrupt`\r\n    instead of a boolean.\r\n    \r\n    Easier reviewed with `git show -b` (ignore white-space changes).\r\n\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex a46cd25e90..4eb96f950d 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -2336,13 +2336,12 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\r\n     }\r\n \r\n     //\r\n     // Start threads\r\n     //\r\n     assert(m_msgproc);\r\n-    InterruptSocks5(false);\r\n     interruptNet.reset();\r\n     flagInterruptMsgProc = false;\r\n \r\n     {\r\n         LOCK(mutexMsgProc);\r\n         fMsgProcWake = false;\r\n@@ -2408,13 +2407,13 @@ void CConnman::Interrupt()\r\n         LOCK(mutexMsgProc);\r\n         flagInterruptMsgProc = true;\r\n     }\r\n     condMsgProc.notify_all();\r\n \r\n     interruptNet();\r\n-    InterruptSocks5(true);\r\n+    g_socks5_interrupt();\r\n \r\n     if (semOutbound) {\r\n         for (int i=0; i<m_max_outbound; i++) {\r\n             semOutbound->post();\r\n         }\r\n     }\r\ndiff --git a/src/netbase.cpp b/src/netbase.cpp\r\nindex 548e1483b8..cee50e67bb 100644\r\n--- a/src/netbase.cpp\r\n+++ b/src/netbase.cpp\r\n@@ -32,13 +32,13 @@ static Proxy proxyInfo[NET_MAX] GUARDED_BY(g_proxyinfo_mutex);\r\n static Proxy nameProxy GUARDED_BY(g_proxyinfo_mutex);\r\n int nConnectTimeout = DEFAULT_CONNECT_TIMEOUT;\r\n bool fNameLookup = DEFAULT_NAME_LOOKUP;\r\n \r\n // Need ample time for negotiation for very slow proxies such as Tor\r\n std::chrono::milliseconds g_socks5_recv_timeout = 20s;\r\n-static std::atomic<bool> interruptSocks5Recv(false);\r\n+CThreadInterrupt g_socks5_interrupt;\r\n \r\n std::vector<CNetAddr> WrappedGetAddrInfo(const std::string& name, bool allow_lookup)\r\n {\r\n     addrinfo ai_hint{};\r\n     // We want a TCP port, which is a streaming socket type\r\n     ai_hint.ai_socktype = SOCK_STREAM;\r\n@@ -289,13 +289,13 @@ enum class IntrRecvError {\r\n  * @param sock The socket (has to be in non-blocking mode) from which to read bytes.\r\n  *\r\n  * @returns An IntrRecvError indicating the resulting status of this read.\r\n  *          IntrRecvError::OK only if all of the specified number of bytes were\r\n  *          read.\r\n  *\r\n- * @see This function can be interrupted by calling InterruptSocks5(bool).\r\n+ * @see This function can be interrupted by calling g_socks5_interrupt().\r\n  *      Sockets can be made non-blocking with Sock::SetNonBlocking().\r\n  */\r\n static IntrRecvError InterruptibleRecv(uint8_t* data, size_t len, std::chrono::milliseconds timeout, const Sock& sock)\r\n {\r\n     auto curTime{Now<SteadyMilliseconds>()};\r\n     const auto endTime{curTime + timeout};\r\n@@ -317,14 +317,15 @@ static IntrRecvError InterruptibleRecv(uint8_t* data, size_t len, std::chrono::m\r\n                     return IntrRecvError::NetworkError;\r\n                 }\r\n             } else {\r\n                 return IntrRecvError::NetworkError;\r\n             }\r\n         }\r\n-        if (interruptSocks5Recv)\r\n+        if (g_socks5_interrupt) {\r\n             return IntrRecvError::Interrupted;\r\n+        }\r\n         curTime = Now<SteadyMilliseconds>();\r\n     }\r\n     return len == 0 ? IntrRecvError::OK : IntrRecvError::Timeout;\r\n }\r\n \r\n /** Convert SOCKS5 reply to an error message */\r\n@@ -351,127 +352,120 @@ static std::string Socks5ErrorString(uint8_t err)\r\n             return \"unknown\";\r\n     }\r\n }\r\n \r\n bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* auth, const Sock& sock)\r\n {\r\n-    IntrRecvError recvr;\r\n-    LogPrint(BCLog::NET, \"SOCKS5 connecting %s\\n\", strDest);\r\n-    if (strDest.size() > 255) {\r\n-        return error(\"Hostname too long\");\r\n-    }\r\n-    // Construct the version identifier/method selection message\r\n-    std::vector<uint8_t> vSocks5Init;\r\n-    vSocks5Init.push_back(SOCKSVersion::SOCKS5); // We want the SOCK5 protocol\r\n-    if (auth) {\r\n-        vSocks5Init.push_back(0x02); // 2 method identifiers follow...\r\n-        vSocks5Init.push_back(SOCKS5Method::NOAUTH);\r\n-        vSocks5Init.push_back(SOCKS5Method::USER_PASS);\r\n-    } else {\r\n-        vSocks5Init.push_back(0x01); // 1 method identifier follows...\r\n-        vSocks5Init.push_back(SOCKS5Method::NOAUTH);\r\n-    }\r\n-    ssize_t ret = sock.Send(vSocks5Init.data(), vSocks5Init.size(), MSG_NOSIGNAL);\r\n-    if (ret != (ssize_t)vSocks5Init.size()) {\r\n-        return error(\"Error sending to proxy\");\r\n-    }\r\n-    uint8_t pchRet1[2];\r\n-    if (InterruptibleRecv(pchRet1, 2, g_socks5_recv_timeout, sock) != IntrRecvError::OK) {\r\n-        LogPrintf(\"Socks5() connect to %s:%d failed: InterruptibleRecv() timeout or other failure\\n\", strDest, port);\r\n-        return false;\r\n-    }\r\n-    if (pchRet1[0] != SOCKSVersion::SOCKS5) {\r\n-        return error(\"Proxy failed to initialize\");\r\n-    }\r\n-    if (pchRet1[1] == SOCKS5Method::USER_PASS && auth) {\r\n-        // Perform username/password authentication (as described in RFC1929)\r\n-        std::vector<uint8_t> vAuth;\r\n-        vAuth.push_back(0x01); // Current (and only) version of user/pass subnegotiation\r\n-        if (auth->username.size() > 255 || auth->password.size() > 255)\r\n-            return error(\"Proxy username or password too long\");\r\n-        vAuth.push_back(auth->username.size());\r\n-        vAuth.insert(vAuth.end(), auth->username.begin(), auth->username.end());\r\n-        vAuth.push_back(auth->password.size());\r\n-        vAuth.insert(vAuth.end(), auth->password.begin(), auth->password.end());\r\n-        ret = sock.Send(vAuth.data(), vAuth.size(), MSG_NOSIGNAL);\r\n-        if (ret != (ssize_t)vAuth.size()) {\r\n-            return error(\"Error sending authentication to proxy\");\r\n-        }\r\n-        LogPrint(BCLog::PROXY, \"SOCKS5 sending proxy authentication %s:%s\\n\", auth->username, auth->password);\r\n-        uint8_t pchRetA[2];\r\n-        if (InterruptibleRecv(pchRetA, 2, g_socks5_recv_timeout, sock) != IntrRecvError::OK) {\r\n-            return error(\"Error reading proxy authentication response\");\r\n+    try {\r\n+        IntrRecvError recvr;\r\n+        LogPrint(BCLog::NET, \"SOCKS5 connecting %s\\n\", strDest);\r\n+        if (strDest.size() > 255) {\r\n+            return error(\"Hostname too long\");\r\n         }\r\n-        if (pchRetA[0] != 0x01 || pchRetA[1] != 0x00) {\r\n-            return error(\"Proxy authentication unsuccessful\");\r\n+        // Construct the version identifier/method selection message\r\n+        std::string vSocks5Init;\r\n+        vSocks5Init.push_back(SOCKSVersion::SOCKS5); // We want the SOCK5 protocol\r\n+        if (auth) {\r\n+            vSocks5Init.push_back(0x02); // 2 method identifiers follow...\r\n+            vSocks5Init.push_back(SOCKS5Method::NOAUTH);\r\n+            vSocks5Init.push_back(SOCKS5Method::USER_PASS);\r\n+        } else {\r\n+            vSocks5Init.push_back(0x01); // 1 method identifier follows...\r\n+            vSocks5Init.push_back(SOCKS5Method::NOAUTH);\r\n         }\r\n-    } else if (pchRet1[1] == SOCKS5Method::NOAUTH) {\r\n-        // Perform no authentication\r\n-    } else {\r\n-        return error(\"Proxy requested wrong authentication method %02x\", pchRet1[1]);\r\n-    }\r\n-    std::vector<uint8_t> vSocks5;\r\n-    vSocks5.push_back(SOCKSVersion::SOCKS5); // VER protocol version\r\n-    vSocks5.push_back(SOCKS5Command::CONNECT); // CMD CONNECT\r\n-    vSocks5.push_back(0x00); // RSV Reserved must be 0\r\n-    vSocks5.push_back(SOCKS5Atyp::DOMAINNAME); // ATYP DOMAINNAME\r\n-    vSocks5.push_back(strDest.size()); // Length<=255 is checked at beginning of function\r\n-    vSocks5.insert(vSocks5.end(), strDest.begin(), strDest.end());\r\n-    vSocks5.push_back((port >> 8) & 0xFF);\r\n-    vSocks5.push_back((port >> 0) & 0xFF);\r\n-    ret = sock.Send(vSocks5.data(), vSocks5.size(), MSG_NOSIGNAL);\r\n-    if (ret != (ssize_t)vSocks5.size()) {\r\n-        return error(\"Error sending to proxy\");\r\n-    }\r\n-    uint8_t pchRet2[4];\r\n-    if ((recvr = InterruptibleRecv(pchRet2, 4, g_socks5_recv_timeout, sock)) != IntrRecvError::OK) {\r\n-        if (recvr == IntrRecvError::Timeout) {\r\n-            /* If a timeout happens here, this effectively means we timed out while connecting\r\n-             * to the remote node. This is very common for Tor, so do not print an\r\n-             * error message. */\r\n+        sock.SendComplete(vSocks5Init, g_socks5_recv_timeout, g_socks5_interrupt);\r\n+        uint8_t pchRet1[2];\r\n+        if (InterruptibleRecv(pchRet1, 2, g_socks5_recv_timeout, sock) != IntrRecvError::OK) {\r\n+            LogPrintf(\"Socks5() connect to %s:%d failed: InterruptibleRecv() timeout or other failure\\n\", strDest, port);\r\n             return false;\r\n+        }\r\n+        if (pchRet1[0] != SOCKSVersion::SOCKS5) {\r\n+            return error(\"Proxy failed to initialize\");\r\n+        }\r\n+        if (pchRet1[1] == SOCKS5Method::USER_PASS && auth) {\r\n+            // Perform username/password authentication (as described in RFC1929)\r\n+            std::string vAuth;\r\n+            vAuth.push_back(0x01); // Current (and only) version of user/pass subnegotiation\r\n+            if (auth->username.size() > 255 || auth->password.size() > 255)\r\n+                return error(\"Proxy username or password too long\");\r\n+            vAuth.push_back(auth->username.size());\r\n+            vAuth.insert(vAuth.end(), auth->username.begin(), auth->username.end());\r\n+            vAuth.push_back(auth->password.size());\r\n+            vAuth.insert(vAuth.end(), auth->password.begin(), auth->password.end());\r\n+            sock.SendComplete(vAuth, g_socks5_recv_timeout, g_socks5_interrupt);\r\n+            LogPrint(BCLog::PROXY, \"SOCKS5 sending proxy authentication %s:%s\\n\", auth->username, auth->password);\r\n+            uint8_t pchRetA[2];\r\n+            if (InterruptibleRecv(pchRetA, 2, g_socks5_recv_timeout, sock) != IntrRecvError::OK) {\r\n+                return error(\"Error reading proxy authentication response\");\r\n+            }\r\n+            if (pchRetA[0] != 0x01 || pchRetA[1] != 0x00) {\r\n+                return error(\"Proxy authentication unsuccessful\");\r\n+            }\r\n+        } else if (pchRet1[1] == SOCKS5Method::NOAUTH) {\r\n+            // Perform no authentication\r\n         } else {\r\n-            return error(\"Error while reading proxy response\");\r\n+            return error(\"Proxy requested wrong authentication method %02x\", pchRet1[1]);\r\n         }\r\n-    }\r\n-    if (pchRet2[0] != SOCKSVersion::SOCKS5) {\r\n-        return error(\"Proxy failed to accept request\");\r\n-    }\r\n-    if (pchRet2[1] != SOCKS5Reply::SUCCEEDED) {\r\n-        // Failures to connect to a peer that are not proxy errors\r\n-        LogPrintf(\"Socks5() connect to %s:%d failed: %s\\n\", strDest, port, Socks5ErrorString(pchRet2[1]));\r\n-        return false;\r\n-    }\r\n-    if (pchRet2[2] != 0x00) { // Reserved field must be 0\r\n-        return error(\"Error: malformed proxy response\");\r\n-    }\r\n-    uint8_t pchRet3[256];\r\n-    switch (pchRet2[3])\r\n-    {\r\n+        std::string vSocks5;\r\n+        vSocks5.push_back(SOCKSVersion::SOCKS5);   // VER protocol version\r\n+        vSocks5.push_back(SOCKS5Command::CONNECT); // CMD CONNECT\r\n+        vSocks5.push_back(0x00);                   // RSV Reserved must be 0\r\n+        vSocks5.push_back(SOCKS5Atyp::DOMAINNAME); // ATYP DOMAINNAME\r\n+        vSocks5.push_back(strDest.size());         // Length<=255 is checked at beginning of function\r\n+        vSocks5.insert(vSocks5.end(), strDest.begin(), strDest.end());\r\n+        vSocks5.push_back((port >> 8) & 0xFF);\r\n+        vSocks5.push_back((port >> 0) & 0xFF);\r\n+        sock.SendComplete(vSocks5, g_socks5_recv_timeout, g_socks5_interrupt);\r\n+        uint8_t pchRet2[4];\r\n+        if ((recvr = InterruptibleRecv(pchRet2, 4, g_socks5_recv_timeout, sock)) != IntrRecvError::OK) {\r\n+            if (recvr == IntrRecvError::Timeout) {\r\n+                /* If a timeout happens here, this effectively means we timed out while connecting\r\n+                 * to the remote node. This is very common for Tor, so do not print an\r\n+                 * error message. */\r\n+                return false;\r\n+            } else {\r\n+                return error(\"Error while reading proxy response\");\r\n+            }\r\n+        }\r\n+        if (pchRet2[0] != SOCKSVersion::SOCKS5) {\r\n+            return error(\"Proxy failed to accept request\");\r\n+        }\r\n+        if (pchRet2[1] != SOCKS5Reply::SUCCEEDED) {\r\n+            // Failures to connect to a peer that are not proxy errors\r\n+            LogPrintf(\"Socks5() connect to %s:%d failed: %s\\n\", strDest, port, Socks5ErrorString(pchRet2[1]));\r\n+            return false;\r\n+        }\r\n+        if (pchRet2[2] != 0x00) { // Reserved field must be 0\r\n+            return error(\"Error: malformed proxy response\");\r\n+        }\r\n+        uint8_t pchRet3[256];\r\n+        switch (pchRet2[3]) {\r\n         case SOCKS5Atyp::IPV4: recvr = InterruptibleRecv(pchRet3, 4, g_socks5_recv_timeout, sock); break;\r\n         case SOCKS5Atyp::IPV6: recvr = InterruptibleRecv(pchRet3, 16, g_socks5_recv_timeout, sock); break;\r\n-        case SOCKS5Atyp::DOMAINNAME:\r\n-        {\r\n+        case SOCKS5Atyp::DOMAINNAME: {\r\n             recvr = InterruptibleRecv(pchRet3, 1, g_socks5_recv_timeout, sock);\r\n             if (recvr != IntrRecvError::OK) {\r\n                 return error(\"Error reading from proxy\");\r\n             }\r\n             int nRecv = pchRet3[0];\r\n             recvr = InterruptibleRecv(pchRet3, nRecv, g_socks5_recv_timeout, sock);\r\n             break;\r\n         }\r\n         default: return error(\"Error: malformed proxy response\");\r\n+        }\r\n+        if (recvr != IntrRecvError::OK) {\r\n+            return error(\"Error reading from proxy\");\r\n+        }\r\n+        if (InterruptibleRecv(pchRet3, 2, g_socks5_recv_timeout, sock) != IntrRecvError::OK) {\r\n+            return error(\"Error reading from proxy\");\r\n+        }\r\n+        LogPrint(BCLog::NET, \"SOCKS5 connected %s\\n\", strDest);\r\n+        return true;\r\n+    } catch (const std::runtime_error& e) {\r\n+        return error(\"Error during SOCKS5 proxy handshake: %s\", e.what());\r\n     }\r\n-    if (recvr != IntrRecvError::OK) {\r\n-        return error(\"Error reading from proxy\");\r\n-    }\r\n-    if (InterruptibleRecv(pchRet3, 2, g_socks5_recv_timeout, sock) != IntrRecvError::OK) {\r\n-        return error(\"Error reading from proxy\");\r\n-    }\r\n-    LogPrint(BCLog::NET, \"SOCKS5 connected %s\\n\", strDest);\r\n-    return true;\r\n }\r\n \r\n std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family)\r\n {\r\n     // Not IPv4, IPv6 or UNIX\r\n     if (address_family == AF_UNSPEC) return nullptr;\r\n@@ -743,17 +737,12 @@ bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out)\r\n             return subnet_out.IsValid();\r\n         }\r\n     }\r\n     return false;\r\n }\r\n \r\n-void InterruptSocks5(bool interrupt)\r\n-{\r\n-    interruptSocks5Recv = interrupt;\r\n-}\r\n-\r\n bool IsBadPort(uint16_t port)\r\n {\r\n     /* Don't forget to update doc/p2p-bad-ports.md if you change this list. */\r\n \r\n     switch (port) {\r\n     case 1:     // tcpmux\r\ndiff --git a/src/netbase.h b/src/netbase.h\r\nindex 997bccf30d..3c41ba3834 100644\r\n--- a/src/netbase.h\r\n+++ b/src/netbase.h\r\n@@ -10,12 +10,13 @@\r\n #endif\r\n \r\n #include <compat/compat.h>\r\n #include <netaddress.h>\r\n #include <serialize.h>\r\n #include <util/sock.h>\r\n+#include <util/threadinterrupt.h>\r\n \r\n #include <functional>\r\n #include <memory>\r\n #include <stdint.h>\r\n #include <string>\r\n #include <type_traits>\r\n@@ -266,13 +267,16 @@ std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connecti\r\n  */\r\n std::unique_ptr<Sock> ConnectThroughProxy(const Proxy& proxy,\r\n                                           const std::string& dest,\r\n                                           uint16_t port,\r\n                                           bool& proxy_connection_failed);\r\n \r\n-void InterruptSocks5(bool interrupt);\r\n+/**\r\n+ * Interrupt SOCKS5 reads or writes.\r\n+ */\r\n+extern CThreadInterrupt g_socks5_interrupt;\r\n \r\n /**\r\n  * Connect to a specified destination service through an already connected\r\n  * SOCKS5 proxy.\r\n  *\r\n  * @param strDest The destination fully-qualified domain name.\r\ndiff --git a/src/test/fuzz/socks5.cpp b/src/test/fuzz/socks5.cpp\r\nindex 73235b7ced..7378cec7b8 100644\r\n--- a/src/test/fuzz/socks5.cpp\r\n+++ b/src/test/fuzz/socks5.cpp\r\n@@ -29,13 +29,15 @@ void initialize_socks5()\r\n FUZZ_TARGET_INIT(socks5, initialize_socks5)\r\n {\r\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\r\n     ProxyCredentials proxy_credentials;\r\n     proxy_credentials.username = fuzzed_data_provider.ConsumeRandomLengthString(512);\r\n     proxy_credentials.password = fuzzed_data_provider.ConsumeRandomLengthString(512);\r\n-    InterruptSocks5(fuzzed_data_provider.ConsumeBool());\r\n+    if (fuzzed_data_provider.ConsumeBool()) {\r\n+        g_socks5_interrupt();\r\n+    }\r\n     // Set FUZZED_SOCKET_FAKE_LATENCY=1 to exercise recv timeout code paths. This\r\n     // will slow down fuzzing.\r\n     g_socks5_recv_timeout = (fuzzed_data_provider.ConsumeBool() && std::getenv(\"FUZZED_SOCKET_FAKE_LATENCY\") != nullptr) ? 1ms : default_socks5_recv_timeout;\r\n     FuzzedSock fuzzed_sock = ConsumeSock(fuzzed_data_provider);\r\n     // This Socks5(...) fuzzing harness would have caught CVE-2017-18350 within\r\n     // a few seconds of fuzzing.\r\n```\r\n</details>",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T12:27:12Z",
      "diff_hunk" : "@@ -483,21 +506,25 @@ std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n     }\n #endif\n \n-    // Set the no-delay option (disable Nagle's algorithm) on the TCP socket.\n-    const int on{1};\n-    if (sock->SetSockOpt(IPPROTO_TCP, TCP_NODELAY, &on, sizeof(on)) == SOCKET_ERROR) {\n-        LogPrint(BCLog::NET, \"Unable to set TCP_NODELAY on a newly created socket, continuing anyway\\n\");\n-    }\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX) return sock;\n+#endif\n \n     // Set the non-blocking option on the socket.\n     if (!sock->SetNonBlocking()) {\n         LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\n         return nullptr;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262486665",
      "id" : 1262486665,
      "line" : 517,
      "node_id" : "PRRC_kwDOABII585LQASJ",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 517,
      "original_position" : 83,
      "original_start_line" : 509,
      "path" : "src/netbase.cpp",
      "position" : 83,
      "pull_request_review_id" : 1527850665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262486665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 509,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T12:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262486665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262608123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262608123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:00:46Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262608123",
      "id" : 1262608123,
      "in_reply_to_id" : 1262178924,
      "line" : 608,
      "node_id" : "PRRC_kwDOABII585LQd77",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 608,
      "original_position" : 195,
      "original_start_line" : 605,
      "path" : "src/netbase.cpp",
      "position" : 195,
      "pull_request_review_id" : 1528526825,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262608123/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 605,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:00:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262608123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262624822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262624822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah great thanks",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:13:21Z",
      "diff_hunk" : "@@ -509,22 +536,10 @@ static void LogConnectFailure(bool manual_connection, const char* fmt, const Arg\n     }\n }\n \n-bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nTimeout, bool manual_connection)\n+std::unique_ptr<Sock> ConnectToSocket(std::unique_ptr<Sock> sock, struct sockaddr* sockaddr, socklen_t len, std::string dest_str, bool manual_connection)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262624822",
      "id" : 1262624822,
      "in_reply_to_id" : 1262322061,
      "line" : 539,
      "node_id" : "PRRC_kwDOABII585LQiA2",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 539,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 103,
      "pull_request_review_id" : 1528553195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262624822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:13:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262624822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262625689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262625689"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":+1:",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:13:57Z",
      "diff_hunk" : "@@ -509,22 +536,10 @@ static void LogConnectFailure(bool manual_connection, const char* fmt, const Arg\n     }\n }\n \n-bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nTimeout, bool manual_connection)\n+std::unique_ptr<Sock> ConnectToSocket(std::unique_ptr<Sock> sock, struct sockaddr* sockaddr, socklen_t len, std::string dest_str, bool manual_connection)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262625689",
      "id" : 1262625689,
      "in_reply_to_id" : 1262327319,
      "line" : 539,
      "node_id" : "PRRC_kwDOABII585LQiOZ",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 539,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 103,
      "pull_request_review_id" : 1528554609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262625689/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:13:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262625689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262632689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262632689"
         }
      },
      "author_association" : "MEMBER",
      "body" : "good catch thanks",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:18:29Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262632689",
      "id" : 1262632689,
      "in_reply_to_id" : 1262362898,
      "line" : 619,
      "node_id" : "PRRC_kwDOABII585LQj7x",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 619,
      "original_position" : 206,
      "original_start_line" : 617,
      "path" : "src/netbase.cpp",
      "position" : 206,
      "pull_request_review_id" : 1528568171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262632689/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 617,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:18:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262632689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262645801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262645801"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah, thanks. I had a hard time with this one for some reason because casting to `sockaddr` kept truncating the unix socket path to 14 bytes before it got to `Connect()`. Anyway this works and I don't know why I didn't try it like this at first.",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:27:38Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_storage sockaddr;\n+    struct sockaddr_un* paddrun = (struct sockaddr_un*)&sockaddr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262645801",
      "id" : 1262645801,
      "in_reply_to_id" : 1262368024,
      "line" : 630,
      "node_id" : "PRRC_kwDOABII585LQnIp",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 630,
      "original_position" : 217,
      "original_start_line" : 629,
      "path" : "src/netbase.cpp",
      "position" : 217,
      "pull_request_review_id" : 1528588236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262645801/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 629,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:27:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262645801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262653604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262653604"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok thanks I added the preprocessor logic to the function.\r\n\r\nI'll look into adding afunix.h for windows, maybe in compat.h? also add it to the first commit to test for AF_UNIX in configure.ac. Might be better in a follow-up PR since not all windows platforms will have afunix.h and well need to test for it",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:33:15Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262653604",
      "id" : 1262653604,
      "in_reply_to_id" : 1262371026,
      "line" : 621,
      "node_id" : "PRRC_kwDOABII585LQpCk",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 621,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 208,
      "pull_request_review_id" : 1528600581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262653604/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:39:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262653604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262664857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262664857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "great catch thanks yeah I saw that in your commit but I was confused. makes sense now",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:41:34Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_storage sockaddr;\n+    struct sockaddr_un* paddrun = (struct sockaddr_un*)&sockaddr;\n+    paddrun->sun_family = AF_UNIX;\n+    strcpy(paddrun->sun_path, path.c_str());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262664857",
      "id" : 1262664857,
      "in_reply_to_id" : 1262372825,
      "line" : 632,
      "node_id" : "PRRC_kwDOABII585LQryZ",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 632,
      "original_position" : 219,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 219,
      "pull_request_review_id" : 1528618525,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262664857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:41:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262664857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262667486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262667486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "got it thanks, fixed this when changing sockaddr_storage to sockaddr_un and it's now `addrun`",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:43:33Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_storage sockaddr;\n+    struct sockaddr_un* paddrun = (struct sockaddr_un*)&sockaddr;\n+    paddrun->sun_family = AF_UNIX;\n+    strcpy(paddrun->sun_path, path.c_str());\n+    socklen_t len = strlen(paddrun->sun_path) + sizeof(paddrun);\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, path, /*manual_connection=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262667486",
      "id" : 1262667486,
      "in_reply_to_id" : 1262417198,
      "line" : 635,
      "node_id" : "PRRC_kwDOABII585LQsbe",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 635,
      "original_position" : 222,
      "original_start_line" : 633,
      "path" : "src/netbase.cpp",
      "position" : 222,
      "pull_request_review_id" : 1528622653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262667486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 633,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:43:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262667486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262690201"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262690201"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok fixed this, just using default (with auth) for the test",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T14:59:11Z",
      "diff_hunk" : "@@ -109,10 +127,15 @@ def setup_nodes(self):\n             ['-listen', f'-proxy={self.conf2.addr[0]}:{self.conf2.addr[1]}','-proxyrandomize=1'],\n             [],\n             ['-listen', f'-proxy={self.conf1.addr[0]}:{self.conf1.addr[1]}','-proxyrandomize=1',\n-                '-cjdnsreachable']\n+                '-cjdnsreachable'],\n+            [],\n+            []\n         ]\n         if self.have_ipv6:\n             args[3] = ['-listen', f'-proxy=[{self.conf3.addr[0]}]:{self.conf3.addr[1]}','-proxyrandomize=0', '-noonion']\n+        if self.have_unix_sockets:\n+            args[5] = ['-listen', f'-proxy=unix:{socket_path}', '-proxyrandomize=0']\n+            args[6] = ['-listen', f'-onion=unix:{socket_path}', '-proxyrandomize=0']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262690201",
      "id" : 1262690201,
      "in_reply_to_id" : 1262422280,
      "line" : 138,
      "node_id" : "PRRC_kwDOABII585LQx-Z",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 138,
      "original_position" : 85,
      "original_start_line" : 136,
      "path" : "test/functional/feature_proxy.py",
      "position" : 85,
      "pull_request_review_id" : 1528660306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262690201/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 136,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T14:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262690201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262751862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262751862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah sorry",
      "commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "created_at" : "2023-07-13T15:47:33Z",
      "diff_hunk" : "@@ -230,6 +253,13 @@ def run_test(self):\n             proxies=[self.serv1, self.serv1, self.serv1, self.serv1],\n             auth=False, test_onion=True, test_cjdns=True)\n \n+        # -proxyrandomize=0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262751862",
      "id" : 1262751862,
      "in_reply_to_id" : 1262421705,
      "line" : 256,
      "node_id" : "PRRC_kwDOABII585LRBB2",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 256,
      "original_position" : 138,
      "original_start_line" : null,
      "path" : "test/functional/feature_proxy.py",
      "position" : 138,
      "pull_request_review_id" : 1528755489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262751862/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T15:47:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262751862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262927938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262927938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok adding two commits to handle these two affected areas. For the GUI I've written logic that accommodates the new Proxy features but I'll have to submit a follow-up PR to enable unix socket path configuration from the GUI as a separate element from address:port proxy configuration. \r\n\r\nSo with this only PR, the user can only set unix sockets outside the GUI, and in the network tab they will see `\"Options set in this dialog are overridden by the command line...\"` anyway.",
      "commit_id" : "42fba1653f96b3a0c76fced4a62d35ca9ea1a5aa",
      "created_at" : "2023-07-13T18:33:53Z",
      "diff_hunk" : "@@ -45,16 +48,46 @@ static inline bool operator&(ConnectionDirection a, ConnectionDirection b) {\n     return (underlying(a) & underlying(b));\n }\n \n+/**\n+ * Check if a string is a valid UNIX domain socket path\n+ *\n+ * @param      name     The string provided by the user representing a local path\n+ *\n+ * @returns Whether the string has proper format, length, and points to an existing file path\n+ */\n+bool IsUnixSocketPath(const std::string& name);\n+\n class Proxy\n {\n public:\n-    Proxy(): randomize_credentials(false) {}\n-    explicit Proxy(const CService &_proxy, bool _randomize_credentials=false): proxy(_proxy), randomize_credentials(_randomize_credentials) {}\n-\n-    bool IsValid() const { return proxy.IsValid(); }\n+    Proxy() : m_is_unix_socket(false), m_randomize_credentials(false) {}\n+    explicit Proxy(const CService& _proxy, bool _randomize_credentials = false) : proxy(_proxy), m_is_unix_socket(false), m_randomize_credentials(_randomize_credentials) {}\n+    explicit Proxy(const std::string path, bool _randomize_credentials = false) : m_unix_socket_path(path), m_is_unix_socket(true), m_randomize_credentials(_randomize_credentials) {}\n \n     CService proxy;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262927938",
      "id" : 1262927938,
      "in_reply_to_id" : 1262436716,
      "line" : 68,
      "node_id" : "PRRC_kwDOABII585LRsBC",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 67,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 42,
      "pull_request_review_id" : 1529039444,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262927938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T18:33:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262927938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262930258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262930258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok I'll put this statement after `SetNonBlocking()` but I think the Socks5 stuff should live in a follow-up PR?",
      "commit_id" : "42fba1653f96b3a0c76fced4a62d35ca9ea1a5aa",
      "created_at" : "2023-07-13T18:36:40Z",
      "diff_hunk" : "@@ -483,21 +506,25 @@ std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n     }\n #endif\n \n-    // Set the no-delay option (disable Nagle's algorithm) on the TCP socket.\n-    const int on{1};\n-    if (sock->SetSockOpt(IPPROTO_TCP, TCP_NODELAY, &on, sizeof(on)) == SOCKET_ERROR) {\n-        LogPrint(BCLog::NET, \"Unable to set TCP_NODELAY on a newly created socket, continuing anyway\\n\");\n-    }\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX) return sock;\n+#endif\n \n     // Set the non-blocking option on the socket.\n     if (!sock->SetNonBlocking()) {\n         LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\n         return nullptr;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1262930258",
      "id" : 1262930258,
      "in_reply_to_id" : 1262486665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LRslS",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 513,
      "original_position" : 83,
      "original_start_line" : 509,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1529043178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262930258/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T18:36:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262930258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1263941686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263941686"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This resulted in `netbase.cpp:415:27: runtime error: implicit conversion from type 'int' of value 210 (32-bit, signed) to type 'char' changed the value to -46 (8-bit, signed)`. This is ok in practice because the data is transferred as bytes anyway over the socket (not as integers). Anyway, to silence the sanitizer:\r\n\r\n<details>\r\n<summary>[patch] sock: introduce a generic Sock::SendComplete(const void*, size_t, ...)</summary>\r\n\r\n```diff\r\ncommit 8467080a08327aaf0d853a73412456c44558a9b3\r\nParent: af4eb52ff611342dbd285f218474649f16badbaf\r\nAuthor:     Vasil Dimov <vd@FreeBSD.org>\r\nAuthorDate: Fri Jul 14 18:36:34 2023 +0200\r\nCommit:     Vasil Dimov <vd@FreeBSD.org>\r\nCommitDate: Fri Jul 14 18:36:34 2023 +0200\r\ngpg: Signature made Fri Jul 14 18:38:55 2023 CEST\r\ngpg:                using RSA key E64D8D45614DB07545D9CCC154DF06F64B55CBBF\r\ngpg: Good signature from \"Vasil Dimov <vd@myforest.net>\" [ultimate]\r\ngpg:                 aka \"Vasil Dimov <vd@FreeBSD.org>\" [ultimate]\r\ngpg:                 aka \"Vasil Dimov <vasild@gmail.com>\" [ultimate]\r\n\r\n\r\n    sock: introduce a generic Sock::SendComplete(const void*, size_t, ...)\r\n    \r\n    Use that in `Sock::SendComplete(const std::string&, ...)` and introduce\r\n    a new `Sock::SendComplete(const std::vector<uint8_t>&, ...)` to be used\r\n    in the `Socks5()` function.\r\n\r\ndiff --git a/src/util/sock.cpp b/src/util/sock.cpp\r\nindex c83869bc77..6cf1b84f18 100644\r\n--- a/src/util/sock.cpp\r\n+++ b/src/util/sock.cpp\r\n@@ -248,25 +248,26 @@ bool Sock::WaitMany(std::chrono::milliseconds timeout, EventsPerSock& events_per\r\n     }\r\n \r\n     return true;\r\n #endif /* USE_POLL */\r\n }\r\n \r\n-void Sock::SendComplete(const std::string& data,\r\n+void Sock::SendComplete(const void* data,\r\n+                        size_t len,\r\n                         std::chrono::milliseconds timeout,\r\n                         CThreadInterrupt& interrupt) const\r\n {\r\n     const auto deadline = GetTime<std::chrono::milliseconds>() + timeout;\r\n     size_t sent{0};\r\n \r\n     for (;;) {\r\n-        const ssize_t ret{Send(data.data() + sent, data.size() - sent, MSG_NOSIGNAL)};\r\n+        const ssize_t ret{Send(static_cast<const uint8_t*>(data) + sent, len - sent, MSG_NOSIGNAL)};\r\n \r\n         if (ret > 0) {\r\n             sent += static_cast<size_t>(ret);\r\n-            if (sent == data.size()) {\r\n+            if (sent == len) {\r\n                 break;\r\n             }\r\n         } else {\r\n             const int err{WSAGetLastError()};\r\n             if (IOErrorIsPermanent(err)) {\r\n                 throw std::runtime_error(strprintf(\"send(): %s\", NetworkErrorString(err)));\r\n@@ -274,27 +275,41 @@ void Sock::SendComplete(const std::string& data,\r\n         }\r\n \r\n         const auto now = GetTime<std::chrono::milliseconds>();\r\n \r\n         if (now >= deadline) {\r\n             throw std::runtime_error(strprintf(\r\n-                \"Send timeout (sent only %u of %u bytes before that)\", sent, data.size()));\r\n+                \"Send timeout (sent only %u of %u bytes before that)\", sent, len));\r\n         }\r\n \r\n         if (interrupt) {\r\n             throw std::runtime_error(strprintf(\r\n-                \"Send interrupted (sent only %u of %u bytes before that)\", sent, data.size()));\r\n+                \"Send interrupted (sent only %u of %u bytes before that)\", sent, len));\r\n         }\r\n \r\n         // Wait for a short while (or the socket to become ready for sending) before retrying\r\n         // if nothing was sent.\r\n         const auto wait_time = std::min(deadline - now, std::chrono::milliseconds{MAX_WAIT_FOR_IO});\r\n         (void)Wait(wait_time, SEND);\r\n     }\r\n }\r\n \r\n+void Sock::SendComplete(const std::string& data,\r\n+                        std::chrono::milliseconds timeout,\r\n+                        CThreadInterrupt& interrupt) const\r\n+{\r\n+    SendComplete(data.data(), data.size(), timeout, interrupt);\r\n+}\r\n+\r\n+void Sock::SendComplete(const std::vector<uint8_t>& data,\r\n+                        std::chrono::milliseconds timeout,\r\n+                        CThreadInterrupt& interrupt) const\r\n+{\r\n+    SendComplete(data.data(), data.size(), timeout, interrupt);\r\n+}\r\n+\r\n std::string Sock::RecvUntilTerminator(uint8_t terminator,\r\n                                       std::chrono::milliseconds timeout,\r\n                                       CThreadInterrupt& interrupt,\r\n                                       size_t max_data) const\r\n {\r\n     const auto deadline = GetTime<std::chrono::milliseconds>() + timeout;\r\ndiff --git a/src/util/sock.h b/src/util/sock.h\r\nindex 6bac2dfd34..7f7b426665 100644\r\n--- a/src/util/sock.h\r\n+++ b/src/util/sock.h\r\n@@ -230,21 +230,37 @@ public:\r\n \r\n     /* Higher level, convenience, methods. These may throw. */\r\n \r\n     /**\r\n      * Send the given data, retrying on transient errors.\r\n      * @param[in] data Data to send.\r\n+     * @param[in] len Length of the data in bytes.\r\n      * @param[in] timeout Timeout for the entire operation.\r\n      * @param[in] interrupt If this is signaled then the operation is canceled.\r\n      * @throws std::runtime_error if the operation cannot be completed. In this case only some of\r\n      * the data will be written to the socket.\r\n      */\r\n+    virtual void SendComplete(const void* data,\r\n+                              size_t len,\r\n+                              std::chrono::milliseconds timeout,\r\n+                              CThreadInterrupt& interrupt) const;\r\n+\r\n+    /**\r\n+     * Convenience method, equivalent to `SendComplete(data.data(), data.size(), timeout, interrupt)`.\r\n+     */\r\n     virtual void SendComplete(const std::string& data,\r\n                               std::chrono::milliseconds timeout,\r\n                               CThreadInterrupt& interrupt) const;\r\n \r\n+    /**\r\n+     * Convenience method, equivalent to `SendComplete(data.data(), data.size(), timeout, interrupt)`.\r\n+     */\r\n+    virtual void SendComplete(const std::vector<uint8_t>& data,\r\n+                              std::chrono::milliseconds timeout,\r\n+                              CThreadInterrupt& interrupt) const;\r\n+\r\n     /**\r\n      * Read from socket until a terminator character is encountered. Will never consume bytes past\r\n      * the terminator from the socket.\r\n      * @param[in] terminator Character up to which to read from the socket.\r\n      * @param[in] timeout Timeout for the entire operation.\r\n      * @param[in] interrupt If this is signaled then the operation is canceled.\r\n```\r\n\r\nAlso in this branch: https://github.com/vasild/bitcoin/tree/tor-unix-domain-socket (the second commit)\r\n</details>\r\n\r\nand adapt `Socks5()` to use `std::vector<uint8_t>` for the arguments it passes to `SendComplete()` (done in the last commit of https://github.com/vasild/bitcoin/tree/tor-unix-domain-socket).\r\n\r\nThat is, I think the two topmost commits from https://github.com/vasild/bitcoin/tree/tor-unix-domain-socket should be the first commits in this PR.",
      "commit_id" : "42fba1653f96b3a0c76fced4a62d35ca9ea1a5aa",
      "created_at" : "2023-07-14T16:52:57Z",
      "diff_hunk" : "@@ -483,21 +506,25 @@ std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n     }\n #endif\n \n-    // Set the no-delay option (disable Nagle's algorithm) on the TCP socket.\n-    const int on{1};\n-    if (sock->SetSockOpt(IPPROTO_TCP, TCP_NODELAY, &on, sizeof(on)) == SOCKET_ERROR) {\n-        LogPrint(BCLog::NET, \"Unable to set TCP_NODELAY on a newly created socket, continuing anyway\\n\");\n-    }\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX) return sock;\n+#endif\n \n     // Set the non-blocking option on the socket.\n     if (!sock->SetNonBlocking()) {\n         LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\n         return nullptr;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1263941686",
      "id" : 1263941686,
      "in_reply_to_id" : 1262486665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LVjg2",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 513,
      "original_position" : 83,
      "original_start_line" : 509,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1530635524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263941686/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-14T16:52:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263941686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1264030502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264030502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Now its ` ERROR: Error during SOCKS5 proxy handshake: send(): Transport endpoint is not connected (107)` I'm still digging in to this...",
      "commit_id" : "d31a456adef14f7c1cc0ea81569b5457ff2f4ad8",
      "created_at" : "2023-07-14T18:33:17Z",
      "diff_hunk" : "@@ -483,21 +506,25 @@ std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n     }\n #endif\n \n-    // Set the no-delay option (disable Nagle's algorithm) on the TCP socket.\n-    const int on{1};\n-    if (sock->SetSockOpt(IPPROTO_TCP, TCP_NODELAY, &on, sizeof(on)) == SOCKET_ERROR) {\n-        LogPrint(BCLog::NET, \"Unable to set TCP_NODELAY on a newly created socket, continuing anyway\\n\");\n-    }\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX) return sock;\n+#endif\n \n     // Set the non-blocking option on the socket.\n     if (!sock->SetNonBlocking()) {\n         LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\n         return nullptr;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1264030502",
      "id" : 1264030502,
      "in_reply_to_id" : 1262486665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LV5Mm",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 507,
      "original_position" : 83,
      "original_start_line" : 509,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1530788647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264030502/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-14T18:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264030502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild OK I got this branch passing all CI. â  I ran tests locally on Ubuntu and MacOS and also tested the feature in production on both platforms with `tor --SocksPort unix:/...` Everything is working! yay.\r\n\r\nThe real fix was here actually (diff below) Embarrassingly simple. This was a bug on Linux but NOT on macOS.\r\n\r\nI did not need the `SendComplete` changes or `Socks5` changes which is great because that keeps review simple and the branch focused. I will be happy to review those changes if you want to open a new PR for them (or I can open it if you like)\r\n\r\nThe only other new change to the branch besides this is adding a release note and explanation in help text for `-onion` and `-proxy`\r\n\r\n```diff\r\ndiff --git a/src/netbase.cpp b/src/netbase.cpp\r\nindex a49f882130..044b0ba6c3 100644\r\n--- a/src/netbase.cpp\r\n+++ b/src/netbase.cpp\r\n@@ -638,7 +638,7 @@ std::unique_ptr<Sock> Proxy::Connect() const\r\n     addrun.sun_family = AF_UNIX;\r\n     // leave the last char in addrun.sun_path[] to be always '\\0'\r\n     memcpy(addrun.sun_path, path.c_str(), std::min(sizeof(addrun.sun_path) - 1, path.length()));\r\n-    socklen_t len = strlen(addrun.sun_path) + sizeof(addrun);\r\n+    socklen_t len = sizeof(addrun);\r\n \r\n     if(!ConnectToSocket(*sock, (struct sockaddr*)&addrun, len, path, /*manual_connection=*/true)) {\r\n         LogPrintf(\"Cannot connect to socket for %s\\n\", path);\r\n```",
      "created_at" : "2023-07-16T16:13:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1637129953",
      "id" : 1637129953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585hlJ7h",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1637129953/reactions"
      },
      "updated_at" : "2023-07-16T16:13:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1637129953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1265260663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265260663"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Transport endpoint is not connected\r\n\r\nIs this still a problem or it got resolved?",
      "commit_id" : "f74da5eba9192e219567ab753c92b6cd2e66f73b",
      "created_at" : "2023-07-17T12:13:01Z",
      "diff_hunk" : "@@ -483,21 +506,25 @@ std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n     }\n #endif\n \n-    // Set the no-delay option (disable Nagle's algorithm) on the TCP socket.\n-    const int on{1};\n-    if (sock->SetSockOpt(IPPROTO_TCP, TCP_NODELAY, &on, sizeof(on)) == SOCKET_ERROR) {\n-        LogPrint(BCLog::NET, \"Unable to set TCP_NODELAY on a newly created socket, continuing anyway\\n\");\n-    }\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX) return sock;\n+#endif\n \n     // Set the non-blocking option on the socket.\n     if (!sock->SetNonBlocking()) {\n         LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\n         return nullptr;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1265260663",
      "id" : 1265260663,
      "in_reply_to_id" : 1262486665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Lalh3",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 513,
      "original_position" : 83,
      "original_start_line" : 509,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1532636721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265260663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-17T12:13:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265260663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1265268347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265268347"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Resolved!",
      "commit_id" : "f74da5eba9192e219567ab753c92b6cd2e66f73b",
      "created_at" : "2023-07-17T12:18:34Z",
      "diff_hunk" : "@@ -483,21 +506,25 @@ std::unique_ptr<Sock> CreateSockTCP(const CService& address_family)\n     }\n #endif\n \n-    // Set the no-delay option (disable Nagle's algorithm) on the TCP socket.\n-    const int on{1};\n-    if (sock->SetSockOpt(IPPROTO_TCP, TCP_NODELAY, &on, sizeof(on)) == SOCKET_ERROR) {\n-        LogPrint(BCLog::NET, \"Unable to set TCP_NODELAY on a newly created socket, continuing anyway\\n\");\n-    }\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX) return sock;\n+#endif\n \n     // Set the non-blocking option on the socket.\n     if (!sock->SetNonBlocking()) {\n         LogPrintf(\"Error setting socket to non-blocking: %s\\n\", NetworkErrorString(WSAGetLastError()));\n         return nullptr;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1265268347",
      "id" : 1265268347,
      "in_reply_to_id" : 1262486665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LanZ7",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 513,
      "original_position" : 83,
      "original_start_line" : 509,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1532647334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265268347/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-17T12:18:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265268347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1268106550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268106550"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In the latest code it is:\r\n\r\n```cpp\r\n      socklen_t len = sizeof(addrun);\r\n  \r\n      if(!ConnectToSocket(*sock, (struct sockaddr*)&addrun, len, path, /*manual_connection=*/true)) {\r\n```\r\n\r\nfeel free to ditch the `len` variable and use `sizeof(addrun)` directly when calling `ConnectToSocket()`.",
      "commit_id" : "d8f993b77d2f0bad0e7a5659885ffbbd9f75dbec",
      "created_at" : "2023-07-19T13:49:30Z",
      "diff_hunk" : "@@ -569,11 +584,55 @@ bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nT\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", addrConnect.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return false;\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return {};\n         }\n     }\n-    return true;\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (sock->Get() == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection);\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_storage sockaddr;\n+    struct sockaddr_un* paddrun = (struct sockaddr_un*)&sockaddr;\n+    paddrun->sun_family = AF_UNIX;\n+    strcpy(paddrun->sun_path, path.c_str());\n+    socklen_t len = strlen(paddrun->sun_path) + sizeof(paddrun);\n+\n+    return ConnectToSocket(std::move(sock), (struct sockaddr*)&sockaddr, len, path, /*manual_connection=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1268106550",
      "id" : 1268106550,
      "in_reply_to_id" : 1262417198,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LlcU2",
      "original_commit_id" : "b1199bce0fda452a8d24c1753ffdea3c327701ff",
      "original_line" : 635,
      "original_position" : 222,
      "original_start_line" : 633,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1537148388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268106550/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-19T13:49:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268106550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1268148641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268148641"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We have already checked if UNIX sockets are supported.\r\n\r\n```cpp\r\n#if HAVE_SOCKADDR_UN\r\n    argsman.AddArg(\"-onion=<ip:port|path>\", \"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy). May be a local file path prefixed with 'unix:'.\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\r\n#else\r\n    argsman.AddArg(\"-onion=<ip:port>\", \"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\r\n#endif\r\n```",
      "commit_id" : "d8f993b77d2f0bad0e7a5659885ffbbd9f75dbec",
      "created_at" : "2023-07-19T14:19:42Z",
      "diff_hunk" : "@@ -492,7 +492,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-maxsendbuffer=<n>\", strprintf(\"Maximum per-connection send buffer, <n>*1000 bytes (default: %u)\", DEFAULT_MAXSENDBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxtimeadjustment\", strprintf(\"Maximum allowed median peer time offset adjustment. Local perspective of time may be influenced by outbound peers forward or backward by this amount (default: %u seconds).\", DEFAULT_MAX_TIME_ADJUSTMENT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxuploadtarget=<n>\", strprintf(\"Tries to keep outbound traffic under the given target per 24h. Limit does not apply to peers with 'download' permission or blocks created within past week. 0 = no limit (default: %s). Optional suffix units [k|K|m|M|g|G|t|T] (default: M). Lowercase is 1000 base while uppercase is 1024 base\", DEFAULT_MAX_UPLOAD_TARGET), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    argsman.AddArg(\"-onion=<ip:port>\", \"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-onion=<ip:port|path>\", \"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy). May be a local file path prefixed with 'unix:' if UNIX domain sockets are supported by the platform.\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1268148641",
      "id" : 1268148641,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Llmmh",
      "original_commit_id" : "f74da5eba9192e219567ab753c92b6cd2e66f73b",
      "original_line" : 495,
      "original_position" : 5,
      "original_start_line" : 495,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1537217507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268148641/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-07-19T14:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268148641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1268326494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268326494"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah of course thanks, fixed and pushed",
      "commit_id" : "d8f993b77d2f0bad0e7a5659885ffbbd9f75dbec",
      "created_at" : "2023-07-19T16:32:29Z",
      "diff_hunk" : "@@ -492,7 +492,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-maxsendbuffer=<n>\", strprintf(\"Maximum per-connection send buffer, <n>*1000 bytes (default: %u)\", DEFAULT_MAXSENDBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxtimeadjustment\", strprintf(\"Maximum allowed median peer time offset adjustment. Local perspective of time may be influenced by outbound peers forward or backward by this amount (default: %u seconds).\", DEFAULT_MAX_TIME_ADJUSTMENT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxuploadtarget=<n>\", strprintf(\"Tries to keep outbound traffic under the given target per 24h. Limit does not apply to peers with 'download' permission or blocks created within past week. 0 = no limit (default: %s). Optional suffix units [k|K|m|M|g|G|t|T] (default: M). Lowercase is 1000 base while uppercase is 1024 base\", DEFAULT_MAX_UPLOAD_TARGET), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    argsman.AddArg(\"-onion=<ip:port>\", \"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-onion=<ip:port|path>\", \"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy). May be a local file path prefixed with 'unix:' if UNIX domain sockets are supported by the platform.\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1268326494",
      "id" : 1268326494,
      "in_reply_to_id" : 1268148641,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LmSBe",
      "original_commit_id" : "f74da5eba9192e219567ab753c92b6cd2e66f73b",
      "original_line" : 495,
      "original_position" : 5,
      "original_start_line" : 495,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1537498926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268326494/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-07-19T16:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268326494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-03T14:56:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1745152569",
      "id" : 1745152569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585oBOo5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1745152569/reactions"
      },
      "updated_at" : "2023-10-03T14:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1745152569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1358214172"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358214172"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    // Connect to `sockaddr` using `sock`.\r\n```\r\nor drop the comment altogether.",
      "commit_id" : "e60df927bffa844d08fa908128b10303b352cfc5",
      "created_at" : "2023-10-13T12:44:51Z",
      "diff_hunk" : "@@ -509,22 +536,10 @@ static void LogConnectFailure(bool manual_connection, const char* fmt, const Arg\n     }\n }\n \n-bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nTimeout, bool manual_connection)\n+static bool ConnectToSocket(const Sock& sock, struct sockaddr* sockaddr, socklen_t len, const std::string& dest_str, bool manual_connection)\n {\n-    // Create a sockaddr from the specified service.\n-    struct sockaddr_storage sockaddr;\n-    socklen_t len = sizeof(sockaddr);\n-    if (sock.Get() == INVALID_SOCKET) {\n-        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", addrConnect.ToStringAddrPort());\n-        return false;\n-    }\n-    if (!addrConnect.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n-        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", addrConnect.ToStringAddrPort());\n-        return false;\n-    }\n-\n-    // Connect to the addrConnect service on the hSocket socket.\n-    if (sock.Connect(reinterpret_cast<struct sockaddr*>(&sockaddr), len) == SOCKET_ERROR) {\n+    // Connect to the dest service on the hSocket socket.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1358214172",
      "id" : 1358214172,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q9LQc",
      "original_commit_id" : "d8f993b77d2f0bad0e7a5659885ffbbd9f75dbec",
      "original_line" : 541,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1676409183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358214172/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-13T14:44:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358214172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1358244984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358244984"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n\r\n```suggestion\r\n    argsman.AddArg(\"-proxy=<ip:port|path>\", \"Connect through SOCKS5 proxy, set -noproxy to disable (default: disabled). May be a local file path prefixed with 'unix:'.\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_ELISION, OptionsCategory::CONNECTION);\r\n```\r\n\r\n(this is inside `#if HAVE_SOCKADDR_UN`)",
      "commit_id" : "e60df927bffa844d08fa908128b10303b352cfc5",
      "created_at" : "2023-10-13T13:08:46Z",
      "diff_hunk" : "@@ -502,7 +506,11 @@ void SetupServerArgs(ArgsManager& argsman)\n     // TODO: remove the sentence \"Nodes not using ... incoming connections.\" once the changes from\n     // https://github.com/bitcoin/bitcoin/pull/23542 have become widespread.\n     argsman.AddArg(\"-port=<port>\", strprintf(\"Listen for connections on <port>. Nodes not using the default ports (default: %u, testnet: %u, signet: %u, regtest: %u) are unlikely to get incoming connections. Not relevant for I2P (see doc/i2p.md).\", defaultChainParams->GetDefaultPort(), testnetChainParams->GetDefaultPort(), signetChainParams->GetDefaultPort(), regtestChainParams->GetDefaultPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n+#if HAVE_SOCKADDR_UN\n+    argsman.AddArg(\"-proxy=<ip:port|path>\", \"Connect through SOCKS5 proxy, set -noproxy to disable (default: disabled). May be a local file path prefixed with 'unix:' if UNIX domain sockets are supported by the platform.\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_ELISION, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1358244984",
      "id" : 1358244984,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q9Sx4",
      "original_commit_id" : "d8f993b77d2f0bad0e7a5659885ffbbd9f75dbec",
      "original_line" : 510,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1676409183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358244984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-13T14:44:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358244984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild thanks again for your review! Nits addressed and rebased on master. I will help you review https://github.com/bitcoin/bitcoin/pull/28649",
      "created_at" : "2023-10-16T14:36:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1764620194",
      "id" : 1764620194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585pLfei",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764620194/reactions"
      },
      "updated_at" : "2023-10-16T14:36:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764620194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1361847268"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361847268"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 7239ec264a1def8e8aeff8c1ca57ece2ea90f65c\r\n\r\nWhy do we always set `manual_connection = true` here (I appreciate it was existing code)? If we come via `ConnectThroughProxy` I don't think that's always the case, even though the [docstring](https://github.com/bitcoin/bitcoin/pull/27375/files#diff-fabd42e1a60c125c7fb578038e732a21d8147f407c8fbe1b6a608ba4d8115785R229) implies it should be.\r\n\r\nedit: it doesn't seem to have much effect anyway, besides [logging a different error message on failure](https://github.com/bitcoin/bitcoin/pull/27375/files#diff-3499e52d708f04ebd0bfeec799dd26464ca6bd26a802c700460227c4f41ec4b5R574-R577).",
      "commit_id" : "e60df927bffa844d08fa908128b10303b352cfc5",
      "created_at" : "2023-10-17T09:57:48Z",
      "diff_hunk" : "@@ -629,27 +635,32 @@ bool IsProxy(const CNetAddr &addr) {\n     return false;\n }\n \n-bool ConnectThroughProxy(const Proxy& proxy, const std::string& strDest, uint16_t port, const Sock& sock, int nTimeout, bool& outProxyConnectionFailed)\n+std::unique_ptr<Sock> ConnectThroughProxy(const Proxy& proxy,\n+                                          const std::string& dest,\n+                                          uint16_t port,\n+                                          bool& proxy_connection_failed)\n {\n     // first connect to proxy server\n-    if (!ConnectSocketDirectly(proxy.proxy, sock, nTimeout, true)) {\n-        outProxyConnectionFailed = true;\n-        return false;\n+    auto sock = ConnectDirectly(proxy.proxy, /*manual_connection=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1361847268",
      "id" : 1361847268,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RLCPk",
      "original_commit_id" : "7239ec264a1def8e8aeff8c1ca57ece2ea90f65c",
      "original_line" : 644,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1681893468,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361847268/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-17T11:02:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361847268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1361886774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361886774"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: if you touch again we could also check here whether the path exists and return an appropriate error if it doesn't?\r\n\r\nI tried some (wrong) unix onion options, like `onion=unix:%2Frun%2Ftor%2Fsocks` and `onion=127.0.0.1:9050` and these are accepted by init, but (obviously) fail to connect:\r\n\r\n```\r\n2023-10-17T10:25:01Z connect() to 127.0.0.1:9050 failed: No such file or directory (2)\r\n2023-10-17T10:25:01Z Cannot connect to socket for 127.0.0.1:9050\r\n2023-10-17T10:25:02Z New block-relay-only v1 peer connected: version: 70016, blocks=812593, peer=2\r\n2023-10-17T10:25:07Z Cannot connect to socket for 117.86.73.230:8333\r\n2023-10-17T10:25:08Z Cannot connect to socket for 203.91.85.237:8333\r\n2023-10-17T10:25:08Z connect() to 127.0.0.1:9050 failed: No such file or directory (2)\r\n2023-10-17T10:25:08Z Cannot connect to socket for 127.0.0.1:9050\r\n2023-10-17T10:25:14Z Cannot connect to socket for 178.66.156.78:8333\r\n```\r\n\r\nThe logs are _kind of_ clear about this, but could be improved.",
      "commit_id" : "e60df927bffa844d08fa908128b10303b352cfc5",
      "created_at" : "2023-10-17T10:26:31Z",
      "diff_hunk" : "@@ -210,6 +210,24 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault, DNSLookupF\n     return Lookup(name, portDefault, /*fAllowLookup=*/false, dns_lookup_function).value_or(CService{});\n }\n \n+bool IsUnixSocketPath(const std::string& name)\n+{\n+#if HAVE_SOCKADDR_UN\n+    if (name.find(ADDR_PREFIX_UNIX) != 0) return false;\n+\n+    // Split off \"unix:\" prefix\n+    std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    // Path size limit is platform-dependent\n+    // see https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html\n+    if (str.size() + 1 > sizeof(((sockaddr_un*)nullptr)->sun_path)) return false;\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1361886774",
      "id" : 1361886774,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII585RLL42",
      "original_commit_id" : "892e0f4fae411ee731e35e45ef600e42824edccd",
      "original_line" : 224,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 26,
      "pull_request_review_id" : 1681893468,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361886774/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-17T11:02:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361886774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1362521247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362521247"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This was discussed but we don't normally check this kind of option that deeply. For example, you can set `-onion=127.0.0.1:9050` and if Tor isn't running, all you get is a log message. The user should be able to start Tor after Bitcoin.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/27375#discussion_r1217775186",
      "commit_id" : "e60df927bffa844d08fa908128b10303b352cfc5",
      "created_at" : "2023-10-17T17:34:20Z",
      "diff_hunk" : "@@ -210,6 +210,24 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault, DNSLookupF\n     return Lookup(name, portDefault, /*fAllowLookup=*/false, dns_lookup_function).value_or(CService{});\n }\n \n+bool IsUnixSocketPath(const std::string& name)\n+{\n+#if HAVE_SOCKADDR_UN\n+    if (name.find(ADDR_PREFIX_UNIX) != 0) return false;\n+\n+    // Split off \"unix:\" prefix\n+    std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    // Path size limit is platform-dependent\n+    // see https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html\n+    if (str.size() + 1 > sizeof(((sockaddr_un*)nullptr)->sun_path)) return false;\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1362521247",
      "id" : 1362521247,
      "in_reply_to_id" : 1361886774,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII585RNmyf",
      "original_commit_id" : "892e0f4fae411ee731e35e45ef600e42824edccd",
      "original_line" : 224,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 26,
      "pull_request_review_id" : 1682982202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362521247/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-17T17:36:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362521247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1365639888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1365639888"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There shouldn't be a need for the `HAVE_SOCKADDR_UN=1` or `HAVE_SOCKADDR_UN=0` in the `AC_MSG_RESULT`'s?",
      "commit_id" : "e60df927bffa844d08fa908128b10303b352cfc5",
      "created_at" : "2023-10-19T14:27:36Z",
      "diff_hunk" : "@@ -1265,10 +1265,23 @@ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n   ]], [[\n     getauxval(AT_HWCAP);\n   ]])],\n- [ AC_MSG_RESULT([yes]); HAVE_STRONG_GETAUXVAL=1; AC_DEFINE([HAVE_STRONG_GETAUXVAL], [1], [Define this symbol to build code that uses getauxval)]) ],\n+ [ AC_MSG_RESULT([yes]); HAVE_STRONG_GETAUXVAL=1; AC_DEFINE([HAVE_STRONG_GETAUXVAL], [1], [Define this symbol to build code that uses getauxval]) ],\n  [ AC_MSG_RESULT([no]); HAVE_STRONG_GETAUXVAL=0 ]\n )\n \n+# Check for UNIX sockets\n+AC_MSG_CHECKING(for sockaddr_un)\n+AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n+    #include <sys/socket.h>\n+    #include <sys/un.h>\n+  ]], [[\n+    struct sockaddr_un addr;\n+    addr.sun_family = AF_UNIX;\n+  ]])],\n+ [ AC_MSG_RESULT([yes]); HAVE_SOCKADDR_UN=1; AC_DEFINE([HAVE_SOCKADDR_UN], [1], [Define this symbol if platform supports unix domain sockets]) ],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1365639888",
      "id" : 1365639888,
      "line" : 1281,
      "node_id" : "PRRC_kwDOABII585RZgLQ",
      "original_commit_id" : "e60df927bffa844d08fa908128b10303b352cfc5",
      "original_line" : 1281,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "configure.ac",
      "position" : 18,
      "pull_request_review_id" : 1687899757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1365639888/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-19T14:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1365639888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-19T18:31:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1771511333",
      "id" : 1771511333,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585plx4l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771511333/reactions"
      },
      "updated_at" : "2023-10-19T18:31:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771511333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks again @vasild rebased on master - I see some new I2P tests in there now! Had to update those with the changes to `CreateSock()`",
      "created_at" : "2023-10-24T17:46:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1777728411",
      "id" : 1777728411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585p9fub",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1777728411/reactions"
      },
      "updated_at" : "2023-10-24T17:46:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1777728411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\ntest/i2p_tests.cpp:162:79: error: no matching function for call to âi2p::sam::Session::Session(const fs::path&, CService, CThreadInterrupt*)â",
      "created_at" : "2023-11-04T07:35:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1793371393",
      "id" : 1793371393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585q5K0B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1793371393/reactions"
      },
      "updated_at" : "2023-11-04T07:35:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1793371393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master to fix silent conflict with new I2P tests.\r\n\r\n@maflcko thanks. Can you help me understand why this only broke the previous builds task?",
      "created_at" : "2023-11-05T19:36:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1793825982",
      "id" : 1793825982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585q65y-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1793825982/reactions"
      },
      "updated_at" : "2023-11-05T19:36:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1793825982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "To preserve CI resources, only one task is re-run to detect silent merge conflicts.",
      "created_at" : "2023-11-06T12:33:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1794721136",
      "id" : 1794721136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII585q-UVw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1794721136/reactions"
      },
      "updated_at" : "2023-11-06T12:33:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1794721136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1384082654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384082654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: in c079e29c266a413de1859c0cbc8ebb55ea6a3203\r\n\r\nI get a compilation failure:\r\n\r\n```log\r\nnet.cpp:481:109: error: no member named 'ToString' in 'Proxy'\r\n            LogPrintLevel(BCLog::PROXY, BCLog::Level::Debug, \"Using proxy: %s to connect to %s:%s\\n\", proxy.ToString(), addrConnect.ToStringAddr(), addrConnect.GetPort());\r\n                                                                                                      ~~~~~ ^\r\n./logging.h:257:45: note: expanded from macro 'LogPrintLevel'\r\n            LogPrintLevel_(category, level, __VA_ARGS__); \\\r\n                                            ^~~~~~~~~~~\r\n./logging.h:234:104: note: expanded from macro 'LogPrintLevel_'\r\n#define LogPrintLevel_(category, level, ...) LogPrintf_(__func__, __FILE__, __LINE__, category, level, __VA_ARGS__)\r\n                                                                                                       ^~~~~~~~~~~\r\n1 error generated.\r\nmake: *** [Makefile:10385: libbitcoin_node_a-net.o] Error 1\r\nmake: Leaving directory '/home/will/src/bitcoin/src'\r\n```\r\n\r\nLooks like `ToString()` is added to Proxy in e7d29d5",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2023-11-06T22:06:54Z",
      "diff_hunk" : "@@ -478,39 +478,25 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                 addr_bind = CAddress{conn.me, NODE_NONE};\n             }\n         } else if (use_proxy) {\n-            sock = CreateSock(proxy.proxy);\n-            if (!sock) {\n-                return nullptr;\n-            }\n-            connected = ConnectThroughProxy(proxy, addrConnect.ToStringAddr(), addrConnect.GetPort(),\n-                                            *sock, nConnectTimeout, proxyConnectionFailed);\n+            LogPrintLevel(BCLog::PROXY, BCLog::Level::Debug, \"Using proxy: %s to connect to %s:%s\\n\", proxy.ToString(), addrConnect.ToStringAddr(), addrConnect.GetPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1384082654",
      "id" : 1384082654,
      "line" : 481,
      "node_id" : "PRRC_kwDOABII585Sf2ze",
      "original_commit_id" : "0c5f8c36c90fab4fb39ce39d1b4c204a2edd25c4",
      "original_line" : 481,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 35,
      "pull_request_review_id" : 1716369031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384082654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-07T14:23:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384082654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1384854138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384854138"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In c079e29\r\n\r\n`ConnectDirectly` and `ConnectThroughProxy` now differ in their primary args, with Directly taking a `CService` and Proxy remaining with `std::string&` (for host and port) which results in:\r\n\r\n_src/net.cpp_\r\n\r\n```cpp\r\n        } else if (use_proxy) {\r\n            LogPrintLevel(BCLog::PROXY, BCLog::Level::Debug, \"Using proxy: %s to connect to %s:%s\\n\", proxy.proxy.ToStringAddrPort(), addrConnect.ToStringAddr(), addrConnect.GetPort());\r\n            sock = ConnectThroughProxy(proxy, addrConnect.ToStringAddr(), addrConnect.GetPort(), proxyConnectionFailed);\r\n        } else {\r\n            // no proxy needed (none set for target network)\r\n            sock = ConnectDirectly(addrConnect, conn_type == ConnectionType::MANUAL);\r\n        }\r\n```\r\n\r\nIf you touch again we could take the chance to synchronise the interfaces for these two similar functions?",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2023-11-07T12:43:12Z",
      "diff_hunk" : "@@ -232,47 +265,42 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault = 0, DNSLoo\n CSubNet LookupSubNet(const std::string& subnet_str);\n \n /**\n- * Create a TCP socket in the given address family.\n+ * Create a TCP or UNIX socket in the given address family.\n  * @param[in] address_family The socket is created in the same address family as this address.\n  * @return pointer to the created Sock object or unique_ptr that owns nothing in case of failure\n  */\n-std::unique_ptr<Sock> CreateSockTCP(const CService& address_family);\n+std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family);\n \n /**\n- * Socket factory. Defaults to `CreateSockTCP()`, but can be overridden by unit tests.\n+ * Socket factory. Defaults to `CreateSockOS()`, but can be overridden by unit tests.\n  */\n-extern std::function<std::unique_ptr<Sock>(const CService&)> CreateSock;\n+extern std::function<std::unique_ptr<Sock>(const sa_family_t&)> CreateSock;\n \n /**\n- * Try to connect to the specified service on the specified socket.\n+ * Create a socket and try to connect to the specified service.\n  *\n- * @param addrConnect The service to which to connect.\n- * @param sock The socket on which to connect.\n- * @param nTimeout Wait this many milliseconds for the connection to be\n- *                 established.\n- * @param manual_connection Whether or not the connection was manually requested\n- *                          (e.g. through the addnode RPC)\n+ * @param[in] dest The service to which to connect.\n+ * @param[in] manual_connection Whether or not the connection was manually requested (e.g. through the addnode RPC)\n  *\n- * @returns Whether or not a connection was successfully made.\n+ * @returns the connected socket if the operation succeeded, empty unique_ptr otherwise\n  */\n-bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nTimeout, bool manual_connection);\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1384854138",
      "id" : 1384854138,
      "line" : 287,
      "node_id" : "PRRC_kwDOABII585SizJ6",
      "original_commit_id" : "0c5f8c36c90fab4fb39ce39d1b4c204a2edd25c4",
      "original_line" : 287,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 98,
      "pull_request_review_id" : 1716369031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384854138/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-07T14:23:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384854138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1386940797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1386940797"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good observation. This is how `ConnectSocketDirectly()` and `ConnectThroughProxy()` are implemented on master currently as well. I think the reason is that we actually send the SOCKS5 proxy the destination host as a string whereas for the direct connection we actually get a socket from the OS. So even if throughProxy accepted a CService, we'd have to split into host string and port right away, anyway. I think I'll leave this alone for now unless other reviewers want to weigh in.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2023-11-08T17:00:08Z",
      "diff_hunk" : "@@ -232,47 +265,42 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault = 0, DNSLoo\n CSubNet LookupSubNet(const std::string& subnet_str);\n \n /**\n- * Create a TCP socket in the given address family.\n+ * Create a TCP or UNIX socket in the given address family.\n  * @param[in] address_family The socket is created in the same address family as this address.\n  * @return pointer to the created Sock object or unique_ptr that owns nothing in case of failure\n  */\n-std::unique_ptr<Sock> CreateSockTCP(const CService& address_family);\n+std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family);\n \n /**\n- * Socket factory. Defaults to `CreateSockTCP()`, but can be overridden by unit tests.\n+ * Socket factory. Defaults to `CreateSockOS()`, but can be overridden by unit tests.\n  */\n-extern std::function<std::unique_ptr<Sock>(const CService&)> CreateSock;\n+extern std::function<std::unique_ptr<Sock>(const sa_family_t&)> CreateSock;\n \n /**\n- * Try to connect to the specified service on the specified socket.\n+ * Create a socket and try to connect to the specified service.\n  *\n- * @param addrConnect The service to which to connect.\n- * @param sock The socket on which to connect.\n- * @param nTimeout Wait this many milliseconds for the connection to be\n- *                 established.\n- * @param manual_connection Whether or not the connection was manually requested\n- *                          (e.g. through the addnode RPC)\n+ * @param[in] dest The service to which to connect.\n+ * @param[in] manual_connection Whether or not the connection was manually requested (e.g. through the addnode RPC)\n  *\n- * @returns Whether or not a connection was successfully made.\n+ * @returns the connected socket if the operation succeeded, empty unique_ptr otherwise\n  */\n-bool ConnectSocketDirectly(const CService &addrConnect, const Sock& sock, int nTimeout, bool manual_connection);\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1386940797",
      "id" : 1386940797,
      "in_reply_to_id" : 1384854138,
      "line" : 287,
      "node_id" : "PRRC_kwDOABII585Sqwl9",
      "original_commit_id" : "0c5f8c36c90fab4fb39ce39d1b4c204a2edd25c4",
      "original_line" : 287,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 98,
      "pull_request_review_id" : 1688303909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1386940797/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-08T17:56:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1386940797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1386940970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1386940970"
         }
      },
      "author_association" : "MEMBER",
      "body" : "great catch thanks, will fix.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2023-11-08T17:00:16Z",
      "diff_hunk" : "@@ -478,39 +478,25 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                 addr_bind = CAddress{conn.me, NODE_NONE};\n             }\n         } else if (use_proxy) {\n-            sock = CreateSock(proxy.proxy);\n-            if (!sock) {\n-                return nullptr;\n-            }\n-            connected = ConnectThroughProxy(proxy, addrConnect.ToStringAddr(), addrConnect.GetPort(),\n-                                            *sock, nConnectTimeout, proxyConnectionFailed);\n+            LogPrintLevel(BCLog::PROXY, BCLog::Level::Debug, \"Using proxy: %s to connect to %s:%s\\n\", proxy.ToString(), addrConnect.ToStringAddr(), addrConnect.GetPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1386940970",
      "id" : 1386940970,
      "in_reply_to_id" : 1384082654,
      "line" : 481,
      "node_id" : "PRRC_kwDOABII585Sqwoq",
      "original_commit_id" : "0c5f8c36c90fab4fb39ce39d1b4c204a2edd25c4",
      "original_line" : 481,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 35,
      "pull_request_review_id" : 1688303909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1386940970/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-08T17:56:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1386940970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Would be nice to have this for RPC too, but can wait for a followup.\r\n\r\nDitto for direct peer connections.",
      "created_at" : "2024-02-28T11:41:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1968804032",
      "id" : 1968804032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5851WZDA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1968804032/reactions"
      },
      "updated_at" : "2024-02-28T13:55:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1968804032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505846753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505846753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4ca9b322f00db56a390301f08d3de8a13ff66694: suggested documentation:\r\n\r\n```cpp\r\n    /**\r\n     * Get the address family\r\n     * @returns AF_UNSPEC if unspecified\r\n     */\r\n```",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T12:07:50Z",
      "diff_hunk" : "@@ -544,6 +544,7 @@ class CService : public CNetAddr\n     uint16_t GetPort() const;\n     bool GetSockAddr(struct sockaddr* paddr, socklen_t* addrlen) const;\n     bool SetSockAddr(const struct sockaddr* paddr);\n+    [[nodiscard]] sa_family_t GetSAFamily() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505846753",
      "id" : 1505846753,
      "line" : 547,
      "node_id" : "PRRC_kwDOABII585ZwWXh",
      "original_commit_id" : "4ca9b322f00db56a390301f08d3de8a13ff66694",
      "original_line" : 547,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 4,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505846753/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505846753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505852349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505852349"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4ca9b322f00db56a390301f08d3de8a13ff66694: \"Create a TCP socket\" should be changed to create \"Create a socket\"?\r\n\r\nAnd:\r\n```\r\n* @param[in] address_family to use for the socket.\r\n```",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T12:12:33Z",
      "diff_hunk" : "@@ -236,12 +236,12 @@ CSubNet LookupSubNet(const std::string& subnet_str);\n  * @param[in] address_family The socket is created in the same address family as this address.\n  * @return pointer to the created Sock object or unique_ptr that owns nothing in case of failure\n  */\n-std::unique_ptr<Sock> CreateSockTCP(const CService& address_family);\n+std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505852349",
      "id" : 1505852349,
      "line" : 272,
      "node_id" : "PRRC_kwDOABII585ZwXu9",
      "original_commit_id" : "4ca9b322f00db56a390301f08d3de8a13ff66694",
      "original_line" : 239,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 72,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505852349/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505852349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505872297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505872297"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4ca9b322f00db56a390301f08d3de8a13ff66694: this is a nice readability improvement; makes it clear `CreateSock` only needs the socket address family and the real work happens in `ConnectSocketDirectly`.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T12:24:56Z",
      "diff_hunk" : "@@ -326,7 +326,7 @@ Session::Reply Session::SendRequestAndGetReply(const Sock& sock,\n \n std::unique_ptr<Sock> Session::Hello() const\n {\n-    auto sock = CreateSock(m_control_host);\n+    auto sock = CreateSock(m_control_host.GetSAFamily());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505872297",
      "id" : 1505872297,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Zwcmp",
      "original_commit_id" : "4ca9b322f00db56a390301f08d3de8a13ff66694",
      "original_line" : 329,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/i2p.cpp",
      "position" : null,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505872297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505872297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505897078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505897078"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d513ac7bf615239053762a4f9d64db9f4c70d12a nit: brackets or on the same line",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T12:38:26Z",
      "diff_hunk" : "@@ -452,11 +456,17 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\n \n std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family)\n {\n-    // Not IPv4 or IPv6\n+    // Not IPv4, IPv6 or UNIX\n     if (address_family == AF_UNSPEC) return nullptr;\n \n-    // Create a TCP socket in the address family of the specified service.\n-    SOCKET hSocket = socket(address_family, SOCK_STREAM, IPPROTO_TCP);\n+    int protocol{IPPROTO_TCP};\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505897078",
      "id" : 1505897078,
      "line" : 482,
      "node_id" : "PRRC_kwDOABII585Zwip2",
      "original_commit_id" : "d513ac7bf615239053762a4f9d64db9f4c70d12a",
      "original_line" : 464,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 57,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505897078/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505897078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505908323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505908323"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d513ac7bf615239053762a4f9d64db9f4c70d12a: On macOS `man 2 socket` lists `PF_LOCAL` (alias for `PF_UNIX`), `PF_INET` and `PF_INET6` for the `domain` parameter of `socket` (first argument).\r\n\r\nThey map to the same integer values as `AF_UNIX`, `AF_INET` and `AF_INET6`, so it's just a cosmetic thing. And apparently nobody cares: https://stackoverflow.com/a/6737450/313633",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T12:46:43Z",
      "diff_hunk" : "@@ -452,11 +456,17 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\n \n std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family)\n {\n-    // Not IPv4 or IPv6\n+    // Not IPv4, IPv6 or UNIX\n     if (address_family == AF_UNSPEC) return nullptr;\n \n-    // Create a TCP socket in the address family of the specified service.\n-    SOCKET hSocket = socket(address_family, SOCK_STREAM, IPPROTO_TCP);\n+    int protocol{IPPROTO_TCP};\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX)\n+        protocol = 0;\n+#endif\n+\n+    // Create a socket in the specified address family.\n+    SOCKET hSocket = socket(address_family, SOCK_STREAM, protocol);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1505908323",
      "id" : 1505908323,
      "line" : 487,
      "node_id" : "PRRC_kwDOABII585ZwlZj",
      "original_commit_id" : "d513ac7bf615239053762a4f9d64db9f4c70d12a",
      "original_line" : 469,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 62,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505908323/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505908323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506002754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506002754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6dddc1c2eda514d35219cce03c229bd6f822be55 the SOCKS5 standard seems to assume that clients are connecting via either TCP or UDP. Other than Tor, are there other SOCKS5 proxies out there that support connecting via socket? https://datatracker.ietf.org/doc/html/rfc1928\r\n\r\n(it's probably fine to allow it even if not)",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T13:54:36Z",
      "diff_hunk" : "@@ -505,7 +509,11 @@ void SetupServerArgs(ArgsManager& argsman)\n     // TODO: remove the sentence \"Nodes not using ... incoming connections.\" once the changes from\n     // https://github.com/bitcoin/bitcoin/pull/23542 have become widespread.\n     argsman.AddArg(\"-port=<port>\", strprintf(\"Listen for connections on <port>. Nodes not using the default ports (default: %u, testnet: %u, signet: %u, regtest: %u) are unlikely to get incoming connections. Not relevant for I2P (see doc/i2p.md).\", defaultChainParams->GetDefaultPort(), testnetChainParams->GetDefaultPort(), signetChainParams->GetDefaultPort(), regtestChainParams->GetDefaultPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n+#if HAVE_SOCKADDR_UN\n+    argsman.AddArg(\"-proxy=<ip:port|path>\", \"Connect through SOCKS5 proxy, set -noproxy to disable (default: disabled). May be a local file path prefixed with 'unix:'.\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_ELISION, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506002754",
      "id" : 1506002754,
      "line" : 513,
      "node_id" : "PRRC_kwDOABII585Zw8dC",
      "original_commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "original_line" : 513,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 17,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506002754/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506002754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506062696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506062696"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Both call sites of `ConnectThroughProxy` have access to `conn_type` so might as well pass in `manual_connection`.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T14:32:33Z",
      "diff_hunk" : "@@ -629,27 +635,32 @@ bool IsProxy(const CNetAddr &addr) {\n     return false;\n }\n \n-bool ConnectThroughProxy(const Proxy& proxy, const std::string& strDest, uint16_t port, const Sock& sock, int nTimeout, bool& outProxyConnectionFailed)\n+std::unique_ptr<Sock> ConnectThroughProxy(const Proxy& proxy,\n+                                          const std::string& dest,\n+                                          uint16_t port,\n+                                          bool& proxy_connection_failed)\n {\n     // first connect to proxy server\n-    if (!ConnectSocketDirectly(proxy.proxy, sock, nTimeout, true)) {\n-        outProxyConnectionFailed = true;\n-        return false;\n+    auto sock = ConnectDirectly(proxy.proxy, /*manual_connection=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506062696",
      "id" : 1506062696,
      "in_reply_to_id" : 1361847268,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZxLFo",
      "original_commit_id" : "7239ec264a1def8e8aeff8c1ca57ece2ea90f65c",
      "original_line" : 644,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506062696/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506062696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506080211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506080211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8d06446fc7a17b593466fccd0f638eb2527a493b: maybe add `Assume(false);` here? Since the answer of this function is unreliable for systems that don't support unix sockets.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T14:43:42Z",
      "diff_hunk" : "@@ -212,6 +212,24 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault, DNSLookupF\n     return Lookup(name, portDefault, /*fAllowLookup=*/false, dns_lookup_function).value_or(CService{});\n }\n \n+bool IsUnixSocketPath(const std::string& name)\n+{\n+#if HAVE_SOCKADDR_UN\n+    if (name.find(ADDR_PREFIX_UNIX) != 0) return false;\n+\n+    // Split off \"unix:\" prefix\n+    std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    // Path size limit is platform-dependent\n+    // see https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html\n+    if (str.size() + 1 > sizeof(((sockaddr_un*)nullptr)->sun_path)) return false;\n+\n+    return true;\n+#else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506080211",
      "id" : 1506080211,
      "line" : 228,
      "node_id" : "PRRC_kwDOABII585ZxPXT",
      "original_commit_id" : "8d06446fc7a17b593466fccd0f638eb2527a493b",
      "original_line" : 228,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 28,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506080211/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506080211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506247369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506247369"
         }
      },
      "author_association" : "MEMBER",
      "body" : "9eb40e6f399169ade8e96c60ba633e8a0e4ddadc: Given the `IsValid()` check above, you could also do `Assume(path.length() < sizeof(addrun.sun_path) - 1)` and leave out the `std::min` stuff, but maybe this is more robust.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-28T16:28:37Z",
      "diff_hunk" : "@@ -600,11 +586,71 @@ std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connecti\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return {};\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return false;\n         }\n     }\n+    return true;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot get sockaddr for %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    if (!ConnectToSocket(*sock, (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection)) {\n+        LogPrintf(\"Cannot connect to socket for %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!IsValid()) {\n+        LogPrintf(\"Cannot connect to invalid Proxy\\n\");\n+        return {};\n+    }\n+\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+#if HAVE_SOCKADDR_UN\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_un addrun;\n+    memset(&addrun, 0, sizeof(addrun));\n+    addrun.sun_family = AF_UNIX;\n+    // leave the last char in addrun.sun_path[] to be always '\\0'\n+    memcpy(addrun.sun_path, path.c_str(), std::min(sizeof(addrun.sun_path) - 1, path.length()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506247369",
      "id" : 1506247369,
      "line" : 642,
      "node_id" : "PRRC_kwDOABII585Zx4LJ",
      "original_commit_id" : "9eb40e6f399169ade8e96c60ba633e8a0e4ddadc",
      "original_line" : 642,
      "original_position" : 130,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 212,
      "pull_request_review_id" : 1906085382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506247369/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506247369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508224464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508224464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's... weird ð¤·  Do you think I need to change anything here?",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-29T21:40:01Z",
      "diff_hunk" : "@@ -452,11 +456,17 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\n \n std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family)\n {\n-    // Not IPv4 or IPv6\n+    // Not IPv4, IPv6 or UNIX\n     if (address_family == AF_UNSPEC) return nullptr;\n \n-    // Create a TCP socket in the address family of the specified service.\n-    SOCKET hSocket = socket(address_family, SOCK_STREAM, IPPROTO_TCP);\n+    int protocol{IPPROTO_TCP};\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX)\n+        protocol = 0;\n+#endif\n+\n+    // Create a socket in the specified address family.\n+    SOCKET hSocket = socket(address_family, SOCK_STREAM, protocol);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508224464",
      "id" : 1508224464,
      "in_reply_to_id" : 1505908323,
      "line" : 487,
      "node_id" : "PRRC_kwDOABII585Z5a3Q",
      "original_commit_id" : "d513ac7bf615239053762a4f9d64db9f4c70d12a",
      "original_line" : 469,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 62,
      "pull_request_review_id" : 1909921946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508224464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-29T21:40:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508224464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508229256"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508229256"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hm not sure what you mean by unreliable. Wont the pre-processor directives here guaruntee this function always returns false on systems that don't support unix sockets?",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-29T21:45:22Z",
      "diff_hunk" : "@@ -212,6 +212,24 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault, DNSLookupF\n     return Lookup(name, portDefault, /*fAllowLookup=*/false, dns_lookup_function).value_or(CService{});\n }\n \n+bool IsUnixSocketPath(const std::string& name)\n+{\n+#if HAVE_SOCKADDR_UN\n+    if (name.find(ADDR_PREFIX_UNIX) != 0) return false;\n+\n+    // Split off \"unix:\" prefix\n+    std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    // Path size limit is platform-dependent\n+    // see https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html\n+    if (str.size() + 1 > sizeof(((sockaddr_un*)nullptr)->sun_path)) return false;\n+\n+    return true;\n+#else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508229256",
      "id" : 1508229256,
      "in_reply_to_id" : 1506080211,
      "line" : 228,
      "node_id" : "PRRC_kwDOABII585Z5cCI",
      "original_commit_id" : "8d06446fc7a17b593466fccd0f638eb2527a493b",
      "original_line" : 228,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 28,
      "pull_request_review_id" : 1909929055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508229256/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-29T21:45:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508229256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508245150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508245150"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hm good question, I found some vague docs that imply NordVPN client has a unix socket option... Would you suggest specifying Tor in the help description of the proxy arg?",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-29T22:02:29Z",
      "diff_hunk" : "@@ -505,7 +509,11 @@ void SetupServerArgs(ArgsManager& argsman)\n     // TODO: remove the sentence \"Nodes not using ... incoming connections.\" once the changes from\n     // https://github.com/bitcoin/bitcoin/pull/23542 have become widespread.\n     argsman.AddArg(\"-port=<port>\", strprintf(\"Listen for connections on <port>. Nodes not using the default ports (default: %u, testnet: %u, signet: %u, regtest: %u) are unlikely to get incoming connections. Not relevant for I2P (see doc/i2p.md).\", defaultChainParams->GetDefaultPort(), testnetChainParams->GetDefaultPort(), signetChainParams->GetDefaultPort(), regtestChainParams->GetDefaultPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n+#if HAVE_SOCKADDR_UN\n+    argsman.AddArg(\"-proxy=<ip:port|path>\", \"Connect through SOCKS5 proxy, set -noproxy to disable (default: disabled). May be a local file path prefixed with 'unix:'.\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_ELISION, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508245150",
      "id" : 1508245150,
      "in_reply_to_id" : 1506002754,
      "line" : 513,
      "node_id" : "PRRC_kwDOABII585Z5f6e",
      "original_commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "original_line" : 513,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 17,
      "pull_request_review_id" : 1909953751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508245150/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-29T22:02:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508245150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508246171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508246171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah I think this was recommended by vasild in an earlier interation of the branch.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-02-29T22:03:33Z",
      "diff_hunk" : "@@ -600,11 +586,71 @@ std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connecti\n         else\n #endif\n         {\n-            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest.ToStringAddrPort(), NetworkErrorString(WSAGetLastError()));\n-            return {};\n+            LogConnectFailure(manual_connection, \"connect() to %s failed: %s\", dest_str, NetworkErrorString(WSAGetLastError()));\n+            return false;\n         }\n     }\n+    return true;\n+}\n+\n+std::unique_ptr<Sock> ConnectDirectly(const CService& dest, bool manual_connection)\n+{\n+    auto sock = CreateSock(dest.GetSAFamily());\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    // Create a sockaddr from the specified service.\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (!dest.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot get sockaddr for %s: unsupported network\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    if (!ConnectToSocket(*sock, (struct sockaddr*)&sockaddr, len, dest.ToStringAddrPort(), manual_connection)) {\n+        LogPrintf(\"Cannot connect to socket for %s\\n\", dest.ToStringAddrPort());\n+        return {};\n+    }\n+\n+    return sock;\n+}\n+\n+std::unique_ptr<Sock> Proxy::Connect() const\n+{\n+    if (!IsValid()) {\n+        LogPrintf(\"Cannot connect to invalid Proxy\\n\");\n+        return {};\n+    }\n+\n+    if (!m_is_unix_socket) return ConnectDirectly(proxy, /*manual_connection=*/true);\n+\n+#if HAVE_SOCKADDR_UN\n+    auto sock = CreateSock(AF_UNIX);\n+    if (!sock) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"Cannot create a socket for connecting to %s\\n\", m_unix_socket_path);\n+        return {};\n+    }\n+\n+    const std::string path{m_unix_socket_path.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    struct sockaddr_un addrun;\n+    memset(&addrun, 0, sizeof(addrun));\n+    addrun.sun_family = AF_UNIX;\n+    // leave the last char in addrun.sun_path[] to be always '\\0'\n+    memcpy(addrun.sun_path, path.c_str(), std::min(sizeof(addrun.sun_path) - 1, path.length()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508246171",
      "id" : 1508246171,
      "in_reply_to_id" : 1506247369,
      "line" : 642,
      "node_id" : "PRRC_kwDOABII585Z5gKb",
      "original_commit_id" : "9eb40e6f399169ade8e96c60ba633e8a0e4ddadc",
      "original_line" : 642,
      "original_position" : 130,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 212,
      "pull_request_review_id" : 1909955772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508246171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-29T22:03:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508246171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors \r\nhttps://github.com/bitcoin/bitcoin/pull/27375#discussion_r1506062696\r\n>  Both call sites of ConnectThroughProxy have access to conn_type so might as well pass in manual_connection.\r\n\r\nDo you mean to pass it `ConnectThroughProxy()` -> `proxy.Connect()` -> `ConnectDirectly()`?\r\n\r\nThat would also mean we need `manual_connection` in `i2p.cpp` where we call `proxy.Connect()` ?\r\n",
      "created_at" : "2024-02-29T22:13:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1972059516",
      "id" : 1972059516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5851iz18",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1972059516/reactions"
      },
      "updated_at" : "2024-02-29T22:13:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1972059516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508620298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508620298"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "On FreeBSD all of `AF_UNIX`, `AF_LOCAL`, `PF_UNIX`, `PF_LOCAL` have the same value: https://cgit.freebsd.org/src/tree/sys/sys/socket.h",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-03-01T07:56:25Z",
      "diff_hunk" : "@@ -452,11 +456,17 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\n \n std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family)\n {\n-    // Not IPv4 or IPv6\n+    // Not IPv4, IPv6 or UNIX\n     if (address_family == AF_UNSPEC) return nullptr;\n \n-    // Create a TCP socket in the address family of the specified service.\n-    SOCKET hSocket = socket(address_family, SOCK_STREAM, IPPROTO_TCP);\n+    int protocol{IPPROTO_TCP};\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX)\n+        protocol = 0;\n+#endif\n+\n+    // Create a socket in the specified address family.\n+    SOCKET hSocket = socket(address_family, SOCK_STREAM, protocol);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508620298",
      "id" : 1508620298,
      "in_reply_to_id" : 1505908323,
      "line" : 487,
      "node_id" : "PRRC_kwDOABII585Z67gK",
      "original_commit_id" : "d513ac7bf615239053762a4f9d64db9f4c70d12a",
      "original_line" : 469,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 62,
      "pull_request_review_id" : 1910529346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508620298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-01T07:56:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508620298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508853881"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508853881"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would, but \"unix:/somepath\" is valid unix socket path, so `IsUnixSocketPath` should return `true`. So it seems better to ensure nobody accidentally calls this function on a system that doesn't support unix sockets.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-03-01T11:21:58Z",
      "diff_hunk" : "@@ -212,6 +212,24 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault, DNSLookupF\n     return Lookup(name, portDefault, /*fAllowLookup=*/false, dns_lookup_function).value_or(CService{});\n }\n \n+bool IsUnixSocketPath(const std::string& name)\n+{\n+#if HAVE_SOCKADDR_UN\n+    if (name.find(ADDR_PREFIX_UNIX) != 0) return false;\n+\n+    // Split off \"unix:\" prefix\n+    std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    // Path size limit is platform-dependent\n+    // see https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html\n+    if (str.size() + 1 > sizeof(((sockaddr_un*)nullptr)->sun_path)) return false;\n+\n+    return true;\n+#else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508853881",
      "id" : 1508853881,
      "in_reply_to_id" : 1506080211,
      "line" : 228,
      "node_id" : "PRRC_kwDOABII585Z70h5",
      "original_commit_id" : "8d06446fc7a17b593466fccd0f638eb2527a493b",
      "original_line" : 228,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 28,
      "pull_request_review_id" : 1910910019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508853881/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-01T11:22:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508853881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508856118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508856118"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No I think that would be confusing. Perhaps add something something like \"unix: if the proxy supports it\" (assuming it's _not_ standard)",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-03-01T11:24:14Z",
      "diff_hunk" : "@@ -505,7 +509,11 @@ void SetupServerArgs(ArgsManager& argsman)\n     // TODO: remove the sentence \"Nodes not using ... incoming connections.\" once the changes from\n     // https://github.com/bitcoin/bitcoin/pull/23542 have become widespread.\n     argsman.AddArg(\"-port=<port>\", strprintf(\"Listen for connections on <port>. Nodes not using the default ports (default: %u, testnet: %u, signet: %u, regtest: %u) are unlikely to get incoming connections. Not relevant for I2P (see doc/i2p.md).\", defaultChainParams->GetDefaultPort(), testnetChainParams->GetDefaultPort(), signetChainParams->GetDefaultPort(), regtestChainParams->GetDefaultPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n+#if HAVE_SOCKADDR_UN\n+    argsman.AddArg(\"-proxy=<ip:port|path>\", \"Connect through SOCKS5 proxy, set -noproxy to disable (default: disabled). May be a local file path prefixed with 'unix:'.\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_ELISION, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508856118",
      "id" : 1508856118,
      "in_reply_to_id" : 1506002754,
      "line" : 513,
      "node_id" : "PRRC_kwDOABII585Z71E2",
      "original_commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "original_line" : 513,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 17,
      "pull_request_review_id" : 1910913526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508856118/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-01T11:24:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508856118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508857750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508857750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think if someone cares, they can make a followup PR.",
      "commit_id" : "6dddc1c2eda514d35219cce03c229bd6f822be55",
      "created_at" : "2024-03-01T11:25:58Z",
      "diff_hunk" : "@@ -452,11 +456,17 @@ bool Socks5(const std::string& strDest, uint16_t port, const ProxyCredentials* a\n \n std::unique_ptr<Sock> CreateSockOS(sa_family_t address_family)\n {\n-    // Not IPv4 or IPv6\n+    // Not IPv4, IPv6 or UNIX\n     if (address_family == AF_UNSPEC) return nullptr;\n \n-    // Create a TCP socket in the address family of the specified service.\n-    SOCKET hSocket = socket(address_family, SOCK_STREAM, IPPROTO_TCP);\n+    int protocol{IPPROTO_TCP};\n+#if HAVE_SOCKADDR_UN\n+    if (address_family == AF_UNIX)\n+        protocol = 0;\n+#endif\n+\n+    // Create a socket in the specified address family.\n+    SOCKET hSocket = socket(address_family, SOCK_STREAM, protocol);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1508857750",
      "id" : 1508857750,
      "in_reply_to_id" : 1505908323,
      "line" : 487,
      "node_id" : "PRRC_kwDOABII585Z71eW",
      "original_commit_id" : "d513ac7bf615239053762a4f9d64db9f4c70d12a",
      "original_line" : 469,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 62,
      "pull_request_review_id" : 1910916244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508857750/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-01T11:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1508857750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> That would also mean we need `manual_connection` in `i2p.cpp` where we call `proxy.Connect()` ?\r\n\r\n@vasild does the i2p code know if a connection is manual? We can always set `manual_connection` to `true` if we don't know (or it adds too much complexity), but we should set it to the correct value if we _do_ know.",
      "created_at" : "2024-03-01T11:28:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1973018554",
      "id" : 1973018554,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5851md-6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973018554/reactions"
      },
      "updated_at" : "2024-03-01T11:28:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973018554",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1509334048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1509334048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> is valid unix socket path, \r\n\r\nThis can actually only be determined if `sockaddr_un` is defined, because different platforms have different length limits for the path (https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html)\r\n\r\nSo if `sockaddr_un` is not defined, nothing can be a valid unix socket path.\r\n\r\nAlso I think `Assume(false)` is overkill because this function will be called from `AppInitMain()` regardless of platform. If a user without unix socket support still tries to set `-onion=unix:/whatever` they'll get an init error",
      "commit_id" : "6df896fc37f5b2023b891d5300345e2a4352e521",
      "created_at" : "2024-03-01T17:46:03Z",
      "diff_hunk" : "@@ -212,6 +212,24 @@ CService LookupNumeric(const std::string& name, uint16_t portDefault, DNSLookupF\n     return Lookup(name, portDefault, /*fAllowLookup=*/false, dns_lookup_function).value_or(CService{});\n }\n \n+bool IsUnixSocketPath(const std::string& name)\n+{\n+#if HAVE_SOCKADDR_UN\n+    if (name.find(ADDR_PREFIX_UNIX) != 0) return false;\n+\n+    // Split off \"unix:\" prefix\n+    std::string str{name.substr(ADDR_PREFIX_UNIX.length())};\n+\n+    // Path size limit is platform-dependent\n+    // see https://manpages.ubuntu.com/manpages/xenial/en/man7/unix.7.html\n+    if (str.size() + 1 > sizeof(((sockaddr_un*)nullptr)->sun_path)) return false;\n+\n+    return true;\n+#else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1509334048",
      "id" : 1509334048,
      "in_reply_to_id" : 1506080211,
      "line" : 232,
      "node_id" : "PRRC_kwDOABII585Z9pwg",
      "original_commit_id" : "8d06446fc7a17b593466fccd0f638eb2527a493b",
      "original_line" : 232,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 39,
      "pull_request_review_id" : 1911704548,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1509334048/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-01T17:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1509334048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors If I'm following this correctly, the only benefit of passing `manual_connection` to `ConnectDirectly()` is that it is then passed to `ConnectToSocket()` which only uses the boolean when logging with `LogConnectFailure()`.\r\n\r\nOn current master, `ConnectThroughProxy()` calls `ConnectSocketDirectly()` with a hard-coded `true` for `manual_connection`. I believe the motivation is in https://github.com/bitcoin/bitcoin/pull/12569\r\n\r\nSo I'm inclined to leave this hard-coded as `true` because IIUC the connection being described by the boolean in this context isn't \"manual\" in the \"p2p addrman vs addnode\" sense, but is used to refer to the connection between bitcoind and the input to the proxy.",
      "created_at" : "2024-03-01T18:04:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1973654804",
      "id" : 1973654804,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5851o5UU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973654804/reactions"
      },
      "updated_at" : "2024-03-01T18:04:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973654804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`git range-diff master 6dddc1c2eda514d35219cce03c229bd6f822be55 567cec9a05e1261e955535f734826b12341684b6`\r\n\r\nRebased on master to fix conflicts and ( ð¤ ) pass CI.\r\n@Sjors thank you so much for the review, I addressed all your nits except the one or two where indicated in discussion.",
      "created_at" : "2024-03-01T19:51:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1973819037",
      "id" : 1973819037,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5851phad",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973819037/reactions"
      },
      "updated_at" : "2024-03-01T19:51:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1973819037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> but is used to refer to the connection between bitcoind and the input to the proxy\r\n\r\nI agree that shouldn't be called \"manual\".\r\n\r\nre-ACK 567cec9a05e1261e955535f734826b12341684b6",
      "created_at" : "2024-03-04T11:09:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1976336383",
      "id" : 1976336383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5851zH__",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1976336383/reactions"
      },
      "updated_at" : "2024-03-04T11:15:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1976336383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "re ACK for 567cec9a05e1261e955535f734826b12341684b6.\r\n\r\nPulled, built, ran all unit and functional tests (all passed).\r\n\r\nRe-ran the test actions (quote below) from https://github.com/bitcoin/bitcoin/pull/27375#pullrequestreview-1876248880\r\n\r\nOverall, similar results were observed.\r\nEach test action was performed with a fresh signet directory (with the exception of `blocks` and `chainstate`, which were not cleared, to prevent IBD).\r\nFor the first action (i.e. running with `proxy=unix:/run/tor/socks` set, but `onion` and `onlynet` not set), peer connection was observed to grow over the span of a half our (with ipv4, ipv6, and onion peers connected).\r\ndebug log showed general socks connection failures (although these also occur in v26.0 when using localhost:9050 for socks):\r\n```\r\n<date> Socks5() connect to <IPv4 ADDR>:38333 failed: general failure\r\n```\r\nFor the second action (i.e. running with `proxy` and `onlynet=onion` with manual seed added), onion peer connections were observed.\r\n\r\nFor both actions, UNIX socket traffic was sniffed and contained bitcoin protocol traffic.\r\n\r\n> ACK for [6dddc1c](https://github.com/bitcoin/bitcoin/commit/6dddc1c2eda514d35219cce03c229bd6f822be55). Great work on a great feature. Seems to work well. Reviewed the code changes, but didn't see anything noteworthy over what vasild, luke-jr, and willcl-ark already saw.\r\n> \r\n> Ran the following test actions:\r\n> \r\n>     * Cloned and checked out PR branch, compiled, and ran all functional tests (all passed)\r\n> \r\n>     * Configured Tor to listen on only the unix domain socket /run/tor/socks (SocksPort 9050 and ControlPort 9051 disabled)\r\n> \r\n>     * Started bitcoind (signet), `proxy=/run/tor/socks` set, `onion` and `onlynet` not set.  Connections were established with multiple peers and successful block download was observed.  Sniffed the unix socket (`/run/tor/socks`) with https://github.com/mechpen/sockdump, and observed bitcoin traffic in Wireshark with a pcap dump from sockdump.  `getpeerinfo` command to the node showed ipv4, ipv6, and onion addr peers.\r\n> \r\n>     * Started bitcoind (signet), `onion=/run/tor/socks` set, `proxy` not set, but `onlynet=onion` set.  Manually added seed `v7ajjeirttkbnt32wpy3c6w3emwnfr3fkla7hpxcfokr3ysd3kqtzmqd.onion:38333` with `addnode` command.  Connections were established with multiple peers and successful block download was observed.  Sniffed the unix socket and again observed bitcoin traffic over the socket.  `getpeerinfo` showed multiple onion addr peers.\r\n\r\n",
      "created_at" : "2024-03-08T20:43:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1986390436",
      "id" : 1986390436,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5852Zemk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986390436/reactions"
      },
      "updated_at" : "2024-03-08T21:03:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986390436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 567cec9a05e1261e955535f734826b12341684b6",
      "created_at" : "2024-03-12T17:55:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1992240831",
      "id" : 1992240831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5852vy6_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992240831/reactions"
      },
      "updated_at" : "2024-03-12T17:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992240831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seems like there's a silent merge conflict somewhere, getting a functional test failure when merged with master:\r\n\r\n```\r\n2024-03-12T18:12:19.695000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/home/ava/bitcoin/bitcoin/master/test/functional/test_framework/test_framework.py\", line 565, in start_nodes\r\n    node.wait_for_rpc_connection()\r\n  File \"/home/ava/bitcoin/bitcoin/master/test/functional/test_framework/test_node.py\", line 255, in wait_for_rpc_connection\r\n    raise FailedToStartError(self._node_msg(\r\ntest_framework.test_node.FailedToStartError: [node 5] bitcoind exited with status 1 during initialization. Error: Invalid -proxy address or hostname: 'unix:/tmp/tmp9eh_pwt0'\r\n```",
      "created_at" : "2024-03-12T18:13:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1992272005",
      "id" : 1992272005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII5852v6iF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992272005/reactions"
      },
      "updated_at" : "2024-03-12T18:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992272005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1522463814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522463814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@achow101 Its very mysterious, when I rebase this branch on master (`git rebase master`) these lines **disappear.** I can't figure out why!\r\n\r\nHowever when I do interactive `git rebase master -i` and stop on this commit with an `edit` command, DO NOTHING, and just `git rebase --continue`... the lines remain intact. I am force-pushing this interactive rebase branch now.  :face_with_spiral_eyes: ",
      "commit_id" : "6df896fc37f5b2023b891d5300345e2a4352e521",
      "created_at" : "2024-03-13T03:50:46Z",
      "diff_hunk" : "@@ -3,6 +3,10 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#discussion_r1522463814",
      "id" : 1522463814,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585avvRG",
      "original_commit_id" : "567cec9a05e1261e955535f734826b12341684b6",
      "original_line" : 8,
      "original_position" : 6,
      "original_start_line" : 6,
      "path" : "src/netbase.cpp",
      "position" : 6,
      "pull_request_review_id" : 1933113101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27375",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522463814/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 6,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-13T03:50:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1522463814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Seems like there's a silent merge conflict somewhere, getting a functional test failure when merged with master:\r\n\r\nI re-ran the CI and it didn't fail. Are you sure this is a silent conflict, because if it was, the CI should be detecting it on a re-run?",
      "created_at" : "2024-03-13T07:39:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1993738076",
      "id" : 1993738076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII58521gdc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1993738076/reactions"
      },
      "updated_at" : "2024-03-13T07:39:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1993738076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oh! The test command I use doesn't rerun autogen.sh every time, I think that's what caused the test failure. @pinheadmz You can reset the branch back to 567cec9a05e and this can be merged. Sorry about the confusion.",
      "created_at" : "2024-03-13T10:33:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1994064672",
      "id" : 1994064672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII58522wMg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994064672/reactions"
      },
      "updated_at" : "2024-03-13T10:33:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994064672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Oh! The test command I use doesn't rerun autogen.sh every time, I think that's what caused the test failure. @pinheadmz You can reset the branch back to [567cec9](https://github.com/bitcoin/bitcoin/commit/567cec9a05e1261e955535f734826b12341684b6) and this can be merged. Sorry about the confusion.\r\n\r\nUgh and when I was trying to reproduce I ALSO didn't rerun autogen or config :facepalm: wow THANKS @maflcko for the sanity check",
      "created_at" : "2024-03-13T10:35:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1994068654",
      "id" : 1994068654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII58522xKu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994068654/reactions"
      },
      "updated_at" : "2024-03-13T10:35:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994068654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> autogen\r\n\r\nwen cmake?",
      "created_at" : "2024-03-13T12:19:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1994257188",
      "id" : 1994257188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII58523fMk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994257188/reactions"
      },
      "updated_at" : "2024-03-13T12:19:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994257188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is the expectation here that we should see a lot more `Cannot connect to socket for xxxxx` in debug.logs? (when not using any of these new features).",
      "created_at" : "2024-03-13T12:27:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1994273081",
      "id" : 1994273081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII58523jE5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994273081/reactions"
      },
      "updated_at" : "2024-03-13T12:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994273081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Is the expectation here that we should see a lot more `Cannot connect to socket for xxxxx` in debug.logs? (when not using any of these new features).\r\n\r\nYes but that log message can be removed or set to debug in a follow-up. With `-debug=net` you can see what the original messages were for that code path, with the extra message following:\r\n\r\n```\r\n2024-03-13T14:08:49Z [net] connection attempt to 95.165.161.198:8333 timed out\r\n2024-03-13T14:08:49Z Cannot connect to socket for 95.165.161.198:8333\r\n...\r\n2024-03-13T14:08:50Z [net] connect() to 31.150.240.73:8333 failed after wait: Connection refused (61)\r\n2024-03-13T14:08:50Z Cannot connect to socket for 31.150.240.73:8333\r\n```\r\n\r\nI have a few unix sockets follow ups planned: RPC & bitcoin-cli (maybe speed up the tests!) and ZMQ. I'll clean up this log message in those",
      "created_at" : "2024-03-13T14:11:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1994498888",
      "id" : 1994498888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII58524aNI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994498888/reactions"
      },
      "updated_at" : "2024-03-13T14:11:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994498888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok, it needs to be cleaned up because it's just spammy/pointless. i.e:\r\n```bash\r\n2024-03-13T13:26:00Z Cannot connect to socket for 151.213.177.128:8333\r\n2024-03-13T13:26:24Z Cannot connect to socket for 75.88.65.59:8333\r\n2024-03-13T13:26:48Z Cannot connect to socket for 76.114.61.112:8333\r\n2024-03-13T13:28:55Z Cannot connect to socket for [2600:8805:5c26:eb00:61b0:c6a7:451:1b39]:8333\r\n2024-03-13T13:30:45Z New block-relay-only v1 peer connected: version: 70016, blocks=834513, peer=39\r\n2024-03-13T13:32:01Z Cannot connect to socket for [2a04:6ec0:20d:d050:819a:ceb8:4416:2bc0]:8333\r\n2024-03-13T13:32:14Z New block-relay-only v1 peer connected: version: 70016, blocks=834513, peer=40\r\n2024-03-13T13:34:47Z New block-relay-only v1 peer connected: version: 70016, blocks=834513, peer=41\r\n2024-03-13T13:34:58Z Cannot connect to socket for 122.206.190.60:8333\r\n2024-03-13T13:36:23Z New block-relay-only v1 peer connected: version: 70016, blocks=834513, peer=42\r\n2024-03-13T13:37:38Z Cannot connect to socket for 138.199.60.26:8333\r\n2024-03-13T13:38:34Z Cannot connect to socket for 120.236.171.239:8333\r\n2024-03-13T13:39:00Z Cannot connect to socket for 35.72.149.104:8333\r\n2024-03-13T13:41:22Z Cannot connect to socket for 176.199.211.63:8333\r\n2024-03-13T13:41:25Z Cannot connect to socket for [2804:7f0:7c80:196f:b0b2:1642:e4a9:b794]:8333\r\n2024-03-13T13:41:37Z Cannot connect to socket for [2a00:b700::3:379]:8333\r\n2024-03-13T13:42:55Z Cannot connect to socket for [2001:871:24b:ab3e:d1f2:1f7e:b950:692f]:8333\r\n2024-03-13T13:43:01Z New block-relay-only v1 peer connected: version: 70016, blocks=834513, peer=43\r\n2024-03-13T13:45:30Z Cannot connect to socket for 121.237.138.96:8333\r\n2024-03-13T13:46:56Z Cannot connect to socket for 110.153.86.87:8333\r\n2024-03-13T13:48:32Z Saw new header hash=0000000000000000000071923ef5a18dc17d47717fae386296dfe8902414ea71 height=834514\r\n2024-03-13T13:48:32Z Saw new cmpctblock header hash=0000000000000000000071923ef5a18dc17d47717fae386296dfe8902414ea71 peer=16\r\n2024-03-13T13:48:32Z UpdateTip: new best=0000000000000000000071923ef5a18dc17d47717fae386296dfe8902414ea71 height=834514 version=0x2fffe000 log2_work=94.792163 tx=976064192 date='2024-03-13T13:48:27Z' progress=1.000000 cache=232.4MiB(1767736txo)\r\n2024-03-13T13:50:28Z Cannot connect to socket for 58.219.96.208:8333\r\n2024-03-13T13:50:41Z Cannot connect to socket for 189.19.183.194:8333\r\n2024-03-13T13:52:56Z New block-relay-only v1 peer connected: version: 70016, blocks=834514, peer=45\r\n2024-03-13T13:53:12Z Cannot connect to socket for [2600:381:6a90:cfa5:b0a4:5c43:fdb8:9298]:8333\r\n2024-03-13T13:56:25Z Cannot connect to socket for [2003:d7:df24:a900:53a3:8916:d525:9958]:8333\r\n2024-03-13T14:00:04Z Cannot connect to socket for 97.96.100.48:8333\r\n2024-03-13T14:03:56Z Cannot connect to socket for 195.181.167.197:8333\r\n2024-03-13T14:04:02Z Saw new header hash=00000000000000000001ee20083bb8df96e256bb46dd856c48f686b692dbc29b height=834515\r\n2024-03-13T14:04:02Z Saw new cmpctblock header hash=00000000000000000001ee20083bb8df96e256bb46dd856c48f686b692dbc29b peer=16\r\n2024-03-13T14:04:02Z UpdateTip: new best=00000000000000000001ee20083bb8df96e256bb46dd856c48f686b692dbc29b height=834515 version=0x294c8000 log2_work=94.792178 tx=976067423 date='2024-03-13T14:03:37Z' progress=1.000000 cache=234.9MiB(1785815txo)\r\n2024-03-13T14:04:31Z Cannot connect to socket for [2606:6080:1001:30:5f94:f242:c829:1017]:8333\r\n2024-03-13T14:04:32Z Saw new header hash=00000000000000000001cee842398455cae402ab13037a450fe4829db7efd2e2 height=834516\r\n2024-03-13T14:04:32Z Saw new cmpctblock header hash=00000000000000000001cee842398455cae402ab13037a450fe4829db7efd2e2 peer=16\r\n2024-03-13T14:04:33Z UpdateTip: new best=00000000000000000001cee842398455cae402ab13037a450fe4829db7efd2e2 height=834516 version=0x27fd4000 log2_work=94.792192 tx=976069773 date='2024-03-13T14:04:13Z' progress=1.000000 cache=236.4MiB(1799558txo)\r\n2024-03-13T14:04:59Z Cannot connect to socket for 178.70.102.186:8333\r\n2024-03-13T14:05:43Z Cannot connect to socket for [2409:8a55:6ad:7101:49d4:4737:ccad:17c]:8333\r\n2024-03-13T14:06:21Z Saw new header hash=000000000000000000030739bcd83bfdfc6a03a1a58e21e4c61d6b59ac047569 height=834517\r\n2024-03-13T14:06:21Z Saw new cmpctblock header hash=000000000000000000030739bcd83bfdfc6a03a1a58e21e4c61d6b59ac047569 peer=16\r\n2024-03-13T14:06:21Z UpdateTip: new best=000000000000000000030739bcd83bfdfc6a03a1a58e21e4c61d6b59ac047569 height=834517 version=0x2cbea000 log2_work=94.792206 tx=976071288 date='2024-03-13T14:05:33Z' progress=1.000000 cache=236.4MiB(1802022txo)\r\n2024-03-13T14:06:45Z Cannot connect to socket for 86.168.50.224:8333\r\n2024-03-13T14:08:29Z Cannot connect to socket for 194.163.131.91:39388\r\n2024-03-13T14:11:12Z Cannot connect to socket for [2603:6080:7a0e:59ff:9da7:4932:3d76:58ec]:8333\r\n2024-03-13T14:11:41Z Cannot connect to socket for 108.214.8.13:60501\r\n2024-03-13T14:12:06Z Cannot connect to socket for 84.178.138.51:8333\r\n```",
      "created_at" : "2024-03-13T14:13:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27375#issuecomment-1994503352",
      "id" : 1994503352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27375",
      "node_id" : "IC_kwDOABII58524bS4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994503352/reactions"
      },
      "updated_at" : "2024-03-13T14:13:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994503352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
